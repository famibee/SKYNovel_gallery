/*! For license information please see web.372.js.LICENSE.txt */
"use strict";(self.webpackChunkgallery=self.webpackChunkgallery||[]).push([[372],{4372:(t,e,n)=>{n.d(e,{SoundMng:()=>et});var s,o=n(4481);function i(){return s}var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},c=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],l={};function h(t){var e=a({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},t||{}),n=document.createElement("audio"),s={},o=/^no$/;c.forEach((function(t){var i=n.canPlayType("audio/".concat(t)).replace(o,""),r=e[t]?n.canPlayType(e[t]).replace(o,""):"";s[t]=!!i||!!r})),Object.assign(l,s)}h();var p=/\.(\{([^\}]+)\})(\?.*)?$/;function f(t){var e=p,n="string"==typeof t?t:t.url;if(!e.test(n))return n;for(var s=e.exec(n),o=s[2].split(","),i=o[o.length-1],r=0,u=o.length;r<u;r++){var a=o[r];if(l[a]){i=a;break}}var c=n.replace(s[1],i);if("string"!=typeof t){var h=t;h.extension=i,h.url=c}return c}var d,_=c.filter((function(t){return l[t]})),y=function(){function t(){}return t.add=function(){t.setLegacy(i().useLegacy)},t.setLegacy=function(t){t?_.forEach((function(t){o.a.setExtensionXhrType(t,o.a.XHR_RESPONSE_TYPE.DEFAULT),o.a.setExtensionLoadType(t,o.a.LOAD_TYPE.AUDIO)})):_.forEach((function(t){o.a.setExtensionXhrType(t,o.a.XHR_RESPONSE_TYPE.BUFFER),o.a.setExtensionLoadType(t,o.a.LOAD_TYPE.XHR)}))},t.pre=function(t,e){f(t),e()},t.use=function(t,e){t.data&&_.indexOf(t.extension)>-1?t.sound=i().add(t.name,{loaded:e,preload:!0,url:t.url,source:t.data}):e()},t.extension="loader",t}(),m=0,b=function(t){function e(e){var n=t.call(this)||this;return n.id=m++,n.init(e),n}return u(e,t),e.prototype.set=function(t,e){if(void 0===this[t])throw new Error("Property with name ".concat(t," does not exist."));switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this},Object.defineProperty(e.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype._onPlay=function(){this._playing=!0},e.prototype._onPause=function(){this._playing=!1},e.prototype.init=function(t){this._playing=!1,this._duration=t.source.duration;var e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t},e.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},e.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var n=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);this._source.volume=o*n*s,this._source.playbackRate=this._speed*t.speed*e.speed},e.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",n))},e.prototype.play=function(t){var n=this,s=t.start,i=t.end,r=t.speed,u=t.loop,a=t.volume,c=t.muted;this._speed=r,this._volume=a,this._loop=!!u,this._muted=c,this.refresh(),this.loop&&null!==i&&(this.loop=!1),this._start=s,this._end=i||this._duration,this._start=Math.max(0,this._start-e.PADDING),this._end=Math.min(this._end+e.PADDING,this._duration),this._source.onloadedmetadata=function(){n._source&&(n._source.currentTime=s,n._source.onloadedmetadata=null,n.emit("progress",s,n._duration),o.T.shared.add(n._onUpdate,n))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},e.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},e.prototype._onComplete=function(){o.T.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},e.prototype.destroy=function(){o.T.shared.remove(this._onUpdate,this),this.removeAllListeners();var t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},e.prototype.toString=function(){return"[HTMLAudioInstance id=".concat(this.id,"]")},e.PADDING=.1,e}(o.i),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.init=function(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)},e.prototype.create=function(){return new b(this)},Object.defineProperty(e.prototype,"isPlayable",{get:function(){return!!this._source&&4===this._source.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._source.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.load=function(t){var e=this._source,n=this.parent;if(4!==e.readyState)if(n.url){e.src=n.url;var s=function(){r(),n.isLoaded=!0;var e=n.autoPlayStart();t&&t(null,n,e)},o=function(){r(),t&&t(new Error("Sound loading has been aborted"))},i=function(){r();var n="Failed to load audio element (code: ".concat(e.error.code,")");t&&t(new Error(n))},r=function(){e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",o),e.removeEventListener("error",i)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",o,!1),e.addEventListener("error",i,!1),e.load()}else t(new Error("sound.url or sound.source must be set"));else{n.isLoaded=!0;var u=n.autoPlayStart();t&&setTimeout((function(){t(null,n,u)}),0)}},e}(o.i),v=function(){function t(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}return t.prototype.play=function(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},t.prototype.destroy=function(){this.parent=null},t}(),P=function(){function t(){}return t.setParamValue=function(t,e){if(t.setValueAtTime){var n=i().context;t.setValueAtTime(e,n.audioContext.currentTime)}else t.value=e;return e},t}(),x=0,w=function(t){function e(e){var n=t.call(this)||this;return n.id=x++,n._media=null,n._paused=!1,n._muted=!1,n._elapsed=0,n.init(e),n}return u(e,t),e.prototype.set=function(t,e){if(void 0===this[t])throw new Error("Property with name ".concat(t," does not exist."));switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this},e.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh(),this._update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(t){var e;this._filters&&(null===(e=this._filters)||void 0===e||e.filter((function(t){return t})).forEach((function(t){return t.disconnect()})),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){if(this._source){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var n=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);P.setParamValue(this._gain.gain,o*s*n),P.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}},e.prototype.applyFilters=function(){var t;if(null!==(t=this._filters)&&void 0!==t&&t.length){this._source.disconnect();var e=this._source;this._filters.forEach((function(t){e.connect(t.destination),e=t})),e.connect(this._gain)}},e.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",n))},e.prototype.play=function(t){var e=t.start,n=t.end,s=t.speed,o=t.loop,i=t.volume,r=t.muted,u=t.filters;this._paused=!1;var a=this._media.nodes.cloneBufferSource(),c=a.source,l=a.gain;this._source=c,this._gain=l,this._speed=s,this._volume=i,this._loop=!!o,this._muted=r,this._filters=u,this.refresh();var h=this._source.buffer.duration;this._duration=h,this._end=n,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=n,this._source.loopStart=e,this._source.start(0,e)):n?this._source.start(0,e,n-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)},e.prototype.enableTicker=function(t){o.T.shared.remove(this._updateListener,this),t&&o.T.shared.add(this._updateListener,this)},Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),null===(t=this._filters)||void 0===t||t.forEach((function(t){return t.disconnect()})),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},e.prototype.toString=function(){return"[WebAudioInstance id=".concat(this.id,"]")},e.prototype._now=function(){return this._media.context.audioContext.currentTime},e.prototype._updateListener=function(){this._update()},e.prototype._update=function(t){if(void 0===t&&(t=!1),this._source){var e=this._now(),n=e-this._lastUpdate;if(n>0||t){var s=this._source.playbackRate.value;this._elapsed+=n*s,this._lastUpdate=e;var o=this._duration,i=void 0;if(this._source.loopStart){var r=this._source.loopEnd-this._source.loopStart;i=(this._source.loopStart+this._elapsed%r)/o}else i=this._elapsed%o/o;this._progress=i,this.emit("progress",this._progress,o)}}},e.prototype.init=function(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)},e.prototype._internalStop=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch{}this._source=null}},e.prototype._onComplete=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch{}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},e}(o.i),O=function(){function t(t,e){this._output=e,this._input=t}return Object.defineProperty(t.prototype,"destination",{get:function(){return this._input},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this._filters},set:function(t){var e=this;if(this._filters&&(this._filters.forEach((function(t){t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();var n=null;t.forEach((function(t){null===n?e._input.connect(t.destination):n.connect(t.destination),n=t})),n.connect(this._output)}},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},t}(),S=function(t){function e(e){var n=this,s=e.audioContext,o=s.createBufferSource(),i=s.createGain(),r=s.createAnalyser();return o.connect(r),r.connect(i),i.connect(e.destination),(n=t.call(this,r,i)||this).context=e,n.bufferSource=o,n.gain=i,n.analyser=r,n}return u(e,t),Object.defineProperty(e.prototype,"script",{get:function(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(e.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null},e.prototype.cloneBufferSource=function(){var t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,P.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;var n=this.context.audioContext.createGain();return e.connect(n),n.connect(this.destination),{source:e,gain:n}},Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this.script.bufferSize},enumerable:!1,configurable:!0}),e.BUFFER_SIZE=0,e}(O),E=function(){function t(){}return t.prototype.init=function(t){this.parent=t,this._nodes=new S(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source},t.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch{}this._source=null,this.source=null},t.prototype.create=function(){return new w(this)},Object.defineProperty(t.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this._nodes.filters},set:function(t){this._nodes.filters=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._source.buffer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._source.buffer},set:function(t){this._source.buffer=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),t.prototype.load=function(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))},t.prototype._loadUrl=function(t){var e=this,n=new XMLHttpRequest,s=this.parent.url;n.open("GET",s,!0),n.responseType="arraybuffer",n.onload=function(){e.source=n.response,e._decode(n.response,t)},n.send()},t.prototype._decode=function(t,e){var n=this,s=function(t,s){if(t)e&&e(t);else{n.parent.isLoaded=!0,n.buffer=s;var o=n.parent.autoPlayStart();e&&e(null,n.parent,o)}};t instanceof AudioBuffer?s(null,t):this.parent.context.decode(t,s)},t}(),k=function(){function t(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);var n=e.complete;this._autoPlayOptions=n?{complete:n}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}return t.from=function(e){var n={};return"string"==typeof e?n.url=e:e instanceof ArrayBuffer||e instanceof AudioBuffer||e instanceof HTMLAudioElement?n.source=e:n=e,(n=a({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},n)).url&&(n.url=f(n.url)),Object.freeze(n),new t(i().useLegacy?new g:new E,n)},Object.defineProperty(t.prototype,"context",{get:function(){return i().context},enumerable:!1,configurable:!0}),t.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},t.prototype.resume=function(){return this.isPlaying=this._instances.length>0,this.paused=!1,this},Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this.media.filters},set:function(t){this.media.filters=t},enumerable:!1,configurable:!0}),t.prototype.addSprites=function(t,e){if("object"==typeof t){var n={};for(var s in t)n[s]=this.addSprites(s,t[s]);return n}var o=new v(this,e);return this._sprites[t]=o,o},t.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},t.prototype.removeSprites=function(t){if(t){var e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(var n in this._sprites)this.removeSprites(n);return this},Object.defineProperty(t.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!1,configurable:!0}),t.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this},t.prototype.play=function(t,e){var n,s=this;if("string"==typeof t?n={sprite:i=t,loop:this.loop,complete:e}:"function"==typeof t?(n={}).complete=t:n=t,(n=a({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},n||{})).sprite){var o=n.sprite,i=this._sprites[o];n.start=i.start+(n.start||0),n.end=i.end,n.speed=i.speed||1,n.loop=i.loop||n.loop,delete n.sprite}if(n.offset&&(n.start=n.offset),!this.isLoaded)return new Promise((function(t,e){s.autoPlay=!0,s._autoPlayOptions=n,s._preload((function(s,o,i){s?e(s):(n.loaded&&n.loaded(s,o,i),t(i))}))}));(this.singleInstance||n.singleInstance)&&this._removeInstances();var r=this._createInstance();return this._instances.push(r),this.isPlaying=!0,r.once("end",(function(){n.complete&&n.complete(s),s._onComplete(r)})),r.once("stop",(function(){s._onComplete(r)})),r.play(n),r},t.prototype.refresh=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refresh()},t.prototype.refreshPaused=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refreshPaused()},Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),t.prototype._preload=function(t){this.media.load(t)},Object.defineProperty(t.prototype,"instances",{get:function(){return this._instances},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sprites",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.media.duration},enumerable:!1,configurable:!0}),t.prototype.autoPlayStart=function(){var t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t},t.prototype._removeInstances=function(){for(var t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0},t.prototype._onComplete=function(t){if(this._instances){var e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)},t.prototype._createInstance=function(){if(t._pool.length>0){var e=t._pool.pop();return e.init(this.media),e}return this.media.create()},t.prototype._poolInstance=function(e){e.destroy(),t._pool.indexOf(e)<0&&t._pool.push(e)},t._pool=[],t}(),j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=1,e.muted=!1,e.volume=1,e.paused=!1,e}return u(e,t),e.prototype.refresh=function(){this.emit("refresh")},e.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioContext",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},e.prototype.destroy=function(){this.removeAllListeners()},e}(o.i),F=function(t){function e(){var n=t.call(this,null,null)||this;n.autoPause=!0;var s=window,i=new e.AudioContext,r=i.createDynamicsCompressor(),u=i.createAnalyser();return u.connect(r),r.connect(i.destination),n._input=u,n._output=i.destination,n._ctx=i,n._offlineCtx=new e.OfflineAudioContext(1,2,s.OfflineAudioContext?Math.max(8e3,Math.min(96e3,i.sampleRate)):44100),n.compressor=r,n.analyser=u,n.events=new o.i,n.volume=1,n.speed=1,n.muted=!1,n.paused=!1,n._locked="suspended"===i.state&&("ontouchstart"in globalThis||"onclick"in globalThis),n._locked&&(n._unlock(),n._unlock=n._unlock.bind(n),document.addEventListener("mousedown",n._unlock,!0),document.addEventListener("touchstart",n._unlock,!0),document.addEventListener("touchend",n._unlock,!0)),n.onFocus=n.onFocus.bind(n),n.onBlur=n.onBlur.bind(n),globalThis.addEventListener("focus",n.onFocus),globalThis.addEventListener("blur",n.onBlur),n}return u(e,t),e.prototype.onFocus=function(){if(this.autoPause){var t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}},e.prototype.onBlur=function(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))},e.prototype._unlock=function(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))},e.prototype.playEmptySound=function(){var t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()},Object.defineProperty(e,"AudioContext",{get:function(){var t=window;return t.AudioContext||t.webkitAudioContext||null},enumerable:!1,configurable:!0}),Object.defineProperty(e,"OfflineAudioContext",{get:function(){var t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=this._ctx;void 0!==e.close&&e.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){this.events.emit("refresh")},e.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},e.prototype.decode=function(t,e){var n=function(t){e(new Error(t?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,(function(t){e(null,t)}),n);s&&s.catch(n)},e}(O),L=function(){function t(){this.init()}return t.prototype.init=function(){return this.supported&&(this._webAudioContext=new F),this._htmlAudioContext=new j,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(t){this.useLegacy||(this._context.filters=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supported",{get:function(){return null!==F.AudioContext},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){if("object"==typeof t){var n={};for(var s in t){var o=this._getOptions(t[s],e);n[s]=this.add(s,o)}return n}if(e instanceof k)return this._sounds[t]=e,e;var i=this._getOptions(e),r=k.from(i);return this._sounds[t]=r,r},t.prototype._getOptions=function(t,e){var n;return n="string"==typeof t?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,a(a({},n),e||{})},Object.defineProperty(t.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(t){y.setLegacy(t),this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableAutoPause",{get:function(){return!this._webAudioContext.autoPause},set:function(t){this._webAudioContext.autoPause=!t},enumerable:!1,configurable:!0}),t.prototype.remove=function(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this},Object.defineProperty(t.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(t){this._context.volume=t,this._context.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speedAll",{get:function(){return this._context.speed},set:function(t){this._context.speed=t,this._context.refresh()},enumerable:!1,configurable:!0}),t.prototype.togglePauseAll=function(){return this._context.togglePause()},t.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refreshPaused(),this},t.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refreshPaused(),this},t.prototype.toggleMuteAll=function(){return this._context.toggleMute()},t.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},t.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},t.prototype.removeAll=function(){for(var t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this},t.prototype.stopAll=function(){for(var t in this._sounds)this._sounds[t].stop();return this},t.prototype.exists=function(t,e){return!!this._sounds[t]},t.prototype.find=function(t){return this.exists(t,!0),this._sounds[t]},t.prototype.play=function(t,e){return this.find(t).play(e)},t.prototype.stop=function(t){return this.find(t).stop()},t.prototype.pause=function(t){return this.find(t).pause()},t.prototype.resume=function(t){return this.find(t).resume()},t.prototype.volume=function(t,e){var n=this.find(t);return void 0!==e&&(n.volume=e),n.volume},t.prototype.speed=function(t,e){var n=this.find(t);return void 0!==e&&(n.speed=e),n.speed},t.prototype.duration=function(t){return this.find(t).duration},t.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},t}(),A=function(){function t(t,e){this.init(t,e)}return t.prototype.init=function(t,e){this.destination=t,this.source=e||t},t.prototype.connect=function(t){this.source.connect(t)},t.prototype.disconnect=function(){this.source.disconnect()},t.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},t}(),C={__proto__:null,Filter:A,EqualizerFilter:function(t){function e(n,s,o,r,u,a,c,l,h,p){void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===u&&(u=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===p&&(p=0);var f=this;if(!i().useLegacy){var d=[{f:e.F32,type:"lowshelf",gain:n},{f:e.F64,type:"peaking",gain:s},{f:e.F125,type:"peaking",gain:o},{f:e.F250,type:"peaking",gain:r},{f:e.F500,type:"peaking",gain:u},{f:e.F1K,type:"peaking",gain:a},{f:e.F2K,type:"peaking",gain:c},{f:e.F4K,type:"peaking",gain:l},{f:e.F8K,type:"peaking",gain:h},{f:e.F16K,type:"highshelf",gain:p}].map((function(t){var e=i().context.audioContext.createBiquadFilter();return e.type=t.type,P.setParamValue(e.Q,1),e.frequency.value=t.f,P.setParamValue(e.gain,t.gain),e}));(f=t.call(this,d[0],d[d.length-1])||this).bands=d,f.bandsMap={};for(var _=0;_<f.bands.length;_++){var y=f.bands[_];_>0&&f.bands[_-1].connect(y),f.bandsMap[y.frequency.value]=y}return f}f=t.call(this,null)||this}return u(e,t),e.prototype.setGain=function(t,e){if(void 0===e&&(e=0),!this.bandsMap[t])throw new Error("No band found for frequency ".concat(t));P.setParamValue(this.bandsMap[t].gain,e)},e.prototype.getGain=function(t){if(!this.bandsMap[t])throw new Error("No band found for frequency ".concat(t));return this.bandsMap[t].gain.value},Object.defineProperty(e.prototype,"f32",{get:function(){return this.getGain(e.F32)},set:function(t){this.setGain(e.F32,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f64",{get:function(){return this.getGain(e.F64)},set:function(t){this.setGain(e.F64,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f125",{get:function(){return this.getGain(e.F125)},set:function(t){this.setGain(e.F125,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f250",{get:function(){return this.getGain(e.F250)},set:function(t){this.setGain(e.F250,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f500",{get:function(){return this.getGain(e.F500)},set:function(t){this.setGain(e.F500,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f1k",{get:function(){return this.getGain(e.F1K)},set:function(t){this.setGain(e.F1K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f2k",{get:function(){return this.getGain(e.F2K)},set:function(t){this.setGain(e.F2K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f4k",{get:function(){return this.getGain(e.F4K)},set:function(t){this.setGain(e.F4K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f8k",{get:function(){return this.getGain(e.F8K)},set:function(t){this.setGain(e.F8K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f16k",{get:function(){return this.getGain(e.F16K)},set:function(t){this.setGain(e.F16K,t)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.bands.forEach((function(t){P.setParamValue(t.gain,0)}))},e.prototype.destroy=function(){this.bands.forEach((function(t){t.disconnect()})),this.bands=null,this.bandsMap=null},e.F32=32,e.F64=64,e.F125=125,e.F250=250,e.F500=500,e.F1K=1e3,e.F2K=2e3,e.F4K=4e3,e.F8K=8e3,e.F16K=16e3,e}(A),DistortionFilter:function(t){function e(e){void 0===e&&(e=0);var n=this;if(!i().useLegacy){var s=i().context.audioContext.createWaveShaper();return(n=t.call(this,s)||this)._distortion=s,n.amount=e,n}n=t.call(this,null)||this}return u(e,t),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t;for(var e,n=1e3*t,s=44100,o=new Float32Array(s),i=Math.PI/180,r=0;r<s;++r)e=2*r/s-1,o[r]=(3+n)*e*20*i/(Math.PI+n*Math.abs(e));this._distortion.curve=o,this._distortion.oversample="4x"},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._distortion=null,t.prototype.destroy.call(this)},e}(A),StereoFilter:function(t){function e(e){void 0===e&&(e=0);var n=this;if(!i().useLegacy){var s,o,r,u=i().context.audioContext;return u.createStereoPanner?r=s=u.createStereoPanner():((o=u.createPanner()).panningModel="equalpower",r=o),(n=t.call(this,r)||this)._stereo=s,n._panner=o,n.pan=e,n}n=t.call(this,null)||this}return u(e,t),Object.defineProperty(e.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._stereo?P.setParamValue(this._stereo.pan,t):this._panner.setPosition(t,0,1-Math.abs(t))},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this._stereo=null,this._panner=null},e}(A),ReverbFilter:function(t){function e(e,n,s){void 0===e&&(e=3),void 0===n&&(n=2),void 0===s&&(s=!1);var o=this;if(!i().useLegacy)return(o=t.call(this,null)||this)._seconds=o._clamp(e,1,50),o._decay=o._clamp(n,0,100),o._reverse=s,o._rebuild(),o;o=t.call(this,null)||this}return u(e,t),e.prototype._clamp=function(t,e,n){return Math.min(n,Math.max(e,t))},Object.defineProperty(e.prototype,"seconds",{get:function(){return this._seconds},set:function(t){this._seconds=this._clamp(t,1,50),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"decay",{get:function(){return this._decay},set:function(t){this._decay=this._clamp(t,0,100),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this._reverse},set:function(t){this._reverse=t,this._rebuild()},enumerable:!1,configurable:!0}),e.prototype._rebuild=function(){for(var t,e=i().context.audioContext,n=e.sampleRate,s=n*this._seconds,o=e.createBuffer(2,s,n),r=o.getChannelData(0),u=o.getChannelData(1),a=0;a<s;a++)t=this._reverse?s-a:a,r[a]=(2*Math.random()-1)*Math.pow(1-t/s,this._decay),u[a]=(2*Math.random()-1)*Math.pow(1-t/s,this._decay);var c=i().context.audioContext.createConvolver();c.buffer=o,this.init(c)},e}(A),MonoFilter:function(t){function e(){var e=this;if(!i().useLegacy){var n=i().context.audioContext,s=n.createChannelSplitter(),o=n.createChannelMerger();return o.connect(s),(e=t.call(this,o,s)||this)._merger=o,e}e=t.call(this,null)||this}return u(e,t),e.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,t.prototype.destroy.call(this)},e}(A),StreamFilter:function(t){function e(){var e=this;if(!i().useLegacy){var n=i().context.audioContext,s=n.createMediaStreamDestination(),o=n.createMediaStreamSource(s.stream);return(e=t.call(this,s,o)||this)._stream=s.stream,e}e=t.call(this,null)||this}return u(e,t),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._stream=null,t.prototype.destroy.call(this)},e}(A),TelephoneFilter:function(t){function e(){if(!i().useLegacy){var e=i().context.audioContext,n=e.createBiquadFilter(),s=e.createBiquadFilter(),o=e.createBiquadFilter(),r=e.createBiquadFilter();return n.type="lowpass",P.setParamValue(n.frequency,2e3),s.type="lowpass",P.setParamValue(s.frequency,2e3),o.type="highpass",P.setParamValue(o.frequency,500),r.type="highpass",P.setParamValue(r.frequency,500),n.connect(s),s.connect(o),o.connect(r),t.call(this,n,r)||this}t.call(this,null)}return u(e,t),e}(A)},V=0,N={__proto__:null,playOnce:function(t,e){var n="alias".concat(V++);return i().add(n,{url:t,preload:!0,autoPlay:!0,loaded:function(t){t&&(i().remove(n),e&&e(t))},complete:function(){i().remove(n),e&&e(null)}}),n},get PLAY_ID(){return V},render:function(t,e){var n=document.createElement("canvas");e=a({width:512,height:128,fill:"black"},e||{}),n.width=e.width,n.height=e.height;var s=o.B.from(n);if(!(t.media instanceof E))return s;var i=t.media,r=n.getContext("2d");r.fillStyle=e.fill;for(var u=i.buffer.getChannelData(0),c=Math.ceil(u.length/e.width),l=e.height/2,h=0;h<e.width;h++){for(var p=1,f=-1,d=0;d<c;d++){var _=u[h*c+d];_<p&&(p=_),_>f&&(f=_)}r.fillRect(h,(1+p)*l,1,Math.max(1,(f-p)*l))}return s},resolveUrl:f,sineTone:function(t,e){void 0===t&&(t=200),void 0===e&&(e=1);var n=k.from({singleInstance:!0});if(!(n.media instanceof E))return n;for(var s=n.media,o=n.context.audioContext.createBuffer(1,48e3*e,48e3),i=o.getChannelData(0),r=0;r<i.length;r++){var u=t*(r/o.sampleRate)*Math.PI;i[r]=2*Math.sin(u)}return s.buffer=o,n.isLoaded=!0,n},validateFormats:h,supported:l,extensions:c},T=(d=new L,s=d,d);"extensions"in o.n?o.e.add(y):o.L.registerPlugin(y);class M{constructor(t,e,n,s,o,i,r,u){this.fn=t,this.buf=e,this.start_ms=n,this.end_ms=s,this.ret_ms=o,this.volume=i,this.pan=r,this.stt=u?new z:new J,u&&this.addSnd(u)}static#t=1;stt;loop=!1;addSnd(t){switch(this.loop=t.loop,this.stt.onLoad(this),0!==this.pan&&(t.filters=[new C.StereoFilter(this.pan)]),this.setVol=e=>t.volume=e,this.tw=()=>new o.g(t),this.onPlayEnd=()=>{this.stt.onPlayEnd(this.buf),this.#e()},this.stop=()=>{t.stop(),this.#e()},this.destroy=()=>t.destroy(),this.buf){case q:const e=Number(G.getVal("sys:sn.sound.BGM.vol_mul_talking")??1);if(1===e)break;M.#t=e;const n=R[K];n&&n.setVol(this.volume*M.#t);break;case K:t.volume=this.volume*M.#t}}#e=()=>{if(this.#e=()=>{},1===M.#t||this.buf!==q)return;M.#t=1;const t=R[K];t&&t.setVol(this.volume*M.#t)};setVol(t){}tw(){}onPlayEnd(){}stop(){}destroy(){}}let B,G,$,D,R,I;const K="BGM",U="SE",q="VOICE";class H{constructor(t,e,n){this.hArg=t,this.buf=e,this.fn=n;const s=(0,o.b)(t,"start_ms",0),i=(0,o.b)(t,"end_ms",H.#e),r=(0,o.b)(t,"ret_ms",0),u=(0,o.b)(t,"pan",0),a=(0,o.b)(t,"speed",1);if(s<0)throw`[playse] start_ms:${s} が負の値です`;if(r<0)throw`[playse] ret_ms:${r} が負の値です`;if(0<i){if(i<=s)throw`[playse] start_ms:${s} >= end_ms:${i} は異常値です`;if(i<=r)throw`[playse] ret_ms:${r} >= end_ms:${i} は異常値です`}const c="const.sn.sound."+e+".";G.setVal_Nochk("save",c+"fn",n);const l=H.getVol(t,1);G.setVal_Nochk("save",c+"volume",l);const h=l*Number(G.getVal("sys:"+c+"volume",1)),p=(0,o.c)(t,"loop",!1);p?(H.#t[e]=n,G.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(H.#t))):H.delLoopPlay(e),G.setVal_Nochk("save",c+"start_ms",s),G.setVal_Nochk("save",c+"end_ms",i),G.setVal_Nochk("save",c+"ret_ms",r),G.setVal_Nochk("tmp",c+"playing",!0),G.flush();const f=T.find(n);this.#n=new M(n,e,s,i,r,h,u,f);const d={loop:p,speed:a,volume:h,loaded:(e,s)=>{if(!this.#n.stt.isDestroy){if(e)return void $.errScript(`ロード失敗です SndBuf fn:${n} ${e}`,!1);s&&(this.#n.addSnd(s),0!==u&&(s.filters=[new C.StereoFilter(u)]),t.fnc?.())}}};let _="";if(0<s||i<H.#e){_=`${n};${s};${i};${r}`;const t=(d.sprites??={})[_]={start:s/1e3,end:i/1e3};d.preload=!0;const e=d.loaded;d.loaded=(n,o)=>{if(this.#n.stt.isDestroy)return;e(n,o);const u=o,a=u.duration;t.end<0&&(t.end+=a,u.removeSprites(_),u.addSprites(_,t)),t.end<=t.start&&$.errScript(`[playse] end_ms:${i}(${1e3*t.end}) >= start_ms:${s} は異常値です`),1e3*t.end<=r&&$.errScript(`[playse] end_ms:${i}(${1e3*t.end}) <= ret_ms:${r} は異常値です`),a<=t.start&&$.errScript(`[playse] 音声ファイル再生時間:${1e3*a} <= start_ms:${s} は異常値です`),i!==H.#e&&a<=t.end&&$.errScript(`[playse] 音声ファイル再生時間:${1e3*a} <= end_ms:${i} は異常値です`),u.play(_,(t=>d.complete?.(t)))}}else d.autoPlay=!0;if(p?0!==r&&(d.loop=!1,d.complete=async t=>{const e=t.duration,n=r/1e3,s=i/1e3;e<=n&&$.errScript(`[playse] 音声ファイル再生時間:${1e3*e} <=  ret_ms:${r} は異常値です`),await t.play({...d,start:n,end:s<0?s+e:s,loop:!0,filters:0!==u?[new C.StereoFilter(u)]:[]})}):d.complete=()=>{X(this.#n,e),this.#n.onPlayEnd()},this.#s(),f){if(f.volume=h,_)this.#o(n,d);else if(f.isPlayable){const t=f.options.source;t instanceof ArrayBuffer&&0!==t.byteLength?this.#n.addSnd(k.from({...d,url:f.options.url,source:t})):f.play(d),0!==u&&(f.filters=[new C.StereoFilter(u)])}this.needLoad=!1}else{if(this.needLoad=(0,o.c)(t,"join",!0)){(0,o.d)();const t=d.loaded;d.loaded=(e,n)=>{this.#n.stt.isDestroy||t(e,n),(0,o.f)()}}this.#o(n,d)}}static#t={};static init(t,e,n,s,o){H.#t={},B=t,G=e,$=n,D=s,R=o}static setEvtMng(t){I=t}static delLoopPlay(t){delete H.#t[t];const e="const.sn.sound."+t+".";G.setVal_Nochk("save",e+"fn",""),G.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(H.#t)),G.flush()}static getVol(t,e){const n=(0,o.b)(t,"volume",e);return n<0?0:n>1?1:n}static xchgbuf({buf:t=U,buf2:e=U}){if(t===e)throw`[xchgbuf] buf:${t} が同じ値です`;const n="const.sn.sound."+t+".",s=Number(G.getVal("save:"+n+"volume")),o=String(G.getVal("save:"+n+"fn")),i="const.sn.sound."+e+".",r=Number(G.getVal("save:"+i+"volume")),u=String(G.getVal("save:"+i+"fn"));G.setVal_Nochk("save",n+"volume",r),G.setVal_Nochk("save",i+"volume",s),G.setVal_Nochk("save",n+"fn",u),G.setVal_Nochk("save",i+"fn",o),t in H.#t!=e in H.#t&&(t in H.#t?(delete H.#t[t],H.#t[e]=o):(delete H.#t[e],H.#t[t]=u),G.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(H.#t))),G.flush()}static#e=999e3;#n;needLoad;#s=()=>{T.volumeAll=Number(G.getVal("sys:sn.sound.global_volume",1)),this.#s=()=>{}};#o(t,e){const n=B.searchPath(t,o.S.SOUND);if(!n.endsWith(".bin"))return e.url=n,void k.from(e);(new o.L).add({name:t,url:n,xhrType:o.a.XHR_RESPONSE_TYPE.BUFFER}).use((async(t,e)=>{try{t.data=await D.decAB(t.data)}catch(e){$.errScript(`Sound ロード失敗ですc fn:${t.name} ${e}`,!1)}e()})).load(((n,s)=>{e.source=s[t]?.data,k.from(e)}))}setVol(t){this.#n.setVol(t)}ws=t=>this.#n.stt.ws(this.#n,t);stopse({buf:t=U}){X(this.#n,t),this.#n.stt.stopse(this.#n)}fade=t=>this.#n.stt.fade(this.#n,t);wf=t=>this.#n.stt.wf(this.#n,t);stopfadese=t=>this.#n.stt.stopfadese(this.#n,t)}function X({loop:t},e){if(t)return void H.delLoopPlay(e);const n="const.sn.sound."+e+".";G.setVal_Nochk("tmp",n+"playing",!1),G.flush()}function Y(t){t.stop().end()}class J{onLoad(t){t.stt=new z}stopse(t){t.stt=new tt(t,!1)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class z{onLoad(){}stopse(t){t.stt=new tt(t)}ws(t,e){if(t.loop)return!1;const{buf:n=U}=e,s=(0,o.c)(e,"stop",!0);return(0,o.c)(e,"canskip",!1),!!I.waitEvent("buf:"+n,e,(()=>{X(t,n),t.onPlayEnd(),s?t.stt.stopse(t):t.stt.onPlayEnd=()=>{}}))&&(t.stt=new W,!0)}onPlayEnd(){}fade(t,e){const{buf:n=U}=e,s="const.sn.sound."+n+".volume",i=H.getVol(e,NaN);G.setVal_Nochk("save",s,i);const r=i*Number(G.getVal("sys:"+s,1)),u=(0,o.c)(e,"stop",0===i);u&&H.delLoopPlay(n),G.flush();const a=(0,o.b)(e,"time",NaN),c=(0,o.b)(e,"delay",0);if(0===a&&0===c||I.isSkipping)return t.setVol(r),void(t.stt=u?new tt(t):new z);const l=t.tw();l&&(o.C.setTwProp(l,e).to({volume:r},a).onComplete((()=>{(0,o.r)(l),t.stt.compFade(n),t.stt=u?new tt(t):new z})).start(),t.stt=new Z(l))}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class W{onLoad(){}stopse(t){t.stt=new tt(t)}ws=()=>!1;onPlayEnd(t){I.breakEvent("buf:"+t)}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class Z{constructor(t){this.tw=t}onLoad(){}stopse(t){Y(this.tw),t.stt=new tt(t)}ws=()=>!1;onPlayEnd(){}fade(){}wf(t,e){const{buf:n=U}=e;return(0,o.c)(e,"canskip",!1),!!I.waitEvent("buf:"+n,e,(()=>Y(this.tw)))&&(t.stt=new Q(this.tw),!0)}compFade(){}stopfadese=()=>Y(this.tw);isDestroy=!1}class Q{constructor(t){this.tw=t}onLoad(){}stopse(t){Y(this.tw),t.stt=new tt(t)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(t){I.breakEvent("buf:"+t)}stopfadese=()=>Y(this.tw);isDestroy=!1}class tt{constructor(t,e=!0){this.si=t,this.stop=e,e&&(t.stop(),t.loop&&(t.destroy(),t.destroy=()=>{}))}onLoad(){}stopse(){}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!0}class et{constructor(t,e,n,s,o){this.val=n,e.volume=t=>this.#n(t),e.fadebgm=t=>this.#i(t),e.fadeoutbgm=t=>this.#o(t),e.fadeoutse=t=>this.#r(t),e.fadese=t=>this.#u(t),e.playbgm=t=>this.#a(t),e.playse=t=>this.#c(t),e.stop_allse=()=>this.#l(),e.stopbgm=t=>this.#h(t),e.stopse=t=>this.#p(t),e.wb=t=>this.#f(t),e.wf=t=>this.#d(t),e.stopfadese=t=>this.#_(t),e.wl=t=>this.#y(t),e.ws=t=>this.#m(t),e.xchgbuf=t=>this.#b(t),n.setVal_Nochk("save","const.sn.loopPlaying","{}"),n.setVal_Nochk("tmp","const.sn.sound.codecs",JSON.stringify(N.supported)),H.init(t,n,s,o,this.#t),T.disableAutoPause=!0}#t={};#e;setEvtMng(t){this.#e=t,H.setEvtMng(t)}setNoticeChgVolume(t,e){this.val.defValTrg("sys:sn.sound.global_volume",((e,n)=>t(T.volumeAll=Number(n)))),this.val.defValTrg("sys:sn.sound.movie_volume",((t,n)=>e(Number(n)))),this.val.setVal_Nochk("sys","sn.sound.global_volume",this.val.getVal("sys:sn.sound.global_volume",1)),this.val.setVal_Nochk("sys","sn.sound.movie_volume",this.val.getVal("sys:sn.sound.movie_volume",1))}#n(t){const{buf:e=U}=t,n="const.sn.sound."+e+".volume",s=this.#s(t,1);return Number(this.val.getVal("sys:"+n))!==s&&(this.val.setVal_Nochk("sys",n,s),this.val.flush(),t.time=0,t.volume=Number(this.val.getVal("save:"+n)),this.#u(t))}#s(t,e){const n=(0,o.b)(t,"volume",e);return n<0?0:n>1?1:n}#o(t){return t.volume=0,this.#i(t)}#r(t){return t.volume=0,this.#u(t)}#i(t){return t.buf=K,this.#u(t)}#u(t){const{buf:e=U}=t;return this.#_(t),this.#t[e]?.fade(t),!1}#a(t){return t.buf=K,t.canskip=!1,(0,o.c)(t,"loop",!0),this.#c(t)}#c(t){const{buf:e=U,fn:n}=t;if(this.#p({buf:e}),!n)throw`fnは必須です buf:${e}`;return(!(0,o.c)(t,"canskip",!0)||!this.#e.isSkipping)&&(this.#t[e]=new H(t,e,n)).needLoad}clearCache(){T.removeAll()}#l(){for(const t of Object.keys(this.#t))this.#p({buf:t});return this.#t={},T.stopAll(),!1}#h(t){return t.buf=K,this.#p(t)}#p(t){const{buf:e=U}=t;return this.#t[e]?.stopse(t),!1}#f(t){return t.buf=K,this.#d(t)}#d(t){const{buf:e=U}=t;return this.#t[e]?.wf(t)}#_(t){const{buf:e=U}=t;return this.#t[e]?.stopfadese(t),!1}#y(t){return t.buf=K,this.#m(t)}#m(t){const{buf:e=U}=t;return this.#t[e]?.ws(t)}#b(t){const{buf:e=U,buf2:n=U}=t;if(e===n)return!1;const s=this.#t[e],o=this.#t[n];return s?this.#t[n]=s:delete this.#t[n],o?this.#t[e]=o:delete this.#t[e],H.xchgbuf(t),!1}playLoopFromSaveObj(t){const e=String(this.val.getVal("save:const.sn.loopPlaying","{}"));if("{}"===e)return this.#l(),this.clearCache(),[];const n=JSON.parse(e);if(t)this.#l(),this.clearCache();else for(const[t,e]of Object.entries(this.#t))t in n||e?.stopse({buf:t});return Object.entries(n).map((([e,n])=>new Promise((s=>{const o=this.#t[e];if(!t&&o&&o.fn===n)return void s();const i="save:const.sn.sound."+e+".",r={fn:n,buf:e,join:!1,loop:!0,volume:Number(this.val.getVal(i+"volume")),start_ms:Number(this.val.getVal(i+"start_ms")),end_ms:Number(this.val.getVal(i+"end_ms")),ret_ms:Number(this.val.getVal(i+"ret_ms")),fnc:s};r.buf===K?this.#a(r):this.#c(r)}))))}destroy(){this.#l(),this.clearCache()}}}}]);