"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkgallery"] = self["webpackChunkgallery"] || []).push([["skynovel_dist_ScriptIterator_js"],{

/***/ "../skynovel/dist/CmnTween.js":
/*!************************************!*\
  !*** ../skynovel/dist/CmnTween.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   C: () => (/* binding */ i)\n/* harmony export */ });\n/* harmony import */ var _web2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./web2.js */ \"../skynovel/dist/web2.js\");\n/* harmony import */ var _ReadState_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ReadState.js */ \"../skynovel/dist/ReadState.js\");\n\n\nclass i {\n  static #t = {};\n  static #i;\n  static #a;\n  static init(t, o) {\n    i.#t = {}, i.#i = t, i.#a = o, i.#a.ticker.add(i.#s);\n  }\n  static #s = () => (0,_ReadState_js__WEBPACK_IMPORTED_MODULE_1__.u)();\n  static destroy() {\n    i.stopAllTw(), i.#a.ticker.remove(i.#s);\n  }\n  static setTwProp(t, o) {\n    const s = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.b)(o, \"repeat\", 1);\n    return t.delay((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.b)(o, \"delay\", 0)).easing(i.ease(o.ease)).repeat(s > 0 ? s - 1 : 1 / 0).yoyo((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(o, \"yoyo\", !1));\n  }\n  static #o = {\n    \"Back.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Back.In(t),\n    \"Back.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Back.InOut(t),\n    \"Back.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Back.Out(t),\n    \"Bounce.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Bounce.In(t),\n    \"Bounce.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Bounce.InOut(t),\n    \"Bounce.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Bounce.Out(t),\n    \"Circular.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Circular.In(t),\n    \"Circular.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Circular.InOut(t),\n    \"Circular.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Circular.Out(t),\n    \"Cubic.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Cubic.In(t),\n    \"Cubic.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Cubic.InOut(t),\n    \"Cubic.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Cubic.Out(t),\n    \"Elastic.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Elastic.In(t),\n    \"Elastic.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Elastic.InOut(t),\n    \"Elastic.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Elastic.Out(t),\n    \"Exponential.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Exponential.In(t),\n    \"Exponential.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Exponential.InOut(t),\n    \"Exponential.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Exponential.Out(t),\n    \"Linear.None\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Linear.None(t),\n    \"Quadratic.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quadratic.In(t),\n    \"Quadratic.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quadratic.InOut(t),\n    \"Quadratic.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quadratic.Out(t),\n    \"Quartic.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quartic.In(t),\n    \"Quartic.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quartic.InOut(t),\n    \"Quartic.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quartic.Out(t),\n    \"Quintic.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quintic.In(t),\n    \"Quintic.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quintic.InOut(t),\n    \"Quintic.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Quintic.Out(t),\n    \"Sinusoidal.In\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Sinusoidal.In(t),\n    \"Sinusoidal.InOut\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Sinusoidal.InOut(t),\n    \"Sinusoidal.Out\": (t) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Sinusoidal.Out(t)\n  };\n  static ease(t) {\n    if (!t) return (s) => _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.E.Linear.None(s);\n    const o = i.#o[t];\n    if (!o) throw \"異常なease指定です\";\n    return o;\n  }\n  static hMemberCnt = {\n    alpha: 0,\n    height: 0,\n    rotation: 0,\n    // rotationX〜Z、scaleZ、zは設定すると\n    scale_x: 0,\n    // 三次元方向の拡大縮小ルーチンが働き画像がぼやけるので\n    scale_y: 0,\n    // backlayで設定しない方針\n    pivot_x: 0,\n    pivot_y: 0,\n    width: 0,\n    x: 0,\n    y: 0\n  };\n  static cnvTweenArg(t, o) {\n    const s = {};\n    for (const c of Object.keys(i.hMemberCnt)) {\n      const n = t[c];\n      if (!n) continue;\n      const e = String(n), I = e.startsWith(\"=\"), p = I ? e.slice(1) : e;\n      if (!p) continue;\n      const [O, r] = p.split(\",\"), l = s[c] = parseFloat(O);\n      r && (s[c] += Math.round(\n        Math.random() * (parseFloat(r) - l + 1)\n      )), I && (s[c] += parseFloat(o[c]));\n    }\n    return s;\n  }\n  // トゥイーン全停止\n  static stopAllTw() {\n    i.#t = {}, (0,_ReadState_js__WEBPACK_IMPORTED_MODULE_1__.a)();\n  }\n  static tween(t, o, s, c, n, e, I, p = !0) {\n    const O = this.#i.isSkipping ? 0 : (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.b)(o, \"time\", NaN), r = new _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.T(s).to(c, O).onUpdate(n);\n    i.setTwProp(r, o), i.#t[t] = { tw: r, onEnd: I };\n    const { path: l } = o;\n    let y = r;\n    if (l) {\n      _web2_js__WEBPACK_IMPORTED_MODULE_0__.C.debugLog && console.group(`🍝 [${o[\":タグ名\"]}] path=${l}= start(${s.x},${s.y},${s.alpha})`);\n      for (const { groups: u } of l.matchAll(i.#n)) {\n        const { x: E, x2: v, y: x, y2: S, o: $, o2: g, json: d } = u;\n        let f = {};\n        if (d) try {\n          f = JSON.parse(d);\n        } catch (M) {\n          console.error(`🍝 json=${d} ` + M);\n          continue;\n        }\n        else\n          (E ?? v) && (f.x = E ?? v), (x ?? S) && (f.y = x ?? S), ($ ?? g) && (f.alpha = $ ?? g);\n        const B = i.cnvTweenArg(f, s);\n        _web2_js__WEBPACK_IMPORTED_MODULE_0__.C.debugLog && console.info(`🍝 ${d ?? `{x:${E} y:${x} o:${$}}`} => hTo:${JSON.stringify(B)}`);\n        const Q = new _ReadState_js__WEBPACK_IMPORTED_MODULE_1__.T(s).to(B, O);\n        i.setTwProp(Q, o), y.chain(Q), y = Q;\n      }\n      _web2_js__WEBPACK_IMPORTED_MODULE_0__.C.debugLog && console.groupEnd();\n    }\n    y.onComplete(() => {\n      const u = i.#t[t];\n      u && (delete i.#t[t], u.tw = void 0, r.stop(), i.#i.breakEvent(\"tsy nm:\" + t), u.onEnd?.(), e());\n    });\n    const { chain: h } = o;\n    if (h) {\n      const u = i.#t[h];\n      if (!u?.tw) throw `${h}は存在しない・または終了したトゥイーンです`;\n      delete u.onEnd, u.tw.chain(r);\n    } else p && r.start();\n    return r;\n  }\n  // 11 match 301 step (0.1ms) PCRE2 https://regex101.com/r/reinpq/1\n  // List ${x}${x2}/${y}${y2}/${o}${o2}=${json}\\n\n  /*\n  \\(\\s*\n  (?:\t(?<x>[-=\\d\\.]+)\t|\t(['\"])\t(?<x2>.*?)\t\\2\t)?\n  (?:\n  \t\\s*,\\s*\n  \t(?:\t(?<y>[-=\\d\\.]+)\t|\t(['\"])\t(?<y2>.*?)\t\\5\t)?\n  \t(?:\n  \t\t\\s*,\\s*\n  \t\t(?:\t(?<o>[-=\\d\\.]+)\t|\t(['\"])\t(?<o2>.*?)\t\\8\t)\n  \n  \t)?\n  )?\n  |\n  (?<json>\\{[^{}]*})\n  */\n  static #n = /\\(\\s*(?:(?<x>[-=\\d\\.]+)|(['\"])(?<x2>.*?)\\2)?(?:\\s*,\\s*(?:(?<y>[-=\\d\\.]+)|(['\"])(?<y2>.*?)\\5)?(?:\\s*,\\s*(?:(?<o>[-=\\d\\.]+)|(['\"])(?<o2>.*?)\\8))?)?|(?<json>\\{[^{}]*})/g;\n  // トランス終了待ち\n  static wt(t) {\n    return i.#t[i.TW_INT_TRANS]?.tw ? i.#i.waitEvent(\"tsy nm:\" + i.TW_INT_TRANS, t, () => i.finish_trans()) : !1;\n  }\n  static TW_INT_TRANS = `trans\n`;\n  // 改行でスクリプトから絶対指定できない値に\n  // レイヤのトランジションの停止\n  static finish_trans() {\n    return i.#t[i.TW_INT_TRANS]?.tw?.stop().end(), !1;\n  }\n  // stop()とend()は別\n  // トゥイーン終了待ち\n  static wait_tsy(t) {\n    const { layer: o = \"\", id: s, name: c } = t, n = s ? `frm\n${s}` : c ?? o;\n    if (!n) throw \"トゥイーンが指定されていません\";\n    const e = i.#t[n];\n    if (!e?.tw) {\n      if ((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"chk_exist_tw\", !1)) throw s ? `フレームトゥイーン ${s} が見つかりません。` : `トゥイーン ${n} が見つかりません。(layer:${o} name:${c})`;\n      return !1;\n    }\n    return i.#i.waitEvent(\"tsy nm:\" + n, t, () => e.tw?.end());\n  }\n  // トゥイーン中断\n  static stop_tsy(t) {\n    const { layer: o = \"\", id: s, name: c } = t, n = s ? `frm\n${s}` : c ?? o;\n    if (!n) throw \"トゥイーンが指定されていません\";\n    return i.#t[n]?.tw?.stop().end(), !1;\n  }\n  // 一時停止\n  static pause_tsy(t) {\n    const { layer: o = \"\", id: s, name: c } = t, n = s ? `frm\n${s}` : c ?? o;\n    if (!n) throw \"トゥイーンが指定されていません\";\n    return i.#t[n]?.tw?.pause(), !1;\n  }\n  // 一時停止再開\n  static resume_tsy(t) {\n    const { layer: o = \"\", id: s, name: c } = t, n = s ? `frm\n${s}` : c ?? o;\n    if (!n) throw \"トゥイーンが指定されていません\";\n    return i.#t[n]?.tw?.resume(), !1;\n  }\n}\n\n//# sourceMappingURL=CmnTween.js.map\n\n\n//# sourceURL=webpack://gallery/../skynovel/dist/CmnTween.js?");

/***/ }),

/***/ "../skynovel/dist/RubySpliter.js":
/*!***************************************!*\
  !*** ../skynovel/dist/RubySpliter.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   R: () => (/* binding */ o)\n/* harmony export */ });\nclass o {\n  static #s = \"ヽ\";\n  static setting(t) {\n    t.sesame && (o.#s = t.sesame);\n  }\n  static getSesame() {\n    return o.#s;\n  }\n  static destroy() {\n    o.#s = \"ヽ\";\n  }\n  #t = () => {\n  };\n  init(t) {\n    this.#t = t;\n  }\n  /*\n  \t\t★Unicodeで「漢字」の正規表現 – ものかの http://tama-san.com/kanji-regex/\n  \t\t2E80..2FDF CJK部首補助＋康熙部首\n  \t\t3005 々（漢字の踊り字）\n  \t\t3007 〇（漢数字のゼロ）\n  \t\t303B 〻（漢字の踊り字）\n  \t\t3400..4DBF CJK統合漢字拡張A\n  \t\t4E00..9FFF CJK統合漢字\n  \t\tF900..FAFF CJK互換漢字\n  \t\t20000..2FFFF CJK統合漢字拡張B〜F＋CJK互換漢字追加＋念のためU+2FFFFまで\n  \n  \t\t[\\x{2E80}-\\x{2FDF}々〇〻\\x{3400}-\\x{4DBF}\\x{4E00}-\\x{9FFF}\\x{F900}-\\x{FAFF}\\x{20000}-\\x{2FFFF}]\n  \t\t[\\u2E80-\\u2FDF々〇〻\\u3400-\\u4DBF\\u4E00-\\u9FFF\\uF900-\\uFAFF\\u20000-\\u2FFFF]\n  \t\t[⺀-⿟々〇〻㐀-䶿一-鿿豈-﫿\\u20000-\\u2FFFF]\t\t// 含まれない文字がある\n  \t\t[⺀-⿟々〇〻㐀-鿿豈-﫿\\u20000-\\u2FFFF]\t\t\t// ヽ--30FD が変に引っかかる。多分\\u2000-\\u2FFF解釈\n  \t\t\\\\u{20000}-\\\\u{2FFFF}\t// 五桁だとエラー\n  \n  \t\t【2022/10/03】ruby正規表現のUnicode プロパティ(とPOSIX文字クラス) - Qiita https://qiita.com/Takayuki_Nakano/items/8d38beaddb84b488d683\n  \t\t\t> このHiraganaプロパティ、長音記号は含まれていません。\n  \t\t\t> \\p{Han}…簡体字や繁体字、韓国語の漢字…ベトナム語の漢字にもマッチ\n  \t\t\n  \t\t・Unicode文字一覧表 - instant tools https://tools.m-bsys.com/ex/unicode_table.php\n  */\n  static #n;\n  static setEscape(t) {\n    o.#n = new RegExp(\n      `${t ? `(?<ce>\\\\${t}\\\\S)|` : \"\"}｜(?<str>[^《\\\\n]+)《(?<ruby>[^》\\\\n]+)》|(?:(?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+[ぁ-ヿ]*|[^　｜《》\\\\n])《(?<kan_ruby>[^》\\\\n]+)》)|(?<txt>[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[^｜《》]+?|.)`,\n      \"gs\"\n    );\n  }\n  putTxt(t) {\n    for (const { groups: s } of t.matchAll(o.#n)) {\n      const { ruby: c, kan_ruby: e, kan: r = \"\", ce: i, txt: f = \"\", str: n = \"\" } = s;\n      if (c) {\n        this.putTxtRb(decodeURIComponent(n), c);\n        continue;\n      }\n      if (e) {\n        this.putTxtRb(r, e);\n        continue;\n      }\n      if (i) {\n        this.#t(i.slice(1), \"\");\n        continue;\n      }\n      for (const a of Array.from(f)) this.#t(a, \"\");\n    }\n  }\n  putTxtRb(t, s) {\n    if (/^\\w+｜{\"/.test(s)) {\n      this.#t(t, s);\n      return;\n    }\n    const c = Array.from(t), e = c.length;\n    if (/^\\*.?$/.test(s)) {\n      const n = \"center｜\" + (s === \"*\" ? o.#s : s.charAt(1));\n      for (let a = 0; a < e; ++a) this.#t(c[a], n);\n      return;\n    }\n    if (e === 1 || !s.includes(\" \")) {\n      this.#t(t, decodeURIComponent(s));\n      return;\n    }\n    const r = s.split(\" \"), i = r.length, f = i > e ? i : e;\n    for (let n = 0; n < f; ++n) this.#t(\n      n < e ? c[n] : \"\",\n      n < i ? decodeURIComponent(r[n]) : \"\"\n    );\n  }\n}\n\n//# sourceMappingURL=RubySpliter.js.map\n\n\n//# sourceURL=webpack://gallery/../skynovel/dist/RubySpliter.js?");

/***/ }),

/***/ "../skynovel/dist/ScriptIterator.js":
/*!******************************************!*\
  !*** ../skynovel/dist/ScriptIterator.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ScriptIterator: () => (/* binding */ p)\n/* harmony export */ });\n/* harmony import */ var _web2_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./web2.js */ \"../skynovel/dist/web2.js\");\n/* harmony import */ var _RubySpliter_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./RubySpliter.js */ \"../skynovel/dist/RubySpliter.js\");\n/* harmony import */ var _ReadState_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ReadState.js */ \"../skynovel/dist/ReadState.js\");\n/* harmony import */ var _CmnTween_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./CmnTween.js */ \"../skynovel/dist/CmnTween.js\");\n\n\n\n\nclass w {\n  constructor(t = \"\", s = 0, i = { \":hEvt1Time\": {}, \":hMp\": {}, \":lenIfStk\": 1 }) {\n    this.fn = t, this.idx = s, this.csArg = i;\n  }\n  toString = () => `[fn:${this.fn}, idx:${this.idx}, csArg:${this.csArg}]`;\n}\nclass p {\n  //MARK: コンストラクタ\n  constructor(t, s, i, n, a, h, c) {\n    this.cfg = t, this.hTag = s, this.main = i, this.val = n, this.prpPrs = a, this.sndMng = h, this.sys = c, s.let_ml = (e) => this.#X(e), s.endlet_ml = () => !1, s.dump_stack = () => this.#q(), s.dump_script = (e) => this.#Q(e), s.else = // その他ifブロック開始\n    s.elsif = // 別条件のifブロック開始\n    s.endif = () => this.#Z(), s.if = (e) => this.#tt(e), s.call = (e) => this.#st(e), s.jump = (e) => this.#it(e), s.pop_stack = (e) => this.#et(e), s.return = (e) => this.#j(e), s.bracket2macro = (e) => this.#ut(e), s.char2macro = (e) => this.#pt(e), s.endmacro = (e) => this.#j(e), s.macro = (e) => this.#dt(e), s.load = (e) => this.#kt(e), s.reload_script = (e) => this.#gt(e), s.record_place = () => this.#_t(), s.save = (e) => this.#vt(e), t.oCfg.debug.token && (this.#R = (e) => {\n      e.trim() !== \"\" && console.log(`🌱 トークン fn:${this.#i} idx:${this.#t} ln:${this.#e} token【${e}】`);\n    }), n.defTmp(\"const.sn.aIfStk.length\", () => this.#o.length), n.defTmp(\"const.sn.vctCallStk.length\", () => this.#n.length), this.#c = new _web2_js__WEBPACK_IMPORTED_MODULE_0__.G(t);\n    const f = t.oCfg.init.escape;\n    if (this.#c.setEscape(f), _RubySpliter_js__WEBPACK_IMPORTED_MODULE_1__.R.setEscape(f), _web2_js__WEBPACK_IMPORTED_MODULE_0__.C.isDbg) {\n      c.addHook((o, r) => this.#v[o]?.(r)), this.isBreak = this.#J;\n      const e = this.analyzeInit;\n      this.analyzeInit = () => {\n        this.analyzeInit = () => {\n        }, this.sys.send2Dbg(\"hi\", {});\n      }, this.#v.auth = (o) => {\n        const r = o.hBreakpoint.hFn2hLineBP;\n        for (const [l, u] of Object.entries(r)) this.#L(l, u);\n        p.#p = {};\n        for (const l of o.hBreakpoint.aFunc)\n          p.#p[l.name] = 1;\n        if (o.stopOnEntry) {\n          for (; ; ) {\n            let l = this.nextToken();\n            if (!l) break;\n            const u = l.charCodeAt(0);\n            if (u === 91 || u === 38 || u === 42 && l.length === 1) break;\n            u === 10 && (this.#e += l.length);\n          }\n          this.sys.callHook(\"stopOnEntry\", {}), this.analyzeInit = e, this.analyzeInit();\n        } else\n          this.noticeWait = () => {\n            this.noticeWait = () => {\n            }, this.sys.callHook(\"stopOnEntry\", {});\n          }, this.analyzeInit = e, this.analyzeInit();\n      };\n    } else this.recodeDesign = () => {\n    };\n    t.oCfg.debug.tag && (this.#B = (e) => console.log(`🌲 タグ解析 fn:${this.#i} idx:${this.#t} ln:${this.#e} %c[${e} %o]`, \"background-color:#30B;\", this.#r.hPrm));\n  }\n  #s = { aToken: [\"\"], len: 1, aLNum: [1] };\n  #i = \"\";\n  get scriptFn() {\n    return this.#i;\n  }\n  #t = 0;\n  subIdxToken() {\n    --this.#t;\n  }\n  #e = 0;\n  get lineNum() {\n    return this.#e;\n  }\n  addLineNum = (t) => this.#e += t;\n  jumpJustBefore() {\n    this.#f(this.#i, \"\", --this.#t);\n  }\n  // 直前にジャンプ\n  #n = [];\n  // FILOバッファ（push/pop）\n  #c;\n  #r = new _web2_js__WEBPACK_IMPORTED_MODULE_0__.A();\n  noticeWait = () => {\n  };\n  #L(t, s) {\n    p.#y[this.#g(t)] = s;\n  }\n  destroy() {\n    this.isBreak = () => !1;\n  }\n  #v = {\n    //auth: // constructorで\n    //launch:\t// ここでは冒頭停止に間に合わないのでanalyzeInit()で\n    disconnect: () => {\n      p.#y = {}, p.#p = {}, this.isBreak = () => !1, this.#v.continue({}), this.#h = 0;\n    },\n    restart: () => this.isBreak = () => !1,\n    // ブレークポイント登録\n    add_break: (t) => this.#L(t.fn, t.o),\n    data_break: (t) => {\n      this.#h === 0 && (this.#h = 1, this.main.setLoop(!1, `変数 ${t.dataId}【${t.old_v}】→【${t.new_v}】データブレーク`), this.sys.callHook(\"stopOnDataBreakpoint\", {}), this.sys.send2Dbg(\"stopOnDataBreakpoint\", {}));\n    },\n    set_func_break: (t) => {\n      p.#p = {};\n      for (const s of t.a) p.#p[s.name] = 1;\n      this.sys.send2Dbg(t.ri, {});\n    },\n    // 情報問い合わせ系\n    stack: (t) => this.sys.send2Dbg(t.ri, { a: this.#U() }),\n    eval: (t) => {\n      this.sys.send2Dbg(t.ri, { v: this.prpPrs.parse(t.txt) });\n    },\n    // デバッガからの操作系\n    continue: () => {\n      this.#b() || (this.#t -= this.#_, this.#h = 3, this.main.setLoop(!0), this.main.resume());\n    },\n    stepover: (t) => this.#D(t),\n    stepin: () => {\n      if (this.#b()) return;\n      const t = this.#s.aToken[this.#t - this.#_];\n      this.sys.callHook(`stopOnStep${this.#E.test(t ?? \"\") ? \"In\" : \"\"}`, {}), this.#t -= this.#_, this.#h = this.#h === 1 ? 4 : 5, this.main.setLoop(!0), this.main.resume();\n    },\n    stepout: (t) => {\n      this.#b() || (this.#n.length > 0 ? this.#C(!0) : this.#D(t));\n    },\n    pause: () => {\n      this.#h = 4, this.main.setLoop(!1, \"一時停止\"), this.sys.send2Dbg(\"stopOnStep\", {});\n    },\n    stopOnEntry: () => {\n      this.#h = 4, this.main.setLoop(!1, \"一時停止\"), this.sys.send2Dbg(\"stopOnEntry\", {});\n    }\n  };\n  #k = (t) => this.cfg.searchPath(t, _web2_js__WEBPACK_IMPORTED_MODULE_0__.S.SCRIPT);\n  static #A = /(.+)\\/crypto_prj\\/([^\\/]+)\\/[^\\.]+(\\.\\w+)/;\n  // https://regex101.com/r/Km54EK/1 141 steps (~0ms)\n  #g = (t) => (this.sys.pathBaseCnvSnPath4Dbg + this.#k(t)).replace(p.#A, `$1/prj/$2/${this.#i}$3`);\n  cnvPath4Dbg = (t) => this.sys.pathBaseCnvSnPath4Dbg + t.replace(\"/crypto_prj/\", \"/prj/\");\n  #D(t) {\n    if (this.#b()) return;\n    const s = this.#s.aToken[this.#t - this.#_];\n    this.#E.test(s ?? \"\") ? this.#C(!1) : (this.sys.callHook(\"stopOnStep\", {}), this.#v.stepin(t));\n  }\n  #C(t) {\n    this.sys.callHook(`stopOnStep${t ? \"Out\" : \"\"}`, {}), this.#P = this.#n.length - (t ? 1 : 0), this.#t -= this.#_, this.#h = t ? 7 : 6, this.main.setLoop(!0), this.main.resume();\n  }\n  #P = 0;\n  get #_() {\n    return this.#h === 2 || this.#h === 4 ? 1 : 0;\n  }\n  #b() {\n    return this.#t < this.#s.len ? !1 : (this.sys.callHook(\"stopOnEntry\", {}), this.main.setLoop(!1, \"スクリプト終端です\"), !0);\n  }\n  // reload 再生成 Main に受け渡すため static\n  static #y = {};\n  static #p = {};\n  #h = 0;\n  // https://raw.githubusercontent.com/famibee/SKYNovel-vscode-extension/master/src/doc/BreakStateSMD.pu\n  isBreak = (t) => !1;\n  #J(t) {\n    switch (this.#h) {\n      case 6:\n        this.#T(), this.#h = 7;\n        break;\n      case 7:\n        if (this.#n.length !== this.#P) break;\n        return this.#h = 4, this.main.setLoop(!1, \"ステップ実行\"), this.sys.send2Dbg(\"stopOnStep\", {}), !0;\n      // タグを実行せず、直前停止\n      case 5:\n        this.#T(), this.#h = 4;\n        break;\n      case 4:\n        return this.#T(), this.main.setLoop(!1, \"ステップ実行\"), this.sys.send2Dbg(\"stopOnStep\", {}), !0;\n      // タグを実行せず、直前停止\n      case 3:\n        this.#T(), this.#h = 0;\n        break;\n      default:\n        if ((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.t)(t) in p.#p)\n          return this.#h = 2, this.main.setLoop(!1, `関数 ${t} ブレーク`), this.sys.callHook(\"stopOnBreakpoint\", {}), this.sys.send2Dbg(\"stopOnBreakpoint\", {}), !0;\n        {\n          const s = p.#y[this.#g(this.#i)];\n          if (!s) break;\n          const i = s[this.#e];\n          if (!i) break;\n          if (i.condition) {\n            if (!this.prpPrs.parse(i.condition)) break;\n          } else if (\"hitCondition\" in i && --i.hitCondition > 0) break;\n          const n = this.#h === 0;\n          this.#h = 2, this.main.setLoop(!1, n ? (i.condition ? \"条件\" : \"ヒットカウント\") + \"ブレーク\" : \"ステップ実行\");\n          const a = n ? \"stopOnBreakpoint\" : \"stopOnStep\";\n          this.sys.callHook(a, {}), this.sys.send2Dbg(a, {});\n        }\n        return !0;\n    }\n    return !1;\n  }\n  #T() {\n    const t = p.#y[(0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.#i)]?.[this.#e];\n    t?.hitCondition && --t.hitCondition;\n  }\n  #U() {\n    const t = this.#h === 3 ? 1 : 0, s = this.#s.aToken[this.#t - 1 + t], i = this.#g(this.#i), n = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.t)(s), a = n ? `[${n}]` : s, h = this.val.getVal(\"mp:const.sn.macro\") ?? \"{}\";\n    if (this.#t === 0) return [{ fn: i, ln: 1, col: 1, nm: a, ma: h }];\n    const c = this.#l(this.#s, this.#t), f = [{ fn: i, ln: c.ln, col: c.col_s + 1, nm: a, ma: h }], e = this.#n.length;\n    if (e === 0) return f;\n    for (let o = e - 1; o >= 0; --o) {\n      const r = this.#n[o], l = this.#a[r.fn];\n      if (!l) continue;\n      const u = l.aToken[r.idx - 1];\n      if (!u) continue;\n      const g = this.#l(l, r.idx), _ = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.t)(u);\n      f.push({\n        fn: this.#g(r.fn),\n        ln: g.ln,\n        col: g.col_s + 1,\n        nm: _ ? `[${_}]` : u,\n        ma: r.csArg[\":hMp\"][\"const.sn.macro\"] ?? \"{}\"\n      });\n    }\n    return f;\n  }\n  // result = true : waitする  resume()で再開\n  #B = (t) => {\n  };\n  //MARK: タグ解析\n  タグ解析(t) {\n    const [s, i] = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.h)(t), n = this.hTag[s];\n    if (!n) throw `未定義のタグ【${s}】です`;\n    this.#r.parse(i), this.#B(s);\n    const a = this.#r.hPrm;\n    if (a.cond) {\n      const e = a.cond.val;\n      if (!e || e.startsWith(\"&\")) throw \"属性condは「&」が不要です\";\n      const o = this.prpPrs.parse(e), r = String(o);\n      if (r === \"null\" || r === \"undefined\" || !o) return !1;\n    }\n    let h = {};\n    const c = this.#n.length, f = c === 0 ? {} : this.#n[c - 1].csArg;\n    if (this.#r.isKomeParam) {\n      if (c === 0) throw \"属性「*」はマクロのみ有効です\";\n      h = { ...f };\n    }\n    h[\":タグ名\"] = s;\n    for (const [e, { val: o, def: r }] of Object.entries(a)) {\n      let l = o;\n      if (l?.startsWith(\"%\")) {\n        if (c === 0) throw \"属性「%」はマクロ定義内でのみ使用できます（そのマクロの引数を示す簡略文法であるため）\";\n        const u = f[l.slice(1)];\n        if (u) {\n          h[e] = u;\n          continue;\n        }\n        if (r === void 0 || r === \"null\") continue;\n        l = r;\n      }\n      if (l = this.prpPrs.getValAmpersand(l ?? \"\"), l !== \"undefined\") {\n        h[e] = l;\n        continue;\n      }\n      r !== void 0 && (l = this.prpPrs.getValAmpersand(r), l !== \"undefined\" && (h[e] = l));\n    }\n    return n(h);\n  }\n  #$;\n  #m;\n  setOtherObj(t, s) {\n    this.#$ = t, this.#m = s;\n  }\n  //MARK: インラインテキスト代入\n  #X(t) {\n    const { name: s } = t;\n    if (!s) throw \"nameは必須です\";\n    let i = \"\";\n    const n = this.#s.len;\n    for (; this.#t < n && (i = this.#s.aToken[this.#t], i === \"\"); ++this.#t)\n      ;\n    return t.text = i, t.cast = \"str\", this.hTag.let(t), this.#t += 2, this.#e += (i.match(/\\n/g) ?? []).length, !1;\n  }\n  //MARK: スタックのダンプ\n  #q() {\n    if (this.#t === 0)\n      return console.group(`🥟 [dump_stack] スクリプト現在地 fn:${this.#i} line:1 col:0`), console.groupEnd(), !1;\n    const t = this.#l(this.#s, this.#t), s = `スクリプト現在地 fn:${this.#i} line:${t.ln} col:${t.col_s + 1}`;\n    console.group(`🥟 [dump_stack] ${s}`);\n    const i = this.#n.length;\n    if (i > 0) {\n      console.info(s);\n      for (let n = i - 1; n >= 0; --n) {\n        const a = this.#n[n], h = a.csArg[\":hMp\"], c = h ? h[\":タグ名\"] : void 0, f = a.csArg[\":タグ名\"] ?? \"\", e = this.#l(this.#a[a.fn], a.idx);\n        console.info(\n          `${i - n}つ前のコール元 fn:${a.fn} line:${e.ln} col:${e.col_s + 1}` + (c ? \"（[\" + c + \"]マクロ内）\" : \" \") + `で [${f} ...]をコール`\n        );\n      }\n    }\n    return console.groupEnd(), !1;\n  }\n  #l(t, s) {\n    const i = { ln: 1, col_s: 0, col_e: 0 };\n    if (!t) return i;\n    let n = s - 1;\n    const a = i.ln = t.aLNum[n];\n    for (; t.aLNum[n] === a; ) {\n      if (!t.aToken[n].startsWith(`\n`)) {\n        const h = t.aToken[n].length;\n        i.col_e > 0 && (i.col_s += h), i.col_e += h;\n      }\n      if (--n < 0) break;\n    }\n    return i;\n  }\n  //MARK: 外部へスクリプトを表示\n  #Q(t) {\n    const { set_fnc: s, break_fnc: i } = t;\n    if (!s) throw \"set_fncは必須です\";\n    if (this.#S = globalThis[s], !this.#S) {\n      if ((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"need_err\", !0)) throw `HTML内に関数${s}が見つかりません`;\n      return this.#S = () => {\n      }, !1;\n    }\n    if (this.noticeBreak = (n) => {\n      this.#O !== this.#i && (this.#O = this.#i, this.#S(\n        this.#Y[this.#i] ??= this.#s.aToken.join(\"\")\n      )), this.#w(this.#e, n);\n    }, this.noticeBreak(!0), !i) return !1;\n    if (this.#w = globalThis[i], !this.#w) {\n      if ((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"need_err\", !0)) throw `HTML内に関数${i}が見つかりません`;\n      this.#w = () => {\n      };\n    }\n    return !1;\n  }\n  #S = () => {\n  };\n  #w = () => {\n  };\n  #O = \"\";\n  #Y = {};\n  noticeBreak = (t) => {\n  };\n  #I = 5;\n  dumpErrForeLine() {\n    if (this.#t === 0) {\n      console.group(`🥟 Error line (from 0 rows before) fn:${this.#i}`), console.groupEnd();\n      return;\n    }\n    let t = \"\";\n    for (let h = this.#t - 1; h >= 0 && (t = this.#s.aToken[h] + t, !((t.match(/\\n/g) ?? []).length >= this.#I)); --h)\n      ;\n    const s = t.split(`\n`).slice(-this.#I), i = s.length;\n    console.group(`🥟 Error line (from ${i} rows before) fn:${this.#i}`);\n    const n = String(this.#e).length, a = this.#l(this.#s, this.#t);\n    for (let h = 0; h < i; ++h) {\n      const c = this.#e - i + h + 1, f = `${String(c).padStart(n, \" \")}: %c`, e = s[h], o = e.length > 75 ? e.slice(0, 75) + \"…\" : e;\n      h === i - 1 ? console.info(\n        f + o.slice(0, a.col_s) + \"%c\" + o.slice(a.col_s),\n        \"color: black; background-color: skyblue;\",\n        \"color: black; background-color: pink;\"\n      ) : console.info(f + o, \"color: black; background-color: skyblue;\");\n    }\n    console.groupEnd();\n  }\n  #o = [-1];\n  // 先頭に積む FIFOバッファ（unshift / shift）\n  //MARK: ifブロックの終端\n  #Z() {\n    const t = this.#o[0];\n    if (!t) throw \"this.#aIfStk が異常です\";\n    if (t === -1) throw \"ifブロック内ではありません\";\n    return this.#t = t, this.#o.shift(), !1;\n  }\n  //MARK: ifブロックの開始\n  #tt(t) {\n    const { exp: s } = t;\n    if (!s) throw \"expは必須です\";\n    if (s.startsWith(\"&\")) throw \"属性expは「&」が不要です\";\n    let i = 0, n = this.prpPrs.parse(s) ? this.#t : -1;\n    const a = this.#s.aLNum[this.#t];\n    let h = this.#e - (a || 0);\n    const c = this.#s.len;\n    for (; this.#t < c; ++this.#t) {\n      const f = this.#s.aLNum[this.#t];\n      this.#s.aLNum[this.#t] = (f || 0) + h;\n      const e = this.#s.aToken[this.#t];\n      if (!e) continue;\n      const o = e.charCodeAt(0);\n      if (o === 10) {\n        this.#e += e.length;\n        continue;\n      }\n      if (o !== 91) continue;\n      const [r, l] = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.h)(e);\n      if (!(r in this.hTag)) throw `未定義のタグ[${r}]です`;\n      switch (this.#r.parse(l), r) {\n        case \"if\":\n          ++i;\n          break;\n        case \"elsif\":\n          if (i > 0 || n > -1) break;\n          const u = this.#r.hPrm.exp?.val;\n          if (!u) throw \"expは必須です\";\n          if (u.startsWith(\"&\")) throw \"属性expは「&」が不要です\";\n          this.prpPrs.parse(u) && (n = this.#t + 1);\n          break;\n        case \"else\":\n          if (i > 0) break;\n          n === -1 && (n = this.#t + 1);\n          break;\n        case \"endif\":\n          if (i > 0) {\n            --i;\n            break;\n          }\n          return n === -1 ? (++this.#t, this.#s.aLNum[this.#t] += h) : (this.#o.unshift(this.#t + 1), this.#t = n, this.#e = this.#s.aLNum[this.#t]), !1;\n      }\n    }\n    throw \"[endif]がないままスクリプト終端です\";\n  }\n  //MARK: サブルーチンコール\n  #st(t) {\n    (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"count\", !1) || this.#K();\n    const { fn: s } = t;\n    return s && this.#k(s), this.#M({ ...t, \":hEvt1Time\": this.#$.popLocalEvts() }), (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"clear_local_event\", !1) && this.hTag.clear_event({}), this.#f(s, t.label);\n  }\n  #M(t) {\n    const s = { ...t, \":hMp\": this.val.cloneMp(), \":lenIfStk\": this.#o.length };\n    this.#s.aLNum[this.#t] = this.#e, this.#W || (s[\":resvToken\"] = \"\", this.#x()), this.#n.push(new w(this.#i, this.#t, s)), this.#o.unshift(-1);\n  }\n  //MARK: シナリオジャンプ\n  #it(t) {\n    return (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"count\", !0) || this.#K(), this.#o[0] = -1, this.#f(t.fn, t.label);\n  }\n  //MARK: コールスタック破棄\n  #et(t) {\n    if ((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"clear\", !1)) this.#n = [];\n    else if (!this.#n.pop()) throw \"[pop_stack] スタックが空です\";\n    return this.#x(), this.#o = [-1], this.val.setMp({}), !1;\n  }\n  //MARK: サブルーチンから戻る\n  #j(t) {\n    const s = this.#n.pop();\n    if (!s) throw \"[return] スタックが空です\";\n    const i = s.csArg;\n    this.#o = this.#o.slice(-i[\":lenIfStk\"]);\n    const n = i[\":hMp\"];\n    n && this.val.setMp(n);\n    const a = i[\":resvToken\"];\n    a ? this.nextToken = () => (this.#x(), a) : this.#x(), i[\":hEvt1Time\"] && this.#$.pushLocalEvts(i[\":hEvt1Time\"]);\n    const { fn: h, label: c } = t;\n    return h || c ? this.#f(h, c) : s.fn in this.#a ? (this.#z(s), !1) : this.#f(s.fn, \"\", s.idx);\n  }\n  #W = \"\";\n  #x() {\n    this.#W = \"\", this.nextToken = this.#F;\n  }\n  #N = \"\";\n  #f(t = \"\", s = \"\", i = 0) {\n    if (!t && !s && this.main.errScript(\"[jump系] fnまたはlabelは必須です\"), s ? (s.startsWith(\"*\") || this.main.errScript(\"[jump系] labelは*で始まります\"), this.#N = s, this.#N.startsWith(\"**\") || (this.#t = i)) : (this.#N = \"\", this.#t = i), !t)\n      return this.analyzeInit(), !1;\n    if (t.includes(\"@\")) throw \"[jump系] fn には文字「@」は禁止です\";\n    const n = this.#k(t);\n    if (t === this.#i)\n      return this.analyzeInit(), !1;\n    this.#i = t;\n    const a = this.#a[t];\n    if (a)\n      return this.#s = a, this.analyzeInit(), !1;\n    (0,_ReadState_js__WEBPACK_IMPORTED_MODULE_2__.d)();\n    const h = new _web2_js__WEBPACK_IMPORTED_MODULE_0__.L();\n    let c = \"\";\n    try {\n      c = this.#k(t + \"@\"), h.add({ name: t + \":base\", url: n }), h.add({ name: t, url: c });\n    } catch {\n      h.add({ name: t, url: n });\n    }\n    return h.use(async (f, e) => {\n      try {\n        f.data = await this.sys.dec(f.extension, f.data);\n      } catch (o) {\n        this.main.errScript(`[jump系]snロード失敗です fn:${f.name} ${o}`, !1);\n      }\n      e();\n    }).load((f, e) => {\n      if (c) {\n        const o = e[t + \":base\"].data, r = e[t].data, l = o.split(`\n`), u = r.split(`\n`), g = l.length, _ = u.length;\n        for (let k = 0; k < _ && k < g; ++k) u[k] ||= l[k];\n        e[t].data = u.join(`\n`), delete e[t + \":base\"];\n      }\n      this.nextToken = this.#F, this.#e = 1, this.#ot(e[t].data), this.hTag.record_place({}), this.analyzeInit(), (0,_ReadState_js__WEBPACK_IMPORTED_MODULE_2__.e)();\n    }), !0;\n  }\n  analyzeInit() {\n    const t = this.#at(this.#s, !!this.val.getVal(\"mp:const.sn.macro.name\"), this.#e, this.#N, this.#t);\n    this.#t = t.idx, this.#e = t.ln;\n  }\n  // シナリオ解析処理ループ・冒頭処理\n  nextToken = () => \"\";\n  // 初期化前に終了した場合向け\n  #F() {\n    if (this.#H()) return \"\";\n    this.#ft(), this.#s.aLNum[this.#t] ||= this.#e;\n    const t = this.#s.aToken[this.#t];\n    return this.#R(t), ++this.#t, t;\n  }\n  #R = (t) => {\n  };\n  #H() {\n    return this.#t < this.#s.len ? !1 : (this.main.errScript(\"スクリプト終端です\"), !0);\n  }\n  #nt = /(\\*{2,})([^\\|]*)/;\n  #ht = /^\\[macro\\s/;\n  #V = /^\\[endmacro[\\s\\]]/;\n  #at(t, s, i, n, a) {\n    const h = t.aToken.length;\n    if (!n) {\n      if (this.#H()) return { idx: a, ln: i };\n      if (t.aLNum[a])\n        i = t.aLNum[a];\n      else {\n        i = 1;\n        for (let o = 0; o < a; ++o) {\n          t.aLNum[o] ||= i;\n          const r = t.aToken[o];\n          r.startsWith(`\n`) ? i += r.length : i += (r.match(/\\n/g) ?? []).length;\n        }\n        t.aLNum[a] = i;\n      }\n      return { idx: a, ln: i };\n    }\n    t.aLNum[0] = 1;\n    const c = n.match(this.#nt);\n    if (c) {\n      n = c[1];\n      let o = a;\n      switch (c[2]) {\n        case \"before\":\n          for (; t.aToken[--o] !== n; )\n            o === 0 && _web2_js__WEBPACK_IMPORTED_MODULE_0__.D.myTrace(\"[jump系 無名ラベルbefore] \" + i + \"行目以前で\" + (s ? \"マクロ内に\" : \"\") + \"ラベル【\" + n + \"】がありません\", \"ET\"), s && t.aToken[o].search(this.#ht) > -1 && _web2_js__WEBPACK_IMPORTED_MODULE_0__.D.myTrace(\"[jump系 無名ラベルbefore] マクロ内にラベル【\" + n + \"】がありません\", \"ET\");\n          return { idx: o + 1, ln: t.aLNum[o] };\n        //\tbreak;\n        case \"after\":\n          for (; t.aToken[++o] !== n; )\n            o === h && _web2_js__WEBPACK_IMPORTED_MODULE_0__.D.myTrace(\"[jump系 無名ラベルafter] \" + i + \"行目以後でマクロ内にラベル【\" + n + \"】がありません\", \"ET\"), t.aToken[o].search(this.#V) > -1 && _web2_js__WEBPACK_IMPORTED_MODULE_0__.D.myTrace(\"[jump系 無名ラベルafter] \" + i + \"行目以後でマクロ内にラベル【\" + n + \"】がありません\", \"ET\");\n          return { idx: o + 1, ln: t.aLNum[o] };\n        //\tbreak;\n        default:\n          _web2_js__WEBPACK_IMPORTED_MODULE_0__.D.myTrace(\"[jump系] 無名ラベル指定【label=\" + n + \"】が間違っています\", \"ET\");\n      }\n    }\n    i = 1;\n    const f = new RegExp(\n      \"^\" + n.replaceAll(\"*\", \"\\\\*\") + \"(?=\\\\s|;|\\\\[|\\\\||$)\"\n    );\n    let e = !1;\n    for (let o = 0; o < h; ++o) {\n      t.aLNum[o] ||= i;\n      const r = t.aToken[o];\n      if (e) {\n        this.#c.testTagEndLetml(r) ? e = !1 : i += (r.match(/\\n/g) ?? []).length;\n        continue;\n      }\n      const l = r.charCodeAt(0);\n      if (l === 10) {\n        i += r.length;\n        continue;\n      }\n      if (l === 42) {\n        if (r.search(f) > -1) return { idx: o + 1, ln: i };\n        continue;\n      }\n      l === 91 && (i += (r.match(/\\n/g) ?? []).length, this.#c.testTagLetml(r) && (e = !0));\n    }\n    throw e ? \"[let_ml]の終端・[endlet_ml]がありません\" : (_web2_js__WEBPACK_IMPORTED_MODULE_0__.D.myTrace(`[jump系] ラベル【${n}】がありません`, \"ET\"), \"Dummy\");\n  }\n  #a = /* @__PURE__ */ Object.create(null);\n  //{} シナリオキャッシュ\n  #ot(t) {\n    let s = \"\";\n    try {\n      s = \"ScriptIterator.resolveScript\";\n      const i = this.#c.resolveScript(t);\n      s = \"ScriptIterator.replaceScript_Wildcard\", this.#lt(i), this.#a[this.#i] = this.#s = i;\n    } catch (i) {\n      i instanceof Error ? s += `例外 mes=${i.message}(${i.name})` : s = String(i), this.main.errScript(s, !1);\n    }\n    this.val.touchAreaKidoku(this.#i);\n  }\n  #z(t) {\n    this.#i = t.fn, this.#t = t.idx;\n    const s = this.#a[this.#i];\n    s && (this.#s = s), this.#e = this.#s.aLNum[t.idx];\n  }\n  #rt = /^\\[(call|loadplugin)\\s/;\n  #ct = /\\bfn\\s*=\\s*[^\\s\\]]+/;\n  #lt(t) {\n    for (let s = t.len - 1; s >= 0; --s) {\n      const i = t.aToken[s];\n      if (!this.#rt.test(i)) continue;\n      const [n, a] = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.h)(i);\n      this.#r.parse(a);\n      const h = this.#r.hPrm.fn;\n      if (!h) continue;\n      const { val: c } = h;\n      if (!c || !c.endsWith(\"*\")) continue;\n      t.aToken.splice(s, 1, \"\t\", \"; \" + i), t.aLNum.splice(s, 1, NaN, NaN);\n      const f = n === \"loadplugin\" ? _web2_js__WEBPACK_IMPORTED_MODULE_0__.S.CSS : _web2_js__WEBPACK_IMPORTED_MODULE_0__.S.SN, e = this.cfg.matchPath(\"^\" + c.slice(0, -1) + \".*\", f);\n      for (const o of e) {\n        const r = i.replace(\n          this.#ct,\n          \"fn=\" + decodeURIComponent((0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.f)(o[f]))\n        );\n        t.aToken.splice(s, 0, r), t.aLNum.splice(s, 0, NaN);\n      }\n    }\n    t.len = t.aToken.length;\n  }\n  #ft() {\n    const t = this.val.touchAreaKidoku(this.#i);\n    if (this.#n.length > 0) {\n      t.record(this.#t);\n      return;\n    }\n    this.#d = t.search(this.#t), this.val.setVal_Nochk(\"tmp\", \"const.sn.isKidoku\", this.#d), !this.#d && t.record(this.#t);\n  }\n  #d = !1;\n  get isKidoku() {\n    return this.#d;\n  }\n  #K() {\n    this.val.getAreaKidoku(this.#i)?.erase(this.#t), this.#d = !1;\n  }\n  get isNextKidoku() {\n    let t = this.#i, s = this.#t, i = this.#s.len;\n    if (this.#n.length > 0) {\n      const a = this.#n[0];\n      t = a.fn, s = a.idx;\n      const h = this.#a[t];\n      h && (i = h.len);\n    }\n    const n = this.val.getAreaKidoku(t);\n    return s === i ? !1 : n.search(s);\n  }\n  get normalWait() {\n    return this.#d ? this.val.tagCh_doWait_Kidoku ? this.val.tagCh_msecWait_Kidoku : 0 : this.val.tagCh_doWait ? this.val.tagCh_msecWait : 0;\n  }\n  //MARK: 括弧マクロの定義\n  #ut(t) {\n    return this.#c.bracket2macro(t, this.hTag, this.#s, this.#t), !1;\n  }\n  //MARK: 一文字マクロの定義\n  #pt(t) {\n    return this.#c.char2macro(t, this.hTag, this.#s, this.#t), !1;\n  }\n  //MARK: マクロ定義の開始\n  #mt = /[\"'#;\\\\]　]+/;\n  #dt(t) {\n    const { name: s } = t;\n    if (!s) throw \"nameは必須です\";\n    if (s in this.hTag) throw `[${s}]はタグかすでに定義済みのマクロです`;\n    if (this.#mt.test(s)) throw `[${s}]はマクロ名として異常です`;\n    const i = this.#e, n = new w(this.#i, this.#t);\n    for (this.#G += \"|\" + s, this.#E = new RegExp(`\\\\[(${this.#G})\\\\b`), this.hTag[s] = (a) => (a.design_unit = t.design_unit, this.#M(a), this.val.setMp(a), this.val.setVal_Nochk(\"mp\", \"const.sn.macro\", JSON.stringify({\n      name: t.name\n    })), this.val.setVal_Nochk(\"mp\", \"const.sn.me_call_scriptFn\", this.#i), this.#e = i, this.#z(n), !1); this.#t < this.#s.len; ++this.#t) {\n      this.#s.aLNum[this.#t] ||= this.#e;\n      const a = this.#s.aToken[this.#t];\n      if (a.search(this.#V) > -1)\n        return ++this.#t, !1;\n      const h = a.charCodeAt(0);\n      h === 10 ? this.#e += a.length : h === 91 && (this.#e += (a.match(/\\n/g) ?? []).length);\n    }\n    throw `マクロ[${s}]定義の終端・[endmacro]がありません`;\n  }\n  #G = \"call\";\n  #E = /\\[(call)\\b/;\n  // https://regex101.com/r/Lk9ASK/1\n  //MARK: しおりの読込\n  #kt(t) {\n    if (\"fn\" in t != \"label\" in t) throw \"fnとlabelはセットで指定して下さい\";\n    const s = (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.b)(t, \"place\", 0), i = this.val.getMark(s);\n    return this.loadFromMark(\n      t,\n      i,\n      2\n      /* ALL_STOP_AND_PLAY */\n    );\n  }\n  loadFromMark(t, s, i = 0) {\n    this.hTag.clear_event({}), this.val.mark2save(s), this.val.setMp({}), this.#m.recPagebreak();\n    let n = [];\n    i !== 1 && (n = this.sndMng.playLoopFromSaveObj(\n      i === 2\n      /* ALL_STOP_AND_PLAY */\n    )), (0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.a)(t, \"do_rec\", !0) && (this.#u = {\n      hSave: this.val.cloneSave(),\n      hPages: { ...s.hPages },\n      aIfStk: [...s.aIfStk]\n    });\n    const a = {\n      enabled: this.val.getVal(\"save:const.sn.autowc.enabled\"),\n      text: this.val.getVal(\"save:const.sn.autowc.text\"),\n      time: Number(this.val.getVal(\"save:const.sn.autowc.time\"))\n    };\n    this.hTag.autowc(a), this.#o = [...this.#u.aIfStk], this.#n = [], _CmnTween_js__WEBPACK_IMPORTED_MODULE_3__.C.stopAllTw();\n    const h = Promise.allSettled([...n, ...this.#m.playback(this.#u.hPages)]).then(() => this.#m.cover(!1)).catch((l) => console.error(\"fn:ScriptIterator.ts loadFromMark e:%o\", l)), { index: c, fn: f } = t;\n    if (c)\n      return h.then(() => this.#f(f, \"\", c)), !0;\n    this.#m.cover(!0), (0,_ReadState_js__WEBPACK_IMPORTED_MODULE_2__.d)();\n    const e = String(this.val.getVal(\"save:const.sn.scriptFn\")), o = Number(this.val.getVal(\"save:const.sn.scriptIdx\"));\n    delete this.#a[e];\n    const { label: r } = t;\n    return r ? h.then(() => {\n      this.#i = e, this.#t = o, this.hTag.call({ fn: f, label: r });\n    }) : h.then(() => this.#f(e, \"\", o)), !0;\n  }\n  //MARK: スクリプト再読込\n  #gt(t) {\n    const s = this.val.getMark(0);\n    delete this.#a[(0,_web2_js__WEBPACK_IMPORTED_MODULE_0__.f)(s.hSave[\"const.sn.scriptFn\"])];\n    const i = {};\n    for (const n in this.#a)\n      try {\n        this.#k(n + \"@\");\n      } catch {\n        i[n] = this.#a[n];\n      }\n    return this.#a = i, t.do_rec = !1, this.loadFromMark(\n      t,\n      s,\n      1\n      /* NO_TOUCH */\n    );\n  }\n  //MARK: セーブポイント指定\n  #u = {\n    hSave: {},\n    hPages: {},\n    aIfStk: [-1]\n  };\n  #_t() {\n    if (this.main.isDestroyed()) return !1;\n    const { fn: t, idx: s } = this.nowScrIdx();\n    return this.val.setVal_Nochk(\"save\", \"const.sn.scriptFn\", t), this.val.setVal_Nochk(\"save\", \"const.sn.scriptIdx\", s), this.#u = {\n      hSave: this.val.cloneSave(),\n      hPages: this.#m.record(),\n      aIfStk: this.#o.slice(this.#n.length)\n    }, !1;\n  }\n  nowScrIdx() {\n    if (this.#n.length === 0) return {\n      fn: this.#i,\n      idx: this.#t\n    };\n    const s = this.#n[0];\n    return {\n      fn: s.fn,\n      idx: s.idx\n    };\n  }\n  nowMark() {\n    return { ...this.#u };\n  }\n  //MARK: スクリプト停止位置（マクロなどなら最上位の呼び元）\n  nowScrFnLn() {\n    const { fn: t, idx: s } = this.nowScrIdx(), i = this.#a[t], n = this.#l(i, s);\n    return { fn: t, ...n };\n  }\n  //MARK: しおりの保存\n  #vt(t) {\n    if (!(\"place\" in t)) throw \"placeは必須です\";\n    const s = Number(t.place);\n    delete t[\":タグ名\"], delete t.place, t.text = t.text ?? \"\", this.#u.json = t, this.val.setMark(s, this.#u);\n    const i = Number(this.val.getVal(\"sys:const.sn.save.place\"));\n    return s === i && this.val.setVal_Nochk(\"sys\", \"const.sn.save.place\", i + 1), !1;\n  }\n  recodeDesign(t) {\n    let s = \"\", i = 0;\n    const n = this.#n.length;\n    if (t.design_unit && n > 0) {\n      const f = this.#n[0];\n      s = f.fn, i = f.idx;\n    } else\n      s = this.#i, i = this.#t;\n    t[\":path\"] = this.#g(s);\n    const a = this.#a[s], h = this.#l(a, i);\n    t[\":ln\"] = h.ln, t[\":col_s\"] = h.col_s, t[\":col_e\"] = h.col_e;\n    const c = i - 1;\n    t[\":idx_tkn\"] = c, t[\":token\"] = a.aToken[c], this.sys.send2Dbg(\"_recodeDesign\", t);\n  }\n  replace(t, s) {\n    this.#s.aToken[t] = s;\n  }\n}\n\n//# sourceMappingURL=ScriptIterator.js.map\n\n\n//# sourceURL=webpack://gallery/../skynovel/dist/ScriptIterator.js?");

/***/ })

}]);