"use strict";(self.webpackChunkgallery=self.webpackChunkgallery||[]).push([[365,746],{8746:(t,s,e)=>{e.r(s),e.d(s,{Variable:()=>h});var i=e(4449),o=e(9904),n=e(3653);class a{hAreas=Object.create(null);clear(){this.hAreas={}}search(t){return Object.entries(this.hAreas).some((([s,e])=>t>=parseInt(s)&&t<=e))}record(t){if(!this.search(t)){for(const[s,e]of Object.entries(this.hAreas))if(e+1===t)return void(String(t+1)in this.hAreas?(this.hAreas[s]=this.hAreas[t+1],delete this.hAreas[t+1]):this.hAreas[s]=t);if(String(t+1)in this.hAreas)return this.hAreas[t]=this.hAreas[t+1],void delete this.hAreas[t+1];this.hAreas[t]=t}}erase(t){if(this.search(t)){if(String(t)in this.hAreas)return this.hAreas[t]>t&&(this.hAreas[t+1]=this.hAreas[t]),void delete this.hAreas[t];for(const[s,e]of Object.entries(this.hAreas))if(!(t<parseInt(s)||e<t))return this.hAreas[s]===t||(this.hAreas[t+1]=e),void(this.hAreas[s]=t-1)}}get count(){return Object.keys(this.hAreas).length}toString(){let t="";for(const s of Object.keys(this.hAreas).map((t=>parseInt(t))).sort(((t,s)=>t-s)))t+=s===this.hAreas[s]?","+s:","+s+"~"+this.hAreas[s];return t}}class h{constructor(t,s){if(this.cfg=t,s.let=t=>this.#t(t),s.let_abs=t=>this.#s(t),s.let_char_at=t=>this.#e(t),s.let_index_of=t=>this.#i(t),s.let_length=t=>this.#o(t),s.let_replace=t=>this.#n(t),s.let_round=t=>this.#a(t),s.let_search=t=>this.#h(t),s.let_substr=t=>this.#r(t),s.clearsysvar=()=>this.#c(),s.clearvar=()=>this.#g(),s.dump_val=()=>this.#l(),s.copybookmark=t=>this.#f(t),s.erasebookmark=t=>this.#u(t),this.#k["sn.userFnTail"]="",this.defTmp("const.sn.bookmark.json",(()=>{const t=[];for(const s of Object.keys(this.#d.mark).sort()){const e={...this.#d.mark[s].json};e.place=s,t.push(e)}return JSON.stringify(t)})),this.#m["const.sn.isFirstBoot"]=!0,this.#m["const.sn.last_page_text"]="",this.#m["const.sn.last_page_plain_text"]="",this.#m["const.sn.displayState"]=!1,this.#m["const.Date.getTime"]=()=>(new Date).getTime(),this.#m["const.Date.getDateStr"]=()=>(0,i.g)(),this.#m["const.sn.platform"]=JSON.stringify(i.p),this.#c(!0),this.#g(),this.#m["const.sn.config.window.width"]=t.oCfg.window.width,this.#m["const.sn.config.window.height"]=t.oCfg.window.height,this.#m["const.sn.config.book.title"]=t.oCfg.book.title,this.#m["const.sn.config.book.version"]=t.oCfg.book.version,this.#m["const.sn.Math.PI"]=Math.PI,this.#m["const.sn.isPaging"]=!1,typeof window>"u")return;const e=window,o=e.AudioContext??e.webkitAudioContext;this.#m["const.sn.needClick2Play"]=()=>"suspended"===(new o).state}#p={sys:{},save:{},tmp:{},mp:{}};#k=this.#p.save;#m=this.#p.tmp;#y;#d={sys:{},mark:{},kidoku:{}};#_;#b={};#w;async setSys(t){this.#y=t,await t.initVal(this.#d,this.#m,(s=>{this.updateData(s),sessionStorage.clear();const e=this.cfg.getNs();this.#v=this.cfg.oCfg.debug.variable?()=>{const s={};for(const[t,e]of Object.entries(this.#_))s["sys:"+t]=e instanceof Function?e():e;sessionStorage[e+"sys"]=JSON.stringify(s);const i={};for(const[t,s]of Object.entries(this.#k))i["save:"+t]=s instanceof Function?s():s;sessionStorage[e+"save"]=JSON.stringify(i);const o={};for(const[t,s]of Object.entries(this.#m))o[t]=s instanceof Function?s():s;sessionStorage[e+"tmp"]=JSON.stringify(o);const n={};for(const[t,s]of Object.entries(this.#p.mp))n[t]=s instanceof Function?s():s;sessionStorage[e+"mp"]=JSON.stringify(n);const a={};for(const[t,s]of Object.entries(this.#d.mark))a[t]=s instanceof Function?s():s;sessionStorage[e+"mark"]=JSON.stringify(a);const h={};for(const[t,s]of Object.entries(this.#d.kidoku))h[t]=s instanceof Function?s():s;sessionStorage[e+"kidoku"]=JSON.stringify(h),t.flush()}:()=>t.flush(),this.#w=(s,e)=>t.callHook(s,e),t.addHook(((t,s)=>this.#N[t]?.(t,s)));const i=this.getVal("sys:sn.tagCh.msecWait",-1);(this.#m["const.sn.isFirstBoot"]||-1===i)&&this.#c(!0),this.#S=this.getVal("sys:sn.tagCh.doWait"),this.#V=this.getVal("sys:sn.tagCh.doWait_Kidoku"),this.#C=this.getVal("sys:sn.tagCh.msecWait"),this.#x=this.getVal("sys:sn.tagCh.msecWait_Kidoku"),this.#A()}))}#A(){(0,n.p)(this.getVal("sys:const.sn.aPageLog")??"[]",this.getVal("save:const.sn.styPaging")??n.I)}#N={auth:(t,s)=>this.#O(s.hBreakpoint.aData),var:(t,s)=>this.#y.send2Dbg(s.ri,{v:this.#p[s.scope]??{}}),set_var:(t,s)=>{try{this.#j(s.nm,s.val),this.#y.send2Dbg(s.ri,{})}catch{}},set_data_break:(t,s)=>{this.#O(s.a),this.#y.send2Dbg(s.ri,{})},disconnect:t=>h.#W={}};#O(t){h.#W={};for(const s of t)h.#W[s.dataId]=1}updateData(t){this.#d=t,this.#_=this.#p.sys=this.#d.sys,this.#b={};for(const[t,s]of Object.entries(this.#d.kidoku)){const e=new a;e.hAreas={...s},this.#b[t]=e}}#v=()=>{};flush(){this.#v()}setDoRecProc(t){this.#P=t}#P=t=>{};defTmp(t,s){this.#m[t]=s}cloneMp(){return{...this.#p.mp}}setMp(t){this.#p.mp=t}setMark(t,s){this.#d.mark[t]=s,this.flush()}getMark=t=>{const s=this.#d.mark[t];if(!s)throw`place【${t}】は存在しません`;return s};cloneSave(){return{...this.#p.save}}mark2save(t){this.#k=this.#p.save={...t.hSave},this.#K=this.#k["sn.doRecLog"]??!1}touchAreaKidoku(t){return this.#b[t]??=new a}getAreaKidoku=t=>{const s=this.#b[t];if(!s)throw`hAreaKidoku${t}】は存在しません`;return s};saveKidoku(){for(const[t,{hAreas:s}]of Object.entries(this.#b))this.#d.kidoku[t]={...s};this.flush()}#f(t){if(!("from"in t))throw"fromは必須です";if(!("to"in t))throw"toは必須です";const s=Number(t.from),e=Number(t.to);if(s===e)return!1;const i=this.#d.mark[s];if(!i)throw`from:${s} のセーブデータは存在しません`;return this.setMark(e,{...i}),this.#y.copyBMFolder(s,e),!1}#u(t){const{place:s}=t;if(!s)throw"placeは必須です";return delete this.#d.mark[s],this.flush(),this.#y.eraseBMFolder(s),!1}#t(t){if(!t.name)throw"nameは必須です";let s=!0;if(t.cast)switch(t.cast){case"num":(0,i.b)(t,"text",NaN);break;case"int":t.text=String((0,i.i)((0,i.b)(t,"text",NaN)));break;case"uint":t.text=String((0,i.u)((0,i.b)(t,"text",NaN)));break;case"bool":(0,i.a)(t,"text",!1);break;case"str":s=!1;break;default:throw"cast【"+t.cast+"】は未定義です"}return this.#j(t.name,t.text,s),!1}#s(t){const s=(0,i.b)(t,"text",0);return t.text=String(s<0?-s:s),this.#t(t),!1}#e(t){return t.text=(t.text??"").charAt((0,i.b)(t,"pos",0)),this.#t(t),!1}#i(t){const{val:s}=t;if(!s)throw"valは必須です";const e=(0,i.b)(t,"start",0);return t.text=String((t.text??"").indexOf(s,e)),this.#t(t),!1}#o(t){return t.text=String((t.text??"").length),this.#t(t),!1}#n(t){if(!t.reg)throw"regは必須です";const{flags:s}=t,e=s?new RegExp(t.reg,s):new RegExp(t.reg);return t.text=String(t.text??"").replace(e,String(t.val)),this.#t(t),!1}#a(t){const s=(0,i.b)(t,"text",0);return t.text=String(Math.round(s)),this.#t(t),!1}#h(t){if(!t.reg)throw"regは必須です";const{flags:s}=t,e=s?new RegExp(t.reg,s):new RegExp(t.reg);return t.text=String((t.text??"").search(e)),this.#t(t),!1}#r(t){const s=(0,i.b)(t,"pos",0);return t.text="all"!==t.len?(t.text??"").slice(s,s+(0,i.i)((0,i.b)(t,"len",1))):(t.text??"").slice(s),this.#t(t),!1}#c(t=!1){const s=this.#_=this.#p.sys=this.#d.sys={};typeof process<"u"||(this.setVal_Nochk("sys","const.sn.window.x",0),this.setVal_Nochk("sys","const.sn.window.y",0)),this.setVal_Nochk("sys","sn.tagCh.doWait",!0),this.setVal_Nochk("sys","sn.tagCh.doWait_Kidoku",!0),this.setVal_Nochk("sys","sn.tagCh.msecWait",this.cfg.oCfg.init.tagch_msecwait),this.setVal_Nochk("sys","sn.tagCh.msecWait_Kidoku",this.cfg.oCfg.init.tagch_msecwait),this.setVal_Nochk("sys","sn.tagCh.canskip",!0),this.setVal_Nochk("sys","sn.skip.mode","s"),this.setVal_Nochk("sys","sn.auto.msecPageWait",(0,i.b)(s,"sn.auto.msecPageWait",this.cfg.oCfg.init.auto_msecpagewait??3500)),this.setVal_Nochk("sys","sn.auto.msecPageWait_Kidoku",(0,i.b)(s,"sn.auto.msecPageWait",this.cfg.oCfg.init.auto_msecpagewait??3500)),this.setVal_Nochk("sys","sn.auto.msecLineWait",500),this.setVal_Nochk("sys","sn.auto.msecLineWait_Kidoku",500),this.setVal_Nochk("sys","sn.sound.BGM.vol_mul_talking",1),this.setVal_Nochk("sys","const.sn.sound.BGM.volume",1),this.setVal_Nochk("sys","const.sn.sound.SE.volume",1),this.setVal_Nochk("sys","const.sn.sound.SYS.volume",1);for(const[t,s]of Object.entries(this.#d.kidoku))s.hAreas={},this.#b[t]?.clear();return this.setVal_Nochk("sys","TextLayer.Back.Alpha",.5),this.#p.mark=this.#d.mark={},this.setVal_Nochk("sys","const.sn.save.place",1),this.setVal_Nochk("sys","const.sn.aPageLog","[]"),t||this.#A(),this.flush(),!1}#g(){const t=this.#k["const.sn.mesLayer"]??"",s=this.#k["sn.doRecLog"]??!1,e=this.#k["const.sn.sLog"]??"[]",i=this.#k["const.sn.styPaging"]??n.I;return this.#k=this.#p.save={},this.setVal_Nochk("save","const.sn.mesLayer",t),this.setVal_Nochk("save","sn.doRecLog",s),this.setVal_Nochk("save","const.sn.sLog",e),this.setVal_Nochk("save","const.sn.styPaging",i),!1}#j=(t,s,e=!0)=>{if(!t)throw"[変数に値セット] nameは必須です";if(null==s)throw"[変数に値セット] textは必須です（空文字はOK）";const i=o.PropParser.getValName(t);if(!i)throw"[変数参照] name("+t+")が変数名として異常です";const n=this.#p[i.scope];if(!n)throw"[変数に値セット] scopeが異常【"+i.scope+"】です";const a=i.name;if(a.startsWith("const.")&&a in n)throw"[変数に値セット] 変数【"+a+"】は書き換え不可です";this.setVal_Nochk(i.scope,a,s,e)};setVal_Nochk(t,s,e,i=!1){const o=this.#p[t];i&&(e=this.#F(e));const n=t+":"+s;if(n in h.#W){const t=o[s],i=e;t!=i&&this.#w("data_break",{dataId:n,old_v:t,new_v:i})}o[s]=e,this.#L[n]?.(s,e)}static#W={};getVal=(t,s)=>{if(!t)throw"[変数参照] nameは必須です";const e=o.PropParser.getValName(t);if(!e)throw"[変数参照] name("+t+")が変数名として異常です";const i=this.#p[e.scope];if(!i)throw"[変数参照] scopeが異常【"+e.scope+"】です";const n=e.name;let a=i[n];if(!(n in i)){a=s;let t="";const e=n.split("."),o=e.length;for(let n=0;n<o;++n,t+="."){if(t+=e[n],!(t in i))continue;let h=JSON.parse(i[t]);if("[object Object]"!==Object.prototype.toString.call(h)){if(n+1===o){a=h;break}continue}let r=n;for(;++r<o;){const t=e[r];if(!(t in h)){a=s;break}if(h=h[t],"[object Object]"!==Object.prototype.toString.call(h)||r+1===o){a=h;break}}a instanceof Object&&(a=JSON.stringify(a));break}}return a instanceof Function&&(a=a()),"@str"===e.at?a:this.#F(a)};#F(t){const s=t;return"true"===s||"false"!==s&&("null"===s?null:"undefined"!==s?this.#M.test(s)?parseFloat(s):t:void 0)}#M=/^-?[\d\.]+$/;#l=()=>{const t={tmp:{},sys:{},save:{},mp:{}};for(let s in t){const e=this.#p[s],i=t[s];for(let[t,s]of Object.entries(e))i[t]="[object Function]"===Object.prototype.toString.call(s)?s():s}return console.info("🥟 [dump_val]",t),!1};#K=!1;doRecLog(){return this.#K}#S=!1;get tagCh_doWait(){return this.#S}#V=!1;get tagCh_doWait_Kidoku(){return this.#V}#C=0;get tagCh_msecWait(){return this.#C}#x=0;get tagCh_msecWait_Kidoku(){return this.#x}#L={"sys:sn.tagCh.doWait":t=>{this.#S=this.#D(t)},"sys:sn.tagCh.doWait_Kidoku":t=>{this.#V=this.#D(t)},"sys:sn.tagCh.msecWait":t=>{this.#C=this.#I(t)},"sys:sn.tagCh.msecWait_Kidoku":t=>{this.#x=this.#J(t)},"sys:sn.tagCh.canskip":t=>this.#D(t),"sys:sn.auto.msecPageWait":t=>this.#R(t),"sys:sn.auto.msecPageWait_Kidoku":t=>this.#R(t),"sys:sn.auto.msecLineWait":t=>this.#B(t),"sys:sn.auto.msecLineWait_Kidoku":t=>this.#B(t),"save:sn.doRecLog":t=>{this.#P(this.#K=this.#T(t))},"save:sn.userFnTail":(t,s)=>{if(s.includes("@"))throw"この変数では文字「@」は禁止です";this.cfg.userFnTail=s},"tmp:flash.desktop.NativeApplication.nativeApplication.systemIdleMode":()=>{}};defValTrg(t,s){this.#L[t]=s}#D=t=>(0,i.a)(this.#_,t,!0);#I=t=>(0,i.b)(this.#_,t,10);#J=t=>(0,i.b)(this.#_,t,void 0===this.cfg.oCfg.init.tagch_msecwait?10:this.cfg.oCfg.init.tagch_msecwait);#R=t=>(0,i.b)(this.#_,t,void 0===this.cfg.oCfg.init.auto_msecpagewait?3500:this.cfg.oCfg.init.auto_msecpagewait);#B=t=>(0,i.b)(this.#_,t,500);#T(t){return(0,i.a)(this.#k,t,!0)}}}}]);