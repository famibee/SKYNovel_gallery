(()=>{var e,t={3810:function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var a=Object.getOwnPropertyDescriptor(t,i);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,a)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeDLayer=void 0;const{Layer:r,argChk_Num:l,argChk_Boolean:o}=i(3351),c=i(7186),h=i(7024),d=i(4092),f=i(7476);class m extends r{pia;static#e=0;static#t=0;static#i=0;static THREE;#s;#a;#n;#r;static async init(){m.THREE??=await Promise.resolve().then((()=>n(i(7186))))}constructor(e){if(super(),this.pia=e,m.#e++%2==1)return;if(1===m.#e){const{window:{width:t,height:i}}=e.getInfo();m.#t=t,m.#i=i}this.#s=new c.Scene,this.#a=new c.WebGLRenderer({antialias:!0,alpha:!0}),this.#a.setSize(m.#t,m.#i),this.#a.setPixelRatio(window.devicePixelRatio);const t=f.Texture.from(this.#a.domElement);this.#n=new f.Sprite(t),this.spLay.addChild(this.#n),this.#n.x=(m.#t-this.#n.width)/2,this.#n.y=(m.#i-this.#n.height)/2}#l=()=>{this.#o&&(this.#a.render(this.#s,this.#r),this.#n.texture.update(),this.#c(),this.#h(),this.#d(),requestAnimationFrame(this.#l))};#o=!1;#h=()=>{};#d=()=>{};#f=new c.Clock;#m;#p={};#c=()=>{};lay(e){if(!this.#s)return!1;if("grid"in e){const t=new c.GridHelper(l(e,"grid_size",10),l(e,"grid_step",5));this.#u(e,"grid",t),t.name="_grid",this.#s.add(t)}if("camera"in e&&(this.#r||(this.#r=new c.PerspectiveCamera(l(e,"camera_fov",50),m.#t/m.#i,l(e,"camera_near",.1),l(e,"camera_far",2e3))),this.#u(e,"camera",this.#r),"camera_target"in e)){const[t,i,s]=String(e.camera_target).split(",").map((e=>Number(e)));this.#r.lookAt(new c.Vector3(t,i,s))}if("directional_light"in e){const t=new c.DirectionalLight(16777215);t.intensity=l(e,"intensity",1),this.#u(e,"directional_light",t),t.name="_light",this.#s.add(t)}if("controls"in e){const e=document.getElementById("skynovel");if(!e)return!1;const t=new h.OrbitControls(this.#r,e);t.target.set(this.#r.position.x+.15,this.#r.position.y,this.#r.position.z),t.enableDamping=!0,t.dampingFactor=.2,t.rotateSpeed=.1,t.zoomSpeed=2,this.#h=()=>t.update()}const t=e.type,i=e.name||"";let s=new c.Mesh;if(t){if(i in this.#y)throw`name（=${i}）が重複しています`;if(this.#o||(this.#o=!0,this.#l()),"box"==t){const a=l(e,"size",100),n=new c.BoxGeometry(a,a,a),r=new c.MeshNormalMaterial;s=new c.Mesh(n,r),s.rotation.z=-45,this.#h=()=>this.#s.children.forEach((e=>{const t=e;t&&(t.rotation.x+=.01,t.rotation.y+=.01,t.rotation.z+=.01)})),this.#y[i]={type:t,fn:""}}else{const a=e.fn;if(!a)throw"fnは必須です";switch(t){case"eff":{const s=()=>{this.#p[a]=this.#m.loadEffect(this.pia.searchPath(a,"efk"),l(e,"scale",1),(()=>{const[s,n,r]=String(e.pos||"0,0,0").split(","),l=this.#m.play(this.#p[a],parseInt(s),parseInt(n),parseInt(r));this.#y[i]={type:t,fn:a,effhdl:l}}),((e,t)=>console.error(e+" url="+t)))};if(this.#m){s();break}effekseer.initRuntime("./effekseer.wasm",(()=>{this.#m=effekseer.createContext(),this.#m.init(this.#a.getContext());const e=new c.Clock;this.#c=()=>{this.#m.update(60*e.getDelta()),this.#m.setProjectionMatrix(Float32Array.from(this.#r.projectionMatrix.elements)),this.#m.setCameraMatrix(Float32Array.from(this.#r.matrixWorldInverse.elements)),this.#m.draw()}}),(()=>{}))}break;case"celestial_sphere":{const e=new c.SphereGeometry(5,60,40);e.scale(-1,1,1);const t=new c.TextureLoader;if(!a)throw"fnがありません";const i=t.load(this.pia.searchPath(a,"png_|jpg_|jpeg_|svg_|png|jpg|jpeg|svg"));i.minFilter=c.LinearFilter;const n=new c.MeshBasicMaterial({map:i});s=new c.Mesh(e,n),this.#r.lookAt(s.position),this.#h=()=>{s.rotation.y+=.001}}break;case"gltf":{const s="debug"in e?e=>console.log(e.loaded/e.total*100+"% loaded"):()=>{};(new d.GLTFLoader).load(this.pia.searchPath(a,"gltf|glb"),(s=>{const n=s.scene;n.name=i,this.#s.add(n),this.#y[i]={type:t,fn:a,gltf:s},this.#_(e,n)}),s,(e=>console.error("An error happened",e)))}return!1;default:throw`サポートしない type=${t} です`}this.#y[i]={type:t,fn:a}}s.name=i,this.#s.add(s)}else{if("del"in e){const t=e.del;if(!t)return!1;const i=this.#s.children.find((e=>e.name===t));return!!i&&(this.#g(i),delete this.#y[t],!1)}if(!("name"in e))return!1;{const e=this.#s.children.find((e=>e.name===i));if(!e)throw`３Ｄレイヤに存在しないモデル name=${i} です`;s=e}}return this.#_(e,s),!1}#_(e,t){this.#u(e,"pos",t),this.#b(e,"scale",t);const i=this.#y[t.name];if(i&&"label"in e&&(i.label=e.label,i.gltf)){const s=c.AnimationClip.findByName(i.gltf.animations,i.label||"");if(!s)throw console.info(`エラーが発生しました。参考までに ${i.fn}(glTF)内に存在するアニメ名を列挙します`),i.gltf.animations.map((e=>console.info(`  label=${e.name}`))),`${i.fn}(glTF)内に存在しないアニメ（label=${i.label}）です`;if(i.mixer){const t=l(e,"time",1e3)/1e3,a=i.mixer.clipAction(s);a.crossFadeFrom(i.aa,t,!0),i.aa=a}else i.mixer=new c.AnimationMixer(t),i.aa=i.mixer.clipAction(s),this.#d=()=>{this.#s.children.map((e=>{const t=this.#y[e.name];t&&t.mixer.update(this.#f.getDelta())}))};i.aa.enabled=!0,i.aa.clampWhenFinished=!0,i.aa.loop=o(e,"loop",!0)?c.LoopRepeat:c.LoopOnce,i.aa.play()}}#y={};#u(e,t,i){if(!(t in e))return;const[s,a,n]=String(e[t]).split(",").map((e=>Number(e)));i.position.set(s,a,n)}#b(e,t,i){if(!(t in e))return;const[s,a,n]=String(e[t]).split(",").map((e=>Number(e)));i.scale.set(s,a,n)}clearLay(e){super.clearLay(e),this.#s&&this.#o&&(this.#o=!1,this.#h=()=>{},this.#d=()=>{},this.#y={},this.#w(this.#s),this.#a.clear(),this.#n.texture.update())}#w(e){e.children.slice().map((e=>this.#g(e)))}#g(e){e.parent.remove(e);const t=e;if(t){const e=this.#y[t.name];return e&&e.mixer&&e.mixer.stopAllAction(),void this.#w(t)}const i=e;i&&(i.geometry.dispose(),i.material instanceof c.Material?(i.material.dispose(),i.material&&(i.material=[])):i.material.map((e=>e.dispose())))}record=()=>Object.assign(super.record(),{hInf:this.#y});playback(e,t){super.playback(e,t),this.#y=e.hInf,this.#s}dump(){if(!this.#s)return'"is":"nothing"';const e=[];return this.#s.children.map((t=>{let i=`"${t.name}": {"type":"${t.type}"`;const s=this.#y[t.name];s&&s.mixer&&(i+=`, "label":"${s.label}"`),e.push(i+"}")})),super.dump()+`, "mdl":{${e.join(",")}}`}}t.ThreeDLayer=m},931:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const s=i(2258);t.init=async function(e){return e.addLayCls("3d",(()=>new s.ThreeDLayer(e))),s.ThreeDLayer.init()}},3131:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cubism3Layer=void 0;const{Layer:s,argChk_Num:a}=i(3351),n=i(7476);class r extends s{model;ldr=new n.Loader;state={fn:"",label:"",scale:1};lay(e,t){super.lay(e);const i=e.id||"0",l=e.fn;if(l){const s=e.label;if(!s)throw`label属性でモーションjsonファイル（${l}_(label).json）を指定して下さい`;let a=!1;["moc","tex","mot"].map(((e,t)=>{const i=`l2d:${l}_${e}`;if(!(i in this.ldr.resources))switch(i in n.utils.TextureCache&&n.utils.TextureCache[i].destroy(!0),a=!0,this.ldr.loading&&(this.ldr=new n.Loader),t){case 0:this.ldr.add({name:i,url:r.pia.searchPath(l,"moc3_|moc3"),xhrType:n.LoaderResource.XHR_RESPONSE_TYPE.BUFFER});break;case 1:this.ldr.add({name:i,url:r.pia.searchPath(l,"png_|png|jpg_|jpg|jpeg_|jpeg")});break;case 2:this.ldr.add({name:i,url:r.pia.searchPath(l+"_"+s,"json_|json"),xhrType:n.LoaderResource.XHR_RESPONSE_TYPE.JSON})}}));const o=a=>{const o=Live2DCubismCore.Moc.fromArrayBuffer(a["l2d:"+l+"_moc"].data);this.model=(new LIVE2DCUBISMPIXI.ModelBuilder).setMoc(o).setTimeScale(1).addTexture(0,(a["l2d:"+l+"_tex"]||n.utils.TextureCache["l2d:"+l+"_tex"]).texture).addAnimatorLayer(i,LIVE2DCUBISMFRAMEWORK.BuiltinAnimationBlenders.OVERRIDE,1).build(),this.spLay.addChild(this.model);const c=LIVE2DCUBISMFRAMEWORK.Animation.fromMotion3Json(a["l2d:"+l+"_mot"].data);this.model.animator.getLayer(i).play(c);const h=()=>{this.hdl_tick=requestAnimationFrame(h),this.model&&this.model.update(1)};this.hdl_tick=requestAnimationFrame(h);const d={...e};delete d.fn,delete d.label,this.state.fn=l,this.state.label=s,this.lay(d,t),r.pia.resume(t)};return a?this.ldr.load(((e,t)=>o(t))):o(this.ldr.resources),!0}if(!this.state.fn)return!1;if("label"in e){const t=e.label||"";if(this.state.label!=t){this.state.label=t;const e=this.state.fn,s=r.pia.searchPath(e+"_"+t,"json_|json");(new n.Loader).add({name:"l2d:"+e+"_mot",url:s,xhrType:n.LoaderResource.XHR_RESPONSE_TYPE.JSON}).load(((t,s)=>{const a=LIVE2DCUBISMFRAMEWORK.Animation.fromMotion3Json(s["l2d:"+e+"_mot"].data);this.model.animator.getLayer(i).play(a)}))}}return"scale"in e&&(this.state.scale=a(e,"scale",1),this.model.scale=new n.Point(this.state.scale,this.state.scale),this.model.x=this.model.width/2,this.model.y=this.model.height/2),s.setXY(this.model,e,this.spLay,!0),!1}hdl_tick=0;clearLay(e){super.clearLay(e),this.model&&(cancelAnimationFrame(this.hdl_tick),this.spLay.removeChild(this.model),this.model=null),this.state={fn:"",label:"",scale:1}}record=()=>Object.assign(super.record(),this.state);playback(e,t=void 0){return super.playback(e),this.lay(e,t)}destroy(){this.clearLay({})}}t.Cubism3Layer=r},2730:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const s=i(5727);t.init=async function(e){e.addLayCls("cubism3",(()=>new s.Cubism3Layer))}},5143:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmoteLayer=void 0;const{Layer:s,argChk_Num:a}=i(3351),n=i(7476);class r extends s{pia;static#e=0;static#t=0;static#i=0;#x;#v;#L=new n.Sprite;#E;constructor(e){if(super(),this.pia=e,r.#e++%2!=1){if(1===r.#e){const{window:{width:t,height:i}}=e.getInfo();switch(r.#t=t,r.#i=i,String(this.pia.getVal("const.sn.platform.os.family"))){case"Android":case"iOS":EmotePlayer.maskMode=EmotePlayer.MaskMode.STENCIL}EmotePlayer.createRenderCanvas(r.#t,r.#i)}this.#x=n.RenderTexture.create({width:r.#t,height:r.#i}),this.spLay.addChild(new n.Sprite(this.#x)),this.#v=document.createElement("canvas"),this.#v.id=`emote:${r.#e}`,this.#v.width=r.#t,this.#v.height=r.#i,this.#v.hidden=!0,document.getElementById("skynovel").parentElement.appendChild(this.#v),this.#L.width=r.#t,this.#L.height=r.#i}}lay(e,t){if(!this.#x)return!1;if(!e.layer){if("add_lay"===e[":タグ名"])return!1;throw"layerは必須です"}if(super.lay(e),e.fn){const i=e.fn,s=new EmotePlayer(this.#v);this.#E={fn:i,player:s};const a={...e};return delete a.fn,a[":タグ名"]="lay",s.onUpdate=()=>{s&&(this.#L.texture.destroy(),this.#L.texture=new n.Texture(new n.BaseTexture(this.#v)),this.pia.render(this.#L,this.#x,!0))},s.promiseLoadDataFromURL(this.pia.searchPath(i,"emtbytes_|emtbytes")).then((()=>{this.lay(a,t),this.pia.resume(t)})),!0}if("add_lay"===e[":タグ名"])return!1;if(!this.#E)return!1;s.setXY(this.#L,e,this.spLay,!0);const i=this.#E.player;if(e.label){const t=[...i.mainTimelineLabels,...i.diffTimelineLabels];if(!t.includes(e.label))throw console.error(`エラーが発生しました。参考までに ${this.#E.fn}.emtbytes 内に存在するアニメ名を列挙します`),t.forEach((e=>console.info(`  label=${e}`))),`${this.#E.fn}.emtbytes 内に存在しないアニメ（label=${e.label}）です`;i.mainTimelineLabel=e.label}return"scale"in e&&(i.scale=a(e,"scale",1)),"grayscale"in e&&(i.grayscale=a(e,"grayscale",1)),"windSpeed"in e&&(i.windSpeed=a(e,"windSpeed",0)),"windPowerMin"in e&&(i.windPowerMin=a(e,"windPowerMin",0)),"windPowerMax"in e&&(i.windPowerMax=a(e,"windPowerMax",0)),!1}clearLay(e){this.#x&&(super.clearLay(e),this.#E&&(this.#E.player.onUpdate=()=>{},this.#E.player.unloadData(),this.#E=null,this.#L.visible=!1,this.pia.render(this.#L,this.#x,!0),this.#L.visible=!0))}record=()=>Object.assign(super.record(),this.#E?{fn:this.#E.fn,label:this.#E.player.mainTimelineLabel,scale:this.#E.player.scale,grayscale:this.#E.player.grayscale,windSpeed:this.#E.player.windSpeed,windPowerMin:this.#E.player.windPowerMin,windPowerMax:this.#E.player.windPowerMax}:{fn:""});playback(e,t=void 0){return super.playback(e),e.fn?this.lay(e,t):(this.clearLay(e),!1)}dump(){return this.#x?super.dump()+(this.#E?`, "mdl":{"fn":"${this.#E.fn}","label":"${this.#E.player.mainTimelineLabel}","scale":"${this.#E.player.scale}"}`:', "mdl":{"fn":""}'):'"is":"nothing"'}destroy(){this.#x&&(this.clearLay({}),this.#v.parentElement.removeChild(this.#v),this.spLay.removeChildren().forEach((e=>e.destroy())))}}t.EmoteLayer=r},5076:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const s=i(8595);t.init=async function(e){e.addLayCls("emote",(()=>new s.EmoteLayer(e)))}},9605:(e,t,i)=>{var s={"./3d_layer":7683,"./3d_layer/":7683,"./3d_layer/ThreeDLayer":2258,"./3d_layer/ThreeDLayer.js":3810,"./3d_layer/ThreeDLayer.js.map":8461,"./3d_layer/ThreeDLayer.ts":2258,"./3d_layer/effekseer.d":940,"./3d_layer/effekseer.d.ts":940,"./3d_layer/index":7683,"./3d_layer/index.d":8812,"./3d_layer/index.d.ts":8812,"./3d_layer/index.d.ts.map":232,"./3d_layer/index.js":931,"./3d_layer/index.js.map":4,"./3d_layer/index.ts":7683,"./cubism3_layer":8574,"./cubism3_layer/":8574,"./cubism3_layer/Cubism3Layer":5727,"./cubism3_layer/Cubism3Layer.js":3131,"./cubism3_layer/Cubism3Layer.js.map":9388,"./cubism3_layer/Cubism3Layer.ts":5727,"./cubism3_layer/index":8574,"./cubism3_layer/index.d":731,"./cubism3_layer/index.d.ts":731,"./cubism3_layer/index.d.ts.map":1123,"./cubism3_layer/index.js":2730,"./cubism3_layer/index.js.map":6219,"./cubism3_layer/index.ts":8574,"./emote_layer":1576,"./emote_layer/":1576,"./emote_layer/EmoteLayer":8595,"./emote_layer/EmoteLayer.js":5143,"./emote_layer/EmoteLayer.js.map":5192,"./emote_layer/EmoteLayer.ts":8595,"./emote_layer/index":1576,"./emote_layer/index.d":6889,"./emote_layer/index.d.ts":6889,"./emote_layer/index.d.ts.map":3893,"./emote_layer/index.js":5076,"./emote_layer/index.js.map":6101,"./emote_layer/index.ts":1576,"./emote_layer/最初にお読み下さい.txt":922,"./pass":2463,"./pass.json":2463};function a(e){var t=n(e);return i(t)}function n(e){if(!i.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}a.keys=function(){return Object.keys(s)},a.resolve=n,e.exports=a,a.id=9605},1409:(e,t,i)=>{"use strict";const s={"3d_layer":0,cubism3_layer:0,emote_layer:0};var a=i(3351);const n={};for(const e in s)n[e]=i(9605)(`./${e}`);const r={expanding:!1};let l="prj/";"/index_app.html"==location.pathname.slice(-15)&&(l="",r.oninit_run=!1);const o=new a.SysWeb(n,{cur:l+"top/",dip:JSON.stringify(r)});globalThis.runSN=(e=l+"top")=>o.runSN(e),globalThis.stopSN=()=>o.stop()},8461:()=>{},940:()=>{},8812:()=>{},232:()=>{},4:()=>{},9388:()=>{},731:()=>{},1123:()=>{},6219:()=>{},5192:()=>{},6889:()=>{},3893:()=>{},6101:()=>{},922:()=>{},2258:function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var a=Object.getOwnPropertyDescriptor(t,i);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,a)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeDLayer=void 0;const{Layer:r,argChk_Num:l,argChk_Boolean:o}=i(3351),c=i(7186),h=i(7024),d=i(4092),f=i(7476);class m extends r{pia;static#e=0;static#t=0;static#i=0;static THREE;#s;#a;#n;#r;static async init(){m.THREE??=await Promise.resolve().then((()=>n(i(7186))))}constructor(e){if(super(),this.pia=e,m.#e++%2==1)return;if(1===m.#e){const{window:{width:t,height:i}}=e.getInfo();m.#t=t,m.#i=i}this.#s=new c.Scene,this.#a=new c.WebGLRenderer({antialias:!0,alpha:!0}),this.#a.setSize(m.#t,m.#i),this.#a.setPixelRatio(window.devicePixelRatio);const t=f.Texture.from(this.#a.domElement);this.#n=new f.Sprite(t),this.spLay.addChild(this.#n),this.#n.x=(m.#t-this.#n.width)/2,this.#n.y=(m.#i-this.#n.height)/2}#l=()=>{this.#o&&(this.#a.render(this.#s,this.#r),this.#n.texture.update(),this.#c(),this.#h(),this.#d(),requestAnimationFrame(this.#l))};#o=!1;#h=()=>{};#d=()=>{};#f=new c.Clock;#m;#p={};#c=()=>{};lay(e){if(!this.#s)return!1;if("grid"in e){const t=new c.GridHelper(l(e,"grid_size",10),l(e,"grid_step",5));this.#u(e,"grid",t),t.name="_grid",this.#s.add(t)}if("camera"in e&&(this.#r||(this.#r=new c.PerspectiveCamera(l(e,"camera_fov",50),m.#t/m.#i,l(e,"camera_near",.1),l(e,"camera_far",2e3))),this.#u(e,"camera",this.#r),"camera_target"in e)){const[t,i,s]=String(e.camera_target).split(",").map((e=>Number(e)));this.#r.lookAt(new c.Vector3(t,i,s))}if("directional_light"in e){const t=new c.DirectionalLight(16777215);t.intensity=l(e,"intensity",1),this.#u(e,"directional_light",t),t.name="_light",this.#s.add(t)}if("controls"in e){const e=document.getElementById("skynovel");if(!e)return!1;const t=new h.OrbitControls(this.#r,e);t.target.set(this.#r.position.x+.15,this.#r.position.y,this.#r.position.z),t.enableDamping=!0,t.dampingFactor=.2,t.rotateSpeed=.1,t.zoomSpeed=2,this.#h=()=>t.update()}const t=e.type,i=e.name||"";let s=new c.Mesh;if(t){if(i in this.#y)throw`name（=${i}）が重複しています`;if(this.#o||(this.#o=!0,this.#l()),"box"==t){const a=l(e,"size",100),n=new c.BoxGeometry(a,a,a),r=new c.MeshNormalMaterial;s=new c.Mesh(n,r),s.rotation.z=-45,this.#h=()=>this.#s.children.forEach((e=>{const t=e;t&&(t.rotation.x+=.01,t.rotation.y+=.01,t.rotation.z+=.01)})),this.#y[i]={type:t,fn:""}}else{const a=e.fn;if(!a)throw"fnは必須です";switch(t){case"eff":{const s=()=>{this.#p[a]=this.#m.loadEffect(this.pia.searchPath(a,"efk"),l(e,"scale",1),(()=>{const[s,n,r]=String(e.pos||"0,0,0").split(","),l=this.#m.play(this.#p[a],parseInt(s),parseInt(n),parseInt(r));this.#y[i]={type:t,fn:a,effhdl:l}}),((e,t)=>console.error(e+" url="+t)))};if(this.#m){s();break}effekseer.initRuntime("./effekseer.wasm",(()=>{this.#m=effekseer.createContext(),this.#m.init(this.#a.getContext());const e=new c.Clock;this.#c=()=>{this.#m.update(60*e.getDelta()),this.#m.setProjectionMatrix(Float32Array.from(this.#r.projectionMatrix.elements)),this.#m.setCameraMatrix(Float32Array.from(this.#r.matrixWorldInverse.elements)),this.#m.draw()}}),(()=>{}))}break;case"celestial_sphere":{const e=new c.SphereGeometry(5,60,40);e.scale(-1,1,1);const t=new c.TextureLoader;if(!a)throw"fnがありません";const i=t.load(this.pia.searchPath(a,"png_|jpg_|jpeg_|svg_|png|jpg|jpeg|svg"));i.minFilter=c.LinearFilter;const n=new c.MeshBasicMaterial({map:i});s=new c.Mesh(e,n),this.#r.lookAt(s.position),this.#h=()=>{s.rotation.y+=.001}}break;case"gltf":{const s="debug"in e?e=>console.log(e.loaded/e.total*100+"% loaded"):()=>{};(new d.GLTFLoader).load(this.pia.searchPath(a,"gltf|glb"),(s=>{const n=s.scene;n.name=i,this.#s.add(n),this.#y[i]={type:t,fn:a,gltf:s},this.#_(e,n)}),s,(e=>console.error("An error happened",e)))}return!1;default:throw`サポートしない type=${t} です`}this.#y[i]={type:t,fn:a}}s.name=i,this.#s.add(s)}else{if("del"in e){const t=e.del;if(!t)return!1;const i=this.#s.children.find((e=>e.name===t));return!!i&&(this.#g(i),delete this.#y[t],!1)}if(!("name"in e))return!1;{const e=this.#s.children.find((e=>e.name===i));if(!e)throw`３Ｄレイヤに存在しないモデル name=${i} です`;s=e}}return this.#_(e,s),!1}#_(e,t){this.#u(e,"pos",t),this.#b(e,"scale",t);const i=this.#y[t.name];if(i&&"label"in e&&(i.label=e.label,i.gltf)){const s=c.AnimationClip.findByName(i.gltf.animations,i.label||"");if(!s)throw console.info(`エラーが発生しました。参考までに ${i.fn}(glTF)内に存在するアニメ名を列挙します`),i.gltf.animations.map((e=>console.info(`  label=${e.name}`))),`${i.fn}(glTF)内に存在しないアニメ（label=${i.label}）です`;if(i.mixer){const t=l(e,"time",1e3)/1e3,a=i.mixer.clipAction(s);a.crossFadeFrom(i.aa,t,!0),i.aa=a}else i.mixer=new c.AnimationMixer(t),i.aa=i.mixer.clipAction(s),this.#d=()=>{this.#s.children.map((e=>{const t=this.#y[e.name];t&&t.mixer.update(this.#f.getDelta())}))};i.aa.enabled=!0,i.aa.clampWhenFinished=!0,i.aa.loop=o(e,"loop",!0)?c.LoopRepeat:c.LoopOnce,i.aa.play()}}#y={};#u(e,t,i){if(!(t in e))return;const[s,a,n]=String(e[t]).split(",").map((e=>Number(e)));i.position.set(s,a,n)}#b(e,t,i){if(!(t in e))return;const[s,a,n]=String(e[t]).split(",").map((e=>Number(e)));i.scale.set(s,a,n)}clearLay(e){super.clearLay(e),this.#s&&this.#o&&(this.#o=!1,this.#h=()=>{},this.#d=()=>{},this.#y={},this.#w(this.#s),this.#a.clear(),this.#n.texture.update())}#w(e){e.children.slice().map((e=>this.#g(e)))}#g(e){e.parent.remove(e);const t=e;if(t){const e=this.#y[t.name];return e&&e.mixer&&e.mixer.stopAllAction(),void this.#w(t)}const i=e;i&&(i.geometry.dispose(),i.material instanceof c.Material?(i.material.dispose(),i.material&&(i.material=[])):i.material.map((e=>e.dispose())))}record=()=>Object.assign(super.record(),{hInf:this.#y});playback(e,t){super.playback(e,t),this.#y=e.hInf,this.#s}dump(){if(!this.#s)return'"is":"nothing"';const e=[];return this.#s.children.map((t=>{let i=`"${t.name}": {"type":"${t.type}"`;const s=this.#y[t.name];s&&s.mixer&&(i+=`, "label":"${s.label}"`),e.push(i+"}")})),super.dump()+`, "mdl":{${e.join(",")}}`}}t.ThreeDLayer=m},7683:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const s=i(2258);t.init=async function(e){return e.addLayCls("3d",(()=>new s.ThreeDLayer(e))),s.ThreeDLayer.init()}},5727:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cubism3Layer=void 0;const{Layer:s,argChk_Num:a}=i(3351),n=i(7476);class r extends s{model;ldr=new n.Loader;state={fn:"",label:"",scale:1};lay(e,t){super.lay(e);const i=e.id||"0",l=e.fn;if(l){const s=e.label;if(!s)throw`label属性でモーションjsonファイル（${l}_(label).json）を指定して下さい`;let a=!1;["moc","tex","mot"].map(((e,t)=>{const i=`l2d:${l}_${e}`;if(!(i in this.ldr.resources))switch(i in n.utils.TextureCache&&n.utils.TextureCache[i].destroy(!0),a=!0,this.ldr.loading&&(this.ldr=new n.Loader),t){case 0:this.ldr.add({name:i,url:r.pia.searchPath(l,"moc3_|moc3"),xhrType:n.LoaderResource.XHR_RESPONSE_TYPE.BUFFER});break;case 1:this.ldr.add({name:i,url:r.pia.searchPath(l,"png_|png|jpg_|jpg|jpeg_|jpeg")});break;case 2:this.ldr.add({name:i,url:r.pia.searchPath(l+"_"+s,"json_|json"),xhrType:n.LoaderResource.XHR_RESPONSE_TYPE.JSON})}}));const o=a=>{const o=Live2DCubismCore.Moc.fromArrayBuffer(a["l2d:"+l+"_moc"].data);this.model=(new LIVE2DCUBISMPIXI.ModelBuilder).setMoc(o).setTimeScale(1).addTexture(0,(a["l2d:"+l+"_tex"]||n.utils.TextureCache["l2d:"+l+"_tex"]).texture).addAnimatorLayer(i,LIVE2DCUBISMFRAMEWORK.BuiltinAnimationBlenders.OVERRIDE,1).build(),this.spLay.addChild(this.model);const c=LIVE2DCUBISMFRAMEWORK.Animation.fromMotion3Json(a["l2d:"+l+"_mot"].data);this.model.animator.getLayer(i).play(c);const h=()=>{this.hdl_tick=requestAnimationFrame(h),this.model&&this.model.update(1)};this.hdl_tick=requestAnimationFrame(h);const d={...e};delete d.fn,delete d.label,this.state.fn=l,this.state.label=s,this.lay(d,t),r.pia.resume(t)};return a?this.ldr.load(((e,t)=>o(t))):o(this.ldr.resources),!0}if(!this.state.fn)return!1;if("label"in e){const t=e.label||"";if(this.state.label!=t){this.state.label=t;const e=this.state.fn,s=r.pia.searchPath(e+"_"+t,"json_|json");(new n.Loader).add({name:"l2d:"+e+"_mot",url:s,xhrType:n.LoaderResource.XHR_RESPONSE_TYPE.JSON}).load(((t,s)=>{const a=LIVE2DCUBISMFRAMEWORK.Animation.fromMotion3Json(s["l2d:"+e+"_mot"].data);this.model.animator.getLayer(i).play(a)}))}}return"scale"in e&&(this.state.scale=a(e,"scale",1),this.model.scale=new n.Point(this.state.scale,this.state.scale),this.model.x=this.model.width/2,this.model.y=this.model.height/2),s.setXY(this.model,e,this.spLay,!0),!1}hdl_tick=0;clearLay(e){super.clearLay(e),this.model&&(cancelAnimationFrame(this.hdl_tick),this.spLay.removeChild(this.model),this.model=null),this.state={fn:"",label:"",scale:1}}record=()=>Object.assign(super.record(),this.state);playback(e,t=void 0){return super.playback(e),this.lay(e,t)}destroy(){this.clearLay({})}}t.Cubism3Layer=r},8574:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const s=i(5727);t.init=async function(e){e.addLayCls("cubism3",(()=>new s.Cubism3Layer))}},8595:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmoteLayer=void 0;const{Layer:s,argChk_Num:a}=i(3351),n=i(7476);class r extends s{pia;static#e=0;static#t=0;static#i=0;#x;#v;#L=new n.Sprite;#E;constructor(e){if(super(),this.pia=e,r.#e++%2!=1){if(1===r.#e){const{window:{width:t,height:i}}=e.getInfo();switch(r.#t=t,r.#i=i,String(this.pia.getVal("const.sn.platform.os.family"))){case"Android":case"iOS":EmotePlayer.maskMode=EmotePlayer.MaskMode.STENCIL}EmotePlayer.createRenderCanvas(r.#t,r.#i)}this.#x=n.RenderTexture.create({width:r.#t,height:r.#i}),this.spLay.addChild(new n.Sprite(this.#x)),this.#v=document.createElement("canvas"),this.#v.id=`emote:${r.#e}`,this.#v.width=r.#t,this.#v.height=r.#i,this.#v.hidden=!0,document.getElementById("skynovel").parentElement.appendChild(this.#v),this.#L.width=r.#t,this.#L.height=r.#i}}lay(e,t){if(!this.#x)return!1;if(!e.layer){if("add_lay"===e[":タグ名"])return!1;throw"layerは必須です"}if(super.lay(e),e.fn){const i=e.fn,s=new EmotePlayer(this.#v);this.#E={fn:i,player:s};const a={...e};return delete a.fn,a[":タグ名"]="lay",s.onUpdate=()=>{s&&(this.#L.texture.destroy(),this.#L.texture=new n.Texture(new n.BaseTexture(this.#v)),this.pia.render(this.#L,this.#x,!0))},s.promiseLoadDataFromURL(this.pia.searchPath(i,"emtbytes_|emtbytes")).then((()=>{this.lay(a,t),this.pia.resume(t)})),!0}if("add_lay"===e[":タグ名"])return!1;if(!this.#E)return!1;s.setXY(this.#L,e,this.spLay,!0);const i=this.#E.player;if(e.label){const t=[...i.mainTimelineLabels,...i.diffTimelineLabels];if(!t.includes(e.label))throw console.error(`エラーが発生しました。参考までに ${this.#E.fn}.emtbytes 内に存在するアニメ名を列挙します`),t.forEach((e=>console.info(`  label=${e}`))),`${this.#E.fn}.emtbytes 内に存在しないアニメ（label=${e.label}）です`;i.mainTimelineLabel=e.label}return"scale"in e&&(i.scale=a(e,"scale",1)),"grayscale"in e&&(i.grayscale=a(e,"grayscale",1)),"windSpeed"in e&&(i.windSpeed=a(e,"windSpeed",0)),"windPowerMin"in e&&(i.windPowerMin=a(e,"windPowerMin",0)),"windPowerMax"in e&&(i.windPowerMax=a(e,"windPowerMax",0)),!1}clearLay(e){this.#x&&(super.clearLay(e),this.#E&&(this.#E.player.onUpdate=()=>{},this.#E.player.unloadData(),this.#E=null,this.#L.visible=!1,this.pia.render(this.#L,this.#x,!0),this.#L.visible=!0))}record=()=>Object.assign(super.record(),this.#E?{fn:this.#E.fn,label:this.#E.player.mainTimelineLabel,scale:this.#E.player.scale,grayscale:this.#E.player.grayscale,windSpeed:this.#E.player.windSpeed,windPowerMin:this.#E.player.windPowerMin,windPowerMax:this.#E.player.windPowerMax}:{fn:""});playback(e,t=void 0){return super.playback(e),e.fn?this.lay(e,t):(this.clearLay(e),!1)}dump(){return this.#x?super.dump()+(this.#E?`, "mdl":{"fn":"${this.#E.fn}","label":"${this.#E.player.mainTimelineLabel}","scale":"${this.#E.player.scale}"}`:', "mdl":{"fn":""}'):'"is":"nothing"'}destroy(){this.#x&&(this.clearLay({}),this.#v.parentElement.removeChild(this.#v),this.spLay.removeChildren().forEach((e=>e.destroy())))}}t.EmoteLayer=r},1576:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const s=i(8595);t.init=async function(e){e.addLayCls("emote",(()=>new s.EmoteLayer(e)))}},2634:()=>{},2463:e=>{"use strict";e.exports=JSON.parse('{"pass":"8c1ae1c9-bbf6-40fe-bc12-7c5890e7895c","salt":"90434bb510043673f677ef42ed0b4e76","iv":"5a8aec26a5f1e38a372a180460f26c2a","ite":524,"stk":"7edc2b487aa65fdff5ff4d0034825da9"}')}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=t,e=[],s.O=(t,i,a,n)=>{if(!i){var r=1/0;for(h=0;h<e.length;h++){for(var[i,a,n]=e[h],l=!0,o=0;o<i.length;o++)(!1&n||r>=n)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(l=!1,n<r&&(r=n));if(l){e.splice(h--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[i,a,n]},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,n,[r,l,o]=i,c=0;if(r.some((t=>0!==e[t]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(o)var h=o(s)}for(t&&t(i);c<r.length;c++)n=r[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(h)},i=self.webpackChunkgallery=self.webpackChunkgallery||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[233,880,121],(()=>s(1409)));a=s.O(a)})();