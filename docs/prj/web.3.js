"use strict";(self.webpackChunkgallery=self.webpackChunkgallery||[]).push([[3],{7859:(t,e,n)=>{n.d(e,{C:()=>i});var s=n(662),o=n(3653);class i{static#t={};static#e;static#n;static init(t,e){i.#t={},i.#e=t,i.#n=e,i.#n.ticker.add(i.#s)}static#s=()=>(0,o.u)();static destroy(){i.stopAllTw(),i.#n.ticker.remove(i.#s)}static setTwProp(t,e){const n=(0,s.b)(e,"repeat",1);return t.delay((0,s.b)(e,"delay",0)).easing(i.ease(e.ease)).repeat(n>0?n-1:1/0).yoyo((0,s.a)(e,"yoyo",!1))}static#o={"Back.In":t=>o.E.Back.In(t),"Back.InOut":t=>o.E.Back.InOut(t),"Back.Out":t=>o.E.Back.Out(t),"Bounce.In":t=>o.E.Bounce.In(t),"Bounce.InOut":t=>o.E.Bounce.InOut(t),"Bounce.Out":t=>o.E.Bounce.Out(t),"Circular.In":t=>o.E.Circular.In(t),"Circular.InOut":t=>o.E.Circular.InOut(t),"Circular.Out":t=>o.E.Circular.Out(t),"Cubic.In":t=>o.E.Cubic.In(t),"Cubic.InOut":t=>o.E.Cubic.InOut(t),"Cubic.Out":t=>o.E.Cubic.Out(t),"Elastic.In":t=>o.E.Elastic.In(t),"Elastic.InOut":t=>o.E.Elastic.InOut(t),"Elastic.Out":t=>o.E.Elastic.Out(t),"Exponential.In":t=>o.E.Exponential.In(t),"Exponential.InOut":t=>o.E.Exponential.InOut(t),"Exponential.Out":t=>o.E.Exponential.Out(t),"Linear.None":t=>o.E.Linear.None(t),"Quadratic.In":t=>o.E.Quadratic.In(t),"Quadratic.InOut":t=>o.E.Quadratic.InOut(t),"Quadratic.Out":t=>o.E.Quadratic.Out(t),"Quartic.In":t=>o.E.Quartic.In(t),"Quartic.InOut":t=>o.E.Quartic.InOut(t),"Quartic.Out":t=>o.E.Quartic.Out(t),"Quintic.In":t=>o.E.Quintic.In(t),"Quintic.InOut":t=>o.E.Quintic.InOut(t),"Quintic.Out":t=>o.E.Quintic.Out(t),"Sinusoidal.In":t=>o.E.Sinusoidal.In(t),"Sinusoidal.InOut":t=>o.E.Sinusoidal.InOut(t),"Sinusoidal.Out":t=>o.E.Sinusoidal.Out(t)};static ease(t){if(!t)return t=>o.E.Linear.None(t);const e=i.#o[t];if(!e)throw"Áï∞Â∏∏„Å™easeÊåáÂÆö„Åß„Åô";return e}static hMemberCnt={alpha:0,height:0,rotation:0,scale_x:0,scale_y:0,pivot_x:0,pivot_y:0,width:0,x:0,y:0};static cnvTweenArg(t,e){const n={};for(const s of Object.keys(i.hMemberCnt)){const o=t[s];if(!o)continue;const i=String(o),r=i.startsWith("="),u=r?i.slice(1):i;if(!u)continue;const[a,c]=u.split(","),l=n[s]=parseFloat(a);c&&(n[s]+=Math.round(Math.random()*(parseFloat(c)-l+1))),r&&(n[s]+=parseFloat(e[s]))}return n}static stopAllTw(){i.#t={},(0,o.a)()}static tween(t,e,n,r,u,a,c,l=!0){const h=this.#e.isSkipping?0:(0,s.b)(e,"time",NaN),p=new o.T(n).to(r,h).onUpdate(u);i.setTwProp(p,e),i.#t[t]={tw:p,onEnd:c};const{path:d}=e;let f=p;if(d){s.C.debugLog&&console.group(`üçù [${e[":„Çø„Ç∞Âêç"]}] path=${d}= start(${n.x},${n.y},${n.alpha})`);for(const{groups:t}of d.matchAll(i.#i)){const{x:r,x2:u,y:a,y2:c,o:l,o2:p,json:d}=t;let _={};if(d)try{_=JSON.parse(d)}catch(t){console.error(`üçù json=${d} `+t);continue}else(r??u)&&(_.x=r??u),(a??c)&&(_.y=a??c),(l??p)&&(_.alpha=l??p);const y=i.cnvTweenArg(_,n);s.C.debugLog&&console.info(`üçù ${d??`{x:${r} y:${a} o:${l}}`} => hTo:${JSON.stringify(y)}`);const m=new o.T(n).to(y,h);i.setTwProp(m,e),f.chain(m),f=m}s.C.debugLog&&console.groupEnd()}f.onComplete((()=>{const e=i.#t[t];e&&(delete i.#t[t],e.tw=void 0,p.stop(),i.#e.breakEvent("tsy nm:"+t),e.onEnd?.(),a())}));const{chain:_}=e;if(_){const t=i.#t[_];if(!t?.tw)throw`${_}„ÅØÂ≠òÂú®„Åó„Å™„ÅÑ„Éª„Åæ„Åü„ÅØÁµÇ‰∫Ü„Åó„Åü„Éà„Ç•„Ç§„Éº„É≥„Åß„Åô`;delete t.onEnd,t.tw.chain(p)}else l&&p.start();return p}static#i=/\(\s*(?:(?<x>[-=\d\.]+)|(['"])(?<x2>.*?)\2)?(?:\s*,\s*(?:(?<y>[-=\d\.]+)|(['"])(?<y2>.*?)\5)?(?:\s*,\s*(?:(?<o>[-=\d\.]+)|(['"])(?<o2>.*?)\8))?)?|(?<json>\{[^{}]*})/g;static wt(t){return!!i.#t[i.TW_INT_TRANS]?.tw&&i.#e.waitEvent("tsy nm:"+i.TW_INT_TRANS,t,(()=>i.finish_trans()))}static TW_INT_TRANS="trans\n";static finish_trans(){return i.#t[i.TW_INT_TRANS]?.tw?.stop().end(),!1}static wait_tsy(t){const{layer:e="",id:n,name:o}=t,r=n?`frm\n${n}`:o??e;if(!r)throw"„Éà„Ç•„Ç§„Éº„É≥„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";const u=i.#t[r];if(!u?.tw){if((0,s.a)(t,"chk_exist_tw",!1))throw n?`„Éï„É¨„Éº„É†„Éà„Ç•„Ç§„Éº„É≥ ${n} „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ`:`„Éà„Ç•„Ç§„Éº„É≥ ${r} „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ(layer:${e} name:${o})`;return!1}return i.#e.waitEvent("tsy nm:"+r,t,(()=>u.tw?.end()))}static stop_tsy(t){const{layer:e="",id:n,name:s}=t,o=n?`frm\n${n}`:s??e;if(!o)throw"„Éà„Ç•„Ç§„Éº„É≥„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";return i.#t[o]?.tw?.stop().end(),!1}static pause_tsy(t){const{layer:e="",id:n,name:s}=t,o=n?`frm\n${n}`:s??e;if(!o)throw"„Éà„Ç•„Ç§„Éº„É≥„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";return i.#t[o]?.tw?.pause(),!1}static resume_tsy(t){const{layer:e="",id:n,name:s}=t,o=n?`frm\n${n}`:s??e;if(!o)throw"„Éà„Ç•„Ç§„Éº„É≥„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";return i.#t[o]?.tw?.resume(),!1}}},7003:(t,e,n)=>{n.r(e),n.d(e,{SoundMng:()=>st});var s,o=n(662),i=n(7859),r=n(3653);function u(){return s}var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var l=function(){return(l=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},h=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],p={};function d(t){var e=l({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},t||{}),n=document.createElement("audio"),s={},o=/^no$/;h.forEach((function(t){var i=n.canPlayType("audio/".concat(t)).replace(o,""),r=e[t]?n.canPlayType(e[t]).replace(o,""):"";s[t]=!!i||!!r})),Object.assign(p,s)}d();var f=/\.(\{([^\}]+)\})(\?.*)?$/;function _(t){var e=f,n="string"==typeof t?t:t.url;if(!e.test(n))return n;for(var s=e.exec(n),o=s[2].split(","),i=o[o.length-1],r=0,u=o.length;r<u;r++){var a=o[r];if(p[a]){i=a;break}}var c=n.replace(s[1],i);if("string"!=typeof t){var l=t;l.extension=i,l.url=c}return c}var y,m=h.filter((function(t){return p[t]})),b=function(){function t(){}return t.add=function(){t.setLegacy(u().useLegacy)},t.setLegacy=function(t){t?m.forEach((function(t){o.c.setExtensionXhrType(t,o.c.XHR_RESPONSE_TYPE.DEFAULT),o.c.setExtensionLoadType(t,o.c.LOAD_TYPE.AUDIO)})):m.forEach((function(t){o.c.setExtensionXhrType(t,o.c.XHR_RESPONSE_TYPE.BUFFER),o.c.setExtensionLoadType(t,o.c.LOAD_TYPE.XHR)}))},t.pre=function(t,e){_(t),e()},t.use=function(t,e){t.data&&m.indexOf(t.extension)>-1?t.sound=u().add(t.name,{loaded:e,preload:!0,url:t.url,source:t.data}):e()},t.extension="loader",t}(),g=0,v=function(t){function e(e){var n=t.call(this)||this;return n.id=g++,n.init(e),n}return c(e,t),e.prototype.set=function(t,e){if(void 0===this[t])throw new Error("Property with name ".concat(t," does not exist."));switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this},Object.defineProperty(e.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype._onPlay=function(){this._playing=!0},e.prototype._onPause=function(){this._playing=!1},e.prototype.init=function(t){this._playing=!1,this._duration=t.source.duration;var e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t},e.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},e.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var n=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);this._source.volume=o*n*s,this._source.playbackRate=this._speed*t.speed*e.speed},e.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",n))},e.prototype.play=function(t){var n=this,s=t.start,i=t.end,r=t.speed,u=t.loop,a=t.volume,c=t.muted;this._speed=r,this._volume=a,this._loop=!!u,this._muted=c,this.refresh(),this.loop&&null!==i&&(this.loop=!1),this._start=s,this._end=i||this._duration,this._start=Math.max(0,this._start-e.PADDING),this._end=Math.min(this._end+e.PADDING,this._duration),this._source.onloadedmetadata=function(){n._source&&(n._source.currentTime=s,n._source.onloadedmetadata=null,n.emit("progress",s,n._duration),o.T.shared.add(n._onUpdate,n))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},e.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},e.prototype._onComplete=function(){o.T.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},e.prototype.destroy=function(){o.T.shared.remove(this._onUpdate,this),this.removeAllListeners();var t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},e.prototype.toString=function(){return"[HTMLAudioInstance id=".concat(this.id,"]")},e.PADDING=.1,e}(o.d),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.init=function(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)},e.prototype.create=function(){return new v(this)},Object.defineProperty(e.prototype,"isPlayable",{get:function(){return!!this._source&&4===this._source.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._source.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.load=function(t){var e=this._source,n=this.parent;if(4!==e.readyState)if(n.url){e.src=n.url;var s=function(){r(),n.isLoaded=!0;var e=n.autoPlayStart();t&&t(null,n,e)},o=function(){r(),t&&t(new Error("Sound loading has been aborted"))},i=function(){r();var n="Failed to load audio element (code: ".concat(e.error.code,")");t&&t(new Error(n))},r=function(){e.removeEventListener("canplaythrough",s),e.removeEventListener("load",s),e.removeEventListener("abort",o),e.removeEventListener("error",i)};e.addEventListener("canplaythrough",s,!1),e.addEventListener("load",s,!1),e.addEventListener("abort",o,!1),e.addEventListener("error",i,!1),e.load()}else t(new Error("sound.url or sound.source must be set"));else{n.isLoaded=!0;var u=n.autoPlayStart();t&&setTimeout((function(){t(null,n,u)}),0)}},e}(o.d),w=function(){function t(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}return t.prototype.play=function(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},t.prototype.destroy=function(){this.parent=null},t}(),x=function(){function t(){}return t.setParamValue=function(t,e){if(t.setValueAtTime){var n=u().context;t.setValueAtTime(e,n.audioContext.currentTime)}else t.value=e;return e},t}(),O=0,E=function(t){function e(e){var n=t.call(this)||this;return n.id=O++,n._media=null,n._paused=!1,n._muted=!1,n._elapsed=0,n.init(e),n}return c(e,t),e.prototype.set=function(t,e){if(void 0===this[t])throw new Error("Property with name ".concat(t," does not exist."));switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this},e.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh(),this._update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(t){var e;this._filters&&(null===(e=this._filters)||void 0===e||e.filter((function(t){return t})).forEach((function(t){return t.disconnect()})),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){if(this._source){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var n=t.volume*(t.muted?0:1),s=e.volume*(e.muted?0:1),o=this._volume*(this._muted?0:1);x.setParamValue(this._gain.gain,o*s*n),x.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}},e.prototype.applyFilters=function(){var t;if(null!==(t=this._filters)&&void 0!==t&&t.length){this._source.disconnect();var e=this._source;this._filters.forEach((function(t){e.connect(t.destination),e=t})),e.connect(this._gain)}},e.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",n))},e.prototype.play=function(t){var e=t.start,n=t.end,s=t.speed,o=t.loop,i=t.volume,r=t.muted,u=t.filters;this._paused=!1;var a=this._media.nodes.cloneBufferSource(),c=a.source,l=a.gain;this._source=c,this._gain=l,this._speed=s,this._volume=i,this._loop=!!o,this._muted=r,this._filters=u,this.refresh();var h=this._source.buffer.duration;this._duration=h,this._end=n,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=n,this._source.loopStart=e,this._source.start(0,e)):n?this._source.start(0,e,n-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)},e.prototype.enableTicker=function(t){o.T.shared.remove(this._updateListener,this),t&&o.T.shared.add(this._updateListener,this)},Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),null===(t=this._filters)||void 0===t||t.forEach((function(t){return t.disconnect()})),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},e.prototype.toString=function(){return"[WebAudioInstance id=".concat(this.id,"]")},e.prototype._now=function(){return this._media.context.audioContext.currentTime},e.prototype._updateListener=function(){this._update()},e.prototype._update=function(t){if(void 0===t&&(t=!1),this._source){var e=this._now(),n=e-this._lastUpdate;if(n>0||t){var s=this._source.playbackRate.value;this._elapsed+=n*s,this._lastUpdate=e;var o=this._duration,i=void 0;if(this._source.loopStart){var r=this._source.loopEnd-this._source.loopStart;i=(this._source.loopStart+this._elapsed%r)/o}else i=this._elapsed%o/o;this._progress=i,this.emit("progress",this._progress,o)}}},e.prototype.init=function(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)},e.prototype._internalStop=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch{}this._source=null}},e.prototype._onComplete=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch{}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},e}(o.d),S=function(){function t(t,e){this._output=e,this._input=t}return Object.defineProperty(t.prototype,"destination",{get:function(){return this._input},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this._filters},set:function(t){var e=this;if(this._filters&&(this._filters.forEach((function(t){t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();var n=null;t.forEach((function(t){null===n?e._input.connect(t.destination):n.connect(t.destination),n=t})),n.connect(this._output)}},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},t}(),k=function(t){function e(e){var n=this,s=e.audioContext,o=s.createBufferSource(),i=s.createGain(),r=s.createAnalyser();return o.connect(r),r.connect(i),i.connect(e.destination),(n=t.call(this,r,i)||this).context=e,n.bufferSource=o,n.gain=i,n.analyser=r,n}return c(e,t),Object.defineProperty(e.prototype,"script",{get:function(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(e.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null},e.prototype.cloneBufferSource=function(){var t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,x.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;var n=this.context.audioContext.createGain();return e.connect(n),n.connect(this.destination),{source:e,gain:n}},Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this.script.bufferSize},enumerable:!1,configurable:!0}),e.BUFFER_SIZE=0,e}(S),C=function(){function t(){}return t.prototype.init=function(t){this.parent=t,this._nodes=new k(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source},t.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch{}this._source=null,this.source=null},t.prototype.create=function(){return new E(this)},Object.defineProperty(t.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this._nodes.filters},set:function(t){this._nodes.filters=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._source.buffer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._source.buffer},set:function(t){this._source.buffer=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),t.prototype.load=function(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))},t.prototype._loadUrl=function(t){var e=this,n=new XMLHttpRequest,s=this.parent.url;n.open("GET",s,!0),n.responseType="arraybuffer",n.onload=function(){e.source=n.response,e._decode(n.response,t)},n.send()},t.prototype._decode=function(t,e){var n=this,s=function(t,s){if(t)e&&e(t);else{n.parent.isLoaded=!0,n.buffer=s;var o=n.parent.autoPlayStart();e&&e(null,n.parent,o)}};t instanceof AudioBuffer?s(null,t):this.parent.context.decode(t,s)},t}(),j=function(){function t(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);var n=e.complete;this._autoPlayOptions=n?{complete:n}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}return t.from=function(e){var n={};return"string"==typeof e?n.url=e:e instanceof ArrayBuffer||e instanceof AudioBuffer||e instanceof HTMLAudioElement?n.source=e:n=e,(n=l({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},n)).url&&(n.url=_(n.url)),Object.freeze(n),new t(u().useLegacy?new P:new C,n)},Object.defineProperty(t.prototype,"context",{get:function(){return u().context},enumerable:!1,configurable:!0}),t.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},t.prototype.resume=function(){return this.isPlaying=this._instances.length>0,this.paused=!1,this},Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this.media.filters},set:function(t){this.media.filters=t},enumerable:!1,configurable:!0}),t.prototype.addSprites=function(t,e){if("object"==typeof t){var n={};for(var s in t)n[s]=this.addSprites(s,t[s]);return n}var o=new w(this,e);return this._sprites[t]=o,o},t.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},t.prototype.removeSprites=function(t){if(t){var e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(var n in this._sprites)this.removeSprites(n);return this},Object.defineProperty(t.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!1,configurable:!0}),t.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this},t.prototype.play=function(t,e){var n,s=this;if("string"==typeof t?n={sprite:i=t,loop:this.loop,complete:e}:"function"==typeof t?(n={}).complete=t:n=t,(n=l({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},n||{})).sprite){var o=n.sprite,i=this._sprites[o];n.start=i.start+(n.start||0),n.end=i.end,n.speed=i.speed||1,n.loop=i.loop||n.loop,delete n.sprite}if(n.offset&&(n.start=n.offset),!this.isLoaded)return new Promise((function(t,e){s.autoPlay=!0,s._autoPlayOptions=n,s._preload((function(s,o,i){s?e(s):(n.loaded&&n.loaded(s,o,i),t(i))}))}));(this.singleInstance||n.singleInstance)&&this._removeInstances();var r=this._createInstance();return this._instances.push(r),this.isPlaying=!0,r.once("end",(function(){n.complete&&n.complete(s),s._onComplete(r)})),r.once("stop",(function(){s._onComplete(r)})),r.play(n),r},t.prototype.refresh=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refresh()},t.prototype.refreshPaused=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refreshPaused()},Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),t.prototype._preload=function(t){this.media.load(t)},Object.defineProperty(t.prototype,"instances",{get:function(){return this._instances},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sprites",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.media.duration},enumerable:!1,configurable:!0}),t.prototype.autoPlayStart=function(){var t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t},t.prototype._removeInstances=function(){for(var t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0},t.prototype._onComplete=function(t){if(this._instances){var e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)},t.prototype._createInstance=function(){if(t._pool.length>0){var e=t._pool.pop();return e.init(this.media),e}return this.media.create()},t.prototype._poolInstance=function(e){e.destroy(),t._pool.indexOf(e)<0&&t._pool.push(e)},t._pool=[],t}(),F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=1,e.muted=!1,e.volume=1,e.paused=!1,e}return c(e,t),e.prototype.refresh=function(){this.emit("refresh")},e.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioContext",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},e.prototype.destroy=function(){this.removeAllListeners()},e}(o.d),L=function(t){function e(){var n=t.call(this,null,null)||this;n.autoPause=!0;var s=window,i=new e.AudioContext,r=i.createDynamicsCompressor(),u=i.createAnalyser();return u.connect(r),r.connect(i.destination),n._input=u,n._output=i.destination,n._ctx=i,n._offlineCtx=new e.OfflineAudioContext(1,2,s.OfflineAudioContext?Math.max(8e3,Math.min(96e3,i.sampleRate)):44100),n.compressor=r,n.analyser=u,n.events=new o.d,n.volume=1,n.speed=1,n.muted=!1,n.paused=!1,n._locked="suspended"===i.state&&("ontouchstart"in globalThis||"onclick"in globalThis),n._locked&&(n._unlock(),n._unlock=n._unlock.bind(n),document.addEventListener("mousedown",n._unlock,!0),document.addEventListener("touchstart",n._unlock,!0),document.addEventListener("touchend",n._unlock,!0)),n.onFocus=n.onFocus.bind(n),n.onBlur=n.onBlur.bind(n),globalThis.addEventListener("focus",n.onFocus),globalThis.addEventListener("blur",n.onBlur),n}return c(e,t),e.prototype.onFocus=function(){if(this.autoPause){var t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}},e.prototype.onBlur=function(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))},e.prototype._unlock=function(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))},e.prototype.playEmptySound=function(){var t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()},Object.defineProperty(e,"AudioContext",{get:function(){var t=window;return t.AudioContext||t.webkitAudioContext||null},enumerable:!1,configurable:!0}),Object.defineProperty(e,"OfflineAudioContext",{get:function(){var t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=this._ctx;void 0!==e.close&&e.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){this.events.emit("refresh")},e.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},e.prototype.decode=function(t,e){var n=function(t){e(new Error(t?.message||"Unable to decode file"))},s=this._offlineCtx.decodeAudioData(t,(function(t){e(null,t)}),n);s&&s.catch(n)},e}(S),A=function(){function t(){this.init()}return t.prototype.init=function(){return this.supported&&(this._webAudioContext=new L),this._htmlAudioContext=new F,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(t){this.useLegacy||(this._context.filters=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supported",{get:function(){return null!==L.AudioContext},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){if("object"==typeof t){var n={};for(var s in t){var o=this._getOptions(t[s],e);n[s]=this.add(s,o)}return n}if(e instanceof j)return this._sounds[t]=e,e;var i=this._getOptions(e),r=j.from(i);return this._sounds[t]=r,r},t.prototype._getOptions=function(t,e){var n;return n="string"==typeof t?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,l(l({},n),e||{})},Object.defineProperty(t.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(t){b.setLegacy(t),this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableAutoPause",{get:function(){return!this._webAudioContext.autoPause},set:function(t){this._webAudioContext.autoPause=!t},enumerable:!1,configurable:!0}),t.prototype.remove=function(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this},Object.defineProperty(t.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(t){this._context.volume=t,this._context.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speedAll",{get:function(){return this._context.speed},set:function(t){this._context.speed=t,this._context.refresh()},enumerable:!1,configurable:!0}),t.prototype.togglePauseAll=function(){return this._context.togglePause()},t.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refreshPaused(),this},t.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refreshPaused(),this},t.prototype.toggleMuteAll=function(){return this._context.toggleMute()},t.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},t.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},t.prototype.removeAll=function(){for(var t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this},t.prototype.stopAll=function(){for(var t in this._sounds)this._sounds[t].stop();return this},t.prototype.exists=function(t,e){return!!this._sounds[t]},t.prototype.find=function(t){return this.exists(t,!0),this._sounds[t]},t.prototype.play=function(t,e){return this.find(t).play(e)},t.prototype.stop=function(t){return this.find(t).stop()},t.prototype.pause=function(t){return this.find(t).pause()},t.prototype.resume=function(t){return this.find(t).resume()},t.prototype.volume=function(t,e){var n=this.find(t);return void 0!==e&&(n.volume=e),n.volume},t.prototype.speed=function(t,e){var n=this.find(t);return void 0!==e&&(n.speed=e),n.speed},t.prototype.duration=function(t){return this.find(t).duration},t.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},t}(),I=function(){function t(t,e){this.init(t,e)}return t.prototype.init=function(t,e){this.destination=t,this.source=e||t},t.prototype.connect=function(t){this.source.connect(t)},t.prototype.disconnect=function(){this.source.disconnect()},t.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},t}(),T={__proto__:null,Filter:I,EqualizerFilter:function(t){function e(n,s,o,i,r,a,c,l,h,p){void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===p&&(p=0);var d=this;if(!u().useLegacy){var f=[{f:e.F32,type:"lowshelf",gain:n},{f:e.F64,type:"peaking",gain:s},{f:e.F125,type:"peaking",gain:o},{f:e.F250,type:"peaking",gain:i},{f:e.F500,type:"peaking",gain:r},{f:e.F1K,type:"peaking",gain:a},{f:e.F2K,type:"peaking",gain:c},{f:e.F4K,type:"peaking",gain:l},{f:e.F8K,type:"peaking",gain:h},{f:e.F16K,type:"highshelf",gain:p}].map((function(t){var e=u().context.audioContext.createBiquadFilter();return e.type=t.type,x.setParamValue(e.Q,1),e.frequency.value=t.f,x.setParamValue(e.gain,t.gain),e}));(d=t.call(this,f[0],f[f.length-1])||this).bands=f,d.bandsMap={};for(var _=0;_<d.bands.length;_++){var y=d.bands[_];_>0&&d.bands[_-1].connect(y),d.bandsMap[y.frequency.value]=y}return d}d=t.call(this,null)||this}return c(e,t),e.prototype.setGain=function(t,e){if(void 0===e&&(e=0),!this.bandsMap[t])throw new Error("No band found for frequency ".concat(t));x.setParamValue(this.bandsMap[t].gain,e)},e.prototype.getGain=function(t){if(!this.bandsMap[t])throw new Error("No band found for frequency ".concat(t));return this.bandsMap[t].gain.value},Object.defineProperty(e.prototype,"f32",{get:function(){return this.getGain(e.F32)},set:function(t){this.setGain(e.F32,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f64",{get:function(){return this.getGain(e.F64)},set:function(t){this.setGain(e.F64,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f125",{get:function(){return this.getGain(e.F125)},set:function(t){this.setGain(e.F125,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f250",{get:function(){return this.getGain(e.F250)},set:function(t){this.setGain(e.F250,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f500",{get:function(){return this.getGain(e.F500)},set:function(t){this.setGain(e.F500,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f1k",{get:function(){return this.getGain(e.F1K)},set:function(t){this.setGain(e.F1K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f2k",{get:function(){return this.getGain(e.F2K)},set:function(t){this.setGain(e.F2K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f4k",{get:function(){return this.getGain(e.F4K)},set:function(t){this.setGain(e.F4K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f8k",{get:function(){return this.getGain(e.F8K)},set:function(t){this.setGain(e.F8K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f16k",{get:function(){return this.getGain(e.F16K)},set:function(t){this.setGain(e.F16K,t)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.bands.forEach((function(t){x.setParamValue(t.gain,0)}))},e.prototype.destroy=function(){this.bands.forEach((function(t){t.disconnect()})),this.bands=null,this.bandsMap=null},e.F32=32,e.F64=64,e.F125=125,e.F250=250,e.F500=500,e.F1K=1e3,e.F2K=2e3,e.F4K=4e3,e.F8K=8e3,e.F16K=16e3,e}(I),DistortionFilter:function(t){function e(e){void 0===e&&(e=0);var n=this;if(!u().useLegacy){var s=u().context.audioContext.createWaveShaper();return(n=t.call(this,s)||this)._distortion=s,n.amount=e,n}n=t.call(this,null)||this}return c(e,t),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t;for(var e,n=1e3*t,s=44100,o=new Float32Array(s),i=Math.PI/180,r=0;r<s;++r)e=2*r/s-1,o[r]=(3+n)*e*20*i/(Math.PI+n*Math.abs(e));this._distortion.curve=o,this._distortion.oversample="4x"},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._distortion=null,t.prototype.destroy.call(this)},e}(I),StereoFilter:function(t){function e(e){void 0===e&&(e=0);var n=this;if(!u().useLegacy){var s,o,i,r=u().context.audioContext;return r.createStereoPanner?i=s=r.createStereoPanner():((o=r.createPanner()).panningModel="equalpower",i=o),(n=t.call(this,i)||this)._stereo=s,n._panner=o,n.pan=e,n}n=t.call(this,null)||this}return c(e,t),Object.defineProperty(e.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._stereo?x.setParamValue(this._stereo.pan,t):this._panner.setPosition(t,0,1-Math.abs(t))},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this),this._stereo=null,this._panner=null},e}(I),ReverbFilter:function(t){function e(e,n,s){void 0===e&&(e=3),void 0===n&&(n=2),void 0===s&&(s=!1);var o=this;if(!u().useLegacy)return(o=t.call(this,null)||this)._seconds=o._clamp(e,1,50),o._decay=o._clamp(n,0,100),o._reverse=s,o._rebuild(),o;o=t.call(this,null)||this}return c(e,t),e.prototype._clamp=function(t,e,n){return Math.min(n,Math.max(e,t))},Object.defineProperty(e.prototype,"seconds",{get:function(){return this._seconds},set:function(t){this._seconds=this._clamp(t,1,50),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"decay",{get:function(){return this._decay},set:function(t){this._decay=this._clamp(t,0,100),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this._reverse},set:function(t){this._reverse=t,this._rebuild()},enumerable:!1,configurable:!0}),e.prototype._rebuild=function(){for(var t,e=u().context.audioContext,n=e.sampleRate,s=n*this._seconds,o=e.createBuffer(2,s,n),i=o.getChannelData(0),r=o.getChannelData(1),a=0;a<s;a++)t=this._reverse?s-a:a,i[a]=(2*Math.random()-1)*Math.pow(1-t/s,this._decay),r[a]=(2*Math.random()-1)*Math.pow(1-t/s,this._decay);var c=u().context.audioContext.createConvolver();c.buffer=o,this.init(c)},e}(I),MonoFilter:function(t){function e(){var e=this;if(!u().useLegacy){var n=u().context.audioContext,s=n.createChannelSplitter(),o=n.createChannelMerger();return o.connect(s),(e=t.call(this,o,s)||this)._merger=o,e}e=t.call(this,null)||this}return c(e,t),e.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,t.prototype.destroy.call(this)},e}(I),StreamFilter:function(t){function e(){var e=this;if(!u().useLegacy){var n=u().context.audioContext,s=n.createMediaStreamDestination(),o=n.createMediaStreamSource(s.stream);return(e=t.call(this,s,o)||this)._stream=s.stream,e}e=t.call(this,null)||this}return c(e,t),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._stream=null,t.prototype.destroy.call(this)},e}(I),TelephoneFilter:function(t){function e(){if(!u().useLegacy){var e=u().context.audioContext,n=e.createBiquadFilter(),s=e.createBiquadFilter(),o=e.createBiquadFilter(),i=e.createBiquadFilter();return n.type="lowpass",x.setParamValue(n.frequency,2e3),s.type="lowpass",x.setParamValue(s.frequency,2e3),o.type="highpass",x.setParamValue(o.frequency,500),i.type="highpass",x.setParamValue(i.frequency,500),n.connect(s),s.connect(o),o.connect(i),t.call(this,n,i)||this}t.call(this,null)}return c(e,t),e}(I)},N=0,V={__proto__:null,playOnce:function(t,e){var n="alias".concat(N++);return u().add(n,{url:t,preload:!0,autoPlay:!0,loaded:function(t){t&&(u().remove(n),e&&e(t))},complete:function(){u().remove(n),e&&e(null)}}),n},get PLAY_ID(){return N},render:function(t,e){var n=document.createElement("canvas");e=l({width:512,height:128,fill:"black"},e||{}),n.width=e.width,n.height=e.height;var s=o.B.from(n);if(!(t.media instanceof C))return s;var i=t.media,r=n.getContext("2d");r.fillStyle=e.fill;for(var u=i.buffer.getChannelData(0),a=Math.ceil(u.length/e.width),c=e.height/2,h=0;h<e.width;h++){for(var p=1,d=-1,f=0;f<a;f++){var _=u[h*a+f];_<p&&(p=_),_>d&&(d=_)}r.fillRect(h,(1+p)*c,1,Math.max(1,(d-p)*c))}return s},resolveUrl:_,sineTone:function(t,e){void 0===t&&(t=200),void 0===e&&(e=1);var n=j.from({singleInstance:!0});if(!(n.media instanceof C))return n;for(var s=n.media,o=n.context.audioContext.createBuffer(1,48e3*e,48e3),i=o.getChannelData(0),r=0;r<i.length;r++){var u=t*(r/o.sampleRate)*Math.PI;i[r]=2*Math.sin(u)}return s.buffer=o,n.isLoaded=!0,n},validateFormats:d,supported:p,extensions:h},$=(y=new A,s=y,y);"extensions"in o.n?o.e.add(b):o.L.registerPlugin(b);class M{constructor(t,e,n,s,o,i,r,u){this.fn=t,this.buf=e,this.start_ms=n,this.end_ms=s,this.ret_ms=o,this.volume=i,this.pan=r,this.stt=u?new z:new Y,u&&this.addSnd(u)}static#t=1;stt;loop=!1;addSnd(t){switch(this.loop=t.loop,this.stt.onLoad(this),0!==this.pan&&(t.filters=[new T.StereoFilter(this.pan)]),this.setVol=e=>t.volume=e,this.tw=()=>new r.T(t),this.onPlayEnd=()=>{this.stt.onPlayEnd(this.buf),this.#s()},this.stop=()=>{t.stop(),this.#s()},this.destroy=()=>t.destroy(),this.buf){case H:const e=Number(R.getVal("sys:sn.sound.BGM.vol_mul_talking")??1);if(1===e)break;M.#t=e;const n=K[U];n&&n.setVol(this.volume*M.#t);break;case U:t.volume=this.volume*M.#t}}#s=()=>{if(this.#s=()=>{},1===M.#t||this.buf!==H)return;M.#t=1;const t=K[U];t&&t.setVol(this.volume*M.#t)};setVol(t){}tw(){}onPlayEnd(){}stop(){}destroy(){}}let B,R,G,D,K,Q;const U="BGM",q="SE",H="VOICE";class W{constructor(t,e,n){this.hArg=t,this.buf=e,this.fn=n;const s=(0,o.b)(t,"start_ms",0),i=(0,o.b)(t,"end_ms",W.#s),u=(0,o.b)(t,"ret_ms",0),a=(0,o.b)(t,"pan",0),c=(0,o.b)(t,"speed",1);if(s<0)throw`[playse] start_ms:${s} „ÅåË≤†„ÅÆÂÄ§„Åß„Åô`;if(u<0)throw`[playse] ret_ms:${u} „ÅåË≤†„ÅÆÂÄ§„Åß„Åô`;if(0<i){if(i<=s)throw`[playse] start_ms:${s} >= end_ms:${i} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`;if(i<=u)throw`[playse] ret_ms:${u} >= end_ms:${i} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`}const l="const.sn.sound."+e+".";R.setVal_Nochk("save",l+"fn",n);const h=W.getVol(t,1);R.setVal_Nochk("save",l+"volume",h);const p=h*Number(R.getVal("sys:"+l+"volume",1)),d=(0,o.a)(t,"loop",!1);d?(W.#t[e]=n,R.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(W.#t))):W.delLoopPlay(e),R.setVal_Nochk("save",l+"start_ms",s),R.setVal_Nochk("save",l+"end_ms",i),R.setVal_Nochk("save",l+"ret_ms",u),R.setVal_Nochk("tmp",l+"playing",!0),R.flush();const f=$.find(n);this.#r=new M(n,e,s,i,u,p,a,f);const _={loop:d,speed:c,volume:p,loaded:(e,s)=>{if(!this.#r.stt.isDestroy){if(e)return void G.errScript(`„É≠„Éº„ÉâÂ§±Êïó„Åß„Åô SndBuf fn:${n} ${e}`,!1);s&&(this.#r.addSnd(s),0!==a&&(s.filters=[new T.StereoFilter(a)]),t.fnc?.())}}};let y="";if(0<s||i<W.#s){y=`${n};${s};${i};${u}`;const t=(_.sprites??={})[y]={start:s/1e3,end:i/1e3};_.preload=!0;const e=_.loaded;_.loaded=(n,o)=>{if(this.#r.stt.isDestroy)return;e(n,o);const r=o,a=r.duration;t.end<0&&(t.end+=a,r.removeSprites(y),r.addSprites(y,t)),t.end<=t.start&&G.errScript(`[playse] end_ms:${i}(${1e3*t.end}) >= start_ms:${s} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`),1e3*t.end<=u&&G.errScript(`[playse] end_ms:${i}(${1e3*t.end}) <= ret_ms:${u} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`),a<=t.start&&G.errScript(`[playse] Èü≥Â£∞„Éï„Ç°„Ç§„É´ÂÜçÁîüÊôÇÈñì:${1e3*a} <= start_ms:${s} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`),i!==W.#s&&a<=t.end&&G.errScript(`[playse] Èü≥Â£∞„Éï„Ç°„Ç§„É´ÂÜçÁîüÊôÇÈñì:${1e3*a} <= end_ms:${i} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`),r.play(y,(t=>_.complete?.(t)))}}else _.autoPlay=!0;if(d?0!==u&&(_.loop=!1,_.complete=async t=>{const e=t.duration,n=u/1e3,s=i/1e3;e<=n&&G.errScript(`[playse] Èü≥Â£∞„Éï„Ç°„Ç§„É´ÂÜçÁîüÊôÇÈñì:${1e3*e} <=  ret_ms:${u} „ÅØÁï∞Â∏∏ÂÄ§„Åß„Åô`),await t.play({..._,start:n,end:s<0?s+e:s,loop:!0,filters:0!==a?[new T.StereoFilter(a)]:[]})}):_.complete=()=>{J(this.#r,e),this.#r.onPlayEnd()},this.#i(),f){if(f.volume=p,y)this.#o(n,_);else if(f.isPlayable){const t=f.options.source;t instanceof ArrayBuffer&&0!==t.byteLength?this.#r.addSnd(j.from({..._,url:f.options.url,source:t})):f.play(_),0!==a&&(f.filters=[new T.StereoFilter(a)])}this.needLoad=!1}else{if(this.needLoad=(0,o.a)(t,"join",!0)){(0,r.d)();const t=_.loaded;_.loaded=(e,n)=>{this.#r.stt.isDestroy||t(e,n),(0,r.e)()}}this.#o(n,_)}}static#t={};static init(t,e,n,s,o){W.#t={},B=t,R=e,G=n,D=s,K=o}static setEvtMng(t){Q=t}static delLoopPlay(t){delete W.#t[t];const e="const.sn.sound."+t+".";R.setVal_Nochk("save",e+"fn",""),R.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(W.#t)),R.flush()}static getVol(t,e){const n=(0,o.b)(t,"volume",e);return n<0?0:n>1?1:n}static xchgbuf({buf:t=q,buf2:e=q}){if(t===e)throw`[xchgbuf] buf:${t} „ÅåÂêå„ÅòÂÄ§„Åß„Åô`;const n="const.sn.sound."+t+".",s=Number(R.getVal("save:"+n+"volume")),o=String(R.getVal("save:"+n+"fn")),i="const.sn.sound."+e+".",r=Number(R.getVal("save:"+i+"volume")),u=String(R.getVal("save:"+i+"fn"));R.setVal_Nochk("save",n+"volume",r),R.setVal_Nochk("save",i+"volume",s),R.setVal_Nochk("save",n+"fn",u),R.setVal_Nochk("save",i+"fn",o),t in W.#t!=e in W.#t&&(t in W.#t?(delete W.#t[t],W.#t[e]=o):(delete W.#t[e],W.#t[t]=u),R.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(W.#t))),R.flush()}static#s=999e3;#r;needLoad;#i=()=>{$.volumeAll=Number(R.getVal("sys:sn.sound.global_volume",1)),this.#i=()=>{}};#o(t,e){const n=B.searchPath(t,o.S.SOUND);if(!n.endsWith(".bin"))return e.url=n,void j.from(e);(new o.L).add({name:t,url:n,xhrType:o.c.XHR_RESPONSE_TYPE.BUFFER}).use((async(t,e)=>{try{t.data=await D.decAB(t.data)}catch(e){G.errScript(`Sound „É≠„Éº„ÉâÂ§±Êïó„Åß„Åôc fn:${t.name} ${e}`,!1)}e()})).load(((n,s)=>{e.source=s[t]?.data,j.from(e)}))}setVol(t){this.#r.setVol(t)}ws=t=>this.#r.stt.ws(this.#r,t);stopse({buf:t=q}){J(this.#r,t),this.#r.stt.stopse(this.#r)}fade=t=>this.#r.stt.fade(this.#r,t);wf=t=>this.#r.stt.wf(this.#r,t);stopfadese=t=>this.#r.stt.stopfadese(this.#r,t)}function J({loop:t},e){if(t)return void W.delLoopPlay(e);const n="const.sn.sound."+e+".";R.setVal_Nochk("tmp",n+"playing",!1),R.flush()}function X(t){t.stop().end()}class Y{onLoad(t){t.stt=new z}stopse(t){t.stt=new nt(t,!1)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class z{onLoad(){}stopse(t){t.stt=new nt(t)}ws(t,e){if(t.loop)return!1;const{buf:n=q}=e,s=(0,o.a)(e,"stop",!0);return(0,o.a)(e,"canskip",!1),!!Q.waitEvent("buf:"+n,e,(()=>{J(t,n),t.onPlayEnd(),s?t.stt.stopse(t):t.stt.onPlayEnd=()=>{}}))&&(t.stt=new Z,!0)}onPlayEnd(){}fade(t,e){const{buf:n=q}=e,s="const.sn.sound."+n+".volume",u=W.getVol(e,NaN);R.setVal_Nochk("save",s,u);const a=u*Number(R.getVal("sys:"+s,1)),c=(0,o.a)(e,"stop",0===u);c&&W.delLoopPlay(n),R.flush();const l=(0,o.b)(e,"time",NaN),h=(0,o.b)(e,"delay",0);if(0===l&&0===h||Q.isSkipping)return t.setVol(a),void(t.stt=c?new nt(t):new z);const p=t.tw();p&&(i.C.setTwProp(p,e).to({volume:a},l).onComplete((()=>{(0,r.r)(p),t.stt.compFade(n),t.stt=c?new nt(t):new z})).start(),t.stt=new tt(p))}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class Z{onLoad(){}stopse(t){t.stt=new nt(t)}ws=()=>!1;onPlayEnd(t){Q.breakEvent("buf:"+t)}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class tt{constructor(t){this.tw=t}onLoad(){}stopse(t){X(this.tw),t.stt=new nt(t)}ws=()=>!1;onPlayEnd(){}fade(){}wf(t,e){const{buf:n=q}=e;return(0,o.a)(e,"canskip",!1),!!Q.waitEvent("buf:"+n,e,(()=>X(this.tw)))&&(t.stt=new et(this.tw),!0)}compFade(){}stopfadese=()=>X(this.tw);isDestroy=!1}class et{constructor(t){this.tw=t}onLoad(){}stopse(t){X(this.tw),t.stt=new nt(t)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(t){Q.breakEvent("buf:"+t)}stopfadese=()=>X(this.tw);isDestroy=!1}class nt{constructor(t,e=!0){this.si=t,this.stop=e,e&&(t.stop(),t.loop&&(t.destroy(),t.destroy=()=>{}))}onLoad(){}stopse(){}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!0}class st{constructor(t,e,n,s,o){this.val=n,e.volume=t=>this.#r(t),e.fadebgm=t=>this.#u(t),e.fadeoutbgm=t=>this.#o(t),e.fadeoutse=t=>this.#a(t),e.fadese=t=>this.#e(t),e.playbgm=t=>this.#c(t),e.playse=t=>this.#n(t),e.stop_allse=()=>this.#l(),e.stopbgm=t=>this.#h(t),e.stopse=t=>this.#p(t),e.wb=t=>this.#d(t),e.wf=t=>this.#f(t),e.stopfadese=t=>this.#_(t),e.wl=t=>this.#y(t),e.ws=t=>this.#m(t),e.xchgbuf=t=>this.#b(t),n.setVal_Nochk("save","const.sn.loopPlaying","{}"),n.setVal_Nochk("tmp","const.sn.sound.codecs",JSON.stringify(V.supported)),W.init(t,n,s,o,this.#t),$.disableAutoPause=!0}#t={};#s;setEvtMng(t){this.#s=t,W.setEvtMng(t)}setNoticeChgVolume(t,e){this.val.defValTrg("sys:sn.sound.global_volume",((e,n)=>t($.volumeAll=Number(n)))),this.val.defValTrg("sys:sn.sound.movie_volume",((t,n)=>e(Number(n)))),this.val.setVal_Nochk("sys","sn.sound.global_volume",this.val.getVal("sys:sn.sound.global_volume",1)),this.val.setVal_Nochk("sys","sn.sound.movie_volume",this.val.getVal("sys:sn.sound.movie_volume",1))}#r(t){const{buf:e=q}=t,n="const.sn.sound."+e+".volume",s=this.#i(t,1);return Number(this.val.getVal("sys:"+n))!==s&&(this.val.setVal_Nochk("sys",n,s),this.val.flush(),t.time=0,t.volume=Number(this.val.getVal("save:"+n)),this.#e(t))}#i(t,e){const n=(0,o.b)(t,"volume",e);return n<0?0:n>1?1:n}#o(t){return t.volume=0,this.#u(t)}#a(t){return t.volume=0,this.#e(t)}#u(t){return t.buf=U,this.#e(t)}#e(t){const{buf:e=q}=t;return this.#_(t),this.#t[e]?.fade(t),!1}#c(t){return t.buf=U,t.canskip=!1,(0,o.a)(t,"loop",!0),this.#n(t)}#n(t){const{buf:e=q,fn:n}=t;if(this.#p({buf:e}),!n)throw`fn„ÅØÂøÖÈ†à„Åß„Åô buf:${e}`;return(!(0,o.a)(t,"canskip",!0)||!this.#s.isSkipping)&&(this.#t[e]=new W(t,e,n)).needLoad}clearCache(){$.removeAll()}#l(){for(const t of Object.keys(this.#t))this.#p({buf:t});return this.#t={},$.stopAll(),!1}#h(t){return t.buf=U,this.#p(t)}#p(t){const{buf:e=q}=t;return this.#t[e]?.stopse(t),!1}#d(t){return t.buf=U,this.#f(t)}#f(t){const{buf:e=q}=t;return this.#t[e]?.wf(t)}#_(t){const{buf:e=q}=t;return this.#t[e]?.stopfadese(t),!1}#y(t){return t.buf=U,this.#m(t)}#m(t){const{buf:e=q}=t;return this.#t[e]?.ws(t)}#b(t){const{buf:e=q,buf2:n=q}=t;if(e===n)return!1;const s=this.#t[e],o=this.#t[n];return s?this.#t[n]=s:delete this.#t[n],o?this.#t[e]=o:delete this.#t[e],W.xchgbuf(t),!1}playLoopFromSaveObj(t){const e=String(this.val.getVal("save:const.sn.loopPlaying","{}"));if("{}"===e)return this.#l(),this.clearCache(),[];const n=JSON.parse(e);if(t)this.#l(),this.clearCache();else for(const[t,e]of Object.entries(this.#t))t in n||e?.stopse({buf:t});return Object.entries(n).map((([e,n])=>new Promise((s=>{const o=this.#t[e];if(!t&&o&&o.fn===n)return void s();const i="save:const.sn.sound."+e+".",r={fn:n,buf:e,join:!1,loop:!0,volume:Number(this.val.getVal(i+"volume")),start_ms:Number(this.val.getVal(i+"start_ms")),end_ms:Number(this.val.getVal(i+"end_ms")),ret_ms:Number(this.val.getVal(i+"ret_ms")),fnc:s};r.buf===U?this.#c(r):this.#n(r)}))))}destroy(){this.#l(),this.clearCache()}}}}]);