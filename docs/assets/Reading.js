import{a as _,C as d,e as A,h as T,b as $,E as R,f as N}from"./web.js";var m=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-m.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?m.Bounce.In(e*2)*.5:m.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),w=function(){return performance.now()},j=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(s){return t._tweens[s]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},e.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},e.prototype.update=function(t,s){t===void 0&&(t=w()),s===void 0&&(s=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<i.length;n++){var o=this._tweens[i[n]],l=!s;o&&o.update(t,l)===!1&&!s&&delete this._tweens[i[n]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),C={Linear:function(e,t){var s=e.length-1,i=s*t,n=Math.floor(i),o=C.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[s],e[s-1],s-i):o(e[n],e[n+1>s?s:n+1],i-n)},Utils:{Linear:function(e,t,s){return(t-e)*s+e}}},O=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),L=new j,V=function(){function e(t,s){s===void 0&&(s=L),this._object=t,this._group=s,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=m.Linear.None,this._interpolationFunction=C.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=O.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(t,s){if(s===void 0&&(s=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=s<0?0:s,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t<0?0:t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,s){if(t===void 0&&(t=w()),s===void 0&&(s=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||s){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var o in this._valuesEnd)n[o]=this._valuesEnd[o];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,s)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,s,i,n,o){for(var l in i){var c=t[l],u=Array.isArray(c),g=u?"array":typeof c,h=!u&&Array.isArray(i[l]);if(!(g==="undefined"||g==="function")){if(h){var p=i[l];if(p.length===0)continue;for(var I=[c],P=0,y=p.length;P<y;P+=1){var E=this._handleRelativeValue(c,p[P]);if(isNaN(E)){h=!1,console.warn("Found invalid interpolation list. Skipping.");break}I.push(E)}h&&(i[l]=I)}if((g==="object"||u)&&c&&!h){s[l]=u?[]:{};var b=c;for(var v in b)s[l][v]=b[v];n[l]=u?[]:{};var p=i[l];if(!this._isDynamic){var k={};for(var v in p)k[v]=p[v];i[l]=p=k}this._setupProperties(b,s[l],p,n[l],o)}else(typeof s[l]>"u"||o)&&(s[l]=c),u||(s[l]*=1),h?n[l]=i[l].slice().reverse():n[l]=s[l]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(t){return t===void 0&&(t=w()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},e.prototype.resume=function(t){return t===void 0&&(t=w()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var t=0,s=this._chainedTweens.length;t<s;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t===void 0&&(t=L),this._group=t,this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=m.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=C.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,s){var i=this,n;if(t===void 0&&(t=w()),s===void 0&&(s=!0),this._isPaused)return!0;var o,l=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>l)return!1;s&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var c=t-this._startTime,u=this._duration+((n=this._repeatDelayTime)!==null&&n!==void 0?n:this._delayTime),g=this._duration+this._repeat*u,h=function(){if(i._duration===0||c>g)return 1;var b=Math.trunc(c/u),v=c-b*u,k=Math.min(v/i._duration,1);return k===0&&c===i._duration?1:k},p=h(),I=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,I),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||c>=this._duration)if(this._repeat>0){var P=Math.min(Math.trunc((c-this._duration)/u)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=P);for(o in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[o]=="string"&&(this._valuesStartRepeat[o]=this._valuesStartRepeat[o]+parseFloat(this._valuesEnd[o])),this._yoyo&&this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=u*P,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var y=0,E=this._chainedTweens.length;y<E;y++)this._chainedTweens[y].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,s,i,n){for(var o in i)if(s[o]!==void 0){var l=s[o]||0,c=i[o],u=Array.isArray(t[o]),g=Array.isArray(c),h=!u&&g;h?t[o]=this._interpolationFunction(c,n):typeof c=="object"&&c?this._updateProperties(t[o],l,c,n):(c=this._handleRelativeValue(l,c),typeof c=="number"&&(t[o]=l+(c-l)*n))}},e.prototype._handleRelativeValue=function(t,s){return typeof s!="string"?s:s.charAt(0)==="+"||s.charAt(0)==="-"?t+parseFloat(s):parseFloat(s)},e.prototype._swapEndStartRepeatValues=function(t){var s=this._valuesStartRepeat[t],i=this._valuesEnd[t];typeof i=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(i):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s},e}();O.nextId;var f=L;f.getAll.bind(f);var D=f.removeAll.bind(f);f.add.bind(f);var B=f.remove.bind(f),K=f.update.bind(f);class a{static#s;static get rs(){return this.#s}constructor(){a.#s=this}static#t={};static#e={};static setEvt2Fnc(t,s,i){t?this.#e[s]=i:this.#t[s]=i}static getEvt2Fnc=t=>this.#t[t]??this.#e[t];static clear_eventer(t,s,i){if(!t.startsWith("dom="))return;const n=s?this.#e[i]:this.#t[i];n&&this.getHtmlElmList(t).el.forEach(o=>o.removeEventListener("click",n)),s?delete this.#e[i]:delete this.#t[i]}static popLocalEvts(){const t=this.#t;return this.#t={},t}static pushLocalEvts(t){this.#t=t}static clear_event(t){const s=_(t,"global",!1),i=s?this.#e:this.#t;for(const[n,o]of Object.entries(i))n.startsWith("dom=")&&this.getHtmlElmList(n).el.forEach(l=>l.removeEventListener("click",o));return s?this.#e={}:this.#t={},!1}static getHtmlElmList(t){const s=t.indexOf(":");let i="";if(s>=0){const n=t.slice(4,s),o=`const.sn.frm.${n}`;if(!r.val.getVal(`tmp:${o}`,0))throw`HTML【${n}】が読み込まれていません`;const l=document.getElementById(n).contentWindow;return i=t.slice(s+1),{el:l.document.querySelectorAll(i),id:n,sel:i}}return i=t.slice(4),{el:document.querySelectorAll(i),id:"",sel:i}}static waitRsvEvent(t,s){if(r.val.saveKidoku(),s?this.#t.click=this.#t.enter=this.#t.arrowdown=this.#t["wheel.y>0"]=()=>s():(delete this.#t.click,delete this.#t.enter,delete this.#t.arrowdown,delete this.#t["wheel.y>0"]),this.getEvt2Fnc=t?i=>this.#t[i]??this.#e[i]:i=>this.#t[i],r.scrItr.noticeWait(),d.debugLog){const i=Object.create(null);i.local=Object.keys(this.#t),i.global=Object.keys(this.#e),console.log("🎍 wait event... %o",i)}}static waitRsvEvent4Paging(){if(this.waitRsvEvent(!0),this.aKeysAtPaging.length===0){this.getEvt2Fnc=s=>this.#t[s]??this.#e[s];return}const t={};for(const s of this.aKeysAtPaging){const i=this.#e[s];i&&(t[s]=i)}this.getEvt2Fnc=s=>this.#t[s]??t[s]}fire(t,s){const i=t.toLowerCase();switch(i){case"click":case"rightclick":case"middleclick":case"enter":case"arrowdown":if(!a.isFirstFire())return;break}if(i==="enter"){const o=r.fcs.getFocus();if(o instanceof A){o.emit(T,new PointerEvent(T));return}}const n=a.getEvt2Fnc(i);n&&(s.stopImmediatePropagation(),!(!i.startsWith("dom=")&&r.layMng.clickTxtLay())&&n(s))}get isSkipping(){return r.skip_enabled}isWait=!1;static#i=!1;static isFirstFire(){return a.#i?!1:(a.#i=!0,!0)}static resetFired(){a.#i=!1}static aPage;static lenPage=0;static posPage=0;static styPaging;static INI_STYPAGE="color: yellow; text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;";static aKeysAtPaging=[];static recodePage(t=!1){if(!r.val.getVal("save:sn.doRecLog"))return;const{fn:s,idx:i}=r.scrItr.nowScrIdx(),n=`${i-1}:`+s;if(this.aPage.findIndex(l=>l.key===n)>-1)return;d.debugLog&&console.log(`📜 %crecodePage === week:${t} lenPage:${this.lenPage} len:${this.aPage.length} POP:${!!this.aPage.at(-1)?.week}`,"color:#3B0;"),this.aPage.at(-1)?.week&&this.aPage.pop();const{max_len:o}=r.cfg.oCfg.log;if(this.aPage.push({key:n,week:t,fn:r.val.getVal("save:const.sn.scriptFn",s),index:r.val.getVal("save:const.sn.scriptIdx",0),mark:r.scrItr.nowMark()})>o&&(this.aPage=this.aPage.slice(-o)),this.lenPage=this.aPage.length,d.debugLog){const l=r.scrItr.nowMark();console.log(`   %clenPage:${this.lenPage} (base=${l.hPages.base.fore.sBkFn} 0=${l.hPages[0].fore.sBkFn} mes=${l.hPages.mes.fore.txs.cssText.match(/color: \w+;/)})%c mark:%o`,"color:#3B0;","",l),console.table(this.aPage)}r.val.setVal_Nochk("sys","const.sn.aPageLog",JSON.stringify(this.aPage))}static playbackPage(t,s){this.aPage=JSON.parse(t),this.lenPage=this.aPage.length,this.posPage>=this.lenPage&&(this.posPage=this.lenPage-1),this.styPaging=s}beginProc(){new F}endProc(){new S}l(t){if(!r.tagL_enabled)return!1;if(a.recodePage(!0),r.auto_enabled)return t.time=Number(r.val.getVal(`sys:sn.auto.msecLineWait${r.scrItr.isKidoku?"_Kidoku":""}`)),this.wait(t);if(r.skip_enabled){if(!r.skip_all&&!r.scrItr.isNextKidoku)r.cancelAutoSkip();else if("ps".includes(r.val.getVal("sys:sn.skip.mode")))return t.time=50,this.wait(t)}return _(t,"visible",!0)&&(r.layMng.breakLine(t),r.goTxt()),new M(t),!0}p(t){if(a.recodePage(),r.auto_enabled)return t.time=Number(r.val.getVal(`sys:sn.auto.msecPageWait${r.scrItr.isKidoku?"_Kidoku":""}`)),this.wait(t);if(r.skip_enabled){if(!r.skip_all&&!r.scrItr.isNextKidoku)r.cancelAutoSkip();else if(r.val.getVal("sys:sn.skip.mode")=="s")return t.time=50,this.wait(t)}return _(t,"visible",!0)&&(r.layMng.breakPage(t),r.goTxt()),new M(t),!0}s(t){return a.recodePage(),r.cancelAutoSkip(),new M(t),!0}wait(t){const s=$(t,"time",NaN);if(r.skip_enabled)return!r.skip_all&&!r.scrItr.isNextKidoku&&r.cancelAutoSkip(),!1;const i=new V({}),n="wait",o=()=>{B(i),r.notifyEndProc(n)};i.to({},s).onComplete(o).start();const l=_(t,"canskip",!0);return r.beginProc(n,o,!0,l?o:void 0),!0}page(t){if(!("clear"in t||"to"in t||"style"in t))throw"clear,style,to いずれかは必須です";const{key:s,style:i}=t;return s&&(a.aKeysAtPaging=s.split(",")),i?(a.styPaging=i,r.val.setVal_Nochk("save","const.sn.styPaging",i),!1):(_(t,"clear",!1)&&(a.aPage=[],a.lenPage=0,a.posPage=0,r.val.setVal_Nochk("sys","const.sn.aPageLog","[]"),r.val.setVal_Nochk("save","const.sn.styPaging",a.INI_STYPAGE)),!1)}static destroy(){this.#t={},this.#e={},this.aPage=[],this.lenPage=0,this.posPage=0}}class S extends a{constructor(){super(),d.debugLog&&console.log("📖 => %cReadingState_go","color:#3B0;"),r.main.resume()}fire(t,s){}}class F extends a{constructor(){super(),d.debugLog&&console.log("📖 => %cReadingState_proc","color:#3B0;")}fire(t,s){}}class M extends a{constructor(t){super(),d.debugLog&&console.log("📖 => %cReadingState_wait","color:#3B0;");let s=()=>{};const i=_(t,"global",!0);switch(t[":タグ名"]){case"wait":return;case"s":a.waitRsvEvent(i);return;case"p":s=()=>{_(t,"er",!1)&&r.hTag.er(t),r.sndMng.clearCache(),new S};break;default:s=()=>new S}a.waitRsvEvent(i,s)}isWait=!0;page(t){const s=super.page(t),{to:i}=t;if(!i)return s;if(a.lenPage<2)return!1;switch(i){case"oldest":t.to="prev",a.posPage=1;break;case"newest":case"prev":t.to="prev",a.posPage=a.lenPage-1;break;default:return!1}return x.go(t)}}class x extends a{constructor(){super(),d.debugLog&&console.log("📖 => %cReadingState_page","color:#3B0;"),r.val.setVal_Nochk("tmp","const.sn.isPaging",!0)}static go(t){return new x().page(t)}#s=!0;get isSkipping(){return this.#s}isWait=!1;beginProc(){r.main.stop()}endProc(){r.main.resume()}l(t){return this.#s?a.posPage===a.lenPage-1?(this.#t(),new S().l(t)):(_(t,"visible",!0)&&r.layMng.breakLine(t),r.layMng.setAllStyle2TxtLay(a.styPaging),r.goTxt(),a.aPage[a.posPage]?.week?(a.waitRsvEvent4Paging(),!0):!1):super.l(t)}p(t){return this.#s?a.posPage===a.lenPage-1?(this.#t(),new S().p(t)):(_(t,"visible",!0)&&r.layMng.breakPage(t),r.layMng.setAllStyle2TxtLay(a.styPaging),r.goTxt(),a.waitRsvEvent4Paging(),!0):super.p(t)}s(t){return new M(t),!0}wait(){return!1}page(t){const{to:s,style:i,clear:n}=t;if(i||n)return!1;switch(d.debugLog&&console.log(`📜 %cpage() pos:${a.posPage}%c len:${a.lenPage} to:${s}`,"color:#3B0;",""),s){case"oldest":if(a.posPage===0)return!1;a.posPage=0;break;case"prev":if(a.posPage===0)return!1;--a.posPage;break;case"next":if(a.posPage===a.lenPage-1)return!1;++a.posPage;break;case"newest":if(a.posPage===a.lenPage-1)return!1;a.posPage=a.lenPage-1;break;case"exit":a.posPage=a.lenPage-1;break;case"load":a.lenPage=a.posPage+1,a.aPage=a.aPage.slice(0,a.lenPage),this.#t();break;default:throw`属性to「${s}」は異常です`}a.posPage===a.lenPage-1&&this.#t();const o=a.aPage[a.posPage];if(!o)throw`posPage異常:${a.posPage}`;const{fn:l,index:c,mark:u}=o;if(d.debugLog){const g=r.scrItr.nowMark(),{week:h}=a.aPage[a.posPage]??{week:!1};console.log(`   -- fn:${l} i:${c} pos:${a.posPage} (base=%c${g.hPages.base.fore.sBkFn}%c 0=%c${g.hPages[0].fore.sBkFn}%c mes=%c${g.hPages.mes.fore.txs.cssText.match(/color: \w+;/)}%c) week:${h} A:${a.posPage===a.lenPage-1}
   styPaging=%c${a.styPaging}%c
   mark:%o`,"background-color:#3B0; color:#000;","","background-color:#B4F; color:#000;","","color:#B68;","",a.styPaging,"",u)}return r.scrItr.loadFromMark({fn:l,index:c},u)}#t(){r.val.setVal_Nochk("tmp","const.sn.isPaging",!1),this.#s=!1}}class r{static beginProc(t,s,i=!0,n){if(d.debugLog&&console.log(`📖.beginProc id:%c${t}%c onNotify:${!!s} endProc:${i} onClickSkip:${!!n}`,"color:#3B0;",""),this.#s(),this.#i=t,s){const{promise:o,resolve:l}=Promise.withResolvers();o.then(c=>{d.debugLog&&console.log(`📖.callBack id:%c${c}%c`,"color:#3B0;",""),s(),i?this.endProc(c):this.#s()}),this.#e=l}if(n){const o=()=>{this.cancelAutoSkip(),n(),i&&this.endProc(t)};this.#t.add(this.main.cvs,T,l=>{l.stopPropagation(),o()}),this.#t.add(document,R,l=>{l.isComposing||(l.stopPropagation(),o())}),this.procWheel4wle(this.#t,o)}a.rs.beginProc()}static#s(){this.#i="",this.#e=()=>{},this.#t.clear()}static#t=new N;static#e=()=>{};static notifyEndProc(t){d.debugLog&&console.log(`📖.notifyEndProc id:%c${t}%c=${this.#i===t}`,"color:#3B0;",""),this.#i===t&&this.#e(t)}static endProc(t){d.debugLog&&console.log(`📖.endProc id:%c${t}%c=${this.#i===t}`,"color:#3B0;",""),this.#i===t&&(a.rs.endProc(),this.#s())}static#i="";static get procID(){return`RP_${this.scrItr.scriptFn}:${this.scrItr.idxToken}_`}static fire(t,s,i=!1){i&&this.cancelAutoSkip(),a.rs.fire(t,s)}static get isSkipping(){return a.rs.isSkipping}static get isWait(){return a.rs.isWait}static tagL_enabled=!0;static skip_all=!1;static skip_enabled=!1;static auto_enabled=!1;static cfg;static hTag;static main;static val;static scrItr;static layMng;static goTxt=()=>{};static get needGoTxt(){return this.layMng.needGoTxt}static evtMng;static sndMng;static procWheel4wle;static fcs;static init(t,s,i,n,o,l,c,u,g){this.cfg=t,this.hTag=s,this.main=i,this.val=n,this.scrItr=o,this.layMng=l,this.goTxt=()=>l.goTxt(),this.evtMng=c,this.sndMng=u,this.procWheel4wle=g,n.defTmp("sn.tagL.enabled",()=>this.tagL_enabled),n.defValTrg("tmp:sn.tagL.enabled",(h,p)=>this.tagL_enabled=String(p)!=="false"),n.defTmp("sn.skip.all",()=>this.skip_all),n.defValTrg("tmp:sn.skip.all",(h,p)=>this.skip_all=String(p)!=="false"),n.defTmp("sn.skip.enabled",()=>this.skip_enabled),n.defValTrg("tmp:sn.skip.enabled",(h,p)=>this.skip_enabled=String(p)!=="false"),n.defTmp("sn.auto.enabled",()=>this.auto_enabled),n.defValTrg("tmp:sn.auto.enabled",(h,p)=>this.auto_enabled=String(p)!=="false"),s.l=h=>a.rs.l(h),s.p=h=>a.rs.p(h),s.s=h=>a.rs.s(h),s.wait=h=>a.rs.wait(h),s.waitclick=h=>a.rs.s(h),s.page=h=>a.rs.page(h),new F,s.jump({fn:"main"})}static setFcs(t){this.fcs=t}static cancelAutoSkip(){this.tagL_enabled||(this.tagL_enabled=!0,this.val.setVal_Nochk("tmp","sn.tagL.enabled",!0)),this.skip_enabled&&(this.skip_enabled=!1,this.val.setVal_Nochk("tmp","sn.skip.enabled",!1)),this.auto_enabled&&(this.auto_enabled=!1,this.val.setVal_Nochk("tmp","sn.auto.enabled",!1))}}export{B as D,m as E,K,D as V,r as a,V as m,a as n};
