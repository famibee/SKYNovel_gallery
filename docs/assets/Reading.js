import{_ as ei}from"../web.js";import{a as O,C as T,c as U,b as $,S as Z,L as St,d as B,e as Qt,f as si,E as ue,h as ii,m as _e,j as ni,G as _t,g as ri,P as oi,k as ls,l as Os,n as ai,R as Xt,o as X,T as vt,F as hi,u as $t,q as nt,r as li,A as ci,t as Ie,s as ve,v as cs,D as lt,w as ui,x as fi,y as di,z as Ot,B as Es,H as Fe,I as pi,i as us,J as fe,K as Zt,M as gi}from"./web.js";var F=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var t=1.70158;return n===1?1:n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return n===0?0:--n*n*((t+1)*n+t)+1},InOut:function(n){var t=2.5949095;return(n*=2)<1?.5*(n*n*((t+1)*n-t)):.5*((n-=2)*n*((t+1)*n+t)+2)}}),Bounce:Object.freeze({In:function(n){return 1-F.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?F.Bounce.In(n*2)*.5:F.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(t){return Math.pow(t,n)},Out:function(t){return 1-Math.pow(1-t,n)},InOut:function(t){return t<.5?Math.pow(t*2,n)/2:(1-Math.pow(2-t*2,n))/2+.5}}}}),Gt=function(){return performance.now()},mi=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(e){return t._tweens[e]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},n.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},n.prototype.update=function(t,e){t===void 0&&(t=Gt()),e===void 0&&(e=!1);var s=Object.keys(this._tweens);if(s.length===0)return!1;for(;s.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<s.length;i++){var r=this._tweens[s[i]],o=!e;r&&r.update(t,o)===!1&&!e&&delete this._tweens[s[i]]}s=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),Re={Linear:function(n,t){var e=n.length-1,s=e*t,i=Math.floor(s),r=Re.Utils.Linear;return t<0?r(n[0],n[1],s):t>1?r(n[e],n[e-1],e-s):r(n[i],n[i+1>e?e:i+1],s-i)},Utils:{Linear:function(n,t,e){return(t-n)*e+n}}},Ts=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),Be=new mi,oe=function(){function n(t,e){e===void 0&&(e=Be),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=F.Linear.None,this._interpolationFunction=Re.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Ts.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(t,e){if(e===void 0&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e<0?0:e,this},n.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t<0?0:t,this},n.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},n.prototype.start=function(t,e){if(t===void 0&&(t=Gt()),e===void 0&&(e=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var s in this._valuesStartRepeat)this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var r in this._valuesEnd)i[r]=this._valuesEnd[r];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},n.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},n.prototype._setupProperties=function(t,e,s,i,r){for(var o in s){var a=t[o],h=Array.isArray(a),l=h?"array":typeof a,c=!h&&Array.isArray(s[o]);if(!(l==="undefined"||l==="function")){if(c){var u=s[o];if(u.length===0)continue;for(var p=[a],g=0,f=u.length;g<f;g+=1){var m=this._handleRelativeValue(a,u[g]);if(isNaN(m)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}p.push(m)}c&&(s[o]=p)}if((l==="object"||h)&&a&&!c){e[o]=h?[]:{};var y=a;for(var d in y)e[o][d]=y[d];i[o]=h?[]:{};var u=s[o];if(!this._isDynamic){var b={};for(var d in u)b[d]=u[d];s[o]=u=b}this._setupProperties(y,e[o],u,i[o],r)}else(typeof e[o]>"u"||r)&&(e[o]=a),h||(e[o]*=1),c?i[o]=s[o].slice().reverse():i[o]=e[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(t){return t===void 0&&(t=Gt()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},n.prototype.resume=function(t){return t===void 0&&(t=Gt()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},n.prototype.group=function(t){return t===void 0&&(t=Be),this._group=t,this},n.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},n.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},n.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},n.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},n.prototype.easing=function(t){return t===void 0&&(t=F.Linear.None),this._easingFunction=t,this},n.prototype.interpolation=function(t){return t===void 0&&(t=Re.Linear),this._interpolationFunction=t,this},n.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},n.prototype.onStart=function(t){return this._onStartCallback=t,this},n.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},n.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},n.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},n.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},n.prototype.onStop=function(t){return this._onStopCallback=t,this},n.prototype.update=function(t,e){var s=this,i;if(t===void 0&&(t=Gt()),e===void 0&&(e=!0),this._isPaused)return!0;var r,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;e&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=t-this._startTime,h=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),l=this._duration+this._repeat*h,c=function(){if(s._duration===0||a>l)return 1;var y=Math.trunc(a/h),d=a-y*h,b=Math.min(d/s._duration,1);return b===0&&a===s._duration?1:b},u=c(),p=this._easingFunction(u);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,p),this._onUpdateCallback&&this._onUpdateCallback(this._object,u),this._duration===0||a>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((a-this._duration)/h)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(r in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[r]=="string"&&(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=h*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var f=0,m=this._chainedTweens.length;f<m;f++)this._chainedTweens[f].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(t,e,s,i){for(var r in s)if(e[r]!==void 0){var o=e[r]||0,a=s[r],h=Array.isArray(t[r]),l=Array.isArray(a),c=!h&&l;c?t[r]=this._interpolationFunction(a,i):typeof a=="object"&&a?this._updateProperties(t[r],o,a,i):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(t[r]=o+(a-o)*i))}},n.prototype._handleRelativeValue=function(t,e){return typeof e!="string"?e:e.charAt(0)==="+"||e.charAt(0)==="-"?t+parseFloat(e):parseFloat(e)},n.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],s=this._valuesEnd[t];typeof s=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(s):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e},n}();Ts.nextId;var ft=Be;ft.getAll.bind(ft);var yi=ft.removeAll.bind(ft);ft.add.bind(ft);var Cs=ft.remove.bind(ft),bi=ft.update.bind(ft);const Nt=`trans
`,we="tsy nm:";class R{static#e={};static#t;static#s;static init(t,e){this.#e={},this.#t=t,this.#s=e,this.#s.ticker.add(this.#n)}static#n=()=>bi();static destroy(){this.stopAllTw(),this.#s.ticker.remove(this.#n)}static setTwProp(t,e){const s=$(e,"repeat",1);return t.delay($(e,"delay",0)).easing(this.ease(e.ease)).repeat(s>0?s-1:1/0).yoyo(O(e,"yoyo",!1))}static#i={"Back.In":t=>F.Back.In(t),"Back.InOut":t=>F.Back.InOut(t),"Back.Out":t=>F.Back.Out(t),"Bounce.In":t=>F.Bounce.In(t),"Bounce.InOut":t=>F.Bounce.InOut(t),"Bounce.Out":t=>F.Bounce.Out(t),"Circular.In":t=>F.Circular.In(t),"Circular.InOut":t=>F.Circular.InOut(t),"Circular.Out":t=>F.Circular.Out(t),"Cubic.In":t=>F.Cubic.In(t),"Cubic.InOut":t=>F.Cubic.InOut(t),"Cubic.Out":t=>F.Cubic.Out(t),"Elastic.In":t=>F.Elastic.In(t),"Elastic.InOut":t=>F.Elastic.InOut(t),"Elastic.Out":t=>F.Elastic.Out(t),"Exponential.In":t=>F.Exponential.In(t),"Exponential.InOut":t=>F.Exponential.InOut(t),"Exponential.Out":t=>F.Exponential.Out(t),"Linear.None":t=>F.Linear.None(t),"Quadratic.In":t=>F.Quadratic.In(t),"Quadratic.InOut":t=>F.Quadratic.InOut(t),"Quadratic.Out":t=>F.Quadratic.Out(t),"Quartic.In":t=>F.Quartic.In(t),"Quartic.InOut":t=>F.Quartic.InOut(t),"Quartic.Out":t=>F.Quartic.Out(t),"Quintic.In":t=>F.Quintic.In(t),"Quintic.InOut":t=>F.Quintic.InOut(t),"Quintic.Out":t=>F.Quintic.Out(t),"Sinusoidal.In":t=>F.Sinusoidal.In(t),"Sinusoidal.InOut":t=>F.Sinusoidal.InOut(t),"Sinusoidal.Out":t=>F.Sinusoidal.Out(t)};static ease(t){if(!t)return s=>F.Linear.None(s);const e=this.#i[t];if(!e)throw"異常なease指定です";return e}static hMemberCnt={alpha:0,height:0,rotation:0,scale_x:0,scale_y:0,pivot_x:0,pivot_y:0,width:0,x:0,y:0};static cnvTweenArg(t,e){const s={};for(const i of Object.keys(this.hMemberCnt)){const r=t[i];if(!r)continue;const o=String(r),a=o.startsWith("="),h=a?o.slice(1):o;if(!h)continue;const[l,c]=h.split(","),u=s[i]=parseFloat(l);c&&(s[i]+=Math.round(Math.random()*(parseFloat(c)-u+1))),a&&(s[i]+=parseFloat(e[i]))}return s}static stopAllTw(){this.#e={},yi()}static tween(t,e,s,i,r,o,a,h=!0){const l=this.#t.isSkipping?0:$(e,"time",NaN),c=new oe(s).to(i,l).onUpdate(r);this.setTwProp(c,e),this.#e[t]={tw:c,onEnd:a};const{path:u}=e;let p=c;if(u){T.debugLog&&console.group(`🍝 [${e[":タグ名"]}] path=${u}= start(${s.x},${s.y},${s.alpha})`);for(const{groups:f}of u.matchAll(this.#o)){const{x:m,x2:y,y:d,y2:b,o:k,o2:v,json:w}=f;let x={};if(w)try{x=JSON.parse(w)}catch(N){console.error(`🍝 json=${w} `+N);continue}(m??y)&&(x.x=m??y),(d??b)&&(x.y=d??b),(k??v)&&(x.alpha=k??v);const E=this.cnvTweenArg(x,s);T.debugLog&&console.info(`🍝 ${w??`{x:${m} y:${d} o:${k}}`} => hTo:${JSON.stringify(E)}`);const A=new oe(s).to(E,l);this.setTwProp(A,e),p.chain(A),p=A}T.debugLog&&console.groupEnd()}p.onComplete(()=>{const f=this.#e[t];f&&(delete this.#e[t],f.tw=void 0,c.stop(),_.notifyEndProc(we+t),f.onEnd?.(),o())});const{chain:g}=e;if(g){const f=this.#e[g];if(!f?.tw)throw`${g}は存在しない・または終了したトゥイーンです`;delete f.onEnd,f.tw.chain(c)}else h&&c.start();return c}static#o=/\(\s*(?:(?<x>[-=\d\.]+)|(['"])(?<x2>.*?)\2)?(?:\s*,\s*(?:(?<y>[-=\d\.]+)|(['"])(?<y2>.*?)\5)?(?:\s*,\s*(?:(?<o>[-=\d\.]+)|(['"])(?<o2>.*?)\8))?)?|(?<json>\{[^{}]*})/g;static wt(t){if(!this.#e[Nt]?.tw)return!1;const e=()=>this.finish_trans();return _.beginProc(we+Nt,e,!0,e),!0}static finish_trans(){return this.#e[Nt]?.tw?.stop().end(),!1}static wait_tsy(t){const e=this.#h(t),s=this.#e[e];if(!s?.tw){const{layer:r="",id:o,name:a}=t;if(O(t,"chk_exist_tw",!1))throw o?`フレームトゥイーン ${o} が見つかりません。`:`トゥイーン ${e} が見つかりません。(layer:${r} name:${a})`;return!1}const i=()=>s.tw?.end();return _.beginProc(we+e,i,!0,i),!0}static#h(t){const{layer:e="",id:s,name:i}=t,r=s?`frm
${s}`:i??e;if(!r)throw"トゥイーンが指定されていません";return r}static stop_tsy(t){const e=this.#h(t);return this.#e[e]?.tw?.stop().end(),!1}static pause_tsy(t){const e=this.#h(t);return this.#e[e]?.tw?.pause(),!1}static resume_tsy(t){const e=this.#h(t);return this.#e[e]?.tw?.resume(),!1}}class S{constructor(t="",e,s=()=>{},i=()=>{}){this.csvFn=t,this.ctn=e,this.fncFirstComp=s,this.fncAllComp=i,t&&(this.#b=e?r=>{e.addChild(r),this.#c.push(r)}:()=>{},this.ret=S.#r(t,r=>this.fncFirstComp(r),r=>this.fncAllComp(r),r=>this.#b(r)))}static#e;static#t;static#s;static#n;static init(t,e,s,i,r){S.#e=t,S.#t=e,S.#s=s,S.#n=i,s.arg.crypto&&(S.#f=S.#g,S.#l=S.#T);const o=()=>{const a=S.#o*S.#i;for(const h of Object.values(S.#m))h.volume=a};r.setNoticeChgVolume(a=>{S.#o=a,o()},a=>{S.#i=a,o()})}static#i=1;static#o=1;static#h;static setEvtMng(t){S.#h=t}ret=!1;#b;#c=[];destroy(){this.fncFirstComp=()=>{},this.fncAllComp=()=>{},this.#b=t=>t.destroy();for(const t of this.#c)S.stopVideo(t.name),t.parent?.removeChild(t),t.destroy();this.#c=[]}static destroy(){S.#d={},S.#u={},S.#m={}}static#r(t,e,s,i){if(!t)return!1;let r=!1;if(t.startsWith("data:")){const u=()=>{const p=X.from(t);i(p),e(p),s(r)};return t in Fe?u():(r=!0,new St().add(t,t).load(u)),r}const o=[],a=new St,h=t.split(","),l=h.length;for(let u=0;u<l;++u){const p=h[u];if(!p)throw"face属性に空要素が含まれます";const{dx:g,dy:f,blendmode:m,fn:y}=S.#d[p]||{fn:p,dx:0,dy:0,blendmode:pi.NORMAL},d=u===0?e:v=>{v.transform!==null&&(v.x=g,v.y=f,v.blendMode=m)};if(o.push({fn:y,fnc:d}),y in S.#u||y in Fe||y in St.shared.resources)continue;r=!0;const b=S.#e.searchPath(y,Z.SP_GSM),k=this.#s.arg.crypto?{xhrType:b.slice(-5)===".json"?B.XHR_RESPONSE_TYPE.TEXT:B.XHR_RESPONSE_TYPE.BUFFER}:{};a.add({...k,name:y,url:b})}const c=(u,p)=>{for(const{fn:g,fnc:f}of o){const m=S.#y(g,p);m.name=g,i(m),f(m)}s(r)};return r?a.use(async(u,p)=>{try{if(u.extension==="json"){const f=await this.#s.dec("json",u.data);S.#l(f,u,p);return}const g=await this.#s.decAB(u.data);S.#f(g,u,p)}catch(g){const f=`画像/動画ロード失敗です fn:${u.name} ${g}`;S.#h.isSkipping?console.warn(f):console.error("%c"+f,"color:#FF3300;")}}).load(c):queueMicrotask(()=>c(0,{})),r}static#d={};static#u={};static#f=(t,{type:e,name:s,data:i},r)=>{switch(e){case B.TYPE.VIDEO:const o=i;o.volume=S.#o,S.#m[s]=S.#v(o)}r()};static#p(t){const e=/([^\d]+)\d+\.(\w+)/.exec(t[0]??"");if(!e)return[];const s=e[1].length,i=-e[2].length-1;return t.sort((r,o)=>us(r.slice(s,i))>us(o.slice(s,i))?1:-1)}static async#g(t,e,s){e.data=t,e.extension!=="bin"&&s(),t instanceof HTMLImageElement?(e.texture=await vt.fromLoader(t,e.url,e.name),e.type=B.TYPE.IMAGE):t instanceof HTMLVideoElement&&(t.volume=S.#o,S.#m[e.name]=S.#v(t),e.type=B.TYPE.VIDEO),s()}static#v(t){return S.#t.getVal("const.sn.needClick2Play")&&(lt.trace_beforeNew(`[lay系] ${lt.strPos()}未クリック状態で動画を自動再生します。音声はミュートされます`,"W"),t.muted=!0),t.setAttribute("playsinline",""),t}static#l=(t,{type:e,spritesheet:s,name:i,data:r},o)=>{switch(e){case B.TYPE.JSON:const a=s._frameKeys;S.#p(a),S.#u[i]={aTex:a.map(h=>vt.from(h)),meta:r.meta}}o()};static#T(t,e,s){const{meta:i,frames:r}=e.data=JSON.parse(t);if(e.type=B.TYPE.JSON,!i?.image){s();return}const o=ve(i.image),a=S.#e.searchPath(o,Z.SP_GSM);new St().use((h,l)=>{this.#s.decAB(h.data).then(c=>{h.data=c,c instanceof HTMLImageElement&&(h.type=B.TYPE.IMAGE,URL.revokeObjectURL(c.src)),l()}).catch(c=>this.#n.errScript(`画像/動画ロード失敗です dec2res4Cripto fn:${h.name} ${c}`,!1))}).add({name:o,url:a,xhrType:B.XHR_RESPONSE_TYPE.BUFFER}).load((h,l)=>{for(const{data:c}of Object.values(h.resources)){const{baseTexture:u}=vt.from(c),p=Object.values(r);S.#u[e.name]={aTex:p.map(({frame:{x:g,y:f,w:m,h:y}})=>new vt(u,new Ot(g,f,m,y))),meta:i}}s()})}static#y(t,e){const s=S.#u[t];if(s){const o=new Es(s.aTex);return o.animationSpeed=s.meta.animationSpeed??1,o.play(),o}if(t in Fe)return X.from(t);const i=S.#m[t];if(i)return X.from(i);const r=e[t];return r?new X(r.texture):new X}static#m={};static getHFn2VElm(t){return S.#m[t]}static wv(t){const{fn:e}=t;if(!e)throw"fnは必須です";const s=S.#m[e];if(!s||s.loop)return!1;if(S.#h.isSkipping||s.ended)return S.stopVideo(e),!1;const i="wv fn:"+e,r=O(t,"stop",!0),o=()=>{r&&S.stopVideo(e)};return _.beginProc(i,o,!0,o),s.addEventListener("ended",()=>_.notifyEndProc(i),{once:!0,passive:!0}),!0}static stopVideo(t){const e=S.#m[t];e&&(delete S.#m[t],e.pause(),e.currentTime=e.duration)}static add_face(t){const{name:e}=t;if(!e)throw"nameは必須です";if(e in S.#d)throw"一つのname（"+e+"）に対して同じ画像を複数割り当てられません";const{fn:s=e}=t;return S.#d[e]={fn:s,dx:$(t,"dx",0),dy:$(t,"dy",0),blendmode:nt.getBlendmodeNum(t.blendmode||"")},!1}}const te="、。，．）］｝〉」』】〕”〟ぁぃぅぇぉっゃゅょゎァィゥェォッャュョヮヵヶ！？!?‼⁉・ーゝゞヽヾ々",xe="［（｛〈「『【〔“〝",ke="─‥…",Me=te,As=new RegExp(`[${te}]`),_i=new RegExp(`[${xe}]`),vi=new RegExp(`[${ke}]`),wi=As;class xi{#e=te;#t=xe;#s=ke;#n=Me;get 行頭禁則(){return this.#e}get 行末禁則(){return this.#t}get 分割禁止(){return this.#s}get ぶら下げ(){return this.#n}#i=As;#o=_i;#h=vi;#b=wi;break_fixed=!1;break_fixed_left=0;break_fixed_top=0;bura=!1;lay(t){t.kinsoku_sol&&(this.#e=t.kinsoku_sol,this.#i=new RegExp(`[${this.#e}]`)),t.kinsoku_eol&&(this.#t=t.kinsoku_eol,this.#c(),this.#o=new RegExp(`[${this.#t}]`)),t.kinsoku_dns&&(this.#s=t.kinsoku_dns,this.#r(),this.#h=new RegExp(`[${this.#s}]`)),t.kinsoku_bura&&(this.#n=t.kinsoku_bura,this.#c(),this.#r(),this.#b=new RegExp(`[${this.#n}]`)),"bura"in t&&(this.bura=O(t,"bura",!1)),this.break_fixed=O(t,"break_fixed",this.break_fixed),this.break_fixed_left=$(t,"break_fixed_left",this.break_fixed_left),this.break_fixed_top=$(t,"break_fixed_top",this.break_fixed_top)}#c(){const t=this.#t.length,e=this.#n.length;if(t<e)for(let s=0;s<t;++s){const i=this.#t[s];if(this.#n.includes(i))throw`禁則の競合があります。文字 ${i} がぶら下げ と 行末禁則 の両方に含まれます`}else for(let s=0;s<e;++s){const i=this.#n[s];if(this.#t.includes(i))throw`禁則の競合があります。文字 ${i} がぶら下げ と 行末禁則 の両方に含まれます`}}#r(){const t=this.#s.length,e=this.#n.length;if(t<e)for(let s=0;s<t;++s){const i=this.#s[s];if(this.#n.includes(i))throw`禁則の競合があります。文字 ${i} がぶら下げ と 分割禁止 の両方に含まれます`}else for(let s=0;s<e;++s){const i=this.#n[s];if(this.#s.includes(i))throw`禁則の競合があります。文字 ${i} がぶら下げ と 分割禁止 の両方に含まれます`}}reNew(t){t.#d(this.#e,this.#t,this.#s,this.#n),t.break_fixed=this.break_fixed,t.break_fixed_left=this.break_fixed_left,t.break_fixed_top=this.break_fixed_top,t.bura=this.bura}#d(t,e,s,i){this.#e!=t&&(this.#e=t,this.#i=new RegExp(`[${t}]`)),this.#t!=e&&(this.#t=e,this.#o=new RegExp(`[${e}]`)),this.#s!=s&&(this.#s=s,this.#h=new RegExp(`[${s}]`)),this.#n!=i&&(this.#n=i,this.#b=new RegExp(`[${i}]`))}record(){const t={break_fixed:this.break_fixed,break_fixed_left:this.break_fixed_left,break_fixed_top:this.break_fixed_top,bura:this.bura};return this.#e===te&&(t.行頭禁則=this.#e),this.#t===xe&&(t.行末禁則=this.#t),this.#s===ke&&(t.分割禁止=this.#s),this.#n===Me&&(t.ぶら下げ=this.#n),t}playback(t){t&&(this.#d(t.行頭禁則??te,t.行末禁則??xe,t.分割禁止??ke,t.ぶら下げ??Me),this.break_fixed=t.break_fixed,this.break_fixed_left=t.break_fixed_left,this.break_fixed_top=t.break_fixed_top,this.bura=t.bura)}hyph(t,e,s,i,r){let o,a=0,h=2,l=c=>(l=()=>!1,i===c?(i>0&&(t.innerHTML=r.replaceAll('class="sn_ch"','class="sn_ch sn_ch_in_default"')),!0):c<2);do{if(o=this.#f(t,e),a=o.length,l(a))break;let c=-1/0;for(;h<a;++h){const{elm:u,rect:p,ch:g}=o[h];if(u.tagName==="RT")continue;const f=s?p.y:p.x;if(c<=f||u.previousElementSibling?.tagName==="SPAN"&&u.previousElementSibling?.innerHTML.includes("<br>")||u.parentElement?.previousElementSibling?.tagName==="SPAN"&&u.parentElement?.previousElementSibling?.innerHTML.includes("<br>")){c=f,this.break_fixed||(this.break_fixed_left=p.x,this.break_fixed_top=p.y);continue}const m=this.#u(o,h),{elm:y,rect:d,ch:b}=o[m];if(!this.break_fixed){this.break_fixed_left=d.x,this.break_fixed_top=d.y;const N=globalThis.getComputedStyle(y),M=parseFloat(N.fontSize);s?this.break_fixed_top+=M:this.break_fixed_left+=M}c=-1/0;const k=h,{cont:v,ins:w}=this.bura?this.hyph_alg_bura(o,m,b,h):this.hyph_alg(o,m,b,h,g);if(h=w,v)continue;const x=o[h].elm,E=x.parentElement,A=document.createElement("br");if(E.classList.contains("sn_tx"))E.insertBefore(A,x);else{const N=E.parentElement;N.classList.contains("sn_ch")?N.parentElement.insertBefore(A,N):N.insertBefore(A,E)}h+=2,h<k&&(h=k),a=-1;break}}while(a<0);return[o,a]}#u(t,e){const s=e-1,{elm:i}=t[s];return i.tagName!=="RT"?s-(i.style.textCombineUpright==="all"?Array.from(i.textContent??"").length-1:0):s-Array.from(i.textContent??"").length}#f(t,e){const s=[];if(t.nodeType!==t.TEXT_NODE)return Array.from(t.childNodes).map(a=>this.#f(a,e)).flat();const i=t.ownerDocument.createRange();i.selectNodeContents(t);let r=0;const o=i.endOffset;for(;r<o;){i.setStart(t,r),i.setEnd(t,++r);const a=i.toString();s.push({ch:a,rect:e(i,a),elm:i.startContainer.parentElement})}return i.detach(),s}hyph_alg(t,e,s,i,r){if(!this.#o.test(s)){if(this.#i.test(r))for(;(i=this.#u(t,i))>=0&&this.#i.test(t[i].ch););else if(!(s===r&&this.#h.test(s)))return{cont:!0,ins:i+1}}for(i=e;(i=this.#u(t,i))>=0&&this.#o.test(t[i].ch););return{cont:!1,ins:i+1}}hyph_alg_bura(t,e,s,i){const r=this.#u(t,e),{ch:o}=t[r];if(this.#b.test(o)||this.#i.test(o)){let h=e;(this.#b.test(s)||this.#i.test(s))&&++h;const l=this.#u(t,h),{ch:c}=t[l],{ch:u}=t[h];if(c===u&&this.#h.test(u))return{cont:!1,ins:l};if(!this.#o.test(c))return{cont:!1,ins:h};h=l;do if(!this.#o.test(t[h].ch))break;while((h=this.#u(t,h))>=0);return{cont:!1,ins:h+1}}const a=this.#u(t,r);if(i>=3){const{ch:h}=t[a];if(this.#h.test(o)&&h===o)return{cont:!1,ins:a};if(this.#o.test(h)){let l=a;for(;(l=this.#u(t,l))>=0&&this.#o.test(t[l].ch););return{cont:!1,ins:l+1}}}return{cont:!1,ins:r}}}class fs{constructor(t="",e=0,s={":hEvt1Time":{},":hMp":{},":lenIfStk":1}){this.fn=t,this.idx=e,this.csArg=s}toString=()=>`[fn:${this.fn}, idx:${this.idx}, csArg:${this.csArg}]`}class ct{static#e="ヽ";static setting(t){t.sesame&&(ct.#e=t.sesame)}static getSesame(){return ct.#e}static destroy(){ct.#e="ヽ"}#t=()=>{};init(t){this.#t=t}static#s;static setEscape(t){ct.#s=new RegExp(`${t?`(?<ce>\\${t}\\S)|`:""}｜(?<str>[^《\\n]+)《(?<ruby>[^》\\n]+)》|(?:(?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+[ぁ-ヿ]*|[^　｜《》\\n])《(?<kan_ruby>[^》\\n]+)》)|(?<txt>[\uD800-\uDBFF][\uDC00-\uDFFF]|[^｜《》]+?|.)`,"gs")}putTxt(t){for(const{groups:e}of t.matchAll(ct.#s)){const{ruby:s,kan_ruby:i,kan:r="",ce:o,txt:a="",str:h=""}=e;if(s){this.putTxtRb(decodeURIComponent(h),s);continue}if(i){this.putTxtRb(r,i);continue}if(o){this.#t(o.slice(1),"");continue}for(const l of Array.from(a))this.#t(l,"")}}putTxtRb(t,e){if(/^\w+｜{"/.test(e)){this.#t(t,e);return}const s=Array.from(t),i=s.length;if(/^\*.?$/.test(e)){const h="center｜"+(e==="*"?ct.#e:e.charAt(1));for(let l=0;l<i;++l)this.#t(s[l],h);return}if(i===1||!e.includes(" ")){this.#t(t,decodeURIComponent(e));return}const r=e.split(" "),o=r.length,a=o>i?o:i;for(let h=0;h<a;++h)this.#t(h<i?s[h]:"",h<o?decodeURIComponent(r[h]):"")}}/*!
 * @pixi/sound - v4.4.1
 * https://github.com/pixijs/pixi-sound
 * Compiled Tue, 15 Aug 2023 19:22:13 UTC
 *
 * @pixi/sound is licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license
 */var Ls;function V(){return Ls}var Ns=function(n,t){return(Ns=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])})(n,t)};function Q(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}Ns(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Dt=function(){return(Dt=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)},Is=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],Ce={};function ki(n){var t=Dt({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},{}),e=document.createElement("audio"),s={},i=/^no$/;Is.forEach(function(r){var o=e.canPlayType("audio/".concat(r)).replace(i,""),a=t[r]?e.canPlayType(t[r]).replace(i,""):"";s[r]=!!o||!!a}),Object.assign(Ce,s)}ki();var Pi=/\.(\{([^\}]+)\})(\?.*)?$/;function Fs(n){var t=Pi,e=typeof n=="string"?n:n.url;if(!t.test(e))return e;for(var s=t.exec(e),i=s[2].split(","),r=i[i.length-1],o=0,a=i.length;o<a;o++){var h=i[o];if(Ce[h]){r=h;break}}var l=e.replace(s[1],r);if(typeof n!="string"){var c=n;c.extension=r,c.url=l}return l}var je=Is.filter(function(n){return Ce[n]}),Ms=function(){function n(){}return n.add=function(){n.setLegacy(V().useLegacy)},n.setLegacy=function(t){t?je.forEach(function(e){B.setExtensionXhrType(e,B.XHR_RESPONSE_TYPE.DEFAULT),B.setExtensionLoadType(e,B.LOAD_TYPE.AUDIO)}):je.forEach(function(e){B.setExtensionXhrType(e,B.XHR_RESPONSE_TYPE.BUFFER),B.setExtensionLoadType(e,B.LOAD_TYPE.XHR)})},n.pre=function(t,e){Fs(t),e()},n.use=function(t,e){t.data&&je.indexOf(t.extension)>-1?t.sound=V().add(t.name,{loaded:e,preload:!0,url:t.url,source:t.data}):e()},n.extension="loader",n}(),Si=0,$i=function(n){function t(e){var s=n.call(this)||this;return s.id=Si++,s.init(e),s}return Q(t,n),t.prototype.set=function(e,s){if(this[e]===void 0)throw new Error("Property with name ".concat(e," does not exist."));switch(e){case"speed":this.speed=s;break;case"volume":this.volume=s;break;case"paused":this.paused=s;break;case"loop":this.loop=s;break;case"muted":this.muted=s}return this},Object.defineProperty(t.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!1,configurable:!0}),t.prototype._onPlay=function(){this._playing=!0},t.prototype._onPause=function(){this._playing=!1},t.prototype.init=function(e){this._playing=!1,this._duration=e.source.duration;var s=this._source=e.source.cloneNode(!1);s.src=e.parent.url,s.onplay=this._onPlay.bind(this),s.onpause=this._onPause.bind(this),e.context.on("refresh",this.refresh,this),e.context.on("refreshPaused",this.refreshPaused,this),this._media=e},t.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},t.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.refresh=function(){var e=this._media.context,s=this._media.parent;this._source.loop=this._loop||s.loop;var i=e.volume*(e.muted?0:1),r=s.volume*(s.muted?0:1),o=this._volume*(this._muted?0:1);this._source.volume=o*i*r,this._source.playbackRate=this._speed*e.speed*s.speed},t.prototype.refreshPaused=function(){var e=this._media.context,s=this._media.parent,i=this._paused||s.paused||e.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",i))},t.prototype.play=function(e){var s=this,i=e.start,r=e.end,o=e.speed,a=e.loop,h=e.volume,l=e.muted;this._speed=o,this._volume=h,this._loop=!!a,this._muted=l,this.refresh(),this.loop&&r!==null&&(this.loop=!1),this._start=i,this._end=r||this._duration,this._start=Math.max(0,this._start-t.PADDING),this._end=Math.min(this._end+t.PADDING,this._duration),this._source.onloadedmetadata=function(){s._source&&(s._source.currentTime=i,s._source.onloadedmetadata=null,s.emit("progress",i,s._duration),Zt.shared.add(s._onUpdate,s))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},t.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},t.prototype._onComplete=function(){Zt.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},t.prototype.destroy=function(){Zt.shared.remove(this._onUpdate,this),this.removeAllListeners();var e=this._source;e&&(e.onended=null,e.onplay=null,e.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},t.prototype.toString=function(){return"[HTMLAudioInstance id=".concat(this.id,"]")},t.PADDING=.1,t}(fe),Oi=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return Q(t,n),t.prototype.init=function(e){this.parent=e,this._source=e.options.source||new Audio,e.url&&(this._source.src=e.url)},t.prototype.create=function(){return new $i(this)},Object.defineProperty(t.prototype,"isPlayable",{get:function(){return!!this._source&&this._source.readyState===4},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._source.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),t.prototype.load=function(e){var s=this._source,i=this.parent;if(s.readyState!==4)if(i.url){s.src=i.url;var r=function(){h(),i.isLoaded=!0;var c=i.autoPlayStart();e&&e(null,i,c)},o=function(){h(),e&&e(new Error("Sound loading has been aborted"))},a=function(){h();var c="Failed to load audio element (code: ".concat(s.error.code,")");e&&e(new Error(c))},h=function(){s.removeEventListener("canplaythrough",r),s.removeEventListener("load",r),s.removeEventListener("abort",o),s.removeEventListener("error",a)};s.addEventListener("canplaythrough",r,!1),s.addEventListener("load",r,!1),s.addEventListener("abort",o,!1),s.addEventListener("error",a,!1),s.load()}else e(new Error("sound.url or sound.source must be set"));else{i.isLoaded=!0;var l=i.autoPlayStart();e&&setTimeout(function(){e(null,i,l)},0)}},t}(fe),Ei=function(){function n(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}return n.prototype.play=function(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},n.prototype.destroy=function(){this.parent=null},n}(),it=function(){function n(){}return n.setParamValue=function(t,e){if(t.setValueAtTime){var s=V().context;t.setValueAtTime(e,s.audioContext.currentTime)}else t.value=e;return e},n}(),Ti=0,Ci=function(n){function t(e){var s=n.call(this)||this;return s.id=Ti++,s._media=null,s._paused=!1,s._muted=!1,s._elapsed=0,s.init(e),s}return Q(t,n),t.prototype.set=function(e,s){if(this[e]===void 0)throw new Error("Property with name ".concat(e," does not exist."));switch(e){case"speed":this.speed=s;break;case"volume":this.volume=s;break;case"muted":this.muted=s;break;case"loop":this.loop=s;break;case"paused":this.paused=s}return this},t.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh(),this._update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return this._filters},set:function(e){var s;this._filters&&((s=this._filters)===null||s===void 0||s.filter(function(i){return i}).forEach(function(i){return i.disconnect()}),this._filters=null,this._source.connect(this._gain)),this._filters=e?.length?e.slice(0):null,this.refresh()},enumerable:!1,configurable:!0}),t.prototype.refresh=function(){if(this._source){var e=this._media.context,s=this._media.parent;this._source.loop=this._loop||s.loop;var i=e.volume*(e.muted?0:1),r=s.volume*(s.muted?0:1),o=this._volume*(this._muted?0:1);it.setParamValue(this._gain.gain,o*r*i),it.setParamValue(this._source.playbackRate,this._speed*s.speed*e.speed),this.applyFilters()}},t.prototype.applyFilters=function(){var e;if(!((e=this._filters)===null||e===void 0)&&e.length){this._source.disconnect();var s=this._source;this._filters.forEach(function(i){s.connect(i.destination),s=i}),s.connect(this._gain)}},t.prototype.refreshPaused=function(){var e=this._media.context,s=this._media.parent,i=this._paused||s.paused||e.paused;i!==this._pausedReal&&(this._pausedReal=i,i?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))},t.prototype.play=function(e){var s=e.start,i=e.end,r=e.speed,o=e.loop,a=e.volume,h=e.muted,l=e.filters;this._paused=!1;var c=this._media.nodes.cloneBufferSource(),u=c.source,p=c.gain;this._source=u,this._gain=p,this._speed=r,this._volume=a,this._loop=!!o,this._muted=h,this._filters=l,this.refresh();var g=this._source.buffer.duration;this._duration=g,this._end=i,this._lastUpdate=this._now(),this._elapsed=s,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=s,this._source.start(0,s)):i?this._source.start(0,s,i-s):this._source.start(0,s),this.emit("start"),this._update(!0),this.enableTicker(!0)},t.prototype.enableTicker=function(e){Zt.shared.remove(this._updateListener,this),e&&Zt.shared.add(this._updateListener,this)},Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),(e=this._filters)===null||e===void 0||e.forEach(function(s){return s.disconnect()}),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},t.prototype.toString=function(){return"[WebAudioInstance id=".concat(this.id,"]")},t.prototype._now=function(){return this._media.context.audioContext.currentTime},t.prototype._updateListener=function(){this._update()},t.prototype._update=function(e){if(e===void 0&&(e=!1),this._source){var s=this._now(),i=s-this._lastUpdate;if(i>0||e){var r=this._source.playbackRate.value;this._elapsed+=i*r,this._lastUpdate=s;var o=this._duration,a=void 0;if(this._source.loopStart){var h=this._source.loopEnd-this._source.loopStart;a=(this._source.loopStart+this._elapsed%h)/o}else a=this._elapsed%o/o;this._progress=a,this.emit("progress",this._progress,o)}}},t.prototype.init=function(e){this._media=e,e.context.events.on("refresh",this.refresh,this),e.context.events.on("refreshPaused",this.refreshPaused,this)},t.prototype._internalStop=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch{}this._source=null}},t.prototype._onComplete=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch{}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},t}(fe),js=function(){function n(t,e){this._output=e,this._input=t}return Object.defineProperty(n.prototype,"destination",{get:function(){return this._input},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this._filters},set:function(t){var e=this;if(this._filters&&(this._filters.forEach(function(i){i&&i.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();var s=null;t.forEach(function(i){s===null?e._input.connect(i.destination):s.connect(i.destination),s=i}),s.connect(this._output)}},enumerable:!1,configurable:!0}),n.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},n}(),Ai=function(n){function t(e){var s=this,i=e.audioContext,r=i.createBufferSource(),o=i.createGain(),a=i.createAnalyser();return r.connect(a),a.connect(o),o.connect(e.destination),(s=n.call(this,a,o)||this).context=e,s.bufferSource=r,s.gain=o,s.analyser=a,s}return Q(t,n),Object.defineProperty(t.prototype,"script",{get:function(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(t.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){n.prototype.destroy.call(this),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null},t.prototype.cloneBufferSource=function(){var e=this.bufferSource,s=this.context.audioContext.createBufferSource();s.buffer=e.buffer,it.setParamValue(s.playbackRate,e.playbackRate.value),s.loop=e.loop;var i=this.context.audioContext.createGain();return s.connect(i),i.connect(this.destination),{source:s,gain:i}},Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this.script.bufferSize},enumerable:!1,configurable:!0}),t.BUFFER_SIZE=0,t}(js),Li=function(){function n(){}return n.prototype.init=function(t){this.parent=t,this._nodes=new Ai(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source},n.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch{}this._source=null,this.source=null},n.prototype.create=function(){return new Ci(this)},Object.defineProperty(n.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this._nodes.filters},set:function(t){this._nodes.filters=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._source.buffer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._source.buffer},set:function(t){this._source.buffer=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),n.prototype.load=function(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))},n.prototype._loadUrl=function(t){var e=this,s=new XMLHttpRequest,i=this.parent.url;s.open("GET",i,!0),s.responseType="arraybuffer",s.onload=function(){e.source=s.response,e._decode(s.response,t)},s.send()},n.prototype._decode=function(t,e){var s=this,i=function(r,o){if(r)e&&e(r);else{s.parent.isLoaded=!0,s.buffer=o;var a=s.parent.autoPlayStart();e&&e(null,s.parent,a)}};t instanceof AudioBuffer?i(null,t):this.parent.context.decode(t,i)},n}(),ee=function(){function n(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);var s=e.complete;this._autoPlayOptions=s?{complete:s}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}return n.from=function(t){var e={};return typeof t=="string"?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:e=t,(e=Dt({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},e)).url&&(e.url=Fs(e.url)),Object.freeze(e),new n(V().useLegacy?new Oi:new Li,e)},Object.defineProperty(n.prototype,"context",{get:function(){return V().context},enumerable:!1,configurable:!0}),n.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},n.prototype.resume=function(){return this.isPlaying=this._instances.length>0,this.paused=!1,this},Object.defineProperty(n.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this.media.filters},set:function(t){this.media.filters=t},enumerable:!1,configurable:!0}),n.prototype.addSprites=function(t,e){if(typeof t=="object"){var s={};for(var i in t)s[i]=this.addSprites(i,t[i]);return s}var r=new Ei(this,e);return this._sprites[t]=r,r},n.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},n.prototype.removeSprites=function(t){if(t){var e=this._sprites[t];e!==void 0&&(e.destroy(),delete this._sprites[t])}else for(var s in this._sprites)this.removeSprites(s);return this},Object.defineProperty(n.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!1,configurable:!0}),n.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this},n.prototype.play=function(t,e){var s,i=this;if(typeof t=="string"?s={sprite:o=t,loop:this.loop,complete:e}:typeof t=="function"?(s={}).complete=t:s=t,(s=Dt({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},s||{})).sprite){var r=s.sprite,o=this._sprites[r];s.start=o.start+(s.start||0),s.end=o.end,s.speed=o.speed||1,s.loop=o.loop||s.loop,delete s.sprite}if(s.offset&&(s.start=s.offset),!this.isLoaded)return new Promise(function(h,l){i.autoPlay=!0,i._autoPlayOptions=s,i._preload(function(c,u,p){c?l(c):(s.loaded&&s.loaded(c,u,p),h(p))})});(this.singleInstance||s.singleInstance)&&this._removeInstances();var a=this._createInstance();return this._instances.push(a),this.isPlaying=!0,a.once("end",function(){s.complete&&s.complete(i),i._onComplete(a)}),a.once("stop",function(){i._onComplete(a)}),a.play(s),a},n.prototype.refresh=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refresh()},n.prototype.refreshPaused=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refreshPaused()},Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),n.prototype._preload=function(t){this.media.load(t)},Object.defineProperty(n.prototype,"instances",{get:function(){return this._instances},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sprites",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this.media.duration},enumerable:!1,configurable:!0}),n.prototype.autoPlayStart=function(){var t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t},n.prototype._removeInstances=function(){for(var t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0},n.prototype._onComplete=function(t){if(this._instances){var e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)},n.prototype._createInstance=function(){if(n._pool.length>0){var t=n._pool.pop();return t.init(this.media),t}return this.media.create()},n.prototype._poolInstance=function(t){t.destroy(),n._pool.indexOf(t)<0&&n._pool.push(t)},n._pool=[],n}(),Ni=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.speed=1,e.muted=!1,e.volume=1,e.paused=!1,e}return Q(t,n),t.prototype.refresh=function(){this.emit("refresh")},t.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(t.prototype,"filters",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"audioContext",{get:function(){return null},enumerable:!1,configurable:!0}),t.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},t.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},t.prototype.destroy=function(){this.removeAllListeners()},t}(fe),ds=function(n){function t(){var e=n.call(this,null,null)||this;e.autoPause=!0;var s=window,i=new t.AudioContext,r=i.createDynamicsCompressor(),o=i.createAnalyser();return o.connect(r),r.connect(i.destination),e._input=o,e._output=i.destination,e._ctx=i,e._offlineCtx=new t.OfflineAudioContext(1,2,s.OfflineAudioContext?Math.max(8e3,Math.min(96e3,i.sampleRate)):44100),e.compressor=r,e.analyser=o,e.events=new fe,e.volume=1,e.speed=1,e.muted=!1,e.paused=!1,e._locked=i.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),e._locked&&(e._unlock(),e._unlock=e._unlock.bind(e),document.addEventListener("mousedown",e._unlock,!0),document.addEventListener("touchstart",e._unlock,!0),document.addEventListener("touchend",e._unlock,!0)),e.onFocus=e.onFocus.bind(e),e.onBlur=e.onBlur.bind(e),globalThis.addEventListener("focus",e.onFocus),globalThis.addEventListener("blur",e.onBlur),e}return Q(t,n),t.prototype.onFocus=function(){if(this.autoPause){var e=this._ctx.state;e!=="suspended"&&e!=="interrupted"&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}},t.prototype.onBlur=function(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))},t.prototype._unlock=function(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))},t.prototype.playEmptySound=function(){var e=this._ctx.createBufferSource();e.buffer=this._ctx.createBuffer(1,1,22050),e.connect(this._ctx.destination),e.start(0,0,0),e.context.state==="suspended"&&e.context.resume()},Object.defineProperty(t,"AudioContext",{get:function(){var e=window;return e.AudioContext||e.webkitAudioContext||null},enumerable:!1,configurable:!0}),Object.defineProperty(t,"OfflineAudioContext",{get:function(){var e=window;return e.OfflineAudioContext||e.webkitOfflineAudioContext||null},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){n.prototype.destroy.call(this);var e=this._ctx;e.close!==void 0&&e.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){e&&this._ctx.state==="running"?this._ctx.suspend():e||this._ctx.state!=="suspended"||this._ctx.resume(),this._paused=e},enumerable:!1,configurable:!0}),t.prototype.refresh=function(){this.events.emit("refresh")},t.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},t.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},t.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},t.prototype.decode=function(e,s){var i=function(o){s(new Error(o?.message||"Unable to decode file"))},r=this._offlineCtx.decodeAudioData(e,function(o){s(null,o)},i);r&&r.catch(i)},t}(js),Ii=function(){function n(){this.init()}return n.prototype.init=function(){return this.supported&&(this._webAudioContext=new ds),this._htmlAudioContext=new Ni,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(n.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(t){this.useLegacy||(this._context.filters=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"supported",{get:function(){return ds.AudioContext!==null},enumerable:!1,configurable:!0}),n.prototype.add=function(t,e){if(typeof t=="object"){var s={};for(var i in t){var r=this._getOptions(t[i],e);s[i]=this.add(i,r)}return s}if(e instanceof ee)return this._sounds[t]=e,e;var o=this._getOptions(e),a=ee.from(o);return this._sounds[t]=a,a},n.prototype._getOptions=function(t,e){var s;return s=typeof t=="string"?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,s=Dt(Dt({},s),e||{})},Object.defineProperty(n.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(t){Ms.setLegacy(t),this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableAutoPause",{get:function(){return!this._webAudioContext.autoPause},set:function(t){this._webAudioContext.autoPause=!t},enumerable:!1,configurable:!0}),n.prototype.remove=function(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this},Object.defineProperty(n.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(t){this._context.volume=t,this._context.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"speedAll",{get:function(){return this._context.speed},set:function(t){this._context.speed=t,this._context.refresh()},enumerable:!1,configurable:!0}),n.prototype.togglePauseAll=function(){return this._context.togglePause()},n.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refreshPaused(),this},n.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refreshPaused(),this},n.prototype.toggleMuteAll=function(){return this._context.toggleMute()},n.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},n.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},n.prototype.removeAll=function(){for(var t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this},n.prototype.stopAll=function(){for(var t in this._sounds)this._sounds[t].stop();return this},n.prototype.exists=function(t,e){return!!this._sounds[t]},n.prototype.find=function(t){return this.exists(t,!0),this._sounds[t]},n.prototype.play=function(t,e){return this.find(t).play(e)},n.prototype.stop=function(t){return this.find(t).stop()},n.prototype.pause=function(t){return this.find(t).pause()},n.prototype.resume=function(t){return this.find(t).resume()},n.prototype.volume=function(t,e){var s=this.find(t);return e!==void 0&&(s.volume=e),s.volume},n.prototype.speed=function(t,e){var s=this.find(t);return e!==void 0&&(s.speed=e),s.speed},n.prototype.duration=function(t){return this.find(t).duration},n.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},n}(),At=function(){function n(t,e){this.init(t,e)}return n.prototype.init=function(t,e){this.destination=t,this.source=e||t},n.prototype.connect=function(t){this.source.connect(t)},n.prototype.disconnect=function(){this.source.disconnect()},n.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},n}(),Jt={__proto__:null,EqualizerFilter:function(n){function t(e,s,i,r,o,a,h,l,c,u){e===void 0&&(e=0),s===void 0&&(s=0),i===void 0&&(i=0),r===void 0&&(r=0),o===void 0&&(o=0),a===void 0&&(a=0),h===void 0&&(h=0),l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=0);var p=this;if(!V().useLegacy){var g=[{f:t.F32,type:"lowshelf",gain:e},{f:t.F64,type:"peaking",gain:s},{f:t.F125,type:"peaking",gain:i},{f:t.F250,type:"peaking",gain:r},{f:t.F500,type:"peaking",gain:o},{f:t.F1K,type:"peaking",gain:a},{f:t.F2K,type:"peaking",gain:h},{f:t.F4K,type:"peaking",gain:l},{f:t.F8K,type:"peaking",gain:c},{f:t.F16K,type:"highshelf",gain:u}].map(function(y){var d=V().context.audioContext.createBiquadFilter();return d.type=y.type,it.setParamValue(d.Q,1),d.frequency.value=y.f,it.setParamValue(d.gain,y.gain),d});(p=n.call(this,g[0],g[g.length-1])||this).bands=g,p.bandsMap={};for(var f=0;f<p.bands.length;f++){var m=p.bands[f];f>0&&p.bands[f-1].connect(m),p.bandsMap[m.frequency.value]=m}return p}p=n.call(this,null)||this}return Q(t,n),t.prototype.setGain=function(e,s){if(s===void 0&&(s=0),!this.bandsMap[e])throw new Error("No band found for frequency ".concat(e));it.setParamValue(this.bandsMap[e].gain,s)},t.prototype.getGain=function(e){if(!this.bandsMap[e])throw new Error("No band found for frequency ".concat(e));return this.bandsMap[e].gain.value},Object.defineProperty(t.prototype,"f32",{get:function(){return this.getGain(t.F32)},set:function(e){this.setGain(t.F32,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f64",{get:function(){return this.getGain(t.F64)},set:function(e){this.setGain(t.F64,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f125",{get:function(){return this.getGain(t.F125)},set:function(e){this.setGain(t.F125,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f250",{get:function(){return this.getGain(t.F250)},set:function(e){this.setGain(t.F250,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f500",{get:function(){return this.getGain(t.F500)},set:function(e){this.setGain(t.F500,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f1k",{get:function(){return this.getGain(t.F1K)},set:function(e){this.setGain(t.F1K,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f2k",{get:function(){return this.getGain(t.F2K)},set:function(e){this.setGain(t.F2K,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f4k",{get:function(){return this.getGain(t.F4K)},set:function(e){this.setGain(t.F4K,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f8k",{get:function(){return this.getGain(t.F8K)},set:function(e){this.setGain(t.F8K,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f16k",{get:function(){return this.getGain(t.F16K)},set:function(e){this.setGain(t.F16K,e)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.bands.forEach(function(e){it.setParamValue(e.gain,0)})},t.prototype.destroy=function(){this.bands.forEach(function(e){e.disconnect()}),this.bands=null,this.bandsMap=null},t.F32=32,t.F64=64,t.F125=125,t.F250=250,t.F500=500,t.F1K=1e3,t.F2K=2e3,t.F4K=4e3,t.F8K=8e3,t.F16K=16e3,t}(At),DistortionFilter:function(n){function t(e){e===void 0&&(e=0);var s=this;if(!V().useLegacy){var i=V().context.audioContext.createWaveShaper();return(s=n.call(this,i)||this)._distortion=i,s.amount=e,s}s=n.call(this,null)||this}return Q(t,n),Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e;for(var s,i=1e3*e,r=44100,o=new Float32Array(r),a=Math.PI/180,h=0;h<r;++h)s=2*h/r-1,o[h]=(3+i)*s*20*a/(Math.PI+i*Math.abs(s));this._distortion.curve=o,this._distortion.oversample="4x"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._distortion=null,n.prototype.destroy.call(this)},t}(At),StereoFilter:function(n){function t(e){e===void 0&&(e=0);var s=this;if(!V().useLegacy){var i,r,o,a=V().context.audioContext;return a.createStereoPanner?o=i=a.createStereoPanner():((r=a.createPanner()).panningModel="equalpower",o=r),(s=n.call(this,o)||this)._stereo=i,s._panner=r,s.pan=e,s}s=n.call(this,null)||this}return Q(t,n),Object.defineProperty(t.prototype,"pan",{get:function(){return this._pan},set:function(e){this._pan=e,this._stereo?it.setParamValue(this._stereo.pan,e):this._panner.setPosition(e,0,1-Math.abs(e))},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){n.prototype.destroy.call(this),this._stereo=null,this._panner=null},t}(At),ReverbFilter:function(n){function t(e,s,i){e===void 0&&(e=3),s===void 0&&(s=2),i===void 0&&(i=!1);var r=this;if(!V().useLegacy)return(r=n.call(this,null)||this)._seconds=r._clamp(e,1,50),r._decay=r._clamp(s,0,100),r._reverse=i,r._rebuild(),r;r=n.call(this,null)||this}return Q(t,n),t.prototype._clamp=function(e,s,i){return Math.min(i,Math.max(s,e))},Object.defineProperty(t.prototype,"seconds",{get:function(){return this._seconds},set:function(e){this._seconds=this._clamp(e,1,50),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"decay",{get:function(){return this._decay},set:function(e){this._decay=this._clamp(e,0,100),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reverse",{get:function(){return this._reverse},set:function(e){this._reverse=e,this._rebuild()},enumerable:!1,configurable:!0}),t.prototype._rebuild=function(){for(var e,s=V().context.audioContext,i=s.sampleRate,r=i*this._seconds,o=s.createBuffer(2,r,i),a=o.getChannelData(0),h=o.getChannelData(1),l=0;l<r;l++)e=this._reverse?r-l:l,a[l]=(2*Math.random()-1)*Math.pow(1-e/r,this._decay),h[l]=(2*Math.random()-1)*Math.pow(1-e/r,this._decay);var c=V().context.audioContext.createConvolver();c.buffer=o,this.init(c)},t}(At),MonoFilter:function(n){function t(){var e=this;if(!V().useLegacy){var s=V().context.audioContext,i=s.createChannelSplitter(),r=s.createChannelMerger();return r.connect(i),(e=n.call(this,r,i)||this)._merger=r,e}e=n.call(this,null)||this}return Q(t,n),t.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,n.prototype.destroy.call(this)},t}(At),StreamFilter:function(n){function t(){var e=this;if(!V().useLegacy){var s=V().context.audioContext,i=s.createMediaStreamDestination(),r=s.createMediaStreamSource(i.stream);return(e=n.call(this,i,r)||this)._stream=i.stream,e}e=n.call(this,null)||this}return Q(t,n),Object.defineProperty(t.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._stream=null,n.prototype.destroy.call(this)},t}(At),TelephoneFilter:function(n){function t(){if(!V().useLegacy){var e=V().context.audioContext,s=e.createBiquadFilter(),i=e.createBiquadFilter(),r=e.createBiquadFilter(),o=e.createBiquadFilter();return s.type="lowpass",it.setParamValue(s.frequency,2e3),i.type="lowpass",it.setParamValue(i.frequency,2e3),r.type="highpass",it.setParamValue(r.frequency,500),o.type="highpass",it.setParamValue(o.frequency,500),s.connect(i),i.connect(r),r.connect(o),n.call(this,s,o)||this}n.call(this,null)}return Q(t,n),t}(At)},Qn={__proto__:null,supported:Ce},ps=function(n){return Ls=n,n}(new Ii);gi.add(Ms);class kt{constructor(t,e,s,i,r,o,a,h){this.fn=t,this.buf=e,this.start_ms=s,this.end_ms=i,this.ret_ms=r,this.volume=o,this.pan=a,this.snd=h,this.stt=h?new ae(this):new Fi,this.#t=_.procID,h&&this.addSnd(h)}static#e=1;stt;loop=!1;#t;get procID(){return this.#t}addSnd(t){switch(this.loop=t.loop,this.stt.onLoad(this),this.pan!==0&&(t.filters=[new Jt.StereoFilter(this.pan)]),this.setVol=e=>t.volume=e,this.tw=()=>new oe(t),this.onPlayEnd=()=>{this.stt.onPlayEnd(this.buf),this.#s()},this.stop=()=>{t.stop(),this.#s()},this.destroy=()=>t.destroy(),this.buf){case ys:const e=Number(j.getVal("sys:sn.sound.BGM.vol_mul_talking")??1);if(e===1)break;kt.#e=e;const s=De[Pe];s&&s.setVol(this.volume*kt.#e);break;case Pe:t.volume=this.volume*kt.#e;break}}#s=()=>{if(this.#s=()=>{},kt.#e===1||this.buf!==ys)return;kt.#e=1;const t=De[Pe];t&&t.setVol(this.volume*kt.#e)};setVol(t){}tw(){}onPlayEnd(){}stop(){}destroy(){}}let gs,j,xt,ms,De,$e;const Pe="BGM",se="SE",ys="VOICE";let Ve=class W{constructor(t,e,s){this.hArg=t,this.buf=e,this.fn=s;const i=$(t,"start_ms",0),r=$(t,"end_ms",W.#t),o=$(t,"ret_ms",0),a=$(t,"pan",0),h=$(t,"speed",1);if(i<0)throw`[playse] start_ms:${i} が負の値です`;if(o<0)throw`[playse] ret_ms:${o} が負の値です`;if(0<r){if(r<=i)throw`[playse] start_ms:${i} >= end_ms:${r} は異常値です`;if(r<=o)throw`[playse] ret_ms:${o} >= end_ms:${r} は異常値です`}const l="const.sn.sound."+e+".";j.setVal_Nochk("save",l+"fn",s);const c=W.getVol(t,1);j.setVal_Nochk("save",l+"volume",c);const u=c*Number(j.getVal("sys:"+l+"volume",1)),p=O(t,"loop",!1);p?(W.#e[e]=s,j.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(W.#e))):W.delLoopPlay(e),j.setVal_Nochk("save",l+"start_ms",i),j.setVal_Nochk("save",l+"end_ms",r),j.setVal_Nochk("save",l+"ret_ms",o),j.setVal_Nochk("tmp",l+"playing",!0),j.flush();const g=ps.find(s);this.#s=new kt(s,e,i,r,o,u,a,g);const f={loop:p,speed:h,volume:u,loaded:(y,d)=>{if(!this.#s.stt.isDestroy){if(y){xt.errScript(`ロード失敗です SndBuf fn:${s} ${y}`,!1);return}d&&(this.#s.addSnd(d),a!==0&&(d.filters=[new Jt.StereoFilter(a)]),t.fnc?.())}}};let m="";if(0<i||r<W.#t){m=`${s};${i};${r};${o}`;const y=(f.sprites??={})[m]={start:i/1e3,end:r/1e3};f.preload=!0;const d=f.loaded;f.loaded=(b,k)=>{if(this.#s.stt.isDestroy)return;d(b,k);const v=k,w=v.duration;y.end<0&&(y.end+=w,v.removeSprites(m),v.addSprites(m,y)),y.end<=y.start&&xt.errScript(`[playse] end_ms:${r}(${y.end*1e3}) >= start_ms:${i} は異常値です`),y.end*1e3<=o&&xt.errScript(`[playse] end_ms:${r}(${y.end*1e3}) <= ret_ms:${o} は異常値です`),w<=y.start&&xt.errScript(`[playse] 音声ファイル再生時間:${w*1e3} <= start_ms:${i} は異常値です`),r!==W.#t&&w<=y.end&&xt.errScript(`[playse] 音声ファイル再生時間:${w*1e3} <= end_ms:${r} は異常値です`),v.play(m,x=>f.complete?.(x))}}else f.autoPlay=!0;if(p?o!==0&&(f.loop=!1,f.complete=async y=>{const d=y.duration,b=o/1e3,k=r/1e3;d<=b&&xt.errScript(`[playse] 音声ファイル再生時間:${d*1e3} <=  ret_ms:${o} は異常値です`),await y.play({...f,start:b,end:k<0?k+d:k,loop:!0,filters:a!==0?[new Jt.StereoFilter(a)]:[]})}):f.complete=()=>{We(this.#s,e),this.#s.onPlayEnd()},this.#n(),g){if(g.volume=u,m)this.#i(s,f),a!==0&&(g.filters=[new Jt.StereoFilter(a)]);else if(g.isPlayable){const y=g.options.source;!(y instanceof ArrayBuffer)||y.byteLength===0?(g.play(f),a!==0&&(g.filters=[new Jt.StereoFilter(a)])):this.#s.addSnd(ee.from({...f,url:g.options.url,source:y}))}this.needLoad=!1;return}if(this.needLoad=O(t,"join",!0)){const y=this.#s.procID+`loaded buf:${e} fn:${s}`;_.beginProc(y);const d=f.loaded;f.loaded=(b,k)=>{d(b,k),_.endProc(y)}}this.#i(s,f)}static#e={};static init(t,e,s,i,r){W.#e={},gs=t,j=e,xt=s,ms=i,De=r}static setEvtMng(t){$e=t}static delLoopPlay(t){delete W.#e[t];const e="const.sn.sound."+t+".";j.setVal_Nochk("save",e+"fn",""),j.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(W.#e)),j.flush()}static getVol(t,e){const s=$(t,"volume",e);return s<0?0:s>1?1:s}static xchgbuf({buf:t=se,buf2:e=se}){if(t===e)throw`[xchgbuf] buf:${t} が同じ値です`;const s="const.sn.sound."+t+".",i=Number(j.getVal("save:"+s+"volume")),r=String(j.getVal("save:"+s+"fn")),o="const.sn.sound."+e+".",a=Number(j.getVal("save:"+o+"volume")),h=String(j.getVal("save:"+o+"fn"));j.setVal_Nochk("save",s+"volume",a),j.setVal_Nochk("save",o+"volume",i),j.setVal_Nochk("save",s+"fn",h),j.setVal_Nochk("save",o+"fn",r),t in W.#e!=e in W.#e&&(t in W.#e?(delete W.#e[t],W.#e[e]=r):(delete W.#e[e],W.#e[t]=h),j.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(W.#e))),j.flush()}static#t=999e3;#s;needLoad;#n=()=>{ps.volumeAll=Number(j.getVal("sys:sn.sound.global_volume",1)),this.#n=()=>{}};#i(t,e){const s=gs.searchPath(t,Z.SOUND);if(!s.endsWith(".bin")){e.url=s,ee.from(e);return}new St().add({name:t,url:s,xhrType:B.XHR_RESPONSE_TYPE.BUFFER}).use(async(i,r)=>{try{i.data=await ms.decAB(i.data)}catch(o){xt.errScript(`Sound ロード失敗ですc fn:${i.name} ${o}`,!1)}r()}).load((i,r)=>{e.source=r[t]?.data,ee.from(e)})}setVol(t){this.#s.setVol(t)}ws=t=>this.#s.stt.ws(this.#s,t);stopse({buf:t=se}){We(this.#s,t),this.#s.stt.stopse(this.#s)}fade=t=>this.#s.stt.fade(this.#s,t);wf=t=>this.#s.stt.wf(this.#s,t);stopfadese=t=>this.#s.stt.stopfadese(this.#s,t)};function We({loop:n},t){if(n){Ve.delLoopPlay(t);return}const e="const.sn.sound."+t+".";j.setVal_Nochk("tmp",e+"playing",!1),j.flush()}class Fi{onLoad(t){t.stt=new ae(t)}stopse(t){t.stt=new It(t,!1)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class ae{constructor(t){this.si=t}onLoad(){}stopse(t){t.stt=new It(t)}ws(t,e){if(t.loop)return!1;t.stt=new Mi(t);const s=O(e,"canskip",!1),i=O(e,"stop",!0);if(s&&$e.isSkipping)return i?t.stt.stopse(t):t.stt.onPlayEnd=()=>{},!1;const{buf:r=se}=e,o=()=>{We(t,r),t.onPlayEnd(),i?t.stt.stopse(t):t.stt.onPlayEnd=()=>{}};return _.beginProc(t.procID+"ws",o,!0,s?o:void 0),!0}onPlayEnd(){}fade(t,e){const{buf:s=se}=e,i="const.sn.sound."+s+".volume",r=Ve.getVol(e,NaN);j.setVal_Nochk("save",i,r);const o=r*Number(j.getVal("sys:"+i,1)),a=O(e,"stop",r===0);a&&Ve.delLoopPlay(s),j.flush();const h=$(e,"time",NaN),l=$(e,"delay",0);if(h===0&&l===0||$e.isSkipping){t.setVol(o),t.stt=a?new It(t):new ae(t);return}const c=t.tw();c&&(R.setTwProp(c,e).to({volume:o},h).onComplete(()=>{Cs(c),t.stt.compFade(s),t.stt=a?new It(t):new ae(t)}).start(),t.stt=new ji(c,t))}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class Mi{constructor(t){this.si=t}onLoad(){}stopse(t){t.stt=new It(t)}ws=()=>!1;onPlayEnd(){_.notifyEndProc(this.si.procID+"ws")}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class ji{constructor(t,e){this.tw=t,this.si=e}onLoad(){}stopse(t){this.stopfadese(),t.stt=new It(t)}ws=()=>!1;onPlayEnd(){}fade(){}wf(t,e){t.stt=new Ri(t);const s=O(e,"canskip",!1);if(s&&$e.isSkipping)return this.stopfadese(),!1;const i=()=>this.stopfadese();return _.beginProc(t.procID+"wf",i,!0,s?i:void 0),!0}compFade(){}stopfadese=()=>this.si.stop();isDestroy=!1}class Ri{constructor(t){this.si=t}onLoad(){}stopse(t){this.stopfadese(),t.stt=new It(t)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){_.notifyEndProc(this.si.procID+"wf")}stopfadese=()=>this.si.stop();isDestroy=!1}class It{constructor(t,e=!0){this.si=t,this.stop=e,e&&(t.stop(),t.loop&&(t.destroy(),t.destroy=()=>{}))}onLoad(){}stopse(){}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!0}const Oe="compChIn";class Y{constructor(t,e,s,i,r,o,a){this.cfg=t,this.hTag=e,this.main=s,this.val=i,this.prpPrs=r,this.sndMng=o,this.sys=a,e.let_ml=l=>this.#R(l),e.endlet_ml=()=>!1,e.dump_stack=()=>this.#C(),e.dump_script=l=>this.#G(l),e.else=e.elsif=e.endif=()=>this.#Q(),e.if=l=>this.#Z(l),e.call=l=>this.#U(l),e.jump=l=>this.#M(l),e.pop_stack=l=>this.#L(l),e.return=l=>this.#k(l),e.bracket2macro=l=>this.#dt(l),e.char2macro=l=>this.#pt(l),e.endmacro=l=>this.#k(l),e.macro=l=>this.#_t(l),e.load=l=>this.#vt(l),e.reload_script=l=>this.#wt(l),e.record_place=()=>this.#bt(),e.save=l=>this.#xt(l),t.oCfg.debug.token&&(this.#z=l=>{l.trim()!==""&&console.log(`🌱 トークン ${this.#t}:${this.#n} (i:${this.#s} cs:${this.#i.length}) %c【${l}】`,"background-color:#350;")}),t.oCfg.debug.tag&&(this.#D=l=>console.log(`🌲 タグ解析 ${this.#t}:${this.#n} (i:${this.#s} cs:${this.#i.length}) %c[${l} %o]`,"background-color:#30B;",this.#h.hPrm)),i.defTmp("const.sn.aIfStk.length",()=>this.#x.length),i.defTmp("const.sn.vctCallStk.length",()=>this.#i.length),this.#o=new li(t);const h=t.oCfg.init.escape;if(this.#o.setEscape(h),ct.setEscape(h),T.isDbg){a.addHook((c,u)=>this.#c[c]?.(u)),this.isBreak=this.#a;const l=this.analyzeInit;this.analyzeInit=()=>{this.analyzeInit=()=>{},this.sys.send2Dbg("hi",{})},this.#c.auth=c=>{const u=c.hBreakpoint.hFn2hLineBP;for(const[p,g]of Object.entries(u))this.#b(p,g);Y.#y={};for(const p of c.hBreakpoint.aFunc)Y.#y[p.name]=1;if(c.stopOnEntry){for(;;){let p=this.nextToken();if(!p)break;const g=p.charCodeAt(0);if(g===91||g===38||g===42&&p.length===1)break;g===10&&(this.#n+=p.length)}this.sys.callHook("stopOnEntry",{}),this.analyzeInit=l,this.analyzeInit()}else this.noticeWait=()=>{this.noticeWait=()=>{},this.sys.callHook("stopOnEntry",{})},this.analyzeInit=l,this.analyzeInit()}}else this.recodeDesign=()=>{}}#e={aToken:[""],len:1,aLNum:[1]};#t="";get scriptFn(){return this.#t}#s=0;get idxToken(){return this.#s}subIdxToken(){--this.#s}#n=0;get lineNum(){return this.#n}addLineNum=t=>this.#n+=t;jumpJustBefore(){this.#E(this.#t,"",--this.#s)}#i=[];#o;#h=new ci;noticeWait=()=>{};#b(t,e){Y.#T[this.#u(t)]=e}destroy(){this.isBreak=this.#bt=()=>!1}#c={disconnect:()=>{Y.#T={},Y.#y={},this.isBreak=()=>!1,this.#c.continue({}),this.#m=0},restart:()=>this.isBreak=()=>!1,add_break:t=>this.#b(t.fn,t.o),data_break:t=>{this.#m===0&&(this.#m=1,this.main.setLoop(!1,`変数 ${t.dataId}【${t.old_v}】→【${t.new_v}】データブレーク`),this.sys.callHook("stopOnDataBreakpoint",{}),this.sys.send2Dbg("stopOnDataBreakpoint",{}))},set_func_break:t=>{Y.#y={};for(const e of t.a)Y.#y[e.name]=1;this.sys.send2Dbg(t.ri,{})},stack:t=>this.sys.send2Dbg(t.ri,{a:this.#S()}),eval:t=>{this.sys.send2Dbg(t.ri,{v:this.prpPrs.parse(t.txt)})},continue:()=>{this.#l()||(this.#s-=this.#v,this.#m=3,this.main.setLoop(!0),this.main.resume())},stepover:t=>this.#f(t),stepin:()=>{if(this.#l())return;const t=this.#e.aToken[this.#s-this.#v];this.sys.callHook(`stopOnStep${this.#mt.test(t??"")?"In":""}`,{}),this.#s-=this.#v,this.#m=this.#m===1?4:5,this.main.setLoop(!0),this.main.resume()},stepout:t=>{this.#l()||(this.#i.length>0?this.#p(!0):this.#f(t))},pause:()=>{this.#m=4,this.main.setLoop(!1,"一時停止"),this.sys.send2Dbg("stopOnStep",{})},stopOnEntry:()=>{this.#m=4,this.main.setLoop(!1,"一時停止"),this.sys.send2Dbg("stopOnEntry",{})}};#r=t=>this.cfg.searchPath(t,Z.SCRIPT);static#d=/(.+)\/crypto_prj\/([^\/]+)\/[^\.]+(\.\w+)/;#u=t=>(this.sys.pathBaseCnvSnPath4Dbg+this.#r(t)).replace(Y.#d,`$1/prj/$2/${this.#t}$3`);cnvPath4Dbg=t=>this.sys.pathBaseCnvSnPath4Dbg+t.replace("/crypto_prj/","/prj/");#f(t){if(this.#l())return;const e=this.#e.aToken[this.#s-this.#v];this.#mt.test(e??"")?this.#p(!1):(this.sys.callHook("stopOnStep",{}),this.#c.stepin(t))}#p(t){this.sys.callHook(`stopOnStep${t?"Out":""}`,{}),this.#g=this.#i.length-(t?1:0),this.#s-=this.#v,this.#m=t?7:6,this.main.setLoop(!0),this.main.resume()}#g=0;get#v(){return this.#m===2||this.#m===4?1:0}#l(){return this.#s<this.#e.len?!1:(this.sys.callHook("stopOnEntry",{}),this.main.setLoop(!1,"スクリプト終端です isIdxOverLast"),!0)}static#T={};static#y={};#m=0;isBreak=t=>!1;#a(t){switch(this.#m){case 6:this.#$(),this.#m=7;break;case 7:if(this.#i.length!==this.#g)break;return this.#m=4,this.main.setLoop(!1,"ステップ実行"),this.sys.send2Dbg("stopOnStep",{}),!0;case 5:this.#$(),this.#m=4;break;case 4:return this.#$(),this.main.setLoop(!1,"ステップ実行"),this.sys.send2Dbg("stopOnStep",{}),!0;case 3:this.#$(),this.#m=0;break;default:if(Ie(t)in Y.#y)return this.#m=2,this.main.setLoop(!1,`関数 ${t} ブレーク`),this.sys.callHook("stopOnBreakpoint",{}),this.sys.send2Dbg("stopOnBreakpoint",{}),!0;{const e=Y.#T[this.#u(this.#t)];if(!e)break;const s=e[this.#n];if(!s)break;if(s.condition){if(!this.prpPrs.parse(s.condition))break}else if("hitCondition"in s&&--s.hitCondition>0)break;const i=this.#m===0;this.#m=2,this.main.setLoop(!1,i?(s.condition?"条件":"ヒットカウント")+"ブレーク":"ステップ実行");const r=i?"stopOnBreakpoint":"stopOnStep";this.sys.callHook(r,{}),this.sys.send2Dbg(r,{})}return!0}return!1}#$(){const t=Y.#T[ve(this.#t)]?.[this.#n];t?.hitCondition&&--t.hitCondition}#S(){const t=this.#m===3?1:0,e=this.#e.aToken[this.#s-1+t],s=this.#u(this.#t),i=Ie(e),r=i?`[${i}]`:e,o=this.val.getVal("mp:const.sn.macro")??"{}";if(this.#s===0)return[{fn:s,ln:1,col:1,nm:r,ma:o}];const a=this.#_(this.#e,this.#s),h=[{fn:s,ln:a.ln,col:a.col_s+1,nm:r,ma:o}],l=this.#i.length;if(l===0)return h;for(let c=l-1;c>=0;--c){const u=this.#i[c],p=this.#I[u.fn];if(!p)continue;const g=p.aToken[u.idx-1];if(!g)continue;const f=this.#_(p,u.idx),m=Ie(g);h.push({fn:this.#u(u.fn),ln:f.ln,col:f.col_s+1,nm:m?`[${m}]`:g,ma:u.csArg[":hMp"]["const.sn.macro"]??"{}"})}return h}#D=t=>{};async タグ解析(t,e){const s=this.hTag[t];if(!s)throw`未定義のタグ【${t}】です`;this.#h.parse(e),this.#D(t);const i=this.#h.hPrm;if(i.cond){const l=i.cond.val;if(!l||l.startsWith("&"))throw"属性condは「&」が不要です";const c=this.prpPrs.parse(l),u=String(c);if(u==="null"||u==="undefined"||!c)return!1}let r={};const o=this.#i.length,a=o===0?{}:this.#i[o-1].csArg;if(this.#h.isKomeParam){if(o===0)throw"属性「*」はマクロのみ有効です";r={...a}}r[":タグ名"]=t;for(const[l,{val:c,def:u}]of Object.entries(i)){let p=c;if(p?.startsWith("%")){if(o===0)throw"属性「%」はマクロ定義内でのみ使用できます（そのマクロの引数を示す簡略文法であるため）";const g=a[p.slice(1)];if(g){r[l]=g;continue}if(u===void 0||u==="null")continue;p=u}if(p=this.prpPrs.getValAmpersand(p??""),p!=="undefined"){r[l]=p;continue}u!==void 0&&(p=this.prpPrs.getValAmpersand(u),p!=="undefined"&&(r[l]=p))}if(_.needGoTxt&&this.#V.has(t)){const{promise:l,resolve:c}=Promise.withResolvers();_.beginProc(Oe,c,!1),_.goTxt(),this.val.saveKidoku(),await l}const h=this.#A[t];return h&&O(r,"canskip",this.#q[t]??!0)&&this.#j.isSkipping?h(i):s(r)}#V=new Set(["trans","wt","wait_tsy","wv","l","p","s","wait","waitclick","wb","wf","wl","ws","quake","wq"]);#A={wt:()=>R.finish_trans(),wait_tsy:t=>this.hTag.stop_tsy(t),wait:()=>!1,wb:()=>this.hTag.stopfadese({buf:Pe}),wq:()=>this.hTag.stop_quake({}),quake:()=>!1};#q={wt:!0,wait_tsy:!0,wv:!0,wait:!0,playbgm:!1,playse:!0,wb:!1,wf:!1,ws:!1,wq:!0};#j;#O;setOtherObj(t,e){this.#j=t,this.#O=e}#R(t){const{name:e}=t;if(!e)throw"nameは必須です";let s="";const i=this.#e.len;for(;this.#s<i&&(s=this.#e.aToken[this.#s],s==="");++this.#s);return t.text=s,t.cast="str",this.hTag.let(t),this.#s+=2,this.#n+=(s.match(/\n/g)??[]).length,!1}#C(){if(this.#s===0)return console.group(`🥟 [dump_stack] スクリプト現在地 fn:${this.#t} line:1 col:0`),console.groupEnd(),!1;const t=this.#_(this.#e,this.#s),e=`スクリプト現在地 fn:${this.#t} line:${t.ln} col:${t.col_s+1}`;console.group(`🥟 [dump_stack] ${e}`);const s=this.#i.length;if(s>0){console.info(e);for(let i=s-1;i>=0;--i){const r=this.#i[i],o=r.csArg[":hMp"],a=o?o[":タグ名"]:void 0,h=r.csArg[":タグ名"]??"",l=this.#_(this.#I[r.fn],r.idx);console.info(`${s-i}つ前のコール元 fn:${r.fn} line:${l.ln} col:${l.col_s+1}`+(a?"（["+a+"]マクロ内）":" ")+`で [${h} ...]をコール`)}}return console.groupEnd(),!1}#_(t,e){const s={ln:1,col_s:0,col_e:0};if(!t)return s;let i=e-1;const r=s.ln=t.aLNum[i];for(;t.aLNum[i]===r;){if(!t.aToken[i].startsWith(`
`)){const o=t.aToken[i].length;s.col_e>0&&(s.col_s+=o),s.col_e+=o}if(--i<0)break}return s}#G(t){const{set_fnc:e,break_fnc:s}=t;if(!e)throw"set_fncは必須です";if(this.#P=globalThis[e],!this.#P){if(O(t,"need_err",!0))throw`HTML内に関数${e}が見つかりません`;return this.#P=()=>{},!1}if(this.noticeBreak=i=>{this.#J!==this.#t&&(this.#J=this.#t,this.#P(this.#F[this.#t]??=this.#e.aToken.join(""))),this.#w(this.#n,i)},this.noticeBreak(!0),!s)return!1;if(this.#w=globalThis[s],!this.#w){if(O(t,"need_err",!0))throw`HTML内に関数${s}が見つかりません`;this.#w=()=>{}}return!1}#P=()=>{};#w=()=>{};#J="";#F={};noticeBreak=t=>{};#st=5;dumpErrForeLine(){if(this.#s===0){console.group(`🥟 Error line (from 0 rows before) fn:${this.#t}`),console.groupEnd();return}let t="";for(let o=this.#s-1;o>=0&&(t=this.#e.aToken[o]+t,!((t.match(/\n/g)??[]).length>=this.#st));--o);const e=t.split(`
`).slice(-this.#st),s=e.length;console.group(`🥟 Error line (from ${s} rows before) fn:${this.#t}`);const i=String(this.#n).length,r=this.#_(this.#e,this.#s);for(let o=0;o<s;++o){const a=this.#n-s+o+1,h=`${String(a).padStart(i," ")}: %c`,l=e[o],c=l.length>75?l.slice(0,75)+"…":l;o===s-1?console.info(h+c.slice(0,r.col_s)+"%c"+c.slice(r.col_s),"color: black; background-color: skyblue;","color: black; background-color: pink;"):console.info(h+c,"color: black; background-color: skyblue;")}console.groupEnd()}#x=[-1];#Q(){const t=this.#x[0];if(!t)throw"this.#aIfStk が異常です";if(t===-1)throw"ifブロック内ではありません";return this.#s=t,this.#x.shift(),!1}#Z(t){const{exp:e}=t;if(!e)throw"expは必須です";if(e.startsWith("&"))throw"属性expは「&」が不要です";let s=0,i=this.prpPrs.parse(e)?this.#s:-1;const r=this.#e.aLNum[this.#s];let o=this.#n-(r||0);const a=this.#e.len;for(;this.#s<a;++this.#s){const h=this.#e.aLNum[this.#s];this.#e.aLNum[this.#s]=(h||0)+o;const l=this.#e.aToken[this.#s];if(!l)continue;const c=l.charCodeAt(0);if(c===10){this.#n+=l.length;continue}if(c!==91)continue;const[u,p]=cs(l);if(!(u in this.hTag))throw`未定義のタグ[${u}]です`;switch(this.#h.parse(p),u){case"if":++s;break;case"elsif":if(s>0||i>-1)break;const g=this.#h.hPrm.exp?.val;if(!g)throw"expは必須です";if(g.startsWith("&"))throw"属性expは「&」が不要です";this.prpPrs.parse(g)&&(i=this.#s+1);break;case"else":if(s>0)break;i===-1&&(i=this.#s+1);break;case"endif":if(s>0){--s;break}return i===-1?(++this.#s,this.#e.aLNum[this.#s]+=o):(this.#x.unshift(this.#s+1),this.#s=i,this.#n=this.#e.aLNum[this.#s]),!1}}throw"[endif]がないままスクリプト終端です"}#U(t){O(t,"count",!1)||this.#ot();const{fn:e}=t;return e&&this.#r(e),this.#B({...t,":hEvt1Time":P.popLocalEvts()}),O(t,"clear_local_event",!1)&&this.hTag.clear_event({}),this.#E(e,t.label)}#B(t){const e={...t,":hMp":this.val.cloneMp(),":lenIfStk":this.#x.length};this.#e.aLNum[this.#s]=this.#n,this.#tt||(e[":resvToken"]="",this.#H()),this.#i.push(new fs(this.#t,this.#s,e)),this.#x.unshift(-1)}#M(t){return O(t,"count",!0)||this.#ot(),this.#x[0]=-1,this.#E(t.fn,t.label)}#L(t){if(O(t,"clear",!1))this.#i=[];else if(!this.#i.pop())throw"スタックが空です";return this.#H(),this.#x=[-1],this.val.setMp({}),!1}#k(t){const e=this.#i.pop();if(!e)throw"スタックが空です";const s=e.csArg;this.#x=this.#x.slice(-s[":lenIfStk"]);const i=s[":hMp"];i&&this.val.setMp(i);const r=s[":resvToken"];r?this.nextToken=()=>(this.#H(),r):this.#H(),s[":hEvt1Time"]&&P.pushLocalEvts(s[":hEvt1Time"]);const{fn:o,label:a}=t;return o||a?this.#E(o,a):e.fn in this.#I?(this.#nt(e),!1):this.#E(e.fn,"",e.idx)}#tt="";#H(){this.#tt="",this.nextToken=this.#W}#K="";#E(t="",e="",s=0){if(T.debugLog&&console.log(`📜 %c1:jumpWork%c fn:${t} lbl:${e} idx:${s}`,"color:#3B0;",""),!t&&!e&&this.main.errScript("[jump系] fnまたはlabelは必須です"),e?(e.startsWith("*")||this.main.errScript("[jump系] labelは*で始まります"),this.#K=e,this.#K.startsWith("**")||(this.#s=s)):(this.#K="",this.#s=s),!t)return this.analyzeInit(),!1;if(t.includes("@"))throw"[jump系] fn には文字「@」は禁止です";const i=this.#r(t);if(t===this.#t)return this.analyzeInit(),!1;this.#t=t;const r=this.#I[t];if(r)return this.#e=r,this.analyzeInit(),!1;const o=`jumpWork fn:${t}`;_.beginProc(o);let a="";const h=new St;try{a=this.#r(t+"@"),h.add({name:t+":base",url:i}),h.add({name:t,url:a})}catch{h.add({name:t,url:i})}return h.use(async(l,c)=>{try{l.data=await this.sys.dec(l.extension,l.data)}catch(u){this.main.errScript(`[jump系]snロード失敗です fn:${l.name} ${u}`,!1)}c()}).load((l,c)=>{if(_.endProc(o),a){const u=c[t+":base"].data,p=c[t].data,g=u.split(`
`),f=p.split(`
`),m=g.length,y=f.length;for(let d=0;d<y&&d<m;++d)f[d]||=g[d];c[t].data=f.join(`
`),delete c[t+":base"]}this.nextToken=this.#W,this.#n=1,this.#lt(c[t].data),this.hTag.record_place({}),this.analyzeInit()}),!0}analyzeInit(){T.debugLog&&console.log(`📜 %c9:analyzeInit%c fn:${this.#t} lbl:${this.#K} idx:${this.#s}`,"color:#3B0;","");const t=this.#ht(this.#e,!!this.val.getVal("mp:const.sn.macro.name"),this.#n,this.#K,this.#s);this.#s=t.idx,this.#n=t.ln}nextToken=()=>"";#W(){if(this.#N())return"";this.#ft(),this.#e.aLNum[this.#s]||=this.#n;const t=this.#e.aToken[this.#s];return this.#z(t),++this.#s,t}#z=t=>{};#N(){return this.#s<this.#e.len?!1:(this.main.errScript("スクリプト終端です errOverScr"),!0)}#Y=/(\*{2,})([^\|]*)/;#at=/^\[macro\s/;#it=/^\[endmacro[\s\]]/;#ht(t,e,s,i,r){const o=t.aToken.length;if(!i){if(this.#N())return{idx:r,ln:s};if(t.aLNum[r])s=t.aLNum[r];else{s=1;for(let c=0;c<r;++c){t.aLNum[c]||=s;const u=t.aToken[c];u.startsWith(`
`)?s+=u.length:s+=(u.match(/\n/g)??[]).length}t.aLNum[r]=s}return{idx:r,ln:s}}t.aLNum[0]=1;const a=i.match(this.#Y);if(a){i=a[1];let c=r;switch(a[2]){case"before":for(;t.aToken[--c]!==i;)c===0&&lt.myTrace("[jump系 無名ラベルbefore] "+s+"行目以前で"+(e?"マクロ内に":"")+"ラベル【"+i+"】がありません","ET"),e&&t.aToken[c].search(this.#at)>-1&&lt.myTrace("[jump系 無名ラベルbefore] マクロ内にラベル【"+i+"】がありません","ET");return{idx:c+1,ln:t.aLNum[c]};case"after":for(;t.aToken[++c]!==i;)c===o&&lt.myTrace("[jump系 無名ラベルafter] "+s+"行目以後でマクロ内にラベル【"+i+"】がありません","ET"),t.aToken[c].search(this.#it)>-1&&lt.myTrace("[jump系 無名ラベルafter] "+s+"行目以後でマクロ内にラベル【"+i+"】がありません","ET");return{idx:c+1,ln:t.aLNum[c]};default:lt.myTrace("[jump系] 無名ラベル指定【label="+i+"】が間違っています","ET")}}s=1;const h=new RegExp("^"+i.replaceAll("*","\\*")+"(?=\\s|;|\\[|\\||$)");let l=!1;for(let c=0;c<o;++c){t.aLNum[c]||=s;const u=t.aToken[c];if(l){this.#o.testTagEndLetml(u)?l=!1:s+=(u.match(/\n/g)??[]).length;continue}const p=u.charCodeAt(0);if(p===10){s+=u.length;continue}if(p===42){if(u.search(h)>-1)return{idx:c+1,ln:s};continue}p===91&&(s+=(u.match(/\n/g)??[]).length,this.#o.testTagLetml(u)&&(l=!0))}throw l?"[let_ml]の終端・[endlet_ml]がありません":(lt.myTrace(`[jump系] ラベル【${i}】がありません`,"ET"),"Dummy")}#I=Object.create(null);#lt(t){let e="";try{e="ScriptIterator.resolveScript";const s=this.#o.resolveScript(t);e="ScriptIterator.replaceScript_Wildcard",this.#ut(s),this.#I[this.#t]=this.#e=s}catch(s){s instanceof Error?e+=`例外 mes=${s.message}(${s.name})`:e=String(s),this.main.errScript(e,!1)}this.val.touchAreaKidoku(this.#t)}#nt(t){this.#t=t.fn,this.#s=t.idx;const e=this.#I[this.#t];e&&(this.#e=e),this.#n=this.#e.aLNum[t.idx]}#ct=/^\[(call|loadplugin)\s/;#rt=/\bfn\s*=\s*[^\s\]]+/;#ut(t){for(let e=t.len-1;e>=0;--e){const s=t.aToken[e];if(!this.#ct.test(s))continue;const[i,r]=cs(s);this.#h.parse(r);const o=this.#h.hPrm.fn;if(!o)continue;const{val:a}=o;if(!a||!a.endsWith("*"))continue;t.aToken.splice(e,1,"	","; "+s),t.aLNum.splice(e,1,NaN,NaN);const h=i==="loadplugin"?Z.CSS:Z.SN,l=this.cfg.matchPath("^"+a.slice(0,-1)+".*",h);for(const c of l){const u=s.replace(this.#rt,"fn="+decodeURIComponent(ve(c[h])));t.aToken.splice(e,0,u),t.aLNum.splice(e,0,NaN)}}t.len=t.aToken.length}#ft(){const t=this.val.touchAreaKidoku(this.#t);if(this.#i.length>0){t.record(this.#s);return}this.#X=t.search(this.#s),this.val.setVal_Nochk("tmp","const.sn.isKidoku",this.#X),!this.#X&&t.record(this.#s)}#X=!1;get isKidoku(){return this.#X}#ot(){this.val.getAreaKidoku(this.#t)?.erase(this.#s),this.#X=!1}get isNextKidoku(){let t=this.#t,e=this.#s,s=this.#e.len;if(this.#i.length>0){const r=this.#i[0];t=r.fn,e=r.idx;const o=this.#I[t];o&&(s=o.len)}const i=this.val.getAreaKidoku(t);return e===s?!1:i.search(e)}get normalWait(){return this.#X?this.val.tagCh_doWait_Kidoku?this.val.tagCh_msecWait_Kidoku:0:this.val.tagCh_doWait?this.val.tagCh_msecWait:0}#dt(t){return this.#o.bracket2macro(t,this.hTag,this.#e,this.#s),!1}#pt(t){return this.#o.char2macro(t,this.hTag,this.#e,this.#s),!1}#gt=/["'#;\\]　]+/;#_t(t){const{name:e}=t;if(!e)throw"nameは必須です";if(e in this.hTag)throw`[${e}]はタグかすでに定義済みのマクロです`;if(this.#gt.test(e))throw`[${e}]はマクロ名として異常です`;const s=this.#n,i=new fs(this.#t,this.#s);for(this.#yt+="|"+e,this.#mt=new RegExp(`\\[(${this.#yt})\\b`),this.hTag[e]=r=>(r.design_unit=t.design_unit,this.#B(r),this.val.setMp(r),this.val.setVal_Nochk("mp","const.sn.macro",JSON.stringify({name:t.name})),this.val.setVal_Nochk("mp","const.sn.me_call_scriptFn",this.#t),this.#n=s,this.#nt(i),!1);this.#s<this.#e.len;++this.#s){this.#e.aLNum[this.#s]||=this.#n;const r=this.#e.aToken[this.#s];if(r.search(this.#it)>-1)return++this.#s,!1;const o=r.charCodeAt(0);o===10?this.#n+=r.length:o===91&&(this.#n+=(r.match(/\n/g)??[]).length)}throw`マクロ[${e}]定義の終端・[endmacro]がありません`}#yt="call";#mt=/\[(call)\b/;#vt(t){if("fn"in t!="label"in t)throw"fnとlabelはセットで指定して下さい";const e=$(t,"place",0),s=this.val.getMark(e);return this.loadFromMark(t,s,2)}loadFromMark(t,e,s=0){this.hTag.clear_event({}),this.val.mark2save(e),this.val.setMp({}),this.#O.recPagebreak();let i=[];s!==1&&(i=this.sndMng.playLoopFromSaveObj(s===2)),O(t,"do_rec",!0)&&(this.#et={hSave:this.val.cloneSave(),hPages:{...e.hPages},aIfStk:[...e.aIfStk]});const r={enabled:this.val.getVal("save:const.sn.autowc.enabled"),text:this.val.getVal("save:const.sn.autowc.text"),time:Number(this.val.getVal("save:const.sn.autowc.time"))};this.hTag.autowc(r),this.#x=[...this.#et.aIfStk],this.#i=[],R.stopAllTw();const o=Promise.allSettled([...i,...this.#O.playback(this.#et.hPages)]).then(()=>this.#O.cover(!1)).catch(p=>console.error("loadFromMark e:%o",p)),{index:a,fn:h}=t;if(a)return T.debugLog&&console.log(`📜 %cloadFromMark index:${a} move!%c fn:${h}`,"color:#3B0;",""),o.then(()=>{this.#E(h,"",a)||this.main.resume()}),!0;this.#O.cover(!0);const l=String(this.val.getVal("save:const.sn.scriptFn")),c=Number(this.val.getVal("save:const.sn.scriptIdx"));delete this.#I[l];const{label:u}=t;return u?o.then(()=>{this.#t=l,this.#s=c,this.hTag.call({fn:h,label:u})||this.main.resume()}):o.then(()=>{this.#E(l,"",c)||this.main.resume()}),!0}#wt(t){const e=this.val.getMark(0);delete this.#I[ve(e.hSave["const.sn.scriptFn"])];const s={};for(const i in this.#I)try{this.#r(i+"@")}catch{s[i]=this.#I[i]}return this.#I=s,t.do_rec=!1,this.loadFromMark(t,e,1)}#et={hSave:{},hPages:{},aIfStk:[-1]};#bt=()=>{const{fn:t,idx:e}=this.nowScrIdx();return this.val.setVal_Nochk("save","const.sn.scriptFn",t),this.val.setVal_Nochk("save","const.sn.scriptIdx",e),this.#et={hSave:this.val.cloneSave(),hPages:this.#O.record(),aIfStk:this.#x.slice(this.#i.length)},!1};nowScrIdx(){if(this.#i.length===0)return{fn:this.#t,idx:this.#s};const t=this.#i[0];return{fn:t.fn,idx:t.idx}}nowMark(){return{...this.#et}}nowScrFnLn(){const{fn:t,idx:e}=this.nowScrIdx(),s=this.#I[t],i=this.#_(s,e);return{fn:t,...i}}#xt(t){if(!("place"in t))throw"placeは必須です";const e=Number(t.place);delete t[":タグ名"],delete t.place,t.text=t.text??"",this.#et.json=t,this.val.setMark(e,this.#et);const s=Number(this.val.getVal("sys:const.sn.save.place"));return e===s&&this.val.setVal_Nochk("sys","const.sn.save.place",s+1),!1}recodeDesign(t){let e="",s=0;const i=this.#i.length;if(t.design_unit&&i>0){const h=this.#i[0];e=h.fn,s=h.idx}else e=this.#t,s=this.#s;t[":path"]=this.#u(e);const r=this.#I[e],o=this.#_(r,s);t[":ln"]=o.ln,t[":col_s"]=o.col_s,t[":col_e"]=o.col_e;const a=s-1;t[":idx_tkn"]=a,t[":token"]=r.aToken[a],this.sys.send2Dbg("_recodeDesign",t)}replace(t,e){this.#e.aToken[t]=e}}const Xn=Object.freeze(Object.defineProperty({__proto__:null,RPN_COMP_CHIN:Oe,ScriptIterator:Y},Symbol.toStringTag,{value:"Module"}));class L extends U{constructor(t,e,s){super(),this.ctn=t,this.canFocus=e,this.sys=s,this.#i.classList.add("sn_tx"),this.#i.style.position="absolute",L.#t.view.parentElement.appendChild(this.#i),this.addChild(this.#o),this.addChild(this.#h),this.#h.name="grpDbgMasume",this.noticeCompTxt=s.isApp&&L.#e.oCfg.debug.dumpHtm?()=>{_.notifyEndProc(Oe);const i=this.#i.innerHTML;if(i==="")return;const{fn:r,ln:o}=L.#n.nowScrFnLn(),a=`dumpHtm ${t.name.slice(0,-7).replaceAll(":","=")}(fn=${r} line=${o})`;s.outputFile(s.path_downloads+a+".htm",`<!doctype html><html><head><meta charset=utf-8><title>${a}</title>
<h1>${a}</h1>${i.replaceAll(/ class="sn_ch"|animation-delay: \d+ms; ?| data-add="{&quot;ch_in_style&quot;:&quot;default&quot;, &quot;ch_out_style&quot;:&quot;default&quot;}"/g,"").replaceAll(' style=""',"").replaceAll(/(<\/?ruby>)/g,`
$1
`).replaceAll(/<(br|\/span)>/g,`<$1>
`)}`)}:()=>_.notifyEndProc(Oe)}static#e;static#t;static init(t,e){L.#e=t,L.#t=e}static#s;static#n;static setEvtMng(t,e){L.#s=t,L.#n=e}static destroy(){L.#A=Object.create(null),L.#j=Object.create(null),L.delBreak()}#i=document.createElement("span");#o=new U;#h=new _t;static#b={"background-color":0,"border-bottom-width":0,"border-left-width":0,"border-right-width":0,"border-top-width":0,"margin-bottom":0,"margin-left":0,"margin-right":0,"margin-top":0};#c=new xi;noticeCompTxt=()=>{};#r={fontsize:24,$width:0,$height:0,pad_left:0,pad_right:0,pad_top:0,pad_bottom:0};lay(t){const e=this.#i.style;if("style"in t)if(t.style){const s=document.createElement("span");s.style.cssText=t.style;const i=s.style.length;for(let r=0;r<i;++r){const o=s.style[r];if(o in L.#b){lt.myTrace(`${o}は指定できません`,"W");continue}e[o]=s.style[o]}!s.style.opacity&&"alpha"in t&&(e.opacity=String(this.ctn.alpha))}else this.#i.style.cssText="";else"alpha"in t&&(e.opacity=String(this.ctn.alpha));if("width"in t&&(e.width=(t.width??"0")+"px"),"height"in t&&(e.height=(t.height??"0")+"px"),"pl"in t&&(e.paddingLeft=(t.pl??"0")+"px"),"pr"in t&&(e.paddingRight=(t.pr??"0")+"px"),"pt"in t&&(e.paddingTop=(t.pt??"0")+"px"),"pb"in t&&(e.paddingBottom=(t.pb??"0")+"px"),this.#c.lay(t),this.#u(),this.#f=this.ctn.position.x,e.transformOrigin=`${this.ctn.pivot.x}px ${this.ctn.pivot.y}px`,this.cvsResize(),e.display=this.ctn.visible?"inline":"none",":redraw"in t&&this.#m>0){const s=[this.#i.innerHTML.replaceAll(/(animation-delay: )\d+ms/g,"$10ms"),`<span class='sn_ch' data-add='{"ch_in_style":"default"}'>&emsp;</span>`];this.#G(),this.goTxt(s,!0)}}#d=0;#u(){const t=this.#i.style,e=parseFloat(t.fontSize||"0");this.#r.fontsize=e,this.#r.pad_left=parseFloat(t.paddingLeft||"0"),this.#r.pad_right=parseFloat(t.paddingRight||"0"),this.#r.pad_top=parseFloat(t.paddingTop||"0"),this.#r.pad_bottom=parseFloat(t.paddingBottom||"0"),this.#r.$width=parseFloat(t.width||"0"),this.#r.$height=parseFloat(t.height||"0"),this.position.set(this.#r.pad_left,this.#r.pad_top),this.#p=t.writingMode==="vertical-rl",this.#g=0,this.#v=0;const s=t.lineHeight??"0";this.#d=this.#p?0:(s.endsWith("px")?parseFloat(s):e*parseFloat(s)-e)/2}cvsResize(){const t=this.#i.style,e=this.sys.cvsScale;t.left=`${this.sys.ofsLeft4elm+this.#f*e}px`,t.top=`${this.sys.ofsTop4elm+this.ctn.position.y*e}px`,t.transform=`rotate(${this.ctn.angle}deg) scale(${this.ctn.scale.x*e}, ${this.ctn.scale.y*e})`}#f=0;#p=!1;get tategaki(){return this.#p}#g=0;#v=0;get infTL(){return this.#r}get getWidth(){return this.#r.$width}get getHeight(){return this.#r.$height}setMySize(t,e){this.#r.$width=t,this.#r.$height=e,this.#i.style.width=this.#r.$width+"px",this.#i.style.height=this.#r.$height+"px"}#l(t,e=!0){const s={escape:m=>m.replaceAll(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),mimeType:m=>{const y=h(m).toLowerCase();return i()[y]||""},dataAsUrl:p,isDataUrl:l,resolveUrl:c,getAndEncode:u,asArray:m=>{const y=[],d=m.length;for(let b=0;b<d;++b)y.push(m[b]);return y}};function i(){const m="application/font-woff",y="image/jpeg";return{woff:m,woff2:m,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:y,jpeg:y,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}const r=g(),o=f();function a(m){return o.resolveAll().then(y=>{const d=document.createElement("style");return m.appendChild(d),d.appendChild(document.createTextNode(y)),m})}function h(m){return/\.([^\.\/]*?)$/g.exec(m)?.[1]??""}function l(m){return m.search(/^(data:)/)!==-1}function c(m,y){const d=document.implementation.createHTMLDocument(),b=d.createElement("base");d.head.appendChild(b);const k=d.createElement("a");return d.body.appendChild(k),b.href=y,k.href=m,k.href}function u(m){let y=3e4;return new Promise(function(d){const b=new XMLHttpRequest;b.onreadystatechange=k,b.ontimeout=v,b.responseType="blob",b.timeout=y,b.open("GET",m,!0),b.send();function k(){if(b.readyState!==4)return;if(b.status!==200){w("cannot fetch resource: "+m+", status: "+b.status);return}const x=new FileReader;x.onloadend=function(){const E=x.result.toString().split(/,/)[1];d(E)},x.readAsDataURL(b.response)}function v(){w("timeout of "+y+"ms occured while fetching resource: "+m)}function w(x){console.error(x),d("")}})}function p(m,y){return"data:"+y+";base64,"+m}function g(){const m=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:k,shouldProcess:y};function y(v){return v.search(m)!==-1}function d(v){const w=[];let x;for(;x=m.exec(v);)w.push(x[1]);return w.filter(function(E){return!s.isDataUrl(E)})}function b(v,w,x,E){return Promise.resolve(w).then(N=>x?s.resolveUrl(N,x):N).then(E||s.getAndEncode).then(N=>s.dataAsUrl(N,s.mimeType(w))).then(N=>v.replace(A(w),"$1"+N+"$3"));function A(N){return new RegExp(`(url\\(['"]?)(`+s.escape(N)+`)(['"]?\\))`,"g")}}function k(v,w,x){if(E())return Promise.resolve(v);return Promise.resolve(v).then(d).then(A=>{let N=Promise.resolve(v);for(const M of A)N=N.then(H=>b(H,M,w,x));return N});function E(){return!y(v)}}}function f(){return{resolveAll:m,impl:{readAll:y}};function m(){return y().then(d=>Promise.allSettled(d.map(b=>b.resolve()))).then(d=>d.join(`
`))}function y(){return Promise.resolve(s.asArray(document.styleSheets)).then(b).then(d).then(v=>v.map(k));function d(v){return v.filter(w=>w.type===CSSRule.FONT_FACE_RULE).filter(w=>r.shouldProcess(w.style.getPropertyValue("src")))}function b(v){const w=[];for(const x of v)try{if(x.href)continue;s.asArray(x.cssRules||[]).forEach(w.push.bind(w))}catch(E){console.error("Error while reading CSS rules from "+x.href,String(E))}return w}function k(v){return{resolve:function(){const w=(v.parentStyleSheet||{}).href;return r.inlineAll(v.cssText,w)},src:function(){return v.style.getPropertyValue("src")}}}}}Promise.resolve(this.#i).then(m=>{const y=m.cloneNode(!0);return y.style.padding="0px",y.style.paddingRight=this.#g+"px",y.style.paddingTop=this.#v+"px",y.style.left="0px",y.style.top="0px",y.style.width=this.#r.$width-this.#r.pad_left-this.#r.pad_right+"px",y.style.height=this.#r.$height-this.#r.pad_top-this.#r.pad_bottom+"px",this.#i.hidden=e,y}).then(a).then(m=>{m.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const y=new Image;return y.src=`data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="${this.#r.$width}px" height="${this.#r.$height}px"><foreignObject x="0" y="0" width="100%" height="100%">${new XMLSerializer().serializeToString(m).replaceAll("#","%23").replaceAll(`
`,"%0A")}</foreignObject></svg>`,new Promise(d=>y.onload=()=>d(y))}).then(m=>new Promise(y=>setTimeout(()=>y(m),100))).then(m=>{const y=document.createElement("canvas");y.width=this.#r.$width,y.height=this.#r.$height,y.getContext("2d").drawImage(m,0,0),t(vt.from(y))}).catch(m=>lt.myTrace(`goTxt() = ${m}`))}#T=[];goTxt(t,e){const s=()=>this.#$(t,e);this.#T.push(s)===1&&s()}#y=[];#m=0;static#a="<span class='sn_ch sn_ch_last'>&emsp;</span>";#$(t,e){L.#O.visible=!1;let s=this.#y.length,i="";if(s===0){if(L.#e.oCfg.debug.masume&&(T.debugLog&&console.log(`🍌 masume ${this.name} v:${this.visible} l:${this.x} t:${this.y} a:${this.alpha} pl:${this.#r.pad_left} pr:${this.#r.pad_right} pt:${this.#r.pad_top} pb:${this.#r.pad_bottom} w:${this.#r.$width} h:${this.#r.$height}`),this.#h.clear().beginFill(3407616,.2).lineStyle(1,3407616,1).drawRect(-this.#r.pad_left,-this.#r.pad_top,this.#r.$width,this.#r.$height).endFill().beginFill(13311,.2).lineStyle(2,13311,1).drawRect(0,0,this.#r.$width-this.#r.pad_left-this.#r.pad_right,this.#r.$height-this.#r.pad_top-this.#r.pad_bottom).endFill()),this.#i.innerHTML=[...t].join("").replaceAll(/[\n\t]/g,"")+L.#a,!this.#c.break_fixed){const d=globalThis.getComputedStyle(this.#i),b=parseFloat(d.fontSize);this.#p?(this.#c.break_fixed_left=(this.#r.$width-this.#r.pad_left-this.#r.pad_right-b*1.5)*this.sys.cvsScale,this.#c.break_fixed_top=0):(this.#c.break_fixed_left=0,this.#c.break_fixed_top=b/2*this.sys.cvsScale)}}else i=this.#i.innerHTML,--s,this.#i.getElementsByClassName("sn_ch_last").item(0)?.remove(),this.#i.querySelectorAll(":scope > br").forEach(d=>d.remove()),this.#i.insertAdjacentHTML("beforeend",t.slice(this.#m).join("").replaceAll(/[\n\t]/g,"")+L.#a);this.#i.querySelectorAll(".sn_ch:has(> ruby)").forEach(d=>d.style.background=""),this.#m=t.length;const r=this.sys.cvsScale,o=this.#i.getBoundingClientRect(),a=o.left+this.#r.pad_left,h=o.top+this.#r.pad_top;let l;if(r===1)l=(d,b)=>{const k=d.getBoundingClientRect();return new Ot(k.left-a,k.top-h,k.width,k.height+("gjqy".includes(b)?this.#d:0))};else{const d=this.sys.ofsPadLeft_Dom2PIXI+o.left*(1-r),b=this.sys.ofsPadTop_Dom2PIXI+o.top*(1-r);l=(k,v)=>{const w=k.getBoundingClientRect();return new Ot((w.left-d)/r-a,(w.top-b)/r-h,w.width/r,(w.height+("gjqy".includes(v)?this.#d:0))/r)}}const[c,u]=this.#c.hyph(this.#i,l,this.#p,s,i);this.#y=c;const p=T.debugLog?({ch:d},{x:b,y:k,width:v,height:w})=>console.log(`🍌 masume ch:${d} x:${b} y:${k} w:${v} h:${w}`):()=>{},g=L.#e.oCfg.debug.masume?(d,b)=>{p(d,b),this.#h.beginFill(6737151,.5).lineStyle(2,16724736,1).drawRect(b.x,b.y,b.width,b.height).endFill()}:()=>{},f=R.ease(this.#C);for(let d=s;d<u;++d){const b=this.#y[d],k=b.rect,v=JSON.parse(b.elm.dataset.arg??'{"delay": 0}'),w=JSON.parse(b.elm.dataset.add??"{}"),x=L.#A[w.ch_in_style];if(g(b,k),b.elm.dataset.cmd==="grp"){const E=new U;this.#o.addChild(E),new S(v.pic,E,A=>{this.#D(E,v,w,k,f,x??{}),E.parent||E.removeChild(A)})}if(b.elm.dataset.lnk){const E=b.elm.parentElement.closest("[data-arg]"),A=JSON.parse(E.dataset.arg??"{}");A.key=`lnk=[${d}] `+this.name;const N=new X;this.#D(N,A,w,k,f,x??{});const M=A.style??"",H=M+(A.style_hover??""),G=M+(A.style_clicked??""),D=A.r_style??"",pt=D+(A.r_style_hover??""),gt=D+(A.r_style_clicked??""),z=Array.from(E.getElementsByTagName("rt"));for(const et of z)et.dataset.st_r_bk=et.style.cssText;const J=E.style.cssText,mt=(et,jt)=>{E.style.cssText=J+et;for(const Rt of z)Rt.style.cssText=Rt.dataset.st_r_bk+jt};O(A,"enabled",!0)?L.#s.button(A,N,()=>mt(M,D),()=>this.canFocus()?(mt(H,pt),!0):!1,()=>mt(G,gt)):mt(M+(A.style_disable??"color: gray;"),D+(A.r_style_disable??"color: gray;")),this.#o.addChild(N)}}const m=Array.from(this.#i.getElementsByClassName("sn_ch_yet"));this.#S=()=>{this.#S=()=>!1;for(const b of m)b.className="sn_ch";L.#O.position.set(this.#c.break_fixed_left,this.#c.break_fixed_top),L.#O.visible=!0,this.noticeCompTxt();const d=this.#T.shift();return this.#T.length>0&&d(),!0};for(const d of m)d.className=d.className.replace("sn_ch_yet sn","go");s>0&&++s;let y;for(let d=u-2;d>=0;--d){const{elm:b}=this.#y[d];if(b.tagName==="SPAN"){y=b.parentElement?.tagName==="RUBY"?b.parentElement.parentElement??b:b;break}}if(!y||e||s===u){this.#S();return}y.addEventListener("animationend",()=>this.#S(),{once:!0})}#S=()=>!1;#D(t,e,s,i,r,o){t.alpha=0,e.x&&(i.x=e.x.startsWith("=")?i.x+parseInt(e.x.slice(1)):parseInt(e.x)),e.y&&(i.y=e.y.startsWith("=")?i.y+parseInt(e.y.slice(1)):parseInt(e.y)),e.width&&(i.width=parseInt(e.width)),e.height&&(i.height=parseInt(e.height)),e.wait&&(o.wait=parseInt(e.wait)),t.width=i.width,t.height=i.height,o.x?t.position.set(o.x.startsWith("=")?i.x+t.width*o.nx:o.nx,o.y.startsWith("=")?i.y+t.height*o.ny:o.ny):t.position.set(i.x,i.y);const a={sp:t,tw:new oe(t).to({alpha:1,x:i.x,y:i.y,width:i.width,height:i.height,angle:0},o.wait??0).easing(r).delay((s.wait??0)+(e.delay??0)).onComplete(()=>{a.tw=void 0}).start()};this.#V.push(a)}#V=[];skipChIn(){let t=this.#S();for(const e of this.#V)e.tw&&(e.tw.stop().end(),t=!0);return this.#V=[],t}static#A=Object.create(null);static#q=/[{\s\.,*\{]/;static initChStyle(){L.#A=Object.create(null),L.#j=Object.create(null)}static getChInStyle(t){return L.#A[t]}static ch_in_style(t){const{name:e}=t;if(!e)throw"nameは必須です";if(L.#q.test(e))throw`name【${e}】に使えない文字が含まれます`;if(e in L.#A)throw`name【${e}】はすでにあります`;const s=String(t.x??"=0"),i=String(t.y??"=0");return L.#A[e]={wait:$(t,"wait",500),alpha:$(t,"alpha",0),x:s,y:i,nx:parseFloat(s.at(0)==="="?s.slice(1):s),ny:parseFloat(i.at(0)==="="?i.slice(1):i),scale_x:$(t,"scale_x",1),scale_y:$(t,"scale_y",1),rotate:$(t,"rotate",0),join:O(t,"join",!0),ease:t.ease??"ease-out"}}static#j=Object.create(null);static getChOutStyle(t){return L.#j[t]}static ch_out_style(t){const{name:e}=t;if(!e)throw"nameは必須です";if(L.#q.test(e))throw`name【${e}】に使えない文字が含まれます`;if(e in L.#j)throw`name【${e}】はすでにあります`;const s=String(t.x??"=0"),i=String(t.y??"=0");return L.#j[e]={wait:$(t,"wait",500),alpha:$(t,"alpha",0),x:s,y:i,nx:parseFloat(s.at(0)==="="?s.slice(1):s),ny:parseFloat(i.at(0)==="="?i.slice(1):i),scale_x:$(t,"scale_x",1),scale_y:$(t,"scale_y",1),rotate:$(t,"rotate",0),join:O(t,"join",!1),ease:t.ease??"ease-out"}}static#O=new U;static#R=new S;dispBreak(t){L.delBreak();const e=L.#O;e.visible=!1,this.addChild(e),L.#R.destroy(),L.#R=new S(t.pic,e,s=>{e.parent?(s.x=$(t,"x",0),s.y=$(t,"y",0),s.width=$(t,"width",this.#r.fontsize),s.height=$(t,"height",this.#r.fontsize)):e.removeChild(s)})}static delBreak(){const t=L.#O;t.parent?.removeChild(t),L.#R.destroy()}#C="Quadratic.Out";#_="Quadratic.Out";#G(){this.#h.clear(),this.#y=[],this.#m=0,this.#T=[],this.skipChIn();const t=this.#i.cloneNode(!0);t.textContent="";const e=this.#i;e.parentElement.insertBefore(t,e);let s=0;Array.from(e.getElementsByClassName("sn_ch")).forEach(r=>{const o=JSON.parse(r.dataset.add??r.children[0]?.getAttribute("data-add")??r.children[0]?.children[0]?.getAttribute("data-add")??"{}");if(!o.ch_out_style)return;const a=L.#j[o.ch_out_style];if(a){if(a.wait===0){r.style.display="none";return}s+=a.wait,a.join||(r.style.animationDelay="0ms"),r.classList.add(`go_ch_out_${o.ch_out_style}`)}});const i=()=>{e.parentElement.removeChild(e);for(const r of this.#o.removeChildren())r instanceof U&&L.#s.unButton(r),r.destroy()};s===0?(this.#i.textContent="",i()):e.lastElementChild?.addEventListener("animationend",i,{once:!0}),this.#i=t}reNew(){this.#G();const t=new L(this.ctn,()=>this.canFocus(),this.sys);return t.#r=this.#r,t.#i.style.cssText=this.#i.style.cssText,t.#f=this.#f,t.name=this.name,t.#u(),t.#P=this.#P,t.#C=this.#C,t.#_=this.#_,this.#c.reNew(t.#c),this.destroy(),t}#P=void 0;record(){return{infTL:this.#r,cssText:this.#i.style.cssText,left:this.#f,ch_filter:this.#P,fi_easing:this.#C,fo_easing:this.#_,hyph:this.#c.record()}}playback(t){this.#r=t.infTL,this.position.set(this.#r.pad_left,this.#r.pad_top),this.#i.style.cssText=t.cssText,this.#f=t.left,this.#u(),this.#P=t.ch_filter,this.#C=t.fi_easing,this.#_=t.fo_easing,this.#c.playback(t.hyph)}get cssText(){return this.#i.style.cssText}set cssText(t){this.#i.style.cssText=t}#w=void 0;snapshot(t,e){this.#l(s=>{this.#w=X.from(s),this.#p&&(this.#w.x+=T.stageW-(this.#f+this.#r.$width)),this.#w.y-=this.#v,this.#w.texture.frame=new Ot(0,0,Math.min(this.#w.width,this.#r.$width-this.#f),Math.min(this.#w.height,this.#r.$height)),this.#o.addChild(this.#w),t.render(this.#w,{clear:!1}),e()},!1)}snapshot_end(){this.#w&&(this.#o.removeChild(this.#w),this.#w=void 0)}makeDesignCast(t){}showDesignCast(){}dump(){const t=[],e=this.#i.style,s=e.length;for(let i=0;i<s;++i){const r=e[i];t.push(`"${r}":"${e[r].replaceAll(/(["\\])/g,"\\$1")}"`)}return`"txt":"${this.#i.textContent.replaceAll(/(["\\])/g,"\\$1")}", "style":{${t.join(",")}}`}destroy(){L.delBreak(),this.#i.parentElement.removeChild(this.#i),this.removeChild(this.#o),this.removeChild(this.#h),super.destroy()}}class rt extends U{constructor(t,e,s,i){if(super(),this.hArg=t,this.evtMng=e,this.resolve=s,this.canFocus=i,this.#i={type:"pic",enabled:O(t,"enabled",!0),x:this.x=$t(t.left??0),y:this.y=$t(t.top??0),rotation:this.angle=$(t,"rotation",this.angle),pivot_x:this.pivot.x=$(t,"pivot_x",this.pivot.x),pivot_y:this.pivot.y=$(t,"pivot_y",this.pivot.y),scale_x:this.scale.x=$(t,"scale_x",this.scale.x),scale_y:this.scale.y=$(t,"scale_y",this.scale.y),alpha:1,text:"",b_pic:"",width:0,height:0},this.getBtnBounds=()=>(this.#s.x=this.#i.x,this.#s.y=this.#i.y,this.#s),this.#i.enabled&&e.button(t,this,()=>this.normal(),()=>this.#h(),()=>this.#b()),t.pic){this.#i.type="pic",this.#n=new S(t.pic,this,u=>{this.#c(u),this.#s.width=u.width*this.#i.scale_x,this.#s.height=u.height*this.#i.scale_y},u=>s);return}if(!t.text)throw"textまたはpic属性は必須です";const r=$(t,"height",30),o=new fi({align:"center",dropShadow:!0,dropShadowAlpha:.7,dropShadowColor:"white",dropShadowBlur:7,dropShadowDistance:0,fill:this.#i.enabled?"black":"gray",fontFamily:rt.fontFamily,fontSize:r,padding:5});if(t.style)try{const u=JSON.parse(t.style);for(const[p,g]of Object.entries(u))o[p]=g;this.#i={...this.#i,...u}}catch(u){throw u instanceof SyntaxError?new Error(_e(t,"style",u.message)):"fn:Button.ts style"}const a=new di(t.text??"",o);a.alpha=$(t,"alpha",a.alpha),a.width=$(t,"width",100),a.height=t.height=r,this.setText=u=>a.text=u,this.#i={...this.#i,type:"text",alpha:a.alpha,text:a.text,width:a.width,height:a.height};let h=!1;if(this.#i.width=this.width,this.#i.height=this.height,t.b_pic&&(this.#i.b_pic=t.b_pic,this.#n=new S(t.b_pic,this,u=>{this.#o(u,a),this.#i.width=this.width,this.#i.height=this.height,a.name=JSON.stringify(this.#i)},u=>{nt.setBlendmode(this,t),u&&s()}),h=this.#n.ret),a.name=JSON.stringify(this.#i),this.addChild(a),this.#s.width=a.width,this.#s.height=a.height,t.b_pic||nt.setBlendmode(this,t),rt.#e(this,a),!this.#i.enabled){h||s();return}const l=o.clone();if(t.style_hover)try{const u=JSON.parse(t.style_hover);for(const[p,g]of Object.entries(u))l[p]=g}catch(u){throw u instanceof SyntaxError?new Error(_e(t,"style_hover",u.message)):"fn:Button.ts style_hover"}else l.fill="white";const c=l.clone();if(t.style_clicked)try{const u=JSON.parse(t.style_clicked);for(const[p,g]of Object.entries(u))c[p]=g}catch(u){throw u instanceof SyntaxError?new Error(_e(t,"style_clicked",u.message)):"fn:Button.ts style_clicked"}else c.dropShadow=!1;this.normal=()=>a.style=o,this.#h=()=>i()?(a.style=l,!0):!1,this.#b=()=>a.style=c,h||s()}static fontFamily="'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif";static#e=(t,e)=>{};static#t=(t,e,s,i)=>{};static init(t){t.oCfg.debug.masume&&(rt.#e=(e,s)=>e.addChild(new _t().beginFill(8926088,.2).lineStyle(1,8926088,1).drawRect(s.x,s.y,s.width,s.height).endFill()),rt.#t=(e,s,i,r)=>e.addChild(new _t().beginFill(8926088,.2).lineStyle(1,8926088,1).drawRect(s.x,s.y,i,r).endFill()))}setText(t){}getBtnBounds=()=>this.#s;#s=new Ot;#n=new S;#i;destroy(){this.evtMng.unButton(this),this.#n.destroy(),super.destroy()}makeDesignCast(t){}showDesignCast(){}cvsResize(){}#o(t,e){this.setChildIndex(t,0),t.alpha=e.alpha,t.setTransform(e.x,e.y,1,1,e.rotation,0,0,(t.width-e.width)/2,(t.height-e.height)/2),t.name=e.name}normal=()=>{};#h=()=>!1;#b=()=>{};#c(t){this.#i.alpha=t.alpha=$(this.hArg,"alpha",t.alpha);const e=t.width/3,s=this.#i.enabled?e:t.width,i=t.height,r=t.texture.baseTexture,o=new vt(r,new Ot(0,0,e,i)),a=new vt(r,new Ot(e,0,e,i)),h=new vt(r,new Ot(e*2,0,e,i)),l=()=>t.texture=o;this.#i.enabled&&l(),this.normal=l,this.#h=()=>this.canFocus()?(t.texture=h,!0):!1,this.#b=()=>t.texture=a,"width"in this.hArg?(this.#i.width=$t(this.hArg.width),this.scale.x*=this.#i.width/s):this.#i.width=s,"height"in this.hArg?(this.#i.height=$t(this.hArg.height),this.scale.y*=this.#i.height/i):this.#i.height=i,t.name=JSON.stringify(this.#i),rt.#t(this,t,s,i)}}class ie{constructor(t,e,s,i,r,o,a,h){this.cls=e,this.hArg=r,this.sys=o,this.val=a,this.ret=h;const l=o.hFactoryCls[e];if(!l)throw`属性 class【${e}】が不正です`;const c=l(),u=l();c.layname=u.layname=t;const p=r[":id_tag"]=`layer:${t} cls:${e} page:`;c.ctn.name=c.name=p+"A",u.ctn.name=u.name=p+"B",s.addChild(c.ctn),i.addChild(u.ctn),O(r,"visible",!0),O(r,"visible",!0),h.isWait=c.lay(r)||u.lay(r),this.#e={fore:c,back:u};const g=`const.sn.lay.${t}`;a.setVal_Nochk("tmp",g,!0),a.defTmp(g+".fore.alpha",()=>this.#e.fore.alpha),a.defTmp(g+".back.alpha",()=>this.#e.back.alpha),a.defTmp(g+".fore.height",()=>this.#e.fore.height),a.defTmp(g+".back.height",()=>this.#e.back.height),a.defTmp(g+".fore.visible",()=>this.#e.fore.ctn.visible),a.defTmp(g+".back.visible",()=>this.#e.back.ctn.visible),a.defTmp(g+".fore.width",()=>this.#e.fore.width),a.defTmp(g+".back.width",()=>this.#e.back.width),a.defTmp(g+".fore.x",()=>this.#e.fore.x),a.defTmp(g+".back.x",()=>this.#e.back.x),a.defTmp(g+".fore.y",()=>this.#e.fore.y),a.defTmp(g+".back.y",()=>this.#e.back.y)}#e;destroy(){this.#e.fore.destroy(),this.#e.back.destroy()}lay=t=>this.getPage(t).lay(t);getPage=t=>ie.argChk_page(t,"fore")!=="back"?this.#e.fore:this.#e.back;static argChk_page(t,e){const s=t.page??e;if(s==="fore"||s==="back")return t.page=s;throw Error("属性 page【"+s+"】が不正です")}get fore(){return this.#e.fore}get back(){return this.#e.back}transPage(t){[this.#e.back,this.#e.fore]=[this.#e.fore,this.#e.back],this.#e.back.copy(this.#e.fore,t)}}class He{constructor(t,e=!1){this.bg_col=t,this.isLay=e}static init(t,e,s,i,r,o){}static cvsResizeDesign(){}destroy(){}gethArg(){return this.hArg}hArg={};sethArg(t){this.hArg=t}setOther(t){}adopt(t){}static enterMode(){}static allHide(){}set visible(t){}static leaveMode(){}cvsResize(){}make(){}static replaceToken(t){}}class Bi extends He{constructor(t,e){super("#29e",!0)}setSp(t){}}class bt extends nt{static#e=new ue;static#t;static init(t,e,s,i,r,o){bt.#t=s,S.init(e,o,i,t,r)}static destroy(){bt.#e.clear(),S.destroy()}#s=new Bi(this.ctn,this);constructor(){super(),T.isDbg&&(this.#n=t=>this.#s.setSp(t),this.cvsResize=()=>{super.cvsResize(),this.#s.cvsResize()})}#n=()=>{};#i="";#o="";#h="";lay=t=>{const e=_.procID+`GrpLayer lay name:${this.name_}`,s=this.#b(t,i=>{i&&_.endProc(e)});return s&&_.beginProc(e),s};#b(t,e){const{fn:s,face:i=""}=t;if(this.#s.sethArg(t),!s)return super.lay(t),this.ctn.children.length>0&&this.setPos(t),this.#o="",this.#i=this.#h=i,e(!1),!1;const r="fn"in t,o="face"in t;return this.clearLay({clear_filter:O(t,"clear_filter",!0)}),r&&(this.#o=s),o&&(this.#h=i),super.lay(t),t.dx=0,t.dy=0,this.#c.destroy(),this.#c=new S(this.#i=s+(i?","+i:""),this.ctn,a=>{("width"in t||"height"in t)&&(a.width=$(t,"width",0),a.height=$(t,"height",0)),this.#r=a.width,this.#d=a.height,nt.setXY(a,t,this.ctn,!0),nt.setBlendmode(this.ctn,t),this.#n(a)},a=>e(a)),this.#c.ret}#c=new S;#r=0;#d=0;get width(){return this.#r}get height(){return this.#d}renderStart(){this.#f=new X(this.#u),this.#f.visible=!1,this.ctn.addChildAt(this.#f,0),this.#f.position.set(-this.ctn.x,-this.ctn.y);let t=()=>{const e=this.ctn.alpha;this.ctn.alpha=1;for(const s of this.ctn.children)s.visible=!0;this.#f.visible=!1,bt.#t.renderer.render(this.ctn,{renderTexture:this.#u}),this.ctn.alpha=e;for(const s of this.ctn.children)s.visible=!1};if(!this.containMovement){let e=t;t=()=>{t=()=>{},e()}}this.#p=()=>{t(),this.#f.visible=!0},bt.#t.ticker.add(this.#p)}#u=Xt.create({width:T.stageW,height:T.stageH});#f=new X;#p=()=>{};renderEnd(){bt.#t.ticker.remove(this.#p),this.ctn.removeChild(this.#f);for(const t of this.ctn.children)t.visible=!0;this.#f.destroy(!0),this.#u=Xt.create({width:T.stageW,height:T.stageH})}setPos(t){nt.setXY(this.ctn.children[0]??this.ctn,t,this.ctn,!0)}get containMovement(){if(this.#i==="")return!1;const t=this.ctn.children;return this.#i.split(",").some((e,s)=>t[s]instanceof Es||S.getHFn2VElm(e))}clearLay(t){super.clearLay(t),this.#c.destroy(),this.#o="",this.#h="",this.#i=""}record=()=>({...super.record(),sBkFn:this.#o,sBkFace:this.#h});playback(t,e){if(super.playback(t,e),t.sBkFn===""&&t.sBkFace===""){this.#o="",this.#h="";return}e.push(new Promise(s=>this.#b({fn:t.sBkFn,face:t.sBkFace,left:t.x,top:t.y,alpha:t.alpha,blendmode:nt.getNum2Blendmode(t.blendMode),rotation:t.rotation,scale_x:t.scale_x,scale_y:t.scale_y},i=>{this.ctn.position.set(t.x,t.y),s()})))}makeDesignCast(t){this.ctn.visible&&t(this.#s)}cvsResize(){super.cvsResize()}showDesignCast(){this.#s.visible=!0}dump=()=>super.dump()+`, "pic":"${this.#i}"`}class I{constructor(t,e,s){this.appPixi=e,this.val=s,t.add_frame=i=>this.#h(i),t.let_frame=i=>this.#f(i),t.set_frame=i=>this.#p(i),t.frame=i=>this.#v(i),t.tsy_frame=i=>this.#l(i)}static#e;static#t;static#s;static init(t,e,s){I.#e=t,I.#t=e,I.#s=s}#n;setEvtMng(t){this.#n=t}#i=Object.create(null);destroy(){for(const t of Object.values(this.#i))t.parentElement.removeChild(t);this.#i=Object.create(null)}hideAllFrame(){for(const[t,{style:e}]of Object.entries(this.#i))this.#o[t]=e.display!=="none",e.display="none"}#o=Object.create(null);restoreAllFrame(){for(const[t,e]of Object.entries(this.#o)){const s=this.#i[t];s&&(s.style.display=e?"inline":"none")}this.#o=Object.create(null)}#h(t){const{id:e,src:s,alpha:i=1,scale_x:r=1,scale_y:o=1,rotate:a=0}=t;if(!e)throw"idは必須です";if(!s)throw"srcは必須です";const h="const.sn.frm."+e;if(this.val.getVal(`tmp:${h}`))throw`frame【${e}】はすでにあります`;const l=O(t,"visible",!0),c=t.b_color?` background-color: ${t.b_color};`:"",u=this.#c(t);I.#s.cvs.insertAdjacentHTML("beforebegin",`<iframe id="${e}" style="opacity: ${i}; ${c} position: absolute; left:${I.#t.ofsLeft4elm+u.x*I.#t.cvsScale}px; top: ${I.#t.ofsTop4elm+u.y*I.#t.cvsScale}px; z-index: 1; border: 0px; overflow: hidden; display: ${l?"inline":"none"}; transform: scale(${r}, ${o}) rotate(${a}deg);" width="${u.width*I.#t.cvsScale}" height="${u.height*I.#t.cvsScale}"></iframe>`);const p=_.procID+`add_frame id:${e}`;_.beginProc(p);const g=I.#e.searchPath(s,Z.HTML),f=new St().add({name:s,url:g,xhrType:B.XHR_RESPONSE_TYPE.TEXT});return I.#t.arg.crypto&&f.use(async(m,y)=>{try{m.data=await I.#t.dec(m.extension,m.data)}catch(d){I.#s.errScript(`[add_frame]Html ロード失敗です src:${m.name} ${d}`,!1)}y()}),f.load((m,y)=>{const d=document.getElementById(e);this.#i[e]=d,this.#b[e]=!1;const b=g.lastIndexOf("/")+1,k=g.slice(0,b),v=k.slice(0,b);d.srcdoc=String(y[s]?.data).replace("sn_repRes();","").replaceAll(/\s(?:src|href)=(["'])(\S+?)\1/g,(w,x,E)=>E.startsWith("../")?w.replace("../",v):w.replace("./","").replace(x,x+k)),d.srcdoc.includes("true/*WEBP*/;")&&(d.srcdoc=d.srcdoc.replaceAll(/data-src="(.+?\.)(?:jpe?g|png)/g,(w,x)=>`data-src="${x}webp`)),d.onload=()=>{_.endProc(p),this.val.setVal_Nochk("tmp",h,!0),this.val.setVal_Nochk("tmp",h+".alpha",i),this.val.setVal_Nochk("tmp",h+".x",u.x),this.val.setVal_Nochk("tmp",h+".y",u.y),this.val.setVal_Nochk("tmp",h+".scale_x",r),this.val.setVal_Nochk("tmp",h+".scale_y",o),this.val.setVal_Nochk("tmp",h+".rotate",a),this.val.setVal_Nochk("tmp",h+".width",u.width),this.val.setVal_Nochk("tmp",h+".height",u.height),this.val.setVal_Nochk("tmp",h+".visible",l);const w=d.contentWindow;this.#n.resvFlameEvent(w),w.sn_repRes?.(x=>I.#r(x.dataset.src??"",x))}}),!0}#b={};getFrmDisabled(t){return this.#b[t]}#c(t){const e={...t},s=I.#t.resolution;return new DOMRect($(e,"x",0)*s,$(e,"y",0)*s,$(e,"width",T.stageW)*s,$(e,"height",T.stageH)*s)}static#r(t,e,s){const i=this.#u[t];if(i){e.src=i,s&&(e.onload=()=>s(e));return}const r=this.#d[t];if(r){r.push(e);return}this.#d[t]=[e];const[o="",a=""]=t.split("?"),h=I.#e.searchPath(o,Z.SP_GSM),l=new St().add({name:t,url:h,xhrType:B.XHR_RESPONSE_TYPE.BUFFER});I.#t.arg.crypto&&h.endsWith(".bin")&&l.use(async(c,u)=>{try{const p=await I.#t.decAB(c.data);if(c.extension!=="bin"){u();return}c.data=p,p instanceof HTMLImageElement&&(c.type=B.TYPE.IMAGE)}catch(p){I.#s.errScript(`FrameMng loadPic ロード失敗です fn:${c.name} ${p}`,!1)}u()}),l.load((c,u)=>{for(const[p,{data:{src:g}}]of Object.entries(u)){const f=this.#u[p]=g+(g.startsWith("blob:")||g.startsWith("data:")?"":a?"?"+a:""),m=this.#d[p];if(m)for(const y of m)y.src=f,s&&(y.onload=()=>s(y));delete this.#d[p]}})}static#d={};static#u={};cvsResize(){for(const[t,e]of Object.entries(this.#i)){const s="const.sn.frm."+t,i=Number(this.val.getVal(s+".x")),r=Number(this.val.getVal(s+".y")),o=Number(this.val.getVal(s+".width")),a=Number(this.val.getVal(s+".height"));e.style.left=`${I.#t.ofsLeft4elm+i*I.#t.cvsScale}px`,e.style.top=`${I.#t.ofsTop4elm+r*I.#t.cvsScale}px`,e.width=String(o*I.#t.cvsScale),e.height=String(a*I.#t.cvsScale)}}#f(t){const{id:e,var_name:s}=t;if(!e)throw"idは必須です";const i=document.getElementById(e);if(!i)throw`id【${e}】はフレームではありません`;const r="const.sn.frm."+e;if(!this.val.getVal(`tmp:${r}`))throw`frame【${e}】が読み込まれていません`;if(!s)throw"var_nameは必須です";const o=i.contentWindow;if(!Object.hasOwn(o,s))throw`frame【${e}】に変数/関数【${s}】がありません。変数は var付きにして下さい`;const a=o[s];return this.val.setVal_Nochk("tmp",r+"."+s,O(t,"function",!1)?a():a),!1}#p(t){const{id:e,var_name:s,text:i}=t;if(!e)throw"idは必須です";const r=document.getElementById(e);if(!r)throw`id【${e}】はフレームではありません`;const o="const.sn.frm."+e;if(!this.val.getVal(`tmp:${o}`))throw`frame【${e}】が読み込まれていません`;if(!s)throw"var_nameは必須です";if(!i)throw"textは必須です";this.val.setVal_Nochk("tmp",o+"."+s,i);const a=r.contentWindow;return a[s]=i,!1}#g=1;#v(t){const{id:e}=t;if(!e)throw"idは必須です";const s=document.getElementById(e);if(!s)throw`id【${e}】はフレームではありません`;const i="const.sn.frm."+e;if(!this.val.getVal("tmp:"+i))throw`frame【${e}】が読み込まれていません`;const r=s.style;if(O(t,"float",!1)?r.zIndex=`${++this.#g}`:"index"in t?r.zIndex=`${$(t,"index",0)}`:t.dive&&(r.zIndex=`-${++this.#g}`),"alpha"in t){const a=r.opacity=String(t.alpha);this.val.setVal_Nochk("tmp",i+".alpha",a)}const o=this.#c(t);if(("x"in t||"y"in t)&&(r.left=`${I.#t.ofsLeft4elm+o.x*I.#t.cvsScale}px`,r.top=`${I.#t.ofsTop4elm+o.y*I.#t.cvsScale}px`,this.val.setVal_Nochk("tmp",i+".x",o.x),this.val.setVal_Nochk("tmp",i+".y",o.y)),"scale_x"in t||"scale_y"in t||"rotate"in t){const a=$(t,"scale_x",1),h=$(t,"scale_y",1),l=$(t,"rotate",0);r.transform=`scale(${a}, ${h}) rotate(${l}deg)`,this.val.setVal_Nochk("tmp",i+".scale_x",a),this.val.setVal_Nochk("tmp",i+".scale_y",h),this.val.setVal_Nochk("tmp",i+".rotate",l)}if("width"in t&&(s.width=String(o.width*I.#t.cvsScale),this.val.setVal_Nochk("tmp",i+".width",o.width)),"height"in t&&(s.height=String(o.height*I.#t.cvsScale),this.val.setVal_Nochk("tmp",i+".height",o.height)),"visible"in t){const a=O(t,"visible",!0);r.display=a?"inline":"none",this.val.setVal_Nochk("tmp",i+".visible",a)}if("b_color"in t&&(r.backgroundColor=t.b_color),"disabled"in t){const a=this.#b[e]=O(t,"disabled",!0),h=s.contentDocument.body;for(const l of[...Array.from(h.getElementsByTagName("input")),...Array.from(h.getElementsByTagName("select"))])l.disabled=a}return!1}#l(t){const{id:e,alpha:s,x:i,y:r,scale_x:o,scale_y:a,rotate:h,width:l,height:c}=t;if(!e)throw"idは必須です";const u=document.getElementById(e);if(!u)throw`id【${e}】はフレームではありません`;const p="const.sn.frm."+e;if(!this.val.getVal(`tmp:${p}`,0))throw`frame【${e}】が読み込まれていません`;const g={};s&&(g.a=u.style.opacity),(i||r||o||a||h)&&(g.x=Number(this.val.getVal(`tmp:${p}.x`)),g.y=Number(this.val.getVal(`tmp:${p}.y`)),g.sx=Number(this.val.getVal(`tmp:${p}.scale_x`)),g.sy=Number(this.val.getVal(`tmp:${p}.scale_y`)),g.r=Number(this.val.getVal(`tmp:${p}.rotate`))),l&&(g.w=this.val.getVal(`tmp:${p}.width`)),c&&(g.h=this.val.getVal(`tmp:${p}.height`));const f=R.cnvTweenArg(t,g);let m=()=>{};s&&($(f,"alpha",0),m=()=>{u.style.opacity=g.a,this.val.setVal_Nochk("tmp","alpha",g.a)});let y=()=>{};const d=this.#c(f);(i||r||o||a||h)&&(d.x,d.y,$(f,"scale_x",1),$(f,"scale_y",1),$(f,"rotate",0),y=()=>{u.style.left=I.#t.ofsLeft4elm+g.x*I.#t.cvsScale+"px",u.style.top=I.#t.ofsTop4elm+g.y*I.#t.cvsScale+"px",u.style.transform=`scale(${g.sx}, ${g.sy}) rotate(${g.r}deg)`,this.val.setVal_Nochk("tmp",p+".x",g.x),this.val.setVal_Nochk("tmp",p+".y",g.y),this.val.setVal_Nochk("tmp",p+".scale_x",g.sx),this.val.setVal_Nochk("tmp",p+".scale_y",g.sy),this.val.setVal_Nochk("tmp",p+".rotate",g.r)});let b=()=>{};l&&(d.width,b=()=>{u.width=g.w*I.#t.cvsScale+"px",this.val.setVal_Nochk("tmp",p+".width",g.w)});let k=()=>{};return c&&(d.height,k=()=>{u.height=g.h*I.#t.cvsScale+"px",this.val.setVal_Nochk("tmp",p+".height",g.h)}),this.appPixi.stage.interactive=!1,R.tween(`frm
${e}`,t,g,R.cnvTweenArg(t,g),()=>{m(),y(),b(),k()},()=>this.appPixi.stage.interactive=!0,()=>{}),!1}}class Pt{constructor(t,e,s,i,r,o,a,h,l){this.cfg=t,this.hTag=e,this.appPixi=s,this.val=i,this.main=r,this.scrItr=o,this.sys=a,this.sndMng=h,this.prpPrs=l;const c=()=>{if(a.cvsResize(),this.cvsResizeDesign(),this.#c)for(const f of this.#$)this.#a[f].fore.cvsResizeChildren();else for(const f of this.#$)this.#a[f].fore.cvsResize();this.#n.cvsResize(),this.#u.cvsResize()};if(T.isMobile)this.#o.add(globalThis,"orientationchange",c,{passive:!0});else{let f;this.#o.add(globalThis,"resize",()=>{f||(f=setTimeout(()=>{f=void 0,c()},1e3/60*10))},{passive:!0})}a.cvsResize(),C.init(t,e,i,this,f=>this.#a[f.layname].fore===f,s),bt.init(r,t,s,a,h,i),I.init(t,a,r),rt.init(t),this.#n=new I(e,s,i),a.hFactoryCls.grp=()=>new bt,a.hFactoryCls.txt=()=>new C,e.loadplugin=f=>this.#y(f),e.snapshot=f=>this.#g(f),this.#v=this.sys.isApp?this.#l:this.#T,e.add_lay=f=>this.#m(f),e.clear_lay=f=>this.#q(f),e.finish_trans=()=>R.finish_trans(),e.lay=f=>this.#V(f),e.trans=f=>this.#G(f),e.wt=f=>R.wt(f),e.quake=f=>this.#F(f),e.stop_quake=e.finish_trans,e.wq=f=>e.wt(f),e.pause_tsy=f=>R.pause_tsy(f),e.resume_tsy=f=>R.resume_tsy(f),e.stop_tsy=f=>R.stop_tsy(f),e.tsy=f=>this.#st(f),e.wait_tsy=f=>R.wait_tsy(f),e.add_filter=f=>this.#x(f),e.clear_filter=f=>this.#Z(f),e.enable_filter=f=>this.#U(f),e.ch=f=>this.#L(f),e.clear_text=f=>this.#at(f),e.current=f=>this.#H(f),e.endlink=f=>this.#it(f),e.er=f=>this.#ht(f),e.graph=f=>this.#I(f),e.link=f=>this.#lt(f),e.r=f=>this.#nt(f),e.rec_ch=f=>this.#rt(f),e.rec_r=f=>this.#ct(f),e.reset_rec=f=>this.#ut(f),e.ruby2=f=>this.#ft(f),e.span=f=>this.#X(f),e.tcy=f=>this.#ot(f),e.add_face=f=>S.add_face(f),e.wv=f=>S.wv(f),e.dump_lay=f=>this.#dt(f),e.enable_event=f=>this.#pt(f),e.button=f=>this.#gt(f),t.existsBreakline&&(this.breakLine=f=>{delete f.visible,f.id="break",f.pic="breakline";const m=encodeURIComponent(JSON.stringify(f));this.#p("grp｜"+m)}),t.existsBreakpage&&(this.breakPage=f=>{delete f.visible,f.id="break",f.pic="breakpage";const m=encodeURIComponent(JSON.stringify(f));this.#p("grp｜"+m)}),this.#i=ni(String(t.oCfg.init.bg_color));const u=new _t;u.beginFill(this.#i).lineStyle(0,this.#i).drawRect(0,0,T.stageW,T.stageH).endFill(),this.#t.addChild(u.clone()),this.#s.addChild(u),this.#s.visible=!1,this.#t.name="page:A",this.#s.name="page:B",this.#e=s.stage,this.#e.addChild(this.#s),this.#e.addChild(this.#t),this.#e.addChild(this.#R),this.#e.addChild(this.#_),this.#e.name="stage";const p=(f,m)=>{this.#f(Number(m))};p("",i.getVal("sys:TextLayer.Back.Alpha",1)),i.defValTrg("sys:TextLayer.Back.Alpha",p);const g=(f,m)=>rt.fontFamily=m;g("",i.getVal("tmp:sn.button.fontFamily",rt.fontFamily)),i.defValTrg("tmp:sn.button.fontFamily",g),i.defTmp("const.sn.log.json",()=>JSON.stringify((this.#N.text=this.#N.text?.replaceAll("</span><span class='sn_ch'>","")??"")?[...this.#Y,this.#N]:this.#Y)),i.defTmp("const.sn.last_page_text",()=>this.currentTxtlayFore?.pageText??""),i.defTmp("const.sn.last_page_plain_text",()=>this.currentTxtlayFore?.pagePlainText??""),T.isDbg&&(He.init(s,a,o,l,t,this.#a),this.cvsResizeDesign=()=>He.cvsResizeDesign(),a.addHook((f,m)=>{this.#h[f]?.(f,m)&&delete this.#h[f]}))}#e;#t=new U;#s=new U;#n;#i;#o=new ue;cvsResizeDesign(){}#h={attach:t=>!1,continue:t=>!1,disconnect:t=>!1,_enterDesign:t=>{for(const e of this.#$){const s=this.#a[e].fore;s.makeDesignCastChildren(i=>i.make()),s.makeDesignCast(i=>i.make())}return this.#r(this.#S),!1},_replaceToken:(t,e)=>!1,_selectNode:(t,e)=>(this.#r(e.node),!1)};#b="";#c="";#r(t){[this.#b="",this.#c=""]=t.split("/");const e=this.#a[this.#b];e&&(this.#c?e.fore.showDesignCastChildren():e.fore.showDesignCast())}getFrmDisabled=t=>this.#n.getFrmDisabled(t);#d=void 0;cover(t,e=0){this.#d&&(this.#e.removeChild(this.#d),this.#d.destroy(),this.#d=void 0),t&&this.#e.addChild((this.#d=new _t).beginFill(e).lineStyle(0,e).drawRect(0,0,T.stageW,T.stageH).endFill())}#u;setEvtMng(t){this.#u=t,this.#n.setEvtMng(t),S.setEvtMng(t),R.init(t,this.appPixi)}destroy(){for(const t of Object.values(this.#a))t.destroy();this.#o.clear(),bt.destroy(),ct.destroy(),L.destroy(),C.destroy(),this.#n.destroy(),R.destroy(),Pt.#M=10}#f(t){for(const{fore:e,back:s}of Object.values(this.#a))e instanceof C&&(e.chgBackAlpha(t),s.chgBackAlpha(t))}#p=(t,e=this.currentTxtlayForeNeedErr,s=!0)=>e.tagCh("｜&emsp;《"+t+"》");goTxt=()=>{};get needGoTxt(){return this.currentTxtlayFore?.needGoTxt??!1}breakLine=t=>{};breakPage=t=>{};clearBreak(){this.currentTxtlayFore&&(this.clearBreak=()=>this.#p("del｜break"),this.clearBreak())}clickTxtLay(){return this.currentTxtlayFore?Object.values(this.#a).some(t=>t instanceof C&&t.click()):!1}#g(t){const e=ri("-","_","","_"),s=t.fn?t.fn.startsWith(oi)?t.fn:`${ls+t.fn+e}.png`:`${ls}snapshot${e}.png`,i=this.cfg.searchPath(s),r=$(t,"width",T.stageW),o=$(t,"height",T.stageH);return this.#v(t,i,r,o,`snapshot dt:${e}`)}#v=()=>!1;#l({layer:t},e,s,i,r){if(this.#n.hideAllFrame(),_.beginProc(r),!t)return this.sys.capturePage(e,s,i,()=>{this.#n.restoreAllFrame(),_.endProc(r)}),!0;const o=Object.values(this.#a).map(({fore:{ctn:a}})=>{const h=[a,a.visible];return a.visible=!1,h});for(const a of this.#P(t))this.#a[a].fore.ctn.visible=!0;return this.sys.capturePage(e,s,i,()=>{for(const[a,h]of o)a.visible=h;this.#n.restoreAllFrame(),_.endProc(r)}),!0}#T(t,e,s,i,r){_.beginProc(r);const o=Os(t,"b_color",this.#i),a=ai({width:s,height:i,backgroundAlpha:o>16777216&&e.endsWith(".png")?0:1,antialias:O(t,"smoothing",!1),preserveDrawingBuffer:!0,backgroundColor:o&16777215,autoDensity:!0}),h=t.page!=="back"?"fore":"back",{layer:l}=t;return Promise.allSettled(this.#P(l).map(c=>new Promise(u=>this.#a[c][h].snapshot(a,u)))).then(async()=>{const c=Xt.create({width:a.width,height:a.height});a.render(this.#e,{renderTexture:c}),await this.sys.savePic(e,a.plugins.extract.base64(c)),c.destroy();for(const u of this.#P(l))this.#a[u][h].snapshot_end();a.destroy(!0),_.endProc(r)}),!0}#y(t){const{fn:e}=t;if(!e)throw"fnは必須です";if(!e.endsWith(".css"))throw"サポートされない拡張子です";const s=O(t,"join",!0),i=_.procID+`loadplugin fn:${e}`;return s&&_.beginProc(i),(async()=>{const r=await fetch(e);if(!r.ok)throw new Error("Network response was not ok.");Qt(await r.text()),s&&_.endProc(i)})(),s}#m(t){const{layer:e,class:s}=t;if(!e)throw"layerは必須です";if(e.includes(","))throw"layer名に「,」は使えません";if(e in this.#a)throw`layer【${e}】はすでにあります`;if(!s)throw"clsは必須です";const i={isWait:!1};switch(this.#a[e]=new ie(e,s,this.#t,this.#s,t,this.sys,this.val,i),this.#$.push(e),s){case"txt":this.#S||(this.#W=()=>{},this.#k=this.#tt,this.#H=this.#K,this.hTag.current({layer:e}),this.goTxt=()=>{this.#u.isSkipping?Pt.#M=0:this.setNormalChWait();for(const{fore:r}of Object.values(this.#a))r instanceof C&&this.#p("gotxt｜",r,!1)}),this.val.setVal_Nochk("save","const.sn.layer."+(e??this.#S)+".enabled",!0);break;case"grp":if(this.#D)break;this.#D=e;break}return this.scrItr.recodeDesign(t),i.isWait}#a={};#$=[];#S="";#D="";#V(t){const e=this.#z(t),s=this.#a[e],i=s.back.ctn,r=s.fore.ctn;if(O(t,"float",!1))this.#s.setChildIndex(i,this.#s.children.length-1),this.#t.setChildIndex(r,this.#t.children.length-1),this.#A();else if(t.index)$(t,"index",0)&&(this.#s.setChildIndex(i,t.index),this.#t.setChildIndex(r,t.index),this.#A());else if(t.dive){const{dive:o}=t;let a=0;if(e===o)throw"[lay] 属性 layerとdiveが同じ【"+o+"】です";const h=this.#a[o];if(!h)throw"[lay] 属性 dive【"+o+"】が不正です。レイヤーがありません";const l=h.back,c=h.fore,u=this.#s.getChildIndex(l.ctn),p=this.#t.getChildIndex(c.ctn);a=u<p?u:p,a>this.#s.getChildIndex(i)&&--a,this.#t.setChildIndex(r,a),this.#s.setChildIndex(i,a),this.#A()}return t[":id_tag"]=s.fore.name.slice(0,-7),this.scrItr.recodeDesign(t),s.lay(t)}#A(){this.#$=this.#J()}#q(t){return this.#w(t,e=>{const s=this.#a[this.#z({layer:e})];if(t.page==="both"){s.fore.clearLay(t),s.back.clearLay(t);return}s.getPage(t).clearLay(t)}),!1}static#j=`
precision mediump float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform sampler2D rule;
uniform float vague;
uniform float tick;

uniform vec4 inputPixel;
uniform highp vec4 outputFrame;
vec2 getUV(vec2 coord) {
	return coord * inputPixel.xy / outputFrame.zw;
}

void main() {
	vec4 fg = texture2D(uSampler, vTextureCoord);
	vec4 ru = texture2D(rule, getUV(vTextureCoord));

	float v = ru.r - tick;
	gl_FragColor = abs(v) < vague
		? vec4(fg.rgb, 1) *fg.a *(0.5 +v /vague *0.5)
		: 0.0 <= v ? fg : vec4(0);
}`;#O=Xt.create({width:T.stageW,height:T.stageH});#R=new X(this.#O);#C=Xt.create({width:T.stageW,height:T.stageH});#_=new X(this.#C);#G(t){R.finish_trans(),this.#u.hideHint();const{layer:e}=t,s=new Set,i=this.#P(e).map(v=>(s.add(v),this.#a[v].fore)),r=async()=>{[this.#t,this.#s]=[this.#s,this.#t];const v=[];for(const[w,x]of Object.entries(this.#a)){if(s.has(w)){x.transPage(v);continue}const{fore:{ctn:E},back:{ctn:A}}=x,N=this.#t.getChildIndex(A);this.#t.removeChild(A),this.#s.removeChild(E),this.#t.addChildAt(E,N),this.#s.addChildAt(A,N)}await Promise.allSettled(v),this.#t.visible=!0,this.#s.visible=!1,this.#R.visible=!1,this.#_.visible=!1,_.notifyEndProc(we+Nt)};if(this.#_.filters=[],this.#_.alpha=1,$(t,"time",0)===0||this.#u.isSkipping)return r(),!1;let o=[];const a=[];for(const[v,w]of Object.entries(this.#a)){const x=s.has(v)?w.back:w.fore;x.ctn.visible&&o.push(x.ctn),a.push(x)}const{ticker:h,renderer:l}=this.appPixi;l.render(this.#s,{renderTexture:this.#O});let c=()=>{for(const v of o)l.render(v,{renderTexture:this.#O,clear:!1})};if(!a.some(v=>v.containMovement)){const v=c;c=()=>{c=()=>{},v()}}const u=()=>l.render(this.#t,{renderTexture:this.#C});u();let p=()=>{this.#t.visible=!0,u(),this.#t.visible=!1};if(!i.some(v=>v.containMovement)){const v=p;p=()=>{p=()=>{},v()}}const g=()=>{c(),this.#R.visible=!0,p(),this.#_.visible=!0},{glsl:f,rule:m}=t,y=async()=>{h.remove(g),await r()};if(!f&&!m)return R.tween(Nt,t,this.#_,{alpha:0},()=>{},y,()=>{}),h.add(g),!1;const d={rule:vt.EMPTY,vague:$(t,"vague",.04),tick:0};this.#_.filters=[new hi(void 0,f??Pt.#j,d)];const b=R.tween(Nt,t,d,{tick:1},()=>{},y,()=>{},!m);if(!m)return h.add(g),!1;const k=new S(m,void 0,v=>{d.rule=v.texture,v.destroy(),k.destroy(),b.start(),h.add(g)});return!1}#P(t=""){return t?t.split(","):this.#$}#w(t,e){const s=this.#P(t.layer);for(const i of s){const r=this.#a[i];if(!r)throw"存在しないlayer【"+i+"】です";e(i,r)}return s}#J(t=""){return this.#P(t).sort((e,s)=>{const i=this.#t.getChildIndex(this.#a[e].fore.ctn),r=this.#t.getChildIndex(this.#a[s].fore.ctn);return i<r?-1:i>r?1:0})}setAllStyle2TxtLay(t){for(const{fore:e}of Object.values(this.#a))e instanceof C&&e.lay({style:t})}#F(t){if(R.finish_trans(),$(t,"time",NaN)===0)return!1;const e=this.#P(t.layer).map(c=>this.#a[c].fore.ctn),{renderer:s,ticker:i}=this.appPixi;this.#C.resize(T.stageW,T.stageH);const r=()=>{this.#t.visible=!0;for(const c of e)s.render(c,{renderTexture:this.#C,clear:!1});this.#t.visible=!1};this.#_.visible=!0,this.#_.alpha=1;const o=$t($(t,"hmax",10)),a=$t($(t,"vmax",10)),h=o===0?()=>{}:()=>this.#_.x=Math.round(Math.random()*o*2)-o,l=a===0?()=>{}:()=>this.#_.y=Math.round(Math.random()*a*2)-a;return this.#_.filters=[],R.tween(Nt,t,this.#_,{x:0,y:0},()=>{h(),l()},()=>{i.remove(r),this.#t.visible=!0,this.#_.visible=!1,this.#_.x=0,this.#_.y=0},()=>{}),i.add(r),!1}#st(t){const{layer:e,render:s,name:i}=t;if(!e)throw"layerは必須です";const r=this.#a[this.#z(t)],o=r.fore;let a=()=>{};s&&!this.#u.isSkipping&&(o.renderStart(),a=()=>o.renderEnd());const h=R.cnvTweenArg(t,o),l=O(t,"arrive",!1),c=O(t,"backlay",!1),u=r.back.ctn;return R.tween(i??e,t,o,R.cnvTweenArg(t,o),()=>{},a,()=>{if(l&&Object.assign(o,h),c)for(const p of Object.keys(R.hMemberCnt))u[p]=o[p]}),"filter"in t&&(o.ctn.filters=[nt.bldFilters(t)],o.aFltHArg=[t]),!1}#x(t){return R.finish_trans(),this.#w(t,e=>{const s=this.#a[this.#z({layer:e})];if(t.page==="both"){this.#Q(s.fore,t),this.#Q(s.back,t);return}const i=s.getPage(t);this.#Q(i,t)}),!1}#Q(t,e){const s=t.ctn;s.filters??=[],s.filters=[...s.filters,nt.bldFilters(e)],t.aFltHArg.push(e)}#Z(t){return this.#w(t,e=>{const s=this.#a[this.#z({layer:e})];if(t.page==="both"){const r=s.fore,o=s.back;r.ctn.filters=null,o.ctn.filters=null,r.aFltHArg=[],o.aFltHArg=[];return}const i=s.getPage(t);i.ctn.filters=null,i.aFltHArg=[]}),!1}#U(t){return this.#w(t,e=>{const s=this.#a[this.#z({layer:e})];if(t.page==="both"){this.#B(s.fore,t),this.#B(s.back,t);return}const i=s.getPage(t);this.#B(i,t)}),!1}#B(t,e){const s=t.ctn;if(!s.filters)throw"フィルターがありません";const i=$t($(e,"index",0)),r=s.filters.length;if(r<=i)throw`フィルターの個数（${r}）を越えています`;t.aFltHArg[i].enabled=s.filters[i].enabled=O(e,"enabled",!0)}static#M=10;static get msecChWait(){return Pt.#M}#L(t){const{text:e}=t;if(!e)throw"textは必須です";const s=this.#k(t);delete t.text,this.setNormalChWait(),this.#u.isSkipping?t.wait=0:"wait"in t&&$(t,"wait",NaN);const i=encodeURIComponent(JSON.stringify(t));this.#p("add｜"+i,s);const r=O(t,"record",!0),o=this.val.doRecLog();return r||this.val.setVal_Nochk("save","sn.doRecLog",r),s.tagCh(e.replaceAll("[r]",`
`)),this.val.setVal_Nochk("save","sn.doRecLog",o),this.#p("add_close｜",s),!1}#k=t=>{throw this.#W(),0};#tt(t){const e=this.#z(t,this.#S),s=this.#a[e].getPage(t);if(!(s instanceof C))throw e+"はTxtLayerではありません";return s}setNormalChWait(){Pt.#M=this.scrItr.normalWait}#H=t=>{throw this.#W(),0};#K(t){const{layer:e}=t;if(!e)throw"[current] layerは必須です";const s=this.#a[e];if(!s||!(s.getPage(t)instanceof C))throw`${e}はTxtLayerではありません`;this.#E=s,this.recPagebreak(),this.#S=e,this.val.setVal_Nochk("save","const.sn.mesLayer",e);for(const[i,{fore:r,back:o}]of Object.entries(this.#a))r instanceof C&&(r.isCur=o.isCur=i===e);return!1}get currentTxtlayForeNeedErr(){return this.#W(),this.currentTxtlayFore}get currentTxtlayFore(){return this.#E?this.#E.fore:null}#E;#W=()=>{throw"文字レイヤーがありません。文字表示や操作する前に、[add_lay layer=（レイヤ名） class=txt]で文字レイヤを追加して下さい"};#z(t,e=""){const s=t.layer??e;if(s.includes(","))throw"layer名に「,」は使えません";if(!(s in this.#a))throw"属性 layer【"+s+"】が不正です。レイヤーがありません";return t.layer=s}#N={text:""};#Y=[];recText(t){this.#N={text:t},this.val.setVal_Nochk("save","const.sn.sLog",String(this.val.getVal("const.sn.log.json")))}recPagebreak(){this.#N.text&&(this.#N.text=this.#N.text.replaceAll("</span><span class='sn_ch'>",""),this.#Y.push(this.#N)>this.cfg.oCfg.log.max_len&&(this.#Y=this.#Y.slice(-this.cfg.oCfg.log.max_len)),this.#N={text:""})}#at(t){const e=this.#k(t);return t.layer===this.#S&&t.page==="fore"&&this.recPagebreak(),e.clearText(),!1}#it(t){return this.#p("endlink｜",this.#k(t)),!1}#ht(t){return O(t,"rec_page_break",!0)&&this.recPagebreak(),this.#E&&(this.#E.fore.clearLay(t),this.#E.back.clearLay(t)),!1}#I(t){if(!t.pic)throw"[graph] picは必須です";const e=encodeURIComponent(JSON.stringify(t));return this.#p("grp｜"+e,this.#k(t)),!1}#lt(t){if(!t.fn&&!t.label&&!t.url)throw"fn,label,url いずれかは必須です";t.fn??=this.scrItr.scriptFn,t.style??="background-color: rgba(255,0,0,0.5);",t.style_hover??="background-color: rgba(255,0,0,0.9);",t.style_clicked??=t.style;const e=encodeURIComponent(JSON.stringify(t));return this.#p("link｜"+e,this.#k(t)),!1}#nt(t){return t.text=`
`,this.#L(t)}#ct(t){return this.#rt({...t,text:"[r]"})}#rt(t){return this.#N={...t,text:this.#N.text},t.text?(t.record=!0,t.style??="",t.style+="display: none;",t.wait=0,this.#L(t)):!1}#ut(t){return this.#Y=[],this.#N={text:t.text??""},this.val.setVal_Nochk("save","const.sn.sLog",t.text?`[{text:"${t.text}"}]`:"[]"),!1}#ft(t){const{t:e,r:s}=t;if(!e)throw"[ruby2] tは必須です";if(!s)throw"[ruby2] rは必須です";return t.text="｜"+encodeURIComponent(e)+"《"+encodeURIComponent(s)+"》",delete t.t,delete t.r,this.#L(t)}#X(t){const e=encodeURIComponent(JSON.stringify(t));return this.#p("span｜"+e,this.#k(t)),!1}#ot(t){if(!t.t)throw"[tcy] tは必須です";const e=encodeURIComponent(JSON.stringify(t));return this.#p("tcy｜"+e,this.#k(t)),!1}#dt({layer:t}){console.group("🥟 [dump_lay]");for(const e of this.#P(t)){const{fore:s,back:i}=this.#a[e];try{console.info(`%c${s.name.slice(0,-7)} %o`,`color:#${T.isDarkMode?"49F":"05A"};`,JSON.parse(`{"back":{${i.dump()}}, "fore":{${s.dump()}}}`))}catch(r){console.error("dump_lay err:%o",r),console.error(`   back:${i.dump()}`),console.error(`   fore:${s.dump()}`)}}return console.groupEnd(),!1}#pt(t){const e=this.#z(t,this.#S),s=O(t,"enabled",!0);return this.#k(t).enabled=s,this.val.setVal_Nochk("save","const.sn.layer."+e+".enabled",s),!1}#gt(t){return ie.argChk_page(t,"back"),t.fn??=this.scrItr.scriptFn,this.#k(t).addButton(t),this.scrItr.recodeDesign(t),!1}record(){const t={};for(const e of this.#$){const s=this.#a[e];t[e]={cls:s.cls,fore:s.fore.record(),back:s.back.record()}}return t}playback(t){this.#Y=JSON.parse(String(this.val.getVal("save:const.sn.sLog"))),this.#N={text:""};const e=[],s=[];for(const[r,{fore:o,fore:{idx:a},back:h,cls:l}]of Object.entries(t)){s.push({ln:r,idx:a});const c=this.#a[r]??=new ie(r,l,this.#t,this.#s,{},this.sys,this.val,{isWait:!1});c.fore.playback(o,e),c.back.playback(h,e)}const i=this.#t.children.length;return e.push(new Promise(r=>{for(const{ln:o,idx:a}of s.sort(({idx:h},{idx:l})=>h===l?0:h<l?-1:1)){const{fore:h,back:l}=this.#a[o];if(!h)continue;const c=i>a?a:i-1;this.#t.setChildIndex(h.ctn,c),this.#s.setChildIndex(l.ctn,c)}r()})),e}}const Zn=Object.freeze(Object.defineProperty({__proto__:null,LayerMng:Pt},Symbol.toStringTag,{value:"Module"}));class C extends nt{static#e;static#t;static#s;static#n;static init(t,e,s,i,r,o){C.#e=t,L.init(t,o),C.#t=s,C.#n=i,C.#s=r,s.setDoRecProc(C.chgDoRec),e.autowc=a=>C.#d(a),e.autowc({enabled:!1,text:"",time:0}),e.ch_in_style=a=>C.#i(a),e.ch_out_style=a=>C.#o(a),L.initChStyle(),ui(),Qt(t.matchPath(".+",Z.FONT).flatMap(a=>Object.values(a).map(h=>`
@font-face {
	font-family: '${h}';
	src: url('${this.#e.searchPath(h,Z.FONT)}');
}
`)).join("")+`
.sn_tx {
	pointer-events: none;
	user-select: none;
	-webkit-touch-callout: none;
	box-sizing: border-box;
}
.sn_ch {
	position: relative;
	display: inline-block;
}
`),C.#i({name:"default",wait:500,alpha:0,x:"=0.3",y:"=0",scale_x:1,scale_y:1,rotate:0,join:!0,ease:"ease-out"}),C.#o({name:"default",wait:0,alpha:0,x:"=0",y:"=0",scale_x:1,scale_y:1,rotate:0,join:!1,ease:"ease-out"})}static#i(t){const e=L.ch_in_style(t),s=e.x.startsWith("=")?`${e.nx*100}%`:`${e.nx}px`,i=e.y.startsWith("=")?`${e.ny*100}%`:`${e.ny}px`,{name:r}=t;return Qt(`
.sn_ch_in_${r} {
	position: relative;
	display: inline-block;
}
.go_ch_in_${r} {
	opacity: ${e.alpha};
	position: relative;
	display: inline-block;
	animation: sn_ch_in_${r} ${e.wait}ms ${e.ease} 0s both;
}
@keyframes sn_ch_in_${r} {
	from {transform: rotate(${e.rotate}deg) scale(${e.scale_x}, ${e.scale_y}) translate(${s}, ${i})}
	to {opacity: 1; transform: none;}
}
`),!1}static#o(t){const e=L.ch_out_style(t),s=e.x.startsWith("=")?`${e.nx*100}%`:`${e.nx}px`,i=e.y.startsWith("=")?`${e.ny*100}%`:`${e.ny}px`,{name:r}=t;return Qt(`
.go_ch_out_${r} {
	position: relative;
	display: inline-block;
	animation: go_ch_out_${r} ${e.wait}ms ${e.ease} 0s both;
}
@keyframes go_ch_out_${r} {
	to {
		opacity: ${e.alpha};
		transform: rotate(${e.rotate}deg) scale(${e.scale_x}, ${e.scale_y}) translate(${s}, ${i});
	}
`),!1}static#h;static#b;static setEvtMng(t,e,s){C.#h=t,C.#b=e,L.setEvtMng(t,s)}static#c=!1;static#r={};static#d(t){C.#c=O(t,"enabled",C.#c),C.#t.setVal_Nochk("save","const.sn.autowc.enabled",C.#c);const{text:e}=t;if("text"in t!="time"in t)throw"[autowc] textとtimeは同時指定必須です";if(C.#t.setVal_Nochk("save","const.sn.autowc.text",e),!e)return C.#t.setVal_Nochk("save","const.sn.autowc.time",""),!1;const s=e.length;if(C.#c&&s===0)throw'[autowc] enabled === false かつ text === "" は許されません';const i=String(t.time).split(",");if(i.length!==s)throw"[autowc] text文字数とtimeに記述された待ち時間（コンマ区切り）は同数にして下さい";C.#r={};for(let r=0;r<s;++r)C.#r[e[r]]=$t(i[r]);return C.#t.setVal_Nochk("save","const.sn.autowc.time",t.time),!1}#u=0;#f=0;#p=!1;#g=void 0;#v="";#l=new L(this.ctn,()=>this.canFocus(),C.#b);#T=new ct;#y=document.createElement("span");static#m={"text-align":0,"text-align-last":0,height:0,width:0,"padding-left":0,"padding-right":0,"padding-top":0,"padding-bottom":0};#a=new U;constructor(){super(),this.ctn.addChild(this.#l),this.#T.init(this.#Q),this.ctn.addChild(this.#a),this.#a.name="cntBtn",this.lay({style:`width: ${T.stageW}px; height: ${T.stageH}px; font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif; color: white; font-size: 24px; line-height: 1.5; padding: 16px;`,in_style:"default",out_style:"default",back_clear:"true"})}destroy(){this.#g&&(this.ctn.removeChild(this.#g).destroy(),this.#g=void 0),C.#n.recPagebreak(),this.#l.destroy()}static destroy(){C.#c=!1,C.#r={},C.#P=t=>t}set name(t){this.name_=t,this.#l.name=t}get name(){return this.name_}cvsResize(){this.#l.cvsResize()}cvsResizeChildren(){for(const t of this.#a.children)t.cvsResize()}procSetX(t){this.#l.lay({x:t})}procSetY(t){this.#l.lay({y:t})}lay(t){if(super.lay(t),nt.setXY(this.ctn,t,this.ctn),t[":id_tag"]=this.name_.slice(0,-7),ct.setting(t),this.#O(t),this.#l.lay(t),"r_align"in t&&(this.#F=t.r_align??""),this.#w=T.isSafari?this.#l.tategaki?(i,r)=>`text-align: start; height: ${r}em; padding-top: ${i}; padding-bottom: ${i};`:(i,r)=>`text-align: start; width: ${r}em; padding-left: ${i}; padding-right: ${i};`:this.#l.tategaki?i=>`text-align: justify; text-align-last: justify; padding-top: ${i}; padding-bottom: ${i};`:i=>`text-align: justify; text-align-last: justify; padding-left: ${i}; padding-right: ${i};`,T.isFirefox&&(this.#J=this.#st),"r_style"in t)if(t.r_style){const i=document.createElement("span");i.style.cssText=t.r_style;const r=i.style.length,o=this.#y.style;for(let a=0;a<r;++a){const h=i.style[a];if(h in C.#m){lt.myTrace(`${h}は指定できません`,"W");continue}const l=i.style[h];l&&(o[h]=l)}}else this.#y.style.cssText="";if("alpha"in t)for(const i of this.#a.children)i.alpha=this.ctn.alpha;this.#$(t),this.#V(t);const e=_.procID+`TxtLayer lay name:${this.name_}`,s=this.#j(t,i=>{i&&_.endProc(e)});return s&&_.beginProc(e),s}#$(t){const{in_style:e}=t;if(!e)return;const s=L.getChInStyle(e);if(!s)throw`存在しないin_style【${e}】です`;this.#S=e,this.#D=s.join}#S="";#D=!0;get width(){return this.#l.getWidth}get height(){return this.#l.getHeight}#V(t){const{out_style:e}=t;if(e){if(!L.getChOutStyle(e))throw`存在しないout_style【${e}】です`;this.#A=e}}#A="";#q=new S;#j(t,e){if("back_clear"in t)return O(t,"back_clear",!1)&&(this.#u=0,this.#f=0,this.#p=!1,this.#v=""),e(!1),!1;this.#f=$(t,"b_alpha",this.#f),this.#p=O(t,"b_alpha_isfixed",this.#p);const s=(this.#p?1:Number(C.#t.getVal("sys:TextLayer.Back.Alpha")))*this.#f;if(t.b_pic){if(this.#v!==t.b_pic)return this.#v=t.b_pic,this.#g&&(this.ctn.removeChild(this.#g),this.#g.destroy()),this.#q=new S(this.#v,this.ctn,i=>{this.#g=i,i.name="back(pic)",i.visible=s>0,i.alpha=s,this.#l.setMySize(i.width,i.height),this.ctn.setChildIndex(i,0),e(!0)}),this.#q.ret}else"b_color"in t&&(this.#u=Os(t,"b_color",0),this.#g&&(this.ctn.removeChild(this.#g),this.#g.destroy()),this.#v="",this.ctn.addChildAt((this.#g=new _t).beginFill(this.#u,s).lineStyle(void 0).drawRect(0,0,this.#l.getWidth,this.#l.getHeight).endFill(),0),this.#g.name="back(color)");return this.#g&&(this.#g.visible=s>0,this.#g.alpha=s),e(!1),!1}chgBackAlpha(t){const e=this.#p?this.#f:t*this.#f;this.#g instanceof _t&&(this.#g&&(this.ctn.removeChild(this.#g),this.#g.destroy()),this.ctn.addChildAt((this.#g=new _t).beginFill(this.#u,e).lineStyle(void 0).drawRect(0,0,this.#l.getWidth,this.#l.getHeight).endFill(),0),this.#g.name="back(color)"),this.#g&&(this.#g.visible=e>0,this.#g.alpha=e)}#O(t){"noffs"in t&&(this.#_=t.noffs??"",this.#G=new RegExp(`[　${this.#_}]`)),"ffs"in t&&(this.#R??="",this.#C=this.#R===""?()=>"":e=>this.#G.test(e)?"":` font-feature-settings: ${this.#R};`)}#R="";#C=t=>"";#_="";#G=/[　]/;static chgDoRec(t){C.#P=t?e=>e:e=>`<span class='offrec'>${e}</span>`}static#P=t=>t;isCur=!1;#w=()=>"";#J=(t,e,s,i="")=>{if(!s)return` style='${i}'`;const r=t.length*2;if(r-e.length<0)return` style='text-align: ${s}; ${i}'`;let o="";switch(s){case"justify":o=this.#w("0",r);break;case"121":o=this.#w(`calc(${(r-e.length)/(e.length*2)}em)`,r);break;case"even":o=this.#w(`calc(${(r-e.length)/(e.length+1)}em)`,r);break;case"1ruby":o=this.#w("1em",r);break;default:o=`text-align: ${s};`}return` style='${o} ${i}'`};#F="";#st(t,e,s,i=""){if(!s)return` style='${i}'`;const r=t.length*2;if(r-e.length<0)return` style='text-align: ${s}; ${i}'`;let o="";switch(s){case"left":o="ruby-align: start;";break;case"center":o="ruby-align: center;";break;case"right":o="ruby-align: start;";break;case"justify":o="ruby-align: space-between;";break;case"121":o="ruby-align: space-around;";break;case"even":const a=(r-e.length)/(e.length+1);o="ruby-align: space-between; "+(this.#l.tategaki?`padding-top: ${a}em; padding-bottom: ${a}em;`:`padding-left: ${a}em; padding-right: ${a}em;`);break;case"1ruby":o="ruby-align: space-between; "+(this.#l.tategaki?"padding-top: 1em; padding-bottom: 1em;":"padding-left: 1em; padding-right: 1em;");break;default:o=`text-align: ${s};`}return` style='${o} ${i}'`}tagCh(t){this.#T.putTxt(t)}#x=!1;get needGoTxt(){return this.#x}#Q=(t,e)=>{C.#e.oCfg.debug.putCh&&console.log(`🖊 文字表示 text:\`${t}\`(${t.charCodeAt(0).toString(16)}) ruby:\`${e}\` name:\`${this.name_}\``);const s=e.split("｜");let i="";const[r,...o]=s,a=o.join("｜");switch(s.length){case 1:if(this.#x=!0,t===`
`){this.#M?(this.#M=!1,i="<ruby>&emsp;<rt>&emsp;</rt></ruby><br/>"):i="<br/>";break}this.#M&&(this.#M=!1,e===""&&(e="&emsp;")),i=this.#Z(t,e,this.#F);break;default:switch(r){case"start":case"left":case"center":case"right":case"justify":case"121":case"even":case"1ruby":this.#M=!1,this.#x=!0,i=this.#Z(t,a,r);break;case"gotxt":this.#H(),this.#x?(this.isCur&&C.#n.recText(this.#L.join("").replace(/^<ruby>&emsp;<rt>&emsp;<\/rt><\/ruby>(<br\/>)+/,"").replaceAll(/style='(anim\S+ [^;]+;\s*)+/g,"style='").replaceAll(/( style=''| data-(add|arg|cmd)='[^']+'|\n+|\t+)/g,"").replaceAll(/class='sn_ch[^']+/g,"class='sn_ch").replaceAll("display: none;","").replaceAll("class='offrec'","style='display: none;'")),this.#l.goTxt(this.#L,this.#B===0),this.#x=!1,this.#B=0):this.isCur&&this.#l.noticeCompTxt();return;case"add":{const h=JSON.parse(a),{style:l="",wait:c=null}=h,{cl:u,sty:p}=this.#U(!0,c);this.#L.push(`<span${u} style='${p} display: inline; ${l}'>`),delete h.style,this.#tt(h)}return;case"add_close":this.#L.push("</span>"),this.#H();return;case"grp":this.#x=!0;{const h=JSON.parse(a);if(h.id??=this.#L.length,h.id==="break"){this.#l.dispBreak(h);return}this.#M=!1,h.delay=this.#B,h.r??="",h.style??="",h.r_style??="";const{cl:l,sty:c,lnk:u}=this.#U(!0,h.wait);i=`<span${l} style='${c} ${h.style}'><ruby><span data-cmd='grp' data-arg='${JSON.stringify(h)}'${u} style='${c} display: inline;'>&emsp;</span><rt${u}${this.#J("　",h.r,this.#F,this.#y.style.cssText+(this.#k.at(-1)?.o.r_style??"")+h.r_style)}>${h.r}</rt></ruby></span>`}break;case"tcy":this.#M=!1,this.#x=!0;{const{t:h,r:l="",wait:c=null,style:u="",r_style:p=""}=JSON.parse(a);C.#t.doRecLog()&&(this.#E+=t+(e?`《${e}》`:""),this.#W+=h);const g=T.isSafari?l.replaceAll(/[A-Za-z0-9]/g,d=>String.fromCharCode(d.charCodeAt(0)+65248)):l,{cl:f,sty:m,lnk:y}=this.#U(!0,c);i=`<span${f} style='${m}${this.#C(h)} ${u}'><ruby><span${y} style='${m} display: inline; text-combine-upright: all;'>${h}</span><rt${y}${this.#J(h,g,this.#F,this.#y.style.cssText+(this.#k.at(-1)?.o.r_style??"")+p)}>${g}</rt></ruby></span>`}break;case"del":L.delBreak();return;case"span":this.#x=!0,this.#K(JSON.parse(a));return;case"link":this.#x=!0;{const h=JSON.parse(a);h[":link"]=" data-lnk='@'";const{cl:l,sty:c,curpos:u}=this.#U(!1,h.wait);this.#L.push(`<span${l} style='${c} display: inline; ${h.style??""}' ${u} data-arg='${a}'>`),delete h.style,this.#K(h)}return;case"endlink":this.#x=!0,this.#L.push("</span>"),this.#H();return;default:this.#x=!0,i=this.#Z(t,e,this.#F)}break}this.#L.push(C.#P(i))};#Z(t,e,s){const i=t===" "?"&nbsp;":t==="　"?"&emsp;":t;C.#t.doRecLog()&&(this.#E+=i+(e?`《${e}》`:""),t!==" "&&(this.#W+=t));const{cl:r,sty:o,lnk:a}=this.#U(!0,null,t);return e?`<span${r} style='${o} ${this.#C(t)}'><ruby>${Array.from(t).map((h,l)=>`<span${r}${a} style='${l>0?this.#U(!0,null,t).sty:o} display: inline;'>${h===" "?"&nbsp;":h==="　"?"&emsp;":h}</span>`).join("")}<rt${a}${this.#J(t,e,s,this.#y.style.cssText+(this.#k.at(-1)?.o.r_style??""))}>${e}</rt></ruby></span>`:`<span${r} style='${o} ${this.#C(t)}'${a}>${i}</span>`}#U(t,e,s=`
`){const i=this.#D?e??this.#k.at(0)?.o.wait??(C.#c?C.#r[s.at(0)??""]??0:Pt.msecChWait):0;C.#h.isSkipping?this.#B=0:t&&this.#D&&(this.#B+=Number(i));const r=`data-add='{"ch_in_style":"${this.#S}", "ch_out_style":"${this.#A}"}'`;return{cl:` class='sn_ch sn_ch_yet sn_ch_in_${this.#S}'`,sty:`animation-delay: ${this.#B}ms;${this.#k.at(-1)?.o.style??""}`,lnk:(this.#k.at(0)?.o[":link"]??"")+" "+r,curpos:r}}#B=0;#M=!0;#L=[];#k=[];#tt(t){this.#k.push({o:t,r_align:this.#F,ch_in_style:this.#S,ch_out_style:this.#A}),"r_align"in t&&(this.#F=t.r_align),this.#$(t),this.#V(t)}#H(){const t=this.#k.pop();t&&(this.#F=t.r_align,this.#$({in_style:t.ch_in_style}),this.#V({out_style:t.ch_out_style}))}#K(t){const e=this.#k.at(-1);if(!e){this.#tt(t);return}e.o={...e.o,...t},!t.style&&!t.r_style&&(e.o.style="",e.o.r_style=""),"r_align"in t&&(this.#F=t.r_align),this.#$(t),this.#V(t)}click=()=>!this.ctn.interactiveChildren||!this.ctn.visible?!1:this.#l.skipChIn();clearText(){this.ctn.addChild(this.#l=this.#l.reNew()),this.#B=0,this.#M=!0,this.#L=[],this.#E="",this.#W="",C.#n.recPagebreak()}#E="";#W="";get pageText(){return this.#E.replace("《&emsp;》","")}get pagePlainText(){return this.#W}get enabled(){return this.ctn.interactiveChildren}set enabled(t){this.ctn.interactiveChildren=t}addButton=t=>new Promise(e=>{t.key=`btn=[${this.#a.children.length}] `+this.name_,t[":id_tag"]=t.key.slice(0,-7),O(t,"hint_tate",this.#l.tategaki);const s=new rt(t,C.#h,()=>e(),()=>this.canFocus());s.name=JSON.stringify(t).replaceAll('"',"'"),this.#a.addChild(s)});canFocus(){return(this.ctn.interactiveChildren??!1)&&this.ctn.visible&&C.#s(this)}clearLay(t){super.clearLay(t),this.clearText();for(const e of this.#a.removeChildren())e.destroy()}record=()=>({...super.record(),enabled:this.enabled,r_cssText:this.#y.style.cssText,r_align:this.#F,b_do:this.#g===void 0?void 0:this.#g instanceof X?"Sprite":"Graphics",b_pic:this.#v,b_color:this.#u,b_alpha:this.#f,b_alpha_isfixed:this.#p,ffs:this.#R,txs:this.#l.record(),strNoFFS:this.#_,btns:this.#a.children.map(t=>t.name)});playback(t,e){super.playback(t,e),this.enabled=t.enabled,this.#y.style.cssText=t.r_cssText,this.#F=t.r_align,this.cvsResize(),this.#O(t),this.#l.playback(t.txs),this.#f=t.b_alpha,this.#p=t.b_alpha_isfixed,e=[e,new Promise(s=>{const i=t.b_do?t.b_do==="Sprite"?{b_pic:t.b_pic}:{b_color:t.b_color}:{b_pic:""};i.b_alpha=t.b_alpha,i.b_alpha_isfixed=t.b_alpha_isfixed,this.#j(i,r=>{r&&s()})||s()}),t.btns.map(s=>new Promise(i=>{this.addButton(JSON.parse(s.replaceAll("'",'"'))),i()}))].flat()}get cssText(){return this.#l.cssText}set cssText(t){this.#l.cssText=t}snapshot(t,e){t.render(this.ctn,{clear:!1}),this.#l.snapshot(t,e)}snapshot_end(){this.#l.snapshot_end()}makeDesignCast(t){this.ctn.visible&&this.#l.makeDesignCast(t)}makeDesignCastChildren(t){if(this.ctn.visible)for(const e of this.#a.children)e.makeDesignCast(t)}showDesignCast(){this.#l.showDesignCast()}showDesignCastChildren(){for(const t of this.#a.children)t.showDesignCast()}dump(){return this.#Q("","gotxt｜"),super.dump()+`, "enabled":"${this.enabled}", ${this.#l.dump()}, "b_pic":"${this.#v}", "b_color":"${this.#u}", "b_alpha":${this.#f}, "b_alpha_isfixed":"${this.#p}", "width":${this.#l.getWidth}, "height":${this.#l.getHeight}, "pixi_obj":[${this.ctn.children.map(t=>`{"class":"${t instanceof X?"Sprite":t instanceof _t?"Graphics":t instanceof U?"Container":"?"}", "name":"${t.name}", "alpha":${t.alpha}, "x":${t.x}, "y":${t.y}, "visible":"${t.visible}"}`).join(",")}], "button":[${this.#a.children.map(t=>t.children[0]?.name??"{}").join(",")}]`}}class Di{#e=[];#t=-1;#s=new ue;destroy(){this.#e=[],this.#t=-1,this.#s.clear()}add(t,e,s){if(this.#e.findIndex(a=>a.btn===t)>=0)return;if(t instanceof U){t.on("pointerdown",()=>{for(let a=this.#e.length-1;a>=0;--a)if(this.#e[a].btn===t){this.#t=a;return}this.#t=-1}),this.#e.push({btn:t,on:e,off:s});return}this.#s.add(t,"focus",()=>{for(let a=this.#e.length-1;a>=0;--a)if(this.#e[a].btn===t){this.#t=a;return}this.#t=-1});let i=a=>{},r=t.localName==="button"||t.localName==="a"?a=>!a.isTrusted&&a.key==="Enter":a=>a.key==="Enter";const o=t;switch(o.type??""){case"checkbox":i=()=>o.checked=!o.checked;break;case"":t.querySelectorAll("input[type]").length>0&&(i=a=>this.#n(t,a.key),r=()=>!1);break;case"range":i=a=>{a.isTrusted||(a.key==="ArrowUp"?o.stepUp():o.stepDown())};break;case"text":case"textarea":i=a=>{if(a.isTrusted)return;let h=(o.selectionStart??0)+(a.key==="ArrowUp"?-1:1);h<0&&(h=0),o.setSelectionRange(h,h)};break}this.#s.add(t,"keydown",a=>{if(!(a.key!=="ArrowUp"&&a.key!=="ArrowDown"&&a.key!=="Enter")){if(a.stopPropagation(),a.stopImmediatePropagation(),r(a)){t.dispatchEvent(new MouseEvent("click"));return}i(a)}},{passive:!0}),t.hasAttribute("tabindex")||(t.tabIndex=0),this.#e.push({btn:t,on:e,off:s})}remove(t){const e=this.#e.findIndex(s=>s.btn===t);e<0||(this.#e.splice(e,1),this.#e.length===0?this.#t=-1:e<=this.#t&&--this.#t)}#n(t,e){const s=t.querySelectorAll("input[type]"),i=s.length;for(let r=0;r<i;++r)if(s[r].checked){s[(r+i+(e==="ArrowUp"?-1:1))%i].checked=!0;break}}isFocus(t){return this.#t<0?!1:this.#e[this.#t].btn===t}prev(){this.#o();const t=this.#e.length;if(t!==0){--this.#t<0&&(this.#t=t-1);for(let e=t;e>=1;--e){const s=(this.#t+e)%t;if(this.#e[s].on()){this.#t=s,this.#i(s);return}}this.#t=-1}}next(){this.#o();const t=this.#e.length;if(t!==0){++this.#t>=t&&(this.#t=0);for(let e=0;e<t;++e){const s=(this.#t+e)%t;if(this.#e[s].on()){this.#t=s,this.#i(s);return}}this.#t=-1}}#i=T.debugLog?t=>console.log(`👾 <FocusMng idx:${t} btn:%o`,this.#e[t].btn):()=>{};getFocus(){if(this.#t<0)return null;this.#o(),this.#t>=this.#e.length&&(this.#t=0);const t=this.#e[this.#t];return t.on()?t.btn:null}blur(){this.#o(),this.#t=-1,globalThis.focus()}#o(){for(let t=this.#e.length-1;t>=0;--t){const e=this.#e[t];!(e.btn instanceof U)||e.btn.parent?e.off():this.#e.splice(t,1)}}}var K="top",at="bottom",ht="right",q="left",Ke="auto",de=[K,at,ht,q],Vt="start",he="end",Vi="clippingParents",Rs="viewport",qt="popper",Wi="reference",bs=de.reduce(function(n,t){return n.concat([t+"-"+Vt,t+"-"+he])},[]),Bs=[].concat(de,[Ke]).reduce(function(n,t){return n.concat([t,t+"-"+Vt,t+"-"+he])},[]),Hi="beforeRead",zi="read",Ui="afterRead",Ki="beforeMain",qi="main",Gi="afterMain",Ji="beforeWrite",Yi="write",Qi="afterWrite",Xi=[Hi,zi,Ui,Ki,qi,Gi,Ji,Yi,Qi];function dt(n){return n?(n.nodeName||"").toLowerCase():null}function tt(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function Mt(n){var t=tt(n).Element;return n instanceof t||n instanceof Element}function ot(n){var t=tt(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function qe(n){if(typeof ShadowRoot>"u")return!1;var t=tt(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function Zi(n){var t=n.state;Object.keys(t.elements).forEach(function(e){var s=t.styles[e]||{},i=t.attributes[e]||{},r=t.elements[e];!ot(r)||!dt(r)||(Object.assign(r.style,s),Object.keys(i).forEach(function(o){var a=i[o];a===!1?r.removeAttribute(o):r.setAttribute(o,a===!0?"":a)}))})}function tn(n){var t=n.state,e={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,e.popper),t.styles=e,t.elements.arrow&&Object.assign(t.elements.arrow.style,e.arrow),function(){Object.keys(t.elements).forEach(function(s){var i=t.elements[s],r=t.attributes[s]||{},o=Object.keys(t.styles.hasOwnProperty(s)?t.styles[s]:e[s]),a=o.reduce(function(h,l){return h[l]="",h},{});!ot(i)||!dt(i)||(Object.assign(i.style,a),Object.keys(r).forEach(function(h){i.removeAttribute(h)}))})}}const en={name:"applyStyles",enabled:!0,phase:"write",fn:Zi,effect:tn,requires:["computeStyles"]};function ut(n){return n.split("-")[0]}var Ft=Math.max,Ee=Math.min,Wt=Math.round;function ze(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Ds(){return!/^((?!chrome|android).)*safari/i.test(ze())}function Ht(n,t,e){t===void 0&&(t=!1),e===void 0&&(e=!1);var s=n.getBoundingClientRect(),i=1,r=1;t&&ot(n)&&(i=n.offsetWidth>0&&Wt(s.width)/n.offsetWidth||1,r=n.offsetHeight>0&&Wt(s.height)/n.offsetHeight||1);var o=Mt(n)?tt(n):window,a=o.visualViewport,h=!Ds()&&e,l=(s.left+(h&&a?a.offsetLeft:0))/i,c=(s.top+(h&&a?a.offsetTop:0))/r,u=s.width/i,p=s.height/r;return{width:u,height:p,top:c,right:l+u,bottom:c+p,left:l,x:l,y:c}}function Ge(n){var t=Ht(n),e=n.offsetWidth,s=n.offsetHeight;return Math.abs(t.width-e)<=1&&(e=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:n.offsetLeft,y:n.offsetTop,width:e,height:s}}function Vs(n,t){var e=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(e&&qe(e)){var s=t;do{if(s&&n.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function wt(n){return tt(n).getComputedStyle(n)}function sn(n){return["table","td","th"].indexOf(dt(n))>=0}function Et(n){return((Mt(n)?n.ownerDocument:n.document)||window.document).documentElement}function Ae(n){return dt(n)==="html"?n:n.assignedSlot||n.parentNode||(qe(n)?n.host:null)||Et(n)}function _s(n){return!ot(n)||wt(n).position==="fixed"?null:n.offsetParent}function nn(n){var t=/firefox/i.test(ze()),e=/Trident/i.test(ze());if(e&&ot(n)){var s=wt(n);if(s.position==="fixed")return null}var i=Ae(n);for(qe(i)&&(i=i.host);ot(i)&&["html","body"].indexOf(dt(i))<0;){var r=wt(i);if(r.transform!=="none"||r.perspective!=="none"||r.contain==="paint"||["transform","perspective"].indexOf(r.willChange)!==-1||t&&r.willChange==="filter"||t&&r.filter&&r.filter!=="none")return i;i=i.parentNode}return null}function pe(n){for(var t=tt(n),e=_s(n);e&&sn(e)&&wt(e).position==="static";)e=_s(e);return e&&(dt(e)==="html"||dt(e)==="body"&&wt(e).position==="static")?t:e||nn(n)||t}function Je(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function ne(n,t,e){return Ft(n,Ee(t,e))}function rn(n,t,e){var s=ne(n,t,e);return s>e?e:s}function Ws(){return{top:0,right:0,bottom:0,left:0}}function Hs(n){return Object.assign({},Ws(),n)}function zs(n,t){return t.reduce(function(e,s){return e[s]=n,e},{})}var on=function(n,t){return n=typeof n=="function"?n(Object.assign({},t.rects,{placement:t.placement})):n,Hs(typeof n!="number"?n:zs(n,de))};function an(n){var t,e=n.state,s=n.name,i=n.options,r=e.elements.arrow,o=e.modifiersData.popperOffsets,a=ut(e.placement),h=Je(a),l=[q,ht].indexOf(a)>=0,c=l?"height":"width";if(!(!r||!o)){var u=on(i.padding,e),p=Ge(r),g=h==="y"?K:q,f=h==="y"?at:ht,m=e.rects.reference[c]+e.rects.reference[h]-o[h]-e.rects.popper[c],y=o[h]-e.rects.reference[h],d=pe(r),b=d?h==="y"?d.clientHeight||0:d.clientWidth||0:0,k=m/2-y/2,v=u[g],w=b-p[c]-u[f],x=b/2-p[c]/2+k,E=ne(v,x,w),A=h;e.modifiersData[s]=(t={},t[A]=E,t.centerOffset=E-x,t)}}function hn(n){var t=n.state,e=n.options,s=e.element,i=s===void 0?"[data-popper-arrow]":s;i!=null&&(typeof i=="string"&&(i=t.elements.popper.querySelector(i),!i)||Vs(t.elements.popper,i)&&(t.elements.arrow=i))}const ln={name:"arrow",enabled:!0,phase:"main",fn:an,effect:hn,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function zt(n){return n.split("-")[1]}var cn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function un(n,t){var e=n.x,s=n.y,i=t.devicePixelRatio||1;return{x:Wt(e*i)/i||0,y:Wt(s*i)/i||0}}function vs(n){var t,e=n.popper,s=n.popperRect,i=n.placement,r=n.variation,o=n.offsets,a=n.position,h=n.gpuAcceleration,l=n.adaptive,c=n.roundOffsets,u=n.isFixed,p=o.x,g=p===void 0?0:p,f=o.y,m=f===void 0?0:f,y=typeof c=="function"?c({x:g,y:m}):{x:g,y:m};g=y.x,m=y.y;var d=o.hasOwnProperty("x"),b=o.hasOwnProperty("y"),k=q,v=K,w=window;if(l){var x=pe(e),E="clientHeight",A="clientWidth";if(x===tt(e)&&(x=Et(e),wt(x).position!=="static"&&a==="absolute"&&(E="scrollHeight",A="scrollWidth")),x=x,i===K||(i===q||i===ht)&&r===he){v=at;var N=u&&x===w&&w.visualViewport?w.visualViewport.height:x[E];m-=N-s.height,m*=h?1:-1}if(i===q||(i===K||i===at)&&r===he){k=ht;var M=u&&x===w&&w.visualViewport?w.visualViewport.width:x[A];g-=M-s.width,g*=h?1:-1}}var H=Object.assign({position:a},l&&cn),G=c===!0?un({x:g,y:m},tt(e)):{x:g,y:m};if(g=G.x,m=G.y,h){var D;return Object.assign({},H,(D={},D[v]=b?"0":"",D[k]=d?"0":"",D.transform=(w.devicePixelRatio||1)<=1?"translate("+g+"px, "+m+"px)":"translate3d("+g+"px, "+m+"px, 0)",D))}return Object.assign({},H,(t={},t[v]=b?m+"px":"",t[k]=d?g+"px":"",t.transform="",t))}function fn(n){var t=n.state,e=n.options,s=e.gpuAcceleration,i=s===void 0?!0:s,r=e.adaptive,o=r===void 0?!0:r,a=e.roundOffsets,h=a===void 0?!0:a,l={placement:ut(t.placement),variation:zt(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,vs(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:h})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,vs(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:h})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const dn={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn,data:{}};var be={passive:!0};function pn(n){var t=n.state,e=n.instance,s=n.options,i=s.scroll,r=i===void 0?!0:i,o=s.resize,a=o===void 0?!0:o,h=tt(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&l.forEach(function(c){c.addEventListener("scroll",e.update,be)}),a&&h.addEventListener("resize",e.update,be),function(){r&&l.forEach(function(c){c.removeEventListener("scroll",e.update,be)}),a&&h.removeEventListener("resize",e.update,be)}}const gn={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:pn,data:{}};var mn={left:"right",right:"left",bottom:"top",top:"bottom"};function Se(n){return n.replace(/left|right|bottom|top/g,function(t){return mn[t]})}var yn={start:"end",end:"start"};function ws(n){return n.replace(/start|end/g,function(t){return yn[t]})}function Ye(n){var t=tt(n),e=t.pageXOffset,s=t.pageYOffset;return{scrollLeft:e,scrollTop:s}}function Qe(n){return Ht(Et(n)).left+Ye(n).scrollLeft}function bn(n,t){var e=tt(n),s=Et(n),i=e.visualViewport,r=s.clientWidth,o=s.clientHeight,a=0,h=0;if(i){r=i.width,o=i.height;var l=Ds();(l||!l&&t==="fixed")&&(a=i.offsetLeft,h=i.offsetTop)}return{width:r,height:o,x:a+Qe(n),y:h}}function _n(n){var t,e=Et(n),s=Ye(n),i=(t=n.ownerDocument)==null?void 0:t.body,r=Ft(e.scrollWidth,e.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=Ft(e.scrollHeight,e.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-s.scrollLeft+Qe(n),h=-s.scrollTop;return wt(i||e).direction==="rtl"&&(a+=Ft(e.clientWidth,i?i.clientWidth:0)-r),{width:r,height:o,x:a,y:h}}function Xe(n){var t=wt(n),e=t.overflow,s=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(e+i+s)}function Us(n){return["html","body","#document"].indexOf(dt(n))>=0?n.ownerDocument.body:ot(n)&&Xe(n)?n:Us(Ae(n))}function re(n,t){var e;t===void 0&&(t=[]);var s=Us(n),i=s===((e=n.ownerDocument)==null?void 0:e.body),r=tt(s),o=i?[r].concat(r.visualViewport||[],Xe(s)?s:[]):s,a=t.concat(o);return i?a:a.concat(re(Ae(o)))}function Ue(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function vn(n,t){var e=Ht(n,!1,t==="fixed");return e.top=e.top+n.clientTop,e.left=e.left+n.clientLeft,e.bottom=e.top+n.clientHeight,e.right=e.left+n.clientWidth,e.width=n.clientWidth,e.height=n.clientHeight,e.x=e.left,e.y=e.top,e}function xs(n,t,e){return t===Rs?Ue(bn(n,e)):Mt(t)?vn(t,e):Ue(_n(Et(n)))}function wn(n){var t=re(Ae(n)),e=["absolute","fixed"].indexOf(wt(n).position)>=0,s=e&&ot(n)?pe(n):n;return Mt(s)?t.filter(function(i){return Mt(i)&&Vs(i,s)&&dt(i)!=="body"}):[]}function xn(n,t,e,s){var i=t==="clippingParents"?wn(n):[].concat(t),r=[].concat(i,[e]),o=r[0],a=r.reduce(function(h,l){var c=xs(n,l,s);return h.top=Ft(c.top,h.top),h.right=Ee(c.right,h.right),h.bottom=Ee(c.bottom,h.bottom),h.left=Ft(c.left,h.left),h},xs(n,o,s));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Ks(n){var t=n.reference,e=n.element,s=n.placement,i=s?ut(s):null,r=s?zt(s):null,o=t.x+t.width/2-e.width/2,a=t.y+t.height/2-e.height/2,h;switch(i){case K:h={x:o,y:t.y-e.height};break;case at:h={x:o,y:t.y+t.height};break;case ht:h={x:t.x+t.width,y:a};break;case q:h={x:t.x-e.width,y:a};break;default:h={x:t.x,y:t.y}}var l=i?Je(i):null;if(l!=null){var c=l==="y"?"height":"width";switch(r){case Vt:h[l]=h[l]-(t[c]/2-e[c]/2);break;case he:h[l]=h[l]+(t[c]/2-e[c]/2);break}}return h}function le(n,t){t===void 0&&(t={});var e=t,s=e.placement,i=s===void 0?n.placement:s,r=e.strategy,o=r===void 0?n.strategy:r,a=e.boundary,h=a===void 0?Vi:a,l=e.rootBoundary,c=l===void 0?Rs:l,u=e.elementContext,p=u===void 0?qt:u,g=e.altBoundary,f=g===void 0?!1:g,m=e.padding,y=m===void 0?0:m,d=Hs(typeof y!="number"?y:zs(y,de)),b=p===qt?Wi:qt,k=n.rects.popper,v=n.elements[f?b:p],w=xn(Mt(v)?v:v.contextElement||Et(n.elements.popper),h,c,o),x=Ht(n.elements.reference),E=Ks({reference:x,element:k,placement:i}),A=Ue(Object.assign({},k,E)),N=p===qt?A:x,M={top:w.top-N.top+d.top,bottom:N.bottom-w.bottom+d.bottom,left:w.left-N.left+d.left,right:N.right-w.right+d.right},H=n.modifiersData.offset;if(p===qt&&H){var G=H[i];Object.keys(M).forEach(function(D){var pt=[ht,at].indexOf(D)>=0?1:-1,gt=[K,at].indexOf(D)>=0?"y":"x";M[D]+=G[gt]*pt})}return M}function kn(n,t){t===void 0&&(t={});var e=t,s=e.placement,i=e.boundary,r=e.rootBoundary,o=e.padding,a=e.flipVariations,h=e.allowedAutoPlacements,l=h===void 0?Bs:h,c=zt(s),u=c?a?bs:bs.filter(function(f){return zt(f)===c}):de,p=u.filter(function(f){return l.indexOf(f)>=0});p.length===0&&(p=u);var g=p.reduce(function(f,m){return f[m]=le(n,{placement:m,boundary:i,rootBoundary:r,padding:o})[ut(m)],f},{});return Object.keys(g).sort(function(f,m){return g[f]-g[m]})}function Pn(n){if(ut(n)===Ke)return[];var t=Se(n);return[ws(n),t,ws(t)]}function Sn(n){var t=n.state,e=n.options,s=n.name;if(!t.modifiersData[s]._skip){for(var i=e.mainAxis,r=i===void 0?!0:i,o=e.altAxis,a=o===void 0?!0:o,h=e.fallbackPlacements,l=e.padding,c=e.boundary,u=e.rootBoundary,p=e.altBoundary,g=e.flipVariations,f=g===void 0?!0:g,m=e.allowedAutoPlacements,y=t.options.placement,d=ut(y),b=d===y,k=h||(b||!f?[Se(y)]:Pn(y)),v=[y].concat(k).reduce(function(Tt,yt){return Tt.concat(ut(yt)===Ke?kn(t,{placement:yt,boundary:c,rootBoundary:u,padding:l,flipVariations:f,allowedAutoPlacements:m}):yt)},[]),w=t.rects.reference,x=t.rects.popper,E=new Map,A=!0,N=v[0],M=0;M<v.length;M++){var H=v[M],G=ut(H),D=zt(H)===Vt,pt=[K,at].indexOf(G)>=0,gt=pt?"width":"height",z=le(t,{placement:H,boundary:c,rootBoundary:u,altBoundary:p,padding:l}),J=pt?D?ht:q:D?at:K;w[gt]>x[gt]&&(J=Se(J));var mt=Se(J),et=[];if(r&&et.push(z[G]<=0),a&&et.push(z[J]<=0,z[mt]<=0),et.every(function(Tt){return Tt})){N=H,A=!1;break}E.set(H,et)}if(A)for(var jt=f?3:1,Rt=function(Tt){var yt=v.find(function(me){var Kt=E.get(me);if(Kt)return Kt.slice(0,Tt).every(function(Bt){return Bt})});if(yt)return N=yt,"break"},Ut=jt;Ut>0;Ut--){var ge=Rt(Ut);if(ge==="break")break}t.placement!==N&&(t.modifiersData[s]._skip=!0,t.placement=N,t.reset=!0)}}const $n={name:"flip",enabled:!0,phase:"main",fn:Sn,requiresIfExists:["offset"],data:{_skip:!1}};function ks(n,t,e){return e===void 0&&(e={x:0,y:0}),{top:n.top-t.height-e.y,right:n.right-t.width+e.x,bottom:n.bottom-t.height+e.y,left:n.left-t.width-e.x}}function Ps(n){return[K,ht,at,q].some(function(t){return n[t]>=0})}function On(n){var t=n.state,e=n.name,s=t.rects.reference,i=t.rects.popper,r=t.modifiersData.preventOverflow,o=le(t,{elementContext:"reference"}),a=le(t,{altBoundary:!0}),h=ks(o,s),l=ks(a,i,r),c=Ps(h),u=Ps(l);t.modifiersData[e]={referenceClippingOffsets:h,popperEscapeOffsets:l,isReferenceHidden:c,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":u})}const En={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:On};function Tn(n,t,e){var s=ut(n),i=[q,K].indexOf(s)>=0?-1:1,r=typeof e=="function"?e(Object.assign({},t,{placement:n})):e,o=r[0],a=r[1];return o=o||0,a=(a||0)*i,[q,ht].indexOf(s)>=0?{x:a,y:o}:{x:o,y:a}}function Cn(n){var t=n.state,e=n.options,s=n.name,i=e.offset,r=i===void 0?[0,0]:i,o=Bs.reduce(function(c,u){return c[u]=Tn(u,t.rects,r),c},{}),a=o[t.placement],h=a.x,l=a.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=h,t.modifiersData.popperOffsets.y+=l),t.modifiersData[s]=o}const An={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Cn};function Ln(n){var t=n.state,e=n.name;t.modifiersData[e]=Ks({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const Nn={name:"popperOffsets",enabled:!0,phase:"read",fn:Ln,data:{}};function In(n){return n==="x"?"y":"x"}function Fn(n){var t=n.state,e=n.options,s=n.name,i=e.mainAxis,r=i===void 0?!0:i,o=e.altAxis,a=o===void 0?!1:o,h=e.boundary,l=e.rootBoundary,c=e.altBoundary,u=e.padding,p=e.tether,g=p===void 0?!0:p,f=e.tetherOffset,m=f===void 0?0:f,y=le(t,{boundary:h,rootBoundary:l,padding:u,altBoundary:c}),d=ut(t.placement),b=zt(t.placement),k=!b,v=Je(d),w=In(v),x=t.modifiersData.popperOffsets,E=t.rects.reference,A=t.rects.popper,N=typeof m=="function"?m(Object.assign({},t.rects,{placement:t.placement})):m,M=typeof N=="number"?{mainAxis:N,altAxis:N}:Object.assign({mainAxis:0,altAxis:0},N),H=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,G={x:0,y:0};if(x){if(r){var D,pt=v==="y"?K:q,gt=v==="y"?at:ht,z=v==="y"?"height":"width",J=x[v],mt=J+y[pt],et=J-y[gt],jt=g?-A[z]/2:0,Rt=b===Vt?E[z]:A[z],Ut=b===Vt?-A[z]:-E[z],ge=t.elements.arrow,Tt=g&&ge?Ge(ge):{width:0,height:0},yt=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Ws(),me=yt[pt],Kt=yt[gt],Bt=ne(0,E[z],Tt[z]),Gs=k?E[z]/2-jt-Bt-me-M.mainAxis:Rt-Bt-me-M.mainAxis,Js=k?-E[z]/2+jt+Bt+Kt+M.mainAxis:Ut+Bt+Kt+M.mainAxis,Le=t.elements.arrow&&pe(t.elements.arrow),Ys=Le?v==="y"?Le.clientTop||0:Le.clientLeft||0:0,ts=(D=H?.[v])!=null?D:0,Qs=J+Gs-ts-Ys,Xs=J+Js-ts,es=ne(g?Ee(mt,Qs):mt,J,g?Ft(et,Xs):et);x[v]=es,G[v]=es-J}if(a){var ss,Zs=v==="x"?K:q,ti=v==="x"?at:ht,Ct=x[w],ye=w==="y"?"height":"width",is=Ct+y[Zs],ns=Ct-y[ti],Ne=[K,q].indexOf(d)!==-1,rs=(ss=H?.[w])!=null?ss:0,os=Ne?is:Ct-E[ye]-A[ye]-rs+M.altAxis,as=Ne?Ct+E[ye]+A[ye]-rs-M.altAxis:ns,hs=g&&Ne?rn(os,Ct,as):ne(g?os:is,Ct,g?as:ns);x[w]=hs,G[w]=hs-Ct}t.modifiersData[s]=G}}const Mn={name:"preventOverflow",enabled:!0,phase:"main",fn:Fn,requiresIfExists:["offset"]};function jn(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function Rn(n){return n===tt(n)||!ot(n)?Ye(n):jn(n)}function Bn(n){var t=n.getBoundingClientRect(),e=Wt(t.width)/n.offsetWidth||1,s=Wt(t.height)/n.offsetHeight||1;return e!==1||s!==1}function Dn(n,t,e){e===void 0&&(e=!1);var s=ot(t),i=ot(t)&&Bn(t),r=Et(t),o=Ht(n,i,e),a={scrollLeft:0,scrollTop:0},h={x:0,y:0};return(s||!s&&!e)&&((dt(t)!=="body"||Xe(r))&&(a=Rn(t)),ot(t)?(h=Ht(t,!0),h.x+=t.clientLeft,h.y+=t.clientTop):r&&(h.x=Qe(r))),{x:o.left+a.scrollLeft-h.x,y:o.top+a.scrollTop-h.y,width:o.width,height:o.height}}function Vn(n){var t=new Map,e=new Set,s=[];n.forEach(function(r){t.set(r.name,r)});function i(r){e.add(r.name);var o=[].concat(r.requires||[],r.requiresIfExists||[]);o.forEach(function(a){if(!e.has(a)){var h=t.get(a);h&&i(h)}}),s.push(r)}return n.forEach(function(r){e.has(r.name)||i(r)}),s}function Wn(n){var t=Vn(n);return Xi.reduce(function(e,s){return e.concat(t.filter(function(i){return i.phase===s}))},[])}function Hn(n){var t;return function(){return t||(t=new Promise(function(e){Promise.resolve().then(function(){t=void 0,e(n())})})),t}}function zn(n){var t=n.reduce(function(e,s){var i=e[s.name];return e[s.name]=i?Object.assign({},i,s,{options:Object.assign({},i.options,s.options),data:Object.assign({},i.data,s.data)}):s,e},{});return Object.keys(t).map(function(e){return t[e]})}var Ss={placement:"bottom",modifiers:[],strategy:"absolute"};function $s(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return!t.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function Un(n){n===void 0&&(n={});var t=n,e=t.defaultModifiers,s=e===void 0?[]:e,i=t.defaultOptions,r=i===void 0?Ss:i;return function(o,a,h){h===void 0&&(h=r);var l={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ss,r),modifiersData:{},elements:{reference:o,popper:a},attributes:{},styles:{}},c=[],u=!1,p={state:l,setOptions:function(m){var y=typeof m=="function"?m(l.options):m;f(),l.options=Object.assign({},r,l.options,y),l.scrollParents={reference:Mt(o)?re(o):o.contextElement?re(o.contextElement):[],popper:re(a)};var d=Wn(zn([].concat(s,l.options.modifiers)));return l.orderedModifiers=d.filter(function(b){return b.enabled}),g(),p.update()},forceUpdate:function(){if(!u){var m=l.elements,y=m.reference,d=m.popper;if($s(y,d)){l.rects={reference:Dn(y,pe(d),l.options.strategy==="fixed"),popper:Ge(d)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach(function(A){return l.modifiersData[A.name]=Object.assign({},A.data)});for(var b=0;b<l.orderedModifiers.length;b++){if(l.reset===!0){l.reset=!1,b=-1;continue}var k=l.orderedModifiers[b],v=k.fn,w=k.options,x=w===void 0?{}:w,E=k.name;typeof v=="function"&&(l=v({state:l,options:x,name:E,instance:p})||l)}}}},update:Hn(function(){return new Promise(function(m){p.forceUpdate(),m(l)})}),destroy:function(){f(),u=!0}};if(!$s(o,a))return p;p.setOptions(h).then(function(m){!u&&h.onFirstUpdate&&h.onFirstUpdate(m)});function g(){l.orderedModifiers.forEach(function(m){var y=m.name,d=m.options,b=d===void 0?{}:d,k=m.effect;if(typeof k=="function"){var v=k({state:l,name:y,instance:p,options:b}),w=function(){};c.push(v||w)}})}function f(){c.forEach(function(m){return m()}),c=[]}return p}}var Kn=[gn,Nn,dn,en,An,$n,Mn,ln,En],qn=Un({defaultModifiers:Kn});const Te="pointerup",Lt="keydown";class Gn{constructor(t,e,s,i,r,o,a,h,l){if(this.cfg=t,this.hTag=e,this.appPixi=s,this.main=i,this.layMng=r,this.val=o,this.scrItr=h,this.sys=l,e.clear_event=d=>P.clear_event(d),e.event=d=>this.#v(d),e.set_cancel_skip=()=>!1,e.set_focus=d=>this.#T(d),a.setEvtMng(this),h.setOtherObj(this,r),C.setEvtMng(this,l,h),r.setEvtMng(this),_.setFcs(this.#t),l.setFire((d,b)=>_.fire(d,b)),T.isDbg){const d={pause:()=>{if(!_.isWait)return;const b={};h.recodeDesign(b),l.callHook("_enterDesign",b),l.send2Dbg("_enterDesign",b)}};d.attach=d.stopOnEntry=d.stopOnStep=d.stopOnStepIn=d.stopOnStepOut=d.stopOnBackstep=d.pause,l.addHook(b=>d[b]?.())}Qt(`
.sn_hint {
	background-color: #3c3225;
	color: white;
	padding: 4px 8px;
	border-radius: 4px;
	font-size: 1.2em;
	z-index: 10000;
	pointer-events: none;
	user-select: none;
}

.sn_hint_ar,
.sn_hint_ar::before {
	position: absolute;
	width: 8px;
	height: 8px;
	background: inherit;
}
.sn_hint_ar {
	visibility: hidden;
}
.sn_hint_ar::before {
	visibility: visible;
	content: '';
	transform: rotate(45deg);
}

.sn_hint[data-popper-placement^='top']		> .sn_hint_ar {bottom: -4px;}
.sn_hint[data-popper-placement^='bottom']	> .sn_hint_ar {top: -4px;}
.sn_hint[data-popper-placement^='left']		> .sn_hint_ar {right: -4px;}
.sn_hint[data-popper-placement^='right']	> .sn_hint_ar {left: -4px;}
`),this.main.cvs.parentElement?.insertAdjacentHTML("beforeend",`
<div class="sn_hint" role="tooltip">
	<span>Dummy</span>
	<div class="sn_hint_ar" data-popper-arrow></div>
</div>`),this.#d=document.querySelector(".sn_hint"),this.#u=this.#d.querySelector("span"),this.#f=qn(this.#r,this.#d),this.#d.hidden=!0,s.stage.interactive=!0;const c=new Map([[0,""],[1,"middle"],[2,"right"]]);this.#e.addC(s.stage,Te,d=>{if(d instanceof TouchEvent){_.fire("click",d);return}const b=this.#i(d)+`${c.get(d.button)??""}click`;console.log(`fn:EventMng.ts -tap- nmEvt:${b} e:%o`,d),_.fire(b,d)}),this.#e.add(window,Lt,d=>this.#n(d));let u=!1;const p=new TinyGesture(document.body);p.on("tap",d=>{u||console.log("fn:EventMng.ts line:161 click e:%o",d)}),p.on("longpress",d=>{if(u=!0,d.stopImmediatePropagation(),d instanceof TouchEvent){_.fire("longpress",d);return}const b=this.#i(d)+`${c.get(d.button)??""}longpress`;_.fire(b,d)}),p.on("panend",()=>{u&&queueMicrotask(()=>u=!1)}),p.on("swipeup",d=>{if(d.stopImmediatePropagation(),d instanceof TouchEvent){_.fire("swipeup",d);return}const b=this.#i(d)+"swipeup";_.fire(b,d)}),p.on("swipedown",d=>{if(d.stopImmediatePropagation(),d instanceof TouchEvent){_.fire("swipedown",d);return}const b=this.#i(d)+"swipedown";_.fire(b,d)});const g=()=>o.setVal_Nochk("tmp","const.sn.navigator.language",navigator.language);this.#e.add(window,"languagechange",d=>{g(),_.fire("sn:chgNavLang",d),si()}),g();const f=d=>{T.isDarkMode=d.matches,o.setVal_Nochk("tmp","const.sn.isDarkMode",T.isDarkMode)},m=globalThis.matchMedia("(prefers-color-scheme: dark)");f(m),this.#e.add(m,"change",d=>{f(d),_.fire("sn:chgDarkMode",d)});let y=(d,b)=>{};"WheelEvent"in window&&(this.#e.add(i.cvs,"wheel",d=>this.#o(d),{passive:!0}),this.#s=d=>this.#e.add(d,"wheel",b=>this.#o(b),{passive:!0}),y=(d,b)=>d.add(i.cvs,"wheel",k=>{k.isComposing||k.deltaY<=0||(k.stopPropagation(),b())})),_.init(t,e,i,o,h,r,this,a,y),ei(()=>import("./gamepad.js"),[],import.meta.url).then(d=>d.g).then(({GamepadListener:d})=>{const b=new d({analog:!1,deadZone:.3});T.debugLog&&(b.on("gamepad:connected",w=>console.log(`👺<'gamepad:connected' index:${w.detail.index} id:${w.detail.gamepad.id}`)),b.on("gamepad:disconnected",w=>console.log(`👺<'gamepad:disconnected' index:${w.detail.index} id:${w.detail.gamepad?.id}`)));const k=["","ArrowUp","","ArrowLeft","","ArrowRight","","ArrowDown",""],v=[0,0];b.on("gamepad:axis",w=>{if(!document.hasFocus())return;v[w.detail.axis]=w.detail.value;const[x=0,E=0]=v,A=(E+1)*3+(x+1),N=k[A];if(!N)return;const M=this.#t.getFocus();(!M||M instanceof U?globalThis:M).dispatchEvent(new KeyboardEvent(Lt,{key:N,bubbles:!0})),!(!M||M instanceof U)&&M.getAttribute("type")==="range"&&M.dispatchEvent(new InputEvent("input",{bubbles:!0}))}),b.on("gamepad:button",w=>{if(document.hasFocus())if(w.detail.button%2===0){const x=this.#t.getFocus();(!x||x instanceof U?globalThis:x).dispatchEvent(new KeyboardEvent(Lt,{key:"Enter",bubbles:!0}))}else _.fire("middleclick",w)}),b.start()}),this.#e.add(window,"keyup",d=>{d.isComposing||d.key in this.#y&&(this.#y[d.key]=0)}),o.defTmp("const.sn.key.alternate",()=>this.#y.Alt>0),o.defTmp("const.sn.key.command",()=>this.#y.Meta>0),o.defTmp("const.sn.key.control",()=>this.#y.Control>0),o.defTmp("const.sn.key.end",()=>this.#y.End>0),o.defTmp("const.sn.key.escape",()=>this.#y.Escape>0),o.defTmp("const.sn.key.back",()=>this.#y.GoBack>0)}#e=new ue;#t=new Di;resvFlameEvent(t){this.#e.add(t,Lt,e=>this.#n(e)),this.#e.add(t,"contextmenu",e=>{_.fire(this.#i(e)+"rightclick",e),e.preventDefault()}),this.#s(t)}#s=t=>{};#n(t){t.isComposing||(t.key in this.#y&&(this.#y[t.key]=t.repeat?2:1),_.fire(ii.modKey(t)+t.key,t))}#i(t){return(t.altKey?"alt+":"")+(t.ctrlKey?"ctrl+":"")+(t.metaKey?"meta+":"")+(t.shiftKey?"shift+":"")}#o(t){if(this.#h){this.#b=!0;return}this.#h=!0,this.#c();const e=this.#i(t)+(t.deltaY>0?"downwheel":"upwheel");_.fire(e,t)}#h=!1;#b=!1;#c(){setTimeout(()=>{if(this.#b){this.#b=!1,this.#c();return}this.#h=!1},250)}destroy(){for(const t of Array.from(document.getElementsByClassName("sn_hint")))t.parentElement?.removeChild(t);P.destroy(),this.#t.destroy(),this.#e.clear()}fire(t,e){_.fire(t,e)}unButton(t){this.#t.remove(t)}button(t,e,s,i,r){!t.fn&&!t.label&&!t.url&&this.main.errScript("fnまたはlabelまたはurlは必須です"),t.fn??=this.scrItr.scriptFn,e.interactive=!0,e.cursor="pointer";const o=t.key?.toLowerCase()??" ",a=O(t,"global",!1);P.setEvt2Fnc(a,o,()=>this.main.resumeByJumpOrCall(t)),e.on(Te,u=>{_.fire(o,u)});const h=t.hint?()=>this.#g(t,e):()=>{},l=()=>{s(),this.#d.hidden=!0},c=()=>(h(),i());if(e.on("pointerover",c),e.on("pointerout",()=>{this.#t.isFocus(e)?c():l()}),e.on("pointerdown",()=>{this.#d.hidden=!0;const u=this.#t.getFocus();r(),u instanceof rt&&u.normal()}),e.on("pointerup",T.isMobile?l:()=>{this.#t.isFocus(e)?c():l()}),this.#t.add(e,c,l),t.clickse&&(t.clicksebuf??="SYS",this.cfg.searchPath(t.clickse,Z.SOUND),e.on("pointerdown",()=>{this.hTag.playse({fn:t.clickse,buf:t.clicksebuf,join:!1})})),t.enterse&&(t.entersebuf??="SYS",this.cfg.searchPath(t.enterse,Z.SOUND),e.on("pointerover",()=>{this.hTag.playse({fn:t.enterse,buf:t.entersebuf,join:!1})})),t.leavese&&(t.leavesebuf??="SYS",this.cfg.searchPath(t.leavese,Z.SOUND),e.on("pointerout",()=>{this.hTag.playse({fn:t.leavese,buf:t.leavesebuf,join:!1})})),t.onenter){const u=o+t.onenter.toLowerCase(),p={fn:t.fn,label:t.onenter,call:!0,key:u};P.setEvt2Fnc(a,u,()=>this.main.resumeByJumpOrCall(p)),e.on("pointerover",g=>_.fire(u,g))}if(t.onleave){const u=o+t.onleave.toLowerCase(),p={fn:t.fn,label:t.onleave,call:!0,key:u};P.setEvt2Fnc(a,u,()=>this.main.resumeByJumpOrCall(p)),e.on("pointerout",g=>_.fire(u,g))}}#r={getBoundingClientRect:(t=0,e=0)=>DOMRect.fromRect({x:t,y:e,width:0,height:0})};#d;#u;#f;#p={placement:"bottom",modifiers:[{name:"flip",options:{fallbackPlacements:["top","bottom"]}}]};#g(t,e){const s=e instanceof rt?e.getBtnBounds():e.getBounds();if(t[":タグ名"]!=="link"){const i=e.parent.parent;s.x+=i.x,s.y+=i.y}if(!t.hint){this.#d.hidden=!0;return}this.#d.style.cssText=`position:${this.#d.style.position}; transform:${this.#d.style.transform};`+(t.hint_style??""),this.#u.style.cssText="",this.#u.textContent=t.hint??"";try{const i=t.hint_opt?{...this.#p,...JSON.parse(t.hint_opt)}:this.#p;this.#f.setOptions(i)}catch(i){console.error(_e(t,"hint_opt",`dispHint 引数 hint_opt エラー ${i instanceof SyntaxError?i.message:""}`))}this.#r.getBoundingClientRect=()=>DOMRect.fromRect({x:this.sys.ofsLeft4elm+s.x*this.sys.cvsScale,y:this.sys.ofsTop4elm+s.y*this.sys.cvsScale,width:s.width,height:s.height}),this.#f.update(),this.#d.hidden=!1}hideHint(){this.#d.hidden=!0}cvsResize(){this.hideHint()}#v(t){const e=t.key;if(!e)throw"keyは必須です";const s=e.toLowerCase(),i=O(t,"call",!1),r=O(t,"global",!1);if(O(t,"del",!1)){if(t.fn||t.label||i||t.url)throw"fn/label/callとdelは同時指定できません";return P.clear_eventer(e,r,s),!1}if(!t.fn&&!t.label&&!t.url)throw"fn,label,url いずれかは必須です";if(t.fn??=this.scrItr.scriptFn,e.startsWith("dom=")){const o=P.getHtmlElmList(e);if(o.el.length===0){if(O(t,"need_err",!0))throw`HTML内にセレクタ（${o.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;return!1}let a=["click",Lt];switch(o.el[0].type??""){case"checkbox":a=["input"];break;case"range":a=["input"];break;case"text":case"textarea":a=["input","change"];break}const h=a.length;for(let l=0;l<h;++l){const c=a[l];o.el.forEach(u=>{this.#e.add(u,c,p=>{if(!_.isWait||this.layMng.getFrmDisabled(o.id)||c===Lt&&p.key!=="Enter")return;const g=u.dataset;for(const[f,m]of Object.entries(g))this.val.setVal_Nochk("tmp",`sn.event.domdata.${f}`,m);_.fire(e,p)}),l===0&&this.#t.add(u,()=>this.#l(u)?(u.focus(),!0):!1,()=>{})})}}return P.setEvt2Fnc(r,s,()=>this.main.resumeByJumpOrCall(t)),!1}#l(t){if(t.offsetParent===null)return!1;let e=t;do{if(getComputedStyle(e).display==="none"||e.dataset.focus==="false"||e?.disabled)return!1;e=e.parentElement}while(e!==null);return!0}#T(t){const{add:e,del:s,to:i}=t;if(e?.startsWith("dom=")){const r=P.getHtmlElmList(e);if(r.el.length===0&&O(t,"need_err",!0))throw`HTML内にセレクタ（${r.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;return r.el.forEach(o=>this.#t.add(o,()=>this.#l(o)?(o.focus(),!0):!1,()=>{})),!1}if(s?.startsWith("dom=")){const r=P.getHtmlElmList(s);if(r.el.length===0&&O(t,"need_err",!0))throw`HTML内にセレクタ（${r.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;return r.el.forEach(o=>this.#t.remove(o)),!1}if(!i)throw"[set_focus] add か to は必須です";switch(i){case"null":this.#t.blur();break;case"next":this.#t.next();break;case"prev":this.#t.prev();break}return!1}get isSkipping(){return _.isSkipping?!0:Object.keys(this.#y).some(t=>this.#y[t]===2)}#y={Alt:0,Meta:0,Control:0,ArrowDown:0,End:0,Enter:0,Escape:0," ":0,GoBack:0}}const tr=Object.freeze(Object.defineProperty({__proto__:null,EVNM_CLICK:Te,EVNM_KEY:Lt,EventMng:Gn},Symbol.toStringTag,{value:"Module"}));let P=class st{static#e;static get rs(){return this.#e}constructor(){st.#e=this}static#t={};static#s={};static setEvt2Fnc(t,e,s){t?this.#s[e]=s:this.#t[e]=s}static getEvt2Fnc=t=>this.#t[t]??this.#s[t];static clear_eventer(t,e,s){if(!t.startsWith("dom="))return;const i=e?this.#s[s]:this.#t[s];i&&this.getHtmlElmList(t).el.forEach(r=>r.removeEventListener("click",i)),e?delete this.#s[s]:delete this.#t[s]}static popLocalEvts(){const t=this.#t;return this.#t={},t}static pushLocalEvts(t){this.#t=t}static clear_event(t){const e=O(t,"global",!1),s=e?this.#s:this.#t;for(const[i,r]of Object.entries(s))i.startsWith("dom=")&&this.getHtmlElmList(i).el.forEach(o=>o.removeEventListener("click",r));return e?this.#s={}:this.#t={},!1}static getHtmlElmList(t){const e=t.indexOf(":");let s="";if(e>=0){const i=t.slice(4,e),r=`const.sn.frm.${i}`;if(!_.val.getVal(`tmp:${r}`,0))throw`HTML【${i}】が読み込まれていません`;const o=document.getElementById(i).contentWindow;return s=t.slice(e+1),{el:o.document.querySelectorAll(s),id:i,sel:s}}return s=t.slice(4),{el:document.querySelectorAll(s),id:"",sel:s}}static waitRsvEvent(t,e){if(_.val.saveKidoku(),e?this.#t.click=this.#t.enter=this.#t.arrowdown=this.#t["wheel.y>0"]=()=>e():(delete this.#t.click,delete this.#t.enter,delete this.#t.arrowdown,delete this.#t["wheel.y>0"]),this.getEvt2Fnc=t?s=>this.#t[s]??this.#s[s]:s=>this.#t[s],_.scrItr.noticeWait(),T.debugLog){const s=Object.create(null);s.local=Object.keys(this.#t),s.global=Object.keys(this.#s),console.log("🎍 wait event... %o",s)}}static waitRsvEvent4Paging(){if(this.waitRsvEvent(!0),this.aKeysAtPaging.length===0){this.getEvt2Fnc=e=>this.#t[e]??this.#s[e];return}const t={};for(const e of this.aKeysAtPaging){const s=this.#s[e];s&&(t[e]=s)}this.getEvt2Fnc=e=>this.#t[e]??t[e]}fire(t,e){const s=t.toLowerCase();if(T.debugLog&&console.log(`👺 fire<(key:\`${s}\` type:${e.type} e:%o)`,{...e}),s==="enter"){const r=_.fcs.getFocus();if(r instanceof U){r.emit("pointerdown",new PointerEvent("pointerdown"));return}}const i=st.getEvt2Fnc(s);i&&(e.stopPropagation(),!(!s.startsWith("dom=")&&_.layMng.clickTxtLay())&&i(e))}get isSkipping(){return _.skip_enabled}isWait=!1;static aPage;static lenPage=0;static posPage=0;static styPaging;static INI_STYPAGE="color: yellow; text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;";static aKeysAtPaging=[];static recodePage(t=!1){if(!_.val.getVal("save:sn.doRecLog"))return;const{fn:e,idx:s}=_.scrItr.nowScrIdx(),i=`${s-1}:`+e;if(this.aPage.findIndex(o=>o.key===i)>-1)return;T.debugLog&&console.log(`📜 %crecodePage === week:${t} lenPage:${this.lenPage} len:${this.aPage.length} POP:${!!this.aPage.at(-1)?.week}`,"color:#3B0;"),this.aPage.at(-1)?.week&&this.aPage.pop();const{max_len:r}=_.cfg.oCfg.log;if(this.aPage.push({key:i,week:t,fn:_.val.getVal("save:const.sn.scriptFn",e),index:_.val.getVal("save:const.sn.scriptIdx",0),mark:_.scrItr.nowMark()})>r&&(this.aPage=this.aPage.slice(-r)),this.lenPage=this.aPage.length,T.debugLog){const o=_.scrItr.nowMark();console.log(`   %clenPage:${this.lenPage} (base=${o.hPages.base.fore.sBkFn} 0=${o.hPages[0].fore.sBkFn} mes=${o.hPages.mes.fore.txs.cssText.match(/color: \w+;/)})%c mark:%o`,"color:#3B0;","",o),console.table(this.aPage)}_.val.setVal_Nochk("sys","const.sn.aPageLog",JSON.stringify(this.aPage))}static playbackPage(t,e){this.aPage=JSON.parse(t),this.lenPage=this.aPage.length,this.posPage>=this.lenPage&&(this.posPage=this.lenPage-1),this.styPaging=e}beginProc(){new qs}endProc(){new ce}l(t){if(console.log(`fn:Reading.ts line:218 [l] isKidoku:${_.scrItr.isKidoku} isNextKidoku:${_.scrItr.isNextKidoku} A:${_.auto_enabled} B:${_.skip_enabled} C:${_.skip_all}`),!_.tagL_enabled)return!1;if(st.recodePage(!0),O(t,"visible",!0)&&(_.layMng.breakLine(t),_.goTxt()),_.auto_enabled)return t.time=Number(_.val.getVal(`sys:sn.auto.msecLineWait${_.scrItr.isKidoku?"_Kidoku":""}`)),this.wait(t);if(_.skip_enabled){if(!_.scrItr.isNextKidoku)return _.cancelAutoSkip(),new Yt(t),!0;if(!_.skip_all&&!_.scrItr.isNextKidoku)return this.s(t);if("ps".includes(_.val.getVal("sys:sn.skip.mode")))return t.time=50,this.wait(t)}return new Yt(t),!0}p(t){if(console.log(`fn:Reading.ts line:248 [p] isKidoku:${_.scrItr.isKidoku} isNextKidoku:${_.scrItr.isNextKidoku} A:${_.auto_enabled} B:${_.skip_enabled} C:${_.skip_all}`),st.recodePage(),O(t,"visible",!0)&&(_.layMng.breakPage(t),_.goTxt()),_.auto_enabled)return t.time=Number(_.val.getVal(`sys:sn.auto.msecPageWait${_.scrItr.isKidoku?"_Kidoku":""}`)),this.wait(t);if(_.skip_enabled){if(!_.skip_all&&!_.scrItr.isNextKidoku)return this.s(t);if(_.val.getVal("sys:sn.skip.mode")=="s")return t.time=50,this.wait(t)}return new Yt(t),!0}s(t){return st.recodePage(),_.cancelAutoSkip(),new Yt(t),!0}wait(t){const e=$(t,"time",NaN);if(_.skip_enabled)return!_.skip_all&&!_.scrItr.isNextKidoku&&_.cancelAutoSkip(),!1;const s=new oe({}),i="wait",r=()=>{Cs(s),_.notifyEndProc(i)};s.to({},e).onComplete(r).start();const o=O(t,"canskip",!0);return _.beginProc(i,r,!0,o?r:void 0),!0}page(t){if(!("clear"in t||"to"in t||"style"in t))throw"clear,style,to いずれかは必須です";const{key:e,style:s}=t;return e&&(st.aKeysAtPaging=e.split(",")),s?(st.styPaging=s,_.val.setVal_Nochk("save","const.sn.styPaging",s),!1):(O(t,"clear",!1)&&(st.aPage=[],st.lenPage=0,st.posPage=0,_.val.setVal_Nochk("sys","const.sn.aPageLog","[]"),_.val.setVal_Nochk("save","const.sn.styPaging",st.INI_STYPAGE)),!1)}static destroy(){this.#t={},this.#s={},this.aPage=[],this.lenPage=0,this.posPage=0}};class ce extends P{constructor(){super(),T.debugLog&&console.log("📖 => %cReadingState_go","color:#3B0;"),_.main.resume()}fire(t,e){}}class qs extends P{constructor(){super(),T.debugLog&&console.log("📖 => %cReadingState_proc","color:#3B0;")}}class Yt extends P{constructor(t){super(),T.debugLog&&console.log("📖 => %cReadingState_wait","color:#3B0;");let e=()=>{};const s=O(t,"global",!0);switch(t[":タグ名"]){case"wait":return;case"s":P.waitRsvEvent(s);return;case"p":e=()=>{O(t,"er",!1)&&_.hTag.er(t),_.sndMng.clearCache(),new ce};break;default:e=()=>new ce}P.waitRsvEvent(s,e)}isWait=!0;page(t){const e=super.page(t),{to:s}=t;if(!s)return e;if(P.lenPage<2)return!1;switch(s){case"oldest":t.to="prev",P.posPage=1;break;case"newest":case"prev":t.to="prev",P.posPage=P.lenPage-1;break;default:return!1}return Ze.go(t)}}class Ze extends P{constructor(){super(),T.debugLog&&console.log("📖 => %cReadingState_page","color:#3B0;"),_.val.setVal_Nochk("tmp","const.sn.isPaging",!0)}static go(t){return new Ze().page(t)}#e=!0;get isSkipping(){return this.#e}isWait=!1;beginProc(){_.main.stop()}endProc(){_.main.resume()}l(t){return this.#e?P.posPage===P.lenPage-1?(this.#t(),new ce().l(t)):(O(t,"visible",!0)&&_.layMng.breakLine(t),_.layMng.setAllStyle2TxtLay(P.styPaging),_.goTxt(),P.aPage[P.posPage]?.week?(P.waitRsvEvent4Paging(),!0):!1):super.l(t)}p(t){return this.#e?P.posPage===P.lenPage-1?(this.#t(),new ce().p(t)):(O(t,"visible",!0)&&_.layMng.breakPage(t),_.layMng.setAllStyle2TxtLay(P.styPaging),_.goTxt(),P.waitRsvEvent4Paging(),!0):super.p(t)}s(t){return new Yt(t),!0}wait(){return!1}page(t){const{to:e,style:s,clear:i}=t;if(s||i)return!1;switch(T.debugLog&&console.log(`📜 %cpage() pos:${P.posPage}%c len:${P.lenPage} to:${e}`,"color:#3B0;",""),e){case"oldest":if(P.posPage===0)return!1;P.posPage=0;break;case"prev":if(P.posPage===0)return!1;--P.posPage;break;case"next":if(P.posPage===P.lenPage-1)return!1;++P.posPage;break;case"newest":if(P.posPage===P.lenPage-1)return!1;P.posPage=P.lenPage-1;break;case"exit":P.posPage=P.lenPage-1;break;case"load":P.lenPage=P.posPage+1,P.aPage=P.aPage.slice(0,P.lenPage),this.#t();break;default:throw`属性to「${e}」は異常です`}P.posPage===P.lenPage-1&&this.#t();const r=P.aPage[P.posPage];if(!r)throw`posPage異常:${P.posPage}`;const{fn:o,index:a,mark:h}=r;if(T.debugLog){const l=_.scrItr.nowMark(),{week:c}=P.aPage[P.posPage]??{week:!1};console.log(`   -- fn:${o} i:${a} pos:${P.posPage} (base=%c${l.hPages.base.fore.sBkFn}%c 0=%c${l.hPages[0].fore.sBkFn}%c mes=%c${l.hPages.mes.fore.txs.cssText.match(/color: \w+;/)}%c) week:${c} A:${P.posPage===P.lenPage-1}
   styPaging=%c${P.styPaging}%c
   mark:%o`,"background-color:#3B0; color:#000;","","background-color:#B4F; color:#000;","","color:#B68;","",P.styPaging,"",h)}return _.scrItr.loadFromMark({fn:o,index:a},h)}#t(){_.val.setVal_Nochk("tmp","const.sn.isPaging",!1),this.#e=!1}}class _{static beginProc(t,e,s=!0,i){if(T.debugLog&&console.log(`📖.beginProc id:%c${t}%c onNotify:${!!e} endProc:${s} onClickSkip:${!!i}`,"color:#3B0;",""),this.#e(),this.#n=t,e){const{promise:r,resolve:o}=Promise.withResolvers();r.then(a=>{T.debugLog&&console.log(`📖.notifyEndProc id:%c${a}%c`,"color:#3B0;",""),e(),s?this.endProc(a):this.#e()}),this.#s=o}if(i){const r=()=>{this.cancelAutoSkip(),i(),s&&this.endProc(t)};this.#t.add(window,Te,o=>{o.stopPropagation(),r()}),this.#t.add(window,"keyup",o=>{o.isComposing||(o.stopPropagation(),r())}),this.procWheel4wle(this.#t,r)}P.rs.beginProc()}static#e(){this.#n="",this.#s=()=>{},this.#t.clear()}static#t=new ue;static#s=()=>{};static notifyEndProc(t){this.#s(t)}static endProc(t){T.debugLog&&console.log(`📖.endProc id:%c${t}%c=${this.#n===t}`,"color:#3B0;",""),this.#n===t&&(P.rs.endProc(),this.#e())}static#n="";static get procID(){return`RP_${this.scrItr.scriptFn}:${this.scrItr.idxToken}_`}static fire(t,e){P.rs.fire(t,e)}static get isSkipping(){return P.rs.isSkipping}static get isWait(){return P.rs.isWait}static tagL_enabled=!0;static skip_all=!1;static skip_enabled=!1;static auto_enabled=!1;static cfg;static hTag;static main;static val;static scrItr;static layMng;static goTxt=()=>{};static get needGoTxt(){return this.layMng.needGoTxt}static evtMng;static sndMng;static procWheel4wle;static fcs;static init(t,e,s,i,r,o,a,h,l){this.cfg=t,this.hTag=e,this.main=s,this.val=i,this.scrItr=r,this.layMng=o,this.goTxt=()=>o.goTxt(),this.evtMng=a,this.sndMng=h,this.procWheel4wle=l,i.defTmp("sn.tagL.enabled",()=>this.tagL_enabled),i.defValTrg("tmp:sn.tagL.enabled",(c,u)=>this.tagL_enabled=String(u)!=="false"),i.defTmp("sn.skip.all",()=>this.skip_all),i.defValTrg("tmp:sn.skip.all",(c,u)=>this.skip_all=String(u)!=="false"),i.defTmp("sn.skip.enabled",()=>this.skip_enabled),i.defValTrg("tmp:sn.skip.enabled",(c,u)=>this.skip_enabled=String(u)!=="false"),i.defTmp("sn.auto.enabled",()=>this.auto_enabled),i.defValTrg("tmp:sn.auto.enabled",(c,u)=>this.auto_enabled=String(u)!=="false"),e.l=c=>P.rs.l(c),e.p=c=>P.rs.p(c),e.s=c=>P.rs.s(c),e.wait=c=>P.rs.wait(c),e.waitclick=c=>P.rs.s(c),e.page=c=>P.rs.page(c),new qs,e.jump({fn:"main"})}static setFcs(t){this.fcs=t}static cancelAutoSkip(){this.tagL_enabled||(this.tagL_enabled=!0,this.val.setVal_Nochk("tmp","sn.tagL.enabled",!0)),this.skip_enabled&&(this.skip_enabled=!1,this.val.setVal_Nochk("tmp","sn.skip.enabled",!1)),this.auto_enabled&&(this.auto_enabled=!1,this.val.setVal_Nochk("tmp","sn.auto.enabled",!1))}}export{se as B,tr as E,Qn as I,Zn as L,P as R,Ve as S,ps as a,Pe as b,Xn as c};
