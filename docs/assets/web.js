const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Variable.js","./PropParser.js","../web.js","./SoundMng.js"])))=>i.map(i=>d[i]);
import{_ as __vitePreload}from"../web.js";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function getAugmentedNamespace(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),t}var platform$2={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */var platform$1=platform$2.exports,hasRequiredPlatform;function requirePlatform(){return hasRequiredPlatform||(hasRequiredPlatform=1,function(n,e){(function(){var t={function:!0,object:!0},r=t[typeof window]&&window||this,o=e,D=n&&!n.nodeType&&n,N=o&&D&&typeof commonjsGlobal=="object"&&commonjsGlobal;N&&(N.global===N||N.window===N||N.self===N)&&(r=N);var k=Math.pow(2,53)-1,B=/\bOpera/,G=Object.prototype,U=G.hasOwnProperty,H=G.toString;function $(te){return te=String(te),te.charAt(0).toUpperCase()+te.slice(1)}function V(te,oe,ce){var fe={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return oe&&ce&&/^Win/i.test(te)&&!/^Windows Phone /i.test(te)&&(fe=fe[/[\d.]+$/.exec(te)])&&(te="Windows "+fe),te=String(te),oe&&ce&&(te=te.replace(RegExp(oe,"i"),ce)),te=X(te.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),te}function Y(te,oe){var ce=-1,fe=te?te.length:0;if(typeof fe=="number"&&fe>-1&&fe<=k)for(;++ce<fe;)oe(te[ce],ce,te);else z(te,oe)}function X(te){return te=Z(te),/^(?:webOS|i(?:OS|P))/.test(te)?te:$(te)}function z(te,oe){for(var ce in te)U.call(te,ce)&&oe(te[ce],ce,te)}function W(te){return te==null?$(te):H.call(te).slice(8,-1)}function q(te,oe){var ce=te!=null?typeof te[oe]:"number";return!/^(?:boolean|number|string|undefined)$/.test(ce)&&(ce=="object"?!!te[oe]:!0)}function K(te){return String(te).replace(/([ -])(?!$)/g,"$1?")}function Q(te,oe){var ce=null;return Y(te,function(fe,me){ce=oe(ce,fe,me,te)}),ce}function Z(te){return String(te).replace(/^ +| +$/g,"")}function ee(te){var oe=r,ce=te&&typeof te=="object"&&W(te)!="String";ce&&(oe=te,te=null);var fe=oe.navigator||{},me=fe.userAgent||"";te||(te=me);var we=ce?!!fe.likeChrome:/\bChrome\b/.test(te)&&!/internal|\n/i.test(H.toString()),Me="Object",Ee=ce?Me:"ScriptBridgingProxyObject",ie=ce?Me:"Environment",ne=ce&&oe.java?"JavaPackage":W(oe.java),se=ce?Me:"RuntimeObject",ue=/\bJava/.test(ne)&&oe.java,le=ue&&W(oe.environment)==ie,he=ue?"a":"α",pe=ue?"b":"β",de=oe.document||{},ve=oe.operamini||oe.opera,Se=B.test(Se=ce&&ve?ve["[[Class]]"]:W(ve))?Se:ve=null,ae,Ae=te,xe=[],Ce=null,Oe=te==me,Te=Oe&&ve&&typeof ve.version=="function"&&ve.version(),De,Ie=$e([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),_e=He(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Re=qe([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Pe=Ye({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),be=ze(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function $e(Ue){return Q(Ue,function(Fe,Le){return Fe||RegExp("\\b"+(Le.pattern||K(Le))+"\\b","i").exec(te)&&(Le.label||Le)})}function Ye(Ue){return Q(Ue,function(Fe,Le,Xe){return Fe||(Le[Re]||Le[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Re)]||RegExp("\\b"+K(Xe)+"(?:\\b|\\w*\\d)","i").exec(te))&&Xe})}function He(Ue){return Q(Ue,function(Fe,Le){return Fe||RegExp("\\b"+(Le.pattern||K(Le))+"\\b","i").exec(te)&&(Le.label||Le)})}function ze(Ue){return Q(Ue,function(Fe,Le){var Xe=Le.pattern||K(Le);return!Fe&&(Fe=RegExp("\\b"+Xe+"(?:/[\\d.]+|[ \\w.]*)","i").exec(te))&&(Fe=V(Fe,Xe,Le.label||Le)),Fe})}function qe(Ue){return Q(Ue,function(Fe,Le){var Xe=Le.pattern||K(Le);return!Fe&&(Fe=RegExp("\\b"+Xe+" *\\d+[.\\w_]*","i").exec(te)||RegExp("\\b"+Xe+" *\\w+-[\\w]*","i").exec(te)||RegExp("\\b"+Xe+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(te))&&((Fe=String(Le.label&&!RegExp(Xe,"i").test(Le.label)?Le.label:Fe).split("/"))[1]&&!/[\d.]+/.test(Fe[0])&&(Fe[0]+=" "+Fe[1]),Le=Le.label||Le,Fe=X(Fe[0].replace(RegExp(Xe,"i"),Le).replace(RegExp("; *(?:"+Le+"[_-])?","i")," ").replace(RegExp("("+Le+")[-_.]?(\\w)","i"),"$1 $2"))),Fe})}function Ze(Ue){return Q(Ue,function(Fe,Le){return Fe||(RegExp(Le+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(te)||0)[1]||null})}function Ke(){return this.description||""}if(Ie&&(Ie=[Ie]),/\bAndroid\b/.test(be)&&!Re&&(ae=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(te))&&(Re=Z(ae[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),Pe&&!Re?Re=qe([Pe]):Pe&&Re&&(Re=Re.replace(RegExp("^("+K(Pe)+")[-_.\\s]","i"),Pe+" ").replace(RegExp("^("+K(Pe)+")[-_.]?(\\w)","i"),Pe+" $2")),(ae=/\bGoogle TV\b/.exec(Re))&&(Re=ae[0]),/\bSimulator\b/i.test(te)&&(Re=(Re?Re+" ":"")+"Simulator"),_e=="Opera Mini"&&/\bOPiOS\b/.test(te)&&xe.push("running in Turbo/Uncompressed mode"),_e=="IE"&&/\blike iPhone OS\b/.test(te)?(ae=ee(te.replace(/like iPhone OS/,"")),Pe=ae.manufacturer,Re=ae.product):/^iP/.test(Re)?(_e||(_e="Safari"),be="iOS"+((ae=/ OS ([\d_]+)/i.exec(te))?" "+ae[1].replace(/_/g,"."):"")):_e=="Konqueror"&&/^Linux\b/i.test(be)?be="Kubuntu":Pe&&Pe!="Google"&&(/Chrome/.test(_e)&&!/\bMobile Safari\b/i.test(te)||/\bVita\b/.test(Re))||/\bAndroid\b/.test(be)&&/^Chrome/.test(_e)&&/\bVersion\//i.test(te)?(_e="Android Browser",be=/\bAndroid\b/.test(be)?be:"Android"):_e=="Silk"?(/\bMobi/i.test(te)||(be="Android",xe.unshift("desktop mode")),/Accelerated *= *true/i.test(te)&&xe.unshift("accelerated")):_e=="UC Browser"&&/\bUCWEB\b/.test(te)?xe.push("speed mode"):_e=="PaleMoon"&&(ae=/\bFirefox\/([\d.]+)\b/.exec(te))?xe.push("identifying as Firefox "+ae[1]):_e=="Firefox"&&(ae=/\b(Mobile|Tablet|TV)\b/i.exec(te))?(be||(be="Firefox OS"),Re||(Re=ae[1])):!_e||(ae=!/\bMinefield\b/i.test(te)&&/\b(?:Firefox|Safari)\b/.exec(_e))?(_e&&!Re&&/[\/,]|^[^(]+?\)/.test(te.slice(te.indexOf(ae+"/")+8))&&(_e=null),(ae=Re||Pe||be)&&(Re||Pe||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(be))&&(_e=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(be)?be:ae)+" Browser")):_e=="Electron"&&(ae=(/\bChrome\/([\d.]+)\b/.exec(te)||0)[1])&&xe.push("Chromium "+ae),Te||(Te=Ze(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",K(_e),"(?:Firefox|Minefield|NetFront)"])),(ae=Ie=="iCab"&&parseFloat(Te)>3&&"WebKit"||/\bOpera\b/.test(_e)&&(/\bOPR\b/.test(te)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(te)&&!/^(?:Trident|EdgeHTML)$/.test(Ie)&&"WebKit"||!Ie&&/\bMSIE\b/i.test(te)&&(be=="Mac OS"?"Tasman":"Trident")||Ie=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(_e)&&"NetFront")&&(Ie=[ae]),_e=="IE"&&(ae=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(te)||0)[1])?(_e+=" Mobile",be="Windows Phone "+(/\+$/.test(ae)?ae:ae+".x"),xe.unshift("desktop mode")):/\bWPDesktop\b/i.test(te)?(_e="IE Mobile",be="Windows Phone 8.x",xe.unshift("desktop mode"),Te||(Te=(/\brv:([\d.]+)/.exec(te)||0)[1])):_e!="IE"&&Ie=="Trident"&&(ae=/\brv:([\d.]+)/.exec(te))&&(_e&&xe.push("identifying as "+_e+(Te?" "+Te:"")),_e="IE",Te=ae[1]),Oe){if(q(oe,"global"))if(ue&&(ae=ue.lang.System,Ae=ae.getProperty("os.arch"),be=be||ae.getProperty("os.name")+" "+ae.getProperty("os.version")),le){try{Te=oe.require("ringo/engine").version.join("."),_e="RingoJS"}catch{(ae=oe.system)&&ae.global.system==oe.system&&(_e="Narwhal",be||(be=ae[0].os||null))}_e||(_e="Rhino")}else typeof oe.process=="object"&&!oe.process.browser&&(ae=oe.process)&&(typeof ae.versions=="object"&&(typeof ae.versions.electron=="string"?(xe.push("Node "+ae.versions.node),_e="Electron",Te=ae.versions.electron):typeof ae.versions.nw=="string"&&(xe.push("Chromium "+Te,"Node "+ae.versions.node),_e="NW.js",Te=ae.versions.nw)),_e||(_e="Node.js",Ae=ae.arch,be=ae.platform,Te=/[\d.]+/.exec(ae.version),Te=Te?Te[0]:null));else W(ae=oe.runtime)==Ee?(_e="Adobe AIR",be=ae.flash.system.Capabilities.os):W(ae=oe.phantom)==se?(_e="PhantomJS",Te=(ae=ae.version||null)&&ae.major+"."+ae.minor+"."+ae.patch):typeof de.documentMode=="number"&&(ae=/\bTrident\/(\d+)/i.exec(te))?(Te=[Te,de.documentMode],(ae=+ae[1]+4)!=Te[1]&&(xe.push("IE "+Te[1]+" mode"),Ie&&(Ie[1]=""),Te[1]=ae),Te=_e=="IE"?String(Te[1].toFixed(1)):Te[0]):typeof de.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(_e)&&(xe.push("masking as "+_e+" "+Te),_e="IE",Te="11.0",Ie=["Trident"],be="Windows");be=be&&X(be)}if(Te&&(ae=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(Te)||/(?:alpha|beta)(?: ?\d)?/i.exec(te+";"+(Oe&&fe.appMinorVersion))||/\bMinefield\b/i.test(te)&&"a")&&(Ce=/b/i.test(ae)?"beta":"alpha",Te=Te.replace(RegExp(ae+"\\+?$"),"")+(Ce=="beta"?pe:he)+(/\d+\+?/.exec(ae)||"")),_e=="Fennec"||_e=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(be))_e="Firefox Mobile";else if(_e=="Maxthon"&&Te)Te=Te.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Re))Re=="Xbox 360"&&(be=null),Re=="Xbox 360"&&/\bIEMobile\b/.test(te)&&xe.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(_e)||_e&&!Re&&!/Browser|Mobi/.test(_e))&&(be=="Windows CE"||/Mobi/i.test(te)))_e+=" Mobile";else if(_e=="IE"&&Oe)try{oe.external===null&&xe.unshift("platform preview")}catch{xe.unshift("embedded")}else(/\bBlackBerry\b/.test(Re)||/\bBB10\b/.test(te))&&(ae=(RegExp(Re.replace(/ +/g," *")+"/([.\\d]+)","i").exec(te)||0)[1]||Te)?(ae=[ae,/BB10/.test(te)],be=(ae[1]?(Re=null,Pe="BlackBerry"):"Device Software")+" "+ae[0],Te=null):this!=z&&Re!="Wii"&&(Oe&&ve||/Opera/.test(_e)&&/\b(?:MSIE|Firefox)\b/i.test(te)||_e=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(be)||_e=="IE"&&(be&&!/^Win/.test(be)&&Te>5.5||/\bWindows XP\b/.test(be)&&Te>8||Te==8&&!/\bTrident\b/.test(te)))&&!B.test(ae=ee.call(z,te.replace(B,"")+";"))&&ae.name&&(ae="ing as "+ae.name+((ae=ae.version)?" "+ae:""),B.test(_e)?(/\bIE\b/.test(ae)&&be=="Mac OS"&&(be=null),ae="identify"+ae):(ae="mask"+ae,Se?_e=X(Se.replace(/([a-z])([A-Z])/g,"$1 $2")):_e="Opera",/\bIE\b/.test(ae)&&(be=null),Oe||(Te=null)),Ie=["Presto"],xe.push(ae));(ae=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(te)||0)[1])&&(ae=[parseFloat(ae.replace(/\.(\d)$/,".0$1")),ae],_e=="Safari"&&ae[1].slice(-1)=="+"?(_e="WebKit Nightly",Ce="alpha",Te=ae[1].slice(0,-1)):(Te==ae[1]||Te==(ae[2]=(/\bSafari\/([\d.]+\+?)/i.exec(te)||0)[1]))&&(Te=null),ae[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(te)||0)[1],ae[0]==537.36&&ae[2]==537.36&&parseFloat(ae[1])>=28&&Ie=="WebKit"&&(Ie=["Blink"]),!Oe||!we&&!ae[1]?(Ie&&(Ie[1]="like Safari"),ae=(ae=ae[0],ae<400?1:ae<500?2:ae<526?3:ae<533?4:ae<534?"4+":ae<535?5:ae<537?6:ae<538?7:ae<601?8:ae<602?9:ae<604?10:ae<606?11:ae<608?12:"12")):(Ie&&(Ie[1]="like Chrome"),ae=ae[1]||(ae=ae[0],ae<530?1:ae<532?2:ae<532.05?3:ae<533?4:ae<534.03?5:ae<534.07?6:ae<534.1?7:ae<534.13?8:ae<534.16?9:ae<534.24?10:ae<534.3?11:ae<535.01?12:ae<535.02?"13+":ae<535.07?15:ae<535.11?16:ae<535.19?17:ae<536.05?18:ae<536.1?19:ae<537.01?20:ae<537.11?"21+":ae<537.13?23:ae<537.18?24:ae<537.24?25:ae<537.36?26:Ie!="Blink"?"27":"28")),Ie&&(Ie[1]+=" "+(ae+=typeof ae=="number"?".x":/[.+]/.test(ae)?"":"+")),_e=="Safari"&&(!Te||parseInt(Te)>45)?Te=ae:_e=="Chrome"&&/\bHeadlessChrome/i.test(te)&&xe.unshift("headless")),_e=="Opera"&&(ae=/\bzbov|zvav$/.exec(be))?(_e+=" ",xe.unshift("desktop mode"),ae=="zvav"?(_e+="Mini",Te=null):_e+="Mobile",be=be.replace(RegExp(" *"+ae+"$"),"")):_e=="Safari"&&/\bChrome\b/.exec(Ie&&Ie[1])?(xe.unshift("desktop mode"),_e="Chrome Mobile",Te=null,/\bOS X\b/.test(be)?(Pe="Apple",be="iOS 4.3+"):be=null):/\bSRWare Iron\b/.test(_e)&&!Te&&(Te=Ze("Chrome")),Te&&Te.indexOf(ae=/[\d.]+$/.exec(be))==0&&te.indexOf("/"+ae+"-")>-1&&(be=Z(be.replace(ae,""))),be&&be.indexOf(_e)!=-1&&!RegExp(_e+" OS").test(be)&&(be=be.replace(RegExp(" *"+K(_e)+" *"),"")),Ie&&!/\b(?:Avant|Nook)\b/.test(_e)&&(/Browser|Lunascape|Maxthon/.test(_e)||_e!="Safari"&&/^iOS/.test(be)&&/\bSafari\b/.test(Ie[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(_e)&&Ie[1])&&(ae=Ie[Ie.length-1])&&xe.push(ae),xe.length&&(xe=["("+xe.join("; ")+")"]),Pe&&Re&&Re.indexOf(Pe)<0&&xe.push("on "+Pe),Re&&xe.push((/^on /.test(xe[xe.length-1])?"":"on ")+Re),be&&(ae=/ ([\d.+]+)$/.exec(be),De=ae&&be.charAt(be.length-ae[0].length-1)=="/",be={architecture:32,family:ae&&!De?be.replace(ae[0],""):be,version:ae?ae[1]:null,toString:function(){var Ue=this.version;return this.family+(Ue&&!De?" "+Ue:"")+(this.architecture==64?" 64-bit":"")}}),(ae=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(Ae))&&!/\bi686\b/i.test(Ae)?(be&&(be.architecture=64,be.family=be.family.replace(RegExp(" *"+ae),"")),_e&&(/\bWOW64\b/i.test(te)||Oe&&/\w(?:86|32)$/.test(fe.cpuClass||fe.platform)&&!/\bWin64; x64\b/i.test(te))&&xe.unshift("32-bit")):be&&/^OS X/.test(be.family)&&_e=="Chrome"&&parseFloat(Te)>=39&&(be.architecture=64),te||(te=null);var Ge={};return Ge.description=te,Ge.layout=Ie&&Ie[0],Ge.manufacturer=Pe,Ge.name=_e,Ge.prerelease=Ce,Ge.product=Re,Ge.ua=te,Ge.version=_e&&Te,Ge.os=be||{architecture:null,family:null,version:null,toString:function(){return"null"}},Ge.parse=ee,Ge.toString=Ke,Ge.version&&xe.unshift(Te),Ge.name&&xe.unshift(_e),be&&_e&&!(be==String(be).split(" ")[0]&&(be==_e.split(" ")[0]||Re))&&xe.push(Re?"("+be+")":"on "+be),xe.length&&(Ge.description=xe.join(" ")),Ge}var J=ee();o&&D?z(J,function(te,oe){o[oe]=te}):r.platform=J}).call(platform$1)}(platform$2,platform$2.exports)),platform$2.exports}var platformExports=requirePlatform();const platform=getDefaultExportFromCjs(platformExports);function int(n){return parseInt(String(n),10)}function uint(n){const e=parseInt(String(n),10);return e<0?-e:e}"toInt"in String.prototype||(String.prototype.toInt=function(){return int(this)});"toUint"in String.prototype||(String.prototype.toUint=function(){const n=int(this);return n<0?-n:n});function getDateStr(n="/",e=" ",t=":",r=""){const o=new Date;return o.getFullYear()+n+String(100+o.getMonth()+1).slice(1,3)+n+String(100+o.getDate()).slice(1,3)+e+String(100+o.getHours()).slice(1,3)+t+String(100+o.getMinutes()).slice(1,3)+(r===""?"":r+String(o.getMilliseconds()))}const css_key4del="/* SKYNovel */";function initStyle(){const n=document.getElementsByTagName("head")[0],e=n.children.length;for(let t=e-1;t>=0;--t){const r=n.children[t];r instanceof HTMLStyleElement&&r.innerText.startsWith(css_key4del)&&n.removeChild(r)}}function addStyle(n){const e=document.createElement("style");e.innerHTML=css_key4del+n,document.getElementsByTagName("head")[0].appendChild(e)}function argChk_Num(n,e,t){const r=n[e];if(!(e in n)){if(isNaN(t))throw`[${n[":タグ名"]}]属性 ${e} は必須です`;return n[e]=t,t}const o=String(r).startsWith("0x")?parseInt(r):parseFloat(r);if(isNaN(o))throw`[${n[":タグ名"]}]属性 ${e} の値【${r}】が数値ではありません`;return n[e]=o}function argChk_Boolean(n,e,t){if(!(e in n))return n[e]=t;const r=n[e];if(r===null)return!1;const o=String(r);return n[e]=o==="false"?!1:!!o}function parseColor(n){if(n.startsWith("#"))return parseInt(n.slice(1),16);const e=Number(n);if(!isNaN(e))return e;if(n==="black")return 0;CmnLib.cc4ColorName.fillStyle=n;const t=CmnLib.cc4ColorName.fillStyle;if(t==="#000000")throw`色名前 ${n} が異常です`;return parseInt(t.slice(1),16)}function argChk_Color(n,e,t){const r=n[e];return r?n[e]=parseColor(String(r)):n[e]=t}const REG_ERRMES_JSON=/JSON at position (\d+)$/;function mesErrJSON(n,e="",t=""){const r=(t.match(REG_ERRMES_JSON)??["",""])[1];return`[${n[":タグ名"]}] ${e} 属性の解析エラー : ${t}
${n[e]}${r?`
${"^".padStart(Number(r))}`:""}`}const REG_FN=/^[^\/\.]+$|[^\/]+(?=\.)/;function getFn(n){return(n.match(REG_FN)??[""])[0]}class CmnLib{static stageW=0;static stageH=0;static debugLog=!1;static isSafari=platformExports.name==="Safari";static isFirefox=platformExports.name==="Firefox";static isMac=/OS X/.test(platformExports.os?.family??"");static isMobile=!/(Windows|OS X)/.test(platformExports.os?.family??"");static hDip={};static isDbg=!1;static isPackaged=!1;static isDarkMode=!1;static cc4ColorName}function finallyConstructor(n){var e=this.constructor;return this.then(function(t){return e.resolve(n()).then(function(){return t})},function(t){return e.resolve(n()).then(function(){return e.reject(t)})})}function allSettled(n){var e=this;return new e(function(t,r){if(!(n&&typeof n.length<"u"))return r(new TypeError(typeof n+" "+n+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(n);if(o.length===0)return t([]);var D=o.length;function N(B,G){if(G&&(typeof G=="object"||typeof G=="function")){var U=G.then;if(typeof U=="function"){U.call(G,function(H){N(B,H)},function(H){o[B]={status:"rejected",reason:H},--D===0&&t(o)});return}}o[B]={status:"fulfilled",value:G},--D===0&&t(o)}for(var k=0;k<o.length;k++)N(k,o[k])})}function AggregateError$1(n,e){this.name="AggregateError",this.errors=n,this.message=e||""}AggregateError$1.prototype=Error.prototype;function any(n){var e=this;return new e(function(t,r){if(!(n&&typeof n.length<"u"))return r(new TypeError("Promise.any accepts an array"));var o=Array.prototype.slice.call(n);if(o.length===0)return r();for(var D=[],N=0;N<o.length;N++)try{e.resolve(o[N]).then(t).catch(function(k){D.push(k),D.length===o.length&&r(new AggregateError$1(D,"All promises were rejected"))})}catch(k){r(k)}})}var setTimeoutFunc=setTimeout;function isArray(n){return!!(n&&typeof n.length<"u")}function noop(){}function bind(n,e){return function(){n.apply(e,arguments)}}function Promise$1(n){if(!(this instanceof Promise$1))throw new TypeError("Promises must be constructed via new");if(typeof n!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(n,this)}function handle(n,e){for(;n._state===3;)n=n._value;if(n._state===0){n._deferreds.push(e);return}n._handled=!0,Promise$1._immediateFn(function(){var t=n._state===1?e.onFulfilled:e.onRejected;if(t===null){(n._state===1?resolve:reject)(e.promise,n._value);return}var r;try{r=t(n._value)}catch(o){reject(e.promise,o);return}resolve(e.promise,r)})}function resolve(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e=="object"||typeof e=="function")){var t=e.then;if(e instanceof Promise$1){n._state=3,n._value=e,finale(n);return}else if(typeof t=="function"){doResolve(bind(t,e),n);return}}n._state=1,n._value=e,finale(n)}catch(r){reject(n,r)}}function reject(n,e){n._state=2,n._value=e,finale(n)}function finale(n){n._state===2&&n._deferreds.length===0&&Promise$1._immediateFn(function(){n._handled||Promise$1._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)handle(n,n._deferreds[e]);n._deferreds=null}function Handler(n,e,t){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.promise=t}function doResolve(n,e){var t=!1;try{n(function(r){t||(t=!0,resolve(e,r))},function(r){t||(t=!0,reject(e,r))})}catch(r){if(t)return;t=!0,reject(e,r)}}Promise$1.prototype.catch=function(n){return this.then(null,n)};Promise$1.prototype.then=function(n,e){var t=new this.constructor(noop);return handle(this,new Handler(n,e,t)),t};Promise$1.prototype.finally=finallyConstructor;Promise$1.all=function(n){return new Promise$1(function(e,t){if(!isArray(n))return t(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(n);if(r.length===0)return e([]);var o=r.length;function D(k,B){try{if(B&&(typeof B=="object"||typeof B=="function")){var G=B.then;if(typeof G=="function"){G.call(B,function(U){D(k,U)},t);return}}r[k]=B,--o===0&&e(r)}catch(U){t(U)}}for(var N=0;N<r.length;N++)D(N,r[N])})};Promise$1.any=any;Promise$1.allSettled=allSettled;Promise$1.resolve=function(n){return n&&typeof n=="object"&&n.constructor===Promise$1?n:new Promise$1(function(e){e(n)})};Promise$1.reject=function(n){return new Promise$1(function(e,t){t(n)})};Promise$1.race=function(n){return new Promise$1(function(e,t){if(!isArray(n))return t(new TypeError("Promise.race accepts an array"));for(var r=0,o=n.length;r<o;r++)Promise$1.resolve(n[r]).then(e,t)})};Promise$1._immediateFn=typeof setImmediate=="function"&&function(n){setImmediate(n)}||function(n){setTimeoutFunc(n,0)};Promise$1._unhandledRejectionFn=function(n){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",n)};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var objectAssign$1,hasRequiredObjectAssign;function requireObjectAssign(){if(hasRequiredObjectAssign)return objectAssign$1;hasRequiredObjectAssign=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(D){if(D==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(D)}function o(){try{if(!Object.assign)return!1;var D=new String("abc");if(D[5]="de",Object.getOwnPropertyNames(D)[0]==="5")return!1;for(var N={},k=0;k<10;k++)N["_"+String.fromCharCode(k)]=k;var B=Object.getOwnPropertyNames(N).map(function(U){return N[U]});if(B.join("")!=="0123456789")return!1;var G={};return"abcdefghijklmnopqrst".split("").forEach(function(U){G[U]=U}),Object.keys(Object.assign({},G)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return objectAssign$1=o()?Object.assign:function(D,N){for(var k,B=r(D),G,U=1;U<arguments.length;U++){k=Object(arguments[U]);for(var H in k)e.call(k,H)&&(B[H]=k[H]);if(n){G=n(k);for(var $=0;$<G.length;$++)t.call(k,G[$])&&(B[G[$]]=k[G[$]])}}return B},objectAssign$1}var objectAssignExports=requireObjectAssign();const objectAssign=getDefaultExportFromCjs(objectAssignExports);/*!
 * @pixi/polyfill - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/polyfill is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */typeof globalThis>"u"&&(typeof self<"u"?self.globalThis=self:typeof global<"u"&&(global.globalThis=global));globalThis.Promise||(globalThis.Promise=Promise$1);Object.assign||(Object.assign=objectAssign);var ONE_FRAME_TIME=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});if(!(globalThis.performance&&globalThis.performance.now)){var startTime_1=Date.now();globalThis.performance||(globalThis.performance={}),globalThis.performance.now=function(){return Date.now()-startTime_1}}var lastTime=Date.now(),vendors=["ms","moz","webkit","o"];for(var x$1=0;x$1<vendors.length&&!globalThis.requestAnimationFrame;++x$1){var p$1=vendors[x$1];globalThis.requestAnimationFrame=globalThis[p$1+"RequestAnimationFrame"],globalThis.cancelAnimationFrame=globalThis[p$1+"CancelAnimationFrame"]||globalThis[p$1+"CancelRequestAnimationFrame"]}globalThis.requestAnimationFrame||(globalThis.requestAnimationFrame=function(n){if(typeof n!="function")throw new TypeError(n+"is not a function");var e=Date.now(),t=ONE_FRAME_TIME+lastTime-e;return t<0&&(t=0),lastTime=e,globalThis.self.setTimeout(function(){lastTime=Date.now(),n(performance.now())},t)});globalThis.cancelAnimationFrame||(globalThis.cancelAnimationFrame=function(n){return clearTimeout(n)});Math.sign||(Math.sign=function(n){return n=Number(n),n===0||isNaN(n)?n:n>0?1:-1});Number.isInteger||(Number.isInteger=function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n});globalThis.ArrayBuffer||(globalThis.ArrayBuffer=Array);globalThis.Float32Array||(globalThis.Float32Array=Array);globalThis.Uint32Array||(globalThis.Uint32Array=Array);globalThis.Uint16Array||(globalThis.Uint16Array=Array);globalThis.Uint8Array||(globalThis.Uint8Array=Array);globalThis.Int32Array||(globalThis.Int32Array=Array);/*!
 * @pixi/constants - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ENV;(function(n){n[n.WEBGL_LEGACY=0]="WEBGL_LEGACY",n[n.WEBGL=1]="WEBGL",n[n.WEBGL2=2]="WEBGL2"})(ENV||(ENV={}));var RENDERER_TYPE;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.WEBGL=1]="WEBGL",n[n.CANVAS=2]="CANVAS"})(RENDERER_TYPE||(RENDERER_TYPE={}));var BUFFER_BITS;(function(n){n[n.COLOR=16384]="COLOR",n[n.DEPTH=256]="DEPTH",n[n.STENCIL=1024]="STENCIL"})(BUFFER_BITS||(BUFFER_BITS={}));var BLEND_MODES;(function(n){n[n.NORMAL=0]="NORMAL",n[n.ADD=1]="ADD",n[n.MULTIPLY=2]="MULTIPLY",n[n.SCREEN=3]="SCREEN",n[n.OVERLAY=4]="OVERLAY",n[n.DARKEN=5]="DARKEN",n[n.LIGHTEN=6]="LIGHTEN",n[n.COLOR_DODGE=7]="COLOR_DODGE",n[n.COLOR_BURN=8]="COLOR_BURN",n[n.HARD_LIGHT=9]="HARD_LIGHT",n[n.SOFT_LIGHT=10]="SOFT_LIGHT",n[n.DIFFERENCE=11]="DIFFERENCE",n[n.EXCLUSION=12]="EXCLUSION",n[n.HUE=13]="HUE",n[n.SATURATION=14]="SATURATION",n[n.COLOR=15]="COLOR",n[n.LUMINOSITY=16]="LUMINOSITY",n[n.NORMAL_NPM=17]="NORMAL_NPM",n[n.ADD_NPM=18]="ADD_NPM",n[n.SCREEN_NPM=19]="SCREEN_NPM",n[n.NONE=20]="NONE",n[n.SRC_OVER=0]="SRC_OVER",n[n.SRC_IN=21]="SRC_IN",n[n.SRC_OUT=22]="SRC_OUT",n[n.SRC_ATOP=23]="SRC_ATOP",n[n.DST_OVER=24]="DST_OVER",n[n.DST_IN=25]="DST_IN",n[n.DST_OUT=26]="DST_OUT",n[n.DST_ATOP=27]="DST_ATOP",n[n.ERASE=26]="ERASE",n[n.SUBTRACT=28]="SUBTRACT",n[n.XOR=29]="XOR"})(BLEND_MODES||(BLEND_MODES={}));var DRAW_MODES;(function(n){n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(DRAW_MODES||(DRAW_MODES={}));var FORMATS;(function(n){n[n.RGBA=6408]="RGBA",n[n.RGB=6407]="RGB",n[n.RG=33319]="RG",n[n.RED=6403]="RED",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.ALPHA=6406]="ALPHA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(FORMATS||(FORMATS={}));var TARGETS;(function(n){n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(TARGETS||(TARGETS={}));var TYPES;(function(n){n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.BYTE=5120]="BYTE",n[n.SHORT=5122]="SHORT",n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.HALF_FLOAT=36193]="HALF_FLOAT"})(TYPES||(TYPES={}));var SAMPLER_TYPES;(function(n){n[n.FLOAT=0]="FLOAT",n[n.INT=1]="INT",n[n.UINT=2]="UINT"})(SAMPLER_TYPES||(SAMPLER_TYPES={}));var SCALE_MODES;(function(n){n[n.NEAREST=0]="NEAREST",n[n.LINEAR=1]="LINEAR"})(SCALE_MODES||(SCALE_MODES={}));var WRAP_MODES;(function(n){n[n.CLAMP=33071]="CLAMP",n[n.REPEAT=10497]="REPEAT",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(WRAP_MODES||(WRAP_MODES={}));var MIPMAP_MODES;(function(n){n[n.OFF=0]="OFF",n[n.POW2=1]="POW2",n[n.ON=2]="ON",n[n.ON_MANUAL=3]="ON_MANUAL"})(MIPMAP_MODES||(MIPMAP_MODES={}));var ALPHA_MODES;(function(n){n[n.NPM=0]="NPM",n[n.UNPACK=1]="UNPACK",n[n.PMA=2]="PMA",n[n.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",n[n.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",n[n.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",n[n.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(ALPHA_MODES||(ALPHA_MODES={}));var CLEAR_MODES;(function(n){n[n.NO=0]="NO",n[n.YES=1]="YES",n[n.AUTO=2]="AUTO",n[n.BLEND=0]="BLEND",n[n.CLEAR=1]="CLEAR",n[n.BLIT=2]="BLIT"})(CLEAR_MODES||(CLEAR_MODES={}));var GC_MODES;(function(n){n[n.AUTO=0]="AUTO",n[n.MANUAL=1]="MANUAL"})(GC_MODES||(GC_MODES={}));var PRECISION;(function(n){n.LOW="lowp",n.MEDIUM="mediump",n.HIGH="highp"})(PRECISION||(PRECISION={}));var MASK_TYPES;(function(n){n[n.NONE=0]="NONE",n[n.SCISSOR=1]="SCISSOR",n[n.STENCIL=2]="STENCIL",n[n.SPRITE=3]="SPRITE",n[n.COLOR=4]="COLOR"})(MASK_TYPES||(MASK_TYPES={}));var COLOR_MASK_BITS;(function(n){n[n.RED=1]="RED",n[n.GREEN=2]="GREEN",n[n.BLUE=4]="BLUE",n[n.ALPHA=8]="ALPHA"})(COLOR_MASK_BITS||(COLOR_MASK_BITS={}));var MSAA_QUALITY;(function(n){n[n.NONE=0]="NONE",n[n.LOW=2]="LOW",n[n.MEDIUM=4]="MEDIUM",n[n.HIGH=8]="HIGH"})(MSAA_QUALITY||(MSAA_QUALITY={}));var BUFFER_TYPE;(function(n){n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(BUFFER_TYPE||(BUFFER_TYPE={}));/*!
 * @pixi/settings - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var BrowserAdapter={createCanvas:function(n,e){var t=document.createElement("canvas");return t.width=n,t.height=e,t},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var n;return(n=document.baseURI)!==null&&n!==void 0?n:window.location.href},fetch:function(n,e){return fetch(n,e)}},appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(n){return typeof n<"u"&&n.platform==="MacIntel"&&typeof n.maxTouchPoints=="number"&&n.maxTouchPoints>1&&typeof MSStream>"u"};function createMatch(n){return function(e){return e.test(n)}}function isMobile$1(n){var e={userAgent:"",platform:"",maxTouchPoints:0};!n&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof n=="string"?e.userAgent=n:n&&n.userAgent&&(e={userAgent:n.userAgent,platform:n.platform,maxTouchPoints:n.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var o=createMatch(t),D={apple:{phone:o(appleIphone)&&!o(windowsPhone),ipod:o(appleIpod),tablet:!o(appleIphone)&&(o(appleTablet)||isAppleTabletOnIos13(e))&&!o(windowsPhone),universal:o(appleUniversal),device:(o(appleIphone)||o(appleIpod)||o(appleTablet)||o(appleUniversal)||isAppleTabletOnIos13(e))&&!o(windowsPhone)},amazon:{phone:o(amazonPhone),tablet:!o(amazonPhone)&&o(amazonTablet),device:o(amazonPhone)||o(amazonTablet)},android:{phone:!o(windowsPhone)&&o(amazonPhone)||!o(windowsPhone)&&o(androidPhone),tablet:!o(windowsPhone)&&!o(amazonPhone)&&!o(androidPhone)&&(o(amazonTablet)||o(androidTablet)),device:!o(windowsPhone)&&(o(amazonPhone)||o(amazonTablet)||o(androidPhone)||o(androidTablet))||o(/\bokhttp\b/i)},windows:{phone:o(windowsPhone),tablet:o(windowsTablet),device:o(windowsPhone)||o(windowsTablet)},other:{blackberry:o(otherBlackBerry),blackberry10:o(otherBlackBerry10),opera:o(otherOpera),firefox:o(otherFirefox),chrome:o(otherChrome),device:o(otherBlackBerry)||o(otherBlackBerry10)||o(otherOpera)||o(otherFirefox)||o(otherChrome)},any:!1,phone:!1,tablet:!1};return D.any=D.apple.device||D.android.device||D.windows.device||D.other.device,D.phone=D.apple.phone||D.android.phone||D.windows.phone,D.tablet=D.apple.tablet||D.android.tablet||D.windows.tablet,D}var isMobile=isMobile$1(globalThis.navigator);function canUploadSameBuffer(){return!isMobile.apple.device}function maxRecommendedTextures(n){var e=!0;if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){var t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(t){var r=parseInt(t[1],10);r<11&&(e=!1)}}if(isMobile.android.device){var t=navigator.userAgent.match(/Android\s([0-9.]*)/);if(t){var r=parseInt(t[1],10);r<7&&(e=!1)}}}return e?n:4}var settings={ADAPTER:BrowserAdapter,MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:MSAA_QUALITY.NONE,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function o(B,G,U){this.fn=B,this.context=G,this.once=U||!1}function D(B,G,U,H,$){if(typeof U!="function")throw new TypeError("The listener must be a function");var V=new o(U,H||B,$),Y=t?t+G:G;return B._events[Y]?B._events[Y].fn?B._events[Y]=[B._events[Y],V]:B._events[Y].push(V):(B._events[Y]=V,B._eventsCount++),B}function N(B,G){--B._eventsCount===0?B._events=new r:delete B._events[G]}function k(){this._events=new r,this._eventsCount=0}k.prototype.eventNames=function(){var B=[],G,U;if(this._eventsCount===0)return B;for(U in G=this._events)e.call(G,U)&&B.push(t?U.slice(1):U);return Object.getOwnPropertySymbols?B.concat(Object.getOwnPropertySymbols(G)):B},k.prototype.listeners=function(B){var G=t?t+B:B,U=this._events[G];if(!U)return[];if(U.fn)return[U.fn];for(var H=0,$=U.length,V=new Array($);H<$;H++)V[H]=U[H].fn;return V},k.prototype.listenerCount=function(B){var G=t?t+B:B,U=this._events[G];return U?U.fn?1:U.length:0},k.prototype.emit=function(B,G,U,H,$,V){var Y=t?t+B:B;if(!this._events[Y])return!1;var X=this._events[Y],z=arguments.length,W,q;if(X.fn){switch(X.once&&this.removeListener(B,X.fn,void 0,!0),z){case 1:return X.fn.call(X.context),!0;case 2:return X.fn.call(X.context,G),!0;case 3:return X.fn.call(X.context,G,U),!0;case 4:return X.fn.call(X.context,G,U,H),!0;case 5:return X.fn.call(X.context,G,U,H,$),!0;case 6:return X.fn.call(X.context,G,U,H,$,V),!0}for(q=1,W=new Array(z-1);q<z;q++)W[q-1]=arguments[q];X.fn.apply(X.context,W)}else{var K=X.length,Q;for(q=0;q<K;q++)switch(X[q].once&&this.removeListener(B,X[q].fn,void 0,!0),z){case 1:X[q].fn.call(X[q].context);break;case 2:X[q].fn.call(X[q].context,G);break;case 3:X[q].fn.call(X[q].context,G,U);break;case 4:X[q].fn.call(X[q].context,G,U,H);break;default:if(!W)for(Q=1,W=new Array(z-1);Q<z;Q++)W[Q-1]=arguments[Q];X[q].fn.apply(X[q].context,W)}}return!0},k.prototype.on=function(B,G,U){return D(this,B,G,U,!1)},k.prototype.once=function(B,G,U){return D(this,B,G,U,!0)},k.prototype.removeListener=function(B,G,U,H){var $=t?t+B:B;if(!this._events[$])return this;if(!G)return N(this,$),this;var V=this._events[$];if(V.fn)V.fn===G&&(!H||V.once)&&(!U||V.context===U)&&N(this,$);else{for(var Y=0,X=[],z=V.length;Y<z;Y++)(V[Y].fn!==G||H&&!V[Y].once||U&&V[Y].context!==U)&&X.push(V[Y]);X.length?this._events[$]=X.length===1?X[0]:X:N(this,$)}return this},k.prototype.removeAllListeners=function(B){var G;return B?(G=t?t+B:B,this._events[G]&&N(this,G)):(this._events=new r,this._eventsCount=0),this},k.prototype.off=k.prototype.removeListener,k.prototype.addListener=k.prototype.on,k.prefixed=t,k.EventEmitter=k,n.exports=k}(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const i=getDefaultExportFromCjs(eventemitter3Exports);var earcut$1={exports:{}},hasRequiredEarcut;function requireEarcut(){if(hasRequiredEarcut)return earcut$1.exports;hasRequiredEarcut=1,earcut$1.exports=n,earcut$1.exports.default=n;function n(ie,ne,se){se=se||2;var ue=ne&&ne.length,le=ue?ne[0]*se:ie.length,he=e(ie,0,le,se,!0),pe=[];if(!he||he.next===he.prev)return pe;var de,ve,Se,ae,Ae,xe,Ce;if(ue&&(he=B(ie,ne,he,se)),ie.length>80*se){de=Se=ie[0],ve=ae=ie[1];for(var Oe=se;Oe<le;Oe+=se)Ae=ie[Oe],xe=ie[Oe+1],Ae<de&&(de=Ae),xe<ve&&(ve=xe),Ae>Se&&(Se=Ae),xe>ae&&(ae=xe);Ce=Math.max(Se-de,ae-ve),Ce=Ce!==0?32767/Ce:0}return r(he,pe,se,de,ve,Ce,0),pe}function e(ie,ne,se,ue,le){var he,pe;if(le===Ee(ie,ne,se,ue)>0)for(he=ne;he<se;he+=ue)pe=me(he,ie[he],ie[he+1],pe);else for(he=se-ue;he>=ne;he-=ue)pe=me(he,ie[he],ie[he+1],pe);return pe&&Q(pe,pe.next)&&(we(pe),pe=pe.next),pe}function t(ie,ne){if(!ie)return ie;ne||(ne=ie);var se=ie,ue;do if(ue=!1,!se.steiner&&(Q(se,se.next)||K(se.prev,se,se.next)===0)){if(we(se),se=ne=se.prev,se===se.next)break;ue=!0}else se=se.next;while(ue||se!==ne);return ne}function r(ie,ne,se,ue,le,he,pe){if(ie){!pe&&he&&V(ie,ue,le,he);for(var de=ie,ve,Se;ie.prev!==ie.next;){if(ve=ie.prev,Se=ie.next,he?D(ie,ue,le,he):o(ie)){ne.push(ve.i/se|0),ne.push(ie.i/se|0),ne.push(Se.i/se|0),we(ie),ie=Se.next,de=Se.next;continue}if(ie=Se,ie===de){pe?pe===1?(ie=N(t(ie),ne,se),r(ie,ne,se,ue,le,he,2)):pe===2&&k(ie,ne,se,ue,le,he):r(t(ie),ne,se,ue,le,he,1);break}}}}function o(ie){var ne=ie.prev,se=ie,ue=ie.next;if(K(ne,se,ue)>=0)return!1;for(var le=ne.x,he=se.x,pe=ue.x,de=ne.y,ve=se.y,Se=ue.y,ae=le<he?le<pe?le:pe:he<pe?he:pe,Ae=de<ve?de<Se?de:Se:ve<Se?ve:Se,xe=le>he?le>pe?le:pe:he>pe?he:pe,Ce=de>ve?de>Se?de:Se:ve>Se?ve:Se,Oe=ue.next;Oe!==ne;){if(Oe.x>=ae&&Oe.x<=xe&&Oe.y>=Ae&&Oe.y<=Ce&&W(le,de,he,ve,pe,Se,Oe.x,Oe.y)&&K(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.next}return!0}function D(ie,ne,se,ue){var le=ie.prev,he=ie,pe=ie.next;if(K(le,he,pe)>=0)return!1;for(var de=le.x,ve=he.x,Se=pe.x,ae=le.y,Ae=he.y,xe=pe.y,Ce=de<ve?de<Se?de:Se:ve<Se?ve:Se,Oe=ae<Ae?ae<xe?ae:xe:Ae<xe?Ae:xe,Te=de>ve?de>Se?de:Se:ve>Se?ve:Se,De=ae>Ae?ae>xe?ae:xe:Ae>xe?Ae:xe,Ie=X(Ce,Oe,ne,se,ue),_e=X(Te,De,ne,se,ue),Re=ie.prevZ,Pe=ie.nextZ;Re&&Re.z>=Ie&&Pe&&Pe.z<=_e;){if(Re.x>=Ce&&Re.x<=Te&&Re.y>=Oe&&Re.y<=De&&Re!==le&&Re!==pe&&W(de,ae,ve,Ae,Se,xe,Re.x,Re.y)&&K(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,Pe.x>=Ce&&Pe.x<=Te&&Pe.y>=Oe&&Pe.y<=De&&Pe!==le&&Pe!==pe&&W(de,ae,ve,Ae,Se,xe,Pe.x,Pe.y)&&K(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;Re&&Re.z>=Ie;){if(Re.x>=Ce&&Re.x<=Te&&Re.y>=Oe&&Re.y<=De&&Re!==le&&Re!==pe&&W(de,ae,ve,Ae,Se,xe,Re.x,Re.y)&&K(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;Pe&&Pe.z<=_e;){if(Pe.x>=Ce&&Pe.x<=Te&&Pe.y>=Oe&&Pe.y<=De&&Pe!==le&&Pe!==pe&&W(de,ae,ve,Ae,Se,xe,Pe.x,Pe.y)&&K(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function N(ie,ne,se){var ue=ie;do{var le=ue.prev,he=ue.next.next;!Q(le,he)&&Z(le,ue,ue.next,he)&&oe(le,he)&&oe(he,le)&&(ne.push(le.i/se|0),ne.push(ue.i/se|0),ne.push(he.i/se|0),we(ue),we(ue.next),ue=ie=he),ue=ue.next}while(ue!==ie);return t(ue)}function k(ie,ne,se,ue,le,he){var pe=ie;do{for(var de=pe.next.next;de!==pe.prev;){if(pe.i!==de.i&&q(pe,de)){var ve=fe(pe,de);pe=t(pe,pe.next),ve=t(ve,ve.next),r(pe,ne,se,ue,le,he,0),r(ve,ne,se,ue,le,he,0);return}de=de.next}pe=pe.next}while(pe!==ie)}function B(ie,ne,se,ue){var le=[],he,pe,de,ve,Se;for(he=0,pe=ne.length;he<pe;he++)de=ne[he]*ue,ve=he<pe-1?ne[he+1]*ue:ie.length,Se=e(ie,de,ve,ue,!1),Se===Se.next&&(Se.steiner=!0),le.push(z(Se));for(le.sort(G),he=0;he<le.length;he++)se=U(le[he],se);return se}function G(ie,ne){return ie.x-ne.x}function U(ie,ne){var se=H(ie,ne);if(!se)return ne;var ue=fe(se,ie);return t(ue,ue.next),t(se,se.next)}function H(ie,ne){var se=ne,ue=ie.x,le=ie.y,he=-1/0,pe;do{if(le<=se.y&&le>=se.next.y&&se.next.y!==se.y){var de=se.x+(le-se.y)*(se.next.x-se.x)/(se.next.y-se.y);if(de<=ue&&de>he&&(he=de,pe=se.x<se.next.x?se:se.next,de===ue))return pe}se=se.next}while(se!==ne);if(!pe)return null;var ve=pe,Se=pe.x,ae=pe.y,Ae=1/0,xe;se=pe;do ue>=se.x&&se.x>=Se&&ue!==se.x&&W(le<ae?ue:he,le,Se,ae,le<ae?he:ue,le,se.x,se.y)&&(xe=Math.abs(le-se.y)/(ue-se.x),oe(se,ie)&&(xe<Ae||xe===Ae&&(se.x>pe.x||se.x===pe.x&&$(pe,se)))&&(pe=se,Ae=xe)),se=se.next;while(se!==ve);return pe}function $(ie,ne){return K(ie.prev,ie,ne.prev)<0&&K(ne.next,ie,ie.next)<0}function V(ie,ne,se,ue){var le=ie;do le.z===0&&(le.z=X(le.x,le.y,ne,se,ue)),le.prevZ=le.prev,le.nextZ=le.next,le=le.next;while(le!==ie);le.prevZ.nextZ=null,le.prevZ=null,Y(le)}function Y(ie){var ne,se,ue,le,he,pe,de,ve,Se=1;do{for(se=ie,ie=null,he=null,pe=0;se;){for(pe++,ue=se,de=0,ne=0;ne<Se&&(de++,ue=ue.nextZ,!!ue);ne++);for(ve=Se;de>0||ve>0&&ue;)de!==0&&(ve===0||!ue||se.z<=ue.z)?(le=se,se=se.nextZ,de--):(le=ue,ue=ue.nextZ,ve--),he?he.nextZ=le:ie=le,le.prevZ=he,he=le;se=ue}he.nextZ=null,Se*=2}while(pe>1);return ie}function X(ie,ne,se,ue,le){return ie=(ie-se)*le|0,ne=(ne-ue)*le|0,ie=(ie|ie<<8)&16711935,ie=(ie|ie<<4)&252645135,ie=(ie|ie<<2)&858993459,ie=(ie|ie<<1)&1431655765,ne=(ne|ne<<8)&16711935,ne=(ne|ne<<4)&252645135,ne=(ne|ne<<2)&858993459,ne=(ne|ne<<1)&1431655765,ie|ne<<1}function z(ie){var ne=ie,se=ie;do(ne.x<se.x||ne.x===se.x&&ne.y<se.y)&&(se=ne),ne=ne.next;while(ne!==ie);return se}function W(ie,ne,se,ue,le,he,pe,de){return(le-pe)*(ne-de)>=(ie-pe)*(he-de)&&(ie-pe)*(ue-de)>=(se-pe)*(ne-de)&&(se-pe)*(he-de)>=(le-pe)*(ue-de)}function q(ie,ne){return ie.next.i!==ne.i&&ie.prev.i!==ne.i&&!te(ie,ne)&&(oe(ie,ne)&&oe(ne,ie)&&ce(ie,ne)&&(K(ie.prev,ie,ne.prev)||K(ie,ne.prev,ne))||Q(ie,ne)&&K(ie.prev,ie,ie.next)>0&&K(ne.prev,ne,ne.next)>0)}function K(ie,ne,se){return(ne.y-ie.y)*(se.x-ne.x)-(ne.x-ie.x)*(se.y-ne.y)}function Q(ie,ne){return ie.x===ne.x&&ie.y===ne.y}function Z(ie,ne,se,ue){var le=J(K(ie,ne,se)),he=J(K(ie,ne,ue)),pe=J(K(se,ue,ie)),de=J(K(se,ue,ne));return!!(le!==he&&pe!==de||le===0&&ee(ie,se,ne)||he===0&&ee(ie,ue,ne)||pe===0&&ee(se,ie,ue)||de===0&&ee(se,ne,ue))}function ee(ie,ne,se){return ne.x<=Math.max(ie.x,se.x)&&ne.x>=Math.min(ie.x,se.x)&&ne.y<=Math.max(ie.y,se.y)&&ne.y>=Math.min(ie.y,se.y)}function J(ie){return ie>0?1:ie<0?-1:0}function te(ie,ne){var se=ie;do{if(se.i!==ie.i&&se.next.i!==ie.i&&se.i!==ne.i&&se.next.i!==ne.i&&Z(se,se.next,ie,ne))return!0;se=se.next}while(se!==ie);return!1}function oe(ie,ne){return K(ie.prev,ie,ie.next)<0?K(ie,ne,ie.next)>=0&&K(ie,ie.prev,ne)>=0:K(ie,ne,ie.prev)<0||K(ie,ie.next,ne)<0}function ce(ie,ne){var se=ie,ue=!1,le=(ie.x+ne.x)/2,he=(ie.y+ne.y)/2;do se.y>he!=se.next.y>he&&se.next.y!==se.y&&le<(se.next.x-se.x)*(he-se.y)/(se.next.y-se.y)+se.x&&(ue=!ue),se=se.next;while(se!==ie);return ue}function fe(ie,ne){var se=new Me(ie.i,ie.x,ie.y),ue=new Me(ne.i,ne.x,ne.y),le=ie.next,he=ne.prev;return ie.next=ne,ne.prev=ie,se.next=le,le.prev=se,ue.next=se,se.prev=ue,he.next=ue,ue.prev=he,ue}function me(ie,ne,se,ue){var le=new Me(ie,ne,se);return ue?(le.next=ue.next,le.prev=ue,ue.next.prev=le,ue.next=le):(le.prev=le,le.next=le),le}function we(ie){ie.next.prev=ie.prev,ie.prev.next=ie.next,ie.prevZ&&(ie.prevZ.nextZ=ie.nextZ),ie.nextZ&&(ie.nextZ.prevZ=ie.prevZ)}function Me(ie,ne,se){this.i=ie,this.x=ne,this.y=se,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(ie,ne,se,ue){var le=ne&&ne.length,he=le?ne[0]*se:ie.length,pe=Math.abs(Ee(ie,0,he,se));if(le)for(var de=0,ve=ne.length;de<ve;de++){var Se=ne[de]*se,ae=de<ve-1?ne[de+1]*se:ie.length;pe-=Math.abs(Ee(ie,Se,ae,se))}var Ae=0;for(de=0;de<ue.length;de+=3){var xe=ue[de]*se,Ce=ue[de+1]*se,Oe=ue[de+2]*se;Ae+=Math.abs((ie[xe]-ie[Oe])*(ie[Ce+1]-ie[xe+1])-(ie[xe]-ie[Ce])*(ie[Oe+1]-ie[xe+1]))}return pe===0&&Ae===0?0:Math.abs((Ae-pe)/pe)};function Ee(ie,ne,se,ue){for(var le=0,he=ne,pe=se-ue;he<se;he+=ue)le+=(ie[pe]-ie[he])*(ie[he+1]+ie[pe+1]),pe=he;return le}return n.flatten=function(ie){for(var ne=ie[0][0].length,se={vertices:[],holes:[],dimensions:ne},ue=0,le=0;le<ie.length;le++){for(var he=0;he<ie[le].length;he++)for(var pe=0;pe<ne;pe++)se.vertices.push(ie[le][he][pe]);le>0&&(ue+=ie[le-1].length,se.holes.push(ue))}return se},earcut$1.exports}var earcutExports=requireEarcut();const earcut=getDefaultExportFromCjs(earcutExports);var url$2={},punycode$1={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var punycode=punycode$1.exports,hasRequiredPunycode;function requirePunycode(){return hasRequiredPunycode||(hasRequiredPunycode=1,function(n,e){(function(t){var r=e&&!e.nodeType&&e,o=n&&!n.nodeType&&n,D=typeof commonjsGlobal=="object"&&commonjsGlobal;(D.global===D||D.window===D||D.self===D)&&(t=D);var N,k=2147483647,B=36,G=1,U=26,H=38,$=700,V=72,Y=128,X="-",z=/^xn--/,W=/[^\x20-\x7E]/,q=/[\x2E\u3002\uFF0E\uFF61]/g,K={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Q=B-G,Z=Math.floor,ee=String.fromCharCode,J;function te(le){throw new RangeError(K[le])}function oe(le,he){for(var pe=le.length,de=[];pe--;)de[pe]=he(le[pe]);return de}function ce(le,he){var pe=le.split("@"),de="";pe.length>1&&(de=pe[0]+"@",le=pe[1]),le=le.replace(q,".");var ve=le.split("."),Se=oe(ve,he).join(".");return de+Se}function fe(le){for(var he=[],pe=0,de=le.length,ve,Se;pe<de;)ve=le.charCodeAt(pe++),ve>=55296&&ve<=56319&&pe<de?(Se=le.charCodeAt(pe++),(Se&64512)==56320?he.push(((ve&1023)<<10)+(Se&1023)+65536):(he.push(ve),pe--)):he.push(ve);return he}function me(le){return oe(le,function(he){var pe="";return he>65535&&(he-=65536,pe+=ee(he>>>10&1023|55296),he=56320|he&1023),pe+=ee(he),pe}).join("")}function we(le){return le-48<10?le-22:le-65<26?le-65:le-97<26?le-97:B}function Me(le,he){return le+22+75*(le<26)-((he!=0)<<5)}function Ee(le,he,pe){var de=0;for(le=pe?Z(le/$):le>>1,le+=Z(le/he);le>Q*U>>1;de+=B)le=Z(le/Q);return Z(de+(Q+1)*le/(le+H))}function ie(le){var he=[],pe=le.length,de,ve=0,Se=Y,ae=V,Ae,xe,Ce,Oe,Te,De,Ie,_e,Re;for(Ae=le.lastIndexOf(X),Ae<0&&(Ae=0),xe=0;xe<Ae;++xe)le.charCodeAt(xe)>=128&&te("not-basic"),he.push(le.charCodeAt(xe));for(Ce=Ae>0?Ae+1:0;Ce<pe;){for(Oe=ve,Te=1,De=B;Ce>=pe&&te("invalid-input"),Ie=we(le.charCodeAt(Ce++)),(Ie>=B||Ie>Z((k-ve)/Te))&&te("overflow"),ve+=Ie*Te,_e=De<=ae?G:De>=ae+U?U:De-ae,!(Ie<_e);De+=B)Re=B-_e,Te>Z(k/Re)&&te("overflow"),Te*=Re;de=he.length+1,ae=Ee(ve-Oe,de,Oe==0),Z(ve/de)>k-Se&&te("overflow"),Se+=Z(ve/de),ve%=de,he.splice(ve++,0,Se)}return me(he)}function ne(le){var he,pe,de,ve,Se,ae,Ae,xe,Ce,Oe,Te,De=[],Ie,_e,Re,Pe;for(le=fe(le),Ie=le.length,he=Y,pe=0,Se=V,ae=0;ae<Ie;++ae)Te=le[ae],Te<128&&De.push(ee(Te));for(de=ve=De.length,ve&&De.push(X);de<Ie;){for(Ae=k,ae=0;ae<Ie;++ae)Te=le[ae],Te>=he&&Te<Ae&&(Ae=Te);for(_e=de+1,Ae-he>Z((k-pe)/_e)&&te("overflow"),pe+=(Ae-he)*_e,he=Ae,ae=0;ae<Ie;++ae)if(Te=le[ae],Te<he&&++pe>k&&te("overflow"),Te==he){for(xe=pe,Ce=B;Oe=Ce<=Se?G:Ce>=Se+U?U:Ce-Se,!(xe<Oe);Ce+=B)Pe=xe-Oe,Re=B-Oe,De.push(ee(Me(Oe+Pe%Re,0))),xe=Z(Pe/Re);De.push(ee(Me(xe,0))),Se=Ee(pe,_e,de==ve),pe=0,++de}++pe,++he}return De.join("")}function se(le){return ce(le,function(he){return z.test(he)?ie(he.slice(4).toLowerCase()):he})}function ue(le){return ce(le,function(he){return W.test(he)?"xn--"+ne(he):he})}if(N={version:"1.4.1",ucs2:{decode:fe,encode:me},decode:ie,encode:ne,toASCII:ue,toUnicode:se},r&&o)if(n.exports==r)o.exports=N;else for(J in N)N.hasOwnProperty(J)&&(r[J]=N[J]);else t.punycode=N})(punycode)}(punycode$1,punycode$1.exports)),punycode$1.exports}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var shams,hasRequiredShams;function requireShams(){return hasRequiredShams||(hasRequiredShams=1,shams=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var n={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var r=42;n[e]=r;for(e in n)return!1;if(typeof Object.keys=="function"&&Object.keys(n).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(n).length!==0)return!1;var o=Object.getOwnPropertySymbols(n);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(n,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var D=Object.getOwnPropertyDescriptor(n,e);if(D.value!==r||D.enumerable!==!0)return!1}return!0}),shams}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var n=typeof Symbol<"u"&&Symbol,e=requireShams();return hasSymbols=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},hasSymbols}var hasProto,hasRequiredHasProto;function requireHasProto(){if(hasRequiredHasProto)return hasProto;hasRequiredHasProto=1;var n={__proto__:null,foo:{}},e=Object;return hasProto=function(){return{__proto__:n}.foo===n.foo&&!(n instanceof e)},hasProto}var implementation,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation;hasRequiredImplementation=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",o=function(k,B){for(var G=[],U=0;U<k.length;U+=1)G[U]=k[U];for(var H=0;H<B.length;H+=1)G[H+k.length]=B[H];return G},D=function(k,B){for(var G=[],U=B,H=0;U<k.length;U+=1,H+=1)G[H]=k[U];return G},N=function(k,B){for(var G="",U=0;U<k.length;U+=1)G+=k[U],U+1<k.length&&(G+=B);return G};return implementation=function(k){var B=this;if(typeof B!="function"||e.apply(B)!==r)throw new TypeError(n+B);for(var G=D(arguments,1),U,H=function(){if(this instanceof U){var z=B.apply(this,o(G,arguments));return Object(z)===z?z:this}return B.apply(k,o(G,arguments))},$=t(0,B.length-G.length),V=[],Y=0;Y<$;Y++)V[Y]="$"+Y;if(U=Function("binder","return function ("+N(V,",")+"){ return binder.apply(this,arguments); }")(H),B.prototype){var X=function(){};X.prototype=B.prototype,U.prototype=new X,X.prototype=null}return U},implementation}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var n=requireImplementation();return functionBind=Function.prototype.bind||n,functionBind}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=requireFunctionBind();return hasown=t.call(n,e),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var n,e=requireEsErrors(),t=require_eval(),r=requireRange(),o=requireRef(),D=requireSyntax(),N=requireType(),k=requireUri(),B=Function,G=function(ne){try{return B('"use strict"; return ('+ne+").constructor;")()}catch{}},U=Object.getOwnPropertyDescriptor;if(U)try{U({},"")}catch{U=null}var H=function(){throw new N},$=U?function(){try{return arguments.callee,H}catch{try{return U(arguments,"callee").get}catch{return H}}}():H,V=requireHasSymbols()(),Y=requireHasProto()(),X=Object.getPrototypeOf||(Y?function(ne){return ne.__proto__}:null),z={},W=typeof Uint8Array>"u"||!X?n:X(Uint8Array),q={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":V&&X?X([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":z,"%AsyncGenerator%":z,"%AsyncGeneratorFunction%":z,"%AsyncIteratorPrototype%":z,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":B,"%GeneratorFunction%":z,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":V&&X?X(X([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!V||!X?n:X(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":r,"%ReferenceError%":o,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!V||!X?n:X(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":V&&X?X(""[Symbol.iterator]()):n,"%Symbol%":V?Symbol:n,"%SyntaxError%":D,"%ThrowTypeError%":$,"%TypedArray%":W,"%TypeError%":N,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":k,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet};if(X)try{null.error}catch(ne){var K=X(X(ne));q["%Error.prototype%"]=K}var Q=function ne(se){var ue;if(se==="%AsyncFunction%")ue=G("async function () {}");else if(se==="%GeneratorFunction%")ue=G("function* () {}");else if(se==="%AsyncGeneratorFunction%")ue=G("async function* () {}");else if(se==="%AsyncGenerator%"){var le=ne("%AsyncGeneratorFunction%");le&&(ue=le.prototype)}else if(se==="%AsyncIteratorPrototype%"){var he=ne("%AsyncGenerator%");he&&X&&(ue=X(he.prototype))}return q[se]=ue,ue},Z={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ee=requireFunctionBind(),J=requireHasown(),te=ee.call(Function.call,Array.prototype.concat),oe=ee.call(Function.apply,Array.prototype.splice),ce=ee.call(Function.call,String.prototype.replace),fe=ee.call(Function.call,String.prototype.slice),me=ee.call(Function.call,RegExp.prototype.exec),we=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Me=/\\(\\)?/g,Ee=function(ne){var se=fe(ne,0,1),ue=fe(ne,-1);if(se==="%"&&ue!=="%")throw new D("invalid intrinsic syntax, expected closing `%`");if(ue==="%"&&se!=="%")throw new D("invalid intrinsic syntax, expected opening `%`");var le=[];return ce(ne,we,function(he,pe,de,ve){le[le.length]=de?ce(ve,Me,"$1"):pe||he}),le},ie=function(ne,se){var ue=ne,le;if(J(Z,ue)&&(le=Z[ue],ue="%"+le[0]+"%"),J(q,ue)){var he=q[ue];if(he===z&&(he=Q(ue)),typeof he>"u"&&!se)throw new N("intrinsic "+ne+" exists, but is not available. Please file an issue!");return{alias:le,name:ue,value:he}}throw new D("intrinsic "+ne+" does not exist!")};return getIntrinsic=function(ne,se){if(typeof ne!="string"||ne.length===0)throw new N("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof se!="boolean")throw new N('"allowMissing" argument must be a boolean');if(me(/^%?[^%]*%?$/,ne)===null)throw new D("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ue=Ee(ne),le=ue.length>0?ue[0]:"",he=ie("%"+le+"%",se),pe=he.name,de=he.value,ve=!1,Se=he.alias;Se&&(le=Se[0],oe(ue,te([0,1],Se)));for(var ae=1,Ae=!0;ae<ue.length;ae+=1){var xe=ue[ae],Ce=fe(xe,0,1),Oe=fe(xe,-1);if((Ce==='"'||Ce==="'"||Ce==="`"||Oe==='"'||Oe==="'"||Oe==="`")&&Ce!==Oe)throw new D("property names with quotes must have matching quotes");if((xe==="constructor"||!Ae)&&(ve=!0),le+="."+xe,pe="%"+le+"%",J(q,pe))de=q[pe];else if(de!=null){if(!(xe in de)){if(!se)throw new N("base intrinsic for "+ne+" exists, but the property is not available.");return}if(U&&ae+1>=ue.length){var Te=U(de,xe);Ae=!!Te,Ae&&"get"in Te&&!("originalValue"in Te.get)?de=Te.get:de=de[xe]}else Ae=J(de,xe),de=de[xe];Ae&&!ve&&(q[pe]=de)}}return de},getIntrinsic}var callBind={exports:{}},esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var n=requireGetIntrinsic(),e=n("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return esDefineProperty=e,esDefineProperty}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var n=requireGetIntrinsic(),e=n("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch{e=null}return gopd=e,gopd}var defineDataProperty,hasRequiredDefineDataProperty;function requireDefineDataProperty(){if(hasRequiredDefineDataProperty)return defineDataProperty;hasRequiredDefineDataProperty=1;var n=requireEsDefineProperty(),e=requireSyntax(),t=requireType(),r=requireGopd();return defineDataProperty=function(o,D,N){if(!o||typeof o!="object"&&typeof o!="function")throw new t("`obj` must be an object or a function`");if(typeof D!="string"&&typeof D!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var k=arguments.length>3?arguments[3]:null,B=arguments.length>4?arguments[4]:null,G=arguments.length>5?arguments[5]:null,U=arguments.length>6?arguments[6]:!1,H=!!r&&r(o,D);if(n)n(o,D,{configurable:G===null&&H?H.configurable:!G,enumerable:k===null&&H?H.enumerable:!k,value:N,writable:B===null&&H?H.writable:!B});else if(U||!k&&!B&&!G)o[D]=N;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},defineDataProperty}var hasPropertyDescriptors_1,hasRequiredHasPropertyDescriptors;function requireHasPropertyDescriptors(){if(hasRequiredHasPropertyDescriptors)return hasPropertyDescriptors_1;hasRequiredHasPropertyDescriptors=1;var n=requireEsDefineProperty(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},hasPropertyDescriptors_1=e,hasPropertyDescriptors_1}var setFunctionLength,hasRequiredSetFunctionLength;function requireSetFunctionLength(){if(hasRequiredSetFunctionLength)return setFunctionLength;hasRequiredSetFunctionLength=1;var n=requireGetIntrinsic(),e=requireDefineDataProperty(),t=requireHasPropertyDescriptors()(),r=requireGopd(),o=requireType(),D=n("%Math.floor%");return setFunctionLength=function(N,k){if(typeof N!="function")throw new o("`fn` is not a function");if(typeof k!="number"||k<0||k>4294967295||D(k)!==k)throw new o("`length` must be a positive 32-bit integer");var B=arguments.length>2&&!!arguments[2],G=!0,U=!0;if("length"in N&&r){var H=r(N,"length");H&&!H.configurable&&(G=!1),H&&!H.writable&&(U=!1)}return(G||U||!B)&&(t?e(N,"length",k,!0,!0):e(N,"length",k)),N},setFunctionLength}var hasRequiredCallBind;function requireCallBind(){return hasRequiredCallBind||(hasRequiredCallBind=1,function(n){var e=requireFunctionBind(),t=requireGetIntrinsic(),r=requireSetFunctionLength(),o=requireType(),D=t("%Function.prototype.apply%"),N=t("%Function.prototype.call%"),k=t("%Reflect.apply%",!0)||e.call(N,D),B=requireEsDefineProperty(),G=t("%Math.max%");n.exports=function(H){if(typeof H!="function")throw new o("a function is required");var $=k(e,N,arguments);return r($,1+G(0,H.length-(arguments.length-1)),!0)};var U=function(){return k(e,D,arguments)};B?B(n.exports,"apply",{value:U}):n.exports.apply=U}(callBind)),callBind.exports}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var n=requireGetIntrinsic(),e=requireCallBind(),t=e(n("String.prototype.indexOf"));return callBound=function(r,o){var D=n(r,!!o);return typeof D=="function"&&t(r,".prototype.")>-1?e(D):D},callBound}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var objectInspect,hasRequiredObjectInspect;function requireObjectInspect(){if(hasRequiredObjectInspect)return objectInspect;hasRequiredObjectInspect=1;var n=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=n&&e&&typeof e.get=="function"?e.get:null,r=n&&Map.prototype.forEach,o=typeof Set=="function"&&Set.prototype,D=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,N=o&&D&&typeof D.get=="function"?D.get:null,k=o&&Set.prototype.forEach,B=typeof WeakMap=="function"&&WeakMap.prototype,G=B?WeakMap.prototype.has:null,U=typeof WeakSet=="function"&&WeakSet.prototype,H=U?WeakSet.prototype.has:null,$=typeof WeakRef=="function"&&WeakRef.prototype,V=$?WeakRef.prototype.deref:null,Y=Boolean.prototype.valueOf,X=Object.prototype.toString,z=Function.prototype.toString,W=String.prototype.match,q=String.prototype.slice,K=String.prototype.replace,Q=String.prototype.toUpperCase,Z=String.prototype.toLowerCase,ee=RegExp.prototype.test,J=Array.prototype.concat,te=Array.prototype.join,oe=Array.prototype.slice,ce=Math.floor,fe=typeof BigInt=="function"?BigInt.prototype.valueOf:null,me=Object.getOwnPropertySymbols,we=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Me=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Ee=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Me||!0)?Symbol.toStringTag:null,ie=Object.prototype.propertyIsEnumerable,ne=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(ge){return ge.__proto__}:null);function se(ge,ye){if(ge===1/0||ge===-1/0||ge!==ge||ge&&ge>-1e3&&ge<1e3||ee.call(/e/,ye))return ye;var ke=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof ge=="number"){var Be=ge<0?-ce(-ge):ce(ge);if(Be!==ge){var je=String(Be),Ne=q.call(ye,je.length+1);return K.call(je,ke,"$&_")+"."+K.call(K.call(Ne,/([0-9]{3})/g,"$&_"),/_$/,"")}}return K.call(ye,ke,"$&_")}var ue=require$$0,le=ue.custom,he=Ie(le)?le:null,pe={__proto__:null,double:'"',single:"'"},de={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};objectInspect=function ge(ye,ke,Be,je){var Ne=ke||{};if(Pe(Ne,"quoteStyle")&&!Pe(pe,Ne.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Pe(Ne,"maxStringLength")&&(typeof Ne.maxStringLength=="number"?Ne.maxStringLength<0&&Ne.maxStringLength!==1/0:Ne.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Je=Pe(Ne,"customInspect")?Ne.customInspect:!0;if(typeof Je!="boolean"&&Je!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Pe(Ne,"indent")&&Ne.indent!==null&&Ne.indent!=="	"&&!(parseInt(Ne.indent,10)===Ne.indent&&Ne.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Pe(Ne,"numericSeparator")&&typeof Ne.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var et=Ne.numericSeparator;if(typeof ye>"u")return"undefined";if(ye===null)return"null";if(typeof ye=="boolean")return ye?"true":"false";if(typeof ye=="string")return Ue(ye,Ne);if(typeof ye=="number"){if(ye===0)return 1/0/ye>0?"0":"-0";var Ve=String(ye);return et?se(ye,Ve):Ve}if(typeof ye=="bigint"){var Qe=String(ye)+"n";return et?se(ye,Qe):Qe}var ht=typeof Ne.depth>"u"?5:Ne.depth;if(typeof Be>"u"&&(Be=0),Be>=ht&&ht>0&&typeof ye=="object")return ae(ye)?"[Array]":"[Object]";var tt=Rt(Ne,Be);if(typeof je>"u")je=[];else if(Ye(je,ye)>=0)return"[Circular]";function We(rt,ot,At){if(ot&&(je=oe.call(je),je.push(ot)),At){var Et={depth:Ne.depth};return Pe(Ne,"quoteStyle")&&(Et.quoteStyle=Ne.quoteStyle),ge(rt,Et,Be+1,je)}return ge(rt,Ne,Be+1,je)}if(typeof ye=="function"&&!xe(ye)){var mt=$e(ye),_t=st(ye,We);return"[Function"+(mt?": "+mt:" (anonymous)")+"]"+(_t.length>0?" { "+te.call(_t,", ")+" }":"")}if(Ie(ye)){var yt=Me?K.call(String(ye),/^(Symbol\(.*\))_[^)]*$/,"$1"):we.call(ye);return typeof ye=="object"&&!Me?Le(yt):yt}if(Ge(ye)){for(var it="<"+Z.call(String(ye.nodeName)),lt=ye.attributes||[],nt=0;nt<lt.length;nt++)it+=" "+lt[nt].name+"="+ve(Se(lt[nt].value),"double",Ne);return it+=">",ye.childNodes&&ye.childNodes.length&&(it+="..."),it+="</"+Z.call(String(ye.nodeName))+">",it}if(ae(ye)){if(ye.length===0)return"[]";var ut=st(ye,We);return tt&&!St(ut)?"["+at(ut,tt)+"]":"[ "+te.call(ut,", ")+" ]"}if(Ce(ye)){var ct=st(ye,We);return!("cause"in Error.prototype)&&"cause"in ye&&!ie.call(ye,"cause")?"{ ["+String(ye)+"] "+te.call(J.call("[cause]: "+We(ye.cause),ct),", ")+" }":ct.length===0?"["+String(ye)+"]":"{ ["+String(ye)+"] "+te.call(ct,", ")+" }"}if(typeof ye=="object"&&Je){if(he&&typeof ye[he]=="function"&&ue)return ue(ye,{depth:ht-Be});if(Je!=="symbol"&&typeof ye.inspect=="function")return ye.inspect()}if(He(ye)){var vt=[];return r&&r.call(ye,function(rt,ot){vt.push(We(ot,ye,!0)+" => "+We(rt,ye))}),gt("Map",t.call(ye),vt,tt)}if(Ze(ye)){var bt=[];return k&&k.call(ye,function(rt){bt.push(We(rt,ye))}),gt("Set",N.call(ye),bt,tt)}if(ze(ye))return Xe("WeakMap");if(Ke(ye))return Xe("WeakSet");if(qe(ye))return Xe("WeakRef");if(Te(ye))return Le(We(Number(ye)));if(_e(ye))return Le(We(fe.call(ye)));if(De(ye))return Le(Y.call(ye));if(Oe(ye))return Le(We(String(ye)));if(typeof window<"u"&&ye===window)return"{ [object Window] }";if(typeof globalThis<"u"&&ye===globalThis||typeof commonjsGlobal<"u"&&ye===commonjsGlobal)return"{ [object globalThis] }";if(!Ae(ye)&&!xe(ye)){var ft=st(ye,We),xt=ne?ne(ye)===Object.prototype:ye instanceof Object||ye.constructor===Object,dt=ye instanceof Object?"":"null prototype",Tt=!xt&&Ee&&Object(ye)===ye&&Ee in ye?q.call(be(ye),8,-1):dt?"Object":"",wt=xt||typeof ye.constructor!="function"?"":ye.constructor.name?ye.constructor.name+" ":"",pt=wt+(Tt||dt?"["+te.call(J.call([],Tt||[],dt||[]),": ")+"] ":"");return ft.length===0?pt+"{}":tt?pt+"{"+at(ft,tt)+"}":pt+"{ "+te.call(ft,", ")+" }"}return String(ye)};function ve(ge,ye,ke){var Be=ke.quoteStyle||ye,je=pe[Be];return je+ge+je}function Se(ge){return K.call(String(ge),/"/g,"&quot;")}function ae(ge){return be(ge)==="[object Array]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function Ae(ge){return be(ge)==="[object Date]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function xe(ge){return be(ge)==="[object RegExp]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function Ce(ge){return be(ge)==="[object Error]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function Oe(ge){return be(ge)==="[object String]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function Te(ge){return be(ge)==="[object Number]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function De(ge){return be(ge)==="[object Boolean]"&&(!Ee||!(typeof ge=="object"&&Ee in ge))}function Ie(ge){if(Me)return ge&&typeof ge=="object"&&ge instanceof Symbol;if(typeof ge=="symbol")return!0;if(!ge||typeof ge!="object"||!we)return!1;try{return we.call(ge),!0}catch{}return!1}function _e(ge){if(!ge||typeof ge!="object"||!fe)return!1;try{return fe.call(ge),!0}catch{}return!1}var Re=Object.prototype.hasOwnProperty||function(ge){return ge in this};function Pe(ge,ye){return Re.call(ge,ye)}function be(ge){return X.call(ge)}function $e(ge){if(ge.name)return ge.name;var ye=W.call(z.call(ge),/^function\s*([\w$]+)/);return ye?ye[1]:null}function Ye(ge,ye){if(ge.indexOf)return ge.indexOf(ye);for(var ke=0,Be=ge.length;ke<Be;ke++)if(ge[ke]===ye)return ke;return-1}function He(ge){if(!t||!ge||typeof ge!="object")return!1;try{t.call(ge);try{N.call(ge)}catch{return!0}return ge instanceof Map}catch{}return!1}function ze(ge){if(!G||!ge||typeof ge!="object")return!1;try{G.call(ge,G);try{H.call(ge,H)}catch{return!0}return ge instanceof WeakMap}catch{}return!1}function qe(ge){if(!V||!ge||typeof ge!="object")return!1;try{return V.call(ge),!0}catch{}return!1}function Ze(ge){if(!N||!ge||typeof ge!="object")return!1;try{N.call(ge);try{t.call(ge)}catch{return!0}return ge instanceof Set}catch{}return!1}function Ke(ge){if(!H||!ge||typeof ge!="object")return!1;try{H.call(ge,H);try{G.call(ge,G)}catch{return!0}return ge instanceof WeakSet}catch{}return!1}function Ge(ge){return!ge||typeof ge!="object"?!1:typeof HTMLElement<"u"&&ge instanceof HTMLElement?!0:typeof ge.nodeName=="string"&&typeof ge.getAttribute=="function"}function Ue(ge,ye){if(ge.length>ye.maxStringLength){var ke=ge.length-ye.maxStringLength,Be="... "+ke+" more character"+(ke>1?"s":"");return Ue(q.call(ge,0,ye.maxStringLength),ye)+Be}var je=de[ye.quoteStyle||"single"];je.lastIndex=0;var Ne=K.call(K.call(ge,je,"\\$1"),/[\x00-\x1f]/g,Fe);return ve(Ne,"single",ye)}function Fe(ge){var ye=ge.charCodeAt(0),ke={8:"b",9:"t",10:"n",12:"f",13:"r"}[ye];return ke?"\\"+ke:"\\x"+(ye<16?"0":"")+Q.call(ye.toString(16))}function Le(ge){return"Object("+ge+")"}function Xe(ge){return ge+" { ? }"}function gt(ge,ye,ke,Be){var je=Be?at(ke,Be):te.call(ke,", ");return ge+" ("+ye+") {"+je+"}"}function St(ge){for(var ye=0;ye<ge.length;ye++)if(Ye(ge[ye],`
`)>=0)return!1;return!0}function Rt(ge,ye){var ke;if(ge.indent==="	")ke="	";else if(typeof ge.indent=="number"&&ge.indent>0)ke=te.call(Array(ge.indent+1)," ");else return null;return{base:ke,prev:te.call(Array(ye+1),ke)}}function at(ge,ye){if(ge.length===0)return"";var ke=`
`+ye.prev+ye.base;return ke+te.call(ge,","+ke)+`
`+ye.prev}function st(ge,ye){var ke=ae(ge),Be=[];if(ke){Be.length=ge.length;for(var je=0;je<ge.length;je++)Be[je]=Pe(ge,je)?ye(ge[je],ge):""}var Ne=typeof me=="function"?me(ge):[],Je;if(Me){Je={};for(var et=0;et<Ne.length;et++)Je["$"+Ne[et]]=Ne[et]}for(var Ve in ge)Pe(ge,Ve)&&(ke&&String(Number(Ve))===Ve&&Ve<ge.length||Me&&Je["$"+Ve]instanceof Symbol||(ee.call(/[^\w$]/,Ve)?Be.push(ye(Ve,ge)+": "+ye(ge[Ve],ge)):Be.push(Ve+": "+ye(ge[Ve],ge))));if(typeof me=="function")for(var Qe=0;Qe<Ne.length;Qe++)ie.call(ge,Ne[Qe])&&Be.push("["+ye(Ne[Qe])+"]: "+ye(ge[Ne[Qe]],ge));return Be}return objectInspect}var sideChannel,hasRequiredSideChannel;function requireSideChannel(){if(hasRequiredSideChannel)return sideChannel;hasRequiredSideChannel=1;var n=requireGetIntrinsic(),e=requireCallBound(),t=requireObjectInspect(),r=requireType(),o=n("%WeakMap%",!0),D=n("%Map%",!0),N=e("WeakMap.prototype.get",!0),k=e("WeakMap.prototype.set",!0),B=e("WeakMap.prototype.has",!0),G=e("Map.prototype.get",!0),U=e("Map.prototype.set",!0),H=e("Map.prototype.has",!0),$=function(z,W){for(var q=z,K;(K=q.next)!==null;q=K)if(K.key===W)return q.next=K.next,K.next=z.next,z.next=K,K},V=function(z,W){var q=$(z,W);return q&&q.value},Y=function(z,W,q){var K=$(z,W);K?K.value=q:z.next={key:W,next:z.next,value:q}},X=function(z,W){return!!$(z,W)};return sideChannel=function(){var z,W,q,K={assert:function(Q){if(!K.has(Q))throw new r("Side channel does not contain "+t(Q))},get:function(Q){if(o&&Q&&(typeof Q=="object"||typeof Q=="function")){if(z)return N(z,Q)}else if(D){if(W)return G(W,Q)}else if(q)return V(q,Q)},has:function(Q){if(o&&Q&&(typeof Q=="object"||typeof Q=="function")){if(z)return B(z,Q)}else if(D){if(W)return H(W,Q)}else if(q)return X(q,Q);return!1},set:function(Q,Z){o&&Q&&(typeof Q=="object"||typeof Q=="function")?(z||(z=new o),k(z,Q,Z)):D?(W||(W=new D),U(W,Q,Z)):(q||(q={key:{},next:null}),Y(q,Q,Z))}};return K},sideChannel}var formats$1,hasRequiredFormats;function requireFormats(){if(hasRequiredFormats)return formats$1;hasRequiredFormats=1;var n=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return formats$1={default:t.RFC3986,formatters:{RFC1738:function(r){return n.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},formats$1}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;var n=requireFormats(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(){for(var z=[],W=0;W<256;++W)z.push("%"+((W<16?"0":"")+W.toString(16)).toUpperCase());return z}(),o=function(z){for(;z.length>1;){var W=z.pop(),q=W.obj[W.prop];if(t(q)){for(var K=[],Q=0;Q<q.length;++Q)typeof q[Q]<"u"&&K.push(q[Q]);W.obj[W.prop]=K}}},D=function(z,W){for(var q=W&&W.plainObjects?Object.create(null):{},K=0;K<z.length;++K)typeof z[K]<"u"&&(q[K]=z[K]);return q},N=function z(W,q,K){if(!q)return W;if(typeof q!="object"){if(t(W))W.push(q);else if(W&&typeof W=="object")(K&&(K.plainObjects||K.allowPrototypes)||!e.call(Object.prototype,q))&&(W[q]=!0);else return[W,q];return W}if(!W||typeof W!="object")return[W].concat(q);var Q=W;return t(W)&&!t(q)&&(Q=D(W,K)),t(W)&&t(q)?(q.forEach(function(Z,ee){if(e.call(W,ee)){var J=W[ee];J&&typeof J=="object"&&Z&&typeof Z=="object"?W[ee]=z(J,Z,K):W.push(Z)}else W[ee]=Z}),W):Object.keys(q).reduce(function(Z,ee){var J=q[ee];return e.call(Z,ee)?Z[ee]=z(Z[ee],J,K):Z[ee]=J,Z},Q)},k=function(z,W){return Object.keys(W).reduce(function(q,K){return q[K]=W[K],q},z)},B=function(z,W,q){var K=z.replace(/\+/g," ");if(q==="iso-8859-1")return K.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(K)}catch{return K}},G=1024,U=function(z,W,q,K,Q){if(z.length===0)return z;var Z=z;if(typeof z=="symbol"?Z=Symbol.prototype.toString.call(z):typeof z!="string"&&(Z=String(z)),q==="iso-8859-1")return escape(Z).replace(/%u[0-9a-f]{4}/gi,function(me){return"%26%23"+parseInt(me.slice(2),16)+"%3B"});for(var ee="",J=0;J<Z.length;J+=G){for(var te=Z.length>=G?Z.slice(J,J+G):Z,oe=[],ce=0;ce<te.length;++ce){var fe=te.charCodeAt(ce);if(fe===45||fe===46||fe===95||fe===126||fe>=48&&fe<=57||fe>=65&&fe<=90||fe>=97&&fe<=122||Q===n.RFC1738&&(fe===40||fe===41)){oe[oe.length]=te.charAt(ce);continue}if(fe<128){oe[oe.length]=r[fe];continue}if(fe<2048){oe[oe.length]=r[192|fe>>6]+r[128|fe&63];continue}if(fe<55296||fe>=57344){oe[oe.length]=r[224|fe>>12]+r[128|fe>>6&63]+r[128|fe&63];continue}ce+=1,fe=65536+((fe&1023)<<10|te.charCodeAt(ce)&1023),oe[oe.length]=r[240|fe>>18]+r[128|fe>>12&63]+r[128|fe>>6&63]+r[128|fe&63]}ee+=oe.join("")}return ee},H=function(z){for(var W=[{obj:{o:z},prop:"o"}],q=[],K=0;K<W.length;++K)for(var Q=W[K],Z=Q.obj[Q.prop],ee=Object.keys(Z),J=0;J<ee.length;++J){var te=ee[J],oe=Z[te];typeof oe=="object"&&oe!==null&&q.indexOf(oe)===-1&&(W.push({obj:Z,prop:te}),q.push(oe))}return o(W),z},$=function(z){return Object.prototype.toString.call(z)==="[object RegExp]"},V=function(z){return!z||typeof z!="object"?!1:!!(z.constructor&&z.constructor.isBuffer&&z.constructor.isBuffer(z))},Y=function(z,W){return[].concat(z,W)},X=function(z,W){if(t(z)){for(var q=[],K=0;K<z.length;K+=1)q.push(W(z[K]));return q}return W(z)};return utils={arrayToObject:D,assign:k,combine:Y,compact:H,decode:B,encode:U,isBuffer:V,isRegExp:$,maybeMap:X,merge:N},utils}var stringify_1,hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify_1;hasRequiredStringify=1;var n=requireSideChannel(),e=requireUtils(),t=requireFormats(),r=Object.prototype.hasOwnProperty,o={brackets:function(X){return X+"[]"},comma:"comma",indices:function(X,z){return X+"["+z+"]"},repeat:function(X){return X}},D=Array.isArray,N=Array.prototype.push,k=function(X,z){N.apply(X,D(z)?z:[z])},B=Date.prototype.toISOString,G=t.default,U={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,format:G,formatter:t.formatters[G],indices:!1,serializeDate:function(X){return B.call(X)},skipNulls:!1,strictNullHandling:!1},H=function(X){return typeof X=="string"||typeof X=="number"||typeof X=="boolean"||typeof X=="symbol"||typeof X=="bigint"},$={},V=function X(z,W,q,K,Q,Z,ee,J,te,oe,ce,fe,me,we,Me,Ee,ie,ne){for(var se=z,ue=ne,le=0,he=!1;(ue=ue.get($))!==void 0&&!he;){var pe=ue.get(z);if(le+=1,typeof pe<"u"){if(pe===le)throw new RangeError("Cyclic object value");he=!0}typeof ue.get($)>"u"&&(le=0)}if(typeof oe=="function"?se=oe(W,se):se instanceof Date?se=me(se):q==="comma"&&D(se)&&(se=e.maybeMap(se,function(Re){return Re instanceof Date?me(Re):Re})),se===null){if(Z)return te&&!Ee?te(W,U.encoder,ie,"key",we):W;se=""}if(H(se)||e.isBuffer(se)){if(te){var de=Ee?W:te(W,U.encoder,ie,"key",we);return[Me(de)+"="+Me(te(se,U.encoder,ie,"value",we))]}return[Me(W)+"="+Me(String(se))]}var ve=[];if(typeof se>"u")return ve;var Se;if(q==="comma"&&D(se))Ee&&te&&(se=e.maybeMap(se,te)),Se=[{value:se.length>0?se.join(",")||null:void 0}];else if(D(oe))Se=oe;else{var ae=Object.keys(se);Se=ce?ae.sort(ce):ae}var Ae=J?W.replace(/\./g,"%2E"):W,xe=K&&D(se)&&se.length===1?Ae+"[]":Ae;if(Q&&D(se)&&se.length===0)return xe+"[]";for(var Ce=0;Ce<Se.length;++Ce){var Oe=Se[Ce],Te=typeof Oe=="object"&&typeof Oe.value<"u"?Oe.value:se[Oe];if(!(ee&&Te===null)){var De=fe&&J?Oe.replace(/\./g,"%2E"):Oe,Ie=D(se)?typeof q=="function"?q(xe,De):xe:xe+(fe?"."+De:"["+De+"]");ne.set(z,le);var _e=n();_e.set($,ne),k(ve,X(Te,Ie,q,K,Q,Z,ee,J,q==="comma"&&Ee&&D(se)?null:te,oe,ce,fe,me,we,Me,Ee,ie,_e))}}return ve},Y=function(X){if(!X)return U;if(typeof X.allowEmptyArrays<"u"&&typeof X.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof X.encodeDotInKeys<"u"&&typeof X.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(X.encoder!==null&&typeof X.encoder<"u"&&typeof X.encoder!="function")throw new TypeError("Encoder has to be a function.");var z=X.charset||U.charset;if(typeof X.charset<"u"&&X.charset!=="utf-8"&&X.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var W=t.default;if(typeof X.format<"u"){if(!r.call(t.formatters,X.format))throw new TypeError("Unknown format option provided.");W=X.format}var q=t.formatters[W],K=U.filter;(typeof X.filter=="function"||D(X.filter))&&(K=X.filter);var Q;if(X.arrayFormat in o?Q=X.arrayFormat:"indices"in X?Q=X.indices?"indices":"repeat":Q=U.arrayFormat,"commaRoundTrip"in X&&typeof X.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var Z=typeof X.allowDots>"u"?X.encodeDotInKeys===!0?!0:U.allowDots:!!X.allowDots;return{addQueryPrefix:typeof X.addQueryPrefix=="boolean"?X.addQueryPrefix:U.addQueryPrefix,allowDots:Z,allowEmptyArrays:typeof X.allowEmptyArrays=="boolean"?!!X.allowEmptyArrays:U.allowEmptyArrays,arrayFormat:Q,charset:z,charsetSentinel:typeof X.charsetSentinel=="boolean"?X.charsetSentinel:U.charsetSentinel,commaRoundTrip:X.commaRoundTrip,delimiter:typeof X.delimiter>"u"?U.delimiter:X.delimiter,encode:typeof X.encode=="boolean"?X.encode:U.encode,encodeDotInKeys:typeof X.encodeDotInKeys=="boolean"?X.encodeDotInKeys:U.encodeDotInKeys,encoder:typeof X.encoder=="function"?X.encoder:U.encoder,encodeValuesOnly:typeof X.encodeValuesOnly=="boolean"?X.encodeValuesOnly:U.encodeValuesOnly,filter:K,format:W,formatter:q,serializeDate:typeof X.serializeDate=="function"?X.serializeDate:U.serializeDate,skipNulls:typeof X.skipNulls=="boolean"?X.skipNulls:U.skipNulls,sort:typeof X.sort=="function"?X.sort:null,strictNullHandling:typeof X.strictNullHandling=="boolean"?X.strictNullHandling:U.strictNullHandling}};return stringify_1=function(X,z){var W=X,q=Y(z),K,Q;typeof q.filter=="function"?(Q=q.filter,W=Q("",W)):D(q.filter)&&(Q=q.filter,K=Q);var Z=[];if(typeof W!="object"||W===null)return"";var ee=o[q.arrayFormat],J=ee==="comma"&&q.commaRoundTrip;K||(K=Object.keys(W)),q.sort&&K.sort(q.sort);for(var te=n(),oe=0;oe<K.length;++oe){var ce=K[oe];q.skipNulls&&W[ce]===null||k(Z,V(W[ce],ce,ee,J,q.allowEmptyArrays,q.strictNullHandling,q.skipNulls,q.encodeDotInKeys,q.encode?q.encoder:null,q.filter,q.sort,q.allowDots,q.serializeDate,q.format,q.formatter,q.encodeValuesOnly,q.charset,te))}var fe=Z.join(q.delimiter),me=q.addQueryPrefix===!0?"?":"";return q.charsetSentinel&&(q.charset==="iso-8859-1"?me+="utf8=%26%2310003%3B&":me+="utf8=%E2%9C%93&"),fe.length>0?me+fe:""},stringify_1}var parse$1,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse$1;hasRequiredParse=1;var n=requireUtils(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},o=function($){return $.replace(/&#(\d+);/g,function(V,Y){return String.fromCharCode(parseInt(Y,10))})},D=function($,V){return $&&typeof $=="string"&&V.comma&&$.indexOf(",")>-1?$.split(","):$},N="utf8=%26%2310003%3B",k="utf8=%E2%9C%93",B=function($,V){var Y={__proto__:null},X=V.ignoreQueryPrefix?$.replace(/^\?/,""):$;X=X.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var z=V.parameterLimit===1/0?void 0:V.parameterLimit,W=X.split(V.delimiter,z),q=-1,K,Q=V.charset;if(V.charsetSentinel)for(K=0;K<W.length;++K)W[K].indexOf("utf8=")===0&&(W[K]===k?Q="utf-8":W[K]===N&&(Q="iso-8859-1"),q=K,K=W.length);for(K=0;K<W.length;++K)if(K!==q){var Z=W[K],ee=Z.indexOf("]="),J=ee===-1?Z.indexOf("="):ee+1,te,oe;J===-1?(te=V.decoder(Z,r.decoder,Q,"key"),oe=V.strictNullHandling?null:""):(te=V.decoder(Z.slice(0,J),r.decoder,Q,"key"),oe=n.maybeMap(D(Z.slice(J+1),V),function(fe){return V.decoder(fe,r.decoder,Q,"value")})),oe&&V.interpretNumericEntities&&Q==="iso-8859-1"&&(oe=o(oe)),Z.indexOf("[]=")>-1&&(oe=t(oe)?[oe]:oe);var ce=e.call(Y,te);ce&&V.duplicates==="combine"?Y[te]=n.combine(Y[te],oe):(!ce||V.duplicates==="last")&&(Y[te]=oe)}return Y},G=function($,V,Y,X){for(var z=X?V:D(V,Y),W=$.length-1;W>=0;--W){var q,K=$[W];if(K==="[]"&&Y.parseArrays)q=Y.allowEmptyArrays&&(z===""||Y.strictNullHandling&&z===null)?[]:[].concat(z);else{q=Y.plainObjects?Object.create(null):{};var Q=K.charAt(0)==="["&&K.charAt(K.length-1)==="]"?K.slice(1,-1):K,Z=Y.decodeDotInKeys?Q.replace(/%2E/g,"."):Q,ee=parseInt(Z,10);!Y.parseArrays&&Z===""?q={0:z}:!isNaN(ee)&&K!==Z&&String(ee)===Z&&ee>=0&&Y.parseArrays&&ee<=Y.arrayLimit?(q=[],q[ee]=z):Z!=="__proto__"&&(q[Z]=z)}z=q}return z},U=function($,V,Y,X){if($){var z=Y.allowDots?$.replace(/\.([^.[]+)/g,"[$1]"):$,W=/(\[[^[\]]*])/,q=/(\[[^[\]]*])/g,K=Y.depth>0&&W.exec(z),Q=K?z.slice(0,K.index):z,Z=[];if(Q){if(!Y.plainObjects&&e.call(Object.prototype,Q)&&!Y.allowPrototypes)return;Z.push(Q)}for(var ee=0;Y.depth>0&&(K=q.exec(z))!==null&&ee<Y.depth;){if(ee+=1,!Y.plainObjects&&e.call(Object.prototype,K[1].slice(1,-1))&&!Y.allowPrototypes)return;Z.push(K[1])}if(K){if(Y.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+Y.depth+" and strictDepth is true");Z.push("["+z.slice(K.index)+"]")}return G(Z,V,Y,X)}},H=function($){if(!$)return r;if(typeof $.allowEmptyArrays<"u"&&typeof $.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof $.decodeDotInKeys<"u"&&typeof $.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if($.decoder!==null&&typeof $.decoder<"u"&&typeof $.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof $.charset<"u"&&$.charset!=="utf-8"&&$.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var V=typeof $.charset>"u"?r.charset:$.charset,Y=typeof $.duplicates>"u"?r.duplicates:$.duplicates;if(Y!=="combine"&&Y!=="first"&&Y!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var X=typeof $.allowDots>"u"?$.decodeDotInKeys===!0?!0:r.allowDots:!!$.allowDots;return{allowDots:X,allowEmptyArrays:typeof $.allowEmptyArrays=="boolean"?!!$.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof $.allowPrototypes=="boolean"?$.allowPrototypes:r.allowPrototypes,allowSparse:typeof $.allowSparse=="boolean"?$.allowSparse:r.allowSparse,arrayLimit:typeof $.arrayLimit=="number"?$.arrayLimit:r.arrayLimit,charset:V,charsetSentinel:typeof $.charsetSentinel=="boolean"?$.charsetSentinel:r.charsetSentinel,comma:typeof $.comma=="boolean"?$.comma:r.comma,decodeDotInKeys:typeof $.decodeDotInKeys=="boolean"?$.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof $.decoder=="function"?$.decoder:r.decoder,delimiter:typeof $.delimiter=="string"||n.isRegExp($.delimiter)?$.delimiter:r.delimiter,depth:typeof $.depth=="number"||$.depth===!1?+$.depth:r.depth,duplicates:Y,ignoreQueryPrefix:$.ignoreQueryPrefix===!0,interpretNumericEntities:typeof $.interpretNumericEntities=="boolean"?$.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof $.parameterLimit=="number"?$.parameterLimit:r.parameterLimit,parseArrays:$.parseArrays!==!1,plainObjects:typeof $.plainObjects=="boolean"?$.plainObjects:r.plainObjects,strictDepth:typeof $.strictDepth=="boolean"?!!$.strictDepth:r.strictDepth,strictNullHandling:typeof $.strictNullHandling=="boolean"?$.strictNullHandling:r.strictNullHandling}};return parse$1=function($,V){var Y=H(V);if($===""||$===null||typeof $>"u")return Y.plainObjects?Object.create(null):{};for(var X=typeof $=="string"?B($,Y):$,z=Y.plainObjects?Object.create(null):{},W=Object.keys(X),q=0;q<W.length;++q){var K=W[q],Q=U(K,X[K],Y,typeof $=="string");z=n.merge(z,Q,Y)}return Y.allowSparse===!0?z:n.compact(z)},parse$1}var lib,hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var n=requireStringify(),e=requireParse(),t=requireFormats();return lib={formats:t,parse:e,stringify:n},lib}var hasRequiredUrl;function requireUrl(){if(hasRequiredUrl)return url$2;hasRequiredUrl=1;var n=requirePunycode();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,D=["<",">",'"',"`"," ","\r",`
`,"	"],N=["{","}","|","\\","^","`"].concat(D),k=["'"].concat(N),B=["%","/","?",";","#"].concat(k),G=["/","?","#"],U=255,H=/^[+a-z0-9A-Z_-]{0,63}$/,$=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,V={javascript:!0,"javascript:":!0},Y={javascript:!0,"javascript:":!0},X={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},z=requireLib();function W(Z,ee,J){if(Z&&typeof Z=="object"&&Z instanceof e)return Z;var te=new e;return te.parse(Z,ee,J),te}e.prototype.parse=function(Z,ee,J){if(typeof Z!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof Z);var te=Z.indexOf("?"),oe=te!==-1&&te<Z.indexOf("#")?"?":"#",ce=Z.split(oe),fe=/\\/g;ce[0]=ce[0].replace(fe,"/"),Z=ce.join(oe);var me=Z;if(me=me.trim(),!J&&Z.split("#").length===1){var we=o.exec(me);if(we)return this.path=me,this.href=me,this.pathname=we[1],we[2]?(this.search=we[2],ee?this.query=z.parse(this.search.substr(1)):this.query=this.search.substr(1)):ee&&(this.search="",this.query={}),this}var Me=t.exec(me);if(Me){Me=Me[0];var Ee=Me.toLowerCase();this.protocol=Ee,me=me.substr(Me.length)}if(J||Me||me.match(/^\/\/[^@/]+@[^@/]+/)){var ie=me.substr(0,2)==="//";ie&&!(Me&&Y[Me])&&(me=me.substr(2),this.slashes=!0)}if(!Y[Me]&&(ie||Me&&!X[Me])){for(var ne=-1,se=0;se<G.length;se++){var ue=me.indexOf(G[se]);ue!==-1&&(ne===-1||ue<ne)&&(ne=ue)}var le,he;ne===-1?he=me.lastIndexOf("@"):he=me.lastIndexOf("@",ne),he!==-1&&(le=me.slice(0,he),me=me.slice(he+1),this.auth=decodeURIComponent(le)),ne=-1;for(var se=0;se<B.length;se++){var ue=me.indexOf(B[se]);ue!==-1&&(ne===-1||ue<ne)&&(ne=ue)}ne===-1&&(ne=me.length),this.host=me.slice(0,ne),me=me.slice(ne),this.parseHost(),this.hostname=this.hostname||"";var pe=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!pe)for(var de=this.hostname.split(/\./),se=0,ve=de.length;se<ve;se++){var Se=de[se];if(Se&&!Se.match(H)){for(var ae="",Ae=0,xe=Se.length;Ae<xe;Ae++)Se.charCodeAt(Ae)>127?ae+="x":ae+=Se[Ae];if(!ae.match(H)){var Ce=de.slice(0,se),Oe=de.slice(se+1),Te=Se.match($);Te&&(Ce.push(Te[1]),Oe.unshift(Te[2])),Oe.length&&(me="/"+Oe.join(".")+me),this.hostname=Ce.join(".");break}}}this.hostname.length>U?this.hostname="":this.hostname=this.hostname.toLowerCase(),pe||(this.hostname=n.toASCII(this.hostname));var De=this.port?":"+this.port:"",Ie=this.hostname||"";this.host=Ie+De,this.href+=this.host,pe&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),me[0]!=="/"&&(me="/"+me))}if(!V[Ee])for(var se=0,ve=k.length;se<ve;se++){var _e=k[se];if(me.indexOf(_e)!==-1){var Re=encodeURIComponent(_e);Re===_e&&(Re=escape(_e)),me=me.split(_e).join(Re)}}var Pe=me.indexOf("#");Pe!==-1&&(this.hash=me.substr(Pe),me=me.slice(0,Pe));var be=me.indexOf("?");if(be!==-1?(this.search=me.substr(be),this.query=me.substr(be+1),ee&&(this.query=z.parse(this.query)),me=me.slice(0,be)):ee&&(this.search="",this.query={}),me&&(this.pathname=me),X[Ee]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var De=this.pathname||"",$e=this.search||"";this.path=De+$e}return this.href=this.format(),this};function q(Z){return typeof Z=="string"&&(Z=W(Z)),Z instanceof e?Z.format():e.prototype.format.call(Z)}e.prototype.format=function(){var Z=this.auth||"";Z&&(Z=encodeURIComponent(Z),Z=Z.replace(/%3A/i,":"),Z+="@");var ee=this.protocol||"",J=this.pathname||"",te=this.hash||"",oe=!1,ce="";this.host?oe=Z+this.host:this.hostname&&(oe=Z+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(oe+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(ce=z.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var fe=this.search||ce&&"?"+ce||"";return ee&&ee.substr(-1)!==":"&&(ee+=":"),this.slashes||(!ee||X[ee])&&oe!==!1?(oe="//"+(oe||""),J&&J.charAt(0)!=="/"&&(J="/"+J)):oe||(oe=""),te&&te.charAt(0)!=="#"&&(te="#"+te),fe&&fe.charAt(0)!=="?"&&(fe="?"+fe),J=J.replace(/[?#]/g,function(me){return encodeURIComponent(me)}),fe=fe.replace("#","%23"),ee+oe+J+fe+te};function K(Z,ee){return W(Z,!1,!0).resolve(ee)}e.prototype.resolve=function(Z){return this.resolveObject(W(Z,!1,!0)).format()};function Q(Z,ee){return Z?W(Z,!1,!0).resolveObject(ee):ee}return e.prototype.resolveObject=function(Z){if(typeof Z=="string"){var ee=new e;ee.parse(Z,!1,!0),Z=ee}for(var J=new e,te=Object.keys(this),oe=0;oe<te.length;oe++){var ce=te[oe];J[ce]=this[ce]}if(J.hash=Z.hash,Z.href==="")return J.href=J.format(),J;if(Z.slashes&&!Z.protocol){for(var fe=Object.keys(Z),me=0;me<fe.length;me++){var we=fe[me];we!=="protocol"&&(J[we]=Z[we])}return X[J.protocol]&&J.hostname&&!J.pathname&&(J.pathname="/",J.path=J.pathname),J.href=J.format(),J}if(Z.protocol&&Z.protocol!==J.protocol){if(!X[Z.protocol]){for(var Me=Object.keys(Z),Ee=0;Ee<Me.length;Ee++){var ie=Me[Ee];J[ie]=Z[ie]}return J.href=J.format(),J}if(J.protocol=Z.protocol,!Z.host&&!Y[Z.protocol]){for(var ve=(Z.pathname||"").split("/");ve.length&&!(Z.host=ve.shift()););Z.host||(Z.host=""),Z.hostname||(Z.hostname=""),ve[0]!==""&&ve.unshift(""),ve.length<2&&ve.unshift(""),J.pathname=ve.join("/")}else J.pathname=Z.pathname;if(J.search=Z.search,J.query=Z.query,J.host=Z.host||"",J.auth=Z.auth,J.hostname=Z.hostname||Z.host,J.port=Z.port,J.pathname||J.search){var ne=J.pathname||"",se=J.search||"";J.path=ne+se}return J.slashes=J.slashes||Z.slashes,J.href=J.format(),J}var ue=J.pathname&&J.pathname.charAt(0)==="/",le=Z.host||Z.pathname&&Z.pathname.charAt(0)==="/",he=le||ue||J.host&&Z.pathname,pe=he,de=J.pathname&&J.pathname.split("/")||[],ve=Z.pathname&&Z.pathname.split("/")||[],Se=J.protocol&&!X[J.protocol];if(Se&&(J.hostname="",J.port=null,J.host&&(de[0]===""?de[0]=J.host:de.unshift(J.host)),J.host="",Z.protocol&&(Z.hostname=null,Z.port=null,Z.host&&(ve[0]===""?ve[0]=Z.host:ve.unshift(Z.host)),Z.host=null),he=he&&(ve[0]===""||de[0]==="")),le)J.host=Z.host||Z.host===""?Z.host:J.host,J.hostname=Z.hostname||Z.hostname===""?Z.hostname:J.hostname,J.search=Z.search,J.query=Z.query,de=ve;else if(ve.length)de||(de=[]),de.pop(),de=de.concat(ve),J.search=Z.search,J.query=Z.query;else if(Z.search!=null){if(Se){J.host=de.shift(),J.hostname=J.host;var ae=J.host&&J.host.indexOf("@")>0?J.host.split("@"):!1;ae&&(J.auth=ae.shift(),J.hostname=ae.shift(),J.host=J.hostname)}return J.search=Z.search,J.query=Z.query,(J.pathname!==null||J.search!==null)&&(J.path=(J.pathname?J.pathname:"")+(J.search?J.search:"")),J.href=J.format(),J}if(!de.length)return J.pathname=null,J.search?J.path="/"+J.search:J.path=null,J.href=J.format(),J;for(var Ae=de.slice(-1)[0],xe=(J.host||Z.host||de.length>1)&&(Ae==="."||Ae==="..")||Ae==="",Ce=0,Oe=de.length;Oe>=0;Oe--)Ae=de[Oe],Ae==="."?de.splice(Oe,1):Ae===".."?(de.splice(Oe,1),Ce++):Ce&&(de.splice(Oe,1),Ce--);if(!he&&!pe)for(;Ce--;Ce)de.unshift("..");he&&de[0]!==""&&(!de[0]||de[0].charAt(0)!=="/")&&de.unshift(""),xe&&de.join("/").substr(-1)!=="/"&&de.push("");var Te=de[0]===""||de[0]&&de[0].charAt(0)==="/";if(Se){J.hostname=Te?"":de.length?de.shift():"",J.host=J.hostname;var ae=J.host&&J.host.indexOf("@")>0?J.host.split("@"):!1;ae&&(J.auth=ae.shift(),J.hostname=ae.shift(),J.host=J.hostname)}return he=he||J.host&&de.length,he&&!Te&&de.unshift(""),de.length>0?J.pathname=de.join("/"):(J.pathname=null,J.path=null),(J.pathname!==null||J.search!==null)&&(J.path=(J.pathname?J.pathname:"")+(J.search?J.search:"")),J.auth=Z.auth||J.auth,J.slashes=J.slashes||Z.slashes,J.href=J.format(),J},e.prototype.parseHost=function(){var Z=this.host,ee=r.exec(Z);ee&&(ee=ee[0],ee!==":"&&(this.port=ee.substr(1)),Z=Z.substr(0,Z.length-ee.length)),Z&&(this.hostname=Z)},url$2.parse=W,url$2.resolve=K,url$2.resolveObject=Q,url$2.format=q,url$2.Url=e,url$2}var urlExports=requireUrl();/*!
 * @pixi/utils - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var url$1={parse:urlExports.parse,format:urlExports.format,resolve:urlExports.resolve};settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var saidHello=!1,VERSION="6.5.10";function skipHello(){saidHello=!0}function sayHello(n){var e;if(!saidHello){if(settings.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var t=[`
 %c %c %c PixiJS `+VERSION+" - ✰ "+n+` ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=globalThis.console).log.apply(e,t)}else globalThis.console&&globalThis.console.log("PixiJS "+VERSION+" - "+n+" - http://www.pixijs.com/");saidHello=!0}}var supported;function isWebGLSupported(){return typeof supported>"u"&&(supported=function(){var n={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;var e=settings.ADAPTER.createCanvas(),t=e.getContext("webgl",n)||e.getContext("experimental-webgl",n),r=!!(t&&t.getContextAttributes().stencil);if(t){var o=t.getExtension("WEBGL_lose_context");o&&o.loseContext()}return t=null,r}catch{return!1}}()),supported}var aliceblue="#f0f8ff",antiquewhite="#faebd7",aqua="#00ffff",aquamarine="#7fffd4",azure="#f0ffff",beige="#f5f5dc",bisque="#ffe4c4",black="#000000",blanchedalmond="#ffebcd",blue="#0000ff",blueviolet="#8a2be2",brown="#a52a2a",burlywood="#deb887",cadetblue="#5f9ea0",chartreuse="#7fff00",chocolate="#d2691e",coral="#ff7f50",cornflowerblue="#6495ed",cornsilk="#fff8dc",crimson="#dc143c",cyan="#00ffff",darkblue="#00008b",darkcyan="#008b8b",darkgoldenrod="#b8860b",darkgray="#a9a9a9",darkgreen="#006400",darkgrey="#a9a9a9",darkkhaki="#bdb76b",darkmagenta="#8b008b",darkolivegreen="#556b2f",darkorange="#ff8c00",darkorchid="#9932cc",darkred="#8b0000",darksalmon="#e9967a",darkseagreen="#8fbc8f",darkslateblue="#483d8b",darkslategray="#2f4f4f",darkslategrey="#2f4f4f",darkturquoise="#00ced1",darkviolet="#9400d3",deeppink="#ff1493",deepskyblue="#00bfff",dimgray="#696969",dimgrey="#696969",dodgerblue="#1e90ff",firebrick="#b22222",floralwhite="#fffaf0",forestgreen="#228b22",fuchsia="#ff00ff",gainsboro="#dcdcdc",ghostwhite="#f8f8ff",goldenrod="#daa520",gold="#ffd700",gray="#808080",green="#008000",greenyellow="#adff2f",grey="#808080",honeydew="#f0fff0",hotpink="#ff69b4",indianred="#cd5c5c",indigo="#4b0082",ivory="#fffff0",khaki="#f0e68c",lavenderblush="#fff0f5",lavender="#e6e6fa",lawngreen="#7cfc00",lemonchiffon="#fffacd",lightblue="#add8e6",lightcoral="#f08080",lightcyan="#e0ffff",lightgoldenrodyellow="#fafad2",lightgray="#d3d3d3",lightgreen="#90ee90",lightgrey="#d3d3d3",lightpink="#ffb6c1",lightsalmon="#ffa07a",lightseagreen="#20b2aa",lightskyblue="#87cefa",lightslategray="#778899",lightslategrey="#778899",lightsteelblue="#b0c4de",lightyellow="#ffffe0",lime="#00ff00",limegreen="#32cd32",linen="#faf0e6",magenta="#ff00ff",maroon="#800000",mediumaquamarine="#66cdaa",mediumblue="#0000cd",mediumorchid="#ba55d3",mediumpurple="#9370db",mediumseagreen="#3cb371",mediumslateblue="#7b68ee",mediumspringgreen="#00fa9a",mediumturquoise="#48d1cc",mediumvioletred="#c71585",midnightblue="#191970",mintcream="#f5fffa",mistyrose="#ffe4e1",moccasin="#ffe4b5",navajowhite="#ffdead",navy="#000080",oldlace="#fdf5e6",olive="#808000",olivedrab="#6b8e23",orange="#ffa500",orangered="#ff4500",orchid="#da70d6",palegoldenrod="#eee8aa",palegreen="#98fb98",paleturquoise="#afeeee",palevioletred="#db7093",papayawhip="#ffefd5",peachpuff="#ffdab9",peru="#cd853f",pink="#ffc0cb",plum="#dda0dd",powderblue="#b0e0e6",purple="#800080",rebeccapurple="#663399",red="#ff0000",rosybrown="#bc8f8f",royalblue="#4169e1",saddlebrown="#8b4513",salmon="#fa8072",sandybrown="#f4a460",seagreen="#2e8b57",seashell="#fff5ee",sienna="#a0522d",silver="#c0c0c0",skyblue="#87ceeb",slateblue="#6a5acd",slategray="#708090",slategrey="#708090",snow="#fffafa",springgreen="#00ff7f",steelblue="#4682b4",tan="#d2b48c",teal="#008080",thistle="#d8bfd8",tomato="#ff6347",turquoise="#40e0d0",violet="#ee82ee",wheat="#f5deb3",white="#ffffff",whitesmoke="#f5f5f5",yellow="#ffff00",yellowgreen="#9acd32",cssColorNames={aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,goldenrod,gold,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavenderblush,lavender,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen};function hex2rgb(n,e){return e===void 0&&(e=[]),e[0]=(n>>16&255)/255,e[1]=(n>>8&255)/255,e[2]=(n&255)/255,e}function hex2string(n){var e=n.toString(16);return e="000000".substring(0,6-e.length)+e,"#"+e}function string2hex(n){return typeof n=="string"&&(n=cssColorNames[n.toLowerCase()]||n,n[0]==="#"&&(n=n.slice(1))),parseInt(n,16)}function mapPremultipliedBlendModes(){for(var n=[],e=[],t=0;t<32;t++)n[t]=t,e[t]=t;n[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,n[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,n[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,e[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,e[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,e[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;var r=[];return r.push(e),r.push(n),r}var premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(n,e){return premultiplyBlendMode[e?1:0][n]}function premultiplyRgba(n,e,t,r){return t=t||new Float32Array(4),r||r===void 0?(t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e):(t[0]=n[0],t[1]=n[1],t[2]=n[2]),t[3]=e,t}function premultiplyTint(n,e){if(e===1)return(e*255<<24)+n;if(e===0)return 0;var t=n>>16&255,r=n>>8&255,o=n&255;return t=t*e+.5|0,r=r*e+.5|0,o=o*e+.5|0,(e*255<<24)+(t<<16)+(r<<8)+o}function premultiplyTintToRgba(n,e,t,r){return t=t||new Float32Array(4),t[0]=(n>>16&255)/255,t[1]=(n>>8&255)/255,t[2]=(n&255)/255,(r||r===void 0)&&(t[0]*=e,t[1]*=e,t[2]*=e),t[3]=e,t}function createIndicesForQuads(n,e){e===void 0&&(e=null);var t=n*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+t);for(var r=0,o=0;r<t;r+=6,o+=4)e[r+0]=o+0,e[r+1]=o+1,e[r+2]=o+2,e[r+3]=o+0,e[r+4]=o+2,e[r+5]=o+3;return e}function getBufferType(n){if(n.BYTES_PER_ELEMENT===4)return n instanceof Float32Array?"Float32Array":n instanceof Uint32Array?"Uint32Array":"Int32Array";if(n.BYTES_PER_ELEMENT===2){if(n instanceof Uint16Array)return"Uint16Array"}else if(n.BYTES_PER_ELEMENT===1&&n instanceof Uint8Array)return"Uint8Array";return null}function nextPow2(n){return n+=n===0?1:0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1}function isPow2(n){return!(n&n-1)&&!!n}function log2(n){var e=(n>65535?1:0)<<4;n>>>=e;var t=(n>255?1:0)<<3;return n>>>=t,e|=t,t=(n>15?1:0)<<2,n>>>=t,e|=t,t=(n>3?1:0)<<1,n>>>=t,e|=t,e|n>>1}function removeItems(n,e,t){var r=n.length,o;if(!(e>=r||t===0)){t=e+t>r?r-e:t;var D=r-t;for(o=e;o<D;++o)n[o]=n[o+t];n.length=D}}function sign(n){return n===0?0:n<0?-1:1}var nextUid=0;function uid(){return++nextUid}var warnings={};function deprecation(n,e,t){if(t===void 0&&(t=3),!warnings[e]){var r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+n):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+`
Deprecated since v`+n),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+n),console.warn(r))),warnings[e]=!0}}var ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);function clearTextureCache(){var n;for(n in TextureCache)delete TextureCache[n];for(n in BaseTextureCache)delete BaseTextureCache[n]}var CanvasRenderTarget=function(){function n(e,t,r){this.canvas=settings.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||settings.RESOLUTION,this.resize(e,t)}return n.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},n.prototype.resize=function(e,t){this.canvas.width=Math.round(e*this.resolution),this.canvas.height=Math.round(t*this.resolution)},n.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(n.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=Math.round(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=Math.round(e)},enumerable:!1,configurable:!0}),n}();function trimCanvas(n){var e=n.width,t=n.height,r=n.getContext("2d",{willReadFrequently:!0}),o=r.getImageData(0,0,e,t),D=o.data,N=D.length,k={top:null,left:null,right:null,bottom:null},B=null,G,U,H;for(G=0;G<N;G+=4)D[G+3]!==0&&(U=G/4%e,H=~~(G/4/e),k.top===null&&(k.top=H),(k.left===null||U<k.left)&&(k.left=U),(k.right===null||k.right<U)&&(k.right=U+1),(k.bottom===null||k.bottom<H)&&(k.bottom=H));return k.top!==null&&(e=k.right-k.left,t=k.bottom-k.top+1,B=r.getImageData(k.left,k.top,e,t)),{height:t,width:e,data:B}}var tempAnchor$1;function determineCrossOrigin(n,e){if(e===void 0&&(e=globalThis.location),n.indexOf("data:")===0)return"";e=e||globalThis.location,tempAnchor$1||(tempAnchor$1=document.createElement("a")),tempAnchor$1.href=n;var t=url$1.parse(tempAnchor$1.href),r=!t.port&&e.port===""||t.port===e.port;return t.hostname!==e.hostname||!r||t.protocol!==e.protocol?"anonymous":""}function getResolutionOfUrl(n,e){var t=settings.RETINA_PREFIX.exec(n);return t?parseFloat(t[1]):e!==void 0?e:1}/*!
 * @pixi/math - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180,SHAPES;(function(n){n[n.POLY=0]="POLY",n[n.RECT=1]="RECT",n[n.CIRC=2]="CIRC",n[n.ELIP=3]="ELIP",n[n.RREC=4]="RREC"})(SHAPES||(SHAPES={}));var Point=function(){function n(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this.x=0,this.y=0,this.x=e,this.y=t}return n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},n.prototype.copyTo=function(e){return e.set(this.x,this.y),e},n.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},n.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x=e,this.y=t,this},n.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},n}(),tempPoints$1=[new Point,new Point,new Point,new Point],Rectangle=function(){function n(e,t,r,o){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(o),this.type=SHAPES.RECT}return Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(n,"EMPTY",{get:function(){return new n(0,0,0,0)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},n.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},n.prototype.contains=function(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height},n.prototype.intersects=function(e,t){if(!t){var r=this.x<e.x?e.x:this.x,o=this.right>e.right?e.right:this.right;if(o<=r)return!1;var D=this.y<e.y?e.y:this.y,N=this.bottom>e.bottom?e.bottom:this.bottom;return N>D}var k=this.left,B=this.right,G=this.top,U=this.bottom;if(B<=k||U<=G)return!1;var H=tempPoints$1[0].set(e.left,e.top),$=tempPoints$1[1].set(e.left,e.bottom),V=tempPoints$1[2].set(e.right,e.top),Y=tempPoints$1[3].set(e.right,e.bottom);if(V.x<=H.x||$.y<=H.y)return!1;var X=Math.sign(t.a*t.d-t.b*t.c);if(X===0||(t.apply(H,H),t.apply($,$),t.apply(V,V),t.apply(Y,Y),Math.max(H.x,$.x,V.x,Y.x)<=k||Math.min(H.x,$.x,V.x,Y.x)>=B||Math.max(H.y,$.y,V.y,Y.y)<=G||Math.min(H.y,$.y,V.y,Y.y)>=U))return!1;var z=X*($.y-H.y),W=X*(H.x-$.x),q=z*k+W*G,K=z*B+W*G,Q=z*k+W*U,Z=z*B+W*U;if(Math.max(q,K,Q,Z)<=z*H.x+W*H.y||Math.min(q,K,Q,Z)>=z*Y.x+W*Y.y)return!1;var ee=X*(H.y-V.y),J=X*(V.x-H.x),te=ee*k+J*G,oe=ee*B+J*G,ce=ee*k+J*U,fe=ee*B+J*U;return!(Math.max(te,oe,ce,fe)<=ee*H.x+J*H.y||Math.min(te,oe,ce,fe)>=ee*Y.x+J*Y.y)},n.prototype.pad=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this},n.prototype.fit=function(e){var t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),o=Math.max(this.y,e.y),D=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=o,this.height=Math.max(D-o,0),this},n.prototype.ceil=function(e,t){e===void 0&&(e=1),t===void 0&&(t=.001);var r=Math.ceil((this.x+this.width-t)*e)/e,o=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=o-this.y,this},n.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),o=Math.min(this.y,e.y),D=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=o,this.height=D-o,this},n.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},n}(),Circle=function(){function n(e,t,r){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),this.x=e,this.y=t,this.radius=r,this.type=SHAPES.CIRC}return n.prototype.clone=function(){return new n(this.x,this.y,this.radius)},n.prototype.contains=function(e,t){if(this.radius<=0)return!1;var r=this.radius*this.radius,o=this.x-e,D=this.y-t;return o*=o,D*=D,o+D<=r},n.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},n.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},n}(),Ellipse=function(){function n(e,t,r,o){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),this.x=e,this.y=t,this.width=r,this.height=o,this.type=SHAPES.ELIP}return n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,o=(t-this.y)/this.height;return r*=r,o*=o,r+o<=1},n.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},n.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},n}(),Polygon=function(){function n(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];var o=Array.isArray(t[0])?t[0]:t;if(typeof o[0]!="number"){for(var D=[],N=0,k=o.length;N<k;N++)D.push(o[N].x,o[N].y);o=D}this.points=o,this.type=SHAPES.POLY,this.closeStroke=!0}return n.prototype.clone=function(){var e=this.points.slice(),t=new n(e);return t.closeStroke=this.closeStroke,t},n.prototype.contains=function(e,t){for(var r=!1,o=this.points.length/2,D=0,N=o-1;D<o;N=D++){var k=this.points[D*2],B=this.points[D*2+1],G=this.points[N*2],U=this.points[N*2+1],H=B>t!=U>t&&e<(G-k)*((t-B)/(U-B))+k;H&&(r=!r)}return r},n.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(e,t){return e+", "+t},"")+"]")},n}(),RoundedRectangle=function(){function n(e,t,r,o,D){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),D===void 0&&(D=20),this.x=e,this.y=t,this.width=r,this.height=o,this.radius=D,this.type=SHAPES.RREC}return n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height,this.radius)},n.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){var r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;var o=e-(this.x+r),D=t-(this.y+r),N=r*r;if(o*o+D*D<=N||(o=e-(this.x+this.width-r),o*o+D*D<=N)||(D=t-(this.y+this.height-r),o*o+D*D<=N)||(o=e-(this.x+r),o*o+D*D<=N))return!0}return!1},n.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},n}(),ObservablePoint=function(){function n(e,t,r,o){r===void 0&&(r=0),o===void 0&&(o=0),this._x=r,this._y=o,this.cb=e,this.scope=t}return n.prototype.clone=function(e,t){return e===void 0&&(e=this.cb),t===void 0&&(t=this.scope),new n(e,t,this._x,this._y)},n.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this},n.prototype.copyFrom=function(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},n.prototype.copyTo=function(e){return e.set(this._x,this._y),e},n.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},n.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),n}(),Matrix=function(){function n(e,t,r,o,D,N){e===void 0&&(e=1),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=1),D===void 0&&(D=0),N===void 0&&(N=0),this.array=null,this.a=e,this.b=t,this.c=r,this.d=o,this.tx=D,this.ty=N}return n.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},n.prototype.set=function(e,t,r,o,D,N){return this.a=e,this.b=t,this.c=r,this.d=o,this.tx=D,this.ty=N,this},n.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},n.prototype.apply=function(e,t){t=t||new Point;var r=e.x,o=e.y;return t.x=this.a*r+this.c*o+this.tx,t.y=this.b*r+this.d*o+this.ty,t},n.prototype.applyInverse=function(e,t){t=t||new Point;var r=1/(this.a*this.d+this.c*-this.b),o=e.x,D=e.y;return t.x=this.d*r*o+-this.c*r*D+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*D+-this.b*r*o+(-this.ty*this.a+this.tx*this.b)*r,t},n.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},n.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},n.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),o=this.a,D=this.c,N=this.tx;return this.a=o*t-this.b*r,this.b=o*r+this.b*t,this.c=D*t-this.d*r,this.d=D*r+this.d*t,this.tx=N*t-this.ty*r,this.ty=N*r+this.ty*t,this},n.prototype.append=function(e){var t=this.a,r=this.b,o=this.c,D=this.d;return this.a=e.a*t+e.b*o,this.b=e.a*r+e.b*D,this.c=e.c*t+e.d*o,this.d=e.c*r+e.d*D,this.tx=e.tx*t+e.ty*o+this.tx,this.ty=e.tx*r+e.ty*D+this.ty,this},n.prototype.setTransform=function(e,t,r,o,D,N,k,B,G){return this.a=Math.cos(k+G)*D,this.b=Math.sin(k+G)*D,this.c=-Math.sin(k-B)*N,this.d=Math.cos(k-B)*N,this.tx=e-(r*this.a+o*this.c),this.ty=t-(r*this.b+o*this.d),this},n.prototype.prepend=function(e){var t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){var r=this.a,o=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=o*e.a+this.d*e.c,this.d=o*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},n.prototype.decompose=function(e){var t=this.a,r=this.b,o=this.c,D=this.d,N=e.pivot,k=-Math.atan2(-o,D),B=Math.atan2(r,t),G=Math.abs(k+B);return G<1e-5||Math.abs(PI_2-G)<1e-5?(e.rotation=B,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=k,e.skew.y=B),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(o*o+D*D),e.position.x=this.tx+(N.x*t+N.y*o),e.position.y=this.ty+(N.x*r+N.y*D),e},n.prototype.invert=function(){var e=this.a,t=this.b,r=this.c,o=this.d,D=this.tx,N=e*o-t*r;return this.a=o/N,this.b=-t/N,this.c=-r/N,this.d=e/N,this.tx=(r*this.ty-o*D)/N,this.ty=-(e*this.ty-t*D)/N,this},n.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.prototype.clone=function(){var e=new n;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},n.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},n.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},n.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(n,"IDENTITY",{get:function(){return new n},enumerable:!1,configurable:!0}),Object.defineProperty(n,"TEMP_MATRIX",{get:function(){return new n},enumerable:!1,configurable:!0}),n}(),ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(var n=0;n<16;n++){var e=[];rotationCayley.push(e);for(var t=0;t<16;t++)for(var r=signum(ux[n]*ux[t]+vx[n]*uy[t]),o=signum(uy[n]*ux[t]+vy[n]*uy[t]),D=signum(ux[n]*vx[t]+vx[n]*vy[t]),N=signum(uy[n]*vx[t]+vy[n]*vy[t]),k=0;k<16;k++)if(ux[k]===r&&uy[k]===o&&vx[k]===D&&vy[k]===N){e.push(k);break}}for(var n=0;n<16;n++){var B=new Matrix;B.set(ux[n],uy[n],vx[n],vy[n],0,0),rotationMatrices.push(B)}}init();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(n){return ux[n]},uY:function(n){return uy[n]},vX:function(n){return vx[n]},vY:function(n){return vy[n]},inv:function(n){return n&8?n&15:-n&7},add:function(n,e){return rotationCayley[n][e]},sub:function(n,e){return rotationCayley[n][groupD8.inv(e)]},rotate180:function(n){return n^4},isVertical:function(n){return(n&3)===2},byDirection:function(n,e){return Math.abs(n)*2<=Math.abs(e)?e>=0?groupD8.S:groupD8.N:Math.abs(e)*2<=Math.abs(n)?n>0?groupD8.E:groupD8.W:e>0?n>0?groupD8.SE:groupD8.SW:n>0?groupD8.NE:groupD8.NW},matrixAppendRotationInv:function(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var o=rotationMatrices[groupD8.inv(e)];o.tx=t,o.ty=r,n.append(o)}},Transform=function(){function n(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return n.prototype.onChange=function(){this._localID++},n.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},n.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},n.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},n.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,o=this.worldTransform;o.a=t.a*r.a+t.b*r.c,o.b=t.a*r.b+t.b*r.d,o.c=t.c*r.a+t.d*r.c,o.d=t.c*r.b+t.d*r.d,o.tx=t.tx*r.a+t.ty*r.c+r.tx,o.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},n.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(n.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),n.IDENTITY=new n,n}();/*!
 * @pixi/display - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */settings.SORTABLE_CHILDREN=!1;var Bounds=function(){function n(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return n.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},n.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},n.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(e=e||new Rectangle(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},n.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},n.prototype.addPointMatrix=function(e,t){var r=e.a,o=e.b,D=e.c,N=e.d,k=e.tx,B=e.ty,G=r*t.x+D*t.y+k,U=o*t.x+N*t.y+B;this.minX=Math.min(this.minX,G),this.maxX=Math.max(this.maxX,G),this.minY=Math.min(this.minY,U),this.maxY=Math.max(this.maxY,U)},n.prototype.addQuad=function(e){var t=this.minX,r=this.minY,o=this.maxX,D=this.maxY,N=e[0],k=e[1];t=N<t?N:t,r=k<r?k:r,o=N>o?N:o,D=k>D?k:D,N=e[2],k=e[3],t=N<t?N:t,r=k<r?k:r,o=N>o?N:o,D=k>D?k:D,N=e[4],k=e[5],t=N<t?N:t,r=k<r?k:r,o=N>o?N:o,D=k>D?k:D,N=e[6],k=e[7],t=N<t?N:t,r=k<r?k:r,o=N>o?N:o,D=k>D?k:D,this.minX=t,this.minY=r,this.maxX=o,this.maxY=D},n.prototype.addFrame=function(e,t,r,o,D){this.addFrameMatrix(e.worldTransform,t,r,o,D)},n.prototype.addFrameMatrix=function(e,t,r,o,D){var N=e.a,k=e.b,B=e.c,G=e.d,U=e.tx,H=e.ty,$=this.minX,V=this.minY,Y=this.maxX,X=this.maxY,z=N*t+B*r+U,W=k*t+G*r+H;$=z<$?z:$,V=W<V?W:V,Y=z>Y?z:Y,X=W>X?W:X,z=N*o+B*r+U,W=k*o+G*r+H,$=z<$?z:$,V=W<V?W:V,Y=z>Y?z:Y,X=W>X?W:X,z=N*t+B*D+U,W=k*t+G*D+H,$=z<$?z:$,V=W<V?W:V,Y=z>Y?z:Y,X=W>X?W:X,z=N*o+B*D+U,W=k*o+G*D+H,$=z<$?z:$,V=W<V?W:V,Y=z>Y?z:Y,X=W>X?W:X,this.minX=$,this.minY=V,this.maxX=Y,this.maxY=X},n.prototype.addVertexData=function(e,t,r){for(var o=this.minX,D=this.minY,N=this.maxX,k=this.maxY,B=t;B<r;B+=2){var G=e[B],U=e[B+1];o=G<o?G:o,D=U<D?U:D,N=G>N?G:N,k=U>k?U:k}this.minX=o,this.minY=D,this.maxX=N,this.maxY=k},n.prototype.addVertices=function(e,t,r,o){this.addVerticesMatrix(e.worldTransform,t,r,o)},n.prototype.addVerticesMatrix=function(e,t,r,o,D,N){D===void 0&&(D=0),N===void 0&&(N=D);for(var k=e.a,B=e.b,G=e.c,U=e.d,H=e.tx,$=e.ty,V=this.minX,Y=this.minY,X=this.maxX,z=this.maxY,W=r;W<o;W+=2){var q=t[W],K=t[W+1],Q=k*q+G*K+H,Z=U*K+B*q+$;V=Math.min(V,Q-D),X=Math.max(X,Q+D),Y=Math.min(Y,Z-N),z=Math.max(z,Z+N)}this.minX=V,this.minY=Y,this.maxX=X,this.maxY=z},n.prototype.addBounds=function(e){var t=this.minX,r=this.minY,o=this.maxX,D=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>o?e.maxX:o,this.maxY=e.maxY>D?e.maxY:D},n.prototype.addBoundsMask=function(e,t){var r=e.minX>t.minX?e.minX:t.minX,o=e.minY>t.minY?e.minY:t.minY,D=e.maxX<t.maxX?e.maxX:t.maxX,N=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=D&&o<=N){var k=this.minX,B=this.minY,G=this.maxX,U=this.maxY;this.minX=r<k?r:k,this.minY=o<B?o:B,this.maxX=D>G?D:G,this.maxY=N>U?N:U}},n.prototype.addBoundsMatrix=function(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)},n.prototype.addBoundsArea=function(e,t){var r=e.minX>t.x?e.minX:t.x,o=e.minY>t.y?e.minY:t.y,D=e.maxX<t.x+t.width?e.maxX:t.x+t.width,N=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=D&&o<=N){var k=this.minX,B=this.minY,G=this.maxX,U=this.maxY;this.minX=r<k?r:k,this.minY=o<B?o:B,this.maxX=D>G?D:G,this.maxY=N>U?N:U}},n.prototype.pad=function(e,t){e===void 0&&(e=0),t===void 0&&(t=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)},n.prototype.addFramePad=function(e,t,r,o,D,N){e-=D,t-=N,r+=D,o+=N,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>o?this.maxY:o},n}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$j=function(n,e){return extendStatics$j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$j(n,e)};function __extends$j(n,e){extendStatics$j(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var DisplayObject=function(n){__extends$j(e,n);function e(){var t=n.call(this)||this;return t.tempDisplayObjectParent=null,t.transform=new Transform,t.alpha=1,t.visible=!0,t.renderable=!0,t.cullable=!1,t.cullArea=null,t.parent=null,t.worldAlpha=1,t._lastSortedIndex=0,t._zIndex=0,t.filterArea=null,t.filters=null,t._enabledFilters=null,t._bounds=new Bounds,t._localBounds=null,t._boundsID=0,t._boundsRect=null,t._localBoundsRect=null,t._mask=null,t._maskRefCount=0,t._destroyed=!1,t.isSprite=!1,t.isMask=!1,t}return e.mixin=function(t){for(var r=Object.keys(t),o=0;o<r.length;++o){var D=r[o];Object.defineProperty(e.prototype,D,Object.getOwnPropertyDescriptor(t,D))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Rectangle),r=this._boundsRect),this._bounds.getRectangle(r)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);var r=this.transform,o=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var D=this._bounds,N=this._boundsID;this._bounds=this._localBounds;var k=this.getBounds(!1,t);return this.parent=o,this.transform=r,this._bounds=D,this._bounds.updateID+=this._boundsID-N,k},e.prototype.toGlobal=function(t,r,o){return o===void 0&&(o=!1),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)},e.prototype.toLocal=function(t,r,o,D){return r&&(t=r.toGlobal(t,o,D)),D||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,o)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,r,o,D,N,k,B,G,U){return t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=1),D===void 0&&(D=1),N===void 0&&(N=0),k===void 0&&(k=0),B===void 0&&(B=0),G===void 0&&(G=0),U===void 0&&(U=0),this.position.x=t,this.position.y=r,this.scale.x=o||1,this.scale.y=D||1,this.rotation=N,this.skew.x=k,this.skew.y=B,this.pivot.x=G,this.pivot.y=U,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*RAD_TO_DEG},set:function(t){this.transform.rotation=t*DEG_TO_RAD},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask!==t){if(this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}},enumerable:!1,configurable:!0}),e}(i),TemporaryDisplayObject=function(n){__extends$j(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.sortDirty=null,t}return e}(DisplayObject);DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;function sortChildren(n,e){return n.zIndex===e.zIndex?n._lastSortedIndex-e._lastSortedIndex:n.zIndex-e.zIndex}var Container=function(n){__extends$j(e,n);function e(){var t=n.call(this)||this;return t.children=[],t.sortableChildren=settings.SORTABLE_CHILDREN,t.sortDirty=!1,t}return e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,r=[],o=0;o<arguments.length;o++)r[o]=t[o];if(r.length>1)for(var D=0;D<r.length;D++)this.addChild(r[D]);else{var N=r[0];N.parent&&N.parent.removeChild(N),N.parent=this,this.sortDirty=!0,N.transform._parentID=-1,this.children.push(N),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",N,this,this.children.length-1),N.emit("added",this)}return r[0]},e.prototype.addChildAt=function(t,r){if(r<0||r>this.children.length)throw new Error(t+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(r,0,t),this._boundsID++,this.onChildrenChange(r),t.emit("added",this),this.emit("childAdded",t,this,r),t},e.prototype.swapChildren=function(t,r){if(t!==r){var o=this.getChildIndex(t),D=this.getChildIndex(r);this.children[o]=r,this.children[D]=t,this.onChildrenChange(o<D?o:D)}},e.prototype.getChildIndex=function(t){var r=this.children.indexOf(t);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},e.prototype.setChildIndex=function(t,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var o=this.getChildIndex(t);removeItems(this.children,o,1),this.children.splice(r,0,t),this.onChildrenChange(r)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,r=[],o=0;o<arguments.length;o++)r[o]=t[o];if(r.length>1)for(var D=0;D<r.length;D++)this.removeChild(r[D]);else{var N=r[0],k=this.children.indexOf(N);if(k===-1)return null;N.parent=null,N.transform._parentID=-1,removeItems(this.children,k,1),this._boundsID++,this.onChildrenChange(k),N.emit("removed",this),this.emit("childRemoved",N,this,k)}return r[0]},e.prototype.removeChildAt=function(t){var r=this.getChildAt(t);return r.parent=null,r.transform._parentID=-1,removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),r.emit("removed",this),this.emit("childRemoved",r,this,t),r},e.prototype.removeChildren=function(t,r){t===void 0&&(t=0),r===void 0&&(r=this.children.length);var o=t,D=r,N=D-o,k;if(N>0&&N<=D){k=this.children.splice(o,N);for(var B=0;B<k.length;++B)k[B].parent=null,k[B].transform&&(k[B].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var B=0;B<k.length;++B)k[B].emit("removed",this),this.emit("childRemoved",k[B],this,B);return k}else if(N===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,r=0,o=this.children.length;r<o;++r){var D=this.children[r];D._lastSortedIndex=r,!t&&D.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,r=this.children.length;t<r;++t){var o=this.children[t];o.visible&&o.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var r=this.children[t];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var o=r._mask.isMaskData?r._mask.maskObject:r._mask;o?(o.calculateBounds(),this._bounds.addBoundsMask(r._bounds,o._bounds)):this._bounds.addBounds(r._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(t,r){r===void 0&&(r=!1);var o=n.prototype.getLocalBounds.call(this,t);if(!r)for(var D=0,N=this.children.length;D<N;++D){var k=this.children[D];k.visible&&k.updateTransform()}return o},e.prototype._calculateBounds=function(){},e.prototype._renderWithCulling=function(t){var r=t.renderTexture.sourceFrame;if(r.width>0&&r.height>0){var o,D;if(this.cullArea?(o=this.cullArea,D=this.worldTransform):this._render!==e.prototype._render&&(o=this.getBounds(!0)),o&&r.intersects(o,D))this._render(t);else if(this.cullArea)return;for(var N=0,k=this.children.length;N<k;++N){var B=this.children[N],G=B.cullable;B.cullable=G||!this.cullArea,B.render(t),B.cullable=G}}},e.prototype.render=function(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(var r=0,o=this.children.length;r<o;++r)this.children[r].render(t)}},e.prototype.renderAdvanced=function(t){var r=this.filters,o=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var D=0;D<r.length;D++)r[D].enabled&&this._enabledFilters.push(r[D])}var N=r&&this._enabledFilters&&this._enabledFilters.length||o&&(!o.isMaskData||o.enabled&&(o.autoDetect||o.type!==MASK_TYPES.NONE));if(N&&t.batch.flush(),r&&this._enabledFilters&&this._enabledFilters.length&&t.filter.push(this,this._enabledFilters),o&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(var D=0,k=this.children.length;D<k;++D)this.children[D].render(t)}N&&t.batch.flush(),o&&t.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(t){n.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof t=="boolean"?t:t&&t.children,o=this.removeChildren(0,this.children.length);if(r)for(var D=0;D<o.length;++D)o[D].destroy(t)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var r=this.getLocalBounds().width;r!==0?this.scale.x=t/r:this.scale.x=1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var r=this.getLocalBounds().height;r!==0?this.scale.y=t/r:this.scale.y=1,this._height=t},enumerable:!1,configurable:!0}),e}(DisplayObject);Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;/*!
 * @pixi/extensions - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var __assign$1=function(){return __assign$1=Object.assign||function(n){for(var e=arguments,t,r=1,o=arguments.length;r<o;r++){t=e[r];for(var D in t)Object.prototype.hasOwnProperty.call(t,D)&&(n[D]=t[D])}return n},__assign$1.apply(this,arguments)},ExtensionType;(function(n){n.Application="application",n.RendererPlugin="renderer-webgl-plugin",n.CanvasRendererPlugin="renderer-canvas-plugin",n.Loader="loader",n.LoadParser="load-parser",n.ResolveParser="resolve-parser",n.CacheParser="cache-parser",n.DetectionParser="detection-parser"})(ExtensionType||(ExtensionType={}));var normalizeExtension=function(n){if(typeof n=="function"||typeof n=="object"&&n.extension){if(!n.extension)throw new Error("Extension class must have an extension object");var e=typeof n.extension!="object"?{type:n.extension}:n.extension;n=__assign$1(__assign$1({},e),{ref:n})}if(typeof n=="object")n=__assign$1({},n);else throw new Error("Invalid extension type");return typeof n.type=="string"&&(n.type=[n.type]),n},extensions={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var n=arguments,e=this,t=[],r=0;r<arguments.length;r++)t[r]=n[r];return t.map(normalizeExtension).forEach(function(o){o.type.forEach(function(D){var N,k;return(k=(N=e._removeHandlers)[D])===null||k===void 0?void 0:k.call(N,o)})}),this},add:function(){for(var n=arguments,e=this,t=[],r=0;r<arguments.length;r++)t[r]=n[r];return t.map(normalizeExtension).forEach(function(o){o.type.forEach(function(D){var N=e._addHandlers,k=e._queue;N[D]?N[D](o):(k[D]=k[D]||[],k[D].push(o))})}),this},handle:function(n,e,t){var r=this._addHandlers=this._addHandlers||{},o=this._removeHandlers=this._removeHandlers||{};if(r[n]||o[n])throw new Error("Extension type "+n+" already has a handler");r[n]=e,o[n]=t;var D=this._queue;return D[n]&&(D[n].forEach(function(N){return e(N)}),delete D[n]),this},handleByMap:function(n,e){return this.handle(n,function(t){e[t.name]=t.ref},function(t){delete e[t.name]})},handleByList:function(n,e){return this.handle(n,function(t){var r,o;e.includes(t.ref)||(e.push(t.ref),n===ExtensionType.Loader&&((o=(r=t.ref).add)===null||o===void 0||o.call(r)))},function(t){var r=e.indexOf(t.ref);r!==-1&&e.splice(r,1)})}};/*!
 * @pixi/runner - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Runner=function(){function n(e){this.items=[],this._name=e,this._aliasCount=0}return n.prototype.emit=function(e,t,r,o,D,N,k,B){if(arguments.length>8)throw new Error("max arguments reached");var G=this,U=G.name,H=G.items;this._aliasCount++;for(var $=0,V=H.length;$<V;$++)H[$][U](e,t,r,o,D,N,k,B);return H===this.items&&this._aliasCount--,this},n.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},n.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},n.prototype.remove=function(e){var t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this},n.prototype.contains=function(e){return this.items.indexOf(e)!==-1},n.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},n.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(n.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),n}();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});/*!
 * @pixi/ticker - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */settings.TARGET_FPMS=.06;var UPDATE_PRIORITY;(function(n){n[n.INTERACTION=50]="INTERACTION",n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY"})(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=function(){function n(e,t,r,o){t===void 0&&(t=null),r===void 0&&(r=0),o===void 0&&(o=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=o}return n.prototype.match=function(e,t){return t===void 0&&(t=null),this.fn===e&&this.context===t},n.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t},n.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},n.prototype.destroy=function(e){e===void 0&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.next;return this.next=e?null:t,this.previous=null,t},n}(),Ticker=function(){function n(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&e._requestId===null&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return n.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},n.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},n.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},n.prototype.add=function(e,t,r){return r===void 0&&(r=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(e,t,r))},n.prototype.addOnce=function(e,t,r){return r===void 0&&(r=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(e,t,r,!0))},n.prototype._addListener=function(e){var t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this},n.prototype.remove=function(e,t){for(var r=this._head.next;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(n.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,t=this._head;t=t.next;)e++;return e},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},n.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},n.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},n.prototype.update=function(e){e===void 0&&(e=performance.now());var t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){var r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var o=this._head,D=o.next;D;)D=D.emit(this.deltaTime);o.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(n.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){if(e===0)this._minElapsedMS=0;else{var t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"shared",{get:function(){if(!n._shared){var e=n._shared=new n;e.autoStart=!0,e._protected=!0}return n._shared},enumerable:!1,configurable:!0}),Object.defineProperty(n,"system",{get:function(){if(!n._system){var e=n._system=new n;e.autoStart=!0,e._protected=!0}return n._system},enumerable:!1,configurable:!0}),n}(),TickerPlugin=function(){function n(){}return n.init=function(e){var t=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){t._ticker.stop()},this.start=function(){t._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ticker.shared:new Ticker,e.autoStart&&this.start()},n.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}},n.extension=ExtensionType.Application,n}();/*!
 * @pixi/core - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */settings.PREFER_ENV=isMobile.any?ENV.WEBGL:ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[];function autoDetectResource(n,e){if(!n)return null;var t="";if(typeof n=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(n);r&&(t=r[1].toLowerCase())}for(var o=INSTALLED.length-1;o>=0;--o){var D=INSTALLED[o];if(D.test&&D.test(n,t))return new D(n,e)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$i=function(n,e){return extendStatics$i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$i(n,e)};function __extends$i(n,e){extendStatics$i(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var __assign=function(){return __assign=Object.assign||function(n){for(var e=arguments,t,r=1,o=arguments.length;r<o;r++){t=e[r];for(var D in t)Object.prototype.hasOwnProperty.call(t,D)&&(n[D]=t[D])}return n},__assign.apply(this,arguments)};function __rest(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t}var Resource=function(){function n(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}return n.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},n.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},n.prototype.resize=function(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))},Object.defineProperty(n.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),n.prototype.update=function(){this.destroyed||this.onUpdate.emit()},n.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),n.prototype.style=function(e,t,r){return!1},n.prototype.dispose=function(){},n.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},n.test=function(e,t){return!1},n}(),BufferResource=function(n){__extends$i(e,n);function e(t,r){var o=this,D=r||{},N=D.width,k=D.height;if(!N||!k)throw new Error("BufferResource width or height invalid");return o=n.call(this,N,k)||this,o.data=t,o}return e.prototype.upload=function(t,r,o){var D=t.gl;D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ALPHA_MODES.UNPACK);var N=r.realWidth,k=r.realHeight;return o.width===N&&o.height===k?D.texSubImage2D(r.target,0,0,0,N,k,r.format,o.type,this.data):(o.width=N,o.height=k,D.texImage2D(r.target,0,o.internalFormat,N,k,0,r.format,o.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Resource),defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM},BaseTexture=function(n){__extends$i(e,n);function e(t,r){t===void 0&&(t=null),r===void 0&&(r=null);var o=n.call(this)||this;r=r||{};var D=r.alphaMode,N=r.mipmap,k=r.anisotropicLevel,B=r.scaleMode,G=r.width,U=r.height,H=r.wrapMode,$=r.format,V=r.type,Y=r.target,X=r.resolution,z=r.resourceOptions;return t&&!(t instanceof Resource)&&(t=autoDetectResource(t,z),t.internal=!0),o.resolution=X||settings.RESOLUTION,o.width=Math.round((G||0)*o.resolution)/o.resolution,o.height=Math.round((U||0)*o.resolution)/o.resolution,o._mipmap=N!==void 0?N:settings.MIPMAP_TEXTURES,o.anisotropicLevel=k!==void 0?k:settings.ANISOTROPIC_LEVEL,o._wrapMode=H||settings.WRAP_MODE,o._scaleMode=B!==void 0?B:settings.SCALE_MODE,o.format=$||FORMATS.RGBA,o.type=V||TYPES.UNSIGNED_BYTE,o.target=Y||TARGETS.TEXTURE_2D,o.alphaMode=D!==void 0?D:ALPHA_MODES.UNPACK,o.uid=uid(),o.touched=0,o.isPowerOfTwo=!1,o._refreshPOT(),o._glTextures={},o.dirtyId=0,o.dirtyStyleId=0,o.cacheId=null,o.valid=G>0&&U>0,o.textureCacheIds=[],o.destroyed=!1,o.resource=null,o._batchEnabled=0,o._batchLocation=0,o.parentTextureArray=null,o.setResource(t),o}return Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,r){var o;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,o=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,o=!0),o&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,r,o){return o=o||this.resolution,this.setRealSize(t*o,r*o,o)},e.prototype.setRealSize=function(t,r,o){return this.resolution=o||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(r)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},e.prototype.setResolution=function(t){var r=this.resolution;return r===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*r)/t,this.height=Math.round(this.height*r)/t,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,r,o){o===void 0&&(o=settings.STRICT_TEXTURE_CACHE);var D=typeof t=="string",N=null;if(D)N=t;else{if(!t._pixiId){var k=r&&r.pixiIdPrefix||"pixiid";t._pixiId=k+"_"+uid()}N=t._pixiId}var B=BaseTextureCache[N];if(D&&o&&!B)throw new Error('The cacheId "'+N+'" does not exist in BaseTextureCache.');return B||(B=new e(t,r),B.cacheId=N,e.addToCache(B,N)),B},e.fromBuffer=function(t,r,o,D){t=t||new Float32Array(r*o*4);var N=new BufferResource(t,{width:r,height:o}),k=t instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new e(N,Object.assign({},defaultBufferOptions,D||{width:r,height:o,type:k}))},e.addToCache=function(t,r){r&&(t.textureCacheIds.indexOf(r)===-1&&t.textureCacheIds.push(r),BaseTextureCache[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),BaseTextureCache[r]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var r=BaseTextureCache[t];if(r){var o=r.textureCacheIds.indexOf(t);return o>-1&&r.textureCacheIds.splice(o,1),delete BaseTextureCache[t],r}}else if(t&&t.textureCacheIds){for(var D=0;D<t.textureCacheIds.length;++D)delete BaseTextureCache[t.textureCacheIds[D]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(i),AbstractMultiResource=function(n){__extends$i(e,n);function e(t,r){var o=this,D=r||{},N=D.width,k=D.height;o=n.call(this,N,k)||this,o.items=[],o.itemDirtyIds=[];for(var B=0;B<t;B++){var G=new BaseTexture;o.items.push(G),o.itemDirtyIds.push(-2)}return o.length=t,o._load=null,o.baseTexture=null,o}return e.prototype.initFromArray=function(t,r){for(var o=0;o<this.length;o++)t[o]&&(t[o].castToBaseTexture?this.addBaseTextureAt(t[o].castToBaseTexture(),o):t[o]instanceof Resource?this.addResourceAt(t[o],o):this.addResourceAt(autoDetectResource(t[o],r),o))},e.prototype.dispose=function(){for(var t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this},e.prototype.bind=function(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");n.prototype.bind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)},e.prototype.unbind=function(t){n.prototype.unbind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.items.map(function(D){return D.resource}).filter(function(D){return D}),o=r.map(function(D){return D.load()});return this._load=Promise.all(o).then(function(){var D=t.items[0],N=D.realWidth,k=D.realHeight;return t.resize(N,k),Promise.resolve(t)}),this._load},e}(Resource),ArrayResource=function(n){__extends$i(e,n);function e(t,r){var o=this,D=r||{},N=D.width,k=D.height,B,G;return Array.isArray(t)?(B=t,G=t.length):G=t,o=n.call(this,G,{width:N,height:k})||this,B&&o.initFromArray(B,r),o}return e.prototype.addBaseTextureAt=function(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},e.prototype.bind=function(t){n.prototype.bind.call(this,t),t.target=TARGETS.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,r,o){var D=this,N=D.length,k=D.itemDirtyIds,B=D.items,G=t.gl;o.dirtyId<0&&G.texImage3D(G.TEXTURE_2D_ARRAY,0,o.internalFormat,this._width,this._height,N,0,r.format,o.type,null);for(var U=0;U<N;U++){var H=B[U];k[U]<H.dirtyId&&(k[U]=H.dirtyId,H.valid&&G.texSubImage3D(G.TEXTURE_2D_ARRAY,0,0,0,U,H.resource.width,H.resource.height,1,r.format,o.type,H.resource.source))}return!0},e}(AbstractMultiResource),BaseImageResource=function(n){__extends$i(e,n);function e(t){var r=this,o=t,D=o.naturalWidth||o.videoWidth||o.width,N=o.naturalHeight||o.videoHeight||o.height;return r=n.call(this,D,N)||this,r.source=t,r.noSubImage=!1,r}return e.crossOrigin=function(t,r,o){o===void 0&&r.indexOf("data:")!==0?t.crossOrigin=determineCrossOrigin(r):o!==!1&&(t.crossOrigin=typeof o=="string"?o:"anonymous")},e.prototype.upload=function(t,r,o,D){var N=t.gl,k=r.realWidth,B=r.realHeight;if(D=D||this.source,D instanceof HTMLImageElement){if(!D.complete||D.naturalWidth===0)return!1}else if(D instanceof HTMLVideoElement&&D.readyState<=1)return!1;return N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&r.target===N.TEXTURE_2D&&o.width===k&&o.height===B?N.texSubImage2D(N.TEXTURE_2D,0,0,0,r.format,o.type,D):(o.width=k,o.height=B,N.texImage2D(r.target,0,o.internalFormat,r.format,o.type,D)),!0},e.prototype.update=function(){if(!this.destroyed){var t=this.source,r=t.naturalWidth||t.videoWidth||t.width,o=t.naturalHeight||t.videoHeight||t.height;this.resize(r,o),n.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(Resource),CanvasResource=function(n){__extends$i(e,n);function e(t){return n.call(this,t)||this}return e.test=function(t){var r=globalThis.OffscreenCanvas;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(BaseImageResource),CubeResource=function(n){__extends$i(e,n);function e(t,r){var o=this,D=r||{},N=D.width,k=D.height,B=D.autoLoad,G=D.linkBaseTexture;if(t&&t.length!==e.SIDES)throw new Error("Invalid length. Got "+t.length+", expected 6");o=n.call(this,6,{width:N,height:k})||this;for(var U=0;U<e.SIDES;U++)o.items[U].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+U;return o.linkBaseTexture=G!==!1,t&&o.initFromArray(t,r),B!==!1&&o.load(),o}return e.prototype.bind=function(t){n.prototype.bind.call(this,t),t.target=TARGETS.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,r,o){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+r,t.parentTextureArray=this.baseTexture,this.items[r]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[r]=t,this},e.prototype.upload=function(t,r,o){for(var D=this.itemDirtyIds,N=0;N<e.SIDES;N++){var k=this.items[N];(D[N]<k.dirtyId||o.dirtyId<r.dirtyId)&&(k.valid&&k.resource?(k.resource.upload(t,k,o),D[N]=k.dirtyId):D[N]<-1&&(t.gl.texImage2D(k.target,0,o.internalFormat,r.realWidth,r.realHeight,0,r.format,o.type,null),D[N]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(AbstractMultiResource),ImageResource=function(n){__extends$i(e,n);function e(t,r){var o=this;if(r=r||{},!(t instanceof HTMLImageElement)){var D=new Image;BaseImageResource.crossOrigin(D,t,r.crossorigin),D.src=t,t=D}return o=n.call(this,t)||this,!t.complete&&o._width&&o._height&&(o._width=0,o._height=0),o.url=t.src,o._process=null,o.preserveBitmap=!1,o.createBitmap=(r.createBitmap!==void 0?r.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,o.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,o.bitmap=null,o._load=null,r.autoLoad!==!1&&o.load(),o}return e.prototype.load=function(t){var r=this;return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise(function(o,D){var N=r.source;r.url=N.src;var k=function(){r.destroyed||(N.onload=null,N.onerror=null,r.resize(N.width,N.height),r._load=null,r.createBitmap?o(r.process()):o(r))};N.complete&&N.src?k():(N.onload=k,N.onerror=function(B){D(B),r.onError.emit(B)})}),this._load)},e.prototype.process=function(){var t=this,r=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var o=globalThis.createImageBitmap,D=!r.crossOrigin||r.crossOrigin==="anonymous";return this._process=fetch(r.src,{mode:D?"cors":"no-cors"}).then(function(N){return N.blob()}).then(function(N){return o(N,0,0,r.width,r.height,{premultiplyAlpha:t.alphaMode===null||t.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})}).then(function(N){return t.destroyed?Promise.reject():(t.bitmap=N,t.update(),t._process=null,Promise.resolve(t))}),this._process},e.prototype.upload=function(t,r,o){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return n.prototype.upload.call(this,t,r,o);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(n.prototype.upload.call(this,t,r,o,this.bitmap),!this.preserveBitmap){var D=!0,N=r._glTextures;for(var k in N){var B=N[k];if(B!==o&&B.dirtyId!==r.dirtyId){D=!1;break}}D&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,n.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return typeof t=="string"||t instanceof HTMLImageElement},e}(BaseImageResource),SVGResource=function(n){__extends$i(e,n);function e(t,r){var o=this;return r=r||{},o=n.call(this,settings.ADAPTER.createCanvas())||this,o._width=0,o._height=0,o.svg=t,o.scale=r.scale||1,o._overrideWidth=r.width,o._overrideHeight=r.height,o._resolve=null,o._crossorigin=r.crossorigin,o._load=null,r.autoLoad!==!1&&o.load(),o}return e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(r){if(t._resolve=function(){t.resize(t.source.width,t.source.height),r(t)},e.SVG_XML.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var t=this,r=new Image;BaseImageResource.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(o){t._resolve&&(r.onerror=null,t.onError.emit(o))},r.onload=function(){if(t._resolve){var o=r.width,D=r.height;if(!o||!D)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var N=o*t.scale,k=D*t.scale;(t._overrideWidth||t._overrideHeight)&&(N=t._overrideWidth||t._overrideHeight/D*o,k=t._overrideHeight||t._overrideWidth/o*D),N=Math.round(N),k=Math.round(k);var B=t.source;B.width=N,B.height=k,B._pixiId="canvas_"+uid(),B.getContext("2d").drawImage(r,0,0,o,D,0,0,N,k),t._resolve(),t._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),o={};return r&&(o[r[1]]=Math.round(parseFloat(r[3])),o[r[5]]=Math.round(parseFloat(r[7]))),o},e.prototype.dispose=function(){n.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,r){return r==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&e.SVG_XML.test(t)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(BaseImageResource),VideoResource=function(n){__extends$i(e,n);function e(t,r){var o=this;if(r=r||{},!(t instanceof HTMLVideoElement)){var D=document.createElement("video");D.setAttribute("preload","auto"),D.setAttribute("webkit-playsinline",""),D.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);var N=t[0].src||t[0];BaseImageResource.crossOrigin(D,N,r.crossorigin);for(var k=0;k<t.length;++k){var B=document.createElement("source"),G=t[k],U=G.src,H=G.mime;U=U||t[k];var $=U.split("?").shift().toLowerCase(),V=$.slice($.lastIndexOf(".")+1);H=H||e.MIME_TYPES[V]||"video/"+V,B.src=U,B.type=H,D.appendChild(B)}t=D}return o=n.call(this,t)||this,o.noSubImage=!0,o._autoUpdate=!0,o._isConnectedToTicker=!1,o._updateFPS=r.updateFPS||0,o._msToNextUpdate=0,o.autoPlay=r.autoPlay!==!1,o._load=null,o._resolve=null,o._onCanPlay=o._onCanPlay.bind(o),o._onError=o._onError.bind(o),r.autoLoad!==!1&&o.load(),o}return e.prototype.update=function(t){if(!this.destroyed){var r=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(n.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(o){t.valid?o(t):(t._resolve=o,r.load())}),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()},e.prototype._isSourceReady=function(){var t=this.source;return t.readyState>2},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(t.videoWidth,t.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);var t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),n.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,r){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(BaseImageResource),ImageBitmapResource=function(n){__extends$i(e,n);function e(t){return n.call(this,t)||this}return e.test=function(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&t instanceof ImageBitmap},e}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var DepthResource=function(n){__extends$i(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.upload=function(t,r,o){var D=t.gl;D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ALPHA_MODES.UNPACK);var N=r.realWidth,k=r.realHeight;return o.width===N&&o.height===k?D.texSubImage2D(r.target,0,0,0,N,k,r.format,o.type,this.data):(o.width=N,o.height=k,D.texImage2D(r.target,0,o.internalFormat,N,k,0,r.format,o.type,this.data)),!0},e}(BufferResource),Framebuffer=function(){function n(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}return Object.defineProperty(n.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),n.prototype.addColorTexture=function(e,t){return e===void 0&&(e=0),this.colorTextures[e]=t||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},n.prototype.addDepthTexture=function(e){return this.depthTexture=e||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},n.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},n.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},n.prototype.resize=function(e,t){if(e=Math.round(e),t=Math.round(t),!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var o=this.colorTextures[r],D=o.resolution;o.setSize(e/D,t/D)}if(this.depthTexture){var D=this.depthTexture.resolution;this.depthTexture.setSize(e/D,t/D)}}},n.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},n.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},n}(),BaseRenderTexture=function(n){__extends$i(e,n);function e(t){t===void 0&&(t={});var r=this;if(typeof t=="number"){var o=arguments[0],D=arguments[1],N=arguments[2],k=arguments[3];t={width:o,height:D,scaleMode:N,resolution:k}}return t.width=t.width||100,t.height=t.height||100,t.multisample=t.multisample!==void 0?t.multisample:MSAA_QUALITY.NONE,r=n.call(this,null,t)||this,r.mipmap=MIPMAP_MODES.OFF,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new Framebuffer(r.realWidth,r.realHeight).addColorTexture(0,r),r.framebuffer.multisample=t.multisample,r.maskStack=[],r.filterStack=[{}],r}return e.prototype.resize=function(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),n.prototype.dispose.call(this)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(BaseTexture),TextureUvs=function(){function n(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return n.prototype.set=function(e,t,r){var o=t.width,D=t.height;if(r){var N=e.width/2/o,k=e.height/2/D,B=e.x/o+N,G=e.y/D+k;r=groupD8.add(r,groupD8.NW),this.x0=B+N*groupD8.uX(r),this.y0=G+k*groupD8.uY(r),r=groupD8.add(r,2),this.x1=B+N*groupD8.uX(r),this.y1=G+k*groupD8.uY(r),r=groupD8.add(r,2),this.x2=B+N*groupD8.uX(r),this.y2=G+k*groupD8.uY(r),r=groupD8.add(r,2),this.x3=B+N*groupD8.uX(r),this.y3=G+k*groupD8.uY(r)}else this.x0=e.x/o,this.y0=e.y/D,this.x1=(e.x+e.width)/o,this.y1=e.y/D,this.x2=(e.x+e.width)/o,this.y2=(e.y+e.height)/D,this.x3=e.x/o,this.y3=(e.y+e.height)/D;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},n.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},n}(),DEFAULT_UVS=new TextureUvs;function removeAllHandlers(n){n.destroy=function(){},n.on=function(){},n.once=function(){},n.emit=function(){}}var Texture=function(n){__extends$i(e,n);function e(t,r,o,D,N,k){var B=n.call(this)||this;if(B.noFrame=!1,r||(B.noFrame=!0,r=new Rectangle(0,0,1,1)),t instanceof e&&(t=t.baseTexture),B.baseTexture=t,B._frame=r,B.trim=D,B.valid=!1,B._uvs=DEFAULT_UVS,B.uvMatrix=null,B.orig=o||r,B._rotate=Number(N||0),N===!0)B._rotate=2;else if(B._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return B.defaultAnchor=k?new Point(k.x,k.y):new Point(0,0),B._updateID=0,B.textureCacheIds=[],t.valid?B.noFrame?t.valid&&B.onBaseTextureUpdated(t):B.frame=r:t.once("loaded",B.onBaseTextureUpdated,B),B.noFrame&&t.on("update",B.onBaseTextureUpdated,B),B}return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture.resource;r&&r.url&&TextureCache[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),o=new e(this.baseTexture,!this.noFrame&&t,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(o._frame=t),o},e.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,o){r===void 0&&(r={}),o===void 0&&(o=settings.STRICT_TEXTURE_CACHE);var D=typeof t=="string",N=null;if(D)N=t;else if(t instanceof BaseTexture){if(!t.cacheId){var k=r&&r.pixiIdPrefix||"pixiid";t.cacheId=k+"-"+uid(),BaseTexture.addToCache(t,t.cacheId)}N=t.cacheId}else{if(!t._pixiId){var k=r&&r.pixiIdPrefix||"pixiid";t._pixiId=k+"_"+uid()}N=t._pixiId}var B=TextureCache[N];if(D&&o&&!B)throw new Error('The cacheId "'+N+'" does not exist in TextureCache.');return!B&&!(t instanceof BaseTexture)?(r.resolution||(r.resolution=getResolutionOfUrl(t)),B=new e(new BaseTexture(t,r)),B.baseTexture.cacheId=N,BaseTexture.addToCache(B.baseTexture,N),e.addToCache(B,N)):!B&&t instanceof BaseTexture&&(B=new e(t),e.addToCache(B,N)),B},e.fromURL=function(t,r){var o=Object.assign({autoLoad:!1},r?.resourceOptions),D=e.from(t,Object.assign({resourceOptions:o},r),!1),N=D.baseTexture.resource;return D.baseTexture.valid?Promise.resolve(D):N.load().then(function(){return Promise.resolve(D)})},e.fromBuffer=function(t,r,o,D){return new e(BaseTexture.fromBuffer(t,r,o,D))},e.fromLoader=function(t,r,o,D){var N=new BaseTexture(t,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(r)},D)),k=N.resource;k instanceof ImageResource&&(k.url=r);var B=new e(N);return o||(o=r),BaseTexture.addToCache(B.baseTexture,o),e.addToCache(B,o),o!==r&&(BaseTexture.addToCache(B.baseTexture,r),e.addToCache(B,r)),B.baseTexture.valid?Promise.resolve(B):new Promise(function(G){B.baseTexture.once("loaded",function(){return G(B)})})},e.addToCache=function(t,r){r&&(t.textureCacheIds.indexOf(r)===-1&&t.textureCacheIds.push(r),TextureCache[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),TextureCache[r]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var r=TextureCache[t];if(r){var o=r.textureCacheIds.indexOf(t);return o>-1&&r.textureCacheIds.splice(o,1),delete TextureCache[t],r}}else if(t&&t.textureCacheIds){for(var D=0;D<t.textureCacheIds.length;++D)TextureCache[t.textureCacheIds[D]]===t&&delete TextureCache[t.textureCacheIds[D]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var r=t.x,o=t.y,D=t.width,N=t.height,k=r+D>this.baseTexture.width,B=o+N>this.baseTexture.height;if(k||B){var G=k&&B?"and":"or",U="X: "+r+" + "+D+" = "+(r+D)+" > "+this.baseTexture.width,H="Y: "+o+" + "+N+" = "+(o+N)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(U+" "+G+" "+H))}this.valid=D&&N&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(e,"EMPTY",{get:function(){return e._EMPTY||(e._EMPTY=new e(new BaseTexture),removeAllHandlers(e._EMPTY),removeAllHandlers(e._EMPTY.baseTexture)),e._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WHITE",{get:function(){if(!e._WHITE){var t=settings.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),e._WHITE=new e(BaseTexture.from(t)),removeAllHandlers(e._WHITE),removeAllHandlers(e._WHITE.baseTexture)}return e._WHITE},enumerable:!1,configurable:!0}),e}(i),RenderTexture=function(n){__extends$i(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.valid=!0,o.filterFrame=null,o.filterPoolKey=null,o.updateUvs(),o}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,r,o){o===void 0&&(o=!0);var D=this.baseTexture.resolution,N=Math.round(t*D)/D,k=Math.round(r*D)/D;this.valid=N>0&&k>0,this._frame.width=this.orig.width=N,this._frame.height=this.orig.height=k,o&&this.baseTexture.resize(N,k),this.updateUvs()},e.prototype.setResolution=function(t){var r=this.baseTexture;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))},e.create=function(t){for(var r=arguments,o=[],D=1;D<arguments.length;D++)o[D-1]=r[D];return typeof t=="number"&&(deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:o[0],scaleMode:o[1],resolution:o[2]}),new e(new BaseRenderTexture(t))},e}(Texture),RenderTexturePool=function(){function n(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return n.prototype.createTexture=function(e,t,r){r===void 0&&(r=MSAA_QUALITY.NONE);var o=new BaseRenderTexture(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new RenderTexture(o)},n.prototype.getOptimalTexture=function(e,t,r,o){r===void 0&&(r=1),o===void 0&&(o=MSAA_QUALITY.NONE);var D;e=Math.ceil(e*r-1e-6),t=Math.ceil(t*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=nextPow2(e),t=nextPow2(t),D=((e&65535)<<16|t&65535)>>>0,o>1&&(D+=o*4294967296)):D=o>1?-o:-1,this.texturePool[D]||(this.texturePool[D]=[]);var N=this.texturePool[D].pop();return N||(N=this.createTexture(e,t,o)),N.filterPoolKey=D,N.setResolution(r),N},n.prototype.getFilterTexture=function(e,t,r){var o=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||MSAA_QUALITY.NONE);return o.filterFrame=e.filterFrame,o},n.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},n.prototype.returnFilterTexture=function(e){this.returnTexture(e)},n.prototype.clear=function(e){if(e=e!==!1,e)for(var t in this.texturePool){var r=this.texturePool[t];if(r)for(var o=0;o<r.length;o++)r[o].destroy(!0)}this.texturePool={}},n.prototype.setScreenSize=function(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(var t in this.texturePool)if(Number(t)<0){var r=this.texturePool[t];if(r)for(var o=0;o<r.length;o++)r[o].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}},n.SCREEN_KEY=-1,n}(),Attribute=function(){function n(e,t,r,o,D,N,k){t===void 0&&(t=0),r===void 0&&(r=!1),o===void 0&&(o=TYPES.FLOAT),this.buffer=e,this.size=t,this.normalized=r,this.type=o,this.stride=D,this.start=N,this.instance=k}return n.prototype.destroy=function(){this.buffer=null},n.from=function(e,t,r,o,D){return new n(e,t,r,o,D)},n}(),UID$4=0,Buffer=function(){function n(e,t,r){t===void 0&&(t=!0),r===void 0&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}return n.prototype.update=function(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++},n.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},n.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(n.prototype,"index",{get:function(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),n.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new n(e)},n}(),map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(n,e){for(var t=0,r=0,o={},D=0;D<n.length;D++)r+=e[D],t+=n[D].length;for(var N=new ArrayBuffer(t*4),k=null,B=0,D=0;D<n.length;D++){var G=e[D],U=n[D],H=getBufferType(U);o[H]||(o[H]=new map$1[H](N)),k=o[H];for(var $=0;$<U.length;$++){var V=($/G|0)*r+B,Y=$%G;k[V+Y]=U[$]}B+=G}return new Float32Array(N)}var byteSizeMap$1={5126:4,5123:2,5121:1},UID$3=0,map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Geometry=function(){function n(e,t){e===void 0&&(e=[]),t===void 0&&(t={}),this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}return n.prototype.addAttribute=function(e,t,r,o,D,N,k,B){if(r===void 0&&(r=0),o===void 0&&(o=!1),B===void 0&&(B=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Buffer||(t instanceof Array&&(t=new Float32Array(t)),t=new Buffer(t));var G=e.split("|");if(G.length>1){for(var U=0;U<G.length;U++)this.addAttribute(G[U],t,r,o,D);return this}var H=this.buffers.indexOf(t);return H===-1&&(this.buffers.push(t),H=this.buffers.length-1),this.attributes[e]=new Attribute(H,r,o,D,N,k,B),this.instanced=this.instanced||B,this},n.prototype.getAttribute=function(e){return this.attributes[e]},n.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},n.prototype.addIndex=function(e){return e instanceof Buffer||(e instanceof Array&&(e=new Uint16Array(e)),e=new Buffer(e)),e.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.indexOf(e)===-1&&this.buffers.push(e),this},n.prototype.getIndex=function(){return this.indexBuffer},n.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var e=[],t=[],r=new Buffer,o;for(o in this.attributes){var D=this.attributes[o],N=this.buffers[D.buffer];e.push(N.data),t.push(D.size*byteSizeMap$1[D.type]/4),D.buffer=0}for(r.data=interleaveTypedArrays(e,t),o=0;o<this.buffers.length;o++)this.buffers[o]!==this.indexBuffer&&this.buffers[o].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},n.prototype.getSize=function(){for(var e in this.attributes){var t=this.attributes[e],r=this.buffers[t.buffer];return r.data.length/(t.stride/4||t.size)}return 0},n.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},n.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},n.prototype.clone=function(){for(var e=new n,t=0;t<this.buffers.length;t++)e.buffers[t]=new Buffer(this.buffers[t].data.slice(0));for(var t in this.attributes){var r=this.attributes[t];e.attributes[t]=new Attribute(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),e},n.merge=function(e){for(var t=new n,r=[],o=[],D=[],N,k=0;k<e.length;k++){N=e[k];for(var B=0;B<N.buffers.length;B++)o[B]=o[B]||0,o[B]+=N.buffers[B].data.length,D[B]=0}for(var k=0;k<N.buffers.length;k++)r[k]=new map[getBufferType(N.buffers[k].data)](o[k]),t.buffers[k]=new Buffer(r[k]);for(var k=0;k<e.length;k++){N=e[k];for(var B=0;B<N.buffers.length;B++)r[B].set(N.buffers[B].data,D[B]),D[B]+=N.buffers[B].data.length}if(t.attributes=N.attributes,N.indexBuffer){t.indexBuffer=t.buffers[N.buffers.indexOf(N.indexBuffer)],t.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;for(var G=0,U=0,H=0,$=0,k=0;k<N.buffers.length;k++)if(N.buffers[k]!==N.indexBuffer){$=k;break}for(var k in N.attributes){var V=N.attributes[k];(V.buffer|0)===$&&(U+=V.size*byteSizeMap$1[V.type]/4)}for(var k=0;k<e.length;k++){for(var Y=e[k].indexBuffer.data,B=0;B<Y.length;B++)t.indexBuffer.data[B+H]+=G;G+=e[k].buffers[$].data.length/U,H+=Y.length}}return t},n}(),Quad=function(n){__extends$i(e,n);function e(){var t=n.call(this)||this;return t.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),t}return e}(Geometry),QuadUv=function(n){__extends$i(e,n);function e(){var t=n.call(this)||this;return t.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.vertexBuffer=new Buffer(t.vertices),t.uvBuffer=new Buffer(t.uvs),t.addAttribute("aVertexPosition",t.vertexBuffer).addAttribute("aTextureCoord",t.uvBuffer).addIndex([0,1,2,0,2,3]),t}return e.prototype.map=function(t,r){var o=0,D=0;return this.uvs[0]=o,this.uvs[1]=D,this.uvs[2]=o+r.width/t.width,this.uvs[3]=D,this.uvs[4]=o+r.width/t.width,this.uvs[5]=D+r.height/t.height,this.uvs[6]=o,this.uvs[7]=D+r.height/t.height,o=r.x,D=r.y,this.vertices[0]=o,this.vertices[1]=D,this.vertices[2]=o+r.width,this.vertices[3]=D,this.vertices[4]=o+r.width,this.vertices[5]=D+r.height,this.vertices[6]=o,this.vertices[7]=D+r.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(Geometry),UID$2=0,UniformGroup=function(){function n(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!t,this.ubo=!!r,e instanceof Buffer?(this.buffer=e,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Buffer(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}return n.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},n.prototype.add=function(e,t,r){if(!this.ubo)this.uniforms[e]=new n(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},n.from=function(e,t,r){return new n(e,t,r)},n.uboFrom=function(e,t){return new n(e,t??!0,!0)},n}(),FilterState=function(){function n(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}return n.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},n}(),tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$2=new Matrix,FilterSystem=function(){function n(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return n.prototype.push=function(e,t){for(var r,o,D=this.renderer,N=this.defaultFilterStack,k=this.statePool.pop()||new FilterState,B=this.renderer.renderTexture,G=t[0].resolution,U=t[0].multisample,H=t[0].padding,$=t[0].autoFit,V=(r=t[0].legacy)!==null&&r!==void 0?r:!0,Y=1;Y<t.length;Y++){var X=t[Y];G=Math.min(G,X.resolution),U=Math.min(U,X.multisample),H=this.useMaxPadding?Math.max(H,X.padding):H+X.padding,$=$&&X.autoFit,V=V||((o=X.legacy)!==null&&o!==void 0?o:!0)}N.length===1&&(this.defaultFilterStack[0].renderTexture=B.current),N.push(k),k.resolution=G,k.multisample=U,k.legacy=V,k.target=e,k.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),k.sourceFrame.pad(H);var z=this.tempRect.copyFrom(B.sourceFrame);D.projection.transform&&this.transformAABB(tempMatrix$2.copyFrom(D.projection.transform).invert(),z),$?(k.sourceFrame.fit(z),(k.sourceFrame.width<=0||k.sourceFrame.height<=0)&&(k.sourceFrame.width=0,k.sourceFrame.height=0)):k.sourceFrame.intersects(z)||(k.sourceFrame.width=0,k.sourceFrame.height=0),this.roundFrame(k.sourceFrame,B.current?B.current.resolution:D.resolution,B.sourceFrame,B.destinationFrame,D.projection.transform),k.renderTexture=this.getOptimalFilterTexture(k.sourceFrame.width,k.sourceFrame.height,G,U),k.filters=t,k.destinationFrame.width=k.renderTexture.width,k.destinationFrame.height=k.renderTexture.height;var W=this.tempRect;W.x=0,W.y=0,W.width=k.sourceFrame.width,W.height=k.sourceFrame.height,k.renderTexture.filterFrame=k.sourceFrame,k.bindingSourceFrame.copyFrom(B.sourceFrame),k.bindingDestinationFrame.copyFrom(B.destinationFrame),k.transform=D.projection.transform,D.projection.transform=null,B.bind(k.renderTexture,k.sourceFrame,W),D.framebuffer.clear(0,0,0,0)},n.prototype.pop=function(){var e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;var o=this.globalUniforms.uniforms;o.outputFrame=t.sourceFrame,o.resolution=t.resolution;var D=o.inputSize,N=o.inputPixel,k=o.inputClamp;if(D[0]=t.destinationFrame.width,D[1]=t.destinationFrame.height,D[2]=1/D[0],D[3]=1/D[1],N[0]=Math.round(D[0]*t.resolution),N[1]=Math.round(D[1]*t.resolution),N[2]=1/N[0],N[3]=1/N[1],k[0]=.5*N[2],k[1]=.5*N[3],k[2]=t.sourceFrame.width*D[2]-.5*N[2],k[3]=t.sourceFrame.height*D[3]-.5*N[3],t.legacy){var B=o.filterArea;B[0]=t.destinationFrame.width,B[1]=t.destinationFrame.height,B[2]=t.sourceFrame.x,B[3]=t.sourceFrame.y,o.filterClamp=o.inputClamp}this.globalUniforms.update();var G=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,G.renderTexture,CLEAR_MODES.BLEND,t),this.returnFilterTexture(t.renderTexture);else{var U=t.renderTexture,H=this.getOptimalFilterTexture(U.width,U.height,t.resolution);H.filterFrame=U.filterFrame;var $=0;for($=0;$<r.length-1;++$){$===1&&t.multisample>1&&(H=this.getOptimalFilterTexture(U.width,U.height,t.resolution),H.filterFrame=U.filterFrame),r[$].apply(this,U,H,CLEAR_MODES.CLEAR,t);var V=U;U=H,H=V}r[$].apply(this,U,G.renderTexture,CLEAR_MODES.BLEND,t),$>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(U),this.returnFilterTexture(H)}t.clear(),this.statePool.push(t)},n.prototype.bindAndClear=function(e,t){t===void 0&&(t=CLEAR_MODES.CLEAR);var r=this.renderer,o=r.renderTexture,D=r.state;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame){var N=this.tempRect;N.x=0,N.y=0,N.width=e.filterFrame.width,N.height=e.filterFrame.height,o.bind(e,e.filterFrame,N)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?o.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var k=D.stateId&1||this.forceClear;(t===CLEAR_MODES.CLEAR||t===CLEAR_MODES.BLIT&&k)&&this.renderer.framebuffer.clear(0,0,0,0)},n.prototype.applyFilter=function(e,t,r,o){var D=this.renderer;D.state.set(e.state),this.bindAndClear(r,o),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,D.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),D.geometry.bind(this.quadUv),D.geometry.draw(DRAW_MODES.TRIANGLES)):(D.geometry.bind(this.quad),D.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))},n.prototype.calculateSpriteMatrix=function(e,t){var r=this.activeState,o=r.sourceFrame,D=r.destinationFrame,N=t._texture.orig,k=e.set(D.width,0,0,D.height,o.x,o.y),B=t.worldTransform.copyTo(Matrix.TEMP_MATRIX);return B.invert(),k.prepend(B),k.scale(1/N.width,1/N.height),k.translate(t.anchor.x,t.anchor.y),k},n.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},n.prototype.getOptimalFilterTexture=function(e,t,r,o){return r===void 0&&(r=1),o===void 0&&(o=MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(e,t,r,o)},n.prototype.getFilterTexture=function(e,t,r){if(typeof e=="number"){var o=e;e=t,t=o}e=e||this.activeState.renderTexture;var D=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||MSAA_QUALITY.NONE);return D.filterFrame=e.filterFrame,D},n.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},n.prototype.emptyPool=function(){this.texturePool.clear(!0)},n.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},n.prototype.transformAABB=function(e,t){var r=tempPoints[0],o=tempPoints[1],D=tempPoints[2],N=tempPoints[3];r.set(t.left,t.top),o.set(t.left,t.bottom),D.set(t.right,t.top),N.set(t.right,t.bottom),e.apply(r,r),e.apply(o,o),e.apply(D,D),e.apply(N,N);var k=Math.min(r.x,o.x,D.x,N.x),B=Math.min(r.y,o.y,D.y,N.y),G=Math.max(r.x,o.x,D.x,N.x),U=Math.max(r.y,o.y,D.y,N.y);t.x=k,t.y=B,t.width=G-k,t.height=U-B},n.prototype.roundFrame=function(e,t,r,o,D){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(D){var N=D.a,k=D.b,B=D.c,G=D.d;if((Math.abs(k)>1e-4||Math.abs(B)>1e-4)&&(Math.abs(N)>1e-4||Math.abs(G)>1e-4))return}D=D?tempMatrix$2.copyFrom(D):tempMatrix$2.identity(),D.translate(-r.x,-r.y).scale(o.width/r.width,o.height/r.height).translate(o.x,o.y),this.transformAABB(D,e),e.ceil(t),this.transformAABB(D.invert(),e)}},n}(),ObjectRenderer=function(){function n(e){this.renderer=e}return n.prototype.flush=function(){},n.prototype.destroy=function(){this.renderer=null},n.prototype.start=function(){},n.prototype.stop=function(){this.flush()},n.prototype.render=function(e){},n}(),BatchSystem=function(){function n(e){this.renderer=e,this.emptyRenderer=new ObjectRenderer(e),this.currentRenderer=this.emptyRenderer}return n.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},n.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},n.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},n.prototype.copyBoundTextures=function(e,t){for(var r=this.renderer.texture.boundTextures,o=t-1;o>=0;--o)e[o]=r[o]||null,e[o]&&(e[o]._batchLocation=o)},n.prototype.boundArray=function(e,t,r,o){for(var D=e.elements,N=e.ids,k=e.count,B=0,G=0;G<k;G++){var U=D[G],H=U._batchLocation;if(H>=0&&H<o&&t[H]===U){N[G]=H;continue}for(;B<o;){var $=t[B];if($&&$._batchEnabled===r&&$._batchLocation===B){B++;continue}N[G]=B,U._batchLocation=B,t[B]=U;break}}},n.prototype.destroy=function(){this.renderer=null},n}(),CONTEXT_UID_COUNTER=0,ContextSystem=function(){function n(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(n.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),n.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++},n.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(e)},n.prototype.initFromOptions=function(e){var t=this.createContext(this.renderer.view,e);this.initFromContext(t)},n.prototype.createContext=function(e,t){var r;if(settings.PREFER_ENV>=ENV.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},n.prototype.getExtensions=function(){var e=this.gl,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})},n.prototype.handleContextLost=function(e){var t=this;e.preventDefault(),setTimeout(function(){t.gl.isContextLost()&&t.extensions.loseContext&&t.extensions.loseContext.restoreContext()},0)},n.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},n.prototype.destroy=function(){var e=this.renderer.view;this.renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},n.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},n.prototype.validateContext=function(e){var t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var o=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=o,o||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},n}(),GLFramebuffer=function(){function n(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return n}(),tempRectangle=new Rectangle,FramebufferSystem=function(){function n(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}return n.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=function(o){return t.drawBuffersWEBGL(o)}:(this.hasMRT=!1,e.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},n.prototype.bind=function(e,t,r){r===void 0&&(r=0);var o=this.gl;if(e){var D=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,o.bindFramebuffer(o.FRAMEBUFFER,D.framebuffer)),D.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,D.mipLevel=r),D.dirtyId!==e.dirtyId&&(D.dirtyId=e.dirtyId,D.dirtyFormat!==e.dirtyFormat?(D.dirtyFormat=e.dirtyFormat,D.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):D.dirtySize!==e.dirtySize&&(D.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var N=0;N<e.colorTextures.length;N++){var k=e.colorTextures[N];this.renderer.texture.unbind(k.parentTextureArray||k)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){var B=t.width>>r,G=t.height>>r,U=B/t.width;this.setViewport(t.x*U,t.y*U,B,G)}else{var B=e.width>>r,G=e.height>>r;this.setViewport(0,0,B,G)}}else this.current&&(this.current=null,o.bindFramebuffer(o.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},n.prototype.setViewport=function(e,t,r,o){var D=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),o=Math.round(o),(D.width!==r||D.height!==o||D.x!==e||D.y!==t)&&(D.x=e,D.y=t,D.width=r,D.height=o,this.gl.viewport(e,t,r,o))},Object.defineProperty(n.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),n.prototype.clear=function(e,t,r,o,D){D===void 0&&(D=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH);var N=this.gl;N.clearColor(e,t,r,o),N.clear(D)},n.prototype.initFramebuffer=function(e){var t=this.gl,r=new GLFramebuffer(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r},n.prototype.resizeFramebuffer=function(e){var t=this.gl,r=e.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.RGBA8,e.width,e.height)),r.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));var o=e.colorTextures,D=o.length;t.drawBuffers||(D=Math.min(D,1));for(var N=0;N<D;N++){var k=o[N],B=k.parentTextureArray||k;this.renderer.texture.bind(B,0)}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)},n.prototype.updateFramebuffer=function(e,t){var r=this.gl,o=e.glFramebuffers[this.CONTEXT_UID],D=e.colorTextures,N=D.length;r.drawBuffers||(N=Math.min(N,1)),o.multisample>1&&this.canMultisampleFramebuffer(e)?(o.msaaBuffer=o.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,o.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,o.multisample,r.RGBA8,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,o.msaaBuffer)):o.msaaBuffer&&(r.deleteRenderbuffer(o.msaaBuffer),o.msaaBuffer=null,o.blitFramebuffer&&(o.blitFramebuffer.dispose(),o.blitFramebuffer=null));for(var k=[],B=0;B<N;B++){var G=D[B],U=G.parentTextureArray||G;this.renderer.texture.bind(U,0),!(B===0&&o.msaaBuffer)&&(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+B,G.target,U._glTextures[this.CONTEXT_UID].texture,t),k.push(r.COLOR_ATTACHMENT0+B))}if(k.length>1&&r.drawBuffers(k),e.depthTexture){var H=this.writeDepthTexture;if(H){var $=e.depthTexture;this.renderer.texture.bind($,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,$._glTextures[this.CONTEXT_UID].texture,t)}}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(o.stencil=o.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,o.stencil),o.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,o.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,o.stencil)):o.stencil&&(r.deleteRenderbuffer(o.stencil),o.stencil=null)},n.prototype.canMultisampleFramebuffer=function(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture},n.prototype.detectSamples=function(e){var t=this.msaaSamples,r=MSAA_QUALITY.NONE;if(e<=1||t===null)return r;for(var o=0;o<t.length;o++)if(t[o]<=e){r=t[o];break}return r===1&&(r=MSAA_QUALITY.NONE),r},n.prototype.blit=function(e,t,r){var o=this,D=o.current,N=o.renderer,k=o.gl,B=o.CONTEXT_UID;if(N.context.webGLVersion===2&&D){var G=D.glFramebuffers[B];if(G){if(!e){if(!G.msaaBuffer)return;var U=D.colorTextures[0];if(!U)return;G.blitFramebuffer||(G.blitFramebuffer=new Framebuffer(D.width,D.height),G.blitFramebuffer.addColorTexture(0,U)),e=G.blitFramebuffer,e.colorTextures[0]!==U&&(e.colorTextures[0]=U,e.dirtyId++,e.dirtyFormat++),(e.width!==D.width||e.height!==D.height)&&(e.width=D.width,e.height=D.height,e.dirtyId++,e.dirtySize++)}t||(t=tempRectangle,t.width=D.width,t.height=D.height),r||(r=t);var H=t.width===r.width&&t.height===r.height;this.bind(e),k.bindFramebuffer(k.READ_FRAMEBUFFER,G.framebuffer),k.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,k.COLOR_BUFFER_BIT,H?k.NEAREST:k.LINEAR)}}},n.prototype.disposeFramebuffer=function(e,t){var r=e.glFramebuffers[this.CONTEXT_UID],o=this.gl;if(r){delete e.glFramebuffers[this.CONTEXT_UID];var D=this.managedFramebuffers.indexOf(e);D>=0&&this.managedFramebuffers.splice(D,1),e.disposeRunner.remove(this),t||(o.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&o.deleteRenderbuffer(r.msaaBuffer),r.stencil&&o.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}},n.prototype.disposeAll=function(e){var t=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)},n.prototype.forceStencil=function(){var e=this.current;if(e){var t=e.glFramebuffers[this.CONTEXT_UID];if(!(!t||t.stencil)){e.stencil=!0;var r=e.width,o=e.height,D=this.gl,N=D.createRenderbuffer();D.bindRenderbuffer(D.RENDERBUFFER,N),t.msaaBuffer?D.renderbufferStorageMultisample(D.RENDERBUFFER,t.multisample,D.DEPTH24_STENCIL8,r,o):D.renderbufferStorage(D.RENDERBUFFER,D.DEPTH_STENCIL,r,o),t.stencil=N,D.framebufferRenderbuffer(D.FRAMEBUFFER,D.DEPTH_STENCIL_ATTACHMENT,D.RENDERBUFFER,N)}}},n.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle},n.prototype.destroy=function(){this.renderer=null},n}(),byteSizeMap={5126:4,5123:2,5121:1},GeometrySystem=function(){function n(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return n.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){var r=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=function(){return r.createVertexArrayOES()},e.bindVertexArray=function(D){return r.bindVertexArrayOES(D)},e.deleteVertexArray=function(D){return r.deleteVertexArrayOES(D)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(t.webGLVersion!==2){var o=e.getExtension("ANGLE_instanced_arrays");o?(e.vertexAttribDivisor=function(D,N){return o.vertexAttribDivisorANGLE(D,N)},e.drawElementsInstanced=function(D,N,k,B,G){return o.drawElementsInstancedANGLE(D,N,k,B,G)},e.drawArraysInstanced=function(D,N,k,B){return o.drawArraysInstancedANGLE(D,N,k,B)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex},n.prototype.bind=function(e,t){t=t||this.renderer.shader.shader;var r=this.gl,o=e.glVertexArrayObjects[this.CONTEXT_UID],D=!1;o||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=o={},D=!0);var N=o[t.program.id]||this.initGeometryVao(e,t,D);this._activeGeometry=e,this._activeVao!==N&&(this._activeVao=N,this.hasVao?r.bindVertexArray(N):this.activateVao(e,t.program)),this.updateBuffers()},n.prototype.reset=function(){this.unbind()},n.prototype.updateBuffers=function(){for(var e=this._activeGeometry,t=this.renderer.buffer,r=0;r<e.buffers.length;r++){var o=e.buffers[r];t.update(o)}},n.prototype.checkCompatibility=function(e,t){var r=e.attributes,o=t.attributeData;for(var D in o)if(!r[D])throw new Error('shader and geometry incompatible, geometry missing the "'+D+'" attribute')},n.prototype.getSignature=function(e,t){var r=e.attributes,o=t.attributeData,D=["g",e.id];for(var N in r)o[N]&&D.push(N,o[N].location);return D.join("-")},n.prototype.initGeometryVao=function(e,t,r){r===void 0&&(r=!0);var o=this.gl,D=this.CONTEXT_UID,N=this.renderer.buffer,k=t.program;k.glPrograms[D]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,k);var B=this.getSignature(e,k),G=e.glVertexArrayObjects[this.CONTEXT_UID],U=G[B];if(U)return G[k.id]=U,U;var H=e.buffers,$=e.attributes,V={},Y={};for(var X in H)V[X]=0,Y[X]=0;for(var X in $)!$[X].size&&k.attributeData[X]?$[X].size=k.attributeData[X].size:$[X].size||console.warn("PIXI Geometry attribute '"+X+"' size cannot be determined (likely the bound shader does not have the attribute)"),V[$[X].buffer]+=$[X].size*byteSizeMap[$[X].type];for(var X in $){var z=$[X],W=z.size;z.stride===void 0&&(V[z.buffer]===W*byteSizeMap[z.type]?z.stride=0:z.stride=V[z.buffer]),z.start===void 0&&(z.start=Y[z.buffer],Y[z.buffer]+=W*byteSizeMap[z.type])}U=o.createVertexArray(),o.bindVertexArray(U);for(var q=0;q<H.length;q++){var K=H[q];N.bind(K),r&&K._glBuffers[D].refCount++}return this.activateVao(e,k),this._activeVao=U,G[k.id]=U,G[B]=U,U},n.prototype.disposeGeometry=function(e,t){var r;if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var o=e.glVertexArrayObjects[this.CONTEXT_UID],D=this.gl,N=e.buffers,k=(r=this.renderer)===null||r===void 0?void 0:r.buffer;if(e.disposeRunner.remove(this),!!o){if(k)for(var B=0;B<N.length;B++){var G=N[B]._glBuffers[this.CONTEXT_UID];G&&(G.refCount--,G.refCount===0&&!t&&k.dispose(N[B],t))}if(!t){for(var U in o)if(U[0]==="g"){var H=o[U];this._activeVao===H&&this.unbind(),D.deleteVertexArray(H)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},n.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedGeometries),r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)},n.prototype.activateVao=function(e,t){var r=this.gl,o=this.CONTEXT_UID,D=this.renderer.buffer,N=e.buffers,k=e.attributes;e.indexBuffer&&D.bind(e.indexBuffer);var B=null;for(var G in k){var U=k[G],H=N[U.buffer],$=H._glBuffers[o];if(t.attributeData[G]){B!==$&&(D.bind(H),B=$);var V=t.attributeData[G].location;if(r.enableVertexAttribArray(V),r.vertexAttribPointer(V,U.size,U.type||r.FLOAT,U.normalized,U.stride,U.start),U.instance)if(this.hasInstance)r.vertexAttribDivisor(V,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},n.prototype.draw=function(e,t,r,o){var D=this.gl,N=this._activeGeometry;if(N.indexBuffer){var k=N.indexBuffer.data.BYTES_PER_ELEMENT,B=k===2?D.UNSIGNED_SHORT:D.UNSIGNED_INT;k===2||k===4&&this.canUseUInt32ElementIndex?N.instanced?D.drawElementsInstanced(e,t||N.indexBuffer.data.length,B,(r||0)*k,o||1):D.drawElements(e,t||N.indexBuffer.data.length,B,(r||0)*k):console.warn("unsupported index buffer type: uint32")}else N.instanced?D.drawArraysInstanced(e,r,t||N.getSize(),o||1):D.drawArrays(e,r,t||N.getSize());return this},n.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},n.prototype.destroy=function(){this.renderer=null},n}(),MaskData=function(){function n(e){e===void 0&&(e=null),this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=settings.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(n.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},n.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},n}();function compileShader(n,e,t){var r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}function logPrettyShaderError(n,e){var t=n.getShaderSource(e).split(`
`).map(function(G,U){return U+": "+G}),r=n.getShaderInfoLog(e),o=r.split(`
`),D={},N=o.map(function(G){return parseFloat(G.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(G){return G&&!D[G]?(D[G]=!0,!0):!1}),k=[""];N.forEach(function(G){t[G-1]="%c"+t[G-1]+"%c",k.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var B=t.join(`
`);k[0]=B,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,k),console.groupEnd()}function logProgramError(n,e,t,r){n.getProgramParameter(e,n.LINK_STATUS)||(n.getShaderParameter(t,n.COMPILE_STATUS)||logPrettyShaderError(n,t),n.getShaderParameter(r,n.COMPILE_STATUS)||logPrettyShaderError(n,r),console.error("PixiJS Error: Could not initialize shader."),n.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",n.getProgramInfoLog(e)))}function booleanArray(n){for(var e=new Array(n),t=0;t<e.length;t++)e[t]=!1;return e}function defaultValue(n,e){switch(n){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return booleanArray(2*e);case"bvec3":return booleanArray(3*e);case"bvec4":return booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var unknownContext={},context=unknownContext;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var n=settings.ADAPTER.createCanvas(),e=void 0;settings.PREFER_ENV>=ENV.WEBGL2&&(e=n.getContext("webgl2",{})),e||(e=n.getContext("webgl",{})||n.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),context=e}return context}var maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;var n=getTestContext();if(n&&n.getShaderPrecisionFormat){var e=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT);maxFragmentPrecision=e.precision?PRECISION.HIGH:PRECISION.MEDIUM}}return maxFragmentPrecision}function setPrecision(n,e,t){if(n.substring(0,9)!=="precision"){var r=e;return e===PRECISION.HIGH&&t!==PRECISION.HIGH&&(r=PRECISION.MEDIUM),"precision "+r+` float;
`+n}else if(t!==PRECISION.HIGH&&n.substring(0,15)==="precision highp")return n.replace("precision highp","precision mediump");return n}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(n){return GLSL_TO_SIZE[n]}var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(n,e){if(!GL_TABLE){var t=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var r=0;r<t.length;++r){var o=t[r];GL_TABLE[n[o]]=GL_TO_GLSL_TYPES[o]}}return GL_TABLE[e]}var uniformParsers=[{test:function(n){return n.type==="float"&&n.size===1&&!n.isArray},code:function(n){return`
            if(uv["`+n+'"] !== ud["'+n+`"].value)
            {
                ud["`+n+'"].value = uv["'+n+`"]
                gl.uniform1f(ud["`+n+'"].location, uv["'+n+`"])
            }
            `}},{test:function(n,e){return(n.type==="sampler2D"||n.type==="samplerCube"||n.type==="sampler2DArray")&&n.size===1&&!n.isArray&&(e==null||e.castToBaseTexture!==void 0)},code:function(n){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+n+`"], t);

            if(ud["`+n+`"].value !== t)
            {
                ud["`+n+`"].value = t;
                gl.uniform1i(ud["`+n+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(n,e){return n.type==="mat3"&&n.size===1&&!n.isArray&&e.a!==void 0},code:function(n){return`
            gl.uniformMatrix3fv(ud["`+n+'"].location, false, uv["'+n+`"].toArray(true));
            `},codeUbo:function(n){return`
                var `+n+"_matrix = uv."+n+`.toArray(true);

                data[offset] = `+n+`_matrix[0];
                data[offset+1] = `+n+`_matrix[1];
                data[offset+2] = `+n+`_matrix[2];
        
                data[offset + 4] = `+n+`_matrix[3];
                data[offset + 5] = `+n+`_matrix[4];
                data[offset + 6] = `+n+`_matrix[5];
        
                data[offset + 8] = `+n+`_matrix[6];
                data[offset + 9] = `+n+`_matrix[7];
                data[offset + 10] = `+n+`_matrix[8];
            `}},{test:function(n,e){return n.type==="vec2"&&n.size===1&&!n.isArray&&e.x!==void 0},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+n+`"].location, v.x, v.y);
                }`},codeUbo:function(n){return`
                v = uv.`+n+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(n){return n.type==="vec2"&&n.size===1&&!n.isArray},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+n+`"].location, v[0], v[1]);
                }
            `}},{test:function(n,e){return n.type==="vec4"&&n.size===1&&!n.isArray&&e.width!==void 0},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+n+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(n){return`
                    v = uv.`+n+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(n){return n.type==="vec4"&&n.size===1&&!n.isArray},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+n+`"].location, v[0], v[1], v[2], v[3])
                }`}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(n,e){var t,r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var o in n.uniforms){var D=e[o];if(!D){!((t=n.uniforms[o])===null||t===void 0)&&t.group&&(n.uniforms[o].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+o+", '"+o+`');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.`+o+`, syncData);
                    `));continue}for(var N=n.uniforms[o],k=!1,B=0;B<uniformParsers.length;B++)if(uniformParsers[B].test(D,N)){r.push(uniformParsers[B].code(o,N)),k=!0;break}if(!k){var G=D.size===1&&!D.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS,U=G[D.type].replace("location",'ud["'+o+'"].location');r.push(`
            cu = ud["`+o+`"];
            cv = cu.value;
            v = uv["`+o+`"];
            `+U+";")}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}var fragTemplate$1=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(n){for(var e="",t=0;t<n;++t)t>0&&(e+=`
else `),t<n-1&&(e+="if(test == "+t+".0){}");return e}function checkMaxIfStatementsInShader(n,e){if(n===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var t=e.createShader(e.FRAGMENT_SHADER);;){var r=fragTemplate$1.replace(/%forloop%/gi,generateIfTestSrc(n));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))n=n/2|0;else break}return n}var unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{var n=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=n({a:"b"},"a","b")===!0}catch{unsafeEval=!1}return unsafeEval}var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,UID$1=0,nameCache={},Program=function(){function n(e,t,r){r===void 0&&(r="pixi-shader"),this.id=UID$1++,this.vertexSrc=e||n.defaultVertexSrc,this.fragmentSrc=t||n.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),nameCache[r]?(nameCache[r]++,r+="-"+nameCache[r]):nameCache[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(n,"defaultVertexSrc",{get:function(){return defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(n,"defaultFragmentSrc",{get:function(){return defaultFragment$2},enumerable:!1,configurable:!0}),n.from=function(e,t,r){var o=e+t,D=ProgramCache[o];return D||(ProgramCache[o]=D=new n(e,t,r)),D},n}(),Shader=function(){function n(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof UniformGroup?this.uniformGroup=t:this.uniformGroup=new UniformGroup(t):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}return n.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var r in t.uniforms){var o=t.uniforms[r];if(o.group&&this.checkUniformExists(e,o))return!0}return!1},n.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(n.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),n.from=function(e,t,r){var o=Program.from(e,t);return new n(o,r)},n}(),BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5,State=function(){function n(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(n.prototype,"blend",{get:function(){return!!(this.data&1<<BLEND$1)},set:function(e){!!(this.data&1<<BLEND$1)!==e&&(this.data^=1<<BLEND$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"offsets",{get:function(){return!!(this.data&1<<OFFSET$1)},set:function(e){!!(this.data&1<<OFFSET$1)!==e&&(this.data^=1<<OFFSET$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"culling",{get:function(){return!!(this.data&1<<CULLING$1)},set:function(e){!!(this.data&1<<CULLING$1)!==e&&(this.data^=1<<CULLING$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"depthTest",{get:function(){return!!(this.data&1<<DEPTH_TEST$1)},set:function(e){!!(this.data&1<<DEPTH_TEST$1)!==e&&(this.data^=1<<DEPTH_TEST$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"depthMask",{get:function(){return!!(this.data&1<<DEPTH_MASK$1)},set:function(e){!!(this.data&1<<DEPTH_MASK$1)!==e&&(this.data^=1<<DEPTH_MASK$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<WINDING$1)},set:function(e){!!(this.data&1<<WINDING$1)!==e&&(this.data^=1<<WINDING$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==BLEND_MODES.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),n.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},n.for2d=function(){var e=new n;return e.depthTest=!1,e.blend=!0,e},n}(),defaultFragment$1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex$2=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Filter=function(n){__extends$i(e,n);function e(t,r,o){var D=this,N=Program.from(t||e.defaultVertexSrc,r||e.defaultFragmentSrc);return D=n.call(this,N,o)||this,D.padding=0,D.resolution=settings.FILTER_RESOLUTION,D.multisample=settings.FILTER_MULTISAMPLE,D.enabled=!0,D.autoFit=!0,D.state=new State,D}return e.prototype.apply=function(t,r,o,D,N){t.applyFilter(this,r,o,D)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return defaultVertex$2},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return defaultFragment$1},enumerable:!1,configurable:!0}),e}(Shader),vertex$4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,fragment$7=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,tempMat$1=new Matrix,TextureMatrix=function(){function n(e,t){this._texture=e,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}return Object.defineProperty(n.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),n.prototype.multiplyUvs=function(e,t){t===void 0&&(t=e);for(var r=this.mapCoord,o=0;o<e.length;o+=2){var D=e[o],N=e[o+1];t[o]=D*r.a+N*r.c+r.tx,t[o+1]=D*r.b+N*r.d+r.ty}return t},n.prototype.update=function(e){var t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;var r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var o=t.orig,D=t.trim;D&&(tempMat$1.set(o.width/D.width,0,0,o.height/D.height,-D.x/D.width,-D.y/D.height),this.mapCoord.append(tempMat$1));var N=t.baseTexture,k=this.uClampFrame,B=this.clampMargin/N.resolution,G=this.clampOffset;return k[0]=(t._frame.x+B+G)/N.width,k[1]=(t._frame.y+B+G)/N.height,k[2]=(t._frame.x+t._frame.width-B+G)/N.width,k[3]=(t._frame.y+t._frame.height-B+G)/N.height,this.uClampOffset[0]=G/N.realWidth,this.uClampOffset[1]=G/N.realHeight,this.isSimple=t._frame.width===N.width&&t._frame.height===N.height&&t.rotate===0,!0},n}(),SpriteMaskFilter=function(n){__extends$i(e,n);function e(t,r,o){var D=this,N=null;return typeof t!="string"&&r===void 0&&o===void 0&&(N=t,t=void 0,r=void 0,o=void 0),D=n.call(this,t||vertex$4,r||fragment$7,o)||this,D.maskSprite=N,D.maskMatrix=new Matrix,D}return Object.defineProperty(e.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,o,D){var N=this._maskSprite,k=N._texture;k.valid&&(k.uvMatrix||(k.uvMatrix=new TextureMatrix(k,0)),k.uvMatrix.update(),this.uniforms.npmAlpha=k.baseTexture.alphaMode?0:1,this.uniforms.mask=k,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,N).prepend(k.uvMatrix.mapCoord),this.uniforms.alpha=N.worldAlpha,this.uniforms.maskClamp=k.uvMatrix.uClampFrame,t.applyFilter(this,r,o,D))},e}(Filter),MaskSystem=function(){function n(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return n.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},n.prototype.push=function(e,t){var r=t;if(!r.isMaskData){var o=this.maskDataPool.pop()||new MaskData;o.pooled=!0,o.maskObject=t,r=o}var D=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(D),r._colorMask=D?D._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==MASK_TYPES.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(r);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(r);break;case MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case MASK_TYPES.COLOR:this.pushColorMask(r);break}r.type===MASK_TYPES.SPRITE&&this.maskStack.push(r)},n.prototype.pop=function(e){var t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(t);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(t);break;case MASK_TYPES.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){var r=this.maskStack[this.maskStack.length-1];r.type===MASK_TYPES.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}},n.prototype.detect=function(e){var t=e.maskObject;t?t.isSprite?e.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=MASK_TYPES.SCISSOR:e.type=MASK_TYPES.STENCIL:e.type=MASK_TYPES.COLOR},n.prototype.pushSpriteMask=function(e){var t,r,o=e.maskObject,D=e._target,N=e._filters;N||(N=this.alphaMaskPool[this.alphaMaskIndex],N||(N=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter]));var k=this.renderer,B=k.renderTexture,G,U;if(B.current){var H=B.current;G=e.resolution||H.resolution,U=(t=e.multisample)!==null&&t!==void 0?t:H.multisample}else G=e.resolution||k.resolution,U=(r=e.multisample)!==null&&r!==void 0?r:k.multisample;N[0].resolution=G,N[0].multisample=U,N[0].maskSprite=o;var $=D.filterArea;D.filterArea=o.getBounds(!0),k.filter.push(D,N),D.filterArea=$,e._filters||this.alphaMaskIndex++},n.prototype.popSpriteMask=function(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},n.prototype.pushColorMask=function(e){var t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},n.prototype.popColorMask=function(e){var t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},n.prototype.destroy=function(){this.renderer=null},n}(),AbstractMaskSystem=function(){function n(e){this.renderer=e,this.maskStack=[],this.glConst=0}return n.prototype.getStackLength=function(){return this.maskStack.length},n.prototype.setMaskStack=function(e){var t=this.renderer.gl,r=this.getStackLength();this.maskStack=e;var o=this.getStackLength();o!==r&&(o===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))},n.prototype._useCurrent=function(){},n.prototype.destroy=function(){this.renderer=null,this.maskStack=null},n}(),tempMatrix$1=new Matrix,rectPool=[],ScissorSystem=function(n){__extends$i(e,n);function e(t){var r=n.call(this,t)||this;return r.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,r}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.calcScissorRect=function(t){var r;if(!t._scissorRectLocal){var o=t._scissorRect,D=t.maskObject,N=this.renderer,k=N.renderTexture,B=D.getBounds(!0,(r=rectPool.pop())!==null&&r!==void 0?r:new Rectangle);this.roundFrameToPixels(B,k.current?k.current.resolution:N.resolution,k.sourceFrame,k.destinationFrame,N.projection.transform),o&&B.fit(o),t._scissorRectLocal=B}},e.isMatrixRotated=function(t){if(!t)return!1;var r=t.a,o=t.b,D=t.c,N=t.d;return(Math.abs(o)>1e-4||Math.abs(D)>1e-4)&&(Math.abs(r)>1e-4||Math.abs(N)>1e-4)},e.prototype.testScissor=function(t){var r=t.maskObject;if(!r.isFastRect||!r.isFastRect()||e.isMatrixRotated(r.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var o=t._scissorRectLocal;return o.width>0&&o.height>0},e.prototype.roundFrameToPixels=function(t,r,o,D,N){e.isMatrixRotated(N)||(N=N?tempMatrix$1.copyFrom(N):tempMatrix$1.identity(),N.translate(-o.x,-o.y).scale(D.width/o.width,D.height/o.height).translate(D.x,D.y),this.renderer.filter.transformAABB(N,t),t.fit(D),t.x=Math.round(t.x*r),t.y=Math.round(t.y*r),t.width=Math.round(t.width*r),t.height=Math.round(t.height*r))},e.prototype.push=function(t){t._scissorRectLocal||this.calcScissorRect(t);var r=this.renderer.gl;t._scissorRect||r.enable(r.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()},e.prototype.pop=function(t){var r=this.renderer.gl;t&&rectPool.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():r.disable(r.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,r;this.renderer.renderTexture.current?r=t.y:r=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,r,t.width,t.height)},e}(AbstractMaskSystem),StencilSystem=function(n){__extends$i(e,n);function e(t){var r=n.call(this,t)||this;return r.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,r}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var r=t.maskObject,o=this.renderer.gl,D=t._stencilCounter;D===0&&(this.renderer.framebuffer.forceStencil(),o.clearStencil(0),o.clear(o.STENCIL_BUFFER_BIT),o.enable(o.STENCIL_TEST)),t._stencilCounter++;var N=t._colorMask;N!==0&&(t._colorMask=0,o.colorMask(!1,!1,!1,!1)),o.stencilFunc(o.EQUAL,D,4294967295),o.stencilOp(o.KEEP,o.KEEP,o.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,N!==0&&(t._colorMask=N,o.colorMask((N&1)!==0,(N&2)!==0,(N&4)!==0,(N&8)!==0)),this._useCurrent()},e.prototype.pop=function(t){var r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{var o=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,D=o?o._colorMask:15;D!==0&&(o._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,D!==0&&(o._colorMask=D,r.colorMask((D&1)!==0,(D&2)!==0,(D&4)!==0,(D&8)!==0)),this._useCurrent()}},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e}(AbstractMaskSystem),ProjectionSystem=function(){function n(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}return n.prototype.update=function(e,t,r,o){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,o),this.transform&&this.projectionMatrix.append(this.transform);var D=this.renderer;D.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,D.globalUniforms.update(),D.shader.shader&&D.shader.syncUniformGroup(D.shader.shader.uniforms.globals)},n.prototype.calculateProjection=function(e,t,r,o){var D=this.projectionMatrix,N=o?-1:1;D.identity(),D.a=1/t.width*2,D.d=N*(1/t.height*2),D.tx=-1-t.x*D.a,D.ty=-N-t.y*D.d},n.prototype.setTransform=function(e){},n.prototype.destroy=function(){this.renderer=null},n}(),tempRect=new Rectangle,tempRect2=new Rectangle,RenderTextureSystem=function(){function n(e){this.renderer=e,this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}return n.prototype.bind=function(e,t,r){e===void 0&&(e=null);var o=this.renderer;this.current=e;var D,N,k;e?(D=e.baseTexture,k=D.resolution,t||(tempRect.width=e.frame.width,tempRect.height=e.frame.height,t=tempRect),r||(tempRect2.x=e.frame.x,tempRect2.y=e.frame.y,tempRect2.width=t.width,tempRect2.height=t.height,r=tempRect2),N=D.framebuffer):(k=o.resolution,t||(tempRect.width=o.screen.width,tempRect.height=o.screen.height,t=tempRect),r||(r=tempRect,r.width=t.width,r.height=t.height));var B=this.viewportFrame;B.x=r.x*k,B.y=r.y*k,B.width=r.width*k,B.height=r.height*k,e||(B.y=o.view.height-(B.y+B.height)),B.ceil(),this.renderer.framebuffer.bind(N,B),this.renderer.projection.update(r,t,k,!N),e?this.renderer.mask.setMaskStack(D.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)},n.prototype.clear=function(e,t){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.clearColor;var r=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer.screen,D=r.width!==o.width||r.height!==o.height;if(D){var N=this.viewportFrame,k=N.x,B=N.y,G=N.width,U=N.height;k=Math.round(k),B=Math.round(B),G=Math.round(G),U=Math.round(U),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(k,B,G,U)}this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],t),D&&this.renderer.scissor.pop()},n.prototype.resize=function(){this.bind(null)},n.prototype.reset=function(){this.bind(null)},n.prototype.destroy=function(){this.renderer=null},n}();function uboUpdate(n,e,t,r,o){t.buffer.update(o)}var UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function createUBOElements(n){for(var e=n.map(function(B){return{data:B,offset:0,dataLen:0,dirty:0}}),t=0,r=0,o=0,D=0;D<e.length;D++){var N=e[D];if(t=GLSL_TO_STD40_SIZE[N.data.type],N.data.size>1&&(t=Math.max(t,16)*N.data.size),N.dataLen=t,r%t!==0&&r<16){var k=r%t%16;r+=k,o+=k}r+t>16?(o=Math.ceil(o/16)*16,N.offset=o,o+=t,r=t):(N.offset=o,r+=t,o+=t)}return o=Math.ceil(o/16)*16,{uboElements:e,size:o}}function getUBOData(n,e){var t=[];for(var r in n)e[r]&&t.push(e[r]);return t.sort(function(o,D){return o.index-D.index}),t}function generateUniformBufferSync(n,e){if(!n.autoManage)return{size:0,syncFunc:uboUpdate};for(var t=getUBOData(n.uniforms,e),r=createUBOElements(t),o=r.uboElements,D=r.size,N=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],k=0;k<o.length;k++){for(var B=o[k],G=n.uniforms[B.data.name],U=B.data.name,H=!1,$=0;$<uniformParsers.length;$++){var V=uniformParsers[$];if(V.codeUbo&&V.test(B.data,G)){N.push("offset = "+B.offset/4+";",uniformParsers[$].codeUbo(B.data.name,G)),H=!0;break}}if(!H)if(B.data.size>1){var Y=mapSize(B.data.type),X=Math.max(GLSL_TO_STD40_SIZE[B.data.type]/16,1),z=Y/X,W=(4-z%4)%4;N.push(`
                cv = ud.`+U+`.value;
                v = uv.`+U+`;
                offset = `+B.offset/4+`;

                t = 0;

                for(var i=0; i < `+B.data.size*X+`; i++)
                {
                    for(var j = 0; j < `+z+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+W+`;
                }

                `)}else{var q=UBO_TO_SINGLE_SETTERS[B.data.type];N.push(`
                cv = ud.`+U+`.value;
                v = uv.`+U+`;
                offset = `+B.offset/4+`;
                `+q+`;
                `)}}return N.push(`
       renderer.buffer.update(buffer);
    `),{size:D,syncFunc:new Function("ud","uv","renderer","syncData","buffer",N.join(`
`))}}var GLProgram=function(){function n(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return n.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},n}();function getAttributeData(n,e){for(var t={},r=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var D=e.getActiveAttrib(n,o);if(D.name.indexOf("gl_")!==0){var N=mapType(e,D.type),k={type:N,name:D.name,size:mapSize(N),location:e.getAttribLocation(n,D.name)};t[D.name]=k}}return t}function getUniformData(n,e){for(var t={},r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS),o=0;o<r;o++){var D=e.getActiveUniform(n,o),N=D.name.replace(/\[.*?\]$/,""),k=!!D.name.match(/\[.*?\]$/),B=mapType(e,D.type);t[N]={name:N,index:o,type:B,size:D.size,isArray:k,value:defaultValue(B,D.size)}}return t}function generateProgram(n,e){var t=compileShader(n,n.VERTEX_SHADER,e.vertexSrc),r=compileShader(n,n.FRAGMENT_SHADER,e.fragmentSrc),o=n.createProgram();if(n.attachShader(o,t),n.attachShader(o,r),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)||logProgramError(n,o,t,r),e.attributeData=getAttributeData(o,n),e.uniformData=getUniformData(o,n),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var D=Object.keys(e.attributeData);D.sort(function(U,H){return U>H?1:-1});for(var N=0;N<D.length;N++)e.attributeData[D[N]].location=N,n.bindAttribLocation(o,N,D[N]);n.linkProgram(o)}n.deleteShader(t),n.deleteShader(r);var k={};for(var N in e.uniformData){var B=e.uniformData[N];k[N]={location:n.getUniformLocation(o,N),value:defaultValue(B.type,B.size)}}var G=new GLProgram(o,k);return G}var UID=0,defaultSyncData={textureCount:0,uboCount:0},ShaderSystem=function(){function n(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}return n.prototype.systemCheck=function(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},n.prototype.contextChange=function(e){this.gl=e,this.reset()},n.prototype.bind=function(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;var r=e.program,o=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(o.program)),t||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(e.uniformGroup,defaultSyncData)),o},n.prototype.setUniforms=function(e){var t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)},n.prototype.syncUniformGroup=function(e,t){var r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))},n.prototype.syncUniforms=function(e,t,r){var o=e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e);o(t.uniformData,e.uniforms,this.renderer,r)},n.prototype.createSyncGroups=function(e){var t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=generateUniformsSync(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]},n.prototype.syncUniformBufferGroup=function(e,t){var r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;var o=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),o(r.uniformData,e.uniforms,this.renderer,defaultSyncData,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])},n.prototype.createSyncBufferGroup=function(e,t,r){var o=this.renderer.gl;this.renderer.buffer.bind(e.buffer);var D=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,o.uniformBlockBinding(t.program,D,this.shader.uniformBindCount),this.shader.uniformBindCount++;var N=this.getSignature(e,this.shader.program.uniformData,"ubo"),k=this._uboCache[N];if(k||(k=this._uboCache[N]=generateUniformBufferSync(e,this.shader.program.uniformData)),e.autoManage){var B=new Float32Array(k.size/4);e.buffer.update(B)}return t.uniformGroups[e.id]=k.syncFunc,t.uniformGroups[e.id]},n.prototype.getSignature=function(e,t,r){var o=e.uniforms,D=[r+"-"];for(var N in o)D.push(N),t[N]&&D.push(t[N].type);return D.join("-")},n.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},n.prototype.generateProgram=function(e){var t=this.gl,r=e.program,o=generateProgram(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=o,o},n.prototype.reset=function(){this.program=null,this.shader=null},n.prototype.disposeShader=function(e){this.shader===e&&(this.shader=null)},n.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},n}();function mapWebGLBlendModesToPixi(n,e){return e===void 0&&(e=[]),e[BLEND_MODES.NORMAL]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD]=[n.ONE,n.ONE],e[BLEND_MODES.MULTIPLY]=[n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SCREEN]=[n.ONE,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.OVERLAY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DARKEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LIGHTEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_DODGE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_BURN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HARD_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SOFT_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DIFFERENCE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.EXCLUSION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HUE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SATURATION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LUMINOSITY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.NONE]=[0,0],e[BLEND_MODES.NORMAL_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD_NPM]=[n.SRC_ALPHA,n.ONE,n.ONE,n.ONE],e[BLEND_MODES.SCREEN_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SRC_IN]=[n.DST_ALPHA,n.ZERO],e[BLEND_MODES.SRC_OUT]=[n.ONE_MINUS_DST_ALPHA,n.ZERO],e[BLEND_MODES.SRC_ATOP]=[n.DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_OVER]=[n.ONE_MINUS_DST_ALPHA,n.ONE],e[BLEND_MODES.DST_IN]=[n.ZERO,n.SRC_ALPHA],e[BLEND_MODES.DST_OUT]=[n.ZERO,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_ATOP]=[n.ONE_MINUS_DST_ALPHA,n.SRC_ALPHA],e[BLEND_MODES.XOR]=[n.ONE_MINUS_DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SUBTRACT]=[n.ONE,n.ONE,n.ONE,n.ONE,n.FUNC_REVERSE_SUBTRACT,n.FUNC_ADD],e}var BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,StateSystem=function(){function n(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State,this.defaultState.blend=!0}return n.prototype.contextChange=function(e){this.gl=e,this.blendModes=mapWebGLBlendModesToPixi(e),this.set(this.defaultState),this.reset()},n.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var t=this.stateId^e.data,r=0;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,e)},n.prototype.forceState=function(e){e=e||this.defaultState;for(var t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(var t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data},n.prototype.setBlend=function(e){this.updateCheck(n.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},n.prototype.setOffset=function(e){this.updateCheck(n.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},n.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},n.prototype.setDepthMask=function(e){this.gl.depthMask(e)},n.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},n.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},n.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},n.prototype.setPolygonOffset=function(e,t){this.gl.polygonOffset(e,t)},n.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},n.prototype.updateCheck=function(e,t){var r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)},n.checkBlendMode=function(e,t){e.setBlendMode(t.blendMode)},n.checkPolygonOffset=function(e,t){e.setPolygonOffset(1,t.polygonOffset)},n.prototype.destroy=function(){this.gl=null},n}(),TextureGCSystem=function(){function n(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=settings.GC_MAX_IDLE,this.checkCountMax=settings.GC_MAX_CHECK_COUNT,this.mode=settings.GC_MODE}return n.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},n.prototype.run=function(){for(var e=this.renderer.texture,t=e.managedTextures,r=!1,o=0;o<t.length;o++){var D=t[o];!D.framebuffer&&this.count-D.touched>this.maxIdle&&(e.destroyTexture(D,!0),t[o]=null,r=!0)}if(r){for(var N=0,o=0;o<t.length;o++)t[o]!==null&&(t[N++]=t[o]);t.length=N}},n.prototype.unload=function(e){var t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(var o=e.children.length-1;o>=0;o--)this.unload(e.children[o])},n.prototype.destroy=function(){this.renderer=null},n}();function mapTypeAndFormatToInternalFormat(n){var e,t,r,o,D,N,k,B,G,U,H,$,V,Y,X,z,W,q,K,Q,Z,ee,J;return"WebGL2RenderingContext"in globalThis&&n instanceof globalThis.WebGL2RenderingContext?J=(e={},e[TYPES.UNSIGNED_BYTE]=(t={},t[FORMATS.RGBA]=n.RGBA8,t[FORMATS.RGB]=n.RGB8,t[FORMATS.RG]=n.RG8,t[FORMATS.RED]=n.R8,t[FORMATS.RGBA_INTEGER]=n.RGBA8UI,t[FORMATS.RGB_INTEGER]=n.RGB8UI,t[FORMATS.RG_INTEGER]=n.RG8UI,t[FORMATS.RED_INTEGER]=n.R8UI,t[FORMATS.ALPHA]=n.ALPHA,t[FORMATS.LUMINANCE]=n.LUMINANCE,t[FORMATS.LUMINANCE_ALPHA]=n.LUMINANCE_ALPHA,t),e[TYPES.BYTE]=(r={},r[FORMATS.RGBA]=n.RGBA8_SNORM,r[FORMATS.RGB]=n.RGB8_SNORM,r[FORMATS.RG]=n.RG8_SNORM,r[FORMATS.RED]=n.R8_SNORM,r[FORMATS.RGBA_INTEGER]=n.RGBA8I,r[FORMATS.RGB_INTEGER]=n.RGB8I,r[FORMATS.RG_INTEGER]=n.RG8I,r[FORMATS.RED_INTEGER]=n.R8I,r),e[TYPES.UNSIGNED_SHORT]=(o={},o[FORMATS.RGBA_INTEGER]=n.RGBA16UI,o[FORMATS.RGB_INTEGER]=n.RGB16UI,o[FORMATS.RG_INTEGER]=n.RG16UI,o[FORMATS.RED_INTEGER]=n.R16UI,o[FORMATS.DEPTH_COMPONENT]=n.DEPTH_COMPONENT16,o),e[TYPES.SHORT]=(D={},D[FORMATS.RGBA_INTEGER]=n.RGBA16I,D[FORMATS.RGB_INTEGER]=n.RGB16I,D[FORMATS.RG_INTEGER]=n.RG16I,D[FORMATS.RED_INTEGER]=n.R16I,D),e[TYPES.UNSIGNED_INT]=(N={},N[FORMATS.RGBA_INTEGER]=n.RGBA32UI,N[FORMATS.RGB_INTEGER]=n.RGB32UI,N[FORMATS.RG_INTEGER]=n.RG32UI,N[FORMATS.RED_INTEGER]=n.R32UI,N[FORMATS.DEPTH_COMPONENT]=n.DEPTH_COMPONENT24,N),e[TYPES.INT]=(k={},k[FORMATS.RGBA_INTEGER]=n.RGBA32I,k[FORMATS.RGB_INTEGER]=n.RGB32I,k[FORMATS.RG_INTEGER]=n.RG32I,k[FORMATS.RED_INTEGER]=n.R32I,k),e[TYPES.FLOAT]=(B={},B[FORMATS.RGBA]=n.RGBA32F,B[FORMATS.RGB]=n.RGB32F,B[FORMATS.RG]=n.RG32F,B[FORMATS.RED]=n.R32F,B[FORMATS.DEPTH_COMPONENT]=n.DEPTH_COMPONENT32F,B),e[TYPES.HALF_FLOAT]=(G={},G[FORMATS.RGBA]=n.RGBA16F,G[FORMATS.RGB]=n.RGB16F,G[FORMATS.RG]=n.RG16F,G[FORMATS.RED]=n.R16F,G),e[TYPES.UNSIGNED_SHORT_5_6_5]=(U={},U[FORMATS.RGB]=n.RGB565,U),e[TYPES.UNSIGNED_SHORT_4_4_4_4]=(H={},H[FORMATS.RGBA]=n.RGBA4,H),e[TYPES.UNSIGNED_SHORT_5_5_5_1]=($={},$[FORMATS.RGBA]=n.RGB5_A1,$),e[TYPES.UNSIGNED_INT_2_10_10_10_REV]=(V={},V[FORMATS.RGBA]=n.RGB10_A2,V[FORMATS.RGBA_INTEGER]=n.RGB10_A2UI,V),e[TYPES.UNSIGNED_INT_10F_11F_11F_REV]=(Y={},Y[FORMATS.RGB]=n.R11F_G11F_B10F,Y),e[TYPES.UNSIGNED_INT_5_9_9_9_REV]=(X={},X[FORMATS.RGB]=n.RGB9_E5,X),e[TYPES.UNSIGNED_INT_24_8]=(z={},z[FORMATS.DEPTH_STENCIL]=n.DEPTH24_STENCIL8,z),e[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=(W={},W[FORMATS.DEPTH_STENCIL]=n.DEPTH32F_STENCIL8,W),e):J=(q={},q[TYPES.UNSIGNED_BYTE]=(K={},K[FORMATS.RGBA]=n.RGBA,K[FORMATS.RGB]=n.RGB,K[FORMATS.ALPHA]=n.ALPHA,K[FORMATS.LUMINANCE]=n.LUMINANCE,K[FORMATS.LUMINANCE_ALPHA]=n.LUMINANCE_ALPHA,K),q[TYPES.UNSIGNED_SHORT_5_6_5]=(Q={},Q[FORMATS.RGB]=n.RGB,Q),q[TYPES.UNSIGNED_SHORT_4_4_4_4]=(Z={},Z[FORMATS.RGBA]=n.RGBA,Z),q[TYPES.UNSIGNED_SHORT_5_5_5_1]=(ee={},ee[FORMATS.RGBA]=n.RGBA,ee),q),J}var GLTexture=function(){function n(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}return n}(),TextureSystem=function(){function n(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}return n.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(e);var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(var r=0;r<t;r++)this.boundTextures[r]=null;this.emptyTextures={};var o=new GLTexture(e.createTexture());e.bindTexture(e.TEXTURE_2D,o.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=o,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new GLTexture(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var r=0;r<6;r++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var r=0;r<this.boundTextures.length;r++)this.bind(null,r)},n.prototype.bind=function(e,t){t===void 0&&(t=0);var r=this.gl;if(e=e?.castToBaseTexture(),e&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;var o=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,o.texture)),o.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):o.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null},n.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},n.prototype.unbind=function(e){var t=this,r=t.gl,o=t.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var D=0;D<o.length;D++)o[D]===this.unknownTexture&&this.bind(null,D)}for(var D=0;D<o.length;D++)o[D]===e&&(this.currentLocation!==D&&(r.activeTexture(r.TEXTURE0+D),this.currentLocation=D),r.bindTexture(e.target,this.emptyTextures[e.target].texture),o[D]=null)},n.prototype.ensureSamplerType=function(e){var t=this,r=t.boundTextures,o=t.hasIntegerTextures,D=t.CONTEXT_UID;if(o)for(var N=e-1;N>=0;--N){var k=r[N];if(k){var B=k._glTextures[D];B.samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(k)}}},n.prototype.initTexture=function(e){var t=new GLTexture(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t},n.prototype.initTextureType=function(e,t){var r,o;t.internalFormat=(o=(r=this.internalFormats[e.type])===null||r===void 0?void 0:r[e.format])!==null&&o!==void 0?o:e.format,this.webGLVersion===2&&e.type===TYPES.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type},n.prototype.updateTexture=function(e){var t=e._glTextures[this.CONTEXT_UID];if(t){var r=this.renderer;if(this.initTextureType(e,t),e.resource&&e.resource.upload(r,e,t))t.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var o=e.realWidth,D=e.realHeight,N=r.gl;(t.width!==o||t.height!==D||t.dirtyId<0)&&(t.width=o,t.height=D,N.texImage2D(e.target,0,t.internalFormat,o,D,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}},n.prototype.destroyTexture=function(e,t){var r=this.gl;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){var o=this.managedTextures.indexOf(e);o!==-1&&removeItems(this.managedTextures,o,1)}},n.prototype.updateTextureStyle=function(e){var t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=WRAP_MODES.CLAMP:t.wrapMode=e.wrapMode,e.resource&&e.resource.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)},n.prototype.setStyle=function(e,t){var r=this.gl;if(t.mipmap&&e.mipmap!==MIPMAP_MODES.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var o=this.renderer.context.extensions.anisotropicFiltering;if(o&&e.anisotropicLevel>0&&e.scaleMode===SCALE_MODES.LINEAR){var D=Math.min(e.anisotropicLevel,r.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,o.TEXTURE_MAX_ANISOTROPY_EXT,D)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST)},n.prototype.destroy=function(){this.renderer=null},n}(),tempMatrix=new Matrix,AbstractRenderer=function(n){__extends$i(e,n);function e(t,r){t===void 0&&(t=RENDERER_TYPE.UNKNOWN);var o=n.call(this)||this;return r=Object.assign({},settings.RENDER_OPTIONS,r),o.options=r,o.type=t,o.screen=new Rectangle(0,0,r.width,r.height),o.view=r.view||settings.ADAPTER.createCanvas(),o.resolution=r.resolution||settings.RESOLUTION,o.useContextAlpha=r.useContextAlpha,o.autoDensity=!!r.autoDensity,o.preserveDrawingBuffer=r.preserveDrawingBuffer,o.clearBeforeRender=r.clearBeforeRender,o._backgroundColor=0,o._backgroundColorRgba=[0,0,0,1],o._backgroundColorString="#000000",o.backgroundColor=r.backgroundColor||o._backgroundColor,o.backgroundAlpha=r.backgroundAlpha,r.transparent!==void 0&&(deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),o.useContextAlpha=r.transparent,o.backgroundAlpha=r.transparent?0:1),o._lastObjectRendered=null,o.plugins={},o}return e.prototype.initPlugins=function(t){for(var r in t)this.plugins[r]=new t[r](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,r){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(r*this.resolution);var o=this.view.width/this.resolution,D=this.view.height/this.resolution;this.screen.width=o,this.screen.height=D,this.autoDensity&&(this.view.style.width=o+"px",this.view.style.height=D+"px"),this.emit("resize",o,D)},e.prototype.generateTexture=function(t,r,o,D){r===void 0&&(r={}),typeof r=="number"&&(deprecation("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),r={scaleMode:r,resolution:o,region:D});var N=r.region,k=__rest(r,["region"]);D=N||t.getLocalBounds(null,!0),D.width===0&&(D.width=1),D.height===0&&(D.height=1);var B=RenderTexture.create(__assign({width:D.width,height:D.height},k));return tempMatrix.tx=-D.x,tempMatrix.ty=-D.y,this.render(t,{renderTexture:B,clear:!1,transform:tempMatrix,skipUpdateTransform:!!t.parent}),B},e.prototype.destroy=function(t){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var o=this;o.plugins=null,o.type=RENDERER_TYPE.UNKNOWN,o.view=null,o.screen=null,o._tempDisplayObjectParent=null,o.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=hex2string(t),hex2rgb(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e}(i),GLBuffer=function(){function n(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return n}(),BufferSystem=function(){function n(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}return n.prototype.destroy=function(){this.renderer=null},n.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},n.prototype.bind=function(e){var t=this,r=t.gl,o=t.CONTEXT_UID,D=e._glBuffers[o]||this.createGLBuffer(e);r.bindBuffer(e.type,D.buffer)},n.prototype.bindBufferBase=function(e,t){var r=this,o=r.gl,D=r.CONTEXT_UID;if(this.boundBufferBases[t]!==e){var N=e._glBuffers[D]||this.createGLBuffer(e);this.boundBufferBases[t]=e,o.bindBufferBase(o.UNIFORM_BUFFER,t,N.buffer)}},n.prototype.bindBufferRange=function(e,t,r){var o=this,D=o.gl,N=o.CONTEXT_UID;r=r||0;var k=e._glBuffers[N]||this.createGLBuffer(e);D.bindBufferRange(D.UNIFORM_BUFFER,t||0,k.buffer,r*256,256)},n.prototype.update=function(e){var t=this,r=t.gl,o=t.CONTEXT_UID,D=e._glBuffers[o];if(e._updateID!==D.updateID)if(D.updateID=e._updateID,r.bindBuffer(e.type,D.buffer),D.byteLength>=e.data.byteLength)r.bufferSubData(e.type,0,e.data);else{var N=e.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;D.byteLength=e.data.byteLength,r.bufferData(e.type,e.data,N)}},n.prototype.dispose=function(e,t){if(this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var r=e._glBuffers[this.CONTEXT_UID],o=this.gl;e.disposeRunner.remove(this),r&&(t||o.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}},n.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedBuffers),r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)},n.prototype.createGLBuffer=function(e){var t=this,r=t.CONTEXT_UID,o=t.gl;return e._glBuffers[r]=new GLBuffer(o.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[r]},n}(),Renderer=function(n){__extends$i(e,n);function e(t){var r=n.call(this,RENDERER_TYPE.WEBGL,t)||this;return t=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange"),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize")},r.runners.contextChange.add(r),r.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0),r.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(BufferSystem,"buffer").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch"),r.initPlugins(e.__plugins),r.multisample=void 0,t.context?r.context.initFromContext(t.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:t.antialias,premultipliedAlpha:r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,sayHello(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return e.create=function(t){if(isWebGLSupported())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var t=this.gl,r;if(this.context.webGLVersion===1){var o=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,o)}else{var o=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,o)}r>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:r>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:r>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE},e.prototype.addSystem=function(t,r){var o=new t(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=o;for(var D in this.runners)this.runners[D].add(o);return this},e.prototype.render=function(t,r){var o,D,N,k;if(r&&(r instanceof RenderTexture?(deprecation("6.0.0","Renderer#render arguments changed, use options instead."),o=r,D=arguments[2],N=arguments[3],k=arguments[4]):(o=r.renderTexture,D=r.clear,N=r.transform,k=r.skipUpdateTransform)),this.renderingToScreen=!o,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=N,!this.context.isLost){if(o||(this._lastObjectRendered=t),!k){var B=t.enableTempParent();t.updateTransform(),t.disableTempParent(B)}this.renderTexture.bind(o),this.batch.currentRenderer.start(),(D!==void 0?D:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),o&&o.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(t,r,o,D){r===void 0&&(r={});var N=n.prototype.generateTexture.call(this,t,r,o,D);return this.framebuffer.blit(),N},e.prototype.resize=function(t,r){n.prototype.resize.call(this,t,r),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(t){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();n.prototype.destroy.call(this,t),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,r){deprecation("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),extensions.add({name:t,type:ExtensionType.RendererPlugin,ref:r})},e.__plugins={},e}(AbstractRenderer);extensions.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);function autoDetectRenderer(n){return Renderer.create(n)}var $defaultVertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,$defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,defaultVertex$1=$defaultVertex,defaultFilterVertex=$defaultFilterVertex,BatchDrawCall=function(){function n(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}return n}(),BatchTextureArray=function(){function n(){this.elements=[],this.ids=[],this.count=0}return n.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},n}(),ViewableBuffer=function(){function n(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(n.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),n.prototype.view=function(e){return this[e+"View"]},n.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},n.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},n}(),AbstractBatchRenderer=function(n){__extends$i(e,n);function e(t){var r=n.call(this,t)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=State.for2d(),r.size=settings.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),t.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return e.prototype.contextChange=function(){var t=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,r=e._textureArrayPool,o=this.size/4,D=Math.floor(o/this.MAX_TEXTURES)+1;t.length<o;)t.push(new BatchDrawCall);for(;r.length<D;)r.push(new BatchTextureArray);for(var N=0;N<this.MAX_TEXTURES;N++)this._tempBoundTextures[N]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this,r=t._bufferedTextures,o=t.MAX_TEXTURES,D=e._textureArrayPool,N=this.renderer.batch,k=this._tempBoundTextures,B=this.renderer.textureGC.count,G=++BaseTexture._globalBatch,U=0,H=D[0],$=0;N.copyBoundTextures(k,o);for(var V=0;V<this._bufferSize;++V){var Y=r[V];r[V]=null,Y._batchEnabled!==G&&(H.count>=o&&(N.boundArray(H,k,G,o),this.buildDrawCalls(H,$,V),$=V,H=D[++U],++G),Y._batchEnabled=G,Y.touched=B,H.elements[H.count++]=Y)}H.count>0&&(N.boundArray(H,k,G,o),this.buildDrawCalls(H,$,this._bufferSize),++U,++G);for(var V=0;V<k.length;V++)k[V]=null;BaseTexture._globalBatch=G},e.prototype.buildDrawCalls=function(t,r,o){var D=this,N=D._bufferedElements,k=D._attributeBuffer,B=D._indexBuffer,G=D.vertexSize,U=e._drawCallPool,H=this._dcIndex,$=this._aIndex,V=this._iIndex,Y=U[H];Y.start=this._iIndex,Y.texArray=t;for(var X=r;X<o;++X){var z=N[X],W=z._texture.baseTexture,q=premultiplyBlendMode[W.alphaMode?1:0][z.blendMode];N[X]=null,r<X&&Y.blend!==q&&(Y.size=V-Y.start,r=X,Y=U[++H],Y.texArray=t,Y.start=V),this.packInterleavedGeometry(z,k,B,$,V),$+=z.vertexData.length/2*G,V+=z.indices.length,Y.blend=q}r<o&&(Y.size=V-Y.start,++H),this._dcIndex=H,this._aIndex=$,this._iIndex=V},e.prototype.bindAndClearTexArray=function(t){for(var r=this.renderer.texture,o=0;o<t.count;o++)r.bind(t.elements[o],t.ids[o]),t.elements[o]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,r=t._packedGeometries,o=t._attributeBuffer,D=t._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(o.rawBinaryData),r[this._flushId]._indexBuffer.update(D),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(o.rawBinaryData),r[this._flushId]._indexBuffer.update(D),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,r=this.renderer,o=r.gl,D=r.state,N=e._drawCallPool,k=null,B=0;B<t;B++){var G=N[B],U=G.texArray,H=G.type,$=G.size,V=G.start,Y=G.blend;k!==U&&(k=U,this.bindAndClearTexArray(U)),this.state.blendMode=Y,D.set(this.state),o.drawElements(H,$,o.UNSIGNED_SHORT,V*2)}},e.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),n.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var r=nextPow2(Math.ceil(t/8)),o=log2(r),D=r*8;this._aBuffers.length<=o&&(this._iBuffers.length=o+1);var N=this._aBuffers[D];return N||(this._aBuffers[D]=N=new ViewableBuffer(D*this.vertexSize*4)),N},e.prototype.getIndexBuffer=function(t){var r=nextPow2(Math.ceil(t/12)),o=log2(r),D=r*12;this._iBuffers.length<=o&&(this._iBuffers.length=o+1);var N=this._iBuffers[o];return N||(this._iBuffers[o]=N=new Uint16Array(D)),N},e.prototype.packInterleavedGeometry=function(t,r,o,D,N){for(var k=r.uint32View,B=r.float32View,G=D/this.vertexSize,U=t.uvs,H=t.indices,$=t.vertexData,V=t._texture.baseTexture._batchLocation,Y=Math.min(t.worldAlpha,1),X=Y<1&&t._texture.baseTexture.alphaMode?premultiplyTint(t._tintRGB,Y):t._tintRGB+(Y*255<<24),z=0;z<$.length;z+=2)B[D++]=$[z],B[D++]=$[z+1],B[D++]=U[z],B[D++]=U[z+1],k[D++]=X,B[D++]=V;for(var z=0;z<H.length;z++)o[N++]=G+H[z]},e._drawCallPool=[],e._textureArrayPool=[],e}(ObjectRenderer),BatchShaderGenerator=function(){function n(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return n.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=UniformGroup.from({uSamplers:t},!0);var o=this.fragTemplate;o=o.replace(/%count%/gi,""+e),o=o.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Program(this.vertexSrc,o)}var D={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[e]};return new Shader(this.programCache[e],D)},n.prototype.generateSampleSrc=function(e){var t="";t+=`
`,t+=`
`;for(var r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+="if(vTextureId < "+r+".5)"),t+=`
{`,t+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",t+=`
}`;return t+=`
`,t+=`
`,t},n}(),BatchGeometry=function(n){__extends$i(e,n);function e(t){t===void 0&&(t=!1);var r=n.call(this)||this;return r._buffer=new Buffer(null,t,!1),r._indexBuffer=new Buffer(null,t,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",r._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,TYPES.FLOAT).addIndex(r._indexBuffer),r}return e}(Geometry),defaultVertex=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,defaultFragment=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,BatchPluginFactory=function(){function n(){}return n.create=function(e){var t=Object.assign({vertex:defaultVertex,fragment:defaultFragment,geometryClass:BatchGeometry,vertexSize:6},e),r=t.vertex,o=t.fragment,D=t.vertexSize,N=t.geometryClass;return function(k){__extends$i(B,k);function B(G){var U=k.call(this,G)||this;return U.shaderGenerator=new BatchShaderGenerator(r,o),U.geometryClass=N,U.vertexSize=D,U}return B}(AbstractBatchRenderer)},Object.defineProperty(n,"defaultVertexSrc",{get:function(){return defaultVertex},enumerable:!1,configurable:!0}),Object.defineProperty(n,"defaultFragmentTemplate",{get:function(){return defaultFragment},enumerable:!1,configurable:!0}),n}(),BatchRenderer=BatchPluginFactory.create();Object.assign(BatchRenderer,{extension:{name:"batch",type:ExtensionType.RendererPlugin}});/*!
 * @pixi/accessibility - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/accessibility is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);var KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2,AccessibilityManager=function(){function n(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile.tablet||isMobile.phone)&&this.createTouchHook();var t=document.createElement("div");t.style.width=DIV_TOUCH_SIZE+"px",t.style.height=DIV_TOUCH_SIZE+"px",t.style.position="absolute",t.style.top=DIV_TOUCH_POS_X+"px",t.style.left=DIV_TOUCH_POS_Y+"px",t.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(n.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),n.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width=DIV_HOOK_SIZE+"px",t.style.height=DIV_HOOK_SIZE+"px",t.style.position="absolute",t.style.top=DIV_HOOK_POS_X+"px",t.style.left=DIV_HOOK_POS_Y+"px",t.style.zIndex=DIV_HOOK_ZINDEX.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",function(){e._isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t},n.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},n.prototype.activate=function(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)===null||e===void 0||e.appendChild(this.div))},n.prototype.deactivate=function(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)===null||e===void 0||e.removeChild(this.div))},n.prototype.updateAccessibleObjects=function(e){if(!(!e.visible||!e.accessibleChildren)){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);var t=e.children;if(t)for(var r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}},n.prototype.update=function(){var e=performance.now();if(!(isMobile.android.device&&e<this.androidUpdateCount)&&(this.androidUpdateCount=e+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),r=t.left,o=t.top,D=t.width,N=t.height,k=this.renderer,B=k.width,G=k.height,U=k.resolution,H=D/B*U,$=N/G*U,V=this.div;V.style.left=r+"px",V.style.top=o+"px",V.style.width=B+"px",V.style.height=G+"px";for(var Y=0;Y<this.children.length;Y++){var X=this.children[Y];if(X.renderId!==this.renderId)X._accessibleActive=!1,removeItems(this.children,Y,1),this.div.removeChild(X._accessibleDiv),this.pool.push(X._accessibleDiv),X._accessibleDiv=null,Y--;else{V=X._accessibleDiv;var z=X.hitArea,W=X.worldTransform;X.hitArea?(V.style.left=(W.tx+z.x*W.a)*H+"px",V.style.top=(W.ty+z.y*W.d)*$+"px",V.style.width=z.width*W.a*H+"px",V.style.height=z.height*W.d*$+"px"):(z=X.getBounds(),this.capHitArea(z),V.style.left=z.x*H+"px",V.style.top=z.y*$+"px",V.style.width=z.width*H+"px",V.style.height=z.height*$+"px",V.title!==X.accessibleTitle&&X.accessibleTitle!==null&&(V.title=X.accessibleTitle),V.getAttribute("aria-label")!==X.accessibleHint&&X.accessibleHint!==null&&V.setAttribute("aria-label",X.accessibleHint)),(X.accessibleTitle!==V.title||X.tabIndex!==V.tabIndex)&&(V.title=X.accessibleTitle,V.tabIndex=X.tabIndex,this.debug&&this.updateDebugHTML(V))}}this.renderId++}},n.prototype.updateDebugHTML=function(e){e.innerHTML="type: "+e.type+"</br> title : "+e.title+"</br> tabIndex: "+e.tabIndex},n.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);var t=this.renderer,r=t.width,o=t.height;e.x+e.width>r&&(e.width=r-e.x),e.y+e.height>o&&(e.height=o-e.y)},n.prototype.addChild=function(e){var t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=DIV_TOUCH_SIZE+"px",t.style.height=DIV_TOUCH_SIZE+"px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=DIV_TOUCH_ZINDEX.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title="displayObject "+e.tabIndex),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},n.prototype._onClick=function(e){var t=this.renderer.plugins.interaction,r=e.target.displayObject,o=t.eventData;t.dispatchEvent(r,"click",o),t.dispatchEvent(r,"pointertap",o),t.dispatchEvent(r,"tap",o)},n.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var t=this.renderer.plugins.interaction,r=e.target.displayObject,o=t.eventData;t.dispatchEvent(r,"mouseover",o)},n.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var t=this.renderer.plugins.interaction,r=e.target.displayObject,o=t.eventData;t.dispatchEvent(r,"mouseout",o)},n.prototype._onKeyDown=function(e){e.keyCode===KEY_CODE_TAB&&this.activate()},n.prototype._onMouseMove=function(e){e.movementX===0&&e.movementY===0||this.deactivate()},n.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},n.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]},n}();/*!
 * @pixi/interaction - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var InteractionData=function(){function n(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(n.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),n.prototype.getLocalPosition=function(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)},n.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var t="buttons"in e&&e.buttons;this.buttons=Number.isInteger(t)?t:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},n.prototype.reset=function(){this.isPrimary=!1},n}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$h=function(n,e){return extendStatics$h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$h(n,e)};function __extends$h(n,e){extendStatics$h(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var InteractionEvent=function(){function n(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return n.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},n.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},n}(),InteractionTrackingData=function(){function n(e){this._pointerId=e,this._flags=n.FLAGS.NONE}return n.prototype._doSet=function(e,t){t?this._flags=this._flags|e:this._flags=this._flags&~e},Object.defineProperty(n.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"none",{get:function(){return this._flags===n.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"over",{get:function(){return(this._flags&n.FLAGS.OVER)!==0},set:function(e){this._doSet(n.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rightDown",{get:function(){return(this._flags&n.FLAGS.RIGHT_DOWN)!==0},set:function(e){this._doSet(n.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leftDown",{get:function(){return(this._flags&n.FLAGS.LEFT_DOWN)!==0},set:function(e){this._doSet(n.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),n.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),n}(),TreeSearch=function(){function n(){this._tempPoint=new Point}return n.prototype.recursiveFindHit=function(e,t,r,o,D){var N;if(!t||!t.visible)return!1;var k=e.data.global;D=t.interactive||D;var B=!1,G=D,U=!0;if(t.hitArea)o&&(t.worldTransform.applyInverse(k,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?B=!0:(o=!1,U=!1)),G=!1;else if(t._mask&&o){var H=t._mask.isMaskData?t._mask.maskObject:t._mask;H&&!(!((N=H.containsPoint)===null||N===void 0)&&N.call(H,k))&&(o=!1)}if(U&&t.interactiveChildren&&t.children)for(var $=t.children,V=$.length-1;V>=0;V--){var Y=$[V],X=this.recursiveFindHit(e,Y,r,o,G);if(X){if(!Y.parent)continue;G=!1,X&&(e.target&&(o=!1),B=!0)}}return D&&(o&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(k)&&(B=!0),t.interactive&&(B&&!e.target&&(e.target=t),r&&r(e,t,!!B))),B},n.prototype.findHit=function(e,t,r,o){this.recursiveFindHit(e,t,r,o,!1)},n}(),interactiveTarget={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(n){n?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};DisplayObject.mixin(interactiveTarget);var MOUSE_POINTER_ID=1,hitTestEvent={target:null,data:{global:null}},InteractionManager=function(n){__extends$h(e,n);function e(t,r){var o=n.call(this)||this;return r=r||{},o.renderer=t,o.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,o.interactionFrequency=r.interactionFrequency||10,o.mouse=new InteractionData,o.mouse.identifier=MOUSE_POINTER_ID,o.mouse.global.set(-999999),o.activeInteractionData={},o.activeInteractionData[MOUSE_POINTER_ID]=o.mouse,o.interactionDataPool=[],o.eventData=new InteractionEvent,o.interactionDOMElement=null,o.moveWhenInside=!1,o.eventsAdded=!1,o.tickerAdded=!1,o.mouseOverRenderer=!("PointerEvent"in globalThis),o.supportsTouchEvents="ontouchstart"in globalThis,o.supportsPointerEvents=!!globalThis.PointerEvent,o.onPointerUp=o.onPointerUp.bind(o),o.processPointerUp=o.processPointerUp.bind(o),o.onPointerCancel=o.onPointerCancel.bind(o),o.processPointerCancel=o.processPointerCancel.bind(o),o.onPointerDown=o.onPointerDown.bind(o),o.processPointerDown=o.processPointerDown.bind(o),o.onPointerMove=o.onPointerMove.bind(o),o.processPointerMove=o.processPointerMove.bind(o),o.onPointerOut=o.onPointerOut.bind(o),o.processPointerOverOut=o.processPointerOverOut.bind(o),o.onPointerOver=o.onPointerOver.bind(o),o.cursorStyles={default:"inherit",pointer:"pointer"},o.currentCursorMode=null,o.cursor=null,o.resolution=1,o.delayedEvents=[],o.search=new TreeSearch,o._tempDisplayObject=new TemporaryDisplayObject,o._eventListenerOptions={capture:!0,passive:!1},o._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,o.setTargetElement(o.renderer.view,o.renderer.resolution),o}return Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,r){return hitTestEvent.target=null,hitTestEvent.data.global=t,r||(r=this.lastObjectRendered),this.processInteractive(hitTestEvent,r,null,!0),hitTestEvent.target},e.prototype.setTargetElement=function(t,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=r,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var t in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var r=this.activeInteractionData[t];if(r.originalEvent&&r.pointerType!=="touch"){var o=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){t=t||"default";var r=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(r=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var o=this.cursorStyles[t];if(o)switch(typeof o){case"string":r&&(this.interactionDOMElement.style.cursor=o);break;case"function":o(t);break;case"object":r&&Object.assign(this.interactionDOMElement.style,o);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,r,o){(!o.stopPropagationHint||t===o.stopsPropagatingAt)&&(o.currentTarget=t,o.type=r,t.emit(r,o),t[r]&&t[r](o))},e.prototype.delayDispatchEvent=function(t,r,o){this.delayedEvents.push({displayObject:t,eventString:r,eventData:o})},e.prototype.mapPositionToPoint=function(t,r,o){var D;this.interactionDOMElement.parentElement?D=this.interactionDOMElement.getBoundingClientRect():D={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var N=1/this.resolution;t.x=(r-D.left)*(this.interactionDOMElement.width/D.width)*N,t.y=(o-D.top)*(this.interactionDOMElement.height/D.height)*N},e.prototype.processInteractive=function(t,r,o,D){var N=this.search.findHit(t,r,o,D),k=this.delayedEvents;if(!k.length)return N;t.stopPropagationHint=!1;var B=k.length;this.delayedEvents=[];for(var G=0;G<B;G++){var U=k[G],H=U.displayObject,$=U.eventString,V=U.eventData;V.stopsPropagatingAt===H&&(V.stopPropagationHint=!0),this.dispatchEvent(H,$,V)}return N},e.prototype.onPointerDown=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t);if(this.autoPreventDefault&&r[0].isNormalized){var o=t.cancelable||!("cancelable"in t);o&&t.preventDefault()}for(var D=r.length,N=0;N<D;N++){var k=r[N],B=this.getInteractionDataForPointerId(k),G=this.configureInteractionEventForDOMEvent(this.eventData,k,B);if(G.data.originalEvent=t,this.processInteractive(G,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",G),k.pointerType==="touch")this.emit("touchstart",G);else if(k.pointerType==="mouse"||k.pointerType==="pen"){var U=k.button===2;this.emit(U?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,r,o){var D=t.data,N=t.data.identifier;if(o){if(r.trackedPointers[N]||(r.trackedPointers[N]=new InteractionTrackingData(N)),this.dispatchEvent(r,"pointerdown",t),D.pointerType==="touch")this.dispatchEvent(r,"touchstart",t);else if(D.pointerType==="mouse"||D.pointerType==="pen"){var k=D.button===2;k?r.trackedPointers[N].rightDown=!0:r.trackedPointers[N].leftDown=!0,this.dispatchEvent(r,k?"rightdown":"mousedown",t)}}},e.prototype.onPointerComplete=function(t,r,o){var D=this.normalizeToPointerData(t),N=D.length,k=t.target;t.composedPath&&t.composedPath().length>0&&(k=t.composedPath()[0]);for(var B=k!==this.interactionDOMElement?"outside":"",G=0;G<N;G++){var U=D[G],H=this.getInteractionDataForPointerId(U),$=this.configureInteractionEventForDOMEvent(this.eventData,U,H);if($.data.originalEvent=t,this.processInteractive($,this.lastObjectRendered,o,r||!B),this.emit(r?"pointercancel":"pointerup"+B,$),U.pointerType==="mouse"||U.pointerType==="pen"){var V=U.button===2;this.emit(V?"rightup"+B:"mouseup"+B,$)}else U.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+B,$),this.releaseInteractionDataForPointerId(U.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,r){var o=t.data,D=t.data.identifier;r.trackedPointers[D]!==void 0&&(delete r.trackedPointers[D],this.dispatchEvent(r,"pointercancel",t),o.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,r,o){var D=t.data,N=t.data.identifier,k=r.trackedPointers[N],B=D.pointerType==="touch",G=D.pointerType==="mouse"||D.pointerType==="pen",U=!1;if(G){var H=D.button===2,$=InteractionTrackingData.FLAGS,V=H?$.RIGHT_DOWN:$.LEFT_DOWN,Y=k!==void 0&&k.flags&V;o?(this.dispatchEvent(r,H?"rightup":"mouseup",t),Y&&(this.dispatchEvent(r,H?"rightclick":"click",t),U=!0)):Y&&this.dispatchEvent(r,H?"rightupoutside":"mouseupoutside",t),k&&(H?k.rightDown=!1:k.leftDown=!1)}o?(this.dispatchEvent(r,"pointerup",t),B&&this.dispatchEvent(r,"touchend",t),k&&((!G||U)&&this.dispatchEvent(r,"pointertap",t),B&&(this.dispatchEvent(r,"tap",t),k.over=!1))):k&&(this.dispatchEvent(r,"pointerupoutside",t),B&&this.dispatchEvent(r,"touchendoutside",t)),k&&k.none&&delete r.trackedPointers[N]},e.prototype.onPointerMove=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var o=r.length,D=0;D<o;D++){var N=r[D],k=this.getInteractionDataForPointerId(N),B=this.configureInteractionEventForDOMEvent(this.eventData,N,k);B.data.originalEvent=t,this.processInteractive(B,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",B),N.pointerType==="touch"&&this.emit("touchmove",B),(N.pointerType==="mouse"||N.pointerType==="pen")&&this.emit("mousemove",B)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,r,o){var D=t.data,N=D.pointerType==="touch",k=D.pointerType==="mouse"||D.pointerType==="pen";k&&this.processPointerOverOut(t,r,o),(!this.moveWhenInside||o)&&(this.dispatchEvent(r,"pointermove",t),N&&this.dispatchEvent(r,"touchmove",t),k&&this.dispatchEvent(r,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t),o=r[0];o.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var D=this.getInteractionDataForPointerId(o),N=this.configureInteractionEventForDOMEvent(this.eventData,o,D);N.data.originalEvent=o,this.processInteractive(N,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",N),o.pointerType==="mouse"||o.pointerType==="pen"?this.emit("mouseout",N):this.releaseInteractionDataForPointerId(D.identifier)}},e.prototype.processPointerOverOut=function(t,r,o){var D=t.data,N=t.data.identifier,k=D.pointerType==="mouse"||D.pointerType==="pen",B=r.trackedPointers[N];o&&!B&&(B=r.trackedPointers[N]=new InteractionTrackingData(N)),B!==void 0&&(o&&this.mouseOverRenderer?(B.over||(B.over=!0,this.delayDispatchEvent(r,"pointerover",t),k&&this.delayDispatchEvent(r,"mouseover",t)),k&&this.cursor===null&&(this.cursor=r.cursor)):B.over&&(B.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),k&&this.dispatchEvent(r,"mouseout",t),B.none&&delete r.trackedPointers[N]))},e.prototype.onPointerOver=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t),o=r[0],D=this.getInteractionDataForPointerId(o),N=this.configureInteractionEventForDOMEvent(this.eventData,o,D);N.data.originalEvent=o,o.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",N),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mouseover",N)}},e.prototype.getInteractionDataForPointerId=function(t){var r=t.pointerId,o;return r===MOUSE_POINTER_ID||t.pointerType==="mouse"?o=this.mouse:this.activeInteractionData[r]?o=this.activeInteractionData[r]:(o=this.interactionDataPool.pop()||new InteractionData,o.identifier=r,this.activeInteractionData[r]=o),o.copyEvent(t),o},e.prototype.releaseInteractionDataForPointerId=function(t){var r=this.activeInteractionData[t];r&&(delete this.activeInteractionData[t],r.reset(),this.interactionDataPool.push(r))},e.prototype.configureInteractionEventForDOMEvent=function(t,r,o){return t.data=o,this.mapPositionToPoint(o.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=o.global.x,r.globalY=o.global.y),o.originalEvent=r,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var o=0,D=t.changedTouches.length;o<D;o++){var N=t.changedTouches[o];typeof N.button>"u"&&(N.button=t.touches.length?1:0),typeof N.buttons>"u"&&(N.buttons=t.touches.length?1:0),typeof N.isPrimary>"u"&&(N.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof N.width>"u"&&(N.width=N.radiusX||1),typeof N.height>"u"&&(N.height=N.radiusY||1),typeof N.tiltX>"u"&&(N.tiltX=0),typeof N.tiltY>"u"&&(N.tiltY=0),typeof N.pointerType>"u"&&(N.pointerType="touch"),typeof N.pointerId>"u"&&(N.pointerId=N.identifier||0),typeof N.pressure>"u"&&(N.pressure=N.force||.5),typeof N.twist>"u"&&(N.twist=0),typeof N.tangentialPressure>"u"&&(N.tangentialPressure=0),typeof N.layerX>"u"&&(N.layerX=N.offsetX=N.clientX),typeof N.layerY>"u"&&(N.layerY=N.offsetY=N.clientY),N.isNormalized=!0,r.push(N)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){var k=t;typeof k.isPrimary>"u"&&(k.isPrimary=!0),typeof k.width>"u"&&(k.width=1),typeof k.height>"u"&&(k.height=1),typeof k.tiltX>"u"&&(k.tiltX=0),typeof k.tiltY>"u"&&(k.tiltY=0),typeof k.pointerType>"u"&&(k.pointerType="mouse"),typeof k.pointerId>"u"&&(k.pointerId=MOUSE_POINTER_ID),typeof k.pressure>"u"&&(k.pressure=.5),typeof k.twist>"u"&&(k.twist=0),typeof k.tangentialPressure>"u"&&(k.tangentialPressure=0),k.isNormalized=!0,r.push(k)}else r.push(t);return r},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e.extension={name:"interaction",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]},e}(i);/*!
 * @pixi/extract - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extract is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var TEMP_RECT=new Rectangle,BYTES_PER_PIXEL=4,Extract=function(){function n(e){this.renderer=e}return n.prototype.image=function(e,t,r){var o=new Image;return o.src=this.base64(e,t,r),o},n.prototype.base64=function(e,t,r){return this.canvas(e).toDataURL(t,r)},n.prototype.canvas=function(e,t){var r=this._rawPixels(e,t),o=r.pixels,D=r.width,N=r.height,k=r.flipY,B=new CanvasRenderTarget(D,N,1),G=B.context.getImageData(0,0,D,N);if(n.arrayPostDivide(o,G.data),B.context.putImageData(G,0,0),k){var U=new CanvasRenderTarget(B.width,B.height,1);U.context.scale(1,-1),U.context.drawImage(B.canvas,0,-N),B.destroy(),B=U}return B.canvas},n.prototype.pixels=function(e,t){var r=this._rawPixels(e,t).pixels;return n.arrayPostDivide(r,r),r},n.prototype._rawPixels=function(e,t){var r=this.renderer,o,D=!1,N,k=!1;if(e)if(e instanceof RenderTexture)N=e;else{var B=r.context.webGLVersion>=2?r.multisample:MSAA_QUALITY.NONE;if(N=this.renderer.generateTexture(e,{multisample:B}),B!==MSAA_QUALITY.NONE){var G=RenderTexture.create({width:N.width,height:N.height});r.framebuffer.bind(N.framebuffer),r.framebuffer.blit(G.framebuffer),r.framebuffer.bind(null),N.destroy(!0),N=G}k=!0}N?(o=N.baseTexture.resolution,t=t??N.frame,D=!1,r.renderTexture.bind(N)):(o=r.resolution,t||(t=TEMP_RECT,t.width=r.width,t.height=r.height),D=!0,r.renderTexture.bind(null));var U=Math.round(t.width*o),H=Math.round(t.height*o),$=new Uint8Array(BYTES_PER_PIXEL*U*H),V=r.gl;return V.readPixels(Math.round(t.x*o),Math.round(t.y*o),U,H,V.RGBA,V.UNSIGNED_BYTE,$),k&&N.destroy(!0),{pixels:$,width:U,height:H,flipY:D}},n.prototype.destroy=function(){this.renderer=null},n.arrayPostDivide=function(e,t){for(var r=0;r<e.length;r+=4){var o=t[r+3]=e[r+3];o!==0?(t[r]=Math.round(Math.min(e[r]*255/o,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/o,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/o,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}},n.extension={name:"extract",type:ExtensionType.RendererPlugin},n}();/*!
 * @pixi/loaders - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/loaders is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var SignalBinding=function(){function n(e,t,r){t===void 0&&(t=!1),this._fn=e,this._once=t,this._thisArg=r,this._next=this._prev=this._owner=null}return n.prototype.detach=function(){return this._owner===null?!1:(this._owner.detach(this),!0)},n}();function _addSignalBinding(n,e){return n._head?(n._tail._next=e,e._prev=n._tail,n._tail=e):(n._head=e,n._tail=e),e._owner=n,e}var Signal=function(){function n(){this._head=this._tail=void 0}return n.prototype.handlers=function(e){e===void 0&&(e=!1);var t=this._head;if(e)return!!t;for(var r=[];t;)r.push(t),t=t._next;return r},n.prototype.has=function(e){if(!(e instanceof SignalBinding))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return e._owner===this},n.prototype.dispatch=function(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];var o=this._head;if(!o)return!1;for(;o;)o._once&&this.detach(o),o._fn.apply(o._thisArg,t),o=o._next;return!0},n.prototype.add=function(e,t){if(t===void 0&&(t=null),typeof e!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return _addSignalBinding(this,new SignalBinding(e,!1,t))},n.prototype.once=function(e,t){if(t===void 0&&(t=null),typeof e!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return _addSignalBinding(this,new SignalBinding(e,!0,t))},n.prototype.detach=function(e){if(!(e instanceof SignalBinding))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return e._owner!==this?this:(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,e._next===null&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null,this)},n.prototype.detachAll=function(){var e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this},n}();function parseUri(n,e){e=e||{};for(var t={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=t.parser[e.strictMode?"strict":"loose"].exec(n),o={},D=14;D--;)o[t.key[D]]=r[D]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,function(N,k,B){k&&(o[t.q.name][k]=B)}),o}var useXdr,tempAnchor=null,STATUS_NONE=0,STATUS_OK=200,STATUS_EMPTY=204,STATUS_IE_BUG_EMPTY=1223,STATUS_TYPE_OK=2;function _noop$1(){}function setExtMap(n,e,t){e&&e.indexOf(".")===0&&(e=e.substring(1)),e&&(n[e]=t)}function reqType(n){return n.toString().replace("object ","")}var LoaderResource=function(){function n(e,t,r){if(this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,typeof e!="string"||typeof t!="string")throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(n.STATUS_FLAGS.DATA_URL,t.indexOf("data:")===0),this.name=e,this.url=t,this.extension=this._getExtension(),this.data=null,this.crossOrigin=r.crossOrigin===!0?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=n.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Signal,this.onProgress=new Signal,this.onComplete=new Signal,this.onAfterMiddleware=new Signal}return n.setExtensionLoadType=function(e,t){setExtMap(n._loadTypeMap,e,t)},n.setExtensionXhrType=function(e,t){setExtMap(n._xhrTypeMap,e,t)},Object.defineProperty(n.prototype,"isDataUrl",{get:function(){return this._hasFlag(n.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isComplete",{get:function(){return this._hasFlag(n.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._hasFlag(n.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),n.prototype.complete=function(){this._clearEvents(),this._finish()},n.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=n.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},n.prototype.load=function(e){var t=this;if(!this.isLoading){if(this.isComplete){e&&setTimeout(function(){return e(t)},1);return}else e&&this.onComplete.once(e);switch(this._setFlag(n.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case n.LOAD_TYPE.IMAGE:this.type=n.TYPE.IMAGE,this._loadElement("image");break;case n.LOAD_TYPE.AUDIO:this.type=n.TYPE.AUDIO,this._loadSourceElement("audio");break;case n.LOAD_TYPE.VIDEO:this.type=n.TYPE.VIDEO,this._loadSourceElement("video");break;case n.LOAD_TYPE.XHR:default:typeof useXdr>"u"&&(useXdr=!!(globalThis.XDomainRequest&&!("withCredentials"in new XMLHttpRequest))),useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},n.prototype._hasFlag=function(e){return(this._flags&e)!==0},n.prototype._setFlag=function(e,t){this._flags=t?this._flags|e:this._flags&~e},n.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},n.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(n.STATUS_FLAGS.COMPLETE,!0),this._setFlag(n.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},n.prototype._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:e==="image"&&typeof globalThis.Image<"u"?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},n.prototype._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:e==="audio"&&typeof globalThis.Audio<"u"?this.data=new Audio:this.data=document.createElement(e),this.data===null){this.abort("Unsupported element: "+e);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(e,this.url[r],Array.isArray(t)?t[r]:t));else{var t=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(t)?t[0]:t))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},n.prototype._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;this.crossOrigin==="use-credentials"&&(e.withCredentials=!0),e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===n.XHR_RESPONSE_TYPE.JSON||this.xhrType===n.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=n.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},n.prototype._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new globalThis.XDomainRequest;e.timeout=this.timeout||5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXhrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){return e.send()},1)},n.prototype._createSource=function(e,t,r){r||(r=e+"/"+this._getExtension(t));var o=document.createElement("source");return o.src=t,o.type=r,o},n.prototype._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},n.prototype._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},n.prototype._onTimeout=function(){this.abort("Load timed out.")},n.prototype._xhrOnError=function(){var e=this.xhr;this.abort(reqType(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},n.prototype._xhrOnTimeout=function(){var e=this.xhr;this.abort(reqType(e)+" Request timed out.")},n.prototype._xhrOnAbort=function(){var e=this.xhr;this.abort(reqType(e)+" Request was aborted by the user.")},n.prototype._xhrOnLoad=function(){var e=this.xhr,t="",r=typeof e.status>"u"?STATUS_OK:e.status;(e.responseType===""||e.responseType==="text"||typeof e.responseType>"u")&&(t=e.responseText),r===STATUS_NONE&&(t.length>0||e.responseType===n.XHR_RESPONSE_TYPE.BUFFER)?r=STATUS_OK:r===STATUS_IE_BUG_EMPTY&&(r=STATUS_EMPTY);var o=r/100|0;if(o===STATUS_TYPE_OK)if(this.xhrType===n.XHR_RESPONSE_TYPE.TEXT)this.data=t,this.type=n.TYPE.TEXT;else if(this.xhrType===n.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(t),this.type=n.TYPE.JSON}catch(k){this.abort("Error trying to parse loaded json: "+k);return}else if(this.xhrType===n.XHR_RESPONSE_TYPE.DOCUMENT)try{if(globalThis.DOMParser){var D=new DOMParser;this.data=D.parseFromString(t,"text/xml")}else{var N=document.createElement("div");N.innerHTML=t,this.data=N}this.type=n.TYPE.XML}catch(k){this.abort("Error trying to parse loaded xml: "+k);return}else this.data=e.response||t;else{this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL);return}this.complete()},n.prototype._determineCrossOrigin=function(e,t){if(e.indexOf("data:")===0)return"";if(globalThis.origin!==globalThis.location.origin)return"anonymous";t=t||globalThis.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=e;var r=parseUri(tempAnchor.href,{strictMode:!0}),o=!r.port&&t.port===""||r.port===t.port,D=r.protocol?r.protocol+":":"";return r.host!==t.hostname||!o||D!==t.protocol?"anonymous":""},n.prototype._determineXhrType=function(){return n._xhrTypeMap[this.extension]||n.XHR_RESPONSE_TYPE.TEXT},n.prototype._determineLoadType=function(){return n._loadTypeMap[this.extension]||n.LOAD_TYPE.XHR},n.prototype._getExtension=function(e){e===void 0&&(e=this.url);var t="";if(this.isDataUrl){var r=e.indexOf("/");t=e.substring(r+1,e.indexOf(";",r))}else{var o=e.indexOf("?"),D=e.indexOf("#"),N=Math.min(o>-1?o:e.length,D>-1?D:e.length);e=e.substring(0,N),t=e.substring(e.lastIndexOf(".")+1)}return t.toLowerCase()},n.prototype._getMimeFromXhrType=function(e){switch(e){case n.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case n.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case n.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case n.XHR_RESPONSE_TYPE.JSON:return"application/json";case n.XHR_RESPONSE_TYPE.DEFAULT:case n.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},n}();(function(n){(function(e){e[e.NONE=0]="NONE",e[e.DATA_URL=1]="DATA_URL",e[e.COMPLETE=2]="COMPLETE",e[e.LOADING=4]="LOADING"})(n.STATUS_FLAGS||(n.STATUS_FLAGS={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.XML=2]="XML",e[e.IMAGE=3]="IMAGE",e[e.AUDIO=4]="AUDIO",e[e.VIDEO=5]="VIDEO",e[e.TEXT=6]="TEXT"}(n.TYPE||(n.TYPE={})),function(e){e[e.XHR=1]="XHR",e[e.IMAGE=2]="IMAGE",e[e.AUDIO=3]="AUDIO",e[e.VIDEO=4]="VIDEO"}(n.LOAD_TYPE||(n.LOAD_TYPE={})),function(e){e.DEFAULT="text",e.BUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json",e.TEXT="text"}(n.XHR_RESPONSE_TYPE||(n.XHR_RESPONSE_TYPE={})),n._loadTypeMap={gif:n.LOAD_TYPE.IMAGE,png:n.LOAD_TYPE.IMAGE,bmp:n.LOAD_TYPE.IMAGE,jpg:n.LOAD_TYPE.IMAGE,jpeg:n.LOAD_TYPE.IMAGE,tif:n.LOAD_TYPE.IMAGE,tiff:n.LOAD_TYPE.IMAGE,webp:n.LOAD_TYPE.IMAGE,tga:n.LOAD_TYPE.IMAGE,avif:n.LOAD_TYPE.IMAGE,svg:n.LOAD_TYPE.IMAGE,"svg+xml":n.LOAD_TYPE.IMAGE,mp3:n.LOAD_TYPE.AUDIO,ogg:n.LOAD_TYPE.AUDIO,wav:n.LOAD_TYPE.AUDIO,mp4:n.LOAD_TYPE.VIDEO,webm:n.LOAD_TYPE.VIDEO},n._xhrTypeMap={xhtml:n.XHR_RESPONSE_TYPE.DOCUMENT,html:n.XHR_RESPONSE_TYPE.DOCUMENT,htm:n.XHR_RESPONSE_TYPE.DOCUMENT,xml:n.XHR_RESPONSE_TYPE.DOCUMENT,tmx:n.XHR_RESPONSE_TYPE.DOCUMENT,svg:n.XHR_RESPONSE_TYPE.DOCUMENT,tsx:n.XHR_RESPONSE_TYPE.DOCUMENT,gif:n.XHR_RESPONSE_TYPE.BLOB,png:n.XHR_RESPONSE_TYPE.BLOB,bmp:n.XHR_RESPONSE_TYPE.BLOB,jpg:n.XHR_RESPONSE_TYPE.BLOB,jpeg:n.XHR_RESPONSE_TYPE.BLOB,tif:n.XHR_RESPONSE_TYPE.BLOB,tiff:n.XHR_RESPONSE_TYPE.BLOB,webp:n.XHR_RESPONSE_TYPE.BLOB,tga:n.XHR_RESPONSE_TYPE.BLOB,avif:n.XHR_RESPONSE_TYPE.BLOB,json:n.XHR_RESPONSE_TYPE.JSON,text:n.XHR_RESPONSE_TYPE.TEXT,txt:n.XHR_RESPONSE_TYPE.TEXT,ttf:n.XHR_RESPONSE_TYPE.BUFFER,otf:n.XHR_RESPONSE_TYPE.BUFFER},n.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})(LoaderResource||(LoaderResource={}));function _noop(){}function onlyOnce(n){return function(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];if(n===null)throw new Error("Callback was already called.");var o=n;n=null,o.apply(this,t)}}var AsyncQueueItem=function(){function n(e,t){this.data=e,this.callback=t}return n}(),AsyncQueue=function(){function n(e,t){var r=this;if(t===void 0&&(t=1),this.workers=0,this.saturated=_noop,this.unsaturated=_noop,this.empty=_noop,this.drain=_noop,this.error=_noop,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(o,D,N){if(N&&typeof N!="function")throw new Error("task callback must be a function");if(r.started=!0,o==null&&r.idle()){setTimeout(function(){return r.drain()},1);return}var k=new AsyncQueueItem(o,typeof N=="function"?N:_noop);D?r._tasks.unshift(k):r._tasks.push(k),setTimeout(r.process,1)},this.process=function(){for(;!r.paused&&r.workers<r.concurrency&&r._tasks.length;){var o=r._tasks.shift();r._tasks.length===0&&r.empty(),r.workers+=1,r.workers===r.concurrency&&r.saturated(),r._worker(o.data,onlyOnce(r._next(o)))}},this._worker=e,t===0)throw new Error("Concurrency must not be zero");this.concurrency=t,this.buffer=t/4}return n.prototype._next=function(e){var t=this;return function(){for(var r=arguments,o=[],D=0;D<arguments.length;D++)o[D]=r[D];t.workers-=1,e.callback.apply(e,o),o[0]!=null&&t.error(o[0],e.data),t.workers<=t.concurrency-t.buffer&&t.unsaturated(),t.idle()&&t.drain(),t.process()}},n.prototype.push=function(e,t){this._insert(e,!1,t)},n.prototype.kill=function(){this.workers=0,this.drain=_noop,this.started=!1,this._tasks=[]},n.prototype.unshift=function(e,t){this._insert(e,!0,t)},n.prototype.length=function(){return this._tasks.length},n.prototype.running=function(){return this.workers},n.prototype.idle=function(){return this._tasks.length+this.workers===0},n.prototype.pause=function(){this.paused!==!0&&(this.paused=!0)},n.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var e=1;e<=this.concurrency;e++)this.process()}},n.eachSeries=function(e,t,r,o){var D=0,N=e.length;function k(B){if(B||D===N){r&&r(B);return}o?setTimeout(function(){t(e[D++],k)},1):t(e[D++],k)}k()},n.queue=function(e,t){return new n(e,t)},n}(),MAX_PROGRESS=100,rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=function(){function n(e,t){var r=this;e===void 0&&(e=""),t===void 0&&(t=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(B,G){return r._loadResource(B,G)},this.resources={},this.baseUrl=e,this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(B,G){return r._loadResource(B,G)},this._queue=AsyncQueue.queue(this._boundLoadResource,t),this._queue.pause(),this.resources={},this.onProgress=new Signal,this.onError=new Signal,this.onLoad=new Signal,this.onStart=new Signal,this.onComplete=new Signal;for(var o=0;o<n._plugins.length;++o){var D=n._plugins[o],N=D.pre,k=D.use;N&&this.pre(N),k&&this.use(k)}this._protected=!1}return n.prototype._add=function(e,t,r,o){if(this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(t=this._prepareUrl(t),this.resources[e]=new LoaderResource(e,t,r),typeof o=="function"&&this.resources[e].onAfterMiddleware.once(o),this.loading){for(var D=r.parentResource,N=[],k=0;k<D.children.length;++k)D.children[k].isComplete||N.push(D.children[k]);var B=D.progressChunk*(N.length+1),G=B/(N.length+2);D.children.push(this.resources[e]),D.progressChunk=G;for(var k=0;k<N.length;++k)N[k].progressChunk=G;this.resources[e].progressChunk=G}return this._queue.push(this.resources[e]),this},n.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},n.prototype.use=function(e){return this._afterMiddleware.push(e),this},n.prototype.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var e in this.resources){var t=this.resources[e];t._onLoadBinding&&t._onLoadBinding.detach(),t.isLoading&&t.abort("loader reset")}return this.resources={},this},n.prototype.load=function(e){if(deprecation("6.5.0","@pixi/loaders is being replaced with @pixi/assets in the next major release."),typeof e=="function"&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var t=this._queue._tasks.length,r=MAX_PROGRESS/t,o=0;o<this._queue._tasks.length;++o)this._queue._tasks[o].data.progressChunk=r;this._onStart(),this._queue.resume()}return this},Object.defineProperty(n.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e},enumerable:!1,configurable:!0}),n.prototype._prepareUrl=function(e){var t=parseUri(e,{strictMode:!0}),r;if(t.protocol||!t.path||e.indexOf("//")===0?r=e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&e.charAt(0)!=="/"?r=this.baseUrl+"/"+e:r=this.baseUrl+e,this.defaultQueryString){var o=rgxExtractUrlHash.exec(r)[0];r=r.slice(0,r.length-o.length),r.indexOf("?")!==-1?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=o}return r},n.prototype._loadResource=function(e,t){var r=this;e._dequeue=t,AsyncQueue.eachSeries(this._beforeMiddleware,function(o,D){o.call(r,e,function(){D(e.isComplete?{}:null)})},function(){e.isComplete?r._onLoad(e):(e._onLoadBinding=e.onComplete.once(r._onLoad,r),e.load())},!0)},n.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},n.prototype._onComplete=function(){this.progress=MAX_PROGRESS,this.loading=!1,this.onComplete.dispatch(this,this.resources)},n.prototype._onLoad=function(e){var t=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),AsyncQueue.eachSeries(this._afterMiddleware,function(r,o){r.call(t,e,o)},function(){e.onAfterMiddleware.dispatch(e),t.progress=Math.min(MAX_PROGRESS,t.progress+e.progressChunk),t.onProgress.dispatch(t,e),e.error?t.onError.dispatch(e.error,t,e):t.onLoad.dispatch(t,e),t._resourcesParsing.splice(t._resourcesParsing.indexOf(e),1),t._queue.idle()&&t._resourcesParsing.length===0&&t._onComplete()},!0)},n.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(n,"shared",{get:function(){var e=n._shared;return e||(e=new n,e._protected=!0,n._shared=e),e},enumerable:!1,configurable:!0}),n.registerPlugin=function(e){return deprecation("6.5.0","Loader.registerPlugin() is deprecated, use extensions.add() instead."),extensions.add({type:ExtensionType.Loader,ref:e}),n},n._plugins=[],n}();extensions.handleByList(ExtensionType.Loader,Loader._plugins);Loader.prototype.add=function(n,e,t,r){if(Array.isArray(n)){for(var o=0;o<n.length;++o)this.add(n[o]);return this}if(typeof n=="object"&&(t=n,r=e||t.callback||t.onComplete,e=t.url,n=t.name||t.key||t.url),typeof e!="string"&&(r=t,t=e,e=n),typeof e!="string")throw new Error("No url passed to add resource to loader.");return typeof t=="function"&&(r=t,t=null),this._add(n,e,t,r)};var AppLoaderPlugin=function(){function n(){}return n.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?Loader.shared:new Loader},n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.extension=ExtensionType.Application,n}(),TextureLoader=function(){function n(){}return n.add=function(){LoaderResource.setExtensionLoadType("svg",LoaderResource.LOAD_TYPE.XHR),LoaderResource.setExtensionXhrType("svg",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},n.use=function(e,t){if(e.data&&(e.type===LoaderResource.TYPE.IMAGE||e.extension==="svg")){var r=e.data,o=e.url,D=e.name,N=e.metadata;Texture.fromLoader(r,o,D,N).then(function(k){e.texture=k,t()}).catch(t)}else t()},n.extension=ExtensionType.Loader,n}(),_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(n){for(var e="",t=0;t<n.length;){for(var r=[0,0,0],o=[0,0,0,0],D=0;D<r.length;++D)t<n.length?r[D]=n.charCodeAt(t++)&255:r[D]=0;o[0]=r[0]>>2,o[1]=(r[0]&3)<<4|r[1]>>4,o[2]=(r[1]&15)<<2|r[2]>>6,o[3]=r[2]&63;var N=t-(n.length-1);switch(N){case 2:o[3]=64,o[2]=64;break;case 1:o[3]=64;break}for(var D=0;D<o.length;++D)e+=_keyStr.charAt(o[D])}return e}function parsing(n,e){if(!n.data){e();return}if(n.xhr&&n.xhrType===LoaderResource.XHR_RESPONSE_TYPE.BLOB){if(!self.Blob||typeof n.data=="string"){var t=n.xhr.getResponseHeader("content-type");if(t&&t.indexOf("image")===0){n.data=new Image,n.data.src="data:"+t+";base64,"+encodeBinary(n.xhr.responseText),n.type=LoaderResource.TYPE.IMAGE,n.data.onload=function(){n.data.onload=null,e()};return}}else if(n.data.type.indexOf("image")===0){var r=globalThis.URL||globalThis.webkitURL,o=r.createObjectURL(n.data);n.blob=n.data,n.data=new Image,n.data.src=o,n.type=LoaderResource.TYPE.IMAGE,n.data.onload=function(){r.revokeObjectURL(o),n.data.onload=null,e()};return}}e()}var ParsingLoader=function(){function n(){}return n.extension=ExtensionType.Loader,n.use=parsing,n}();extensions.add(TextureLoader,ParsingLoader);/*!
 * @pixi/compressed-textures - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/compressed-textures is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var _a$2,INTERNAL_FORMATS;(function(n){n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR"})(INTERNAL_FORMATS||(INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=(_a$2={},_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_4x4_KHR]=1,_a$2);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$g=function(n,e){return extendStatics$g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$g(n,e)};function __extends$g(n,e){extendStatics$g(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function __awaiter(n,e,t,r){function o(D){return D instanceof t?D:new t(function(N){N(D)})}return new(t||(t=Promise))(function(D,N){function k(U){try{G(r.next(U))}catch(H){N(H)}}function B(U){try{G(r.throw(U))}catch(H){N(H)}}function G(U){U.done?D(U.value):o(U.value).then(k,B)}G((r=r.apply(n,[])).next())})}function __generator(n,e){var t={label:0,sent:function(){if(D[0]&1)throw D[1];return D[1]},trys:[],ops:[]},r,o,D,N;return N={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function k(G){return function(U){return B([G,U])}}function B(G){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(D=G[0]&2?o.return:G[0]?o.throw||((D=o.return)&&D.call(o),0):o.next)&&!(D=D.call(o,G[1])).done)return D;switch(o=0,D&&(G=[G[0]&2,D.value]),G[0]){case 0:case 1:D=G;break;case 4:return t.label++,{value:G[1],done:!1};case 5:t.label++,o=G[1],G=[0];continue;case 7:G=t.ops.pop(),t.trys.pop();continue;default:if(D=t.trys,!(D=D.length>0&&D[D.length-1])&&(G[0]===6||G[0]===2)){t=0;continue}if(G[0]===3&&(!D||G[1]>D[0]&&G[1]<D[3])){t.label=G[1];break}if(G[0]===6&&t.label<D[1]){t.label=D[1],D=G;break}if(D&&t.label<D[2]){t.label=D[2],t.ops.push(G);break}D[2]&&t.ops.pop(),t.trys.pop();continue}G=e.call(n,t)}catch(U){G=[6,U],o=0}finally{r=D=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}}var BlobResource=function(n){__extends$g(e,n);function e(t,r){r===void 0&&(r={width:1,height:1,autoLoad:!0});var o=this,D,N;return typeof t=="string"?(D=t,N=new Uint8Array):(D=null,N=t),o=n.call(this,N,r)||this,o.origin=D,o.buffer=N?new ViewableBuffer(N):null,o.origin&&r.autoLoad!==!1&&o.load(),N&&N.length&&(o.loaded=!0,o.onBlobLoaded(o.buffer.rawBinaryData)),o}return e.prototype.onBlobLoaded=function(t){},e.prototype.load=function(){return __awaiter(this,void 0,Promise,function(){var t,r,o;return __generator(this,function(D){switch(D.label){case 0:return[4,fetch(this.origin)];case 1:return t=D.sent(),[4,t.blob()];case 2:return r=D.sent(),[4,r.arrayBuffer()];case 3:return o=D.sent(),this.data=new Uint32Array(o),this.buffer=new ViewableBuffer(o),this.loaded=!0,this.onBlobLoaded(o),this.update(),[2,this]}})})},e}(BufferResource),CompressedTextureResource=function(n){__extends$g(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.format=r.format,o.levels=r.levels||1,o._width=r.width,o._height=r.height,o._extension=e._formatToExtension(o.format),(r.levelBuffers||o.buffer)&&(o._levelBuffers=r.levelBuffers||e._createLevelBuffers(t instanceof Uint8Array?t:o.buffer.uint8View,o.format,o.levels,4,4,o.width,o.height)),o}return e.prototype.upload=function(t,r,o){var D=t.gl,N=t.context.extensions[this._extension];if(!N)throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var k=0,B=this.levels;k<B;k++){var G=this._levelBuffers[k],U=G.levelID,H=G.levelWidth,$=G.levelHeight,V=G.levelBuffer;D.compressedTexImage2D(D.TEXTURE_2D,U,this.format,H,$,0,V)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(t,r,o,D,N,k,B){for(var G=new Array(o),U=t.byteOffset,H=k,$=B,V=H+D-1&~(D-1),Y=$+N-1&~(N-1),X=V*Y*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[r],z=0;z<o;z++)G[z]={levelID:z,levelWidth:o>1?H:V,levelHeight:o>1?$:Y,levelBuffer:new Uint8Array(t.buffer,U,X)},U+=X,H=H>>1||1,$=$>>1||1,V=H+D-1&~(D-1),Y=$+N-1&~(N-1),X=V*Y*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[r];return G},e}(BlobResource),CompressedTextureLoader=function(){function n(){}return n.use=function(e,t){var r=e.data,o=this;if(e.type===LoaderResource.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var D=r.textures,N=void 0,k=void 0,B=0,G=D.length;B<G;B++){var U=D[B],H=U.src,$=U.format;if($||(k=H),n.textureFormats[$]){N=H;break}}if(N=N||k,!N){t(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));return}if(N===e.url){t(new Error("URL of compressed texture cannot be the same as the manifest's URL"));return}var V={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},Y=url$1.resolve(e.url.replace(o.baseUrl,""),N),X=r.cacheID;o.add(X,Y,V,function(z){if(z.error){t(z.error);return}var W=z.texture,q=W===void 0?null:W,K=z.textures,Q=K===void 0?{}:K;Object.assign(e,{texture:q,textures:Q}),t()})}else t()},Object.defineProperty(n,"textureExtensions",{get:function(){if(!n._textureExtensions){var e=settings.ADAPTER.createCanvas(),t=e.getContext("webgl");if(!t)return console.warn("WebGL not available for compressed textures. Silently failing."),{};var r={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};n._textureExtensions=r}return n._textureExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(n,"textureFormats",{get:function(){if(!n._textureFormats){var e=n.textureExtensions;n._textureFormats={};for(var t in e){var r=e[t];r&&Object.assign(n._textureFormats,Object.getPrototypeOf(r))}}return n._textureFormats},enumerable:!1,configurable:!0}),n.extension=ExtensionType.Loader,n}();function registerCompressedTextures(n,e,t){var r={textures:{},texture:null};if(!e)return r;var o=e.map(function(D){return new Texture(new BaseTexture(D,Object.assign({mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},t)))});return o.forEach(function(D,N){var k=D.baseTexture,B=n+"-"+(N+1);BaseTexture.addToCache(k,B),Texture.addToCache(D,B),N===0&&(BaseTexture.addToCache(k,n),Texture.addToCache(D,n),r.texture=D),r.textures[B]=D}),r}var _a$1,_b$1,DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={FOURCC:2},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},DXGI_FORMAT;(function(n){n[n.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",n[n.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",n[n.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",n[n.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",n[n.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",n[n.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",n[n.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",n[n.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",n[n.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",n[n.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",n[n.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",n[n.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",n[n.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",n[n.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",n[n.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",n[n.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",n[n.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",n[n.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",n[n.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",n[n.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",n[n.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",n[n.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",n[n.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",n[n.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",n[n.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",n[n.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",n[n.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",n[n.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",n[n.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",n[n.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",n[n.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",n[n.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",n[n.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",n[n.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",n[n.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",n[n.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",n[n.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",n[n.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",n[n.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",n[n.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",n[n.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",n[n.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",n[n.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",n[n.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",n[n.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",n[n.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",n[n.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",n[n.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",n[n.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",n[n.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",n[n.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",n[n.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",n[n.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",n[n.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",n[n.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",n[n.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",n[n.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",n[n.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",n[n.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",n[n.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",n[n.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",n[n.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",n[n.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",n[n.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",n[n.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",n[n.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",n[n.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",n[n.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",n[n.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",n[n.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",n[n.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",n[n.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",n[n.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",n[n.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",n[n.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",n[n.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",n[n.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",n[n.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",n[n.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",n[n.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",n[n.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",n[n.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",n[n.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",n[n.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",n[n.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",n[n.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",n[n.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",n[n.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",n[n.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",n[n.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",n[n.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",n[n.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",n[n.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",n[n.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",n[n.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",n[n.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",n[n.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",n[n.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",n[n.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",n[n.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",n[n.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",n[n.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",n[n.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",n[n.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",n[n.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",n[n.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",n[n.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",n[n.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",n[n.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",n[n.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",n[n.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",n[n.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",n[n.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",n[n.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",n[n.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",n[n.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",n[n.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",n[n.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",n[n.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",n[n.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",n[n.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",n[n.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"})(DXGI_FORMAT||(DXGI_FORMAT={}));var D3D10_RESOURCE_DIMENSION;(function(n){n[n.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",n[n.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",n[n.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"})(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT=(_a$1={},_a$1[FOURCC_DXT1]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[FOURCC_DXT3]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[FOURCC_DXT5]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=(_b$1={},_b$1[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b$1);function parseDDS(n){var e=new Uint32Array(n),t=e[0];if(t!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");var r=new Uint32Array(n,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),o=r[DDS_FIELDS.HEIGHT],D=r[DDS_FIELDS.WIDTH],N=r[DDS_FIELDS.MIPMAP_COUNT],k=new Uint32Array(n,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),B=k[PF_FLAGS];if(B&DDPF_FOURCC){var G=k[DDS_PF_FIELDS.FOURCC];if(G!==FOURCC_DX10){var U=FOURCC_TO_FORMAT[G],H=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,$=new Uint8Array(n,H),V=new CompressedTextureResource($,{format:U,width:D,height:o,levels:N});return[V]}var Y=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,X=new Uint32Array(e.buffer,Y,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),z=X[DDS_DX10_FIELDS.DXGI_FORMAT],W=X[DDS_DX10_FIELDS.RESOURCE_DIMENSION],q=X[DDS_DX10_FIELDS.MISC_FLAG],K=X[DDS_DX10_FIELDS.ARRAY_SIZE],Q=DXGI_TO_FORMAT[z];if(Q===void 0)throw new Error("DDSParser cannot parse texture data with DXGI format "+z);if(q===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(W===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");var Z=new Array,ee=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(K===1)Z.push(new Uint8Array(n,ee));else{for(var J=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[Q],te=0,oe=D,ce=o,fe=0;fe<N;fe++){var me=Math.max(1,oe+3&-4),we=Math.max(1,ce+3&-4),Me=me*we*J;te+=Me,oe=oe>>>1,ce=ce>>>1}for(var Ee=ee,fe=0;fe<K;fe++)Z.push(new Uint8Array(n,Ee,te)),Ee+=te}return Z.map(function(ie){return new CompressedTextureResource(ie,{format:Q,width:D,height:o,levels:N})})}throw B&DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):B&DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):B&DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):B&DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var _a$3,_b,_c,FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT=(_a$3={},_a$3[TYPES.UNSIGNED_BYTE]=1,_a$3[TYPES.UNSIGNED_SHORT]=2,_a$3[TYPES.INT]=4,_a$3[TYPES.UNSIGNED_INT]=4,_a$3[TYPES.FLOAT]=4,_a$3[TYPES.HALF_FLOAT]=8,_a$3),FORMATS_TO_COMPONENTS=(_b={},_b[FORMATS.RGBA]=4,_b[FORMATS.RGB]=3,_b[FORMATS.RG]=2,_b[FORMATS.RED]=1,_b[FORMATS.LUMINANCE]=1,_b[FORMATS.LUMINANCE_ALPHA]=2,_b[FORMATS.ALPHA]=1,_b),TYPES_TO_BYTES_PER_PIXEL=(_c={},_c[TYPES.UNSIGNED_SHORT_4_4_4_4]=2,_c[TYPES.UNSIGNED_SHORT_5_5_5_1]=2,_c[TYPES.UNSIGNED_SHORT_5_6_5]=2,_c);function parseKTX(n,e,t){t===void 0&&(t=!1);var r=new DataView(e);if(!validate(n,r))return null;var o=r.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,D=r.getUint32(KTX_FIELDS.GL_TYPE,o),N=r.getUint32(KTX_FIELDS.GL_FORMAT,o),k=r.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,o),B=r.getUint32(KTX_FIELDS.PIXEL_WIDTH,o),G=r.getUint32(KTX_FIELDS.PIXEL_HEIGHT,o)||1,U=r.getUint32(KTX_FIELDS.PIXEL_DEPTH,o)||1,H=r.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,o)||1,$=r.getUint32(KTX_FIELDS.NUMBER_OF_FACES,o),V=r.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,o),Y=r.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,o);if(G===0||U!==1)throw new Error("Only 2D textures are supported");if($!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(H!==1)throw new Error("WebGL does not support array textures");var X=4,z=4,W=B+3&-4,q=G+3&-4,K=new Array(H),Q=B*G;D===0&&(Q=W*q);var Z;if(D!==0?TYPES_TO_BYTES_PER_COMPONENT[D]?Z=TYPES_TO_BYTES_PER_COMPONENT[D]*FORMATS_TO_COMPONENTS[N]:Z=TYPES_TO_BYTES_PER_PIXEL[D]:Z=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[k],Z===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var ee=t?parseKvData(r,Y,o):null,J=Q*Z,te=J,oe=B,ce=G,fe=W,me=q,we=FILE_HEADER_SIZE+Y,Me=0;Me<V;Me++){for(var Ee=r.getUint32(we,o),ie=we+4,ne=0;ne<H;ne++){var se=K[ne];se||(se=K[ne]=new Array(V)),se[Me]={levelID:Me,levelWidth:V>1||D!==0?oe:fe,levelHeight:V>1||D!==0?ce:me,levelBuffer:new Uint8Array(e,ie,te)},ie+=te}we+=Ee+4,we=we%4!==0?we+4-we%4:we,oe=oe>>1||1,ce=ce>>1||1,fe=oe+X-1&-4,me=ce+z-1&-4,te=fe*me*Z}return D!==0?{uncompressed:K.map(function(ue){var le=ue[0].levelBuffer,he=!1;return D===TYPES.FLOAT?le=new Float32Array(ue[0].levelBuffer.buffer,ue[0].levelBuffer.byteOffset,ue[0].levelBuffer.byteLength/4):D===TYPES.UNSIGNED_INT?(he=!0,le=new Uint32Array(ue[0].levelBuffer.buffer,ue[0].levelBuffer.byteOffset,ue[0].levelBuffer.byteLength/4)):D===TYPES.INT&&(he=!0,le=new Int32Array(ue[0].levelBuffer.buffer,ue[0].levelBuffer.byteOffset,ue[0].levelBuffer.byteLength/4)),{resource:new BufferResource(le,{width:ue[0].levelWidth,height:ue[0].levelHeight}),type:D,format:he?convertFormatToInteger(N):N}}),kvData:ee}:{compressed:K.map(function(ue){return new CompressedTextureResource(null,{format:k,width:B,height:G,levels:V,levelBuffers:ue})}),kvData:ee}}function validate(n,e){for(var t=0;t<FILE_IDENTIFIER.length;t++)if(e.getUint8(t)!==FILE_IDENTIFIER[t])return console.error(n+" is not a valid *.ktx file!"),!1;return!0}function convertFormatToInteger(n){switch(n){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return n}}function parseKvData(n,e,t){for(var r=new Map,o=0;o<e;){var D=n.getUint32(FILE_HEADER_SIZE+o,t),N=FILE_HEADER_SIZE+o+4,k=3-(D+3)%4;if(D===0||D>e-o){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}for(var B=0;B<D&&n.getUint8(N+B)!==0;B++);if(B===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}var G=new TextDecoder().decode(new Uint8Array(n.buffer,N,B)),U=new DataView(n.buffer,N+B+1,D-B-1);r.set(G,U),o+=4+D+k}return r}LoaderResource.setExtensionXhrType("dds",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DDSLoader=function(){function n(){}return n.use=function(e,t){if(e.extension==="dds"&&e.data)try{Object.assign(e,registerCompressedTextures(e.name||e.url,parseDDS(e.data),e.metadata))}catch(r){t(r);return}t()},n.extension=ExtensionType.Loader,n}();LoaderResource.setExtensionXhrType("ktx",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var KTXLoader=function(){function n(){}return n.use=function(e,t){if(e.extension==="ktx"&&e.data)try{var r=e.name||e.url,o=parseKTX(r,e.data,this.loadKeyValueData),D=o.compressed,N=o.uncompressed,k=o.kvData;if(D){var B=registerCompressedTextures(r,D,e.metadata);if(k&&B.textures)for(var G in B.textures)B.textures[G].baseTexture.ktxKeyValueData=k;Object.assign(e,B)}else if(N){var U={};N.forEach(function(H,$){var V=new Texture(new BaseTexture(H.resource,{mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,type:H.type,format:H.format})),Y=r+"-"+($+1);k&&(V.baseTexture.ktxKeyValueData=k),BaseTexture.addToCache(V.baseTexture,Y),Texture.addToCache(V,Y),$===0&&(U[r]=V,BaseTexture.addToCache(V.baseTexture,r),Texture.addToCache(V,r)),U[Y]=V}),Object.assign(e,{textures:U})}}catch(H){t(H);return}t()},n.extension=ExtensionType.Loader,n.loadKeyValueData=!1,n}();/*!
 * @pixi/particle-container - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/particle-container is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$f=function(n,e){return extendStatics$f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$f(n,e)};function __extends$f(n,e){extendStatics$f(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}(function(n){__extends$f(e,n);function e(t,r,o,D){t===void 0&&(t=1500),o===void 0&&(o=16384),D===void 0&&(D=!1);var N=n.call(this)||this,k=16384;return o>k&&(o=k),N._properties=[!1,!0,!1,!1,!1],N._maxSize=t,N._batchSize=o,N._buffers=null,N._bufferUpdateIDs=[],N._updateID=0,N.interactiveChildren=!1,N.blendMode=BLEND_MODES.NORMAL,N.autoResize=D,N.roundPixels=!0,N.baseTexture=null,N.setProperties(r),N._tint=0,N.tintRgb=new Float32Array(4),N.tint=16777215,N}return e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,hex2rgb(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var r=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return r.onChildrenChange(0)})),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var r=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e})(Container);var ParticleBuffer=function(){function n(e,t,r){this.geometry=new Geometry,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<e.length;++o){var D=e[o];D={attributeName:D.attributeName,size:D.size,uploadFunction:D.uploadFunction,type:D.type||TYPES.FLOAT,offset:D.offset},t[o]?this.dynamicProperties.push(D):this.staticProperties.push(D)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return n.prototype.initBuffers=function(){var e=this.geometry,t=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];o.offset=t,t+=o.size,this.dynamicStride+=o.size}var D=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(D),this.dynamicDataUint32=new Uint32Array(D),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);var N=0;this.staticStride=0;for(var r=0;r<this.staticProperties.length;++r){var o=this.staticProperties[r];o.offset=N,N+=o.size,this.staticStride+=o.size}var k=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(k),this.staticDataUint32=new Uint32Array(k),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];e.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===TYPES.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(var r=0;r<this.staticProperties.length;++r){var o=this.staticProperties[r];e.addAttribute(o.attributeName,this.staticBuffer,0,o.type===TYPES.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}},n.prototype.uploadDynamic=function(e,t,r){for(var o=0;o<this.dynamicProperties.length;o++){var D=this.dynamicProperties[o];D.uploadFunction(e,t,r,D.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,D.offset)}this.dynamicBuffer._updateID++},n.prototype.uploadStatic=function(e,t,r){for(var o=0;o<this.staticProperties.length;o++){var D=this.staticProperties[o];D.uploadFunction(e,t,r,D.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,D.offset)}this.staticBuffer._updateID++},n.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},n}(),fragment$6=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,ParticleRenderer=function(n){__extends$f(e,n);function e(t){var r=n.call(this,t)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Matrix,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=Shader.from(vertex$3,fragment$6,{}),r.state=State.for2d(),r}return e.prototype.render=function(t){var r=t.children,o=t._maxSize,D=t._batchSize,N=this.renderer,k=r.length;if(k!==0){k>o&&!t.autoResize&&(k=o);var B=t._buffers;B||(B=t._buffers=this.generateBuffers(t));var G=r[0]._texture.baseTexture,U=G.alphaMode>0;this.state.blendMode=correctBlendMode(t.blendMode,U),N.state.set(this.state);var H=N.gl,$=t.worldTransform.copyTo(this.tempMatrix);$.prepend(N.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=$.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,U),this.shader.uniforms.uSampler=G,this.renderer.shader.bind(this.shader);for(var V=!1,Y=0,X=0;Y<k;Y+=D,X+=1){var z=k-Y;z>D&&(z=D),X>=B.length&&B.push(this._generateOneMoreBuffer(t));var W=B[X];W.uploadDynamic(r,Y,z);var q=t._bufferUpdateIDs[X]||0;V=V||W._updateID<q,V&&(W._updateID=t._updateID,W.uploadStatic(r,Y,z)),N.geometry.bind(W.geometry),H.drawElements(H.TRIANGLES,z*6,H.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var r=[],o=t._maxSize,D=t._batchSize,N=t._properties,k=0;k<o;k+=D)r.push(new ParticleBuffer(this.properties,N,D));return r},e.prototype._generateOneMoreBuffer=function(t){var r=t._batchSize,o=t._properties;return new ParticleBuffer(this.properties,o,r)},e.prototype.uploadVertices=function(t,r,o,D,N,k){for(var B=0,G=0,U=0,H=0,$=0;$<o;++$){var V=t[r+$],Y=V._texture,X=V.scale.x,z=V.scale.y,W=Y.trim,q=Y.orig;W?(G=W.x-V.anchor.x*q.width,B=G+W.width,H=W.y-V.anchor.y*q.height,U=H+W.height):(B=q.width*(1-V.anchor.x),G=q.width*-V.anchor.x,U=q.height*(1-V.anchor.y),H=q.height*-V.anchor.y),D[k]=G*X,D[k+1]=H*z,D[k+N]=B*X,D[k+N+1]=H*z,D[k+N*2]=B*X,D[k+N*2+1]=U*z,D[k+N*3]=G*X,D[k+N*3+1]=U*z,k+=N*4}},e.prototype.uploadPosition=function(t,r,o,D,N,k){for(var B=0;B<o;B++){var G=t[r+B].position;D[k]=G.x,D[k+1]=G.y,D[k+N]=G.x,D[k+N+1]=G.y,D[k+N*2]=G.x,D[k+N*2+1]=G.y,D[k+N*3]=G.x,D[k+N*3+1]=G.y,k+=N*4}},e.prototype.uploadRotation=function(t,r,o,D,N,k){for(var B=0;B<o;B++){var G=t[r+B].rotation;D[k]=G,D[k+N]=G,D[k+N*2]=G,D[k+N*3]=G,k+=N*4}},e.prototype.uploadUvs=function(t,r,o,D,N,k){for(var B=0;B<o;++B){var G=t[r+B]._texture._uvs;G?(D[k]=G.x0,D[k+1]=G.y0,D[k+N]=G.x1,D[k+N+1]=G.y1,D[k+N*2]=G.x2,D[k+N*2+1]=G.y2,D[k+N*3]=G.x3,D[k+N*3+1]=G.y3,k+=N*4):(D[k]=0,D[k+1]=0,D[k+N]=0,D[k+N+1]=0,D[k+N*2]=0,D[k+N*2+1]=0,D[k+N*3]=0,D[k+N*3+1]=0,k+=N*4)}},e.prototype.uploadTint=function(t,r,o,D,N,k){for(var B=0;B<o;++B){var G=t[r+B],U=G._texture.baseTexture.alphaMode>0,H=G.alpha,$=H<1&&U?premultiplyTint(G._tintRGB,H):G._tintRGB+(H*255<<24);D[k]=$,D[k+N]=$,D[k+N*2]=$,D[k+N*3]=$,k+=N*4}},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e.extension={name:"particle",type:ExtensionType.RendererPlugin},e}(ObjectRenderer);/*!
 * @pixi/graphics - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/graphics is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var LINE_JOIN;(function(n){n.MITER="miter",n.BEVEL="bevel",n.ROUND="round"})(LINE_JOIN||(LINE_JOIN={}));var LINE_CAP;(function(n){n.BUTT="butt",n.ROUND="round",n.SQUARE="square"})(LINE_CAP||(LINE_CAP={}));var GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(n,e){if(e===void 0&&(e=20),!this.adaptive||!n||isNaN(n))return e;var t=Math.ceil(n/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}},FillStyle=function(){function n(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}return n.prototype.clone=function(){var e=new n;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},n.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1},n.prototype.destroy=function(){this.texture=null,this.matrix=null},n}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$e=function(n,e){return extendStatics$e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$e(n,e)};function __extends$e(n,e){extendStatics$e(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function fixOrientation(n,e){var t,r;e===void 0&&(e=!1);var o=n.length;if(!(o<6)){for(var D=0,N=0,k=n[o-2],B=n[o-1];N<o;N+=2){var G=n[N],U=n[N+1];D+=(G-k)*(U+B),k=G,B=U}if(!e&&D>0||e&&D<=0)for(var H=o/2,N=H+H%2;N<o;N+=2){var $=o-N-2,V=o-N-1,Y=N,X=N+1;t=[n[Y],n[$]],n[$]=t[0],n[Y]=t[1],r=[n[X],n[V]],n[V]=r[0],n[X]=r[1]}}}var buildPoly={build:function(n){n.points=n.shape.points.slice()},triangulate:function(n,e){var t=n.points,r=n.holes,o=e.points,D=e.indices;if(t.length>=6){fixOrientation(t,!1);for(var N=[],k=0;k<r.length;k++){var B=r[k];fixOrientation(B.points,!0),N.push(t.length/2),t=t.concat(B.points)}var G=earcut(t,N,2);if(!G)return;for(var U=o.length/2,k=0;k<G.length;k+=3)D.push(G[k]+U),D.push(G[k+1]+U),D.push(G[k+2]+U);for(var k=0;k<t.length;k++)o.push(t[k])}}},buildCircle={build:function(n){var e=n.points,t,r,o,D,N,k;if(n.type===SHAPES.CIRC){var B=n.shape;t=B.x,r=B.y,N=k=B.radius,o=D=0}else if(n.type===SHAPES.ELIP){var G=n.shape;t=G.x,r=G.y,N=G.width,k=G.height,o=D=0}else{var U=n.shape,H=U.width/2,$=U.height/2;t=U.x+H,r=U.y+$,N=k=Math.max(0,Math.min(U.radius,Math.min(H,$))),o=H-N,D=$-k}if(!(N>=0&&k>=0&&o>=0&&D>=0)){e.length=0;return}var V=Math.ceil(2.3*Math.sqrt(N+k)),Y=V*8+(o?4:0)+(D?4:0);if(e.length=Y,Y!==0){if(V===0){e.length=8,e[0]=e[6]=t+o,e[1]=e[3]=r+D,e[2]=e[4]=t-o,e[5]=e[7]=r-D;return}var X=0,z=V*4+(o?2:0)+2,W=z,q=Y;{var K=o+N,Q=D,Z=t+K,ee=t-K,J=r+Q;if(e[X++]=Z,e[X++]=J,e[--z]=J,e[--z]=ee,D){var te=r-Q;e[W++]=ee,e[W++]=te,e[--q]=te,e[--q]=Z}}for(var oe=1;oe<V;oe++){var ce=Math.PI/2*(oe/V),K=o+Math.cos(ce)*N,Q=D+Math.sin(ce)*k,Z=t+K,ee=t-K,J=r+Q,te=r-Q;e[X++]=Z,e[X++]=J,e[--z]=J,e[--z]=ee,e[W++]=ee,e[W++]=te,e[--q]=te,e[--q]=Z}{var K=o,Q=D+k,Z=t+K,ee=t-K,J=r+Q,te=r-Q;e[X++]=Z,e[X++]=J,e[--q]=te,e[--q]=Z,o&&(e[X++]=ee,e[X++]=J,e[--q]=te,e[--q]=ee)}}},triangulate:function(n,e){var t=n.points,r=e.points,o=e.indices;if(t.length!==0){var D=r.length/2,N=D,k,B;if(n.type!==SHAPES.RREC){var G=n.shape;k=G.x,B=G.y}else{var U=n.shape;k=U.x+U.width/2,B=U.y+U.height/2}var H=n.matrix;r.push(n.matrix?H.a*k+H.c*B+H.tx:k,n.matrix?H.b*k+H.d*B+H.ty:B),D++,r.push(t[0],t[1]);for(var $=2;$<t.length;$+=2)r.push(t[$],t[$+1]),o.push(D++,N,D);o.push(N+1,N,D)}}},buildRectangle={build:function(n){var e=n.shape,t=e.x,r=e.y,o=e.width,D=e.height,N=n.points;N.length=0,N.push(t,r,t+o,r,t+o,r+D,t,r+D)},triangulate:function(n,e){var t=n.points,r=e.points,o=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(o,o+1,o+2,o+1,o+2,o+3)}};function getPt(n,e,t){var r=e-n;return n+r*t}function quadraticBezierCurve(n,e,t,r,o,D,N){N===void 0&&(N=[]);for(var k=20,B=N,G=0,U=0,H=0,$=0,V=0,Y=0,X=0,z=0;X<=k;++X)z=X/k,G=getPt(n,t,z),U=getPt(e,r,z),H=getPt(t,o,z),$=getPt(r,D,z),V=getPt(G,H,z),Y=getPt(U,$,z),!(X===0&&B[B.length-2]===V&&B[B.length-1]===Y)&&B.push(V,Y);return B}var buildRoundedRectangle={build:function(n){if(Graphics.nextRoundedRectBehavior){buildCircle.build(n);return}var e=n.shape,t=n.points,r=e.x,o=e.y,D=e.width,N=e.height,k=Math.max(0,Math.min(e.radius,Math.min(D,N)/2));t.length=0,k?(quadraticBezierCurve(r,o+k,r,o,r+k,o,t),quadraticBezierCurve(r+D-k,o,r+D,o,r+D,o+k,t),quadraticBezierCurve(r+D,o+N-k,r+D,o+N,r+D-k,o+N,t),quadraticBezierCurve(r+k,o+N,r,o+N,r,o+N-k,t)):t.push(r,o,r+D,o,r+D,o+N,r,o+N)},triangulate:function(n,e){if(Graphics.nextRoundedRectBehavior){buildCircle.triangulate(n,e);return}for(var t=n.points,r=e.points,o=e.indices,D=r.length/2,N=earcut(t,null,2),k=0,B=N.length;k<B;k+=3)o.push(N[k]+D),o.push(N[k+1]+D),o.push(N[k+2]+D);for(var k=0,B=t.length;k<B;k++)r.push(t[k],t[++k])}};function square(n,e,t,r,o,D,N,k){var B=n-t*o,G=e-r*o,U=n+t*D,H=e+r*D,$,V;N?($=r,V=-t):($=-r,V=t);var Y=B+$,X=G+V,z=U+$,W=H+V;return k.push(Y,X),k.push(z,W),2}function round$1(n,e,t,r,o,D,N,k){var B=t-n,G=r-e,U=Math.atan2(B,G),H=Math.atan2(o-n,D-e);k&&U<H?U+=Math.PI*2:!k&&U>H&&(H+=Math.PI*2);var $=U,V=H-U,Y=Math.abs(V),X=Math.sqrt(B*B+G*G),z=(15*Y*Math.sqrt(X)/Math.PI>>0)+1,W=V/z;if($+=W,k){N.push(n,e),N.push(t,r);for(var q=1,K=$;q<z;q++,K+=W)N.push(n,e),N.push(n+Math.sin(K)*X,e+Math.cos(K)*X);N.push(n,e),N.push(o,D)}else{N.push(t,r),N.push(n,e);for(var q=1,K=$;q<z;q++,K+=W)N.push(n+Math.sin(K)*X,e+Math.cos(K)*X),N.push(n,e);N.push(o,D),N.push(n,e)}return z*2}function buildNonNativeLine(n,e){var t=n.shape,r=n.points||t.points.slice(),o=e.closePointEps;if(r.length!==0){var D=n.lineStyle,N=new Point(r[0],r[1]),k=new Point(r[r.length-2],r[r.length-1]),B=t.type!==SHAPES.POLY||t.closeStroke,G=Math.abs(N.x-k.x)<o&&Math.abs(N.y-k.y)<o;if(B){r=r.slice(),G&&(r.pop(),r.pop(),k.set(r[r.length-2],r[r.length-1]));var U=(N.x+k.x)*.5,H=(k.y+N.y)*.5;r.unshift(U,H),r.push(U,H)}var $=e.points,V=r.length/2,Y=r.length,X=$.length/2,z=D.width/2,W=z*z,q=D.miterLimit*D.miterLimit,K=r[0],Q=r[1],Z=r[2],ee=r[3],J=0,te=0,oe=-(Q-ee),ce=K-Z,fe=0,me=0,we=Math.sqrt(oe*oe+ce*ce);oe/=we,ce/=we,oe*=z,ce*=z;var Me=D.alignment,Ee=(1-Me)*2,ie=Me*2;B||(D.cap===LINE_CAP.ROUND?Y+=round$1(K-oe*(Ee-ie)*.5,Q-ce*(Ee-ie)*.5,K-oe*Ee,Q-ce*Ee,K+oe*ie,Q+ce*ie,$,!0)+2:D.cap===LINE_CAP.SQUARE&&(Y+=square(K,Q,oe,ce,Ee,ie,!0,$))),$.push(K-oe*Ee,Q-ce*Ee),$.push(K+oe*ie,Q+ce*ie);for(var ne=1;ne<V-1;++ne){K=r[(ne-1)*2],Q=r[(ne-1)*2+1],Z=r[ne*2],ee=r[ne*2+1],J=r[(ne+1)*2],te=r[(ne+1)*2+1],oe=-(Q-ee),ce=K-Z,we=Math.sqrt(oe*oe+ce*ce),oe/=we,ce/=we,oe*=z,ce*=z,fe=-(ee-te),me=Z-J,we=Math.sqrt(fe*fe+me*me),fe/=we,me/=we,fe*=z,me*=z;var se=Z-K,ue=Q-ee,le=Z-J,he=te-ee,pe=se*le+ue*he,de=ue*le-he*se,ve=de<0;if(Math.abs(de)<.001*Math.abs(pe)){$.push(Z-oe*Ee,ee-ce*Ee),$.push(Z+oe*ie,ee+ce*ie),pe>=0&&(D.join===LINE_JOIN.ROUND?Y+=round$1(Z,ee,Z-oe*Ee,ee-ce*Ee,Z-fe*Ee,ee-me*Ee,$,!1)+4:Y+=2,$.push(Z-fe*ie,ee-me*ie),$.push(Z+fe*Ee,ee+me*Ee));continue}var Se=(-oe+K)*(-ce+ee)-(-oe+Z)*(-ce+Q),ae=(-fe+J)*(-me+ee)-(-fe+Z)*(-me+te),Ae=(se*ae-le*Se)/de,xe=(he*Se-ue*ae)/de,Ce=(Ae-Z)*(Ae-Z)+(xe-ee)*(xe-ee),Oe=Z+(Ae-Z)*Ee,Te=ee+(xe-ee)*Ee,De=Z-(Ae-Z)*ie,Ie=ee-(xe-ee)*ie,_e=Math.min(se*se+ue*ue,le*le+he*he),Re=ve?Ee:ie,Pe=_e+Re*Re*W,be=Ce<=Pe;be?D.join===LINE_JOIN.BEVEL||Ce/W>q?(ve?($.push(Oe,Te),$.push(Z+oe*ie,ee+ce*ie),$.push(Oe,Te),$.push(Z+fe*ie,ee+me*ie)):($.push(Z-oe*Ee,ee-ce*Ee),$.push(De,Ie),$.push(Z-fe*Ee,ee-me*Ee),$.push(De,Ie)),Y+=2):D.join===LINE_JOIN.ROUND?ve?($.push(Oe,Te),$.push(Z+oe*ie,ee+ce*ie),Y+=round$1(Z,ee,Z+oe*ie,ee+ce*ie,Z+fe*ie,ee+me*ie,$,!0)+4,$.push(Oe,Te),$.push(Z+fe*ie,ee+me*ie)):($.push(Z-oe*Ee,ee-ce*Ee),$.push(De,Ie),Y+=round$1(Z,ee,Z-oe*Ee,ee-ce*Ee,Z-fe*Ee,ee-me*Ee,$,!1)+4,$.push(Z-fe*Ee,ee-me*Ee),$.push(De,Ie)):($.push(Oe,Te),$.push(De,Ie)):($.push(Z-oe*Ee,ee-ce*Ee),$.push(Z+oe*ie,ee+ce*ie),D.join===LINE_JOIN.ROUND?ve?Y+=round$1(Z,ee,Z+oe*ie,ee+ce*ie,Z+fe*ie,ee+me*ie,$,!0)+2:Y+=round$1(Z,ee,Z-oe*Ee,ee-ce*Ee,Z-fe*Ee,ee-me*Ee,$,!1)+2:D.join===LINE_JOIN.MITER&&Ce/W<=q&&(ve?($.push(De,Ie),$.push(De,Ie)):($.push(Oe,Te),$.push(Oe,Te)),Y+=2),$.push(Z-fe*Ee,ee-me*Ee),$.push(Z+fe*ie,ee+me*ie),Y+=2)}K=r[(V-2)*2],Q=r[(V-2)*2+1],Z=r[(V-1)*2],ee=r[(V-1)*2+1],oe=-(Q-ee),ce=K-Z,we=Math.sqrt(oe*oe+ce*ce),oe/=we,ce/=we,oe*=z,ce*=z,$.push(Z-oe*Ee,ee-ce*Ee),$.push(Z+oe*ie,ee+ce*ie),B||(D.cap===LINE_CAP.ROUND?Y+=round$1(Z-oe*(Ee-ie)*.5,ee-ce*(Ee-ie)*.5,Z-oe*Ee,ee-ce*Ee,Z+oe*ie,ee+ce*ie,$,!1)+2:D.cap===LINE_CAP.SQUARE&&(Y+=square(Z,ee,oe,ce,Ee,ie,!1,$)));for(var $e=e.indices,Ye=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon,ne=X;ne<Y+X-2;++ne)K=$[ne*2],Q=$[ne*2+1],Z=$[(ne+1)*2],ee=$[(ne+1)*2+1],J=$[(ne+2)*2],te=$[(ne+2)*2+1],!(Math.abs(K*(ee-te)+Z*(te-Q)+J*(Q-ee))<Ye)&&$e.push(ne,ne+1,ne+2)}}function buildNativeLine(n,e){var t=0,r=n.shape,o=n.points||r.points,D=r.type!==SHAPES.POLY||r.closeStroke;if(o.length!==0){var N=e.points,k=e.indices,B=o.length/2,G=N.length/2,U=G;for(N.push(o[0],o[1]),t=1;t<B;t++)N.push(o[t*2],o[t*2+1]),k.push(U,U+1),U++;D&&k.push(U,G)}}function buildLine(n,e){n.lineStyle.native?buildNativeLine(n,e):buildNonNativeLine(n,e)}var ArcUtils=function(){function n(){}return n.curveTo=function(e,t,r,o,D,N){var k=N[N.length-2],B=N[N.length-1],G=B-t,U=k-e,H=o-t,$=r-e,V=Math.abs(G*$-U*H);if(V<1e-8||D===0)return(N[N.length-2]!==e||N[N.length-1]!==t)&&N.push(e,t),null;var Y=G*G+U*U,X=H*H+$*$,z=G*H+U*$,W=D*Math.sqrt(Y)/V,q=D*Math.sqrt(X)/V,K=W*z/Y,Q=q*z/X,Z=W*$+q*U,ee=W*H+q*G,J=U*(q+K),te=G*(q+K),oe=$*(W+Q),ce=H*(W+Q),fe=Math.atan2(te-ee,J-Z),me=Math.atan2(ce-ee,oe-Z);return{cx:Z+e,cy:ee+t,radius:D,startAngle:fe,endAngle:me,anticlockwise:U*H>$*G}},n.arc=function(e,t,r,o,D,N,k,B,G){for(var U=k-N,H=GRAPHICS_CURVES._segmentsCount(Math.abs(U)*D,Math.ceil(Math.abs(U)/PI_2)*40),$=U/(H*2),V=$*2,Y=Math.cos($),X=Math.sin($),z=H-1,W=z%1/z,q=0;q<=z;++q){var K=q+W*q,Q=$+N+V*K,Z=Math.cos(Q),ee=-Math.sin(Q);G.push((Y*Z+X*ee)*D+r,(Y*-ee+X*Z)*D+o)}},n}(),BezierUtils=function(){function n(){}return n.curveLength=function(e,t,r,o,D,N,k,B){for(var G=10,U=0,H=0,$=0,V=0,Y=0,X=0,z=0,W=0,q=0,K=0,Q=0,Z=e,ee=t,J=1;J<=G;++J)H=J/G,$=H*H,V=$*H,Y=1-H,X=Y*Y,z=X*Y,W=z*e+3*X*H*r+3*Y*$*D+V*k,q=z*t+3*X*H*o+3*Y*$*N+V*B,K=Z-W,Q=ee-q,Z=W,ee=q,U+=Math.sqrt(K*K+Q*Q);return U},n.curveTo=function(e,t,r,o,D,N,k){var B=k[k.length-2],G=k[k.length-1];k.length-=2;var U=GRAPHICS_CURVES._segmentsCount(n.curveLength(B,G,e,t,r,o,D,N)),H=0,$=0,V=0,Y=0,X=0;k.push(B,G);for(var z=1,W=0;z<=U;++z)W=z/U,H=1-W,$=H*H,V=$*H,Y=W*W,X=Y*W,k.push(V*B+3*$*W*e+3*H*Y*r+X*D,V*G+3*$*W*t+3*H*Y*o+X*N)},n}(),QuadraticUtils=function(){function n(){}return n.curveLength=function(e,t,r,o,D,N){var k=e-2*r+D,B=t-2*o+N,G=2*r-2*e,U=2*o-2*t,H=4*(k*k+B*B),$=4*(k*G+B*U),V=G*G+U*U,Y=2*Math.sqrt(H+$+V),X=Math.sqrt(H),z=2*H*X,W=2*Math.sqrt(V),q=$/X;return(z*Y+X*$*(Y-W)+(4*V*H-$*$)*Math.log((2*X+q+Y)/(q+W)))/(4*z)},n.curveTo=function(e,t,r,o,D){for(var N=D[D.length-2],k=D[D.length-1],B=GRAPHICS_CURVES._segmentsCount(n.curveLength(N,k,e,t,r,o)),G=0,U=0,H=1;H<=B;++H){var $=H/B;G=N+(e-N)*$,U=k+(t-k)*$,D.push(G+(e+(r-e)*$-G)*$,U+(t+(o-t)*$-U)*$)}},n}(),BatchPart=function(){function n(){this.reset()}return n.prototype.begin=function(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r},n.prototype.end=function(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start},n.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},n}(),_a,FILL_COMMANDS=(_a={},_a[SHAPES.POLY]=buildPoly,_a[SHAPES.CIRC]=buildCircle,_a[SHAPES.ELIP]=buildCircle,_a[SHAPES.RECT]=buildRectangle,_a[SHAPES.RREC]=buildRoundedRectangle,_a),BATCH_POOL=[],DRAW_CALL_POOL=[],GraphicsData=function(){function n(e,t,r,o){t===void 0&&(t=null),r===void 0&&(r=null),o===void 0&&(o=null),this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=o,this.type=e.type}return n.prototype.clone=function(){return new n(this.shape,this.fillStyle,this.lineStyle,this.matrix)},n.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},n}(),tmpPoint=new Point,GraphicsGeometry=function(n){__extends$e(e,n);function e(){var t=n.call(this)||this;return t.closePointEps=1e-4,t.boundsPadding=0,t.uvsFloat32=null,t.indicesUint16=null,t.batchable=!1,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.drawCalls=[],t.batchDirty=-1,t.batches=[],t.dirty=0,t.cacheDirty=-1,t.clearDirty=0,t.shapeIndex=0,t._bounds=new Bounds,t.boundsDirty=-1,t}return Object.defineProperty(e.prototype,"bounds",{get:function(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[t]);this.drawCalls.length=0;for(var t=0;t<this.batches.length;t++){var r=this.batches[t];r.reset(),BATCH_POOL.push(r)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,r,o,D){r===void 0&&(r=null),o===void 0&&(o=null),D===void 0&&(D=null);var N=new GraphicsData(t,r,o,D);return this.graphicsData.push(N),this.dirty++,this},e.prototype.drawHole=function(t,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var o=new GraphicsData(t,null,null,r),D=this.graphicsData[this.graphicsData.length-1];return o.lineStyle=D.lineStyle,D.holes.push(o),this.dirty++,this},e.prototype.destroy=function(){n.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var r=this.graphicsData,o=0;o<r.length;++o){var D=r[o];if(D.fillStyle.visible&&D.shape&&(D.matrix?D.matrix.applyInverse(t,tmpPoint):tmpPoint.copyFrom(t),D.shape.contains(tmpPoint.x,tmpPoint.y))){var N=!1;if(D.holes)for(var k=0;k<D.holes.length;k++){var B=D.holes[k];if(B.shape.contains(tmpPoint.x,tmpPoint.y)){N=!0;break}}if(!N)return!0}}return!1},e.prototype.updateBatches=function(){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var t=this.uvs,r=this.graphicsData,o=null,D=null;this.batches.length>0&&(o=this.batches[this.batches.length-1],D=o.style);for(var N=this.shapeIndex;N<r.length;N++){this.shapeIndex++;var k=r[N],B=k.fillStyle,G=k.lineStyle,U=FILL_COMMANDS[k.type];U.build(k),k.matrix&&this.transformPoints(k.points,k.matrix),(B.visible||G.visible)&&this.processHoles(k.holes);for(var H=0;H<2;H++){var $=H===0?B:G;if($.visible){var V=$.texture.baseTexture,Y=this.indices.length,X=this.points.length/2;V.wrapMode=WRAP_MODES.REPEAT,H===0?this.processFill(k):this.processLine(k);var z=this.points.length/2-X;z!==0&&(o&&!this._compareStyles(D,$)&&(o.end(Y,X),o=null),o||(o=BATCH_POOL.pop()||new BatchPart,o.begin($,Y,X),this.batches.push(o),D=$),this.addUvs(this.points,t,$.texture,X,z,$.matrix))}}}var W=this.indices.length,q=this.points.length/2;if(o&&o.end(W,q),this.batches.length===0){this.batchable=!0;return}var K=q>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&K===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=K?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},e.prototype._compareStyles=function(t,r){return!(!t||!r||t.texture.baseTexture!==r.texture.baseTexture||t.color+t.alpha!==r.color+r.alpha||!!t.native!=!!r.native)},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,r=this.graphicsData.length;t<r;t++){var o=this.graphicsData[t],D=o.fillStyle,N=o.lineStyle;if(D&&!D.texture.baseTexture.valid||N&&!N.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,r=0,o=t.length;r<o;r++)for(var D=t[r],N=0;N<D.size;N++){var k=D.start+N;this.indicesUint16[k]=this.indicesUint16[k]-D.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var t=this.batches,r=0;r<t.length;r++)if(t[r].style.native)return!1;return this.points.length<e.BATCHABLE_SIZE*2},e.prototype.buildDrawCalls=function(){for(var t=++BaseTexture._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[r]);this.drawCalls.length=0;var o=this.colors,D=this.textureIds,N=DRAW_CALL_POOL.pop();N||(N=new BatchDrawCall,N.texArray=new BatchTextureArray),N.texArray.count=0,N.start=0,N.size=0,N.type=DRAW_MODES.TRIANGLES;var k=0,B=null,G=0,U=!1,H=DRAW_MODES.TRIANGLES,$=0;this.drawCalls.push(N);for(var r=0;r<this.batches.length;r++){var V=this.batches[r],Y=8,X=V.style,z=X.texture.baseTexture;U!==!!X.native&&(U=!!X.native,H=U?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES,B=null,k=Y,t++),B!==z&&(B=z,z._batchEnabled!==t&&(k===Y&&(t++,k=0,N.size>0&&(N=DRAW_CALL_POOL.pop(),N||(N=new BatchDrawCall,N.texArray=new BatchTextureArray),this.drawCalls.push(N)),N.start=$,N.size=0,N.texArray.count=0,N.type=H),z.touched=1,z._batchEnabled=t,z._batchLocation=k,z.wrapMode=WRAP_MODES.REPEAT,N.texArray.elements[N.texArray.count++]=z,k++)),N.size+=V.size,$+=V.size,G=z._batchLocation,this.addColors(o,X.color,X.alpha,V.attribSize,V.attribStart),this.addTextureIds(D,G,V.attribSize,V.attribStart)}BaseTexture._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,r=this.uvs,o=this.colors,D=this.textureIds,N=new ArrayBuffer(t.length*3*4),k=new Float32Array(N),B=new Uint32Array(N),G=0,U=0;U<t.length/2;U++)k[G++]=t[U*2],k[G++]=t[U*2+1],k[G++]=r[U*2],k[G++]=r[U*2+1],B[G++]=o[U],k[G++]=D[U];this._buffer.update(N),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){if(t.holes.length)buildPoly.triangulate(t,this);else{var r=FILL_COMMANDS[t.type];r.triangulate(t,this)}},e.prototype.processLine=function(t){buildLine(t,this);for(var r=0;r<t.holes.length;r++)buildLine(t.holes[r],this)},e.prototype.processHoles=function(t){for(var r=0;r<t.length;r++){var o=t[r],D=FILL_COMMANDS[o.type];D.build(o),o.matrix&&this.transformPoints(o.points,o.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,r){for(var o=0;o<t.length/2;o++){var D=t[o*2],N=t[o*2+1];t[o*2]=r.a*D+r.c*N+r.tx,t[o*2+1]=r.b*D+r.d*N+r.ty}},e.prototype.addColors=function(t,r,o,D,N){N===void 0&&(N=0);var k=(r>>16)+(r&65280)+((r&255)<<16),B=premultiplyTint(k,o);t.length=Math.max(t.length,N+D);for(var G=0;G<D;G++)t[N+G]=B},e.prototype.addTextureIds=function(t,r,o,D){D===void 0&&(D=0),t.length=Math.max(t.length,D+o);for(var N=0;N<o;N++)t[D+N]=r},e.prototype.addUvs=function(t,r,o,D,N,k){k===void 0&&(k=null);for(var B=0,G=r.length,U=o.frame;B<N;){var H=t[(D+B)*2],$=t[(D+B)*2+1];if(k){var V=k.a*H+k.c*$+k.tx;$=k.b*H+k.d*$+k.ty,H=V}B++,r.push(H/U.width,$/U.height)}var Y=o.baseTexture;(U.width<Y.width||U.height<Y.height)&&this.adjustUvs(r,o,G,N)},e.prototype.adjustUvs=function(t,r,o,D){for(var N=r.baseTexture,k=1e-6,B=o+D*2,G=r.frame,U=G.width/N.width,H=G.height/N.height,$=G.x/G.width,V=G.y/G.height,Y=Math.floor(t[o]+k),X=Math.floor(t[o+1]+k),z=o+2;z<B;z+=2)Y=Math.min(Y,Math.floor(t[z]+k)),X=Math.min(X,Math.floor(t[z+1]+k));$-=Y,V-=X;for(var z=o;z<B;z+=2)t[z]=(t[z]+$)*U,t[z+1]=(t[z+1]+V)*H},e.BATCHABLE_SIZE=100,e}(BatchGeometry),LineStyle=function(n){__extends$e(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.width=0,t.alignment=.5,t.native=!1,t.cap=LINE_CAP.BUTT,t.join=LINE_JOIN.MITER,t.miterLimit=10,t}return e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){n.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(FillStyle),temp=new Float32Array(3),DEFAULT_SHADERS={},Graphics=function(n){__extends$e(e,n);function e(t){t===void 0&&(t=null);var r=n.call(this)||this;return r.shader=null,r.pluginName="batch",r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r._fillStyle=new FillStyle,r._lineStyle=new LineStyle,r._matrix=null,r._holeMode=!1,r.state=State.for2d(),r._geometry=t||new GraphicsGeometry,r._geometry.refCount++,r._transformID=-1,r.tint=16777215,r.blendMode=BLEND_MODES.NORMAL,r}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t,r,o,D,N){return t===void 0&&(t=null),r===void 0&&(r=0),o===void 0&&(o=1),D===void 0&&(D=.5),N===void 0&&(N=!1),typeof t=="number"&&(t={width:t,color:r,alpha:o,alignment:D,native:N}),this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){t=Object.assign({width:0,texture:Texture.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[r-2],t[r-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,r){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=r,this},e.prototype.lineTo=function(t,r){this.currentPath||this.moveTo(0,0);var o=this.currentPath.points,D=o[o.length-2],N=o[o.length-1];return(D!==t||N!==r)&&o.push(t,r),this},e.prototype._initCurve=function(t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,r]):this.moveTo(t,r)},e.prototype.quadraticCurveTo=function(t,r,o,D){this._initCurve();var N=this.currentPath.points;return N.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(t,r,o,D,N),this},e.prototype.bezierCurveTo=function(t,r,o,D,N,k){return this._initCurve(),BezierUtils.curveTo(t,r,o,D,N,k,this.currentPath.points),this},e.prototype.arcTo=function(t,r,o,D,N){this._initCurve(t,r);var k=this.currentPath.points,B=ArcUtils.curveTo(t,r,o,D,N,k);if(B){var G=B.cx,U=B.cy,H=B.radius,$=B.startAngle,V=B.endAngle,Y=B.anticlockwise;this.arc(G,U,H,$,V,Y)}return this},e.prototype.arc=function(t,r,o,D,N,k){if(k===void 0&&(k=!1),D===N)return this;!k&&N<=D?N+=PI_2:k&&D<=N&&(D+=PI_2);var B=N-D;if(B===0)return this;var G=t+Math.cos(D)*o,U=r+Math.sin(D)*o,H=this._geometry.closePointEps,$=this.currentPath?this.currentPath.points:null;if($){var V=Math.abs($[$.length-2]-G),Y=Math.abs($[$.length-1]-U);V<H&&Y<H||$.push(G,U)}else this.moveTo(G,U),$=this.currentPath.points;return ArcUtils.arc(G,U,t,r,o,D,N,k,$),this},e.prototype.beginFill=function(t,r){return t===void 0&&(t=0),r===void 0&&(r=1),this.beginTextureFill({texture:Texture.WHITE,color:t,alpha:r})},e.prototype.beginTextureFill=function(t){t=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,r,o,D){return this.drawShape(new Rectangle(t,r,o,D))},e.prototype.drawRoundedRect=function(t,r,o,D,N){return this.drawShape(new RoundedRectangle(t,r,o,D,N))},e.prototype.drawCircle=function(t,r,o){return this.drawShape(new Circle(t,r,o))},e.prototype.drawEllipse=function(t,r,o,D){return this.drawShape(new Ellipse(t,r,o,D))},e.prototype.drawPolygon=function(){for(var t=arguments,r=[],o=0;o<arguments.length;o++)r[o]=t[o];var D,N=!0,k=r[0];k.points?(N=k.closeStroke,D=k.points):Array.isArray(r[0])?D=r[0]:D=r;var B=new Polygon(D);return B.closeStroke=N,this.drawShape(B),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===SHAPES.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var r=this._geometry;r.updateBatches(),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,r=this.blendMode,o=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=o,this.vertexData=new Float32Array(t.points);for(var D=0;D<o;D++){var N=t.batches[D],k=N.style.color,B=new Float32Array(this.vertexData.buffer,N.attribStart*4*2,N.attribSize*2),G=new Float32Array(t.uvsFloat32.buffer,N.attribStart*4*2,N.attribSize*2),U=new Uint16Array(t.indicesUint16.buffer,N.start*2,N.size),H={vertexData:B,blendMode:r,indices:U,uvs:G,_batchRGB:hex2rgb(k),_tintRGB:k,_texture:N.style.texture,alpha:N.style.alpha,worldAlpha:1};this.batches[D]=H}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,o=this.batches.length;r<o;r++){var D=this.batches[r];D.worldAlpha=this.worldAlpha*D.alpha,t.plugins[this.pluginName].render(D)}}},e.prototype._renderDirect=function(t){var r=this._resolveDirectShader(t),o=this._geometry,D=this.tint,N=this.worldAlpha,k=r.uniforms,B=o.drawCalls;k.translationMatrix=this.transform.worldTransform,k.tint[0]=(D>>16&255)/255*N,k.tint[1]=(D>>8&255)/255*N,k.tint[2]=(D&255)/255*N,k.tint[3]=N,t.shader.bind(r),t.geometry.bind(o,r),t.state.set(this.state);for(var G=0,U=B.length;G<U;G++)this._renderDrawCallDirect(t,o.drawCalls[G])},e.prototype._renderDrawCallDirect=function(t,r){for(var o=r.texArray,D=r.type,N=r.size,k=r.start,B=o.count,G=0;G<B;G++)t.texture.bind(o.elements[G],G);t.geometry.draw(D,N,k)},e.prototype._resolveDirectShader=function(t){var r=this.shader,o=this.pluginName;if(!r){if(!DEFAULT_SHADERS[o]){for(var D=t.plugins[o].MAX_TEXTURES,N=new Int32Array(D),k=0;k<D;k++)N[k]=k;var B={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:N},!0)},G=t.plugins[o]._shader.program;DEFAULT_SHADERS[o]=new Shader(G,B)}r=DEFAULT_SHADERS[o]}return r},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var r=t.bounds,o=r.minX,D=r.minY,N=r.maxX,k=r.maxY;this._bounds.addFrame(this.transform,o,D,N,k)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=hex2rgb(this.tint,temp),r=0;r<this.batches.length;r++){var o=this.batches[r],D=o._batchRGB,N=t[0]*D[0]*255,k=t[1]*D[1]*255,B=t[2]*D[2]*255,G=(N<<16)+(k<<8)+(B|0);o._tintRGB=(G>>16)+(G&65280)+((G&255)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var r=this.transform.worldTransform,o=r.a,D=r.b,N=r.c,k=r.d,B=r.tx,G=r.ty,U=this._geometry.points,H=this.vertexData,$=0,V=0;V<U.length;V+=2){var Y=U[V],X=U[V+1];H[$++]=o*Y+N*X+B,H[$++]=k*X+D*Y+G}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,n.prototype.destroy.call(this,t)},e.nextRoundedRectBehavior=!1,e._TEMP_POINT=new Point,e}(Container);/*!
 * @pixi/sprite - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/sprite is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$d=function(n,e){return extendStatics$d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$d(n,e)};function __extends$d(n,e){extendStatics$d(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var tempPoint$2=new Point,indices=new Uint16Array([0,1,2,0,2,3]),Sprite=function(n){__extends$d(e,n);function e(t){var r=n.call(this)||this;return r._anchor=new ObservablePoint(r._onAnchorUpdate,r,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=BLEND_MODES.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=t||Texture.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=indices,r.pluginName="batch",r.isSprite=!0,r._roundPixels=settings.ROUND_PIXELS,r}return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===t._updateID)){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var r=this.transform.worldTransform,o=r.a,D=r.b,N=r.c,k=r.d,B=r.tx,G=r.ty,U=this.vertexData,H=t.trim,$=t.orig,V=this._anchor,Y=0,X=0,z=0,W=0;if(H?(X=H.x-V._x*$.width,Y=X+H.width,W=H.y-V._y*$.height,z=W+H.height):(X=-V._x*$.width,Y=X+$.width,W=-V._y*$.height,z=W+$.height),U[0]=o*X+N*W+B,U[1]=k*W+D*X+G,U[2]=o*Y+N*W+B,U[3]=k*W+D*Y+G,U[4]=o*Y+N*z+B,U[5]=k*z+D*Y+G,U[6]=o*X+N*z+B,U[7]=k*z+D*X+G,this._roundPixels)for(var q=settings.RESOLUTION,K=0;K<U.length;++K)U[K]=Math.round((U[K]*q|0)/q)}},e.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,r=this.vertexTrimmedData,o=t.orig,D=this._anchor,N=this.transform.worldTransform,k=N.a,B=N.b,G=N.c,U=N.d,H=N.tx,$=N.ty,V=-D._x*o.width,Y=V+o.width,X=-D._y*o.height,z=X+o.height;r[0]=k*V+G*X+H,r[1]=U*X+B*V+$,r[2]=k*Y+G*X+H,r[3]=U*X+B*Y+$,r[4]=k*Y+G*z+H,r[5]=U*z+B*Y+$,r[6]=k*V+G*z+H,r[7]=U*z+B*V+$},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._localBounds.getRectangle(t)):n.prototype.getLocalBounds.call(this,t)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint$2);var r=this._texture.orig.width,o=this._texture.orig.height,D=-r*this.anchor.x,N=0;return tempPoint$2.x>=D&&tempPoint$2.x<D+r&&(N=-o*this.anchor.y,tempPoint$2.y>=N&&tempPoint$2.y<N+o)},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof t=="boolean"?t:t&&t.texture;if(r){var o=typeof t=="boolean"?t:t&&t.baseTexture;this._texture.destroy(!!o)}this._texture=null},e.from=function(t,r){var o=t instanceof Texture?t:Texture.from(t,r);return new e(o)},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var r=sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var r=sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(Container);/*!
 * @pixi/text - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/text is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$c=function(n,e){return extendStatics$c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$c(n,e)};function __extends$c(n,e){extendStatics$c(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var TEXT_GRADIENT;(function(n){n[n.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",n[n.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(TEXT_GRADIENT||(TEXT_GRADIENT={}));var defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],TextStyle=function(){function n(e){this.styleID=0,this.reset(),deepCopyProperties(this,e,e)}return n.prototype.clone=function(){var e={};return deepCopyProperties(e,this,defaultStyle),new n(e)},n.prototype.reset=function(){deepCopyProperties(this,defaultStyle,defaultStyle)},Object.defineProperty(n.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"breakWords",{get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(e){var t=getColor(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fill",{get:function(){return this._fill},set:function(e){var t=getColor(e);this._fill!==t&&(this._fill=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(e){areArraysEqual(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leading",{get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"stroke",{get:function(){return this._stroke},set:function(e){var t=getColor(e);this._stroke!==t&&(this._stroke=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"trim",{get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},enumerable:!1,configurable:!0}),n.prototype.toFontString=function(){var e=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(var r=t.length-1;r>=0;r--){var o=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(o)&&genericFontFamilies.indexOf(o)<0&&(o='"'+o+'"'),t[r]=o}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+t.join(",")},n}();function getSingleColor(n){return typeof n=="number"?hex2string(n):(typeof n=="string"&&n.indexOf("0x")===0&&(n=n.replace("0x","#")),n)}function getColor(n){if(Array.isArray(n)){for(var e=0;e<n.length;++e)n[e]=getSingleColor(n[e]);return n}else return getSingleColor(n)}function areArraysEqual(n,e){if(!Array.isArray(n)||!Array.isArray(e)||n.length!==e.length)return!1;for(var t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}function deepCopyProperties(n,e,t){for(var r in t)Array.isArray(e[r])?n[r]=e[r].slice():n[r]=e[r]}var contextSettings={willReadFrequently:!0},TextMetrics=function(){function n(e,t,r,o,D,N,k,B,G){this.text=e,this.style=t,this.width=r,this.height=o,this.lines=D,this.lineWidths=N,this.lineHeight=k,this.maxLineWidth=B,this.fontProperties=G}return n.measureText=function(e,t,r,o){o===void 0&&(o=n._canvas),r=r??t.wordWrap;var D=t.toFontString(),N=n.measureFont(D);N.fontSize===0&&(N.fontSize=t.fontSize,N.ascent=t.fontSize);var k=o.getContext("2d",contextSettings);k.font=D;for(var B=r?n.wordWrap(e,t,o):e,G=B.split(/(?:\r\n|\r|\n)/),U=new Array(G.length),H=0,$=0;$<G.length;$++){var V=k.measureText(G[$]).width+(G[$].length-1)*t.letterSpacing;U[$]=V,H=Math.max(H,V)}var Y=H+t.strokeThickness;t.dropShadow&&(Y+=t.dropShadowDistance);var X=t.lineHeight||N.fontSize+t.strokeThickness,z=Math.max(X,N.fontSize+t.strokeThickness)+(G.length-1)*(X+t.leading);return t.dropShadow&&(z+=t.dropShadowDistance),new n(e,t,Y,z,G,U,X+t.leading,H,N)},n.wordWrap=function(e,t,r){r===void 0&&(r=n._canvas);for(var o=r.getContext("2d",contextSettings),D=0,N="",k="",B=Object.create(null),G=t.letterSpacing,U=t.whiteSpace,H=n.collapseSpaces(U),$=n.collapseNewlines(U),V=!H,Y=t.wordWrapWidth+G,X=n.tokenize(e),z=0;z<X.length;z++){var W=X[z];if(n.isNewline(W)){if(!$){k+=n.addLine(N),V=!H,N="",D=0;continue}W=" "}if(H){var q=n.isBreakingSpace(W),K=n.isBreakingSpace(N[N.length-1]);if(q&&K)continue}var Q=n.getFromCache(W,G,B,o);if(Q>Y)if(N!==""&&(k+=n.addLine(N),N="",D=0),n.canBreakWords(W,t.breakWords))for(var Z=n.wordWrapSplit(W),ee=0;ee<Z.length;ee++){for(var J=Z[ee],te=1;Z[ee+te];){var oe=Z[ee+te],ce=J[J.length-1];if(!n.canBreakChars(ce,oe,W,ee,t.breakWords))J+=oe;else break;te++}ee+=J.length-1;var fe=n.getFromCache(J,G,B,o);fe+D>Y&&(k+=n.addLine(N),V=!1,N="",D=0),N+=J,D+=fe}else{N.length>0&&(k+=n.addLine(N),N="",D=0);var me=z===X.length-1;k+=n.addLine(W,!me),V=!1,N="",D=0}else Q+D>Y&&(V=!1,k+=n.addLine(N),N="",D=0),(N.length>0||!n.isBreakingSpace(W)||V)&&(N+=W,D+=Q)}return k+=n.addLine(N,!1),k},n.addLine=function(e,t){return t===void 0&&(t=!0),e=n.trimRight(e),e=t?e+`
`:e,e},n.getFromCache=function(e,t,r,o){var D=r[e];if(typeof D!="number"){var N=e.length*t;D=o.measureText(e).width+N,r[e]=D}return D},n.collapseSpaces=function(e){return e==="normal"||e==="pre-line"},n.collapseNewlines=function(e){return e==="normal"},n.trimRight=function(e){if(typeof e!="string")return"";for(var t=e.length-1;t>=0;t--){var r=e[t];if(!n.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},n.isNewline=function(e){return typeof e!="string"?!1:n._newlines.indexOf(e.charCodeAt(0))>=0},n.isBreakingSpace=function(e,t){return typeof e!="string"?!1:n._breakingSpaces.indexOf(e.charCodeAt(0))>=0},n.tokenize=function(e){var t=[],r="";if(typeof e!="string")return t;for(var o=0;o<e.length;o++){var D=e[o],N=e[o+1];if(n.isBreakingSpace(D,N)||n.isNewline(D)){r!==""&&(t.push(r),r=""),t.push(D);continue}r+=D}return r!==""&&t.push(r),t},n.canBreakWords=function(e,t){return t},n.canBreakChars=function(e,t,r,o,D){return!0},n.wordWrapSplit=function(e){return e.split("")},n.measureFont=function(e){if(n._fonts[e])return n._fonts[e];var t={ascent:0,descent:0,fontSize:0},r=n._canvas,o=n._context;o.font=e;var D=n.METRICS_STRING+n.BASELINE_SYMBOL,N=Math.ceil(o.measureText(D).width),k=Math.ceil(o.measureText(n.BASELINE_SYMBOL).width),B=Math.ceil(n.HEIGHT_MULTIPLIER*k);k=k*n.BASELINE_MULTIPLIER|0,r.width=N,r.height=B,o.fillStyle="#f00",o.fillRect(0,0,N,B),o.font=e,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText(D,0,k);var G=o.getImageData(0,0,N,B).data,U=G.length,H=N*4,$=0,V=0,Y=!1;for($=0;$<k;++$){for(var X=0;X<H;X+=4)if(G[V+X]!==255){Y=!0;break}if(!Y)V+=H;else break}for(t.ascent=k-$,V=U-H,Y=!1,$=B;$>k;--$){for(var X=0;X<H;X+=4)if(G[V+X]!==255){Y=!0;break}if(!Y)V-=H;else break}return t.descent=$-k,t.fontSize=t.ascent+t.descent,n._fonts[e]=t,t},n.clearMetrics=function(e){e===void 0&&(e=""),e?delete n._fonts[e]:n._fonts={}},Object.defineProperty(n,"_canvas",{get:function(){if(!n.__canvas){var e=void 0;try{var t=new OffscreenCanvas(0,0),r=t.getContext("2d",contextSettings);if(r&&r.measureText)return n.__canvas=t,t;e=settings.ADAPTER.createCanvas()}catch{e=settings.ADAPTER.createCanvas()}e.width=e.height=10,n.__canvas=e}return n.__canvas},enumerable:!1,configurable:!0}),Object.defineProperty(n,"_context",{get:function(){return n.__context||(n.__context=n._canvas.getContext("2d",contextSettings)),n.__context},enumerable:!1,configurable:!0}),n}();TextMetrics._fonts={};TextMetrics.METRICS_STRING="|ÉqÅ";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics.HEIGHT_MULTIPLIER=2;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Text=function(n){__extends$c(e,n);function e(t,r,o){var D=this,N=!1;o||(o=settings.ADAPTER.createCanvas(),N=!0),o.width=3,o.height=3;var k=Texture.from(o);return k.orig=new Rectangle,k.trim=new Rectangle,D=n.call(this,k)||this,D._ownCanvas=N,D.canvas=o,D.context=o.getContext("2d",{willReadFrequently:!0}),D._resolution=settings.RESOLUTION,D._autoResolution=!0,D._text=null,D._style=null,D._styleListener=null,D._font="",D.text=t,D.style=r,D.localStyleID=-1,D}return e.prototype.updateText=function(t){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&t)){this._font=this._style.toFontString();var o=this.context,D=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),N=D.width,k=D.height,B=D.lines,G=D.lineHeight,U=D.lineWidths,H=D.maxLineWidth,$=D.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,N)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,k)+r.padding*2)*this._resolution),o.scale(this._resolution,this._resolution),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.font=this._font,o.lineWidth=r.strokeThickness,o.textBaseline=r.textBaseline,o.lineJoin=r.lineJoin,o.miterLimit=r.miterLimit;for(var V,Y,X=r.dropShadow?2:1,z=0;z<X;++z){var W=r.dropShadow&&z===0,q=W?Math.ceil(Math.max(1,k)+r.padding*2):0,K=q*this._resolution;if(W){o.fillStyle="black",o.strokeStyle="black";var Q=r.dropShadowColor,Z=hex2rgb(typeof Q=="number"?Q:string2hex(Q)),ee=r.dropShadowBlur*this._resolution,J=r.dropShadowDistance*this._resolution;o.shadowColor="rgba("+Z[0]*255+","+Z[1]*255+","+Z[2]*255+","+r.dropShadowAlpha+")",o.shadowBlur=ee,o.shadowOffsetX=Math.cos(r.dropShadowAngle)*J,o.shadowOffsetY=Math.sin(r.dropShadowAngle)*J+K}else o.fillStyle=this._generateFillStyle(r,B,D),o.strokeStyle=r.stroke,o.shadowColor="black",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;var te=(G-$.fontSize)/2;(!e.nextLineHeightBehavior||G-$.fontSize<0)&&(te=0);for(var oe=0;oe<B.length;oe++)V=r.strokeThickness/2,Y=r.strokeThickness/2+oe*G+$.ascent+te,r.align==="right"?V+=H-U[oe]:r.align==="center"&&(V+=(H-U[oe])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(B[oe],V+r.padding,Y+r.padding-q,!0),r.fill&&this.drawLetterSpacing(B[oe],V+r.padding,Y+r.padding-q)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,r,o,D){D===void 0&&(D=!1);var N=this._style,k=N.letterSpacing,B=e.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(k===0||B){B&&(this.context.letterSpacing=k,this.context.textLetterSpacing=k),D?this.context.strokeText(t,r,o):this.context.fillText(t,r,o);return}for(var G=r,U=Array.from?Array.from(t):t.split(""),H=this.context.measureText(t).width,$=0,V=0;V<U.length;++V){var Y=U[V];D?this.context.strokeText(Y,G,o):this.context.fillText(Y,G,o);for(var X="",z=V+1;z<U.length;++z)X+=U[z];$=this.context.measureText(X).width,G+=H-$+k,H=$}},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var r=trimCanvas(t);r.data&&(t.width=r.width,t.height=r.height,this.context.putImageData(r.data,0,0))}var o=this._texture,D=this._style,N=D.trim?0:D.padding,k=o.baseTexture;o.trim.width=o._frame.width=t.width/this._resolution,o.trim.height=o._frame.height=t.height/this._resolution,o.trim.x=-N,o.trim.y=-N,o.orig.width=o._frame.width-N*2,o.orig.height=o._frame.height-N*2,this._onTextureUpdate(),k.setRealSize(t.width,t.height,this._resolution),o.updateUvs(),this.dirty=!1},e.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),n.prototype._render.call(this,t)},e.prototype.updateTransform=function(){this.updateText(!0),n.prototype.updateTransform.call(this)},e.prototype.getBounds=function(t,r){return this.updateText(!0),this._textureID===-1&&(t=!1),n.prototype.getBounds.call(this,t,r)},e.prototype.getLocalBounds=function(t){return this.updateText(!0),n.prototype.getLocalBounds.call(this,t)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,r,o){var D=t.fill;if(Array.isArray(D)){if(D.length===1)return D[0]}else return D;var N,k=t.dropShadow?t.dropShadowDistance:0,B=t.padding||0,G=this.canvas.width/this._resolution-k-B*2,U=this.canvas.height/this._resolution-k-B*2,H=D.slice(),$=t.fillGradientStops.slice();if(!$.length)for(var V=H.length+1,Y=1;Y<V;++Y)$.push(Y/V);if(H.unshift(D[0]),$.unshift(0),H.push(D[D.length-1]),$.push(1),t.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){N=this.context.createLinearGradient(G/2,B,G/2,U+B);for(var X=o.fontProperties.fontSize+t.strokeThickness,Y=0;Y<r.length;Y++){var z=o.lineHeight*(Y-1)+X,W=o.lineHeight*Y,q=W;Y>0&&z>W&&(q=(W+z)/2);var K=W+X,Q=o.lineHeight*(Y+1),Z=K;Y+1<r.length&&Q<K&&(Z=(K+Q)/2);for(var ee=(Z-q)/U,J=0;J<H.length;J++){var te=0;typeof $[J]=="number"?te=$[J]:te=J/H.length;var oe=Math.min(1,Math.max(0,q/U+te*ee));oe=Number(oe.toFixed(5)),N.addColorStop(oe,H[J])}}}else{N=this.context.createLinearGradient(B,U/2,G+B,U/2);for(var ce=H.length+1,fe=1,Y=0;Y<H.length;Y++){var me=void 0;typeof $[Y]=="number"?me=$[Y]:me=fe/ce,N.addColorStop(me,H[Y]),fe++}}return N},e.prototype.destroy=function(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},defaultDestroyOptions,t),n.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var r=sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var r=sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},t instanceof TextStyle?this._style=t:this._style=new TextStyle(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e.experimentalLetterSpacing=!1,e}(Sprite);/*!
 * @pixi/prepare - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/prepare is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */settings.UPLOADS_PER_FRAME=4;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$b=function(n,e){return extendStatics$b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$b(n,e)};function __extends$b(n,e){extendStatics$b(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var CountLimiter=function(){function n(e){this.maxItemsPerFrame=e,this.itemsLeft=0}return n.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},n.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},n}();function findMultipleBaseTextures(n,e){var t=!1;if(n&&n._textures&&n._textures.length){for(var r=0;r<n._textures.length;r++)if(n._textures[r]instanceof Texture){var o=n._textures[r].baseTexture;e.indexOf(o)===-1&&(e.push(o),t=!0)}}return t}function findBaseTexture(n,e){if(n.baseTexture instanceof BaseTexture){var t=n.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function findTexture(n,e){if(n._texture&&n._texture instanceof Texture){var t=n._texture.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function drawText(n,e){return e instanceof Text?(e.updateText(!0),!0):!1}function calculateTextStyle(n,e){if(e instanceof TextStyle){var t=e.toFontString();return TextMetrics.measureFont(t),!0}return!1}function findText(n,e){if(n instanceof Text){e.indexOf(n.style)===-1&&e.push(n.style),e.indexOf(n)===-1&&e.push(n);var t=n._texture.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function findTextStyle(n,e){return n instanceof TextStyle?(e.indexOf(n)===-1&&e.push(n),!0):!1}var BasePrepare=function(){function n(e){var t=this;this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){t.queue&&t.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}return n.prototype.upload=function(e,t){var r=this;return typeof e=="function"&&(t=e,e=null),t&&deprecation("6.5.0","BasePrepare.upload callback is deprecated, use the return Promise instead."),new Promise(function(o){e&&r.add(e);var D=function(){t?.(),o()};r.queue.length?(r.completes.push(D),r.ticking||(r.ticking=!0,Ticker.system.addOnce(r.tick,r,UPDATE_PRIORITY.UTILITY))):D()})},n.prototype.tick=function(){setTimeout(this.delayedTick,0)},n.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],t=!1;if(e&&!e._destroyed){for(var r=0,o=this.uploadHooks.length;r<o;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var D=this.completes.slice(0);this.completes.length=0;for(var r=0,o=D.length;r<o;r++)D[r]()}},n.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},n.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},n.prototype.add=function(e){for(var t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Container)for(var t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this},n.prototype.destroy=function(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},n}();function uploadBaseTextures(n,e){return e instanceof BaseTexture?(e._glTextures[n.CONTEXT_UID]||n.texture.bind(e),!0):!1}function uploadGraphics(n,e){if(!(e instanceof Graphics))return!1;var t=e.geometry;e.finishPoly(),t.updateBatches();for(var r=t.batches,o=0;o<r.length;o++){var D=r[o].style.texture;D&&uploadBaseTextures(n,D.baseTexture)}return t.batchable||n.geometry.bind(t,e._resolveDirectShader(n)),!0}function findGraphics(n,e){return n instanceof Graphics?(e.push(n),!0):!1}var Prepare=function(n){__extends$b(e,n);function e(t){var r=n.call(this,t)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(findGraphics),r.registerUploadHook(uploadBaseTextures),r.registerUploadHook(uploadGraphics),r}return e.extension={name:"prepare",type:ExtensionType.RendererPlugin},e}(BasePrepare);/*!
 * @pixi/spritesheet - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/spritesheet is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Spritesheet=function(){function n(e,t,r){r===void 0&&(r=null),this.linkedSheets=[],this._texture=e instanceof Texture?e:null,this.baseTexture=e instanceof BaseTexture?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;var o=this.baseTexture.resource;this.resolution=this._updateResolution(r||(o?o.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return n.prototype._updateResolution=function(e){e===void 0&&(e=null);var t=this.data.meta.scale,r=getResolutionOfUrl(e,null);return r===null&&(r=t!==void 0?parseFloat(t):1),r!==1&&this.baseTexture.setResolution(r),r},n.prototype.parse=function(e){var t=this;return e&&deprecation("6.5.0","Spritesheet.parse callback is deprecated, use the return Promise instead."),new Promise(function(r){t._callback=function(o){e?.(o),r(o)},t._batchIndex=0,t._frameKeys.length<=n.BATCH_SIZE?(t._processFrames(0),t._processAnimations(),t._parseComplete()):t._nextBatch()})},n.prototype._processFrames=function(e){for(var t=e,r=n.BATCH_SIZE;t-e<r&&t<this._frameKeys.length;){var o=this._frameKeys[t],D=this._frames[o],N=D.frame;if(N){var k=null,B=null,G=D.trimmed!==!1&&D.sourceSize?D.sourceSize:D.frame,U=new Rectangle(0,0,Math.floor(G.w)/this.resolution,Math.floor(G.h)/this.resolution);D.rotated?k=new Rectangle(Math.floor(N.x)/this.resolution,Math.floor(N.y)/this.resolution,Math.floor(N.h)/this.resolution,Math.floor(N.w)/this.resolution):k=new Rectangle(Math.floor(N.x)/this.resolution,Math.floor(N.y)/this.resolution,Math.floor(N.w)/this.resolution,Math.floor(N.h)/this.resolution),D.trimmed!==!1&&D.spriteSourceSize&&(B=new Rectangle(Math.floor(D.spriteSourceSize.x)/this.resolution,Math.floor(D.spriteSourceSize.y)/this.resolution,Math.floor(N.w)/this.resolution,Math.floor(N.h)/this.resolution)),this.textures[o]=new Texture(this.baseTexture,k,U,B,D.rotated?2:0,D.anchor),Texture.addToCache(this.textures[o],o)}t++}},n.prototype._processAnimations=function(){var e=this.data.animations||{};for(var t in e){this.animations[t]=[];for(var r=0;r<e[t].length;r++){var o=e[t][r];this.animations[t].push(this.textures[o])}}},n.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},n.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*n.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*n.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},n.prototype.destroy=function(e){var t;e===void 0&&(e=!1);for(var r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)===null||t===void 0||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]},n.BATCH_SIZE=1e3,n}(),SpritesheetLoader=function(){function n(){}return n.use=function(e,t){var r,o,D=this,N=e.name+"_image";if(!e.data||e.type!==LoaderResource.TYPE.JSON||!e.data.frames||D.resources[N]){t();return}var k=(o=(r=e.data)===null||r===void 0?void 0:r.meta)===null||o===void 0?void 0:o.related_multi_packs;if(Array.isArray(k))for(var B=function(Y){if(typeof Y!="string")return"continue";var X=Y.replace(".json",""),z=url$1.resolve(e.url.replace(D.baseUrl,""),Y);if(D.resources[X]||Object.values(D.resources).some(function(q){return url$1.format(url$1.parse(q.url))===z}))return"continue";var W={crossOrigin:e.crossOrigin,loadType:LoaderResource.LOAD_TYPE.XHR,xhrType:LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};D.add(X,z,W)},G=0,U=k;G<U.length;G++){var H=U[G];B(H)}var $={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},V=n.getResourcePath(e,D.baseUrl);D.add(N,V,$,function(Y){if(Y.error){t(Y.error);return}var X=new Spritesheet(Y.texture,e.data,e.url);X.parse().then(function(){e.spritesheet=X,e.textures=X.textures,t()})})},n.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:url$1.resolve(e.url.replace(t,""),e.data.meta.image)},n.extension=ExtensionType.Loader,n}();/*!
 * @pixi/sprite-tiling - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/sprite-tiling is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$a=function(n,e){return extendStatics$a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$a(n,e)};function __extends$a(n,e){extendStatics$a(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var tempPoint$1=new Point;(function(n){__extends$a(e,n);function e(t,r,o){r===void 0&&(r=100),o===void 0&&(o=100);var D=n.call(this,t)||this;return D.tileTransform=new Transform,D._width=r,D._height=o,D.uvMatrix=D.texture.uvMatrix||new TextureMatrix(t),D.pluginName="tilingSprite",D.uvRespectAnchor=!1,D}return Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,r=this._height*-this._anchor._y,o=this._width*(1-this._anchor._x),D=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,r,o,D)},e.prototype.getLocalBounds=function(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):n.prototype.getLocalBounds.call(this,t)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint$1);var r=this._width,o=this._height,D=-r*this.anchor._x;if(tempPoint$1.x>=D&&tempPoint$1.x<D+r){var N=-o*this.anchor._y;if(tempPoint$1.y>=N&&tempPoint$1.y<N+o)return!0}return!1},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r){var o=t instanceof Texture?t:Texture.from(t,r);return new e(o,r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e})(Sprite);var fragmentSimpleSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,gl1VertexSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl1FragmentSrc=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,gl2VertexSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl2FragmentSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,tempMat=new Matrix,TilingSpriteRenderer=function(n){__extends$a(e,n);function e(t){var r=n.call(this,t)||this;return t.runners.contextChange.add(r),r.quad=new QuadUv,r.state=State.for2d(),r}return e.prototype.contextChange=function(){var t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,r),this.shader=t.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,r):Shader.from(gl1VertexSrc,gl1FragmentSrc,r)},e.prototype.render=function(t){var r=this.renderer,o=this.quad,D=o.vertices;D[0]=D[6]=t._width*-t.anchor.x,D[1]=D[3]=t._height*-t.anchor.y,D[2]=D[4]=t._width*(1-t.anchor.x),D[5]=D[7]=t._height*(1-t.anchor.y);var N=t.uvRespectAnchor?t.anchor.x:0,k=t.uvRespectAnchor?t.anchor.y:0;D=o.uvs,D[0]=D[6]=-N,D[1]=D[3]=-k,D[2]=D[4]=1-N,D[5]=D[7]=1-k,o.invalidate();var B=t._texture,G=B.baseTexture,U=G.alphaMode>0,H=t.tileTransform.localTransform,$=t.uvMatrix,V=G.isPowerOfTwo&&B.frame.width===G.width&&B.frame.height===G.height;V&&(G._glTextures[r.CONTEXT_UID]?V=G.wrapMode!==WRAP_MODES.CLAMP:G.wrapMode===WRAP_MODES.CLAMP&&(G.wrapMode=WRAP_MODES.REPEAT));var Y=V?this.simpleShader:this.shader,X=B.width,z=B.height,W=t._width,q=t._height;tempMat.set(H.a*X/W,H.b*X/q,H.c*z/W,H.d*z/q,H.tx/W,H.ty/q),tempMat.invert(),V?tempMat.prepend($.mapCoord):(Y.uniforms.uMapCoord=$.mapCoord.toArray(!0),Y.uniforms.uClampFrame=$.uClampFrame,Y.uniforms.uClampOffset=$.uClampOffset),Y.uniforms.uTransform=tempMat.toArray(!0),Y.uniforms.uColor=premultiplyTintToRgba(t.tint,t.worldAlpha,Y.uniforms.uColor,U),Y.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),Y.uniforms.uSampler=B,r.shader.bind(Y),r.geometry.bind(o),this.state.blendMode=correctBlendMode(t.blendMode,U),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin},e}(ObjectRenderer);/*!
 * @pixi/mesh - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/mesh is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$9=function(n,e){return extendStatics$9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$9(n,e)};function __extends$9(n,e){extendStatics$9(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var MeshBatchUvs=function(){function n(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return n.prototype.update=function(e){if(!(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}},n}(),tempPoint=new Point,tempPolygon=new Polygon,Mesh=function(n){__extends$9(e,n);function e(t,r,o,D){D===void 0&&(D=DRAW_MODES.TRIANGLES);var N=n.call(this)||this;return N.geometry=t,N.shader=r,N.state=o||State.for2d(),N.drawMode=D,N.start=0,N.size=0,N.uvs=null,N.indices=null,N.vertexData=new Float32Array(1),N.vertexDirty=-1,N._transformID=-1,N._roundPixels=settings.ROUND_PIXELS,N.batchUvs=null,N}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var r=this.geometry.buffers[0].data,o=this.shader;o.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&r.length<e.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),t.batch.flush(),r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(r),t.state.set(this.state),t.geometry.bind(this.geometry,r),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var r=this.geometry,o=this.shader;o.uvMatrix&&(o.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=o._tintRGB,this._texture=o.texture;var D=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[D]),t.plugins[D].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,r=t.buffers[0],o=r.data,D=r._updateID;if(!(D===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==o.length&&(this.vertexData=new Float32Array(o.length));for(var N=this.transform.worldTransform,k=N.a,B=N.b,G=N.c,U=N.d,H=N.tx,$=N.ty,V=this.vertexData,Y=0;Y<V.length/2;Y++){var X=o[Y*2],z=o[Y*2+1];V[Y*2]=k*X+G*z+H,V[Y*2+1]=B*X+U*z+$}if(this._roundPixels)for(var W=settings.RESOLUTION,Y=0;Y<V.length;++Y)V[Y]=Math.round((V[Y]*W|0)/W);this.vertexDirty=D}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],r=this.shader;r.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(t,r.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,tempPoint);for(var r=this.geometry.getBuffer("aVertexPosition").data,o=tempPolygon.points,D=this.geometry.getIndex().data,N=D.length,k=this.drawMode===4?3:1,B=0;B+2<N;B+=k){var G=D[B]*2,U=D[B+1]*2,H=D[B+2]*2;if(o[0]=r[G],o[1]=r[G+1],o[2]=r[U],o[3]=r[U+1],o[4]=r[H],o[5]=r[H+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(Container),fragment$5=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,MeshMaterial=function(n){__extends$9(e,n);function e(t,r){var o=this,D={uSampler:t,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};return r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(D,r.uniforms),o=n.call(this,r.program||Program.from(vertex$2,fragment$5),D)||this,o._colorDirty=!1,o.uvMatrix=new TextureMatrix(t),o.batchable=r.program===void 0,o.pluginName=r.pluginName,o.tint=r.tint,o.alpha=r.alpha,o}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(Shader),MeshGeometry=function(n){__extends$9(e,n);function e(t,r,o){var D=n.call(this)||this,N=new Buffer(t),k=new Buffer(r,!0),B=new Buffer(o,!0,!0);return D.addAttribute("aVertexPosition",N,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",k,2,!1,TYPES.FLOAT).addIndex(B),D._updateId=-1,D}return Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(Geometry);/*!
 * @pixi/text-bitmap - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/text-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$8=function(n,e){return extendStatics$8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$8(n,e)};function __extends$8(n,e){extendStatics$8(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var BitmapFontData=function(){function n(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}return n}(),TextFormat=function(){function n(){}return n.test=function(e){return typeof e=="string"&&e.indexOf("info face=")===0},n.parse=function(e){var t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var o in t){var D=t[o].match(/^[a-z]+/gm)[0],N=t[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),k={};for(var B in N){var G=N[B].split("="),U=G[0],H=G[1].replace(/"/gm,""),$=parseFloat(H),V=isNaN($)?H:$;k[U]=V}r[D].push(k)}var Y=new BitmapFontData;return r.info.forEach(function(X){return Y.info.push({face:X.face,size:parseInt(X.size,10)})}),r.common.forEach(function(X){return Y.common.push({lineHeight:parseInt(X.lineHeight,10)})}),r.page.forEach(function(X){return Y.page.push({id:parseInt(X.id,10),file:X.file})}),r.char.forEach(function(X){return Y.char.push({id:parseInt(X.id,10),page:parseInt(X.page,10),x:parseInt(X.x,10),y:parseInt(X.y,10),width:parseInt(X.width,10),height:parseInt(X.height,10),xoffset:parseInt(X.xoffset,10),yoffset:parseInt(X.yoffset,10),xadvance:parseInt(X.xadvance,10)})}),r.kerning.forEach(function(X){return Y.kerning.push({first:parseInt(X.first,10),second:parseInt(X.second,10),amount:parseInt(X.amount,10)})}),r.distanceField.forEach(function(X){return Y.distanceField.push({distanceRange:parseInt(X.distanceRange,10),fieldType:X.fieldType})}),Y},n}(),XMLFormat=function(){function n(){}return n.test=function(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},n.parse=function(e){for(var t=new BitmapFontData,r=e.getElementsByTagName("info"),o=e.getElementsByTagName("common"),D=e.getElementsByTagName("page"),N=e.getElementsByTagName("char"),k=e.getElementsByTagName("kerning"),B=e.getElementsByTagName("distanceField"),G=0;G<r.length;G++)t.info.push({face:r[G].getAttribute("face"),size:parseInt(r[G].getAttribute("size"),10)});for(var G=0;G<o.length;G++)t.common.push({lineHeight:parseInt(o[G].getAttribute("lineHeight"),10)});for(var G=0;G<D.length;G++)t.page.push({id:parseInt(D[G].getAttribute("id"),10)||0,file:D[G].getAttribute("file")});for(var G=0;G<N.length;G++){var U=N[G];t.char.push({id:parseInt(U.getAttribute("id"),10),page:parseInt(U.getAttribute("page"),10)||0,x:parseInt(U.getAttribute("x"),10),y:parseInt(U.getAttribute("y"),10),width:parseInt(U.getAttribute("width"),10),height:parseInt(U.getAttribute("height"),10),xoffset:parseInt(U.getAttribute("xoffset"),10),yoffset:parseInt(U.getAttribute("yoffset"),10),xadvance:parseInt(U.getAttribute("xadvance"),10)})}for(var G=0;G<k.length;G++)t.kerning.push({first:parseInt(k[G].getAttribute("first"),10),second:parseInt(k[G].getAttribute("second"),10),amount:parseInt(k[G].getAttribute("amount"),10)});for(var G=0;G<B.length;G++)t.distanceField.push({fieldType:B[G].getAttribute("fieldType"),distanceRange:parseInt(B[G].getAttribute("distanceRange"),10)});return t},n}(),XMLStringFormat=function(){function n(){}return n.test=function(e){if(typeof e=="string"&&e.indexOf("<font>")>-1){var t=new globalThis.DOMParser().parseFromString(e,"text/xml");return XMLFormat.test(t)}return!1},n.parse=function(e){var t=new globalThis.DOMParser().parseFromString(e,"text/xml");return XMLFormat.parse(t)},n}(),formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(n){for(var e=0;e<formats.length;e++)if(formats[e].test(n))return formats[e];return null}function generateFillStyle(n,e,t,r,o,D){var N=t.fill;if(Array.isArray(N)){if(N.length===1)return N[0]}else return N;var k,B=t.dropShadow?t.dropShadowDistance:0,G=t.padding||0,U=n.width/r-B-G*2,H=n.height/r-B-G*2,$=N.slice(),V=t.fillGradientStops.slice();if(!V.length)for(var Y=$.length+1,X=1;X<Y;++X)V.push(X/Y);if($.unshift(N[0]),V.unshift(0),$.push(N[N.length-1]),V.push(1),t.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){k=e.createLinearGradient(U/2,G,U/2,H+G);for(var z=0,W=D.fontProperties.fontSize+t.strokeThickness,q=W/H,X=0;X<o.length;X++)for(var K=D.lineHeight*X,Q=0;Q<$.length;Q++){var Z=0;typeof V[Q]=="number"?Z=V[Q]:Z=Q/$.length;var ee=K/H+Z*q,J=Math.max(z,ee);J=Math.min(J,1),k.addColorStop(J,$[Q]),z=J}}else{k=e.createLinearGradient(G,H/2,U+G,H/2);for(var te=$.length+1,oe=1,X=0;X<$.length;X++){var ce=void 0;typeof V[X]=="number"?ce=V[X]:ce=oe/te,k.addColorStop(ce,$[X]),oe++}}return k}function drawGlyph(n,e,t,r,o,D,N){var k=t.text,B=t.fontProperties;e.translate(r,o),e.scale(D,D);var G=N.strokeThickness/2,U=-(N.strokeThickness/2);if(e.font=N.toFontString(),e.lineWidth=N.strokeThickness,e.textBaseline=N.textBaseline,e.lineJoin=N.lineJoin,e.miterLimit=N.miterLimit,e.fillStyle=generateFillStyle(n,e,N,D,[k],t),e.strokeStyle=N.stroke,N.dropShadow){var H=N.dropShadowColor,$=hex2rgb(typeof H=="number"?H:string2hex(H)),V=N.dropShadowBlur*D,Y=N.dropShadowDistance*D;e.shadowColor="rgba("+$[0]*255+","+$[1]*255+","+$[2]*255+","+N.dropShadowAlpha+")",e.shadowBlur=V,e.shadowOffsetX=Math.cos(N.dropShadowAngle)*Y,e.shadowOffsetY=Math.sin(N.dropShadowAngle)*Y}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;N.stroke&&N.strokeThickness&&e.strokeText(k,G,U+t.lineHeight-B.descent),N.fill&&e.fillText(k,G,U+t.lineHeight-B.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function splitTextToCharacters(n){return Array.from?Array.from(n):n.split("")}function resolveCharacters(n){typeof n=="string"&&(n=[n]);for(var e=[],t=0,r=n.length;t<r;t++){var o=n[t];if(Array.isArray(o)){if(o.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+o.length+".");var D=o[0].charCodeAt(0),N=o[1].charCodeAt(0);if(N<D)throw new Error("[BitmapFont]: Invalid character range.");for(var k=D,B=N;k<=B;k++)e.push(String.fromCharCode(k))}else e.push.apply(e,splitTextToCharacters(o))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}function extractCharCode(n){return n.codePointAt?n.codePointAt(0):n.charCodeAt(0)}var BitmapFont=function(){function n(e,t,r){var o,D,N=e.info[0],k=e.common[0],B=e.page[0],G=e.distanceField[0],U=getResolutionOfUrl(B.file),H={};this._ownsTextures=r,this.font=N.face,this.size=N.size,this.lineHeight=k.lineHeight/U,this.chars={},this.pageTextures=H;for(var $=0;$<e.page.length;$++){var V=e.page[$],Y=V.id,X=V.file;H[Y]=t instanceof Array?t[$]:t[X],G?.fieldType&&G.fieldType!=="none"&&(H[Y].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,H[Y].baseTexture.mipmap=MIPMAP_MODES.OFF)}for(var $=0;$<e.char.length;$++){var z=e.char[$],Y=z.id,W=z.page,q=e.char[$],K=q.x,Q=q.y,Z=q.width,ee=q.height,J=q.xoffset,te=q.yoffset,oe=q.xadvance;K/=U,Q/=U,Z/=U,ee/=U,J/=U,te/=U,oe/=U;var ce=new Rectangle(K+H[W].frame.x/U,Q+H[W].frame.y/U,Z,ee);this.chars[Y]={xOffset:J,yOffset:te,xAdvance:oe,kerning:{},texture:new Texture(H[W].baseTexture,ce),page:W}}for(var $=0;$<e.kerning.length;$++){var fe=e.kerning[$],me=fe.first,we=fe.second,Me=fe.amount;me/=U,we/=U,Me/=U,this.chars[we]&&(this.chars[we].kerning[me]=Me)}this.distanceFieldRange=G?.distanceRange,this.distanceFieldType=(D=(o=G?.fieldType)===null||o===void 0?void 0:o.toLowerCase())!==null&&D!==void 0?D:"none"}return n.prototype.destroy=function(){for(var e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(var e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null},n.install=function(e,t,r){var o;if(e instanceof BitmapFontData)o=e;else{var D=autoDetectFormat(e);if(!D)throw new Error("Unrecognized data format for font.");o=D.parse(e)}t instanceof Texture&&(t=[t]);var N=new n(o,t,r);return n.available[N.font]=N,N},n.uninstall=function(e){var t=n.available[e];if(!t)throw new Error("No font found named '"+e+"'");t.destroy(),delete n.available[e]},n.from=function(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var o=Object.assign({},n.defaultOptions,r),D=o.chars,N=o.padding,k=o.resolution,B=o.textureWidth,G=o.textureHeight,U=resolveCharacters(D),H=t instanceof TextStyle?t:new TextStyle(t),$=B,V=new BitmapFontData;V.info[0]={face:H.fontFamily,size:H.fontSize},V.common[0]={lineHeight:H.fontSize};for(var Y=0,X=0,z,W,q,K=0,Q=[],Z=0;Z<U.length;Z++){z||(z=settings.ADAPTER.createCanvas(),z.width=B,z.height=G,W=z.getContext("2d"),q=new BaseTexture(z,{resolution:k}),Q.push(new Texture(q)),V.page.push({id:Q.length-1,file:""}));var ee=U[Z],J=TextMetrics.measureText(ee,H,!1,z),te=J.width,oe=Math.ceil(J.height),ce=Math.ceil((H.fontStyle==="italic"?2:1)*te);if(X>=G-oe*k){if(X===0)throw new Error("[BitmapFont] textureHeight "+G+"px is too small "+("(fontFamily: '"+H.fontFamily+"', fontSize: "+H.fontSize+"px, char: '"+ee+"')"));--Z,z=null,W=null,q=null,X=0,Y=0,K=0;continue}if(K=Math.max(oe+J.fontProperties.descent,K),ce*k+Y>=$){if(Y===0)throw new Error("[BitmapFont] textureWidth "+B+"px is too small "+("(fontFamily: '"+H.fontFamily+"', fontSize: "+H.fontSize+"px, char: '"+ee+"')"));--Z,X+=K*k,X=Math.ceil(X),Y=0,K=0;continue}drawGlyph(z,W,J,Y,X,k,H);var fe=extractCharCode(J.text);V.char.push({id:fe,page:Q.length-1,x:Y/k,y:X/k,width:ce,height:oe,xoffset:0,yoffset:0,xadvance:Math.ceil(te-(H.dropShadow?H.dropShadowDistance:0)-(H.stroke?H.strokeThickness:0))}),Y+=(ce+2*N)*k,Y=Math.ceil(Y)}if(!r?.skipKerning)for(var Z=0,me=U.length;Z<me;Z++)for(var we=U[Z],Me=0;Me<me;Me++){var Ee=U[Me],ie=W.measureText(we).width,ne=W.measureText(Ee).width,se=W.measureText(we+Ee).width,ue=se-(ie+ne);ue&&V.kerning.push({first:extractCharCode(we),second:extractCharCode(Ee),amount:ue})}var le=new n(V,Q,!0);return n.available[e]!==void 0&&n.uninstall(e),n.available[e]=le,le},n.ALPHA=[["a","z"],["A","Z"]," "],n.NUMERIC=[["0","9"]],n.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],n.ASCII=[[" ","~"]],n.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:n.ALPHANUMERIC},n.available={},n}(),msdfFrag=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,msdfVert=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`,pageMeshDataDefaultPageMeshData=[],pageMeshDataMSDFPageMeshData=[],charRenderDataPool=[];(function(n){__extends$8(e,n);function e(t,r){r===void 0&&(r={});var o=n.call(this)||this;o._tint=16777215;var D=Object.assign({},e.styleDefaults,r),N=D.align,k=D.tint,B=D.maxWidth,G=D.letterSpacing,U=D.fontName,H=D.fontSize;if(!BitmapFont.available[U])throw new Error('Missing BitmapFont "'+U+'"');return o._activePagesMeshData=[],o._textWidth=0,o._textHeight=0,o._align=N,o._tint=k,o._font=void 0,o._fontName=U,o._fontSize=H,o.text=t,o._maxWidth=B,o._maxLineHeight=0,o._letterSpacing=G,o._anchor=new ObservablePoint(function(){o.dirty=!0},o,0,0),o._roundPixels=settings.ROUND_PIXELS,o.dirty=!0,o._resolution=settings.RESOLUTION,o._autoResolution=!0,o._textureCache={},o}return e.prototype.updateText=function(){for(var t,r=BitmapFont.available[this._fontName],o=this.fontSize,D=o/r.size,N=new Point,k=[],B=[],G=[],U=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",H=splitTextToCharacters(U),$=this._maxWidth*r.size/o,V=r.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData,Y=null,X=0,z=0,W=0,q=-1,K=0,Q=0,Z=0,ee=0,J=0;J<H.length;J++){var te=H[J],oe=extractCharCode(te);if(/(?:\s)/.test(te)&&(q=J,K=X,ee++),te==="\r"||te===`
`){B.push(X),G.push(-1),z=Math.max(z,X),++W,++Q,N.x=0,N.y+=r.lineHeight,Y=null,ee=0;continue}var ce=r.chars[oe];if(ce){Y&&ce.kerning[Y]&&(N.x+=ce.kerning[Y]);var fe=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};fe.texture=ce.texture,fe.line=W,fe.charCode=oe,fe.position.x=N.x+ce.xOffset+this._letterSpacing/2,fe.position.y=N.y+ce.yOffset,fe.prevSpaces=ee,k.push(fe),X=fe.position.x+Math.max(ce.xAdvance-ce.xOffset,ce.texture.orig.width),N.x+=ce.xAdvance+this._letterSpacing,Z=Math.max(Z,ce.yOffset+ce.texture.height),Y=oe,q!==-1&&$>0&&N.x>$&&(++Q,removeItems(k,1+q-Q,1+J-q),J=q,q=-1,B.push(K),G.push(k.length>0?k[k.length-1].prevSpaces:0),z=Math.max(z,K),W++,N.x=0,N.y+=r.lineHeight,Y=null,ee=0)}}var me=H[H.length-1];me!=="\r"&&me!==`
`&&(/(?:\s)/.test(me)&&(X=K),B.push(X),z=Math.max(z,X),G.push(-1));for(var we=[],J=0;J<=W;J++){var Me=0;this._align==="right"?Me=z-B[J]:this._align==="center"?Me=(z-B[J])/2:this._align==="justify"&&(Me=G[J]<0?0:(z-B[J])/G[J]),we.push(Me)}var Ee=k.length,ie={},ne=[],se=this._activePagesMeshData;V.push.apply(V,se);for(var J=0;J<Ee;J++){var ue=k[J].texture,le=ue.baseTexture.uid;if(!ie[le]){var he=V.pop();if(!he){var pe=new MeshGeometry,de=void 0,ve=void 0;r.distanceFieldType==="none"?(de=new MeshMaterial(Texture.EMPTY),ve=BLEND_MODES.NORMAL):(de=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}}),ve=BLEND_MODES.NORMAL_NPM);var Se=new Mesh(pe,de);Se.blendMode=ve,he={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Se,vertices:null,uvs:null,indices:null}}he.index=0,he.indexCount=0,he.vertexCount=0,he.uvsCount=0,he.total=0;var ae=this._textureCache;ae[le]=ae[le]||new Texture(ue.baseTexture),he.mesh.texture=ae[le],he.mesh.tint=this._tint,ne.push(he),ie[le]=he}ie[le].total++}for(var J=0;J<se.length;J++)ne.indexOf(se[J])===-1&&this.removeChild(se[J].mesh);for(var J=0;J<ne.length;J++)ne[J].mesh.parent!==this&&this.addChild(ne[J].mesh);this._activePagesMeshData=ne;for(var J in ie){var he=ie[J],Ae=he.total;if(!(((t=he.indices)===null||t===void 0?void 0:t.length)>6*Ae)||he.vertices.length<Mesh.BATCHABLE_SIZE*2)he.vertices=new Float32Array(4*2*Ae),he.uvs=new Float32Array(4*2*Ae),he.indices=new Uint16Array(6*Ae);else for(var xe=he.total,Ce=he.vertices,Oe=xe*4*2;Oe<Ce.length;Oe++)Ce[Oe]=0;he.mesh.size=6*Ae}for(var J=0;J<Ee;J++){var te=k[J],Te=te.position.x+we[te.line]*(this._align==="justify"?te.prevSpaces:1);this._roundPixels&&(Te=Math.round(Te));var De=Te*D,Ie=te.position.y*D,ue=te.texture,_e=ie[ue.baseTexture.uid],Re=ue.frame,Pe=ue._uvs,be=_e.index++;_e.indices[be*6+0]=0+be*4,_e.indices[be*6+1]=1+be*4,_e.indices[be*6+2]=2+be*4,_e.indices[be*6+3]=0+be*4,_e.indices[be*6+4]=2+be*4,_e.indices[be*6+5]=3+be*4,_e.vertices[be*8+0]=De,_e.vertices[be*8+1]=Ie,_e.vertices[be*8+2]=De+Re.width*D,_e.vertices[be*8+3]=Ie,_e.vertices[be*8+4]=De+Re.width*D,_e.vertices[be*8+5]=Ie+Re.height*D,_e.vertices[be*8+6]=De,_e.vertices[be*8+7]=Ie+Re.height*D,_e.uvs[be*8+0]=Pe.x0,_e.uvs[be*8+1]=Pe.y0,_e.uvs[be*8+2]=Pe.x1,_e.uvs[be*8+3]=Pe.y1,_e.uvs[be*8+4]=Pe.x2,_e.uvs[be*8+5]=Pe.y2,_e.uvs[be*8+6]=Pe.x3,_e.uvs[be*8+7]=Pe.y3}this._textWidth=z*D,this._textHeight=(N.y+r.lineHeight)*D;for(var J in ie){var he=ie[J];if(this.anchor.x!==0||this.anchor.y!==0)for(var $e=0,Ye=this._textWidth*this.anchor.x,He=this._textHeight*this.anchor.y,ze=0;ze<he.total;ze++)he.vertices[$e++]-=Ye,he.vertices[$e++]-=He,he.vertices[$e++]-=Ye,he.vertices[$e++]-=He,he.vertices[$e++]-=Ye,he.vertices[$e++]-=He,he.vertices[$e++]-=Ye,he.vertices[$e++]-=He;this._maxLineHeight=Z*D;var qe=he.mesh.geometry.getBuffer("aVertexPosition"),Ze=he.mesh.geometry.getBuffer("aTextureCoord"),Ke=he.mesh.geometry.getIndex();qe.data=he.vertices,Ze.data=he.uvs,Ke.data=he.indices,qe.update(),Ze.update(),Ke.update()}for(var J=0;J<k.length;J++)charRenderDataPool.push(k[J]);this._font=r,this.dirty=!1},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);var r=BitmapFont.available[this._fontName],o=r.distanceFieldRange,D=r.distanceFieldType,N=r.size;if(D!=="none")for(var k=this.worldTransform,B=k.a,G=k.b,U=k.c,H=k.d,$=Math.sqrt(B*B+G*G),V=Math.sqrt(U*U+H*H),Y=(Math.abs($)+Math.abs(V))/2,X=this.fontSize/N,z=0,W=this._activePagesMeshData;z<W.length;z++){var q=W[z];q.mesh.shader.uniforms.uFWidth=Y*o*X*this._resolution}n.prototype._render.call(this,t)},e.prototype.getLocalBounds=function(){return this.validate(),n.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){var t=BitmapFont.available[this._fontName];if(!t)throw new Error('Missing BitmapFont "'+this._fontName+'"');this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!BitmapFont.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){var t;return(t=this._fontSize)!==null&&t!==void 0?t:BitmapFont.available[this._fontName].size},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.prototype.destroy=function(t){var r=this._textureCache,o=BitmapFont.available[this._fontName],D=o.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;D.push.apply(D,this._activePagesMeshData);for(var N=0,k=this._activePagesMeshData;N<k.length;N++){var B=k[N];this.removeChild(B.mesh)}this._activePagesMeshData=[],D.filter(function(H){return r[H.mesh.texture.baseTexture.uid]}).forEach(function(H){H.mesh.texture=Texture.EMPTY});for(var G in r){var U=r[G];U.destroy(),delete r[G]}this._font=null,this._textureCache=null,n.prototype.destroy.call(this,t)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e})(Container);var BitmapFontLoader=function(){function n(){}return n.add=function(){LoaderResource.setExtensionXhrType("fnt",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},n.use=function(e,t){var r=autoDetectFormat(e.data);if(!r){t();return}for(var o=n.getBaseUrl(this,e),D=r.parse(e.data),N={},k=function(X){N[X.metadata.pageFile]=X.texture,Object.keys(N).length===D.page.length&&(e.bitmapFont=BitmapFont.install(D,N,!0),t())},B=0;B<D.page.length;++B){var G=D.page[B].file,U=o+G,H=!1;for(var $ in this.resources){var V=this.resources[$];if(V.url===U){V.metadata.pageFile=G,V.texture?k(V):V.onAfterMiddleware.add(k),H=!0;break}}if(!H){var Y={crossOrigin:e.crossOrigin,loadType:LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:G},e.metadata.imageMetadata),parentResource:e};this.add(U,Y,k)}}},n.getBaseUrl=function(e,t){var r=t.isDataUrl?"":n.dirname(t.url);return t.isDataUrl&&(r==="."&&(r=""),e.baseUrl&&r&&e.baseUrl.charAt(e.baseUrl.length-1)==="/"&&(r+="/")),r=r.replace(e.baseUrl,""),r&&r.charAt(r.length-1)!=="/"&&(r+="/"),r},n.dirname=function(e){var t=e.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return t===e?".":t===""?"/":t},n.extension=ExtensionType.Loader,n}();/*!
 * @pixi/filter-alpha - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/filter-alpha is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$7=function(n,e){return extendStatics$7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$7(n,e)};function __extends$7(n,e){extendStatics$7(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment$4=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;(function(n){__extends$7(e,n);function e(t){t===void 0&&(t=1);var r=n.call(this,defaultVertex$1,fragment$4,{uAlpha:1})||this;return r.alpha=t,r}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e})(Filter);/*!
 * @pixi/filter-blur - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/filter-blur is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$6=function(n,e){return extendStatics$6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$6(n,e)};function __extends$6(n,e){extendStatics$6(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vertTemplate=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function generateBlurVertSource(n,e){var t=Math.ceil(n/2),r=vertTemplate,o="",D;e?D="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":D="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var N=0;N<n;N++){var k=D.replace("%index%",N.toString());k=k.replace("%sampleIndex%",N-(t-1)+".0"),o+=k,o+=`
`}return r=r.replace("%blur%",o),r=r.replace("%size%",n.toString()),r}var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function generateBlurFragSource(n){for(var e=GAUSSIAN_VALUES[n],t=e.length,r=fragTemplate,o="",D="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",N,k=0;k<n;k++){var B=D.replace("%index%",k.toString());N=k,k>=t&&(N=n-k-1),B=B.replace("%value%",e[N].toString()),o+=B,o+=`
`}return r=r.replace("%blur%",o),r=r.replace("%size%",n.toString()),r}var BlurFilterPass=function(n){__extends$6(e,n);function e(t,r,o,D,N){r===void 0&&(r=8),o===void 0&&(o=4),D===void 0&&(D=settings.FILTER_RESOLUTION),N===void 0&&(N=5);var k=this,B=generateBlurVertSource(N,t),G=generateBlurFragSource(N);return k=n.call(this,B,G)||this,k.horizontal=t,k.resolution=D,k._quality=0,k.quality=o,k.blur=r,k}return e.prototype.apply=function(t,r,o,D){if(o?this.horizontal?this.uniforms.strength=1/o.width*(o.width/r.width):this.uniforms.strength=1/o.height*(o.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,o,D);else{var N=t.getFilterTexture(),k=t.renderer,B=r,G=N;this.state.blend=!1,t.applyFilter(this,B,G,CLEAR_MODES.CLEAR);for(var U=1;U<this.passes-1;U++){t.bindAndClear(B,CLEAR_MODES.BLIT),this.uniforms.uSampler=G;var H=G;G=B,B=H,k.shader.bind(this),k.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,G,o,D),t.returnFilterTexture(N)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+Math.abs(t)*2,this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(Filter),BlurFilter$1=function(n){__extends$6(e,n);function e(t,r,o,D){t===void 0&&(t=8),r===void 0&&(r=4),o===void 0&&(o=settings.FILTER_RESOLUTION),D===void 0&&(D=5);var N=n.call(this)||this;return N.blurXFilter=new BlurFilterPass(!0,t,r,o,D),N.blurYFilter=new BlurFilterPass(!1,t,r,o,D),N.resolution=o,N.quality=r,N.blur=t,N.repeatEdgePixels=!1,N}return e.prototype.apply=function(t,r,o,D){var N=Math.abs(this.blurXFilter.strength),k=Math.abs(this.blurYFilter.strength);if(N&&k){var B=t.getFilterTexture();this.blurXFilter.apply(t,r,B,CLEAR_MODES.CLEAR),this.blurYFilter.apply(t,B,o,D),t.returnFilterTexture(B)}else k?this.blurYFilter.apply(t,r,o,D):this.blurXFilter.apply(t,r,o,D)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(Filter);/*!
 * @pixi/filter-color-matrix - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/filter-color-matrix is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$5=function(n,e){return extendStatics$5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$5(n,e)};function __extends$5(n,e){extendStatics$5(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment$3=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,ColorMatrixFilter$1=function(n){__extends$5(e,n);function e(){var t=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return t=n.call(this,defaultFilterVertex,fragment$3,r)||this,t.alpha=1,t}return e.prototype._loadMatrix=function(t,r){r===void 0&&(r=!1);var o=t;r&&(this._multiply(o,this.uniforms.m,t),o=this._colorMatrix(o)),this.uniforms.m=o},e.prototype._multiply=function(t,r,o){return t[0]=r[0]*o[0]+r[1]*o[5]+r[2]*o[10]+r[3]*o[15],t[1]=r[0]*o[1]+r[1]*o[6]+r[2]*o[11]+r[3]*o[16],t[2]=r[0]*o[2]+r[1]*o[7]+r[2]*o[12]+r[3]*o[17],t[3]=r[0]*o[3]+r[1]*o[8]+r[2]*o[13]+r[3]*o[18],t[4]=r[0]*o[4]+r[1]*o[9]+r[2]*o[14]+r[3]*o[19]+r[4],t[5]=r[5]*o[0]+r[6]*o[5]+r[7]*o[10]+r[8]*o[15],t[6]=r[5]*o[1]+r[6]*o[6]+r[7]*o[11]+r[8]*o[16],t[7]=r[5]*o[2]+r[6]*o[7]+r[7]*o[12]+r[8]*o[17],t[8]=r[5]*o[3]+r[6]*o[8]+r[7]*o[13]+r[8]*o[18],t[9]=r[5]*o[4]+r[6]*o[9]+r[7]*o[14]+r[8]*o[19]+r[9],t[10]=r[10]*o[0]+r[11]*o[5]+r[12]*o[10]+r[13]*o[15],t[11]=r[10]*o[1]+r[11]*o[6]+r[12]*o[11]+r[13]*o[16],t[12]=r[10]*o[2]+r[11]*o[7]+r[12]*o[12]+r[13]*o[17],t[13]=r[10]*o[3]+r[11]*o[8]+r[12]*o[13]+r[13]*o[18],t[14]=r[10]*o[4]+r[11]*o[9]+r[12]*o[14]+r[13]*o[19]+r[14],t[15]=r[15]*o[0]+r[16]*o[5]+r[17]*o[10]+r[18]*o[15],t[16]=r[15]*o[1]+r[16]*o[6]+r[17]*o[11]+r[18]*o[16],t[17]=r[15]*o[2]+r[16]*o[7]+r[17]*o[12]+r[18]*o[17],t[18]=r[15]*o[3]+r[16]*o[8]+r[17]*o[13]+r[18]*o[18],t[19]=r[15]*o[4]+r[16]*o[9]+r[17]*o[14]+r[18]*o[19]+r[19],t},e.prototype._colorMatrix=function(t){var r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},e.prototype.brightness=function(t,r){var o=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.tint=function(t,r){var o=t>>16&255,D=t>>8&255,N=t&255,k=[o/255,0,0,0,0,0,D/255,0,0,0,0,0,N/255,0,0,0,0,0,1,0];this._loadMatrix(k,r)},e.prototype.greyscale=function(t,r){var o=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.blackAndWhite=function(t){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.hue=function(t,r){t=(t||0)/180*Math.PI;var o=Math.cos(t),D=Math.sin(t),N=Math.sqrt,k=1/3,B=N(k),G=o+(1-o)*k,U=k*(1-o)-B*D,H=k*(1-o)+B*D,$=k*(1-o)+B*D,V=o+k*(1-o),Y=k*(1-o)-B*D,X=k*(1-o)-B*D,z=k*(1-o)+B*D,W=o+k*(1-o),q=[G,U,H,0,0,$,V,Y,0,0,X,z,W,0,0,0,0,0,1,0];this._loadMatrix(q,r)},e.prototype.contrast=function(t,r){var o=(t||0)+1,D=-.5*(o-1),N=[o,0,0,0,D,0,o,0,0,D,0,0,o,0,D,0,0,0,1,0];this._loadMatrix(N,r)},e.prototype.saturate=function(t,r){t===void 0&&(t=0);var o=t*2/3+1,D=(o-1)*-.5,N=[o,D,D,0,0,D,o,D,0,0,D,D,o,0,0,0,0,0,1,0];this._loadMatrix(N,r)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.sepia=function(t){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.technicolor=function(t){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.polaroid=function(t){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.toBGR=function(t){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.kodachrome=function(t){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.browni=function(t){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.vintage=function(t){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.colorTone=function(t,r,o,D,N){t=t||.2,r=r||.15,o=o||16770432,D=D||3375104;var k=(o>>16&255)/255,B=(o>>8&255)/255,G=(o&255)/255,U=(D>>16&255)/255,H=(D>>8&255)/255,$=(D&255)/255,V=[.3,.59,.11,0,0,k,B,G,t,0,U,H,$,r,0,k-U,B-H,G-$,0,0];this._loadMatrix(V,N)},e.prototype.night=function(t,r){t=t||.1;var o=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.predator=function(t,r){var o=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.lsd=function(t){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.reset=function(){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Filter);ColorMatrixFilter$1.prototype.grayscale=ColorMatrixFilter$1.prototype.greyscale;/*!
 * @pixi/filter-displacement - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/filter-displacement is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$4=function(n,e){return extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$4(n,e)};function __extends$4(n,e){extendStatics$4(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment$2=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,vertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;(function(n){__extends$4(e,n);function e(t,r){var o=this,D=new Matrix;return t.renderable=!1,o=n.call(this,vertex$1,fragment$2,{mapSampler:t._texture,filterMatrix:D,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,o.maskSprite=t,o.maskMatrix=D,r==null&&(r=20),o.scale=new Point(r,r),o}return e.prototype.apply=function(t,r,o,D){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var N=this.maskSprite.worldTransform,k=Math.sqrt(N.a*N.a+N.b*N.b),B=Math.sqrt(N.c*N.c+N.d*N.d);k!==0&&B!==0&&(this.uniforms.rotation[0]=N.a/k,this.uniforms.rotation[1]=N.b/k,this.uniforms.rotation[2]=N.c/B,this.uniforms.rotation[3]=N.d/B),t.applyFilter(this,r,o,D)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e})(Filter);/*!
 * @pixi/filter-fxaa - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/filter-fxaa is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$3=function(n,e){return extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$3(n,e)};function __extends$3(n,e){extendStatics$3(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vertex=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,fragment$1=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;(function(n){__extends$3(e,n);function e(){return n.call(this,vertex,fragment$1)||this}return e})(Filter);/*!
 * @pixi/filter-noise - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/filter-noise is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$2=function(n,e){return extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$2(n,e)};function __extends$2(n,e){extendStatics$2(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,NoiseFilter$1=function(n){__extends$2(e,n);function e(t,r){t===void 0&&(t=.5),r===void 0&&(r=Math.random());var o=n.call(this,defaultFilterVertex,fragment,{uNoise:0,uSeed:0})||this;return o.noise=t,o.seed=r,o}return Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(Filter);/*!
 * @pixi/mixin-cache-as-bitmap - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;DisplayObject.prototype._cacheAsBitmapMultisample=MSAA_QUALITY.NONE;var CacheData=function(){function n(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return n}();Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(n){n!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(n){n!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(n){if(this._cacheAsBitmap!==n){this._cacheAsBitmap=n;var e;n?(this._cacheData||(this._cacheData=new CacheData),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}});DisplayObject.prototype._renderCached=function(n){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(n),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(n))};DisplayObject.prototype._initCachedDisplayObject=function(n){var e;if(!(this._cacheData&&this._cacheData.sprite)){var t=this.alpha;this.alpha=1,n.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters&&this.filters.length){var o=this.filters[0].padding;r.pad(o)}r.ceil(settings.RESOLUTION);var D=n.renderTexture.current,N=n.renderTexture.sourceFrame.clone(),k=n.renderTexture.destinationFrame.clone(),B=n.projection.transform,G=RenderTexture.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||n.resolution,multisample:(e=this.cacheAsBitmapMultisample)!==null&&e!==void 0?e:n.multisample}),U="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=U,BaseTexture.addToCache(G.baseTexture,U),Texture.addToCache(G,U);var H=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,n.render(this,{renderTexture:G,clear:!0,transform:H,skipUpdateTransform:!1}),n.framebuffer.blit(),n.projection.transform=B,n.renderTexture.bind(D,N,k),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;var $=new Sprite(G);$.transform.worldTransform=this.transform.worldTransform,$.anchor.x=-(r.x/r.width),$.anchor.y=-(r.y/r.height),$.alpha=t,$._bounds=this._bounds,this._cacheData.sprite=$,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=$.containsPoint.bind($)}};DisplayObject.prototype._renderCachedCanvas=function(n){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(n),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(n))};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(n){if(!(this._cacheData&&this._cacheData.sprite)){var e=this.getLocalBounds(null,!0),t=this.alpha;this.alpha=1;var r=n.context,o=n._projTransform;e.ceil(settings.RESOLUTION);var D=RenderTexture.create({width:e.width,height:e.height}),N="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=N,BaseTexture.addToCache(D.baseTexture,N),Texture.addToCache(D,N);var k=_tempMatrix;this.transform.localTransform.copyTo(k),k.invert(),k.tx-=e.x,k.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,n.render(this,{renderTexture:D,clear:!0,transform:k,skipUpdateTransform:!1}),n.context=r,n._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;var B=new Sprite(D);B.transform.worldTransform=this.transform.worldTransform,B.anchor.x=-(e.x/e.width),B.anchor.y=-(e.y/e.height),B.alpha=t,B._bounds=this._bounds,this._cacheData.sprite=B,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=n._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=B.containsPoint.bind(B)}};DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(n){this.cacheAsBitmap=!1,this.destroy(n)};/*!
 * @pixi/mixin-get-child-by-name - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/mixin-get-child-by-name is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */DisplayObject.prototype.name=null;Container.prototype.getChildByName=function(n,e){for(var t=0,r=this.children.length;t<r;t++)if(this.children[t].name===n)return this.children[t];if(e)for(var t=0,r=this.children.length;t<r;t++){var o=this.children[t];if(o.getChildByName){var D=o.getChildByName(n,!0);if(D)return D}}return null};/*!
 * @pixi/mixin-get-global-position - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/mixin-get-global-position is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */DisplayObject.prototype.getGlobalPosition=function(n,e){return n===void 0&&(n=new Point),e===void 0&&(e=!1),this.parent?this.parent.toGlobal(this.position,n,e):(n.x=this.position.x,n.y=this.position.y),n};/*!
 * @pixi/app - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ResizePlugin=function(){function n(){}return n.init=function(e){var t=this;Object.defineProperty(this,"resizeTo",{set:function(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){t._resizeTo&&(t.cancelResize(),t._resizeId=requestAnimationFrame(function(){return t.resize()}))},this.cancelResize=function(){t._resizeId&&(cancelAnimationFrame(t._resizeId),t._resizeId=null)},this.resize=function(){if(t._resizeTo){t.cancelResize();var r,o;if(t._resizeTo===globalThis.window)r=globalThis.innerWidth,o=globalThis.innerHeight;else{var D=t._resizeTo,N=D.clientWidth,k=D.clientHeight;r=N,o=k}t.renderer.resize(r,o)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},n.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},n.extension=ExtensionType.Application,n}(),Application=function(){function n(e){var t=this;this.stage=new Container,e=Object.assign({forceCanvas:!1},e),this.renderer=autoDetectRenderer(e),n._plugins.forEach(function(r){r.init.call(t,e)})}return n.registerPlugin=function(e){deprecation("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),extensions.add({type:ExtensionType.Application,ref:e})},n.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(n.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),n.prototype.destroy=function(e,t){var r=this,o=n._plugins.slice(0);o.reverse(),o.forEach(function(D){D.destroy.call(r)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null},n._plugins=[],n}();extensions.handleByList(ExtensionType.Application,Application._plugins);extensions.add(ResizePlugin);/*!
 * @pixi/mesh-extras - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/mesh-extras is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$1=function(n,e){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$1(n,e)};function __extends$1(n,e){extendStatics$1(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var PlaneGeometry=function(n){__extends$1(e,n);function e(t,r,o,D){t===void 0&&(t=100),r===void 0&&(r=100),o===void 0&&(o=10),D===void 0&&(D=10);var N=n.call(this)||this;return N.segWidth=o,N.segHeight=D,N.width=t,N.height=r,N.build(),N}return e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,r=[],o=[],D=[],N=this.segWidth-1,k=this.segHeight-1,B=this.width/N,G=this.height/k,U=0;U<t;U++){var H=U%this.segWidth,$=U/this.segWidth|0;r.push(H*B,$*G),o.push(H/N,$/k)}for(var V=N*k,U=0;U<V;U++){var Y=U%N,X=U/N|0,z=X*this.segWidth+Y,W=X*this.segWidth+Y+1,q=(X+1)*this.segWidth+Y,K=(X+1)*this.segWidth+Y+1;D.push(z,W,q,W,K,q)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(o),this.indexBuffer.data=new Uint16Array(D),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(MeshGeometry),RopeGeometry=function(n){__extends$1(e,n);function e(t,r,o){t===void 0&&(t=200),o===void 0&&(o=0);var D=n.call(this,new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6))||this;return D.points=r,D._width=t,D.textureScale=o,D.build(),D}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var r=this.getBuffer("aVertexPosition"),o=this.getBuffer("aTextureCoord"),D=this.getIndex();if(!(t.length<1)){r.data.length/4!==t.length&&(r.data=new Float32Array(t.length*4),o.data=new Float32Array(t.length*4),D.data=new Uint16Array((t.length-1)*6));var N=o.data,k=D.data;N[0]=0,N[1]=0,N[2]=0,N[3]=1;for(var B=0,G=t[0],U=this._width*this.textureScale,H=t.length,$=0;$<H;$++){var V=$*4;if(this.textureScale>0){var Y=G.x-t[$].x,X=G.y-t[$].y,z=Math.sqrt(Y*Y+X*X);G=t[$],B+=z/U}else B=$/(H-1);N[V]=B,N[V+1]=0,N[V+2]=B,N[V+3]=1}for(var W=0,$=0;$<H-1;$++){var V=$*2;k[W++]=V,k[W++]=V+1,k[W++]=V+2,k[W++]=V+2,k[W++]=V+1,k[W++]=V+3}o.update(),D.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var r=t[0],o,D=0,N=0,k=this.buffers[0].data,B=t.length,G=0;G<B;G++){var U=t[G],H=G*4;G<t.length-1?o=t[G+1]:o=U,N=-(o.x-r.x),D=o.y-r.y;var $=Math.sqrt(D*D+N*N),V=this.textureScale>0?this.textureScale*this._width/2:this._width/2;D/=$,N/=$,D*=V,N*=V,k[H]=U.x+D,k[H+1]=U.y+N,k[H+2]=U.x-D,k[H+3]=U.y-N,r=U}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(MeshGeometry);(function(n){__extends$1(e,n);function e(t,r,o){o===void 0&&(o=0);var D=this,N=new RopeGeometry(t.height,r,o),k=new MeshMaterial(t);return o>0&&(t.baseTexture.wrapMode=WRAP_MODES.REPEAT),D=n.call(this,N,k)||this,D.autoUpdate=!0,D}return e.prototype._render=function(t){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),n.prototype._render.call(this,t)},e})(Mesh);var SimplePlane=function(n){__extends$1(e,n);function e(t,r,o){var D=this,N=new PlaneGeometry(t.width,t.height,r,o),k=new MeshMaterial(Texture.WHITE);return D=n.call(this,N,k)||this,D.texture=t,D.autoResize=!0,D}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry,r=this.shader.texture,o=r.width,D=r.height;this.autoResize&&(t.width!==o||t.height!==D)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),n.prototype._render.call(this,t)},e.prototype.destroy=function(t){this.shader.texture.off("update",this.textureUpdated,this),n.prototype.destroy.call(this,t)},e}(Mesh);(function(n){__extends$1(e,n);function e(t,r,o,D,N){t===void 0&&(t=Texture.EMPTY);var k=this,B=new MeshGeometry(r,o,D);B.getBuffer("aVertexPosition").static=!1;var G=new MeshMaterial(t);return k=n.call(this,B,G,null,N)||this,k.autoUpdate=!0,k}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),n.prototype._render.call(this,t)},e})(Mesh);var DEFAULT_BORDER_SIZE=10;(function(n){__extends$1(e,n);function e(t,r,o,D,N){r===void 0&&(r=DEFAULT_BORDER_SIZE),o===void 0&&(o=DEFAULT_BORDER_SIZE),D===void 0&&(D=DEFAULT_BORDER_SIZE),N===void 0&&(N=DEFAULT_BORDER_SIZE);var k=n.call(this,Texture.WHITE,4,4)||this;return k._origWidth=t.orig.width,k._origHeight=t.orig.height,k._width=k._origWidth,k._height=k._origHeight,k._leftWidth=r,k._rightWidth=D,k._topHeight=o,k._bottomHeight=N,k.texture=t,k}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,r=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*r,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*r,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,r=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*r,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*r,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,r=this._width>t?1:this._width/t,o=this._topHeight+this._bottomHeight,D=this._height>o?1:this._height/o,N=Math.min(r,D);return N},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,r=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var o=1/this._origWidth,D=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=o*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-o*this._rightWidth,r[9]=r[11]=r[13]=r[15]=D*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-D*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e})(SimplePlane);/*!
 * @pixi/sprite-animated - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/sprite-animated is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics=function(n,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics(n,e)};function __extends(n,e){extendStatics(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var AnimatedSprite=function(n){__extends(e,n);function e(t,r){r===void 0&&(r=!0);var o=n.call(this,t[0]instanceof Texture?t[0]:t[0].texture)||this;return o._textures=null,o._durations=null,o._autoUpdate=r,o._isConnectedToTicker=!1,o.animationSpeed=1,o.loop=!0,o.updateAnchor=!1,o.onComplete=null,o.onFrameChange=null,o.onLoop=null,o._currentTime=0,o._playing=!1,o._previousFrame=null,o.textures=t,o}return e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var r=this.animationSpeed*t,o=this.currentFrame;if(this._durations!==null){var D=this._currentTime%1*this._durations[this.currentFrame];for(D+=r/60*1e3;D<0;)this._currentTime--,D+=this._durations[this.currentFrame];var N=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);D>=this._durations[this.currentFrame];)D-=this._durations[this.currentFrame]*N,this._currentTime+=N;this._currentTime+=D/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o?this.onLoop():this.animationSpeed<0&&this.currentFrame>o&&this.onLoop()),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(t){this.stop(),n.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var r=[],o=0;o<t.length;++o)r.push(Texture.from(t[o]));return new e(r)},e.fromImages=function(t){for(var r=[],o=0;o<t.length;++o)r.push(Texture.from(t[o]));return new e(r)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<t.length;r++)this._textures.push(t[r].texture),this._durations.push(t[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e}(Sprite);/*!
 * pixi.js - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */extensions.add(AccessibilityManager,Extract,InteractionManager,ParticleRenderer,Prepare,BatchRenderer,TilingSpriteRenderer,BitmapFontLoader,CompressedTextureLoader,DDSLoader,KTXLoader,SpritesheetLoader,TickerPlugin,AppLoaderPlugin);var filters={BlurFilter:BlurFilter$1,ColorMatrixFilter:ColorMatrixFilter$1,NoiseFilter:NoiseFilter$1};class EventListenerCtn{#t=[];addC(e,t,r,o={}){e.on(t,r,o),this.#t.push(()=>e.off(t,r,o))}add(e,t,r,o={}){if(e instanceof i){e.on(t,r,o),this.#t.push(()=>e.off(t,r,o));return}e.addEventListener(t,r,o),this.#t.push(()=>e.removeEventListener(t,r,{capture:o.capture??!1}))}clear(){for(const e of this.#t)e();this.#t=[]}get isEmpty(){return this.#t.length===0}}var SEARCH_PATH_ARG_EXT=(n=>(n.DEFAULT="",n.SP_GSM="png|jpg|jpeg|json|svg|webp|mp4|webm",n.SCRIPT="sn|ssn",n.FONT="woff2|woff|otf|ttf",n.SOUND="mp3|m4a|ogg|aac|flac|wav",n.HTML="htm|html",n.CSS="css",n.SN="sn",n.TST_PNGPNG_="png|png_",n.TST_HH="hh",n.TST_EEE="eee",n.TST_GGG="ggg",n.TST_PNGXML="png|xml",n))(SEARCH_PATH_ARG_EXT||{});const DEF_CFG={save_ns:"",window:{width:300,height:300},book:{title:"",creator:"",cre_url:"",publisher:"",pub_url:"",detail:"",version:"1.0"},log:{max_len:64},init:{bg_color:"#000000",tagch_msecwait:10,auto_msecpagewait:3500,escape:""},debug:{devtool:!1,token:!1,tag:!1,putCh:!1,debugLog:!1,baseTx:!1,masume:!1,variable:!1,dumpHtm:!1},code:{},debuger_token:""};class ConfigBase{constructor(e){this.sys=e}oCfg=DEF_CFG;userFnTail="";hPathFn2Exts={};async load(e){if(this.oCfg.save_ns=e?.save_ns??this.oCfg.save_ns,this.oCfg.window.width=Number(e?.window?.width??this.oCfg.window.width),this.oCfg.window.height=Number(e?.window?.height??this.oCfg.window.height),this.oCfg.book={...this.oCfg.book,...e.book},this.oCfg.log.max_len=e.log?.max_len??this.oCfg.log.max_len,this.oCfg.init={...this.oCfg.init,...e.init},this.oCfg.debug={...this.oCfg.debug,...e.debug},this.oCfg.debuger_token=e.debuger_token,await this.sys.loadPath(this.hPathFn2Exts,this),this.#t=this.matchPath("^breakline$","png|jpg|jpeg|json|svg|webp|mp4|webm").length>0,this.#e=this.matchPath("^breakpage$","png|jpg|jpeg|json|svg|webp|mp4|webm").length>0,this.sys.arg.crypto)for(const[t,r]of Object.entries(this.hPathFn2Exts))for(const[o,D]of Object.entries(r)){if(!o.startsWith(":")||!o.endsWith(":id"))continue;const N=D.slice(D.lastIndexOf("/")+1),k=r[o.slice(0,-10)]??"",B=await(await this.sys.fetch(k)).text(),G=this.sys.hash(B);if(N!==G)throw`ファイル改竄エラーです fn:${k}`}else for(const[t,r]of Object.entries(this.hPathFn2Exts))for(const o of Object.keys(r))o.startsWith(":")}#t=!1;get existsBreakline(){return this.#t}#e=!1;get existsBreakpage(){return this.#e}getNs(){return`skynovel.${this.oCfg.save_ns} - `}#r=/([^\/\s]+)\.([^\d]\w+)/;searchPath(e,t=""){if(!e)throw"[searchPath] fnが空です";if(e.startsWith("http://"))return e;const r=e.match(this.#r);let o=r?r[1]:e;const D=r?r[2]:"";if(this.userFnTail){const B=o+"@@"+this.userFnTail;if(B in this.hPathFn2Exts){if(t==="")o=B;else for(const G of Object.keys(this.hPathFn2Exts[B]??{}))if(`|${t}|`.includes(`|${G}|`)){o=B;break}}}const N=this.hPathFn2Exts[o];if(!N)throw`サーチパスに存在しないファイル【${e}】です`;if(!D){const B=int(N[":cnt"]);if(t===""){if(B>1)throw`指定ファイル【${e}】が複数マッチします。サーチ対象拡張子群【${t}】で絞り込むか、ファイル名を個別にして下さい。`;return e}const G=`|${t}|`;if(B>1){let U=0;for(const H of Object.keys(N))if(G.includes(`|${H}|`)&&++U>1)throw`指定ファイル【${e}】が複数マッチします。サーチ対象拡張子群【${t}】で絞り込むか、ファイル名を個別にして下さい。`}for(const U of Object.keys(N))if(G.includes(`|${U}|`))return N[U];throw`サーチ対象拡張子群【${t}】にマッチするファイルがサーチパスに存在しません。探索ファイル名=【${e}】`}if(t!==""&&!`|${t}|`.includes(`|${D}|`))throw`指定ファイルの拡張子【${D}】は、サーチ対象拡張子群【${t}】にマッチしません。探索ファイル名=【${e}】`;const k=N[D];if(!k)throw`サーチパスに存在しない拡張子【${D}】です。探索ファイル名=【${e}】、サーチ対象拡張子群【${t}】`;return k}matchPath(e,t=""){const r=[],o=new RegExp(e),D=new RegExp(t);for(const[N,k]of Object.entries(this.hPathFn2Exts)){if(N.search(o)===-1)continue;if(t===""){r.push(k);continue}const B={};let G=!1;for(const U of Object.keys(k))U.search(D)!==-1&&(B[U]=N,G=!0);G&&r.push(B)}return r}addPath(e,t){const r={};for(const[o,D]of Object.entries(t))r[o]=(o.startsWith(":")?"":this.sys.arg.cur)+D;this.hPathFn2Exts[e]=r}}const{BlurFilter,ColorMatrixFilter,NoiseFilter}=filters;class Layer{layname="";name_="";set name(e){this.name_=e}get name(){return this.name_}ctn=new Sprite(Texture.EMPTY);get alpha(){return this.ctn.alpha}set alpha(e){this.ctn.alpha=e}get height(){return this.ctn.height}get rotation(){return this.ctn.angle}set rotation(e){this.ctn.angle=e}get scale_x(){return this.ctn.scale.x}set scale_x(e){this.ctn.scale.x=e}get scale_y(){return this.ctn.scale.y}set scale_y(e){this.ctn.scale.y=e}get width(){return this.ctn.width}get x(){return this.ctn.x}set x(e){this.procSetX(e),this.ctn.x=e}procSetX(e){}get y(){return this.ctn.y}set y(e){this.procSetY(e),this.ctn.y=e}procSetY(e){}destroy(){}lay(e){const t=this.ctn;return"alpha"in e&&(t.alpha=argChk_Num(e,"alpha",1)),Layer.setBlendmode(t,e),("pivot_x"in e||"pivot_y"in e)&&t.pivot.set(argChk_Num(e,"pivot_x",t.pivot.x),argChk_Num(e,"pivot_y",t.pivot.y)),"rotation"in e&&(t.angle=argChk_Num(e,"rotation",0)),("scale_x"in e||"scale_y"in e)&&t.scale.set(argChk_Num(e,"scale_x",t.scale.x),argChk_Num(e,"scale_y",t.scale.y)),"visible"in e&&(t.visible=argChk_Boolean(e,"visible",!0)),"filter"in e&&(t.filters=[Layer.bldFilters(e)],this.aFltHArg=[e]),!1}aFltHArg=[];static bldFilters(e){const{filter:t=""}=e,r=Layer.hBldFilter[t];if(!r)throw"filter が異常です";const o=r(e);o.enabled=argChk_Boolean(e,"enable_filter",!0);const{blendmode:D}=e;return D&&(o.blendMode=Layer.getBlendmodeNum(D)),o}static hBldFilter={blur:e=>{const t=new BlurFilter(argChk_Num(e,"strength",8),argChk_Num(e,"quality",4),"resolution"in e?argChk_Num(e,"resolution",0):void 0,argChk_Num(e,"kernel_size",5));return t.blurX=uint(argChk_Num(e,"blur_x",2)),t.blurY=uint(argChk_Num(e,"blur_y",2)),t.repeatEdgePixels=argChk_Boolean(e,"repeat_edge_pixels",!1),t},noise:e=>new NoiseFilter(argChk_Num(e,"noise",.5),"seed"in e?argChk_Num(e,"seed",0):void 0),color_matrix:e=>{const t=new ColorMatrixFilter;t.alpha=uint(argChk_Num(e,"alpha",1));const{matrix:r=""}=e;if(r){const o=r.split(","),D=o.length;if(D!==20)throw`matrix の個数（${D}）が 20 ではありません`;for(let N=0;N<D;++N)t.matrix[N]=uint(o[N])}else t.matrix[0]=uint(argChk_Num(e,"rtor",1)),t.matrix[1]=uint(argChk_Num(e,"gtor",0)),t.matrix[2]=uint(argChk_Num(e,"btor",0)),t.matrix[3]=uint(argChk_Num(e,"ator",0)),t.matrix[4]=uint(argChk_Num(e,"pr",0)),t.matrix[5]=uint(argChk_Num(e,"rtog",0)),t.matrix[6]=uint(argChk_Num(e,"gtog",1)),t.matrix[7]=uint(argChk_Num(e,"btog",0)),t.matrix[8]=uint(argChk_Num(e,"atog",0)),t.matrix[9]=uint(argChk_Num(e,"pg",0)),t.matrix[10]=uint(argChk_Num(e,"rtob",0)),t.matrix[11]=uint(argChk_Num(e,"gtob",0)),t.matrix[12]=uint(argChk_Num(e,"btob",1)),t.matrix[13]=uint(argChk_Num(e,"atob",0)),t.matrix[14]=uint(argChk_Num(e,"pb",0)),t.matrix[15]=uint(argChk_Num(e,"rtoa",0)),t.matrix[16]=uint(argChk_Num(e,"gtoa",0)),t.matrix[17]=uint(argChk_Num(e,"btoa",0)),t.matrix[18]=uint(argChk_Num(e,"atoa",1)),t.matrix[19]=uint(argChk_Num(e,"pa",0));return t},black_and_white:e=>{const t=new ColorMatrixFilter;return t.blackAndWhite(argChk_Boolean(e,"multiply",!1)),t},brightness:e=>{const t=new ColorMatrixFilter;return t.brightness(argChk_Num(e,"b",.5),argChk_Boolean(e,"multiply",!1)),t},browni:e=>{const t=new ColorMatrixFilter;return t.browni(argChk_Boolean(e,"multiply",!0)),t},color_tone:e=>{const t=new ColorMatrixFilter;return t.colorTone(argChk_Num(e,"desaturation",.5),argChk_Num(e,"toned",.5),argChk_Num(e,"light_color",16770432),argChk_Num(e,"dark_color",16770432),argChk_Boolean(e,"multiply",!1)),t},contrast:e=>{const t=new ColorMatrixFilter;return t.contrast(argChk_Num(e,"amount",.5),argChk_Boolean(e,"multiply",!1)),t},grayscale:e=>{const t=new ColorMatrixFilter;return t.grayscale(argChk_Num(e,"scale",.5),argChk_Boolean(e,"multiply",!1)),t},hue:e=>{const t=new ColorMatrixFilter;return t.hue(argChk_Num(e,"f_rotation",90),argChk_Boolean(e,"multiply",!1)),t},kodachrome:e=>{const t=new ColorMatrixFilter;return t.kodachrome(argChk_Boolean(e,"multiply",!0)),t},lsd:e=>{const t=new ColorMatrixFilter;return t.lsd(argChk_Boolean(e,"multiply",!1)),t},negative:e=>{const t=new ColorMatrixFilter;return t.negative(argChk_Boolean(e,"multiply",!1)),t},night:e=>{const t=new ColorMatrixFilter;return t.night(argChk_Num(e,"intensity",.5),argChk_Boolean(e,"multiply",!1)),t},polaroid:e=>{const t=new ColorMatrixFilter;return t.polaroid(argChk_Boolean(e,"multiply",!1)),t},predator:e=>{const t=new ColorMatrixFilter;return t.predator(argChk_Num(e,"amount",.5),argChk_Boolean(e,"multiply",!1)),t},saturate:e=>{const t=new ColorMatrixFilter;return t.saturate(argChk_Num(e,"amount",.5),argChk_Boolean(e,"multiply",!1)),t},sepia:e=>{const t=new ColorMatrixFilter;return t.sepia(argChk_Boolean(e,"multiply",!1)),t},technicolor:e=>{const t=new ColorMatrixFilter;return t.technicolor(argChk_Boolean(e,"multiply",!0)),t},tint:e=>{const t=new ColorMatrixFilter;return t.tint(argChk_Num(e,"f_color",8947848),argChk_Boolean(e,"multiply",!1)),t},to_bgr:e=>{const t=new ColorMatrixFilter;return t.toBGR(argChk_Boolean(e,"multiply",!1)),t},vintage:e=>{const t=new ColorMatrixFilter;return t.vintage(argChk_Boolean(e,"multiply",!0)),t}};static setBlendmode(e,t){const{blendmode:r}=t;if(!r)return;const o=Layer.getBlendmodeNum(r);e instanceof Sprite&&(e.blendMode=o);for(const D of e.children)D instanceof Sprite&&(D.blendMode=o)}static getBlendmodeNum(e){if(!e)return BLEND_MODES.NORMAL;const t=Layer.#t[e];if(t!==void 0)return t;throw`${e} はサポートされない blendmode です`}static#t={normal:BLEND_MODES.NORMAL,add:BLEND_MODES.ADD,multiply:BLEND_MODES.MULTIPLY,screen:BLEND_MODES.SCREEN};static getNum2Blendmode(e){return Layer.#e[e]??"normal"}static#e={0:"normal",1:"add",2:"multiply",3:"screen"};get containMovement(){return!1}renderStart(){}renderEnd(){}clearLay(e){this.ctn.alpha=1,this.ctn.blendMode=BLEND_MODES.NORMAL,this.ctn.pivot.set(0,0),this.ctn.angle=0,this.ctn.scale.set(1,1),argChk_Boolean(e,"clear_filter",!1)&&(this.ctn.filters=null,this.aFltHArg=[])}copy(e,t){const r=this.name_;this.playback(e.record(),t),this.name=r}record(){return{name:this.name_,idx:this.ctn.parent.getChildIndex(this.ctn),alpha:this.ctn.alpha,blendMode:this.ctn.blendMode,rotation:this.ctn.angle,scale_x:this.ctn.scale.x,scale_y:this.ctn.scale.y,pivot_x:this.ctn.pivot.x,pivot_y:this.ctn.pivot.y,x:this.ctn.x,y:this.ctn.y,visible:this.ctn.visible,aFltHArg:this.aFltHArg}}playback(e,t){this.name=e.name,this.clearLay({clear_filter:!0}),this.ctn.alpha=e.alpha,this.ctn.blendMode=e.blendMode,this.ctn.angle=e.rotation,this.ctn.scale.set(e.scale_x,e.scale_y),this.ctn.pivot.set(e.pivot_x,e.pivot_y),this.ctn.position.set(e.x,e.y),this.ctn.visible=e.visible,this.aFltHArg=e.aFltHArg??[],this.ctn.filters=this.aFltHArg.length===0?null:this.aFltHArg.map(r=>Layer.bldFilters(r))}snapshot(e,t){e.render(this.ctn,{clear:!1}),t()}snapshot_end(){}makeDesignCast(e){}makeDesignCastChildren(e){}showDesignCast(){}showDesignCastChildren(){}cvsResize(){}cvsResizeChildren(){}dump(){return` "idx":${this.ctn.parent.getChildIndex(this.ctn)}, "visible":"${this.ctn.visible}", "left":${this.ctn.x}, "top":${this.ctn.y}, "alpha":${this.ctn.alpha}, "rotation":${this.ctn.angle}, "name":"${this.name_}", "scale_x":${this.ctn.scale.x}, "scale_y":${this.ctn.scale.y}, "filters": [${this.aFltHArg.map(e=>`"${e.filter}"`).join(",")}]`}static setXY(e,t,r,o=!1,D=!1){if(t.pos){Layer.setXYByPos(e,t.pos,r);return}const N=e.getBounds(),k=r.scale.x<0?-r.scale.x:r.scale.x,B=k===1?N.width:N.width*k,G=r.scale.y<0?-r.scale.y:r.scale.y,U=G===1?N.height:N.height*G;let H=r.x;"left"in t?(H=argChk_Num(t,"left",0),H>-1&&H<1&&(H*=CmnLib.stageW)):"center"in t?(H=argChk_Num(t,"center",0),H>-1&&H<1&&(H*=CmnLib.stageW),H=H-(D?B/3:B)/2):"right"in t?(H=argChk_Num(t,"right",0),H>-1&&H<1&&(H*=CmnLib.stageW),H=H-(D?B/3:B)):"s_right"in t&&(H=argChk_Num(t,"s_right",0),H>-1&&H<1&&(H*=CmnLib.stageW),H=CmnLib.stageW-H-(D?B/3:B)),r.x=int(r.scale.x<0?H+(D?B/3:B):H);let $=r.y;"top"in t?($=argChk_Num(t,"top",0),$>-1&&$<1&&($*=CmnLib.stageH)):"middle"in t?($=argChk_Num(t,"middle",0),$>-1&&$<1&&($*=CmnLib.stageH),$=$-U/2):"bottom"in t?($=argChk_Num(t,"bottom",0),$>-1&&$<1&&($*=CmnLib.stageH),$=$-U):"s_bottom"in t&&($=argChk_Num(t,"s_bottom",0),$>-1&&$<1&&($*=CmnLib.stageH),$=CmnLib.stageH-$-U),r.y=int(r.scale.y<0?$+U:$),o&&!("left"in t)&&!("center"in t)&&!("right"in t)&&!("s_right"in t)&&!("top"in t)&&!("middle"in t)&&!("bottom"in t)&&!("s_bottom"in t)&&Layer.setXYByPos(e,"c",r)}static setXYByPos(e,t,r){if(t==="stay")return;if(e===void 0)throw"setXYByPos base === undefined";if(r===void 0)throw"setXYByPos result === undefined";const o=e.getBounds(),D=r.scale.x<0?-r.scale.x:r.scale.x,N=D===1?o.width:o.width*D,k=r.scale.y<0?-r.scale.y:r.scale.y,B=k===1?o.height:o.height*k;let G=0;!t||t==="c"?G=CmnLib.stageW*.5:t==="r"?G=CmnLib.stageW-N*.5:t==="l"?G=N*.5:G=int(t),r.x=int(G-N*.5),r.y=CmnLib.stageH-B,r.scale.x<0&&(r.x+=N),r.scale.y<0&&(r.y+=B)}static setXYCenter(e){const t=e.getBounds();e.x=(CmnLib.stageW-t.width)*.5,e.y=(CmnLib.stageH-t.height)*.5}}var Easing=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-Easing.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?Easing.Bounce.In(n*2)*.5:Easing.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),now=function(){return performance.now()},Group=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=now()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<r.length;o++){var D=this._tweens[r[o]],N=!t;D&&D.update(e,N)===!1&&!t&&delete this._tweens[r[o]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),Interpolation={Linear:function(n,e){var t=n.length-1,r=t*e,o=Math.floor(r),D=Interpolation.Utils.Linear;return e<0?D(n[0],n[1],r):e>1?D(n[t],n[t-1],t-r):D(n[o],n[o+1>t?t:o+1],r-o)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},Sequence=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),mainGroup=new Group,Tween=function(){function n(e,t){t===void 0&&(t=mainGroup),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Easing.Linear.None,this._interpolationFunction=Interpolation.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Sequence.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=now()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var o={};for(var D in this._valuesEnd)o[D]=this._valuesEnd[D];this._valuesEnd=o}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,o,D){for(var N in r){var k=e[N],B=Array.isArray(k),G=B?"array":typeof k,U=!B&&Array.isArray(r[N]);if(!(G==="undefined"||G==="function")){if(U){var H=r[N];if(H.length===0)continue;for(var $=[k],V=0,Y=H.length;V<Y;V+=1){var X=this._handleRelativeValue(k,H[V]);if(isNaN(X)){U=!1,console.warn("Found invalid interpolation list. Skipping.");break}$.push(X)}U&&(r[N]=$)}if((G==="object"||B)&&k&&!U){t[N]=B?[]:{};var z=k;for(var W in z)t[N][W]=z[W];o[N]=B?[]:{};var H=r[N];if(!this._isDynamic){var q={};for(var W in H)q[W]=H[W];r[N]=H=q}this._setupProperties(z,t[N],H,o[N],D)}else(typeof t[N]>"u"||D)&&(t[N]=k),B||(t[N]*=1),U?o[N]=r[N].slice().reverse():o[N]=t[N]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=now()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=now()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=mainGroup),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=Easing.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=Interpolation.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,o;if(e===void 0&&(e=now()),t===void 0&&(t=!0),this._isPaused)return!0;var D,N=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>N)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var k=e-this._startTime,B=this._duration+((o=this._repeatDelayTime)!==null&&o!==void 0?o:this._delayTime),G=this._duration+this._repeat*B,U=function(){if(r._duration===0||k>G)return 1;var z=Math.trunc(k/B),W=k-z*B,q=Math.min(W/r._duration,1);return q===0&&k===r._duration?1:q},H=U(),$=this._easingFunction(H);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,$),this._onUpdateCallback&&this._onUpdateCallback(this._object,H),this._duration===0||k>=this._duration)if(this._repeat>0){var V=Math.min(Math.trunc((k-this._duration)/B)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=V);for(D in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[D]=="string"&&(this._valuesStartRepeat[D]=this._valuesStartRepeat[D]+parseFloat(this._valuesEnd[D])),this._yoyo&&this._swapEndStartRepeatValues(D),this._valuesStart[D]=this._valuesStartRepeat[D];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=B*V,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var Y=0,X=this._chainedTweens.length;Y<X;Y++)this._chainedTweens[Y].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,o){for(var D in r)if(t[D]!==void 0){var N=t[D]||0,k=r[D],B=Array.isArray(e[D]),G=Array.isArray(k),U=!B&&G;U?e[D]=this._interpolationFunction(k,o):typeof k=="object"&&k?this._updateProperties(e[D],N,k,o):(k=this._handleRelativeValue(N,k),typeof k=="number"&&(e[D]=N+(k-N)*o))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n}();Sequence.nextId;var TWEEN=mainGroup;TWEEN.getAll.bind(TWEEN);var removeAll=TWEEN.removeAll.bind(TWEEN);TWEEN.add.bind(TWEEN);var remove=TWEEN.remove.bind(TWEEN),update=TWEEN.update.bind(TWEEN);class ReadingState{static#t;static get rs(){return this.#t}constructor(){ReadingState.#t=this}static#e={};static#r={};static setEvt2Fnc(e,t,r){e?this.#r[t]=r:this.#e[t]=r}static getEvt2Fnc=e=>this.#e[e]??this.#r[e];static clear_eventer(e,t,r){if(!e.startsWith("dom="))return;const o=t?this.#r[r]:this.#e[r];o&&this.getHtmlElmList(e).el.forEach(D=>D.removeEventListener("click",o)),t?delete this.#r[r]:delete this.#e[r]}static popLocalEvts(){const e=this.#e;return this.#e={},e}static pushLocalEvts(e){this.#e=e}static clear_event(e){const t=argChk_Boolean(e,"global",!1),r=t?this.#r:this.#e;for(const[o,D]of Object.entries(r))o.startsWith("dom=")&&this.getHtmlElmList(o).el.forEach(N=>N.removeEventListener("click",D));return t?this.#r={}:this.#e={},!1}static getHtmlElmList(e){const t=e.indexOf(":");let r="";if(t>=0){const o=e.slice(4,t),D=`const.sn.frm.${o}`;if(!Reading.val.getVal(`tmp:${D}`,0))throw`HTML【${o}】が読み込まれていません`;const N=document.getElementById(o).contentWindow;return r=e.slice(t+1),{el:N.document.querySelectorAll(r),id:o,sel:r}}return r=e.slice(4),{el:document.querySelectorAll(r),id:"",sel:r}}static waitRsvEvent(e,t){if(Reading.val.saveKidoku(),t?this.#e.click=this.#e.enter=this.#e.arrowdown=this.#e["wheel.y>0"]=()=>t():(delete this.#e.click,delete this.#e.enter,delete this.#e.arrowdown,delete this.#e["wheel.y>0"]),this.getEvt2Fnc=e?r=>this.#e[r]??this.#r[r]:r=>this.#e[r],Reading.scrItr.noticeWait(),CmnLib.debugLog){const r=Object.create(null);r.local=Object.keys(this.#e),r.global=Object.keys(this.#r),console.log("🎍 wait event... %o",r)}}static waitRsvEvent4Paging(){if(this.waitRsvEvent(!0),this.aKeysAtPaging.length===0){this.getEvt2Fnc=t=>this.#e[t]??this.#r[t];return}const e={};for(const t of this.aKeysAtPaging){const r=this.#r[t];r&&(e[t]=r)}this.getEvt2Fnc=t=>this.#e[t]??e[t]}fire(e,t){const r=e.toLowerCase();switch(r){case"click":case"rightclick":case"middleclick":case"enter":case"arrowdown":if(!ReadingState.isFirstFire())return;break}if(r==="enter"){const D=Reading.fcs.getFocus();if(D instanceof Container){D.emit(EVNM_CLICK,new PointerEvent(EVNM_CLICK));return}}const o=ReadingState.getEvt2Fnc(r);o&&(t.stopImmediatePropagation(),!(!r.startsWith("dom=")&&Reading.layMng.clickTxtLay())&&o(t))}get isSkipping(){return Reading.skip_enabled}isWait=!1;static#s=!1;static isFirstFire(){return ReadingState.#s?!1:(ReadingState.#s=!0,!0)}static resetFired(){ReadingState.#s=!1}static aPage;static lenPage=0;static posPage=0;static styPaging;static INI_STYPAGE="color: yellow; text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;";static aKeysAtPaging=[];static recodePage(e=!1){if(!Reading.val.getVal("save:sn.doRecLog"))return;const{fn:t,idx:r}=Reading.scrItr.nowScrIdx(),o=`${r-1}:`+t;if(this.aPage.findIndex(N=>N.key===o)>-1)return;CmnLib.debugLog&&console.log(`📜 %crecodePage === week:${e} lenPage:${this.lenPage} len:${this.aPage.length} POP:${!!this.aPage.at(-1)?.week}`,"color:#3B0;"),this.aPage.at(-1)?.week&&this.aPage.pop();const{max_len:D}=Reading.cfg.oCfg.log;if(this.aPage.push({key:o,week:e,fn:Reading.val.getVal("save:const.sn.scriptFn",t),index:Reading.val.getVal("save:const.sn.scriptIdx",0),mark:Reading.scrItr.nowMark()})>D&&(this.aPage=this.aPage.slice(-D)),this.lenPage=this.aPage.length,CmnLib.debugLog){const N=Reading.scrItr.nowMark();console.log(`   %clenPage:${this.lenPage} (base=${N.hPages.base.fore.sBkFn} 0=${N.hPages[0].fore.sBkFn} mes=${N.hPages.mes.fore.txs.cssText.match(/color: \w+;/)})%c mark:%o`,"color:#3B0;","",N),console.table(this.aPage)}Reading.val.setVal_Nochk("sys","const.sn.aPageLog",JSON.stringify(this.aPage))}static playbackPage(e,t){this.aPage=JSON.parse(e),this.lenPage=this.aPage.length,this.posPage>=this.lenPage&&(this.posPage=this.lenPage-1),this.styPaging=t}beginProc(){new ReadingState_proc}endProc(){new ReadingState_go}l(e){if(!Reading.tagL_enabled)return!1;if(ReadingState.recodePage(!0),Reading.auto_enabled)return e.time=Number(Reading.val.getVal(`sys:sn.auto.msecLineWait${Reading.scrItr.isKidoku?"_Kidoku":""}`)),this.wait(e);if(Reading.skip_enabled){if(!Reading.skip_all&&!Reading.scrItr.isNextKidoku)Reading.cancelAutoSkip();else if("ps".includes(Reading.val.getVal("sys:sn.skip.mode")))return e.time=50,this.wait(e)}return argChk_Boolean(e,"visible",!0)&&(Reading.layMng.breakLine(e),Reading.goTxt()),new ReadingState_wait4Tag(e),!0}p(e){if(ReadingState.recodePage(),Reading.auto_enabled)return e.time=Number(Reading.val.getVal(`sys:sn.auto.msecPageWait${Reading.scrItr.isKidoku?"_Kidoku":""}`)),this.wait(e);if(Reading.skip_enabled){if(!Reading.skip_all&&!Reading.scrItr.isNextKidoku)Reading.cancelAutoSkip();else if(Reading.val.getVal("sys:sn.skip.mode")=="s")return e.time=50,this.wait(e)}return argChk_Boolean(e,"visible",!0)&&(Reading.layMng.breakPage(e),Reading.goTxt()),new ReadingState_wait4Tag(e),!0}s(e){return ReadingState.recodePage(),Reading.cancelAutoSkip(),new ReadingState_wait4Tag(e),!0}wait(e){const t=argChk_Num(e,"time",NaN);if(Reading.skip_enabled)return!Reading.skip_all&&!Reading.scrItr.isNextKidoku&&Reading.cancelAutoSkip(),!1;const r=new Tween({}),o="wait",D=()=>{remove(r),Reading.notifyEndProc(o)};r.to({},t).onComplete(D).start();const N=argChk_Boolean(e,"canskip",!0);return Reading.beginProc(o,D,!0,N?D:void 0),!0}page(e){if(!("clear"in e||"to"in e||"style"in e))throw"clear,style,to いずれかは必須です";const{key:t,style:r}=e;return t&&(ReadingState.aKeysAtPaging=t.split(",")),r?(ReadingState.styPaging=r,Reading.val.setVal_Nochk("save","const.sn.styPaging",r),!1):(argChk_Boolean(e,"clear",!1)&&(ReadingState.aPage=[],ReadingState.lenPage=0,ReadingState.posPage=0,Reading.val.setVal_Nochk("sys","const.sn.aPageLog","[]"),Reading.val.setVal_Nochk("save","const.sn.styPaging",ReadingState.INI_STYPAGE)),!1)}static destroy(){this.#e={},this.#r={},this.aPage=[],this.lenPage=0,this.posPage=0}}class ReadingState_go extends ReadingState{constructor(){super(),CmnLib.debugLog&&console.log("📖 => %cReadingState_go","color:#3B0;"),Reading.main.resume()}fire(e,t){}}class ReadingState_proc extends ReadingState{constructor(){super(),CmnLib.debugLog&&console.log("📖 => %cReadingState_proc","color:#3B0;")}fire(e,t){}}class ReadingState_wait4Tag extends ReadingState{constructor(e){super(),CmnLib.debugLog&&console.log("📖 => %cReadingState_wait","color:#3B0;");let t=()=>{};const r=argChk_Boolean(e,"global",!0);switch(e[":タグ名"]){case"wait":return;case"s":ReadingState.waitRsvEvent(r);return;case"p":t=()=>{argChk_Boolean(e,"er",!1)&&Reading.hTag.er(e),Reading.sndMng.clearCache(),new ReadingState_go};break;default:t=()=>new ReadingState_go}ReadingState.waitRsvEvent(r,t)}isWait=!0;page(e){const t=super.page(e),{to:r}=e;if(!r)return t;if(ReadingState.lenPage<2)return!1;switch(r){case"oldest":e.to="prev",ReadingState.posPage=1;break;case"newest":case"prev":e.to="prev",ReadingState.posPage=ReadingState.lenPage-1;break;default:return!1}return ReadingState_page.go(e)}}class ReadingState_page extends ReadingState{constructor(){super(),CmnLib.debugLog&&console.log("📖 => %cReadingState_page","color:#3B0;"),Reading.val.setVal_Nochk("tmp","const.sn.isPaging",!0)}static go(e){return new ReadingState_page().page(e)}#t=!0;get isSkipping(){return this.#t}isWait=!1;beginProc(){Reading.main.stop()}endProc(){Reading.main.resume()}l(e){return this.#t?ReadingState.posPage===ReadingState.lenPage-1?(this.#e(),new ReadingState_go().l(e)):(argChk_Boolean(e,"visible",!0)&&Reading.layMng.breakLine(e),Reading.layMng.setAllStyle2TxtLay(ReadingState.styPaging),Reading.goTxt(),ReadingState.aPage[ReadingState.posPage]?.week?(ReadingState.waitRsvEvent4Paging(),!0):!1):super.l(e)}p(e){return this.#t?ReadingState.posPage===ReadingState.lenPage-1?(this.#e(),new ReadingState_go().p(e)):(argChk_Boolean(e,"visible",!0)&&Reading.layMng.breakPage(e),Reading.layMng.setAllStyle2TxtLay(ReadingState.styPaging),Reading.goTxt(),ReadingState.waitRsvEvent4Paging(),!0):super.p(e)}s(e){return new ReadingState_wait4Tag(e),!0}wait(){return!1}page(e){const{to:t,style:r,clear:o}=e;if(r||o)return!1;switch(CmnLib.debugLog&&console.log(`📜 %cpage() pos:${ReadingState.posPage}%c len:${ReadingState.lenPage} to:${t}`,"color:#3B0;",""),t){case"oldest":if(ReadingState.posPage===0)return!1;ReadingState.posPage=0;break;case"prev":if(ReadingState.posPage===0)return!1;--ReadingState.posPage;break;case"next":if(ReadingState.posPage===ReadingState.lenPage-1)return!1;++ReadingState.posPage;break;case"newest":if(ReadingState.posPage===ReadingState.lenPage-1)return!1;ReadingState.posPage=ReadingState.lenPage-1;break;case"exit":ReadingState.posPage=ReadingState.lenPage-1;break;case"load":ReadingState.lenPage=ReadingState.posPage+1,ReadingState.aPage=ReadingState.aPage.slice(0,ReadingState.lenPage),this.#e();break;default:throw`属性to「${t}」は異常です`}ReadingState.posPage===ReadingState.lenPage-1&&this.#e();const D=ReadingState.aPage[ReadingState.posPage];if(!D)throw`posPage異常:${ReadingState.posPage}`;const{fn:N,index:k,mark:B}=D;if(CmnLib.debugLog){const G=Reading.scrItr.nowMark(),{week:U}=ReadingState.aPage[ReadingState.posPage]??{week:!1};console.log(`   -- fn:${N} i:${k} pos:${ReadingState.posPage} (base=%c${G.hPages.base.fore.sBkFn}%c 0=%c${G.hPages[0].fore.sBkFn}%c mes=%c${G.hPages.mes.fore.txs.cssText.match(/color: \w+;/)}%c) week:${U} A:${ReadingState.posPage===ReadingState.lenPage-1}
   styPaging=%c${ReadingState.styPaging}%c
   mark:%o`,"background-color:#3B0; color:#000;","","background-color:#B4F; color:#000;","","color:#B68;","",ReadingState.styPaging,"",B)}return Reading.scrItr.loadFromMark({fn:N,index:k},B)}#e(){Reading.val.setVal_Nochk("tmp","const.sn.isPaging",!1),this.#t=!1}}class Reading{static beginProc(e,t,r=!0,o){if(CmnLib.debugLog&&console.log(`📖.beginProc id:%c${e}%c onNotify:${!!t} endProc:${r} onClickSkip:${!!o}`,"color:#3B0;",""),this.#t(),this.#s=e,t){const{promise:D,resolve:N}=Promise.withResolvers();D.then(k=>{CmnLib.debugLog&&console.log(`📖.callBack id:%c${k}%c`,"color:#3B0;",""),t(),r?this.endProc(k):this.#t()}),this.#r=N}if(o){const D=()=>{this.cancelAutoSkip(),o(),r&&this.endProc(e)};this.#e.add(this.main.cvs,EVNM_CLICK,N=>{N.stopPropagation(),D()}),this.#e.add(document,EVNM_KEY,N=>{N.isComposing||(N.stopPropagation(),D())}),this.procWheel4wle(this.#e,D)}ReadingState.rs.beginProc()}static#t(){this.#s="",this.#r=()=>{},this.#e.clear()}static#e=new EventListenerCtn;static#r=()=>{};static notifyEndProc(e){CmnLib.debugLog&&console.log(`📖.notifyEndProc id:%c${e}%c=${this.#s===e}`,"color:#3B0;",""),this.#s===e&&this.#r(e)}static endProc(e){CmnLib.debugLog&&console.log(`📖.endProc id:%c${e}%c=${this.#s===e}`,"color:#3B0;",""),this.#s===e&&(ReadingState.rs.endProc(),this.#t())}static#s="";static get procID(){return`RP_${this.scrItr.scriptFn}:${this.scrItr.idxToken}_`}static fire(e,t,r=!1){r&&this.cancelAutoSkip(),ReadingState.rs.fire(e,t)}static get isSkipping(){return ReadingState.rs.isSkipping}static get isWait(){return ReadingState.rs.isWait}static tagL_enabled=!0;static skip_all=!1;static skip_enabled=!1;static auto_enabled=!1;static cfg;static hTag;static main;static val;static scrItr;static layMng;static goTxt=()=>{};static get needGoTxt(){return this.layMng.needGoTxt}static evtMng;static sndMng;static procWheel4wle;static fcs;static init(e,t,r,o,D,N,k,B,G){this.cfg=e,this.hTag=t,this.main=r,this.val=o,this.scrItr=D,this.layMng=N,this.goTxt=()=>N.goTxt(),this.evtMng=k,this.sndMng=B,this.procWheel4wle=G,o.defTmp("sn.tagL.enabled",()=>this.tagL_enabled),o.defValTrg("tmp:sn.tagL.enabled",(U,H)=>this.tagL_enabled=String(H)!=="false"),o.defTmp("sn.skip.all",()=>this.skip_all),o.defValTrg("tmp:sn.skip.all",(U,H)=>this.skip_all=String(H)!=="false"),o.defTmp("sn.skip.enabled",()=>this.skip_enabled),o.defValTrg("tmp:sn.skip.enabled",(U,H)=>this.skip_enabled=String(H)!=="false"),o.defTmp("sn.auto.enabled",()=>this.auto_enabled),o.defValTrg("tmp:sn.auto.enabled",(U,H)=>this.auto_enabled=String(H)!=="false"),t.l=U=>ReadingState.rs.l(U),t.p=U=>ReadingState.rs.p(U),t.s=U=>ReadingState.rs.s(U),t.wait=U=>ReadingState.rs.wait(U),t.waitclick=U=>ReadingState.rs.s(U),t.page=U=>ReadingState.rs.page(U),new ReadingState_proc,t.jump({fn:"main"})}static setFcs(e){this.fcs=e}static cancelAutoSkip(){this.tagL_enabled||(this.tagL_enabled=!0,this.val.setVal_Nochk("tmp","sn.tagL.enabled",!0)),this.skip_enabled&&(this.skip_enabled=!1,this.val.setVal_Nochk("tmp","sn.skip.enabled",!1)),this.auto_enabled&&(this.auto_enabled=!1,this.val.setVal_Nochk("tmp","sn.auto.enabled",!1))}}const TW_INT_TRANS=`trans
`,TMP_TSY_NM="tsy nm:";class CmnTween{static#t={};static#e;static#r;static init(e,t){this.#t={},this.#e=e,this.#r=t,this.#r.ticker.add(this.#s)}static#s=()=>update();static destroy(){this.stopAllTw(),this.#r.ticker.remove(this.#s)}static setTwProp(e,t){const r=argChk_Num(t,"repeat",1);return e.delay(argChk_Num(t,"delay",0)).easing(this.ease(t.ease)).repeat(r>0?r-1:1/0).yoyo(argChk_Boolean(t,"yoyo",!1))}static#i={"Back.In":e=>Easing.Back.In(e),"Back.InOut":e=>Easing.Back.InOut(e),"Back.Out":e=>Easing.Back.Out(e),"Bounce.In":e=>Easing.Bounce.In(e),"Bounce.InOut":e=>Easing.Bounce.InOut(e),"Bounce.Out":e=>Easing.Bounce.Out(e),"Circular.In":e=>Easing.Circular.In(e),"Circular.InOut":e=>Easing.Circular.InOut(e),"Circular.Out":e=>Easing.Circular.Out(e),"Cubic.In":e=>Easing.Cubic.In(e),"Cubic.InOut":e=>Easing.Cubic.InOut(e),"Cubic.Out":e=>Easing.Cubic.Out(e),"Elastic.In":e=>Easing.Elastic.In(e),"Elastic.InOut":e=>Easing.Elastic.InOut(e),"Elastic.Out":e=>Easing.Elastic.Out(e),"Exponential.In":e=>Easing.Exponential.In(e),"Exponential.InOut":e=>Easing.Exponential.InOut(e),"Exponential.Out":e=>Easing.Exponential.Out(e),"Linear.None":e=>Easing.Linear.None(e),"Quadratic.In":e=>Easing.Quadratic.In(e),"Quadratic.InOut":e=>Easing.Quadratic.InOut(e),"Quadratic.Out":e=>Easing.Quadratic.Out(e),"Quartic.In":e=>Easing.Quartic.In(e),"Quartic.InOut":e=>Easing.Quartic.InOut(e),"Quartic.Out":e=>Easing.Quartic.Out(e),"Quintic.In":e=>Easing.Quintic.In(e),"Quintic.InOut":e=>Easing.Quintic.InOut(e),"Quintic.Out":e=>Easing.Quintic.Out(e),"Sinusoidal.In":e=>Easing.Sinusoidal.In(e),"Sinusoidal.InOut":e=>Easing.Sinusoidal.InOut(e),"Sinusoidal.Out":e=>Easing.Sinusoidal.Out(e)};static ease(e){if(!e)return r=>Easing.Linear.None(r);const t=this.#i[e];if(!t)throw"異常なease指定です";return t}static hMemberCnt={alpha:0,height:0,rotation:0,scale_x:0,scale_y:0,pivot_x:0,pivot_y:0,width:0,x:0,y:0};static cnvTweenArg(e,t){const r={};for(const o of Object.keys(this.hMemberCnt)){const D=e[o];if(!D)continue;const N=String(D),k=N.startsWith("="),B=k?N.slice(1):N;if(!B)continue;const[G,U]=B.split(","),H=r[o]=parseFloat(G);U&&(r[o]+=Math.round(Math.random()*(parseFloat(U)-H+1))),k&&(r[o]+=parseFloat(t[o]))}return r}static stopAllTw(){this.#t={},removeAll()}static tween(e,t,r,o,D,N,k,B=!0){const G=this.#e.isSkipping?0:argChk_Num(t,"time",NaN),U=new Tween(r).to(o,G).onUpdate(D);this.setTwProp(U,t),this.#t[e]={tw:U,onEnd:k};const{path:H}=t;let $=U;if(H){CmnLib.debugLog&&console.group(`🍝 [${t[":タグ名"]}] path=${H}= start(${r.x},${r.y},${r.alpha})`);for(const{groups:Y}of H.matchAll(this.#a)){const{x:X,x2:z,y:W,y2:q,o:K,o2:Q,json:Z}=Y;let ee={};if(Z)try{ee=JSON.parse(Z)}catch(oe){console.error(`🍝 json=${Z} `+oe);continue}else(X??z)&&(ee.x=X??z),(W??q)&&(ee.y=W??q),(K??Q)&&(ee.alpha=K??Q);const J=this.cnvTweenArg(ee,r);CmnLib.debugLog&&console.info(`🍝 ${Z??`{x:${X} y:${W} o:${K}}`} => hTo:${JSON.stringify(J)}`);const te=new Tween(r).to(J,G);this.setTwProp(te,t),$.chain(te),$=te}CmnLib.debugLog&&console.groupEnd()}$.onComplete(()=>{const Y=this.#t[e];Y?.tw&&(delete this.#t[e],Y.tw=void 0,U.stop(),Y.onEnd?.(),N(),Reading.notifyEndProc(TMP_TSY_NM+e))});const{chain:V}=t;if(V){const Y=this.#t[V];if(!Y?.tw)throw`${V}は存在しない・または終了したトゥイーンです`;delete Y.onEnd,Y.tw.chain(U)}else B&&U.start();return U}static#a=/\(\s*(?:(?<x>[-=\d\.]+)|(['"])(?<x2>.*?)\2)?(?:\s*,\s*(?:(?<y>[-=\d\.]+)|(['"])(?<y2>.*?)\5)?(?:\s*,\s*(?:(?<o>[-=\d\.]+)|(['"])(?<o2>.*?)\8))?)?|(?<json>\{[^{}]*})/g;static wt(e){if(!this.#t[TW_INT_TRANS]?.tw)return!1;const t=()=>this.#h();return Reading.beginProc(TMP_TSY_NM+TW_INT_TRANS,t,!0,t),!0}static#h(){this.#t[TW_INT_TRANS]?.tw?.stop().end()}static async closeTrans(){if(!this.#t[TW_INT_TRANS]?.tw)return;const{promise:e,resolve:t}=Promise.withResolvers();Reading.beginProc(TMP_TSY_NM+TW_INT_TRANS,t,!1,t),this.#h(),await e}static wait_tsy(e){const t=this.#d(e),r=this.#t[t];if(!r?.tw){const{layer:D="",id:N,name:k}=e;if(argChk_Boolean(e,"chk_exist_tw",!1))throw N?`フレームトゥイーン ${N} が見つかりません。`:`トゥイーン ${t} が見つかりません。(layer:${D} name:${k})`;return!1}const o=()=>r.tw?.end();return Reading.beginProc(TMP_TSY_NM+t,o,!0,o),!0}static#d(e){const{layer:t="",id:r,name:o}=e,D=r?`frm
${r}`:o??t;if(!D)throw"トゥイーンが指定されていません";return D}static stop_tsy(e){const t=this.#d(e);return this.#t[t]?.tw?.stop().end(),!1}static pause_tsy(e){const t=this.#d(e);return this.#t[t]?.tw?.pause(),!1}static resume_tsy(e){const t=this.#d(e);return this.#t[t]?.tw?.resume(),!1}}class DebugMng{constructor(e,t,r){this.sys=e,DebugMng.#t=r,DebugMng.#e=t,DebugMng.#r=t.title,DebugMng.myTrace=DebugMng.#d,t.log=o=>this.#a(o),t.trace=o=>this.#h(o),DebugMng.#s=document.createElement("span"),DebugMng.#s.hidden=!0,DebugMng.#s.textContent="",DebugMng.#s.style.cssText=`	z-index: ${Number.MAX_SAFE_INTEGER};
			position: absolute; left: 0; top: 0;
			color: black;
			background-color: rgba(255, 255, 255, 0.7);`,document.body.appendChild(DebugMng.#s)}static#t;static#e;static#r;static#s;destroy(){DebugMng.#r=()=>!1,document.body.removeChild(DebugMng.#s),DebugMng.myTrace=DebugMng.trace_beforeNew}#i=!0;#a(e){let t="";return this.#i&&(this.#i=!1,t=`== ${platform.description} ==
`),this.sys.appendFile(this.sys.path_downloads+"log.txt",`${t}--- ${getDateStr("-","_","")} [fn:${DebugMng.#t.scriptFn} line:${DebugMng.#t.lineNum}] prj:${this.sys.arg.cur}
${e.text||`(text is ${e.text})`}
`),!1}#h(e){return DebugMng.myTrace(e.text||`(text is ${e.text})`,"I"),!1}static trace_beforeNew=(e,t="E")=>{let r=`{${t}} `+e,o="";switch(t){case"D":o=`color:#${CmnLib.isDarkMode?"49F":"05A"};`;break;case"W":o="color:#FF8800;";break;case"F":o="color:#BB0000;";break;case"ET":throw r;case"E":console.error("%c"+r,"color:#FF3300;");return;default:o="color:black;",r=" "+r}console.info("%c"+r,o)};static myTrace=DebugMng.trace_beforeNew;static strPos=()=>DebugMng.#t.lineNum>0?`(fn:${DebugMng.#t.scriptFn} line:${DebugMng.#t.lineNum}) `:"";static#d=(e,t="E")=>{let r=`{${t}} `+DebugMng.strPos()+e;DebugMng.#l(r,t);let o="";switch(t){case"D":o=`color:#${CmnLib.isDarkMode?"49F":"05A"};`;break;case"W":o="color:#F80;";break;case"F":o="color:#B00;";break;case"ET":case"E":if(DebugMng.#r({text:e}),this.#e.dump_lay({}),this.#e.dump_val({}),DebugMng.#t.dumpErrForeLine(),this.#e.dump_stack({}),t==="ET")throw r;console.error("%c"+r,"color:#F30;");return;default:o="",r=" "+r}console.info("%c"+r,o)};static#l=(e,t)=>{let r="";switch(t){case"D":r="color:#05A;";break;case"W":r="color:#F80;";break;case"F":r="color:#B00;";break;case"ET":case"E":r="color:#F30;";break;default:r=""}DebugMng.#s.innerHTML+=`<span style='${r}'>${e}</span><br/>`,DebugMng.#s.hidden=!1}}class SpritesMng{constructor(e="",t,r=()=>{},o=()=>{}){this.csvFn=e,this.ctn=t,this.fncFirstComp=r,this.fncAllComp=o,e&&(this.#d=t?D=>{t.addChild(D),this.#l.push(D)}:()=>{},this.ret=SpritesMng.#f(e,D=>this.fncFirstComp(D),D=>this.fncAllComp(D),D=>this.#d(D)))}static#t;static#e;static#r;static#s;static init(e,t,r,o,D){SpritesMng.#t=e,SpritesMng.#e=t,SpritesMng.#r=r,SpritesMng.#s=o,r.arg.crypto&&(SpritesMng.#g=SpritesMng.#p,SpritesMng.#u=SpritesMng.#A);const N=()=>{const k=SpritesMng.#a*SpritesMng.#i;for(const B of Object.values(SpritesMng.#_))B.volume=k};D.setNoticeChgVolume(k=>{SpritesMng.#a=k,N()},k=>{SpritesMng.#i=k,N()})}static#i=1;static#a=1;static#h;static setEvtMng(e){SpritesMng.#h=e}ret=!1;#d;#l=[];destroy(){this.fncFirstComp=()=>{},this.fncAllComp=()=>{},this.#d=e=>e.destroy();for(const e of this.#l)SpritesMng.stopVideo(e.name),e.parent?.removeChild(e),e.destroy();this.#l=[]}static destroy(){SpritesMng.#n={},SpritesMng.#c={},SpritesMng.#_={}}static#f(e,t,r,o){if(!e)return!1;let D=!1;if(e.startsWith("data:")){const H=()=>{const $=Sprite.from(e);o($),t($),r(D)};return e in TextureCache?H():(D=!0,new Loader().add(e,e).load(H)),D}const N=[],k=new Loader,B=e.split(","),G=B.length;for(let H=0;H<G;++H){const $=B[H];if(!$)throw"face属性に空要素が含まれます";const{dx:V,dy:Y,blendmode:X,fn:z}=SpritesMng.#n[$]||{fn:$,dx:0,dy:0,blendmode:BLEND_MODES.NORMAL},W=H===0?t:Q=>{Q.transform!==null&&(Q.x=V,Q.y=Y,Q.blendMode=X)};if(N.push({fn:z,fnc:W}),z in SpritesMng.#c||z in TextureCache||z in Loader.shared.resources)continue;D=!0;const q=SpritesMng.#t.searchPath(z,SEARCH_PATH_ARG_EXT.SP_GSM),K=this.#r.arg.crypto?{xhrType:q.slice(-5)===".json"?LoaderResource.XHR_RESPONSE_TYPE.TEXT:LoaderResource.XHR_RESPONSE_TYPE.BUFFER}:{};k.add({...K,name:z,url:q})}const U=(H,$)=>{for(const{fn:V,fnc:Y}of N){const X=SpritesMng.#v(V,$);X.name=V,o(X),Y(X)}r(D)};return D?k.use(async(H,$)=>{try{if(H.extension==="json"){const Y=await this.#r.dec("json",H.data);SpritesMng.#u(Y,H,$);return}const V=await this.#r.decAB(H.data);SpritesMng.#g(V,H,$)}catch(V){const Y=`画像/動画ロード失敗です fn:${H.name} ${V}`;SpritesMng.#h.isSkipping?console.warn(Y):console.error("%c"+Y,"color:#FF3300;")}}).load(U):queueMicrotask(()=>U(0,{})),D}static#n={};static#c={};static#g=(e,{type:t,name:r,data:o},D)=>{switch(t){case LoaderResource.TYPE.VIDEO:const N=o;N.volume=SpritesMng.#a,SpritesMng.#_[r]=SpritesMng.#y(N)}D()};static#m(e){const t=/([^\d]+)\d+\.(\w+)/.exec(e[0]??"");if(!t)return[];const r=t[1].length,o=-t[2].length-1;return e.sort((D,N)=>int(D.slice(r,o))>int(N.slice(r,o))?1:-1)}static async#p(e,t,r){t.data=e,t.extension!=="bin"&&r(),e instanceof HTMLImageElement?(t.texture=await Texture.fromLoader(e,t.url,t.name),t.type=LoaderResource.TYPE.IMAGE):e instanceof HTMLVideoElement&&(e.volume=SpritesMng.#a,SpritesMng.#_[t.name]=SpritesMng.#y(e),t.type=LoaderResource.TYPE.VIDEO),r()}static#y(e){return SpritesMng.#e.getVal("const.sn.needClick2Play")&&(DebugMng.trace_beforeNew(`[lay系] ${DebugMng.strPos()}未クリック状態で動画を自動再生します。音声はミュートされます`,"W"),e.muted=!0),e.setAttribute("playsinline",""),e}static#u=(e,{type:t,spritesheet:r,name:o,data:D},N)=>{switch(t){case LoaderResource.TYPE.JSON:const k=r._frameKeys;SpritesMng.#m(k),SpritesMng.#c[o]={aTex:k.map(B=>Texture.from(B)),meta:D.meta}}N()};static#A(e,t,r){const{meta:o,frames:D}=t.data=JSON.parse(e);if(t.type=LoaderResource.TYPE.JSON,!o?.image){r();return}const N=getFn(o.image),k=SpritesMng.#t.searchPath(N,SEARCH_PATH_ARG_EXT.SP_GSM);new Loader().use((B,G)=>{this.#r.decAB(B.data).then(U=>{B.data=U,U instanceof HTMLImageElement&&(B.type=LoaderResource.TYPE.IMAGE,URL.revokeObjectURL(U.src)),G()}).catch(U=>this.#s.errScript(`画像/動画ロード失敗です dec2res4Cripto fn:${B.name} ${U}`,!1))}).add({name:N,url:k,xhrType:LoaderResource.XHR_RESPONSE_TYPE.BUFFER}).load((B,G)=>{for(const{data:U}of Object.values(B.resources)){const{baseTexture:H}=Texture.from(U),$=Object.values(D);SpritesMng.#c[t.name]={aTex:$.map(({frame:{x:V,y:Y,w:X,h:z}})=>new Texture(H,new Rectangle(V,Y,X,z))),meta:o}}r()})}static#v(e,t){const r=SpritesMng.#c[e];if(r){const N=new AnimatedSprite(r.aTex);return N.animationSpeed=r.meta.animationSpeed??1,N.play(),N}if(e in TextureCache)return Sprite.from(e);const o=SpritesMng.#_[e];if(o)return Sprite.from(o);const D=t[e];return D?new Sprite(D.texture):new Sprite}static#_={};static getHFn2VElm(e){return SpritesMng.#_[e]}static wv(e){const{fn:t}=e;if(!t)throw"fnは必須です";const r=SpritesMng.#_[t];if(!r||r.loop)return!1;if(SpritesMng.#h.isSkipping||r.ended)return SpritesMng.stopVideo(t),!1;const o="wv fn:"+t,D=argChk_Boolean(e,"stop",!0),N=()=>{D&&SpritesMng.stopVideo(t)};return Reading.beginProc(o,N,!0,N),r.addEventListener("ended",()=>Reading.notifyEndProc(o),{once:!0,passive:!0}),!0}static stopVideo(e){const t=SpritesMng.#_[e];t&&(delete SpritesMng.#_[e],t.pause(),t.currentTime=t.duration)}static add_face(e){const{name:t}=e;if(!t)throw"nameは必須です";if(t in SpritesMng.#n)throw"一つのname（"+t+"）に対して同じ画像を複数割り当てられません";const{fn:r=t}=e;return SpritesMng.#n[t]={fn:r,dx:argChk_Num(e,"dx",0),dy:argChk_Num(e,"dy",0),blendmode:Layer.getBlendmodeNum(e.blendmode||"")},!1}}const def行頭禁則="、。，．）］｝〉」』】〕”〟ぁぃぅぇぉっゃゅょゎァィゥェォッャュョヮヵヶ！？!?‼⁉・ーゝゞヽヾ々",def行末禁則="［（｛〈「『【〔“〝",def分割禁止="─‥…",defぶら下げ=def行頭禁則,defReg行頭禁則=new RegExp(`[${def行頭禁則}]`),defReg行末禁則=new RegExp(`[${def行末禁則}]`),defReg分割禁止=new RegExp(`[${def分割禁止}]`),defRegぶら下げ=defReg行頭禁則;class Hyphenation{#t=def行頭禁則;#e=def行末禁則;#r=def分割禁止;#s=defぶら下げ;get 行頭禁則(){return this.#t}get 行末禁則(){return this.#e}get 分割禁止(){return this.#r}get ぶら下げ(){return this.#s}#i=defReg行頭禁則;#a=defReg行末禁則;#h=defReg分割禁止;#d=defRegぶら下げ;break_fixed=!1;break_fixed_left=0;break_fixed_top=0;bura=!1;lay(e){e.kinsoku_sol&&(this.#t=e.kinsoku_sol,this.#i=new RegExp(`[${this.#t}]`)),e.kinsoku_eol&&(this.#e=e.kinsoku_eol,this.#l(),this.#a=new RegExp(`[${this.#e}]`)),e.kinsoku_dns&&(this.#r=e.kinsoku_dns,this.#f(),this.#h=new RegExp(`[${this.#r}]`)),e.kinsoku_bura&&(this.#s=e.kinsoku_bura,this.#l(),this.#f(),this.#d=new RegExp(`[${this.#s}]`)),"bura"in e&&(this.bura=argChk_Boolean(e,"bura",!1)),this.break_fixed=argChk_Boolean(e,"break_fixed",this.break_fixed),this.break_fixed_left=argChk_Num(e,"break_fixed_left",this.break_fixed_left),this.break_fixed_top=argChk_Num(e,"break_fixed_top",this.break_fixed_top)}#l(){const e=this.#e.length,t=this.#s.length;if(e<t)for(let r=0;r<e;++r){const o=this.#e[r];if(this.#s.includes(o))throw`禁則の競合があります。文字 ${o} がぶら下げ と 行末禁則 の両方に含まれます`}else for(let r=0;r<t;++r){const o=this.#s[r];if(this.#e.includes(o))throw`禁則の競合があります。文字 ${o} がぶら下げ と 行末禁則 の両方に含まれます`}}#f(){const e=this.#r.length,t=this.#s.length;if(e<t)for(let r=0;r<e;++r){const o=this.#r[r];if(this.#s.includes(o))throw`禁則の競合があります。文字 ${o} がぶら下げ と 分割禁止 の両方に含まれます`}else for(let r=0;r<t;++r){const o=this.#s[r];if(this.#r.includes(o))throw`禁則の競合があります。文字 ${o} がぶら下げ と 分割禁止 の両方に含まれます`}}reNew(e){e.#n(this.#t,this.#e,this.#r,this.#s),e.break_fixed=this.break_fixed,e.break_fixed_left=this.break_fixed_left,e.break_fixed_top=this.break_fixed_top,e.bura=this.bura}#n(e,t,r,o){this.#t!=e&&(this.#t=e,this.#i=new RegExp(`[${e}]`)),this.#e!=t&&(this.#e=t,this.#a=new RegExp(`[${t}]`)),this.#r!=r&&(this.#r=r,this.#h=new RegExp(`[${r}]`)),this.#s!=o&&(this.#s=o,this.#d=new RegExp(`[${o}]`))}record(){const e={break_fixed:this.break_fixed,break_fixed_left:this.break_fixed_left,break_fixed_top:this.break_fixed_top,bura:this.bura};return this.#t===def行頭禁則&&(e.行頭禁則=this.#t),this.#e===def行末禁則&&(e.行末禁則=this.#e),this.#r===def分割禁止&&(e.分割禁止=this.#r),this.#s===defぶら下げ&&(e.ぶら下げ=this.#s),e}playback(e){e&&(this.#n(e.行頭禁則??def行頭禁則,e.行末禁則??def行末禁則,e.分割禁止??def分割禁止,e.ぶら下げ??defぶら下げ),this.break_fixed=e.break_fixed,this.break_fixed_left=e.break_fixed_left,this.break_fixed_top=e.break_fixed_top,this.bura=e.bura)}hyph(e,t,r,o,D){let N,k=0,B=2,G=U=>(G=()=>!1,o===U?(o>0&&(e.innerHTML=D.replaceAll('class="sn_ch"','class="sn_ch sn_ch_in_default"')),!0):U<2);do{if(N=this.#g(e,t),k=N.length,G(k))break;let U=-1/0;for(;B<k;++B){const{elm:H,rect:$,ch:V}=N[B];if(H.tagName==="RT")continue;const Y=r?$.y:$.x;if(U<=Y||H.previousElementSibling?.tagName==="SPAN"&&H.previousElementSibling?.innerHTML.includes("<br>")||H.parentElement?.previousElementSibling?.tagName==="SPAN"&&H.parentElement?.previousElementSibling?.innerHTML.includes("<br>")){U=Y,this.break_fixed||(this.break_fixed_left=$.x,this.break_fixed_top=$.y);continue}const X=this.#c(N,B),{elm:z,rect:W,ch:q}=N[X];if(!this.break_fixed){this.break_fixed_left=W.x,this.break_fixed_top=W.y;const oe=globalThis.getComputedStyle(z),ce=parseFloat(oe.fontSize);r?this.break_fixed_top+=ce:this.break_fixed_left+=ce}U=-1/0;const K=B,{cont:Q,ins:Z}=this.bura?this.hyph_alg_bura(N,X,q,B):this.hyph_alg(N,X,q,B,V);if(B=Z,Q)continue;const ee=N[B].elm,J=ee.parentElement,te=document.createElement("br");if(J.classList.contains("sn_tx"))J.insertBefore(te,ee);else{const oe=J.parentElement;oe.classList.contains("sn_ch")?oe.parentElement.insertBefore(te,oe):oe.insertBefore(te,J)}B+=2,B<K&&(B=K),k=-1;break}}while(k<0);return[N,k]}#c(e,t){const r=t-1,{elm:o}=e[r];return o.tagName!=="RT"?r-(o.style.textCombineUpright==="all"?Array.from(o.textContent??"").length-1:0):r-Array.from(o.textContent??"").length}#g(e,t){const r=[];if(e.nodeType!==e.TEXT_NODE)return Array.from(e.childNodes).map(k=>this.#g(k,t)).flat();const o=e.ownerDocument.createRange();o.selectNodeContents(e);let D=0;const N=o.endOffset;for(;D<N;){o.setStart(e,D),o.setEnd(e,++D);const k=o.toString();r.push({ch:k,rect:t(o,k),elm:o.startContainer.parentElement})}return o.detach(),r}hyph_alg(e,t,r,o,D){if(!this.#a.test(r)){if(this.#i.test(D))for(;(o=this.#c(e,o))>=0&&this.#i.test(e[o].ch););else if(!(r===D&&this.#h.test(r)))return{cont:!0,ins:o+1}}for(o=t;(o=this.#c(e,o))>=0&&this.#a.test(e[o].ch););return{cont:!1,ins:o+1}}hyph_alg_bura(e,t,r,o){const D=this.#c(e,t),{ch:N}=e[D];if(this.#d.test(N)||this.#i.test(N)){let B=t;(this.#d.test(r)||this.#i.test(r))&&++B;const G=this.#c(e,B),{ch:U}=e[G],{ch:H}=e[B];if(U===H&&this.#h.test(H))return{cont:!1,ins:G};if(!this.#a.test(U))return{cont:!1,ins:B};B=G;do if(!this.#a.test(e[B].ch))break;while((B=this.#c(e,B))>=0);return{cont:!1,ins:B+1}}const k=this.#c(e,D);if(o>=3){const{ch:B}=e[k];if(this.#h.test(N)&&B===N)return{cont:!1,ins:k};if(this.#a.test(B)){let G=k;for(;(G=this.#c(e,G))>=0&&this.#a.test(e[G].ch););return{cont:!1,ins:G+1}}}return{cont:!1,ins:D}}}class CallStack{constructor(e="",t=0,r={":hEvt1Time":{},":hMp":{},":lenIfStk":1}){this.fn=e,this.idx=t,this.csArg=r}toString=()=>`[fn:${this.fn}, idx:${this.idx}, csArg:${this.csArg}]`}class AnalyzeTagArg{#t=/;[^\n]*|(?<key>[^\s="'#|;]+)(?:\s|;[^\n]*\n)*=(?:\s|;[^\n]*\n)*(?:(?<val>[^\s"'#|;]+)|(["'#])(?<val2>.*?)\3)(?:\|(?:(?<def>[^\s"'#;]+)|(["'#])(?<def2>.*?)\6))?|(?<literal>[^\s;]+)/g;parse(e){this.#r={},this.#s=!1;for(const{groups:t}of e.matchAll(this.#t)){const{key:r,val:o,val2:D,def:N,def2:k,literal:B}=t;r?this.#r[r]={val:o??D??"",def:N??k}:B&&(B==="*"?this.#s=!0:this.#r[B]={val:"1"})}}parseinDetail(e,t,r,o){const D={},N=e.slice(1+t,-1);for(const{groups:k,index:B,0:G}of N.matchAll(this.#t)){if(B===void 0)continue;const{key:U,val:H,val2:$="",literal:V}=k;if(V){if(V.endsWith("=")){const q=V.length-1,{ch:K}=this.#e(t,r,o,N,B+q);D[V.slice(0,-1)]={k_ln:r,k_ch:K-q,v_ln:r,v_ch:K+1,v_len:0}}continue}if(!U)continue;const{ln:Y,ch:X}=this.#e(t,r,o,N,B),{ln:z,ch:W}=this.#e(t,r,o,N,B+G.lastIndexOf(H??$??"")-(H?0:1));D[U]={k_ln:Y,k_ch:X,v_ln:z,v_ch:W,v_len:H?H.length:$.length+2}}return D}#e(e,t,r,o,D){const N=o.slice(0,D).split(`
`),k=N.length;return{ln:t+k-1,ch:k<2?r+1+e+D:N.at(-1).length}}#r={};get hPrm(){return this.#r}#s=!1;get isKomeParam(){return this.#s}}const REG_TAG=/(?<name>[^\s;\]]+)/;function tagToken2Name_Args(n){const e=REG_TAG.exec(n.slice(1,-1))?.groups;if(!e)throw`タグ記述【${n}】異常です(タグ解析)`;const t=e.name;return[t,n.slice(1+t.length,-1)]}function tagToken2Name(n){const e=REG_TAG.exec(n.slice(1))?.groups;if(!e)throw`タグ記述【${n}】異常です(タグ解析)`;return e.name}function splitAmpersand(n){const e=n.replaceAll("==","＝").replaceAll("!=","≠").split("="),t=e.length;if(t<2||t>3)throw"「&計算」書式では「=」指定が一つか二つ必要です";const[r,o,D]=e;if(o.startsWith("&"))throw"「&計算」書式では「&」指定が不要です";return{name:r.replaceAll("＝","==").replaceAll("≠","!="),text:o.replaceAll("＝","==").replaceAll("≠","!="),cast:t===3?D.trim():void 0}}class Grammar{constructor(e){this.cfg=e,this.setEscape("")}#t;setEscape(e){if(this.#f&&e in this.#f)throw"[エスケープ文字] char【"+e+"】が登録済みの括弧マクロまたは一文字マクロです";this.#t=new RegExp((e?`\\${e}\\S|`:"")+`\\n+|\\t+|\\[let_ml\\s+[^\\]]+\\].+?(?=\\[endlet_ml[\\]\\s])|\\[(?:[^"'#;\\]]+|(["'#]).*?\\1|;[^\\n]*)*?]|;[^\\n]*|&[^&\\n]+&|&&?(?:[^"'#;\\n&]+|(["'#]).*?\\2)+|^\\*[^\\s\\[&;\\\\]+|[^\\n\\t\\[;${e?`\\${e}`:""}]+`,"gs"),this.#e=new RegExp(`[\\w\\s;[\\]*=&｜《》${e?`\\${e}`:""}]`),this.#n=new RegExp(`[\\n\\t;\\[*&${e?`\\${e}`:""}]`)}bracket2macro(e,t,r,o){const{name:D,text:N}=e;if(!D)throw"[bracket2macro] nameは必須です";if(!N)throw"[bracket2macro] textは必須です";const k=N.at(0);if(!k)throw"[bracket2macro] textは必須です";if(N.length!==2)throw"[bracket2macro] textは括弧の前後を示す二文字を指定してください";if(!(D in t))throw`[bracket2macro] 未定義のタグ又はマクロ[${D}]です`;this.#f??={};const B=N.charAt(1);if(k in this.#f)throw"[bracket2macro] text【"+k+"】が登録済みの括弧マクロまたは一文字マクロです";if(B in this.#f)throw"[bracket2macro] text【"+B+"】が登録済みの括弧マクロまたは一文字マクロです";if(this.#e.test(k))throw"[bracket2macro] text【"+k+"】は括弧マクロに使用できない文字です";if(this.#e.test(B))throw"[bracket2macro] text【"+B+"】は括弧マクロに使用できない文字です";this.#f[B]="0",this.#f[k]=`[${D} text=`,this.addC2M(`\\${k}[^\\${B}]*\\${B}`,`\\${k}\\${B}`),this.#c(r,o)}char2macro(e,t,r,o){const{char:D,name:N}=e;if(!D)throw"[char2macro] charは必須です";if(this.#f??={},D in this.#f)throw"[char2macro] char【"+D+"】が登録済みの括弧マクロまたは一文字マクロです";if(this.#e.test(D))throw"[char2macro] char【"+D+"】は一文字マクロに使用できない文字です";if(!N)throw"[char2macro] nameは必須です";if(!(N in t))throw`[char2macro] 未定義のタグ又はマクロ[${N}]です`;this.#f[D]=`[${N}]`,this.addC2M(`\\${D}`,`\\${D}`),this.#c(r,o)}#e;#r=new RegExp("");#s="";#i="";addC2M(e,t){this.#s+=`${e}|`,this.#i+=`${t}`,this.#r=new RegExp(`(${this.#s}[^${this.#i}]+)`,"g")}resolveScript(e){const t=e.replaceAll(/\r\n?/g,`
`).match(this.#t)?.flatMap(o=>{if(!this.testTagLetml(o))return o;const D=/^([^\]]+?])(.*)$/s.exec(o);if(!D)return o;const[,N,k]=D;return[N,k]})??[],r={aToken:t,len:t.length,aLNum:[]};return this.#c(r),this.#d(r),r}#a=/^\[(call|loadplugin)\s/;#h=/\bfn\s*=\s*[^\s\]]+/;#d(e){for(let t=e.len-1;t>=0;--t){const r=e.aToken[t];if(!this.#a.test(r))continue;const[o,D]=tagToken2Name_Args(r);this.#l.parse(D);const N=this.#l.hPrm.fn;if(!N)continue;const{val:k}=N;if(!k||!k.endsWith("*"))continue;e.aToken.splice(t,1,"	","; "+r),e.aLNum.splice(t,1,NaN,NaN);const B=o==="loadplugin"?SEARCH_PATH_ARG_EXT.CSS:SEARCH_PATH_ARG_EXT.SN,G=this.cfg.matchPath("^"+k.slice(0,-1)+".*",B);for(const U of G){const H=r.replace(this.#h,"fn="+decodeURIComponent(getFn(U[B])));e.aToken.splice(t,0,H),e.aLNum.splice(t,0,NaN)}}e.len=e.aToken.length}#l=new AnalyzeTagArg;testTagLetml(e){return/^\[let_ml\s/.test(e)}testTagEndLetml(e){return/^\[endlet_ml\s*]/.test(e)}analyzToken(e){return this.#t.lastIndex=0,this.#t.exec(e)}#f;#n;#c(e,t=0){if(this.#f){for(let r=e.len-1;r>=t;--r){const o=e.aToken[r];if(this.testNoTxt(o.at(0)??`
`))continue;const D=e.aLNum[r],N=o.match(this.#r);if(!N)continue;let k=1;for(let B=N.length-1;B>=0;--B){let G=N[B];const U=this.#f[G.at(0)??" "];U&&(G=U+(U.endsWith("]")?"":`'${G.slice(1,-1)}']`)),e.aToken.splice(r,k,G),e.aLNum.splice(r,k,D),k=0}}e.len=e.aToken.length}}testNoTxt(e){return this.#n.test(e)}}class RubySpliter{static#t="ヽ";static setting(e){e.sesame&&(RubySpliter.#t=e.sesame)}static getSesame(){return RubySpliter.#t}static destroy(){RubySpliter.#t="ヽ"}#e=()=>{};init(e){this.#e=e}static#r;static setEscape(e){RubySpliter.#r=new RegExp(`${e?`(?<ce>\\${e}\\S)|`:""}｜(?<str>[^《\\n]+)《(?<ruby>[^》\\n]+)》|(?:(?<kan>[⺀-⿟々〇〻㐀-鿿豈-﫿]+[ぁ-ヿ]*|[^　｜《》\\n])《(?<kan_ruby>[^》\\n]+)》)|(?<txt>[\uD800-\uDBFF][\uDC00-\uDFFF]|[^｜《》]+?|.)`,"gs")}putTxt(e){for(const{groups:t}of e.matchAll(RubySpliter.#r)){const{ruby:r,kan_ruby:o,kan:D="",ce:N,txt:k="",str:B=""}=t;if(r){this.putTxtRb(decodeURIComponent(B),r);continue}if(o){this.putTxtRb(D,o);continue}if(N){this.#e(N.slice(1),"");continue}for(const G of Array.from(k))this.#e(G,"")}}putTxtRb(e,t){if(/^\w+｜{"/.test(t)){this.#e(e,t);return}const r=Array.from(e),o=r.length;if(/^\*.?$/.test(t)){const B="center｜"+(t==="*"?RubySpliter.#t:t.charAt(1));for(let G=0;G<o;++G)this.#e(r[G],B);return}if(o===1||!t.includes(" ")){this.#e(e,decodeURIComponent(t));return}const D=t.split(" "),N=D.length,k=N>o?N:o;for(let B=0;B<k;++B)this.#e(B<o?r[B]:"",B<N?decodeURIComponent(D[B]):"")}}/*!
 * @pixi/sound - v4.4.1
 * https://github.com/pixijs/pixi-sound
 * Compiled Tue, 15 Aug 2023 19:22:13 UTC
 *
 * @pixi/sound is licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license
 */var s;function u(){return s}var a=function(n,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])})(n,e)};function c(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=n}a(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var l=function(){return(l=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)},p=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],h={};function f(n){var e=l({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},{}),t=document.createElement("audio"),r={},o=/^no$/;p.forEach(function(D){var N=t.canPlayType("audio/".concat(D)).replace(o,""),k=e[D]?t.canPlayType(e[D]).replace(o,""):"";r[D]=!!N||!!k}),Object.assign(h,r)}f();var d=/\.(\{([^\}]+)\})(\?.*)?$/;function _(n){var e=d,t=typeof n=="string"?n:n.url;if(!e.test(t))return t;for(var r=e.exec(t),o=r[2].split(","),D=o[o.length-1],N=0,k=o.length;N<k;N++){var B=o[N];if(h[B]){D=B;break}}var G=t.replace(r[1],D);if(typeof n!="string"){var U=n;U.extension=D,U.url=G}return G}var y=p.filter(function(n){return h[n]}),m=function(){function n(){}return n.add=function(){n.setLegacy(u().useLegacy)},n.setLegacy=function(e){e?y.forEach(function(t){LoaderResource.setExtensionXhrType(t,LoaderResource.XHR_RESPONSE_TYPE.DEFAULT),LoaderResource.setExtensionLoadType(t,LoaderResource.LOAD_TYPE.AUDIO)}):y.forEach(function(t){LoaderResource.setExtensionXhrType(t,LoaderResource.XHR_RESPONSE_TYPE.BUFFER),LoaderResource.setExtensionLoadType(t,LoaderResource.LOAD_TYPE.XHR)})},n.pre=function(e,t){_(e),t()},n.use=function(e,t){e.data&&y.indexOf(e.extension)>-1?e.sound=u().add(e.name,{loaded:t,preload:!0,url:e.url,source:e.data}):t()},n.extension="loader",n}(),b=0,g=function(n){function e(t){var r=n.call(this)||this;return r.id=b++,r.init(t),r}return c(e,n),e.prototype.set=function(t,r){if(this[t]===void 0)throw new Error("Property with name ".concat(t," does not exist."));switch(t){case"speed":this.speed=r;break;case"volume":this.volume=r;break;case"paused":this.paused=r;break;case"loop":this.loop=r;break;case"muted":this.muted=r}return this},Object.defineProperty(e.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype._onPlay=function(){this._playing=!0},e.prototype._onPause=function(){this._playing=!1},e.prototype.init=function(t){this._playing=!1,this._duration=t.source.duration;var r=this._source=t.source.cloneNode(!1);r.src=t.parent.url,r.onplay=this._onPlay.bind(this),r.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t},e.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},e.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){var t=this._media.context,r=this._media.parent;this._source.loop=this._loop||r.loop;var o=t.volume*(t.muted?0:1),D=r.volume*(r.muted?0:1),N=this._volume*(this._muted?0:1);this._source.volume=N*o*D,this._source.playbackRate=this._speed*t.speed*r.speed},e.prototype.refreshPaused=function(){var t=this._media.context,r=this._media.parent,o=this._paused||r.paused||t.paused;o!==this._pausedReal&&(this._pausedReal=o,o?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",o))},e.prototype.play=function(t){var r=this,o=t.start,D=t.end,N=t.speed,k=t.loop,B=t.volume,G=t.muted;this._speed=N,this._volume=B,this._loop=!!k,this._muted=G,this.refresh(),this.loop&&D!==null&&(this.loop=!1),this._start=o,this._end=D||this._duration,this._start=Math.max(0,this._start-e.PADDING),this._end=Math.min(this._end+e.PADDING,this._duration),this._source.onloadedmetadata=function(){r._source&&(r._source.currentTime=o,r._source.onloadedmetadata=null,r.emit("progress",o,r._duration),Ticker.shared.add(r._onUpdate,r))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},e.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},e.prototype._onComplete=function(){Ticker.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},e.prototype.destroy=function(){Ticker.shared.remove(this._onUpdate,this),this.removeAllListeners();var t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},e.prototype.toString=function(){return"[HTMLAudioInstance id=".concat(this.id,"]")},e.PADDING=.1,e}(i),v=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return c(e,n),e.prototype.init=function(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)},e.prototype.create=function(){return new g(this)},Object.defineProperty(e.prototype,"isPlayable",{get:function(){return!!this._source&&this._source.readyState===4},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._source.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.load=function(t){var r=this._source,o=this.parent;if(r.readyState!==4)if(o.url){r.src=o.url;var D=function(){B(),o.isLoaded=!0;var U=o.autoPlayStart();t&&t(null,o,U)},N=function(){B(),t&&t(new Error("Sound loading has been aborted"))},k=function(){B();var U="Failed to load audio element (code: ".concat(r.error.code,")");t&&t(new Error(U))},B=function(){r.removeEventListener("canplaythrough",D),r.removeEventListener("load",D),r.removeEventListener("abort",N),r.removeEventListener("error",k)};r.addEventListener("canplaythrough",D,!1),r.addEventListener("load",D,!1),r.addEventListener("abort",N,!1),r.addEventListener("error",k,!1),r.load()}else t(new Error("sound.url or sound.source must be set"));else{o.isLoaded=!0;var G=o.autoPlayStart();t&&setTimeout(function(){t(null,o,G)},0)}},e}(i),P=function(){function n(e,t){this.parent=e,Object.assign(this,t),this.duration=this.end-this.start}return n.prototype.play=function(e){return this.parent.play({complete:e,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},n.prototype.destroy=function(){this.parent=null},n}(),x=function(){function n(){}return n.setParamValue=function(e,t){if(e.setValueAtTime){var r=u().context;e.setValueAtTime(t,r.audioContext.currentTime)}else e.value=t;return t},n}(),O=0,j=function(n){function e(t){var r=n.call(this)||this;return r.id=O++,r._media=null,r._paused=!1,r._muted=!1,r._elapsed=0,r.init(t),r}return c(e,n),e.prototype.set=function(t,r){if(this[t]===void 0)throw new Error("Property with name ".concat(t," does not exist."));switch(t){case"speed":this.speed=r;break;case"volume":this.volume=r;break;case"muted":this.muted=r;break;case"loop":this.loop=r;break;case"paused":this.paused=r}return this},e.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh(),this._update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(t){var r;this._filters&&((r=this._filters)===null||r===void 0||r.filter(function(o){return o}).forEach(function(o){return o.disconnect()}),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){if(this._source){var t=this._media.context,r=this._media.parent;this._source.loop=this._loop||r.loop;var o=t.volume*(t.muted?0:1),D=r.volume*(r.muted?0:1),N=this._volume*(this._muted?0:1);x.setParamValue(this._gain.gain,N*D*o),x.setParamValue(this._source.playbackRate,this._speed*r.speed*t.speed),this.applyFilters()}},e.prototype.applyFilters=function(){var t;if(!((t=this._filters)===null||t===void 0)&&t.length){this._source.disconnect();var r=this._source;this._filters.forEach(function(o){r.connect(o.destination),r=o}),r.connect(this._gain)}},e.prototype.refreshPaused=function(){var t=this._media.context,r=this._media.parent,o=this._paused||r.paused||t.paused;o!==this._pausedReal&&(this._pausedReal=o,o?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",o))},e.prototype.play=function(t){var r=t.start,o=t.end,D=t.speed,N=t.loop,k=t.volume,B=t.muted,G=t.filters;this._paused=!1;var U=this._media.nodes.cloneBufferSource(),H=U.source,$=U.gain;this._source=H,this._gain=$,this._speed=D,this._volume=k,this._loop=!!N,this._muted=B,this._filters=G,this.refresh();var V=this._source.buffer.duration;this._duration=V,this._end=o,this._lastUpdate=this._now(),this._elapsed=r,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=o,this._source.loopStart=r,this._source.start(0,r)):o?this._source.start(0,r,o-r):this._source.start(0,r),this.emit("start"),this._update(!0),this.enableTicker(!0)},e.prototype.enableTicker=function(t){Ticker.shared.remove(this._updateListener,this),t&&Ticker.shared.add(this._updateListener,this)},Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t;this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),(t=this._filters)===null||t===void 0||t.forEach(function(r){return r.disconnect()}),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},e.prototype.toString=function(){return"[WebAudioInstance id=".concat(this.id,"]")},e.prototype._now=function(){return this._media.context.audioContext.currentTime},e.prototype._updateListener=function(){this._update()},e.prototype._update=function(t){if(t===void 0&&(t=!1),this._source){var r=this._now(),o=r-this._lastUpdate;if(o>0||t){var D=this._source.playbackRate.value;this._elapsed+=o*D,this._lastUpdate=r;var N=this._duration,k=void 0;if(this._source.loopStart){var B=this._source.loopEnd-this._source.loopStart;k=(this._source.loopStart+this._elapsed%B)/N}else k=this._elapsed%N/N;this._progress=k,this.emit("progress",this._progress,N)}}},e.prototype.init=function(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)},e.prototype._internalStop=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch{}this._source=null}},e.prototype._onComplete=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch{}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},e}(i),w=function(){function n(e,t){this._output=t,this._input=e}return Object.defineProperty(n.prototype,"destination",{get:function(){return this._input},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this._filters},set:function(e){var t=this;if(this._filters&&(this._filters.forEach(function(o){o&&o.disconnect()}),this._filters=null,this._input.connect(this._output)),e&&e.length){this._filters=e.slice(0),this._input.disconnect();var r=null;e.forEach(function(o){r===null?t._input.connect(o.destination):r.connect(o.destination),r=o}),r.connect(this._output)}},enumerable:!1,configurable:!0}),n.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},n}(),A=function(n){function e(t){var r=this,o=t.audioContext,D=o.createBufferSource(),N=o.createGain(),k=o.createAnalyser();return D.connect(k),k.connect(N),N.connect(t.destination),(r=n.call(this,k,N)||this).context=t,r.bufferSource=D,r.gain=N,r.analyser=k,r}return c(e,n),Object.defineProperty(e.prototype,"script",{get:function(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(e.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){n.prototype.destroy.call(this),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null},e.prototype.cloneBufferSource=function(){var t=this.bufferSource,r=this.context.audioContext.createBufferSource();r.buffer=t.buffer,x.setParamValue(r.playbackRate,t.playbackRate.value),r.loop=t.loop;var o=this.context.audioContext.createGain();return r.connect(o),o.connect(this.destination),{source:r,gain:o}},Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this.script.bufferSize},enumerable:!1,configurable:!0}),e.BUFFER_SIZE=0,e}(w),F=function(){function n(){}return n.prototype.init=function(e){this.parent=e,this._nodes=new A(this.context),this._source=this._nodes.bufferSource,this.source=e.options.source},n.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch{}this._source=null,this.source=null},n.prototype.create=function(){return new j(this)},Object.defineProperty(n.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this._nodes.filters},set:function(e){this._nodes.filters=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._source.buffer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._source.buffer},set:function(e){this._source.buffer=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),n.prototype.load=function(e){this.source?this._decode(this.source,e):this.parent.url?this._loadUrl(e):e&&e(new Error("sound.url or sound.source must be set"))},n.prototype._loadUrl=function(e){var t=this,r=new XMLHttpRequest,o=this.parent.url;r.open("GET",o,!0),r.responseType="arraybuffer",r.onload=function(){t.source=r.response,t._decode(r.response,e)},r.send()},n.prototype._decode=function(e,t){var r=this,o=function(D,N){if(D)t&&t(D);else{r.parent.isLoaded=!0,r.buffer=N;var k=r.parent.autoPlayStart();t&&t(null,r.parent,k)}};e instanceof AudioBuffer?o(null,e):this.parent.context.decode(e,o)},n}(),E=function(){function n(e,t){this.media=e,this.options=t,this._instances=[],this._sprites={},this.media.init(this);var r=t.complete;this._autoPlayOptions=r?{complete:r}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}return n.from=function(e){var t={};return typeof e=="string"?t.url=e:e instanceof ArrayBuffer||e instanceof AudioBuffer||e instanceof HTMLAudioElement?t.source=e:t=e,(t=l({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},t)).url&&(t.url=_(t.url)),Object.freeze(t),new n(u().useLegacy?new v:new F,t)},Object.defineProperty(n.prototype,"context",{get:function(){return u().context},enumerable:!1,configurable:!0}),n.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},n.prototype.resume=function(){return this.isPlaying=this._instances.length>0,this.paused=!1,this},Object.defineProperty(n.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return this.media.filters},set:function(e){this.media.filters=e},enumerable:!1,configurable:!0}),n.prototype.addSprites=function(e,t){if(typeof e=="object"){var r={};for(var o in e)r[o]=this.addSprites(o,e[o]);return r}var D=new P(this,t);return this._sprites[e]=D,D},n.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},n.prototype.removeSprites=function(e){if(e){var t=this._sprites[e];t!==void 0&&(t.destroy(),delete this._sprites[e])}else for(var r in this._sprites)this.removeSprites(r);return this},Object.defineProperty(n.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!1,configurable:!0}),n.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var e=this._instances.length-1;e>=0;e--)this._instances[e].stop();return this},n.prototype.play=function(e,t){var r,o=this;if(typeof e=="string"?r={sprite:N=e,loop:this.loop,complete:t}:typeof e=="function"?(r={}).complete=e:r=e,(r=l({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},r||{})).sprite){var D=r.sprite,N=this._sprites[D];r.start=N.start+(r.start||0),r.end=N.end,r.speed=N.speed||1,r.loop=N.loop||r.loop,delete r.sprite}if(r.offset&&(r.start=r.offset),!this.isLoaded)return new Promise(function(B,G){o.autoPlay=!0,o._autoPlayOptions=r,o._preload(function(U,H,$){U?G(U):(r.loaded&&r.loaded(U,H,$),B($))})});(this.singleInstance||r.singleInstance)&&this._removeInstances();var k=this._createInstance();return this._instances.push(k),this.isPlaying=!0,k.once("end",function(){r.complete&&r.complete(o),o._onComplete(k)}),k.once("stop",function(){o._onComplete(k)}),k.play(r),k},n.prototype.refresh=function(){for(var e=this._instances.length,t=0;t<e;t++)this._instances[t].refresh()},n.prototype.refreshPaused=function(){for(var e=this._instances.length,t=0;t<e;t++)this._instances[t].refreshPaused()},Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!1,configurable:!0}),n.prototype._preload=function(e){this.media.load(e)},Object.defineProperty(n.prototype,"instances",{get:function(){return this._instances},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sprites",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this.media.duration},enumerable:!1,configurable:!0}),n.prototype.autoPlayStart=function(){var e;return this.autoPlay&&(e=this.play(this._autoPlayOptions)),e},n.prototype._removeInstances=function(){for(var e=this._instances.length-1;e>=0;e--)this._poolInstance(this._instances[e]);this._instances.length=0},n.prototype._onComplete=function(e){if(this._instances){var t=this._instances.indexOf(e);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(e)},n.prototype._createInstance=function(){if(n._pool.length>0){var e=n._pool.pop();return e.init(this.media),e}return this.media.create()},n.prototype._poolInstance=function(e){e.destroy(),n._pool.indexOf(e)<0&&n._pool.push(e)},n._pool=[],n}(),C=function(n){function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.speed=1,t.muted=!1,t.volume=1,t.paused=!1,t}return c(e,n),e.prototype.refresh=function(){this.emit("refresh")},e.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(e.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioContext",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},e.prototype.destroy=function(){this.removeAllListeners()},e}(i),L=function(n){function e(){var t=n.call(this,null,null)||this;t.autoPause=!0;var r=window,o=new e.AudioContext,D=o.createDynamicsCompressor(),N=o.createAnalyser();return N.connect(D),D.connect(o.destination),t._input=N,t._output=o.destination,t._ctx=o,t._offlineCtx=new e.OfflineAudioContext(1,2,r.OfflineAudioContext?Math.max(8e3,Math.min(96e3,o.sampleRate)):44100),t.compressor=D,t.analyser=N,t.events=new i,t.volume=1,t.speed=1,t.muted=!1,t.paused=!1,t._locked=o.state==="suspended"&&("ontouchstart"in globalThis||"onclick"in globalThis),t._locked&&(t._unlock(),t._unlock=t._unlock.bind(t),document.addEventListener("mousedown",t._unlock,!0),document.addEventListener("touchstart",t._unlock,!0),document.addEventListener("touchend",t._unlock,!0)),t.onFocus=t.onFocus.bind(t),t.onBlur=t.onBlur.bind(t),globalThis.addEventListener("focus",t.onFocus),globalThis.addEventListener("blur",t.onBlur),t}return c(e,n),e.prototype.onFocus=function(){if(this.autoPause){var t=this._ctx.state;t!=="suspended"&&t!=="interrupted"&&this._locked||(this.paused=this._pausedOnBlur,this.refreshPaused())}},e.prototype.onBlur=function(){this.autoPause&&(this._locked||(this._pausedOnBlur=this._paused,this.paused=!0,this.refreshPaused()))},e.prototype._unlock=function(){this._locked&&(this.playEmptySound(),this._ctx.state==="running"&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))},e.prototype.playEmptySound=function(){var t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),t.context.state==="suspended"&&t.context.resume()},Object.defineProperty(e,"AudioContext",{get:function(){var t=window;return t.AudioContext||t.webkitAudioContext||null},enumerable:!1,configurable:!0}),Object.defineProperty(e,"OfflineAudioContext",{get:function(){var t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){n.prototype.destroy.call(this);var t=this._ctx;t.close!==void 0&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(t){t&&this._ctx.state==="running"?this._ctx.suspend():t||this._ctx.state!=="suspended"||this._ctx.resume(),this._paused=t},enumerable:!1,configurable:!0}),e.prototype.refresh=function(){this.events.emit("refresh")},e.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},e.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},e.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},e.prototype.decode=function(t,r){var o=function(N){r(new Error(N?.message||"Unable to decode file"))},D=this._offlineCtx.decodeAudioData(t,function(N){r(null,N)},o);D&&D.catch(o)},e}(w),S=function(){function n(){this.init()}return n.prototype.init=function(){return this.supported&&(this._webAudioContext=new L),this._htmlAudioContext=new C,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(n.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(e){this.useLegacy||(this._context.filters=e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"supported",{get:function(){return L.AudioContext!==null},enumerable:!1,configurable:!0}),n.prototype.add=function(e,t){if(typeof e=="object"){var r={};for(var o in e){var D=this._getOptions(e[o],t);r[o]=this.add(o,D)}return r}if(t instanceof E)return this._sounds[e]=t,t;var N=this._getOptions(t),k=E.from(N);return this._sounds[e]=k,k},n.prototype._getOptions=function(e,t){var r;return r=typeof e=="string"?{url:e}:e instanceof ArrayBuffer||e instanceof AudioBuffer||e instanceof HTMLAudioElement?{source:e}:e,r=l(l({},r),t||{})},Object.defineProperty(n.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(e){m.setLegacy(e),this._useLegacy=e,this._context=!e&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableAutoPause",{get:function(){return!this._webAudioContext.autoPause},set:function(e){this._webAudioContext.autoPause=!e},enumerable:!1,configurable:!0}),n.prototype.remove=function(e){return this.exists(e,!0),this._sounds[e].destroy(),delete this._sounds[e],this},Object.defineProperty(n.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(e){this._context.volume=e,this._context.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"speedAll",{get:function(){return this._context.speed},set:function(e){this._context.speed=e,this._context.refresh()},enumerable:!1,configurable:!0}),n.prototype.togglePauseAll=function(){return this._context.togglePause()},n.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refreshPaused(),this},n.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refreshPaused(),this},n.prototype.toggleMuteAll=function(){return this._context.toggleMute()},n.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},n.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},n.prototype.removeAll=function(){for(var e in this._sounds)this._sounds[e].destroy(),delete this._sounds[e];return this},n.prototype.stopAll=function(){for(var e in this._sounds)this._sounds[e].stop();return this},n.prototype.exists=function(e,t){return!!this._sounds[e]},n.prototype.find=function(e){return this.exists(e,!0),this._sounds[e]},n.prototype.play=function(e,t){return this.find(e).play(t)},n.prototype.stop=function(e){return this.find(e).stop()},n.prototype.pause=function(e){return this.find(e).pause()},n.prototype.resume=function(e){return this.find(e).resume()},n.prototype.volume=function(e,t){var r=this.find(e);return t!==void 0&&(r.volume=t),r.volume},n.prototype.speed=function(e,t){var r=this.find(e);return t!==void 0&&(r.speed=t),r.speed},n.prototype.duration=function(e){return this.find(e).duration},n.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},n}(),M=function(){function n(e,t){this.init(e,t)}return n.prototype.init=function(e,t){this.destination=e,this.source=t||e},n.prototype.connect=function(e){this.source.connect(e)},n.prototype.disconnect=function(){this.source.disconnect()},n.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},n}(),T={__proto__:null,EqualizerFilter:function(n){function e(t,r,o,D,N,k,B,G,U,H){t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),D===void 0&&(D=0),N===void 0&&(N=0),k===void 0&&(k=0),B===void 0&&(B=0),G===void 0&&(G=0),U===void 0&&(U=0),H===void 0&&(H=0);var $=this;if(!u().useLegacy){var V=[{f:e.F32,type:"lowshelf",gain:t},{f:e.F64,type:"peaking",gain:r},{f:e.F125,type:"peaking",gain:o},{f:e.F250,type:"peaking",gain:D},{f:e.F500,type:"peaking",gain:N},{f:e.F1K,type:"peaking",gain:k},{f:e.F2K,type:"peaking",gain:B},{f:e.F4K,type:"peaking",gain:G},{f:e.F8K,type:"peaking",gain:U},{f:e.F16K,type:"highshelf",gain:H}].map(function(z){var W=u().context.audioContext.createBiquadFilter();return W.type=z.type,x.setParamValue(W.Q,1),W.frequency.value=z.f,x.setParamValue(W.gain,z.gain),W});($=n.call(this,V[0],V[V.length-1])||this).bands=V,$.bandsMap={};for(var Y=0;Y<$.bands.length;Y++){var X=$.bands[Y];Y>0&&$.bands[Y-1].connect(X),$.bandsMap[X.frequency.value]=X}return $}$=n.call(this,null)||this}return c(e,n),e.prototype.setGain=function(t,r){if(r===void 0&&(r=0),!this.bandsMap[t])throw new Error("No band found for frequency ".concat(t));x.setParamValue(this.bandsMap[t].gain,r)},e.prototype.getGain=function(t){if(!this.bandsMap[t])throw new Error("No band found for frequency ".concat(t));return this.bandsMap[t].gain.value},Object.defineProperty(e.prototype,"f32",{get:function(){return this.getGain(e.F32)},set:function(t){this.setGain(e.F32,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f64",{get:function(){return this.getGain(e.F64)},set:function(t){this.setGain(e.F64,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f125",{get:function(){return this.getGain(e.F125)},set:function(t){this.setGain(e.F125,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f250",{get:function(){return this.getGain(e.F250)},set:function(t){this.setGain(e.F250,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f500",{get:function(){return this.getGain(e.F500)},set:function(t){this.setGain(e.F500,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f1k",{get:function(){return this.getGain(e.F1K)},set:function(t){this.setGain(e.F1K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f2k",{get:function(){return this.getGain(e.F2K)},set:function(t){this.setGain(e.F2K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f4k",{get:function(){return this.getGain(e.F4K)},set:function(t){this.setGain(e.F4K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f8k",{get:function(){return this.getGain(e.F8K)},set:function(t){this.setGain(e.F8K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f16k",{get:function(){return this.getGain(e.F16K)},set:function(t){this.setGain(e.F16K,t)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.bands.forEach(function(t){x.setParamValue(t.gain,0)})},e.prototype.destroy=function(){this.bands.forEach(function(t){t.disconnect()}),this.bands=null,this.bandsMap=null},e.F32=32,e.F64=64,e.F125=125,e.F250=250,e.F500=500,e.F1K=1e3,e.F2K=2e3,e.F4K=4e3,e.F8K=8e3,e.F16K=16e3,e}(M),DistortionFilter:function(n){function e(t){t===void 0&&(t=0);var r=this;if(!u().useLegacy){var o=u().context.audioContext.createWaveShaper();return(r=n.call(this,o)||this)._distortion=o,r.amount=t,r}r=n.call(this,null)||this}return c(e,n),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t;for(var r,o=1e3*t,D=44100,N=new Float32Array(D),k=Math.PI/180,B=0;B<D;++B)r=2*B/D-1,N[B]=(3+o)*r*20*k/(Math.PI+o*Math.abs(r));this._distortion.curve=N,this._distortion.oversample="4x"},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._distortion=null,n.prototype.destroy.call(this)},e}(M),StereoFilter:function(n){function e(t){t===void 0&&(t=0);var r=this;if(!u().useLegacy){var o,D,N,k=u().context.audioContext;return k.createStereoPanner?N=o=k.createStereoPanner():((D=k.createPanner()).panningModel="equalpower",N=D),(r=n.call(this,N)||this)._stereo=o,r._panner=D,r.pan=t,r}r=n.call(this,null)||this}return c(e,n),Object.defineProperty(e.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._stereo?x.setParamValue(this._stereo.pan,t):this._panner.setPosition(t,0,1-Math.abs(t))},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){n.prototype.destroy.call(this),this._stereo=null,this._panner=null},e}(M),ReverbFilter:function(n){function e(t,r,o){t===void 0&&(t=3),r===void 0&&(r=2),o===void 0&&(o=!1);var D=this;if(!u().useLegacy)return(D=n.call(this,null)||this)._seconds=D._clamp(t,1,50),D._decay=D._clamp(r,0,100),D._reverse=o,D._rebuild(),D;D=n.call(this,null)||this}return c(e,n),e.prototype._clamp=function(t,r,o){return Math.min(o,Math.max(r,t))},Object.defineProperty(e.prototype,"seconds",{get:function(){return this._seconds},set:function(t){this._seconds=this._clamp(t,1,50),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"decay",{get:function(){return this._decay},set:function(t){this._decay=this._clamp(t,0,100),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this._reverse},set:function(t){this._reverse=t,this._rebuild()},enumerable:!1,configurable:!0}),e.prototype._rebuild=function(){for(var t,r=u().context.audioContext,o=r.sampleRate,D=o*this._seconds,N=r.createBuffer(2,D,o),k=N.getChannelData(0),B=N.getChannelData(1),G=0;G<D;G++)t=this._reverse?D-G:G,k[G]=(2*Math.random()-1)*Math.pow(1-t/D,this._decay),B[G]=(2*Math.random()-1)*Math.pow(1-t/D,this._decay);var U=u().context.audioContext.createConvolver();U.buffer=N,this.init(U)},e}(M),MonoFilter:function(n){function e(){var t=this;if(!u().useLegacy){var r=u().context.audioContext,o=r.createChannelSplitter(),D=r.createChannelMerger();return D.connect(o),(t=n.call(this,D,o)||this)._merger=D,t}t=n.call(this,null)||this}return c(e,n),e.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,n.prototype.destroy.call(this)},e}(M),StreamFilter:function(n){function e(){var t=this;if(!u().useLegacy){var r=u().context.audioContext,o=r.createMediaStreamDestination(),D=r.createMediaStreamSource(o.stream);return(t=n.call(this,o,D)||this)._stream=o.stream,t}t=n.call(this,null)||this}return c(e,n),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._stream=null,n.prototype.destroy.call(this)},e}(M),TelephoneFilter:function(n){function e(){if(!u().useLegacy){var t=u().context.audioContext,r=t.createBiquadFilter(),o=t.createBiquadFilter(),D=t.createBiquadFilter(),N=t.createBiquadFilter();return r.type="lowpass",x.setParamValue(r.frequency,2e3),o.type="lowpass",x.setParamValue(o.frequency,2e3),D.type="highpass",x.setParamValue(D.frequency,500),N.type="highpass",x.setParamValue(N.frequency,500),r.connect(o),o.connect(D),D.connect(N),n.call(this,r,N)||this}n.call(this,null)}return c(e,n),e}(M)},I={__proto__:null,supported:h},R=function(n){return s=n,n}(new S);extensions.add(m);class SndInf{constructor(e,t,r,o,D,N,k,B){this.fn=e,this.buf=t,this.start_ms=r,this.end_ms=o,this.ret_ms=D,this.volume=N,this.pan=k,this.snd=B,this.stt=B?new SsPlaying(this):new SsLoading,this.#e=Reading.procID,B&&this.addSnd(B)}static#t=1;stt;loop=!1;#e;get procID(){return this.#e}addSnd(e){switch(this.loop=e.loop,this.stt.onLoad(this),this.pan!==0&&(e.filters=[new T.StereoFilter(this.pan)]),this.setVol=t=>e.volume=t,this.tw=()=>new Tween(e),this.onPlayEnd=()=>{this.stt.onPlayEnd(this.buf),this.#r()},this.stop=()=>{e.stop(),this.#r()},this.destroy=()=>e.destroy(),this.buf){case BUF_VOICE:const t=Number(val.getVal("sys:sn.sound.BGM.vol_mul_talking")??1);if(t===1)break;SndInf.#t=t;const r=hSndBuf[BUF_BGM];r&&r.setVol(this.volume*SndInf.#t);break;case BUF_BGM:e.volume=this.volume*SndInf.#t;break}}#r=()=>{if(this.#r=()=>{},SndInf.#t===1||this.buf!==BUF_VOICE)return;SndInf.#t=1;const e=hSndBuf[BUF_BGM];e&&e.setVol(this.volume*SndInf.#t)};setVol(e){}tw(){}onPlayEnd(){}stop(){}destroy(){}}let cfg,val,main$2,sys,hSndBuf,evtMng;const BUF_BGM="BGM",BUF_SE="SE",BUF_VOICE="VOICE";class SndBuf{constructor(e,t,r){this.hArg=e,this.buf=t,this.fn=r;const o=argChk_Num(e,"start_ms",0),D=argChk_Num(e,"end_ms",SndBuf.#e),N=argChk_Num(e,"ret_ms",0),k=argChk_Num(e,"pan",0),B=argChk_Num(e,"speed",1);if(o<0)throw`[playse] start_ms:${o} が負の値です`;if(N<0)throw`[playse] ret_ms:${N} が負の値です`;if(0<D){if(D<=o)throw`[playse] start_ms:${o} >= end_ms:${D} は異常値です`;if(D<=N)throw`[playse] ret_ms:${N} >= end_ms:${D} は異常値です`}const G="const.sn.sound."+t+".";val.setVal_Nochk("save",G+"fn",r);const U=SndBuf.getVol(e,1);val.setVal_Nochk("save",G+"volume",U);const H=U*Number(val.getVal("sys:"+G+"volume",1)),$=argChk_Boolean(e,"loop",!1);$?(SndBuf.#t[t]=r,val.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(SndBuf.#t))):SndBuf.delLoopPlay(t),val.setVal_Nochk("save",G+"start_ms",o),val.setVal_Nochk("save",G+"end_ms",D),val.setVal_Nochk("save",G+"ret_ms",N),val.setVal_Nochk("tmp",G+"playing",!0),val.flush();const V=R.find(r);this.#r=new SndInf(r,t,o,D,N,H,k,V);const Y={loop:$,speed:B,volume:H,loaded:(z,W)=>{if(!this.#r.stt.isDestroy){if(z){main$2.errScript(`ロード失敗です SndBuf fn:${r} ${z}`,!1);return}W&&(this.#r.addSnd(W),k!==0&&(W.filters=[new T.StereoFilter(k)]),e.fnc?.())}}};let X="";if(0<o||D<SndBuf.#e){X=`${r};${o};${D};${N}`;const z=(Y.sprites??={})[X]={start:o/1e3,end:D/1e3};Y.preload=!0;const W=Y.loaded;Y.loaded=(q,K)=>{if(this.#r.stt.isDestroy)return;W(q,K);const Q=K,Z=Q.duration;z.end<0&&(z.end+=Z,Q.removeSprites(X),Q.addSprites(X,z)),z.end<=z.start&&main$2.errScript(`[playse] end_ms:${D}(${z.end*1e3}) >= start_ms:${o} は異常値です`),z.end*1e3<=N&&main$2.errScript(`[playse] end_ms:${D}(${z.end*1e3}) <= ret_ms:${N} は異常値です`),Z<=z.start&&main$2.errScript(`[playse] 音声ファイル再生時間:${Z*1e3} <= start_ms:${o} は異常値です`),D!==SndBuf.#e&&Z<=z.end&&main$2.errScript(`[playse] 音声ファイル再生時間:${Z*1e3} <= end_ms:${D} は異常値です`),Q.play(X,ee=>Y.complete?.(ee))}}else Y.autoPlay=!0;if($?N!==0&&(Y.loop=!1,Y.complete=async z=>{const W=z.duration,q=N/1e3,K=D/1e3;W<=q&&main$2.errScript(`[playse] 音声ファイル再生時間:${W*1e3} <=  ret_ms:${N} は異常値です`),await z.play({...Y,start:q,end:K<0?K+W:K,loop:!0,filters:k!==0?[new T.StereoFilter(k)]:[]})}):Y.complete=()=>{stop2var(this.#r,t),this.#r.onPlayEnd()},this.#s(),V){if(V.volume=H,X)this.#i(r,Y);else if(V.isPlayable){const z=V.options.source;!(z instanceof ArrayBuffer)||z.byteLength===0?V.play(Y):this.#r.addSnd(E.from({...Y,url:V.options.url,source:z}))}k!==0&&(V.filters=[new T.StereoFilter(k)]),this.needLoad=!1;return}if(this.needLoad=argChk_Boolean(e,"join",!0)){const z=this.#r.procID+`loaded buf:${t} fn:${r}`;Reading.beginProc(z);const W=Y.loaded;Y.loaded=(q,K)=>{W(q,K),Reading.endProc(z)}}this.#i(r,Y)}static#t={};static init(e,t,r,o,D){SndBuf.#t={},cfg=e,val=t,main$2=r,sys=o,hSndBuf=D}static setEvtMng(e){evtMng=e}static delLoopPlay(e){delete SndBuf.#t[e];const t="const.sn.sound."+e+".";val.setVal_Nochk("save",t+"fn",""),val.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(SndBuf.#t)),val.flush()}static getVol(e,t){const r=argChk_Num(e,"volume",t);return r<0?0:r>1?1:r}static xchgbuf({buf:e=BUF_SE,buf2:t=BUF_SE}){if(e===t)throw`[xchgbuf] buf:${e} が同じ値です`;const r="const.sn.sound."+e+".",o=Number(val.getVal("save:"+r+"volume")),D=String(val.getVal("save:"+r+"fn")),N="const.sn.sound."+t+".",k=Number(val.getVal("save:"+N+"volume")),B=String(val.getVal("save:"+N+"fn"));val.setVal_Nochk("save",r+"volume",k),val.setVal_Nochk("save",N+"volume",o),val.setVal_Nochk("save",r+"fn",B),val.setVal_Nochk("save",N+"fn",D),e in SndBuf.#t!=t in SndBuf.#t&&(e in SndBuf.#t?(delete SndBuf.#t[e],SndBuf.#t[t]=D):(delete SndBuf.#t[t],SndBuf.#t[e]=B),val.setVal_Nochk("save","const.sn.loopPlaying",JSON.stringify(SndBuf.#t))),val.flush()}static#e=999e3;#r;needLoad;#s=()=>{R.volumeAll=Number(val.getVal("sys:sn.sound.global_volume",1)),this.#s=()=>{}};#i(e,t){const r=cfg.searchPath(e,SEARCH_PATH_ARG_EXT.SOUND);if(!r.endsWith(".bin")){t.url=r,E.from(t);return}new Loader().add({name:e,url:r,xhrType:LoaderResource.XHR_RESPONSE_TYPE.BUFFER}).use(async(o,D)=>{try{o.data=await sys.decAB(o.data)}catch(N){main$2.errScript(`Sound ロード失敗ですc fn:${o.name} ${N}`,!1)}D()}).load((o,D)=>{t.source=D[e]?.data,E.from(t)})}setVol(e){this.#r.setVol(e)}ws=e=>this.#r.stt.ws(this.#r,e);stopse({buf:e=BUF_SE}){stop2var(this.#r,e),this.#r.stt.stopse(this.#r)}fade=e=>this.#r.stt.fade(this.#r,e);wf=e=>this.#r.stt.wf(this.#r,e);stopfadese=e=>this.#r.stt.stopfadese(this.#r,e)}function stop2var({loop:n},e){if(n){SndBuf.delLoopPlay(e);return}const t="const.sn.sound."+e+".";val.setVal_Nochk("tmp",t+"playing",!1),val.flush()}class SsLoading{onLoad(e){e.stt=new SsPlaying(e)}stopse(e){e.stt=new SsStop(e,!1)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class SsPlaying{constructor(e){this.si=e}onLoad(){}stopse(e){e.stt=new SsStop(e)}ws(e,t){if(e.loop)return!1;e.stt=new SsWaitingStop(e);const r=argChk_Boolean(t,"canskip",!1),o=argChk_Boolean(t,"stop",!0);if(r&&evtMng.isSkipping)return o?e.stt.stopse(e):e.stt.onPlayEnd=()=>{},!1;const{buf:D=BUF_SE}=t,N=()=>{stop2var(e,D),e.onPlayEnd(),o?e.stt.stopse(e):e.stt.onPlayEnd=()=>{}};return Reading.beginProc(e.procID+"ws",N,!0,r?N:void 0),!0}onPlayEnd(){}fade(e,t){const{buf:r=BUF_SE}=t,o="const.sn.sound."+r+".volume",D=SndBuf.getVol(t,NaN);val.setVal_Nochk("save",o,D);const N=D*Number(val.getVal("sys:"+o,1)),k=argChk_Boolean(t,"stop",D===0);k&&SndBuf.delLoopPlay(r),val.flush();const B=argChk_Num(t,"time",NaN),G=argChk_Num(t,"delay",0);if(B===0&&G===0||evtMng.isSkipping){e.setVol(N),e.stt=k?new SsStop(e):new SsPlaying(e);return}const U=e.tw();U&&(CmnTween.setTwProp(U,t).to({volume:N},B).onComplete(()=>{remove(U),e.stt.compFade(r),e.stt=k?new SsStop(e):new SsPlaying(e)}).start(),e.stt=new SsFade(U,e))}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class SsWaitingStop{constructor(e){this.si=e}onLoad(){}stopse(e){e.stt=new SsStop(e)}ws=()=>!1;onPlayEnd(){Reading.notifyEndProc(this.si.procID+"ws")}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!1}class SsFade{constructor(e,t){this.tw=e,this.si=t}onLoad(){}stopse(e){this.stopfadese(),e.stt=new SsStop(e)}ws=()=>!1;onPlayEnd(){}fade(){}wf(e,t){e.stt=new SsWaitingFade(e);const r=argChk_Boolean(t,"canskip",!1);if(r&&evtMng.isSkipping)return this.stopfadese(),!1;const o=()=>this.stopfadese();return Reading.beginProc(e.procID+"wf",o,!0,r?o:void 0),!0}compFade(){}stopfadese=()=>this.si.stop();isDestroy=!1}class SsWaitingFade{constructor(e){this.si=e}onLoad(){}stopse(e){this.stopfadese(),e.stt=new SsStop(e)}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){Reading.notifyEndProc(this.si.procID+"wf")}stopfadese=()=>this.si.stop();isDestroy=!1}class SsStop{constructor(e,t=!0){this.si=e,this.stop=t,t&&(e.stop(),e.loop&&(e.destroy(),e.destroy=()=>{}))}onLoad(){}stopse(){}ws=()=>!1;onPlayEnd(){}fade(){}wf=()=>!1;compFade(){}stopfadese(){}isDestroy=!0}const RPN_COMP_CHIN="compChIn";class ScriptIterator{constructor(e,t,r,o,D,N,k){this.cfg=e,this.hTag=t,this.main=r,this.val=o,this.prpPrs=D,this.sndMng=N,this.sys=k,t.let_ml=G=>this.#U(G),t.endlet_ml=()=>!1,t.dump_stack=()=>this.#b(),t.dump_script=G=>this.#M(G),t.else=t.elsif=t.endif=()=>this.#Q(),t.if=G=>this.#z(G),t.call=G=>this.#X(G),t.jump=G=>this.#F(G),t.pop_stack=G=>this.#E(G),t.return=G=>this.#ee(G),t.bracket2macro=G=>this.#pe(G),t.char2macro=G=>this.#ge(G),t.endmacro=G=>this.#ee(G),t.macro=G=>this.#be(G),t.load=G=>this.#xe(G),t.reload_script=G=>this.#Te(G),t.record_place=()=>this.#ye(),t.save=G=>this.#Ee(G),e.oCfg.debug.token&&(this.#B=G=>{G.trim()!==""&&console.log(`🌱 トークン ${this.#e}:${this.#s} (i:${this.#r} cs:${this.#i.length}) %c【${G}】`,"background-color:#350;")}),e.oCfg.debug.tag&&(this.#G=G=>console.log(`🌲 タグ解析 ${this.#e}:${this.#s} (i:${this.#r} cs:${this.#i.length}) %c[${G} %o]`,"background-color:#30B;",this.#h.hPrm)),o.defTmp("const.sn.aIfStk.length",()=>this.#w.length),o.defTmp("const.sn.vctCallStk.length",()=>this.#i.length),this.#a=new Grammar(e);const B=e.oCfg.init.escape;if(this.#a.setEscape(B),RubySpliter.setEscape(B),CmnLib.isDbg){k.addHook((U,H)=>this.#l[U]?.(H)),this.isBreak=this.#o;const G=this.analyzeInit;this.analyzeInit=()=>{this.analyzeInit=()=>{},this.sys.send2Dbg("hi",{})},this.#l.auth=U=>{const H=U.hBreakpoint.hFn2hLineBP;for(const[$,V]of Object.entries(H))this.#d($,V);ScriptIterator.#v={};for(const $ of U.hBreakpoint.aFunc)ScriptIterator.#v[$.name]=1;if(U.stopOnEntry){for(;;){let $=this.nextToken();if(!$)break;const V=$.charCodeAt(0);if(V===91||V===38||V===42&&$.length===1)break;V===10&&(this.#s+=$.length)}this.sys.callHook("stopOnEntry",{}),this.analyzeInit=G,this.analyzeInit()}else this.noticeWait=()=>{this.noticeWait=()=>{},this.sys.callHook("stopOnEntry",{})},this.analyzeInit=G,this.analyzeInit()}}else this.recodeDesign=()=>{}}#t={aToken:[""],len:1,aLNum:[1]};#e="";get scriptFn(){return this.#e}#r=0;get idxToken(){return this.#r}subIdxToken(){--this.#r}#s=0;get lineNum(){return this.#s}addLineNum=e=>this.#s+=e;jumpJustBefore(){this.#C(this.#e,"",--this.#r)}#i=[];#a;#h=new AnalyzeTagArg;noticeWait=()=>{};#d(e,t){ScriptIterator.#A[this.#c(e)]=t}destroy(){this.isBreak=this.#ye=()=>!1}#l={disconnect:()=>{ScriptIterator.#A={},ScriptIterator.#v={},this.isBreak=()=>!1,this.#l.continue({}),this.#_=0},restart:()=>this.isBreak=()=>!1,add_break:e=>this.#d(e.fn,e.o),data_break:e=>{this.#_===0&&(this.#_=1,this.main.setLoop(!1,`変数 ${e.dataId}【${e.old_v}】→【${e.new_v}】データブレーク`),this.sys.callHook("stopOnDataBreakpoint",{}),this.sys.send2Dbg("stopOnDataBreakpoint",{}))},set_func_break:e=>{ScriptIterator.#v={};for(const t of e.a)ScriptIterator.#v[t.name]=1;this.sys.send2Dbg(e.ri,{})},stack:e=>this.sys.send2Dbg(e.ri,{a:this.#D()}),eval:e=>{this.sys.send2Dbg(e.ri,{v:this.prpPrs.parse(e.txt)})},continue:()=>{this.#u()||(this.#r-=this.#y,this.#_=3,this.main.setLoop(!0),this.main.resume())},stepover:e=>this.#g(e),stepin:()=>{if(this.#u())return;const e=this.#t.aToken[this.#r-this.#y];this.sys.callHook(`stopOnStep${this.#me.test(e??"")?"In":""}`,{}),this.#r-=this.#y,this.#_=this.#_===1?4:5,this.main.setLoop(!0),this.main.resume()},stepout:e=>{this.#u()||(this.#i.length>0?this.#m(!0):this.#g(e))},pause:()=>{this.#_=4,this.main.setLoop(!1,"一時停止"),this.sys.send2Dbg("stopOnStep",{})},stopOnEntry:()=>{this.#_=4,this.main.setLoop(!1,"一時停止"),this.sys.send2Dbg("stopOnEntry",{})}};#f=e=>this.cfg.searchPath(e,SEARCH_PATH_ARG_EXT.SCRIPT);static#n=/(.+)\/crypto_prj\/([^\/]+)\/[^\.]+(\.\w+)/;#c=e=>(this.sys.pathBaseCnvSnPath4Dbg+this.#f(e)).replace(ScriptIterator.#n,`$1/prj/$2/${this.#e}$3`);cnvPath4Dbg=e=>this.sys.pathBaseCnvSnPath4Dbg+e.replace("/crypto_prj/","/prj/");#g(e){if(this.#u())return;const t=this.#t.aToken[this.#r-this.#y];this.#me.test(t??"")?this.#m(!1):(this.sys.callHook("stopOnStep",{}),this.#l.stepin(e))}#m(e){this.sys.callHook(`stopOnStep${e?"Out":""}`,{}),this.#p=this.#i.length-(e?1:0),this.#r-=this.#y,this.#_=e?7:6,this.main.setLoop(!0),this.main.resume()}#p=0;get#y(){return this.#_===2||this.#_===4?1:0}#u(){return this.#r<this.#t.len?!1:(this.sys.callHook("stopOnEntry",{}),this.main.setLoop(!1,"スクリプト終端です isIdxOverLast"),!0)}static#A={};static#v={};#_=0;isBreak=e=>!1;#o(e){switch(this.#_){case 6:this.#x(),this.#_=7;break;case 7:if(this.#i.length!==this.#p)break;return this.#_=4,this.main.setLoop(!1,"ステップ実行"),this.sys.send2Dbg("stopOnStep",{}),!0;case 5:this.#x(),this.#_=4;break;case 4:return this.#x(),this.main.setLoop(!1,"ステップ実行"),this.sys.send2Dbg("stopOnStep",{}),!0;case 3:this.#x(),this.#_=0;break;default:if(tagToken2Name(e)in ScriptIterator.#v)return this.#_=2,this.main.setLoop(!1,`関数 ${e} ブレーク`),this.sys.callHook("stopOnBreakpoint",{}),this.sys.send2Dbg("stopOnBreakpoint",{}),!0;{const t=ScriptIterator.#A[this.#c(this.#e)];if(!t)break;const r=t[this.#s];if(!r)break;if(r.condition){if(!this.prpPrs.parse(r.condition))break}else if("hitCondition"in r&&--r.hitCondition>0)break;const o=this.#_===0;this.#_=2,this.main.setLoop(!1,o?(r.condition?"条件":"ヒットカウント")+"ブレーク":"ステップ実行");const D=o?"stopOnBreakpoint":"stopOnStep";this.sys.callHook(D,{}),this.sys.send2Dbg(D,{})}return!0}return!1}#x(){const e=ScriptIterator.#A[getFn(this.#e)]?.[this.#s];e?.hitCondition&&--e.hitCondition}#D(){const e=this.#_===3?1:0,t=this.#t.aToken[this.#r-1+e],r=this.#c(this.#e),o=tagToken2Name(t),D=o?`[${o}]`:t,N=this.val.getVal("mp:const.sn.macro")??"{}";if(this.#r===0)return[{fn:r,ln:1,col:1,nm:D,ma:N}];const k=this.#P(this.#t,this.#r),B=[{fn:r,ln:k.ln,col:k.col_s+1,nm:D,ma:N}],G=this.#i.length;if(G===0)return B;for(let U=G-1;U>=0;--U){const H=this.#i[U],$=this.#j[H.fn];if(!$)continue;const V=$.aToken[H.idx-1];if(!V)continue;const Y=this.#P($,H.idx),X=tagToken2Name(V);B.push({fn:this.#c(H.fn),ln:Y.ln,col:Y.col_s+1,nm:X?`[${X}]`:V,ma:H.csArg[":hMp"]["const.sn.macro"]??"{}"})}return B}#G=e=>{};async タグ解析(e,t){const r=this.hTag[e];if(!r)throw`未定義のタグ【${e}】です`;this.#h.parse(t),this.#G(e);const o=this.#h.hPrm;if(o.cond){const G=o.cond.val;if(!G||G.startsWith("&"))throw"属性condは「&」が不要です";const U=this.prpPrs.parse(G),H=String(U);if(H==="null"||H==="undefined"||!U)return!1}let D={};const N=this.#i.length,k=N===0?{}:this.#i[N-1].csArg;if(this.#h.isKomeParam){if(N===0)throw"属性「*」はマクロのみ有効です";D={...k}}D[":タグ名"]=e;for(const[G,{val:U,def:H}]of Object.entries(o)){let $=U;if($?.startsWith("%")){if(N===0)throw"属性「%」はマクロ定義内でのみ使用できます（そのマクロの引数を示す簡略文法であるため）";const V=k[$.slice(1)];if(V){D[G]=V;continue}if(H===void 0||H==="null")continue;$=H}if($=this.prpPrs.getValAmpersand($??""),$!=="undefined"){D[G]=$;continue}H!==void 0&&($=this.prpPrs.getValAmpersand(H),$!=="undefined"&&(D[G]=$))}if(Reading.needGoTxt&&this.#Y.has(e)){const{promise:G,resolve:U}=Promise.withResolvers();Reading.beginProc(RPN_COMP_CHIN,U,!1,U),Reading.goTxt(),this.val.saveKidoku(),await G}this.#$.has(e)&&(this.#O.hideHint(),await CmnTween.closeTrans());const B=this.#H[e];return B&&argChk_Boolean(D,"canskip",this.#q[e]??!0)&&this.#O.isSkipping?B(o):r(D)}#Y=new Set(["trans","wt","wait_tsy","wv","l","p","s","wait","waitclick","wb","wf","wl","ws","quake","wq"]);#$=new Set(["finish_trans","trans","quake","stop_quake","add_filter"]);#H={wt:()=>!1,wait_tsy:e=>this.hTag.stop_tsy(e),wait:()=>!1,wb:()=>this.hTag.stopfadese({buf:BUF_BGM}),wf:e=>this.hTag.stopfadese(e),wq:()=>this.hTag.stop_quake({}),quake:()=>!1};#q={wt:!0,wait_tsy:!0,wv:!0,wait:!0,playbgm:!1,playse:!0,wb:!1,wf:!1,ws:!1,wq:!0};#O;#S;setOtherObj(e,t){this.#O=e,this.#S=t}#U(e){const{name:t}=e;if(!t)throw"nameは必須です";let r="";const o=this.#t.len;for(;this.#r<o&&(r=this.#t.aToken[this.#r],r==="");++this.#r);return e.text=r,e.cast="str",this.hTag.let(e),this.#r+=2,this.#s+=(r.match(/\n/g)??[]).length,!1}#b(){if(this.#r===0)return console.group(`🥟 [dump_stack] スクリプト現在地 fn:${this.#e} line:1 col:0`),console.groupEnd(),!1;const e=this.#P(this.#t,this.#r),t=`スクリプト現在地 fn:${this.#e} line:${e.ln} col:${e.col_s+1}`;console.group(`🥟 [dump_stack] ${t}`);const r=this.#i.length;if(r>0){console.info(t);for(let o=r-1;o>=0;--o){const D=this.#i[o],N=D.csArg[":hMp"],k=N?N[":タグ名"]:void 0,B=D.csArg[":タグ名"]??"",G=this.#P(this.#j[D.fn],D.idx);console.info(`${r-o}つ前のコール元 fn:${D.fn} line:${G.ln} col:${G.col_s+1}`+(k?"（["+k+"]マクロ内）":" ")+`で [${B} ...]をコール`)}}return console.groupEnd(),!1}#P(e,t){const r={ln:1,col_s:0,col_e:0};if(!e)return r;let o=t-1;const D=r.ln=e.aLNum[o];for(;e.aLNum[o]===D;){if(!e.aToken[o].startsWith(`
`)){const N=e.aToken[o].length;r.col_e>0&&(r.col_s+=N),r.col_e+=N}if(--o<0)break}return r}#M(e){const{set_fnc:t,break_fnc:r}=e;if(!t)throw"set_fncは必須です";if(this.#R=globalThis[t],!this.#R){if(argChk_Boolean(e,"need_err",!0))throw`HTML内に関数${t}が見つかりません`;return this.#R=()=>{},!1}if(this.noticeBreak=o=>{this.#L!==this.#e&&(this.#L=this.#e,this.#R(this.#re[this.#e]??=this.#t.aToken.join(""))),this.#T(this.#s,o)},this.noticeBreak(!0),!r)return!1;if(this.#T=globalThis[r],!this.#T){if(argChk_Boolean(e,"need_err",!0))throw`HTML内に関数${r}が見つかりません`;this.#T=()=>{}}return!1}#R=()=>{};#T=()=>{};#L="";#re={};noticeBreak=e=>{};#N=5;dumpErrForeLine(){if(this.#r===0){console.group(`🥟 Error line (from 0 rows before) fn:${this.#e}`),console.groupEnd();return}let e="";for(let N=this.#r-1;N>=0&&(e=this.#t.aToken[N]+e,!((e.match(/\n/g)??[]).length>=this.#N));--N);const t=e.split(`
`).slice(-this.#N),r=t.length;console.group(`🥟 Error line (from ${r} rows before) fn:${this.#e}`);const o=String(this.#s).length,D=this.#P(this.#t,this.#r);for(let N=0;N<r;++N){const k=this.#s-r+N+1,B=`${String(k).padStart(o," ")}: %c`,G=t[N],U=G.length>75?G.slice(0,75)+"…":G;N===r-1?console.info(B+U.slice(0,D.col_s)+"%c"+U.slice(D.col_s),"color: black; background-color: skyblue;","color: black; background-color: pink;"):console.info(B+U,"color: black; background-color: skyblue;")}console.groupEnd()}#w=[-1];#Q(){const e=this.#w[0];if(!e)throw"this.#aIfStk が異常です";if(e===-1)throw"ifブロック内ではありません";return this.#r=e,this.#w.shift(),!1}#z(e){const{exp:t}=e;if(!t)throw"expは必須です";if(t.startsWith("&"))throw"属性expは「&」が不要です";let r=0,o=this.prpPrs.parse(t)?this.#r:-1;const D=this.#t.aLNum[this.#r];let N=this.#s-(D||0);const k=this.#t.len;for(;this.#r<k;++this.#r){const B=this.#t.aLNum[this.#r];this.#t.aLNum[this.#r]=(B||0)+N;const G=this.#t.aToken[this.#r];if(!G)continue;const U=G.charCodeAt(0);if(U===10){this.#s+=G.length;continue}if(U!==91)continue;const[H,$]=tagToken2Name_Args(G);if(!(H in this.hTag))throw`未定義のタグ[${H}]です`;switch(this.#h.parse($),H){case"if":++r;break;case"elsif":if(r>0||o>-1)break;const V=this.#h.hPrm.exp?.val;if(!V)throw"expは必須です";if(V.startsWith("&"))throw"属性expは「&」が不要です";this.prpPrs.parse(V)&&(o=this.#r+1);break;case"else":if(r>0)break;o===-1&&(o=this.#r+1);break;case"endif":if(r>0){--r;break}return o===-1?(++this.#r,this.#t.aLNum[this.#r]+=N):(this.#w.unshift(this.#r+1),this.#r=o,this.#s=this.#t.aLNum[this.#r]),!1}}throw"[endif]がないままスクリプト終端です"}#X(e){argChk_Boolean(e,"count",!1)||this.#oe();const{fn:t}=e;return t&&this.#f(t),this.#k({...e,":hEvt1Time":ReadingState.popLocalEvts()}),argChk_Boolean(e,"clear_local_event",!1)&&this.hTag.clear_event({}),this.#C(t,e.label)}#k(e){const t={...e,":hMp":this.val.cloneMp(),":lenIfStk":this.#w.length};this.#t.aLNum[this.#r]=this.#s,this.#Z||(t[":resvToken"]="",this.#K()),this.#i.push(new CallStack(this.#e,this.#r,t)),this.#w.unshift(-1)}#F(e){return argChk_Boolean(e,"count",!0)||this.#oe(),this.#w[0]=-1,this.#C(e.fn,e.label)}#E(e){if(argChk_Boolean(e,"clear",!1))this.#i=[];else if(!this.#i.pop())throw"スタックが空です";return this.#K(),this.#w=[-1],this.val.setMp({}),!1}#ee(e){const t=this.#i.pop();if(!t)throw"スタックが空です";const r=t.csArg;this.#w=this.#w.slice(-r[":lenIfStk"]);const o=r[":hMp"];o&&this.val.setMp(o);const D=r[":resvToken"];D?this.nextToken=()=>(this.#K(),D):this.#K(),r[":hEvt1Time"]&&ReadingState.pushLocalEvts(r[":hEvt1Time"]);const{fn:N,label:k}=e;return N||k?this.#C(N,k):t.fn in this.#j?(this.#se(t),!1):this.#C(t.fn,"",t.idx)}#Z="";#K(){this.#Z="",this.nextToken=this.#V}#I="";#C(e="",t="",r=0){if(CmnLib.debugLog&&console.log(`📜 %c1:jumpWork%c fn:${e} lbl:${t} idx:${r}`,"color:#3B0;",""),!e&&!t&&this.main.errScript("[jump系] fnまたはlabelは必須です"),t?(t.startsWith("*")||this.main.errScript("[jump系] labelは*で始まります"),this.#I=t,this.#I.startsWith("**")||(this.#r=r)):(this.#I="",this.#r=r),!e)return this.analyzeInit(),!1;if(e.includes("@"))throw"[jump系] fn には文字「@」は禁止です";const o=this.#f(e);if(e===this.#e)return this.analyzeInit(),!1;this.#e=e;const D=this.#j[e];if(D)return this.#t=D,this.analyzeInit(),!1;const N=`jumpWork fn:${e}`;Reading.beginProc(N);let k="";const B=new Loader;try{k=this.#f(e+"@"),B.add({name:e+":base",url:o}),B.add({name:e,url:k})}catch{B.add({name:e,url:o})}return B.use(async(G,U)=>{try{G.data=await this.sys.dec(G.extension,G.data)}catch(H){this.main.errScript(`[jump系]snロード失敗です fn:${G.name} ${H}`,!1)}U()}).load((G,U)=>{if(Reading.endProc(N),k){const H=U[e+":base"].data,$=U[e].data,V=H.split(`
`),Y=$.split(`
`),X=V.length,z=Y.length;for(let W=0;W<z&&W<X;++W)Y[W]||=V[W];U[e].data=Y.join(`
`),delete U[e+":base"]}this.nextToken=this.#V,this.#s=1,this.#ue(U[e].data),this.hTag.record_place({}),this.analyzeInit()}),!0}analyzeInit(){CmnLib.debugLog&&console.log(`📜 %c9:analyzeInit%c fn:${this.#e} lbl:${this.#I} idx:${this.#r}`,"color:#3B0;","");const e=this.#le(this.#t,!!this.val.getVal("mp:const.sn.macro.name"),this.#s,this.#I,this.#r);this.#r=e.idx,this.#s=e.ln}nextToken=()=>"";#V(){if(this.#W())return"";this.#de(),this.#t.aLNum[this.#r]||=this.#s;const e=this.#t.aToken[this.#r];return this.#B(e),++this.#r,e}#B=e=>{};#W(){return this.#r<this.#t.len?!1:(this.main.errScript("スクリプト終端です errOverScr"),!0)}#ae=/(\*{2,})([^\|]*)/;#he=/^\[macro\s/;#ie=/^\[endmacro[\s\]]/;#le(e,t,r,o,D){const N=e.aToken.length;if(!o){if(this.#W())return{idx:D,ln:r};if(e.aLNum[D])r=e.aLNum[D];else{r=1;for(let U=0;U<D;++U){e.aLNum[U]||=r;const H=e.aToken[U];H.startsWith(`
`)?r+=H.length:r+=(H.match(/\n/g)??[]).length}e.aLNum[D]=r}return{idx:D,ln:r}}e.aLNum[0]=1;const k=o.match(this.#ae);if(k){o=k[1];let U=D;switch(k[2]){case"before":for(;e.aToken[--U]!==o;)U===0&&DebugMng.myTrace("[jump系 無名ラベルbefore] "+r+"行目以前で"+(t?"マクロ内に":"")+"ラベル【"+o+"】がありません","ET"),t&&e.aToken[U].search(this.#he)>-1&&DebugMng.myTrace("[jump系 無名ラベルbefore] マクロ内にラベル【"+o+"】がありません","ET");return{idx:U+1,ln:e.aLNum[U]};case"after":for(;e.aToken[++U]!==o;)U===N&&DebugMng.myTrace("[jump系 無名ラベルafter] "+r+"行目以後でマクロ内にラベル【"+o+"】がありません","ET"),e.aToken[U].search(this.#ie)>-1&&DebugMng.myTrace("[jump系 無名ラベルafter] "+r+"行目以後でマクロ内にラベル【"+o+"】がありません","ET");return{idx:U+1,ln:e.aLNum[U]};default:DebugMng.myTrace("[jump系] 無名ラベル指定【label="+o+"】が間違っています","ET")}}r=1;const B=new RegExp("^"+o.replaceAll("*","\\*")+"(?=\\s|;|\\[|\\||$)");let G=!1;for(let U=0;U<N;++U){e.aLNum[U]||=r;const H=e.aToken[U];if(G){this.#a.testTagEndLetml(H)?G=!1:r+=(H.match(/\n/g)??[]).length;continue}const $=H.charCodeAt(0);if($===10){r+=H.length;continue}if($===42){if(H.search(B)>-1)return{idx:U+1,ln:r};continue}$===91&&(r+=(H.match(/\n/g)??[]).length,this.#a.testTagLetml(H)&&(G=!0))}throw G?"[let_ml]の終端・[endlet_ml]がありません":(DebugMng.myTrace(`[jump系] ラベル【${o}】がありません`,"ET"),"Dummy")}#j=Object.create(null);#ue(e){let t="";try{t="ScriptIterator.resolveScript";const r=this.#a.resolveScript(e);t="ScriptIterator.replaceScript_Wildcard",this.#fe(r),this.#j[this.#e]=this.#t=r}catch(r){r instanceof Error?t+=`例外 mes=${r.message}(${r.name})`:t=String(r),this.main.errScript(t,!1)}this.val.touchAreaKidoku(this.#e)}#se(e){this.#e=e.fn,this.#r=e.idx;const t=this.#j[this.#e];t&&(this.#t=t),this.#s=this.#t.aLNum[e.idx]}#ne=/^\[(call|loadplugin)\s/;#ce=/\bfn\s*=\s*[^\s\]]+/;#fe(e){for(let t=e.len-1;t>=0;--t){const r=e.aToken[t];if(!this.#ne.test(r))continue;const[o,D]=tagToken2Name_Args(r);this.#h.parse(D);const N=this.#h.hPrm.fn;if(!N)continue;const{val:k}=N;if(!k||!k.endsWith("*"))continue;e.aToken.splice(t,1,"	","; "+r),e.aLNum.splice(t,1,NaN,NaN);const B=o==="loadplugin"?SEARCH_PATH_ARG_EXT.CSS:SEARCH_PATH_ARG_EXT.SN,G=this.cfg.matchPath("^"+k.slice(0,-1)+".*",B);for(const U of G){const H=r.replace(this.#ce,"fn="+decodeURIComponent(getFn(U[B])));e.aToken.splice(t,0,H),e.aLNum.splice(t,0,NaN)}}e.len=e.aToken.length}#de(){const e=this.val.touchAreaKidoku(this.#e);if(this.#i.length>0){e.record(this.#r);return}this.#J=e.search(this.#r),this.val.setVal_Nochk("tmp","const.sn.isKidoku",this.#J),!this.#J&&e.record(this.#r)}#J=!1;get isKidoku(){return this.#J}#oe(){this.val.getAreaKidoku(this.#e)?.erase(this.#r),this.#J=!1}get isNextKidoku(){let e=this.#e,t=this.#r,r=this.#t.len;if(this.#i.length>0){const D=this.#i[0];e=D.fn,t=D.idx;const N=this.#j[e];N&&(r=N.len)}const o=this.val.getAreaKidoku(e);return t===r?!1:o.search(t)}get normalWait(){return this.#J?this.val.tagCh_doWait_Kidoku?this.val.tagCh_msecWait_Kidoku:0:this.val.tagCh_doWait?this.val.tagCh_msecWait:0}#pe(e){return this.#a.bracket2macro(e,this.hTag,this.#t,this.#r),!1}#ge(e){return this.#a.char2macro(e,this.hTag,this.#t,this.#r),!1}#ve=/["'#;\\]　]+/;#be(e){const{name:t}=e;if(!t)throw"nameは必須です";if(t in this.hTag)throw`[${t}]はタグかすでに定義済みのマクロです`;if(this.#ve.test(t))throw`[${t}]はマクロ名として異常です`;const r=this.#s,o=new CallStack(this.#e,this.#r);for(this.#_e+="|"+t,this.#me=new RegExp(`\\[(${this.#_e})\\b`),this.hTag[t]=D=>(D.design_unit=e.design_unit,this.#k(D),this.val.setMp(D),this.val.setVal_Nochk("mp","const.sn.macro",JSON.stringify({name:e.name})),this.val.setVal_Nochk("mp","const.sn.me_call_scriptFn",this.#e),this.#s=r,this.#se(o),!1);this.#r<this.#t.len;++this.#r){this.#t.aLNum[this.#r]||=this.#s;const D=this.#t.aToken[this.#r];if(D.search(this.#ie)>-1)return++this.#r,!1;const N=D.charCodeAt(0);N===10?this.#s+=D.length:N===91&&(this.#s+=(D.match(/\n/g)??[]).length)}throw`マクロ[${t}]定義の終端・[endmacro]がありません`}#_e="call";#me=/\[(call)\b/;#xe(e){if("fn"in e!="label"in e)throw"fnとlabelはセットで指定して下さい";const t=argChk_Num(e,"place",0),r=this.val.getMark(t);return this.loadFromMark(e,r,2)}loadFromMark(e,t,r=0){this.hTag.clear_event({}),this.val.mark2save(t),this.val.setMp({}),this.#S.recPagebreak();let o=[];r!==1&&(o=this.sndMng.playLoopFromSaveObj(r===2)),argChk_Boolean(e,"do_rec",!0)&&(this.#te={hSave:this.val.cloneSave(),hPages:{...t.hPages},aIfStk:[...t.aIfStk]});const D={enabled:this.val.getVal("save:const.sn.autowc.enabled"),text:this.val.getVal("save:const.sn.autowc.text"),time:Number(this.val.getVal("save:const.sn.autowc.time"))};this.hTag.autowc(D),this.#w=[...this.#te.aIfStk],this.#i=[],CmnTween.stopAllTw();const N=Promise.allSettled([...o,...this.#S.playback(this.#te.hPages)]).then(()=>this.#S.cover(!1)).catch($=>console.error("loadFromMark e:%o",$)),{index:k,fn:B}=e;if(k)return CmnLib.debugLog&&console.log(`📜 %cloadFromMark index:${k} move!%c fn:${B}`,"color:#3B0;",""),N.then(()=>{this.#C(B,"",k)||this.main.resume()}),!0;this.#S.cover(!0);const G=String(this.val.getVal("save:const.sn.scriptFn")),U=Number(this.val.getVal("save:const.sn.scriptIdx"));delete this.#j[G];const{label:H}=e;return H?N.then(()=>{this.#e=G,this.#r=U,this.hTag.call({fn:B,label:H})||this.main.resume()}):N.then(()=>{this.#C(G,"",U)||this.main.resume()}),!0}#Te(e){const t=this.val.getMark(0);delete this.#j[getFn(t.hSave["const.sn.scriptFn"])];const r={};for(const o in this.#j)try{this.#f(o+"@")}catch{r[o]=this.#j[o]}return this.#j=r,e.do_rec=!1,this.loadFromMark(e,t,1)}#te={hSave:{},hPages:{},aIfStk:[-1]};#ye=()=>{const{fn:e,idx:t}=this.nowScrIdx();return this.val.setVal_Nochk("save","const.sn.scriptFn",e),this.val.setVal_Nochk("save","const.sn.scriptIdx",t),this.#te={hSave:this.val.cloneSave(),hPages:this.#S.record(),aIfStk:this.#w.slice(this.#i.length)},!1};nowScrIdx(){if(this.#i.length===0)return{fn:this.#e,idx:this.#r};const e=this.#i[0];return{fn:e.fn,idx:e.idx}}nowMark(){return{...this.#te}}nowScrFnLn(){const{fn:e,idx:t}=this.nowScrIdx(),r=this.#j[e],o=this.#P(r,t);return{fn:e,...o}}#Ee(e){if(!("place"in e))throw"placeは必須です";const t=Number(e.place);delete e[":タグ名"],delete e.place,e.text=e.text??"",this.#te.json=e,this.val.setMark(t,this.#te);const r=Number(this.val.getVal("sys:const.sn.save.place"));return t===r&&this.val.setVal_Nochk("sys","const.sn.save.place",r+1),!1}recodeDesign(e){let t="",r=0;const o=this.#i.length;if(e.design_unit&&o>0){const B=this.#i[0];t=B.fn,r=B.idx}else t=this.#e,r=this.#r;e[":path"]=this.#c(t);const D=this.#j[t],N=this.#P(D,r);e[":ln"]=N.ln,e[":col_s"]=N.col_s,e[":col_e"]=N.col_e;const k=r-1;e[":idx_tkn"]=k,e[":token"]=D.aToken[k],this.sys.send2Dbg("_recodeDesign",e)}replace(e,t){this.#t.aToken[e]=t}}const ScriptIterator$1=Object.freeze(Object.defineProperty({__proto__:null,RPN_COMP_CHIN,ScriptIterator},Symbol.toStringTag,{value:"Module"}));class TxtStage extends Container{constructor(e,t,r){super(),this.ctn=e,this.canFocus=t,this.sys=r,this.#i.classList.add("sn_tx"),this.#i.style.position="absolute",TxtStage.#e.view.parentElement.appendChild(this.#i),this.addChild(this.#a),this.addChild(this.#h),this.#h.name="grpDbgMasume";const o=CmnLib.debugLog?({ch:D,rect:{x:N,y:k,width:B,height:G}})=>console.log(`🍌 masume ch:${D} x:${N} y:${k} w:${B} h:${G}`):()=>{};this.#f=TxtStage.#t.oCfg.debug.masume?D=>{o(D);const{x:N,y:k,width:B,height:G}=D.rect;this.#h.beginFill(6737151,.5).lineStyle(2,16724736,1).drawRect(N,k,B,G).endFill()}:()=>{},this.noticeCompTxt=r.isApp&&TxtStage.#t.oCfg.debug.dumpHtm?()=>{Reading.notifyEndProc(RPN_COMP_CHIN);const D=this.#i.innerHTML;if(D==="")return;const{fn:N,ln:k}=TxtStage.#s.nowScrFnLn(),B=`dumpHtm ${e.name.slice(0,-7).replaceAll(":","=")}(fn=${N} line=${k})`;r.outputFile(r.path_downloads+B+".htm",`<!doctype html><html><head><meta charset=utf-8><title>${B}</title>
<h1>${B}</h1>${D.replaceAll(/ class="sn_ch"|animation-delay: \d+ms; ?| data-add="{&quot;ch_in_style&quot;:&quot;default&quot;, &quot;ch_out_style&quot;:&quot;default&quot;}"/g,"").replaceAll(' style=""',"").replaceAll(/(<\/?ruby>)/g,`
$1
`).replaceAll(/<(br|\/span)>/g,`<$1>
`)}`)}:()=>Reading.notifyEndProc(RPN_COMP_CHIN)}static#t;static#e;static init(e,t){TxtStage.#t=e,TxtStage.#e=t}static#r;static#s;static setEvtMng(e,t){TxtStage.#r=e,TxtStage.#s=t}static destroy(){TxtStage.#H=Object.create(null),TxtStage.#O=Object.create(null),TxtStage.delBreak()}#i=document.createElement("span");#a=new Container;#h=new Graphics;static#d={"background-color":0,"border-bottom-width":0,"border-left-width":0,"border-right-width":0,"border-top-width":0,"margin-bottom":0,"margin-left":0,"margin-right":0,"margin-top":0};#l=new Hyphenation;noticeCompTxt=()=>{};#f;#n={fontsize:24,$width:0,$height:0,pad_left:0,pad_right:0,pad_top:0,pad_bottom:0};lay(e){const t=this.#i.style;if("style"in e)if(e.style){const r=document.createElement("span");r.style.cssText=e.style;const o=r.style.length;for(let D=0;D<o;++D){const N=r.style[D];if(N in TxtStage.#d){DebugMng.myTrace(`${N}は指定できません`,"W");continue}t[N]=r.style[N]}!r.style.opacity&&"alpha"in e&&(t.opacity=String(this.ctn.alpha))}else this.#i.style.cssText="";else"alpha"in e&&(t.opacity=String(this.ctn.alpha));if("width"in e&&(t.width=(e.width??"0")+"px"),"height"in e&&(t.height=(e.height??"0")+"px"),"pl"in e&&(t.paddingLeft=(e.pl??"0")+"px"),"pr"in e&&(t.paddingRight=(e.pr??"0")+"px"),"pt"in e&&(t.paddingTop=(e.pt??"0")+"px"),"pb"in e&&(t.paddingBottom=(e.pb??"0")+"px"),this.#l.lay(e),this.#g(),this.#m=this.ctn.position.x,t.transformOrigin=`${this.ctn.pivot.x}px ${this.ctn.pivot.y}px`,this.cvsResize(),t.display=this.ctn.visible?"inline":"none",":redraw"in e&&this.#o>0){const r=[this.#i.innerHTML.replaceAll(/(animation-delay: )\d+ms/g,"$10ms"),`<span class='sn_ch' data-add='{"ch_in_style":"default"}'>&emsp;</span>`];this.#M(),this.goTxt(r,!0)}}#c=0;#g(){const e=this.#i.style,t=parseFloat(e.fontSize||"0");this.#n.fontsize=t,this.#n.pad_left=parseFloat(e.paddingLeft||"0"),this.#n.pad_right=parseFloat(e.paddingRight||"0"),this.#n.pad_top=parseFloat(e.paddingTop||"0"),this.#n.pad_bottom=parseFloat(e.paddingBottom||"0"),this.#n.$width=parseFloat(e.width||"0"),this.#n.$height=parseFloat(e.height||"0"),this.position.set(this.#n.pad_left,this.#n.pad_top),this.#p=e.writingMode==="vertical-rl",this.#y=0,this.#u=0;const r=e.lineHeight??"0";this.#c=this.#p?0:(r.endsWith("px")?parseFloat(r):t*parseFloat(r)-t)/2}cvsResize(){const e=this.#i.style,t=this.sys.cvsScale;e.left=`${this.sys.ofsLeft4elm+this.#m*t}px`,e.top=`${this.sys.ofsTop4elm+this.ctn.position.y*t}px`,e.transform=`rotate(${this.ctn.angle}deg) scale(${this.ctn.scale.x*t}, ${this.ctn.scale.y*t})`}#m=0;#p=!1;get tategaki(){return this.#p}#y=0;#u=0;get infTL(){return this.#n}get getWidth(){return this.#n.$width}get getHeight(){return this.#n.$height}setMySize(e,t){this.#n.$width=e,this.#n.$height=t,this.#i.style.width=this.#n.$width+"px",this.#i.style.height=this.#n.$height+"px"}#A(e,t=!0){const r={escape:X=>X.replaceAll(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),mimeType:X=>{const z=B(X).toLowerCase();return o()[z]||""},dataAsUrl:$,isDataUrl:G,resolveUrl:U,getAndEncode:H,asArray:X=>{const z=[],W=X.length;for(let q=0;q<W;++q)z.push(X[q]);return z}};function o(){const X="application/font-woff",z="image/jpeg";return{woff:X,woff2:X,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:z,jpeg:z,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}const D=V(),N=Y();function k(X){return N.resolveAll().then(z=>{const W=document.createElement("style");return X.appendChild(W),W.appendChild(document.createTextNode(z)),X})}function B(X){return/\.([^\.\/]*?)$/g.exec(X)?.[1]??""}function G(X){return X.search(/^(data:)/)!==-1}function U(X,z){const W=document.implementation.createHTMLDocument(),q=W.createElement("base");W.head.appendChild(q);const K=W.createElement("a");return W.body.appendChild(K),q.href=z,K.href=X,K.href}function H(X){let z=3e4;return new Promise(function(W){const q=new XMLHttpRequest;q.onreadystatechange=K,q.ontimeout=Q,q.responseType="blob",q.timeout=z,q.open("GET",X,!0),q.send();function K(){if(q.readyState!==4)return;if(q.status!==200){Z("cannot fetch resource: "+X+", status: "+q.status);return}const ee=new FileReader;ee.onloadend=function(){const J=ee.result.toString().split(/,/)[1];W(J)},ee.readAsDataURL(q.response)}function Q(){Z("timeout of "+z+"ms occured while fetching resource: "+X)}function Z(ee){console.error(ee),W("")}})}function $(X,z){return"data:"+z+";base64,"+X}function V(){const X=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:K,shouldProcess:z};function z(Q){return Q.search(X)!==-1}function W(Q){const Z=[];let ee;for(;ee=X.exec(Q);)Z.push(ee[1]);return Z.filter(function(J){return!r.isDataUrl(J)})}function q(Q,Z,ee,J){return Promise.resolve(Z).then(oe=>ee?r.resolveUrl(oe,ee):oe).then(J||r.getAndEncode).then(oe=>r.dataAsUrl(oe,r.mimeType(Z))).then(oe=>Q.replace(te(Z),"$1"+oe+"$3"));function te(oe){return new RegExp(`(url\\(['"]?)(`+r.escape(oe)+`)(['"]?\\))`,"g")}}function K(Q,Z,ee){if(J())return Promise.resolve(Q);return Promise.resolve(Q).then(W).then(te=>{let oe=Promise.resolve(Q);for(const ce of te)oe=oe.then(fe=>q(fe,ce,Z,ee));return oe});function J(){return!z(Q)}}}function Y(){return{resolveAll:X,impl:{readAll:z}};function X(){return z().then(W=>Promise.allSettled(W.map(q=>q.resolve()))).then(W=>W.join(`
`))}function z(){return Promise.resolve(r.asArray(document.styleSheets)).then(q).then(W).then(Q=>Q.map(K));function W(Q){return Q.filter(Z=>Z.type===CSSRule.FONT_FACE_RULE).filter(Z=>D.shouldProcess(Z.style.getPropertyValue("src")))}function q(Q){const Z=[];for(const ee of Q)try{if(ee.href)continue;r.asArray(ee.cssRules||[]).forEach(Z.push.bind(Z))}catch(J){console.error("Error while reading CSS rules from "+ee.href,String(J))}return Z}function K(Q){return{resolve:function(){const Z=(Q.parentStyleSheet||{}).href;return D.inlineAll(Q.cssText,Z)},src:function(){return Q.style.getPropertyValue("src")}}}}}Promise.resolve(this.#i).then(X=>{const z=X.cloneNode(!0);return z.style.padding="0px",z.style.paddingRight=this.#y+"px",z.style.paddingTop=this.#u+"px",z.style.left="0px",z.style.top="0px",z.style.width=this.#n.$width-this.#n.pad_left-this.#n.pad_right+"px",z.style.height=this.#n.$height-this.#n.pad_top-this.#n.pad_bottom+"px",this.#i.hidden=t,z}).then(k).then(X=>{X.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const z=new Image;return z.src=`data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="${this.#n.$width}px" height="${this.#n.$height}px"><foreignObject x="0" y="0" width="100%" height="100%">${new XMLSerializer().serializeToString(X).replaceAll("#","%23").replaceAll(`
`,"%0A")}</foreignObject></svg>`,new Promise(W=>z.onload=()=>W(z))}).then(X=>new Promise(z=>setTimeout(()=>z(X),100))).then(X=>{const z=document.createElement("canvas");z.width=this.#n.$width,z.height=this.#n.$height,z.getContext("2d").drawImage(X,0,0),e(Texture.from(z))}).catch(X=>DebugMng.myTrace(`goTxt() = ${X}`))}#v=[];goTxt(e,t){const r=()=>this.#D(e,t);this.#v.push(r)===1&&r()}#_=[];#o=0;static#x="<span class='sn_ch sn_ch_last'>&emsp;</span>";#D(e,t){TxtStage.#S.visible=!1;let r=this.#_.length,o="";if(r===0){if(TxtStage.#t.oCfg.debug.masume&&(CmnLib.debugLog&&console.log(`🍌 masume ${this.name} v:${this.visible} l:${this.x} t:${this.y} a:${this.alpha} pl:${this.#n.pad_left} pr:${this.#n.pad_right} pt:${this.#n.pad_top} pb:${this.#n.pad_bottom} w:${this.#n.$width} h:${this.#n.$height}`),this.#h.clear().beginFill(3407616,.2).lineStyle(1,3407616,1).drawRect(-this.#n.pad_left,-this.#n.pad_top,this.#n.$width,this.#n.$height).endFill().beginFill(13311,.2).lineStyle(2,13311,1).drawRect(0,0,this.#n.$width-this.#n.pad_left-this.#n.pad_right,this.#n.$height-this.#n.pad_top-this.#n.pad_bottom).endFill()),this.#i.innerHTML=[...e].join("").replaceAll(/[\n\t]/g,"")+TxtStage.#x,!this.#l.break_fixed){const X=globalThis.getComputedStyle(this.#i),z=parseFloat(X.fontSize);this.#p?(this.#l.break_fixed_left=(this.#n.$width-this.#n.pad_left-this.#n.pad_right-z*1.5)*this.sys.cvsScale,this.#l.break_fixed_top=0):(this.#l.break_fixed_left=0,this.#l.break_fixed_top=z/2*this.sys.cvsScale)}}else o=this.#i.innerHTML,--r,this.#i.getElementsByClassName("sn_ch_last").item(0)?.remove(),this.#i.querySelectorAll(":scope > br").forEach(X=>X.remove()),this.#i.insertAdjacentHTML("beforeend",e.slice(this.#o).join("").replaceAll(/[\n\t]/g,"")+TxtStage.#x);this.#i.querySelectorAll(".sn_ch:has(> ruby)").forEach(X=>X.style.background=""),this.#o=e.length;const D=this.sys.cvsScale,N=this.#i.getBoundingClientRect(),k=N.left+this.#n.pad_left,B=N.top+this.#n.pad_top;let G;if(D===1)G=(X,z)=>{const W=X.getBoundingClientRect();return new Rectangle(W.left-k,W.top-B,W.width,W.height+("gjqy".includes(z)?this.#c:0))};else{const X=this.sys.ofsPadLeft_Dom2PIXI+N.left*(1-D),z=this.sys.ofsPadTop_Dom2PIXI+N.top*(1-D);G=(W,q)=>{const K=W.getBoundingClientRect();return new Rectangle((K.left-X)/D-k,(K.top-z)/D-B,K.width/D,(K.height+("gjqy".includes(q)?this.#c:0))/D)}}const[U,H]=this.#l.hyph(this.#i,G,this.#p,r,o);this.#_=U;const $=CmnTween.ease(this.#b);for(let X=r;X<H;++X){const z=this.#_[X],{elm:{dataset:W,parentElement:q},rect:K}=z,Q=JSON.parse(W.arg??'{"delay": 0}'),Z=JSON.parse(W.add??"{}"),ee=TxtStage.#H[Z.ch_in_style];if(this.#f(z),W.cmd==="grp"){const J=new Container;this.#a.addChild(J),new SpritesMng(Q.pic,J,te=>{this.#Y(J,Q,Z,K,$,ee??{}),J.parent||J.removeChild(te)})}if(W.lnk){const J=q.closest("[data-arg]"),te=JSON.parse(J.dataset.arg??"{}");te.key=`lnk=[${X}] `+this.name;const oe=new Sprite;this.#Y(oe,te,Z,K,$,ee??{});const ce=te.style??"",fe=ce+(te.style_hover??""),me=ce+(te.style_clicked??""),we=te.r_style??"",Me=we+(te.r_style_hover??""),Ee=we+(te.r_style_clicked??""),ie=Array.from(J.getElementsByTagName("rt"));for(const ue of ie)ue.dataset.st_r_bk=ue.style.cssText;const ne=J.style.cssText,se=(ue,le)=>{J.style.cssText=ne+ue;for(const he of ie)he.style.cssText=he.dataset.st_r_bk+le};argChk_Boolean(te,"enabled",!0)?TxtStage.#r.button(te,oe,()=>se(ce,we),()=>this.canFocus()?(se(fe,Me),!0):!1,()=>se(me,Ee)):se(ce+(te.style_disable??"color: gray;"),we+(te.r_style_disable??"color: gray;")),this.#a.addChild(oe)}}const V=Array.from(this.#i.getElementsByClassName("sn_ch_yet"));this.#G=()=>{this.#G=()=>!1;for(const z of V)z.className="sn_ch";TxtStage.#S.position.set(this.#l.break_fixed_left,this.#l.break_fixed_top),TxtStage.#S.visible=!0,this.noticeCompTxt();const X=this.#v.shift();return this.#v.length>0&&X(),!0};for(const X of V)X.className=X.className.replace("sn_ch_yet sn","go");r>0&&++r;let Y;for(let X=H-2;X>=0;--X){const{elm:z}=this.#_[X];if(z.tagName==="SPAN"){Y=z.parentElement?.tagName==="RUBY"?z.parentElement.parentElement??z:z;break}}if(!Y||t||r===H){this.#G();return}Y.addEventListener("animationend",()=>this.#G(),{once:!0})}#G=()=>!1;#Y(e,t,r,o,D,N){e.alpha=0,t.x&&(o.x=t.x.startsWith("=")?o.x+parseInt(t.x.slice(1)):parseInt(t.x)),t.y&&(o.y=t.y.startsWith("=")?o.y+parseInt(t.y.slice(1)):parseInt(t.y)),t.width&&(o.width=parseInt(t.width)),t.height&&(o.height=parseInt(t.height)),t.wait&&(N.wait=parseInt(t.wait)),e.width=o.width,e.height=o.height,N.x?e.position.set(N.x.startsWith("=")?o.x+e.width*N.nx:N.nx,N.y.startsWith("=")?o.y+e.height*N.ny:N.ny):e.position.set(o.x,o.y);const k={sp:e,tw:new Tween(e).to({alpha:1,x:o.x,y:o.y,width:o.width,height:o.height,angle:0},N.wait??0).easing(D).delay((r.wait??0)+(t.delay??0)).onComplete(()=>{k.tw=void 0}).start()};this.#$.push(k)}#$=[];skipChIn(){let e=this.#G();for(const t of this.#$)t.tw&&(t.tw.stop().end(),e=!0);return this.#$=[],e}static#H=Object.create(null);static#q=/[{\s\.,*\{]/;static initChStyle(){TxtStage.#H=Object.create(null),TxtStage.#O=Object.create(null)}static getChInStyle(e){return TxtStage.#H[e]}static ch_in_style(e){const{name:t}=e;if(!t)throw"nameは必須です";if(TxtStage.#q.test(t))throw`name【${t}】に使えない文字が含まれます`;if(t in TxtStage.#H)throw`name【${t}】はすでにあります`;const r=String(e.x??"=0"),o=String(e.y??"=0");return TxtStage.#H[t]={wait:argChk_Num(e,"wait",500),alpha:argChk_Num(e,"alpha",0),x:r,y:o,nx:parseFloat(r.at(0)==="="?r.slice(1):r),ny:parseFloat(o.at(0)==="="?o.slice(1):o),scale_x:argChk_Num(e,"scale_x",1),scale_y:argChk_Num(e,"scale_y",1),rotate:argChk_Num(e,"rotate",0),join:argChk_Boolean(e,"join",!0),ease:e.ease??"ease-out"}}static#O=Object.create(null);static getChOutStyle(e){return TxtStage.#O[e]}static ch_out_style(e){const{name:t}=e;if(!t)throw"nameは必須です";if(TxtStage.#q.test(t))throw`name【${t}】に使えない文字が含まれます`;if(t in TxtStage.#O)throw`name【${t}】はすでにあります`;const r=String(e.x??"=0"),o=String(e.y??"=0");return TxtStage.#O[t]={wait:argChk_Num(e,"wait",500),alpha:argChk_Num(e,"alpha",0),x:r,y:o,nx:parseFloat(r.at(0)==="="?r.slice(1):r),ny:parseFloat(o.at(0)==="="?o.slice(1):o),scale_x:argChk_Num(e,"scale_x",1),scale_y:argChk_Num(e,"scale_y",1),rotate:argChk_Num(e,"rotate",0),join:argChk_Boolean(e,"join",!1),ease:e.ease??"ease-out"}}static#S=new Container;static#U=new SpritesMng;dispBreak(e){TxtStage.delBreak();const t=TxtStage.#S;t.visible=!1,this.addChild(t),TxtStage.#U.destroy(),TxtStage.#U=new SpritesMng(e.pic,t,r=>{t.parent?(r.x=argChk_Num(e,"x",0),r.y=argChk_Num(e,"y",0),r.width=argChk_Num(e,"width",this.#n.fontsize),r.height=argChk_Num(e,"height",this.#n.fontsize)):t.removeChild(r)})}static delBreak(){const e=TxtStage.#S;e.parent?.removeChild(e),TxtStage.#U.destroy()}#b="Quadratic.Out";#P="Quadratic.Out";#M(){this.#h.clear(),this.#_=[],this.#o=0,this.#v=[],this.skipChIn();const e=this.#i.cloneNode(!0);e.textContent="";const t=this.#i,r=Array.from(t.getElementsByClassName("sn_ch"));t.parentElement.insertBefore(e,t);let o=0;r.forEach(N=>{const k=JSON.parse(N.dataset.add??N.children[0]?.getAttribute("data-add")??N.children[0]?.children[0]?.getAttribute("data-add")??"{}");if(!k.ch_out_style)return;const B=TxtStage.#O[k.ch_out_style];if(B){if(B.wait===0){N.style.display="none";return}o+=B.wait,B.join||(N.style.animationDelay="0ms"),N.classList.add(`go_ch_out_${k.ch_out_style}`)}});const D=()=>{t.parentElement.removeChild(t);for(const N of this.#a.removeChildren())N instanceof Container&&TxtStage.#r.unButton(N),N.destroy()};o===0?(this.#i.textContent="",D()):t.lastElementChild?.addEventListener("animationend",D,{once:!0}),this.#i=e}reNew(){this.#M();const e=new TxtStage(this.ctn,()=>this.canFocus(),this.sys);return e.#n=this.#n,e.#i.style.cssText=this.#i.style.cssText,e.#m=this.#m,e.name=this.name,e.#g(),e.#R=this.#R,e.#b=this.#b,e.#P=this.#P,this.#l.reNew(e.#l),this.destroy(),e}#R=void 0;record(){return{infTL:this.#n,cssText:this.#i.style.cssText,left:this.#m,ch_filter:this.#R,fi_easing:this.#b,fo_easing:this.#P,hyph:this.#l.record()}}playback(e){this.#n=e.infTL,this.position.set(this.#n.pad_left,this.#n.pad_top),this.#i.style.cssText=e.cssText,this.#m=e.left,this.#g(),this.#R=e.ch_filter,this.#b=e.fi_easing,this.#P=e.fo_easing,this.#l.playback(e.hyph)}get cssText(){return this.#i.style.cssText}set cssText(e){this.#i.style.cssText=e}#T=void 0;snapshot(e,t){this.#A(r=>{this.#T=Sprite.from(r),this.#p&&(this.#T.x+=CmnLib.stageW-(this.#m+this.#n.$width)),this.#T.y-=this.#u,this.#T.texture.frame=new Rectangle(0,0,Math.min(this.#T.width,this.#n.$width-this.#m),Math.min(this.#T.height,this.#n.$height)),this.#a.addChild(this.#T),e.render(this.#T,{clear:!1}),t()},!1)}snapshot_end(){this.#T&&(this.#a.removeChild(this.#T),this.#T=void 0)}makeDesignCast(e){}showDesignCast(){}dump(){const e=[],t=this.#i.style,r=t.length;for(let o=0;o<r;++o){const D=t[o];e.push(`"${D}":"${t[D].replaceAll(/(["\\])/g,"\\$1")}"`)}return`"txt":"${this.#i.textContent.replaceAll(/(["\\])/g,"\\$1")}", "style":{${e.join(",")}}`}destroy(){TxtStage.delBreak(),this.#i.parentElement.removeChild(this.#i),this.removeChild(this.#a),this.removeChild(this.#h),super.destroy()}}class Button extends Container{constructor(e,t,r,o){if(super(),this.hArg=e,this.evtMng=t,this.resolve=r,this.canFocus=o,this.#i={type:"pic",enabled:argChk_Boolean(e,"enabled",!0),x:this.x=uint(e.left??0),y:this.y=uint(e.top??0),rotation:this.angle=argChk_Num(e,"rotation",this.angle),pivot_x:this.pivot.x=argChk_Num(e,"pivot_x",this.pivot.x),pivot_y:this.pivot.y=argChk_Num(e,"pivot_y",this.pivot.y),scale_x:this.scale.x=argChk_Num(e,"scale_x",this.scale.x),scale_y:this.scale.y=argChk_Num(e,"scale_y",this.scale.y),alpha:1,text:"",b_pic:"",width:0,height:0},this.getBtnBounds=()=>(this.#r.x=this.#i.x,this.#r.y=this.#i.y,this.#r),this.#i.enabled&&t.button(e,this,()=>this.normal(),()=>this.#h(),()=>this.#d()),e.pic){this.#i.type="pic",this.#s=new SpritesMng(e.pic,this,H=>{this.#l(H),this.#r.width=H.width*this.#i.scale_x,this.#r.height=H.height*this.#i.scale_y},H=>r);return}if(!e.text)throw"textまたはpic属性は必須です";const D=argChk_Num(e,"height",30),N=new TextStyle({align:"center",dropShadow:!0,dropShadowAlpha:.7,dropShadowColor:"white",dropShadowBlur:7,dropShadowDistance:0,fill:this.#i.enabled?"black":"gray",fontFamily:Button.fontFamily,fontSize:D,padding:5});if(e.style)try{const H=JSON.parse(e.style);for(const[$,V]of Object.entries(H))N[$]=V;this.#i={...this.#i,...H}}catch(H){throw H instanceof SyntaxError?new Error(mesErrJSON(e,"style",H.message)):"fn:Button.ts style"}const k=new Text(e.text??"",N);k.alpha=argChk_Num(e,"alpha",k.alpha),k.width=argChk_Num(e,"width",100),k.height=e.height=D,this.setText=H=>k.text=H,this.#i={...this.#i,type:"text",alpha:k.alpha,text:k.text,width:k.width,height:k.height};let B=!1;if(this.#i.width=this.width,this.#i.height=this.height,e.b_pic&&(this.#i.b_pic=e.b_pic,this.#s=new SpritesMng(e.b_pic,this,H=>{this.#a(H,k),this.#i.width=this.width,this.#i.height=this.height,k.name=JSON.stringify(this.#i)},H=>{Layer.setBlendmode(this,e),H&&r()}),B=this.#s.ret),k.name=JSON.stringify(this.#i),this.addChild(k),this.#r.width=k.width,this.#r.height=k.height,e.b_pic||Layer.setBlendmode(this,e),Button.#t(this,k),!this.#i.enabled){B||r();return}const G=N.clone();if(e.style_hover)try{const H=JSON.parse(e.style_hover);for(const[$,V]of Object.entries(H))G[$]=V}catch(H){throw H instanceof SyntaxError?new Error(mesErrJSON(e,"style_hover",H.message)):"fn:Button.ts style_hover"}else G.fill="white";const U=G.clone();if(e.style_clicked)try{const H=JSON.parse(e.style_clicked);for(const[$,V]of Object.entries(H))U[$]=V}catch(H){throw H instanceof SyntaxError?new Error(mesErrJSON(e,"style_clicked",H.message)):"fn:Button.ts style_clicked"}else U.dropShadow=!1;this.normal=()=>k.style=N,this.#h=()=>o()?(k.style=G,!0):!1,this.#d=()=>k.style=U,B||r()}static fontFamily="'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif";static#t=(e,t)=>{};static#e=(e,t,r,o)=>{};static init(e){e.oCfg.debug.masume&&(Button.#t=(t,r)=>t.addChild(new Graphics().beginFill(8926088,.2).lineStyle(1,8926088,1).drawRect(r.x,r.y,r.width,r.height).endFill()),Button.#e=(t,r,o,D)=>t.addChild(new Graphics().beginFill(8926088,.2).lineStyle(1,8926088,1).drawRect(r.x,r.y,o,D).endFill()))}setText(e){}getBtnBounds=()=>this.#r;#r=new Rectangle;#s=new SpritesMng;#i;destroy(){this.evtMng.unButton(this),this.#s.destroy(),super.destroy()}makeDesignCast(e){}showDesignCast(){}cvsResize(){}#a(e,t){this.setChildIndex(e,0),e.alpha=t.alpha,e.setTransform(t.x,t.y,1,1,t.rotation,0,0,(e.width-t.width)/2,(e.height-t.height)/2),e.name=t.name}normal=()=>{};#h=()=>!1;#d=()=>{};#l(e){this.#i.alpha=e.alpha=argChk_Num(this.hArg,"alpha",e.alpha);const t=e.width/3,r=this.#i.enabled?t:e.width,o=e.height,D=e.texture.baseTexture,N=new Texture(D,new Rectangle(0,0,t,o)),k=new Texture(D,new Rectangle(t,0,t,o)),B=new Texture(D,new Rectangle(t*2,0,t,o)),G=()=>e.texture=N;this.#i.enabled&&G(),this.normal=G,this.#h=()=>this.canFocus()?(e.texture=B,!0):!1,this.#d=()=>e.texture=k,"width"in this.hArg?(this.#i.width=uint(this.hArg.width),this.scale.x*=this.#i.width/r):this.#i.width=r,"height"in this.hArg?(this.#i.height=uint(this.hArg.height),this.scale.y*=this.#i.height/o):this.#i.height=o,e.name=JSON.stringify(this.#i),Button.#e(this,e,r,o)}}class Pages{constructor(e,t,r,o,D,N,k,B){this.cls=t,this.hArg=D,this.sys=N,this.val=k,this.ret=B;const G=N.hFactoryCls[t];if(!G)throw`属性 class【${t}】が不正です`;const U=G(),H=G();U.layname=H.layname=e;const $=D[":id_tag"]=`layer:${e} cls:${t} page:`;U.ctn.name=U.name=$+"A",H.ctn.name=H.name=$+"B",r.addChild(U.ctn),o.addChild(H.ctn),argChk_Boolean(D,"visible",!0),argChk_Boolean(D,"visible",!0),B.isWait=U.lay(D)||H.lay(D),this.#t={fore:U,back:H},o.visible=!1;const V=`const.sn.lay.${e}`;k.setVal_Nochk("tmp",V,!0),k.defTmp(V+".fore.alpha",()=>this.#t.fore.alpha),k.defTmp(V+".back.alpha",()=>this.#t.back.alpha),k.defTmp(V+".fore.height",()=>this.#t.fore.height),k.defTmp(V+".back.height",()=>this.#t.back.height),k.defTmp(V+".fore.visible",()=>this.#t.fore.ctn.visible),k.defTmp(V+".back.visible",()=>this.#t.back.ctn.visible),k.defTmp(V+".fore.width",()=>this.#t.fore.width),k.defTmp(V+".back.width",()=>this.#t.back.width),k.defTmp(V+".fore.x",()=>this.#t.fore.x),k.defTmp(V+".back.x",()=>this.#t.back.x),k.defTmp(V+".fore.y",()=>this.#t.fore.y),k.defTmp(V+".back.y",()=>this.#t.back.y)}#t;destroy(){this.#t.fore.destroy(),this.#t.back.destroy()}lay=e=>this.getPage(e).lay(e);getPage=e=>Pages.argChk_page(e,"fore")!=="back"?this.#t.fore:this.#t.back;static argChk_page(e,t){const r=e.page??t;if(r==="fore"||r==="back")return e.page=r;throw Error("属性 page【"+r+"】が不正です")}get fore(){return this.#t.fore}get back(){return this.#t.back}transPage(e){[this.#t.back,this.#t.fore]=[this.#t.fore,this.#t.back],this.#t.back.copy(this.#t.fore,e)}}class DesignCast{constructor(e,t=!1){this.bg_col=e,this.isLay=t}static init(e,t,r,o,D,N){}static cvsResizeDesign(){}destroy(){}gethArg(){return this.hArg}hArg={};sethArg(e){this.hArg=e}setOther(e){}adopt(e){}static enterMode(){}static allHide(){}set visible(e){}static leaveMode(){}cvsResize(){}make(){}static replaceToken(e){}}class GrpLayDesignCast extends DesignCast{constructor(e,t){super("#29e",!0)}setSp(e){}}class GrpLayer extends Layer{static#t=new EventListenerCtn;static#e;static init(e,t,r,o,D,N){GrpLayer.#e=r,SpritesMng.init(t,N,o,e,D)}static destroy(){GrpLayer.#t.clear(),SpritesMng.destroy()}#r=new GrpLayDesignCast(this.ctn,this);constructor(){super(),CmnLib.isDbg&&(this.#s=e=>this.#r.setSp(e),this.cvsResize=()=>{super.cvsResize(),this.#r.cvsResize()})}#s=()=>{};#i="";#a="";#h="";lay=e=>{const t=Reading.procID+`GrpLayer lay name:${this.name_}`,r=this.#d(e,o=>{o&&Reading.endProc(t)});return r&&Reading.beginProc(t),r};#d(e,t){const{fn:r,face:o=""}=e;if(this.#r.sethArg(e),!r)return super.lay(e),this.ctn.children.length>0&&this.setPos(e),this.#a="",this.#i=this.#h=o,t(!1),!1;const D="fn"in e,N="face"in e;return this.clearLay({clear_filter:argChk_Boolean(e,"clear_filter",!0)}),D&&(this.#a=r),N&&(this.#h=o),super.lay(e),e.dx=0,e.dy=0,this.#l.destroy(),this.#l=new SpritesMng(this.#i=r+(o?","+o:""),this.ctn,k=>{("width"in e||"height"in e)&&(k.width=argChk_Num(e,"width",0),k.height=argChk_Num(e,"height",0)),this.#f=k.width,this.#n=k.height,Layer.setXY(k,e,this.ctn,!0),Layer.setBlendmode(this.ctn,e),this.#s(k)},k=>t(k)),this.#l.ret}#l=new SpritesMng;#f=0;#n=0;get width(){return this.#f}get height(){return this.#n}renderStart(){this.#g=new Sprite(this.#c),this.#g.visible=!1,this.ctn.addChildAt(this.#g,0),this.#g.position.set(-this.ctn.x,-this.ctn.y);let e=()=>{const t=this.ctn.alpha;this.ctn.alpha=1;for(const r of this.ctn.children)r.visible=!0;this.#g.visible=!1,GrpLayer.#e.renderer.render(this.ctn,{renderTexture:this.#c}),this.ctn.alpha=t;for(const r of this.ctn.children)r.visible=!1};if(!this.containMovement){let t=e;e=()=>{e=()=>{},t()}}this.#m=()=>{e(),this.#g.visible=!0},GrpLayer.#e.ticker.add(this.#m)}#c=RenderTexture.create({width:CmnLib.stageW,height:CmnLib.stageH});#g=new Sprite;#m=()=>{};renderEnd(){GrpLayer.#e.ticker.remove(this.#m),this.ctn.removeChild(this.#g);for(const e of this.ctn.children)e.visible=!0;this.#g.destroy(!0),this.#c=RenderTexture.create({width:CmnLib.stageW,height:CmnLib.stageH})}setPos(e){Layer.setXY(this.ctn.children[0]??this.ctn,e,this.ctn,!0)}get containMovement(){if(this.#i==="")return!1;const e=this.ctn.children;return this.#i.split(",").some((t,r)=>e[r]instanceof AnimatedSprite||SpritesMng.getHFn2VElm(t))}clearLay(e){super.clearLay(e),this.#l.destroy(),this.#a="",this.#h="",this.#i=""}record=()=>({...super.record(),sBkFn:this.#a,sBkFace:this.#h});playback(e,t){if(super.playback(e,t),e.sBkFn===""&&e.sBkFace===""){this.#a="",this.#h="";return}t.push(new Promise(r=>this.#d({fn:e.sBkFn,face:e.sBkFace,left:e.x,top:e.y,alpha:e.alpha,blendmode:Layer.getNum2Blendmode(e.blendMode),rotation:e.rotation,scale_x:e.scale_x,scale_y:e.scale_y},o=>{this.ctn.position.set(e.x,e.y),r()})))}makeDesignCast(e){this.ctn.visible&&e(this.#r)}cvsResize(){super.cvsResize()}showDesignCast(){this.#r.visible=!0}dump=()=>super.dump()+`, "pic":"${this.#i}"`}const PROTOCOL_USERDATA="userdata:/",PROTOCOL_DL="downloads:/";class Config extends ConfigBase{constructor(e){super(e),this.sys=e}static async generate(e){const t=new Config(e),r=e.arg.cur+"prj.json",o=await e.fetch(r);if(!o.ok)throw Error(o.statusText);const D=await e.dec(r,await o.text());return await t.load(JSON.parse(D)),t}async load(e){await super.load(e),CmnLib.stageW=e.window.width,CmnLib.stageH=e.window.height,CmnLib.debugLog=e.debug.debugLog}searchPath(e,t=SEARCH_PATH_ARG_EXT.DEFAULT){return e.startsWith(PROTOCOL_DL)?this.sys.path_downloads+e.slice(11):e.startsWith(PROTOCOL_USERDATA)?this.sys.path_userdata+"storage/"+e.slice(10):super.searchPath(e,t)}}class FrameMng{constructor(e,t,r){this.appPixi=t,this.val=r,e.add_frame=o=>this.#h(o),e.let_frame=o=>this.#g(o),e.set_frame=o=>this.#m(o),e.frame=o=>this.#y(o),e.tsy_frame=o=>this.#u(o)}static#t;static#e;static#r;static init(e,t,r){FrameMng.#t=e,FrameMng.#e=t,FrameMng.#r=r}#s;setEvtMng(e){this.#s=e}#i=Object.create(null);destroy(){for(const e of Object.values(this.#i))e.parentElement.removeChild(e);this.#i=Object.create(null)}hideAllFrame(){for(const[e,{style:t}]of Object.entries(this.#i))this.#a[e]=t.display!=="none",t.display="none"}#a=Object.create(null);restoreAllFrame(){for(const[e,t]of Object.entries(this.#a)){const r=this.#i[e];r&&(r.style.display=t?"inline":"none")}this.#a=Object.create(null)}#h(e){const{id:t,src:r,alpha:o=1,scale_x:D=1,scale_y:N=1,rotate:k=0}=e;if(!t)throw"idは必須です";if(!r)throw"srcは必須です";const B="const.sn.frm."+t;if(this.val.getVal(`tmp:${B}`))throw`frame【${t}】はすでにあります`;const G=argChk_Boolean(e,"visible",!0),U=e.b_color?` background-color: ${e.b_color};`:"",H=this.#l(e);FrameMng.#r.cvs.insertAdjacentHTML("beforebegin",`<iframe id="${t}" style="opacity: ${o}; ${U} position: absolute; left:${FrameMng.#e.ofsLeft4elm+H.x*FrameMng.#e.cvsScale}px; top: ${FrameMng.#e.ofsTop4elm+H.y*FrameMng.#e.cvsScale}px; z-index: 1; border: 0px; overflow: hidden; display: ${G?"inline":"none"}; transform: scale(${D}, ${N}) rotate(${k}deg);" width="${H.width*FrameMng.#e.cvsScale}" height="${H.height*FrameMng.#e.cvsScale}"></iframe>`);const $=Reading.procID+`add_frame id:${t}`;Reading.beginProc($);const V=FrameMng.#t.searchPath(r,SEARCH_PATH_ARG_EXT.HTML),Y=new Loader().add({name:r,url:V,xhrType:LoaderResource.XHR_RESPONSE_TYPE.TEXT});return FrameMng.#e.arg.crypto&&Y.use(async(X,z)=>{try{X.data=await FrameMng.#e.dec(X.extension,X.data)}catch(W){FrameMng.#r.errScript(`[add_frame]Html ロード失敗です src:${X.name} ${W}`,!1)}z()}),Y.load((X,z)=>{const W=document.getElementById(t);this.#i[t]=W,this.#d[t]=!1;const q=V.lastIndexOf("/")+1,K=V.slice(0,q),Q=K.slice(0,q);W.srcdoc=String(z[r]?.data).replace("sn_repRes();","").replaceAll(/\s(?:src|href)=(["'])(\S+?)\1/g,(Z,ee,J)=>J.startsWith("../")?Q+Z.slice(3):Z.replace("./","").replace(ee,ee+K)),W.srcdoc.includes("true/*WEBP*/;")&&(W.srcdoc=W.srcdoc.replaceAll(/data-src="(.+?\.)(?:jpe?g|png)/g,(Z,ee)=>`data-src="${ee}webp`)),W.onload=()=>{Reading.endProc($),this.val.setVal_Nochk("tmp",B,!0),this.val.setVal_Nochk("tmp",B+".alpha",o),this.val.setVal_Nochk("tmp",B+".x",H.x),this.val.setVal_Nochk("tmp",B+".y",H.y),this.val.setVal_Nochk("tmp",B+".scale_x",D),this.val.setVal_Nochk("tmp",B+".scale_y",N),this.val.setVal_Nochk("tmp",B+".rotate",k),this.val.setVal_Nochk("tmp",B+".width",H.width),this.val.setVal_Nochk("tmp",B+".height",H.height),this.val.setVal_Nochk("tmp",B+".visible",G);const Z=W.contentWindow;this.#s.resvFlameEvent(Z.document.body),Z.sn_repRes?.(ee=>FrameMng.#f(ee.dataset.src??"",ee))}}),!0}#d={};getFrmDisabled(e){return this.#d[e]}#l(e){const t={...e},r=FrameMng.#e.resolution;return new DOMRect(argChk_Num(t,"x",0)*r,argChk_Num(t,"y",0)*r,argChk_Num(t,"width",CmnLib.stageW)*r,argChk_Num(t,"height",CmnLib.stageH)*r)}static#f(e,t,r){const o=this.#c[e];if(o){t.src=o,r&&(t.onload=()=>r(t));return}const D=this.#n[e];if(D){D.push(t);return}this.#n[e]=[t];const[N="",k=""]=e.split("?"),B=FrameMng.#t.searchPath(N,SEARCH_PATH_ARG_EXT.SP_GSM),G=new Loader().add({name:e,url:B,xhrType:LoaderResource.XHR_RESPONSE_TYPE.BUFFER});FrameMng.#e.arg.crypto&&B.endsWith(".bin")&&G.use(async(U,H)=>{try{const $=await FrameMng.#e.decAB(U.data);if(U.extension!=="bin"){H();return}U.data=$,$ instanceof HTMLImageElement&&(U.type=LoaderResource.TYPE.IMAGE)}catch($){FrameMng.#r.errScript(`FrameMng loadPic ロード失敗です fn:${U.name} ${$}`,!1)}H()}),G.load((U,H)=>{for(const[$,{data:{src:V}}]of Object.entries(H)){const Y=this.#c[$]=V+(V.startsWith("blob:")||V.startsWith("data:")?"":k?"?"+k:""),X=this.#n[$];if(X)for(const z of X)z.src=Y,r&&(z.onload=()=>r(z));delete this.#n[$]}})}static#n={};static#c={};cvsResize(){for(const[e,t]of Object.entries(this.#i)){const r="const.sn.frm."+e,o=Number(this.val.getVal(r+".x")),D=Number(this.val.getVal(r+".y")),N=Number(this.val.getVal(r+".width")),k=Number(this.val.getVal(r+".height"));t.style.left=`${FrameMng.#e.ofsLeft4elm+o*FrameMng.#e.cvsScale}px`,t.style.top=`${FrameMng.#e.ofsTop4elm+D*FrameMng.#e.cvsScale}px`,t.width=String(N*FrameMng.#e.cvsScale),t.height=String(k*FrameMng.#e.cvsScale)}}#g(e){const{id:t,var_name:r}=e;if(!t)throw"idは必須です";const o=document.getElementById(t);if(!o)throw`id【${t}】はフレームではありません`;const D="const.sn.frm."+t;if(!this.val.getVal(`tmp:${D}`))throw`frame【${t}】が読み込まれていません`;if(!r)throw"var_nameは必須です";const N=o.contentWindow;if(!Object.hasOwn(N,r))throw`frame【${t}】に変数/関数【${r}】がありません。変数は var付きにして下さい`;const k=N[r];return this.val.setVal_Nochk("tmp",D+"."+r,argChk_Boolean(e,"function",!1)?k():k),!1}#m(e){const{id:t,var_name:r,text:o}=e;if(!t)throw"idは必須です";const D=document.getElementById(t);if(!D)throw`id【${t}】はフレームではありません`;const N="const.sn.frm."+t;if(!this.val.getVal(`tmp:${N}`))throw`frame【${t}】が読み込まれていません`;if(!r)throw"var_nameは必須です";if(!o)throw"textは必須です";this.val.setVal_Nochk("tmp",N+"."+r,o);const k=D.contentWindow;return k[r]=o,!1}#p=1;#y(e){const{id:t}=e;if(!t)throw"idは必須です";const r=document.getElementById(t);if(!r)throw`id【${t}】はフレームではありません`;const o="const.sn.frm."+t;if(!this.val.getVal("tmp:"+o))throw`frame【${t}】が読み込まれていません`;const D=r.style;if(argChk_Boolean(e,"float",!1)?D.zIndex=`${++this.#p}`:"index"in e?D.zIndex=`${argChk_Num(e,"index",0)}`:e.dive&&(D.zIndex=`-${++this.#p}`),"alpha"in e){const k=D.opacity=String(e.alpha);this.val.setVal_Nochk("tmp",o+".alpha",k)}const N=this.#l(e);if(("x"in e||"y"in e)&&(D.left=`${FrameMng.#e.ofsLeft4elm+N.x*FrameMng.#e.cvsScale}px`,D.top=`${FrameMng.#e.ofsTop4elm+N.y*FrameMng.#e.cvsScale}px`,this.val.setVal_Nochk("tmp",o+".x",N.x),this.val.setVal_Nochk("tmp",o+".y",N.y)),"scale_x"in e||"scale_y"in e||"rotate"in e){const k=argChk_Num(e,"scale_x",1),B=argChk_Num(e,"scale_y",1),G=argChk_Num(e,"rotate",0);D.transform=`scale(${k}, ${B}) rotate(${G}deg)`,this.val.setVal_Nochk("tmp",o+".scale_x",k),this.val.setVal_Nochk("tmp",o+".scale_y",B),this.val.setVal_Nochk("tmp",o+".rotate",G)}if("width"in e&&(r.width=String(N.width*FrameMng.#e.cvsScale),this.val.setVal_Nochk("tmp",o+".width",N.width)),"height"in e&&(r.height=String(N.height*FrameMng.#e.cvsScale),this.val.setVal_Nochk("tmp",o+".height",N.height)),"visible"in e){const k=argChk_Boolean(e,"visible",!0);D.display=k?"inline":"none",this.val.setVal_Nochk("tmp",o+".visible",k)}if("b_color"in e&&(D.backgroundColor=e.b_color),"disabled"in e){const k=this.#d[t]=argChk_Boolean(e,"disabled",!0),B=r.contentDocument.body;for(const G of[...Array.from(B.getElementsByTagName("input")),...Array.from(B.getElementsByTagName("select"))])G.disabled=k}return!1}#u(e){const{id:t,alpha:r,x:o,y:D,scale_x:N,scale_y:k,rotate:B,width:G,height:U}=e;if(!t)throw"idは必須です";const H=document.getElementById(t);if(!H)throw`id【${t}】はフレームではありません`;const $="const.sn.frm."+t;if(!this.val.getVal(`tmp:${$}`,0))throw`frame【${t}】が読み込まれていません`;const V={};r&&(V.a=H.style.opacity),(o||D||N||k||B)&&(V.x=Number(this.val.getVal(`tmp:${$}.x`)),V.y=Number(this.val.getVal(`tmp:${$}.y`)),V.sx=Number(this.val.getVal(`tmp:${$}.scale_x`)),V.sy=Number(this.val.getVal(`tmp:${$}.scale_y`)),V.r=Number(this.val.getVal(`tmp:${$}.rotate`))),G&&(V.w=this.val.getVal(`tmp:${$}.width`)),U&&(V.h=this.val.getVal(`tmp:${$}.height`));const Y=CmnTween.cnvTweenArg(e,V);let X=()=>{};r&&(argChk_Num(Y,"alpha",0),X=()=>{H.style.opacity=V.a,this.val.setVal_Nochk("tmp","alpha",V.a)});let z=()=>{};const W=this.#l(Y);(o||D||N||k||B)&&(W.x,W.y,argChk_Num(Y,"scale_x",1),argChk_Num(Y,"scale_y",1),argChk_Num(Y,"rotate",0),z=()=>{H.style.left=FrameMng.#e.ofsLeft4elm+V.x*FrameMng.#e.cvsScale+"px",H.style.top=FrameMng.#e.ofsTop4elm+V.y*FrameMng.#e.cvsScale+"px",H.style.transform=`scale(${V.sx}, ${V.sy}) rotate(${V.r}deg)`,this.val.setVal_Nochk("tmp",$+".x",V.x),this.val.setVal_Nochk("tmp",$+".y",V.y),this.val.setVal_Nochk("tmp",$+".scale_x",V.sx),this.val.setVal_Nochk("tmp",$+".scale_y",V.sy),this.val.setVal_Nochk("tmp",$+".rotate",V.r)});let q=()=>{};G&&(W.width,q=()=>{H.width=V.w*FrameMng.#e.cvsScale+"px",this.val.setVal_Nochk("tmp",$+".width",V.w)});let K=()=>{};return U&&(W.height,K=()=>{H.height=V.h*FrameMng.#e.cvsScale+"px",this.val.setVal_Nochk("tmp",$+".height",V.h)}),this.appPixi.stage.interactive=!1,CmnTween.tween(`frm
${t}`,e,V,CmnTween.cnvTweenArg(e,V),()=>{X(),z(),q(),K()},()=>this.appPixi.stage.interactive=!0,()=>{}),!1}}class LayerMng{constructor(e,t,r,o,D,N,k,B,G){this.cfg=e,this.hTag=t,this.appPixi=r,this.val=o,this.main=D,this.scrItr=N,this.sys=k,this.sndMng=B,this.prpPrs=G;const U=()=>{if(k.cvsResize(),this.cvsResizeDesign(),this.#l)for(const Y of this.#x)this.#o[Y].fore.cvsResizeChildren();else for(const Y of this.#x)this.#o[Y].fore.cvsResize();this.#s.cvsResize(),this.#c.cvsResize()};if(CmnLib.isMobile)this.#a.add(globalThis,"orientationchange",U,{passive:!0});else{let Y;this.#a.add(globalThis,"resize",()=>{Y||(Y=setTimeout(()=>{Y=void 0,U()},1e3/60*10))},{passive:!0})}k.cvsResize(),TxtLayer.init(e,t,o,this,Y=>this.#o[Y.layname].fore===Y,r),GrpLayer.init(D,e,r,k,B,o),FrameMng.init(e,k,D),Button.init(e),this.#s=new FrameMng(t,r,o),k.hFactoryCls.grp=()=>new GrpLayer,k.hFactoryCls.txt=()=>new TxtLayer,t.loadplugin=Y=>this.#v(Y),t.snapshot=Y=>this.#p(Y),this.#y=this.sys.isApp?this.#u:this.#A,t.add_lay=Y=>this.#_(Y),t.clear_lay=Y=>this.#H(Y),t.finish_trans=()=>!1,t.lay=Y=>this.#Y(Y),t.trans=Y=>this.#P(Y),t.wt=Y=>CmnTween.wt(Y),t.quake=Y=>this.#L(Y),t.stop_quake=t.finish_trans,t.wq=t.wt,t.pause_tsy=Y=>CmnTween.pause_tsy(Y),t.resume_tsy=Y=>CmnTween.resume_tsy(Y),t.stop_tsy=Y=>CmnTween.stop_tsy(Y),t.tsy=Y=>this.#re(Y),t.wait_tsy=Y=>CmnTween.wait_tsy(Y),t.add_filter=Y=>this.#N(Y),t.clear_filter=Y=>this.#Q(Y),t.enable_filter=Y=>this.#z(Y),t.ch=Y=>this.#F(Y),t.clear_text=Y=>this.#ae(Y),t.current=Y=>this.#Z(Y),t.endlink=Y=>this.#he(Y),t.er=Y=>this.#ie(Y),t.graph=Y=>this.#le(Y),t.link=Y=>this.#j(Y),t.r=Y=>this.#ue(Y),t.rec_ch=Y=>this.#ne(Y),t.rec_r=Y=>this.#se(Y),t.reset_rec=Y=>this.#ce(Y),t.ruby2=Y=>this.#fe(Y),t.span=Y=>this.#de(Y),t.tcy=Y=>this.#J(Y),t.add_face=Y=>SpritesMng.add_face(Y),t.wv=Y=>SpritesMng.wv(Y),t.dump_lay=Y=>this.#oe(Y),t.enable_event=Y=>this.#pe(Y),t.button=Y=>this.#ge(Y),e.existsBreakline&&(this.breakLine=Y=>{delete Y.visible,Y.id="break",Y.pic="breakline";const X=encodeURIComponent(JSON.stringify(Y));this.#m("grp｜"+X)}),e.existsBreakpage&&(this.breakPage=Y=>{delete Y.visible,Y.id="break",Y.pic="breakpage";const X=encodeURIComponent(JSON.stringify(Y));this.#m("grp｜"+X)}),this.#i=parseColor(String(e.oCfg.init.bg_color));const H=new Graphics;H.beginFill(this.#i).lineStyle(0,this.#i).drawRect(0,0,CmnLib.stageW,CmnLib.stageH).endFill(),this.#e.addChild(H.clone()),this.#r.addChild(H),this.#r.visible=!1,this.#e.name="page:A",this.#r.name="page:B",this.#t=r.stage,this.#t.addChild(this.#r),this.#t.addChild(this.#e),this.#t.addChild(this.#S),this.#t.addChild(this.#b),this.#t.name="stage";const $=(Y,X)=>{this.#g(Number(X))};$("",o.getVal("sys:TextLayer.Back.Alpha",1)),o.defValTrg("sys:TextLayer.Back.Alpha",$);const V=(Y,X)=>Button.fontFamily=X;V("",o.getVal("tmp:sn.button.fontFamily",Button.fontFamily)),o.defValTrg("tmp:sn.button.fontFamily",V),o.defTmp("const.sn.log.json",()=>JSON.stringify((this.#B.text=this.#B.text?.replaceAll("</span><span class='sn_ch'>","")??"")?[...this.#W,this.#B]:this.#W)),o.defTmp("const.sn.last_page_text",()=>this.currentTxtlayFore?.pageText??""),o.defTmp("const.sn.last_page_plain_text",()=>this.currentTxtlayFore?.pagePlainText??""),CmnLib.isDbg&&(DesignCast.init(r,k,N,G,e,this.#o),this.cvsResizeDesign=()=>DesignCast.cvsResizeDesign(),k.addHook((Y,X)=>{this.#h[Y]?.(Y,X)&&delete this.#h[Y]}))}#t;#e=new Container;#r=new Container;#s;#i;#a=new EventListenerCtn;cvsResizeDesign(){}#h={attach:e=>!1,continue:e=>!1,disconnect:e=>!1,_enterDesign:e=>{for(const t of this.#x){const r=this.#o[t].fore;r.makeDesignCastChildren(o=>o.make()),r.makeDesignCast(o=>o.make())}return this.#f(this.#D),!1},_replaceToken:(e,t)=>!1,_selectNode:(e,t)=>(this.#f(t.node),!1)};#d="";#l="";#f(e){[this.#d="",this.#l=""]=e.split("/");const t=this.#o[this.#d];t&&(this.#l?t.fore.showDesignCastChildren():t.fore.showDesignCast())}getFrmDisabled=e=>this.#s.getFrmDisabled(e);#n=void 0;cover(e,t=0){this.#n&&(this.#t.removeChild(this.#n),this.#n.destroy(),this.#n=void 0),e&&this.#t.addChild((this.#n=new Graphics).beginFill(t).lineStyle(0,t).drawRect(0,0,CmnLib.stageW,CmnLib.stageH).endFill())}#c;setEvtMng(e){this.#c=e,this.#s.setEvtMng(e),SpritesMng.setEvtMng(e),CmnTween.init(e,this.appPixi)}destroy(){for(const e of Object.values(this.#o))e.destroy();this.#a.clear(),GrpLayer.destroy(),RubySpliter.destroy(),TxtStage.destroy(),TxtLayer.destroy(),this.#s.destroy(),CmnTween.destroy(),LayerMng.#k=10}#g(e){for(const t of this.#x){const{fore:r,back:o}=this.#o[t];r instanceof TxtLayer&&(r.chgBackAlpha(e),o.chgBackAlpha(e))}}#m=(e,t=this.currentTxtlayForeNeedErr,r=!0)=>t.tagCh("｜&emsp;《"+e+"》");goTxt=()=>{};get needGoTxt(){return this.currentTxtlayFore?.needGoTxt??!1}breakLine=e=>{};breakPage=e=>{};clearBreak(){this.currentTxtlayFore&&(this.clearBreak=()=>this.#m("del｜break"),this.clearBreak())}clickTxtLay(){return this.currentTxtlayFore?this.#x.map(e=>this.#o[e].fore).some(e=>e instanceof TxtLayer&&e.click()):!1}#p(e){const t=getDateStr("-","_","","_"),r=e.fn?e.fn.startsWith(PROTOCOL_USERDATA)?e.fn:`${PROTOCOL_DL+e.fn+t}.png`:`${PROTOCOL_DL}snapshot${t}.png`,o=this.cfg.searchPath(r),D=argChk_Num(e,"width",CmnLib.stageW),N=argChk_Num(e,"height",CmnLib.stageH);return this.#y(e,o,D,N,`snapshot dt:${t}`)}#y=()=>!1;#u({layer:e},t,r,o,D){if(this.#s.hideAllFrame(),Reading.beginProc(D),!e)return this.sys.capturePage(t,r,o,()=>{this.#s.restoreAllFrame(),Reading.endProc(D)}),!0;const N=this.#x.map(k=>{const{ctn:B}=this.#o[k].fore,G=[B,B.visible];return B.visible=!1,G});for(const k of this.#M(e))this.#o[k].fore.ctn.visible=!0;return this.sys.capturePage(t,r,o,()=>{for(const[k,B]of N)k.visible=B;this.#s.restoreAllFrame(),Reading.endProc(D)}),!0}#A(e,t,r,o,D){Reading.beginProc(D);const N=argChk_Color(e,"b_color",this.#i),k=autoDetectRenderer({width:r,height:o,backgroundAlpha:N>16777216&&t.endsWith(".png")?0:1,antialias:argChk_Boolean(e,"smoothing",!1),preserveDrawingBuffer:!0,backgroundColor:N&16777215,autoDensity:!0}),B=e.page!=="back"?"fore":"back",{layer:G}=e;return Promise.allSettled(this.#M(G).map(U=>new Promise(H=>this.#o[U][B].snapshot(k,H)))).then(async()=>{const U=RenderTexture.create({width:k.width,height:k.height});k.render(this.#t,{renderTexture:U}),await this.sys.savePic(t,k.plugins.extract.base64(U)),U.destroy();for(const H of this.#M(G))this.#o[H][B].snapshot_end();k.destroy(!0),Reading.endProc(D)}),!0}#v(e){const{fn:t}=e;if(!t)throw"fnは必須です";if(!t.endsWith(".css"))throw"サポートされない拡張子です";const r=argChk_Boolean(e,"join",!0),o=Reading.procID+`loadplugin fn:${t}`;return r&&Reading.beginProc(o),(async()=>{const D=await fetch(t);if(!D.ok)throw new Error("Network response was not ok.");addStyle(await D.text()),r&&Reading.endProc(o)})(),r}#_(e){const{layer:t,class:r}=e;if(!t)throw"layerは必須です";if(t.includes(","))throw"layer名に「,」は使えません";if(t in this.#o)throw`layer【${t}】はすでにあります`;if(!r)throw"clsは必須です";const o={isWait:!1};switch(this.#o[t]=new Pages(t,r,this.#e,this.#r,e,this.sys,this.val,o),this.#x.push(t),r){case"txt":this.#D||(this.#C=()=>{},this.#E=this.#ee,this.#Z=this.#K,this.hTag.current({layer:t}),this.goTxt=()=>{this.#c.isSkipping?LayerMng.#k=0:this.setNormalChWait();for(const D of this.#x){const N=this.#o[D].fore;N instanceof TxtLayer&&this.#m("gotxt｜",N,!1)}}),this.val.setVal_Nochk("save","const.sn.layer."+(t??this.#D)+".enabled",!0);break;case"grp":if(this.#G)break;this.#G=t;break}return this.scrItr.recodeDesign(e),o.isWait}#o={};#x=[];#D="";#G="";#Y(e){const t=this.#V(e),r=this.#o[t],o=r.back.ctn,D=r.fore.ctn;if(argChk_Boolean(e,"float",!1))this.#r.setChildIndex(o,this.#r.children.length-1),this.#e.setChildIndex(D,this.#e.children.length-1),this.#$();else if(e.index)argChk_Num(e,"index",0)&&(this.#r.setChildIndex(o,e.index),this.#e.setChildIndex(D,e.index),this.#$());else if(e.dive){const{dive:N}=e;let k=0;if(t===N)throw"[lay] 属性 layerとdiveが同じ【"+N+"】です";const B=this.#o[N];if(!B)throw"[lay] 属性 dive【"+N+"】が不正です。レイヤーがありません";const G=B.back,U=B.fore,H=this.#r.getChildIndex(G.ctn),$=this.#e.getChildIndex(U.ctn);k=H<$?H:$,k>this.#r.getChildIndex(o)&&--k,this.#e.setChildIndex(D,k),this.#r.setChildIndex(o,k),this.#$()}return e[":id_tag"]=r.fore.name.slice(0,-7),this.scrItr.recodeDesign(e),r.lay(e)}#$(){this.#x=this.#T()}#H(e){return this.#R(e,t=>{const r=this.#o[this.#V({layer:t})];if(e.page==="both"){r.fore.clearLay(e),r.back.clearLay(e);return}r.getPage(e).clearLay(e)}),!1}static#q=`
precision mediump float;

varying vec2 vTextureCoord;
uniform sampler2D uSampler;

uniform sampler2D rule;
uniform float vague;
uniform float tick;

uniform vec4 inputPixel;
uniform highp vec4 outputFrame;
vec2 getUV(vec2 coord) {
	return coord * inputPixel.xy / outputFrame.zw;
}

void main() {
	vec4 fg = texture2D(uSampler, vTextureCoord);
	vec4 ru = texture2D(rule, getUV(vTextureCoord));

	float v = ru.r - tick;
	gl_FragColor = abs(v) < vague
		? vec4(fg.rgb, 1) *fg.a *(0.5 +v /vague *0.5)
		: 0.0 <= v ? fg : vec4(0);
}`;#O=RenderTexture.create({width:CmnLib.stageW,height:CmnLib.stageH});#S=new Sprite(this.#O);#U=RenderTexture.create({width:CmnLib.stageW,height:CmnLib.stageH});#b=new Sprite(this.#U);#P(e){const{layer:t}=e,r=new Set,o=this.#M(t).map(K=>(r.add(K),this.#o[K].fore)),D=async()=>{[this.#e,this.#r]=[this.#r,this.#e];const K=[];for(const[Q,Z]of Object.entries(this.#o)){if(r.has(Q)){Z.transPage(K);continue}const{fore:{ctn:ee},back:{ctn:J}}=Z,te=this.#e.getChildIndex(J);this.#e.removeChild(J),this.#r.removeChild(ee),this.#e.addChildAt(ee,te),this.#r.addChildAt(J,te)}await Promise.allSettled(K),this.#e.visible=!0,this.#r.visible=!1,this.#S.visible=!1,this.#b.visible=!1,Reading.notifyEndProc(TMP_TSY_NM+TW_INT_TRANS)};if(this.#b.filters=[],this.#b.alpha=1,argChk_Num(e,"time",0)===0||this.#c.isSkipping)return Reading.beginProc(TMP_TSY_NM+TW_INT_TRANS,()=>{}),queueMicrotask(()=>D()),!0;const N=[],k=this.#x.map(K=>{const{fore:Q,back:Z}=this.#o[K],ee=r.has(K)?Z:Q;return ee.ctn.visible&&N.push(ee.ctn),ee}),{ticker:B,renderer:G}=this.appPixi;G.render(this.#r,{renderTexture:this.#O});let U=()=>{for(const K of N)G.render(K,{renderTexture:this.#O,clear:!1})};if(!k.some(K=>K.containMovement)){const K=U;U=()=>{U=()=>{},K()}}const H=()=>G.render(this.#e,{renderTexture:this.#U});H();let $=()=>{this.#e.visible=!0,H(),this.#e.visible=!1};if(!o.some(K=>K.containMovement)){const K=$;$=()=>{$=()=>{},K()}}const V=()=>{U(),this.#S.visible=!0,$(),this.#b.visible=!0},{glsl:Y,rule:X}=e,z=async()=>{B.remove(V),await D()};if(!Y&&!X)return CmnTween.tween(TW_INT_TRANS,e,this.#b,{alpha:0},()=>{},z,()=>{}),B.add(V),!1;const W={rule:Texture.EMPTY,vague:argChk_Num(e,"vague",.04),tick:0};this.#b.filters=[new Filter(void 0,Y??LayerMng.#q,W)];const q=CmnTween.tween(TW_INT_TRANS,e,W,{tick:1},()=>{},z,()=>{},!X);return X?new SpritesMng(X,void 0,K=>{W.rule=K.texture,K.destroy(),q.start(),B.add(V)},K=>{K&&this.main.resume()}).ret:(B.add(V),!1)}#M(e=""){return e?e.split(","):this.#x}#R(e,t){const r=this.#M(e.layer);for(const o of r){const D=this.#o[o];if(!D)throw`存在しないlayer【${o}】です`;t(o,D)}return r}#T(e=""){return this.#M(e).sort((t,r)=>{const o=this.#e.getChildIndex(this.#o[t].fore.ctn),D=this.#e.getChildIndex(this.#o[r].fore.ctn);return o<D?-1:o>D?1:0})}setAllStyle2TxtLay(e){for(const t of this.#x){const r=this.#o[t].fore;r instanceof TxtLayer&&r.lay({style:e})}}#L(e){if(argChk_Num(e,"time",NaN)===0)return!1;const t=this.#M(e.layer).map(U=>this.#o[U].fore.ctn),{renderer:r,ticker:o}=this.appPixi;this.#U.resize(CmnLib.stageW,CmnLib.stageH);const D=()=>{this.#e.visible=!0;for(const U of t)r.render(U,{renderTexture:this.#U,clear:!1});this.#e.visible=!1};this.#b.visible=!0,this.#b.alpha=1;const N=uint(argChk_Num(e,"hmax",10)),k=uint(argChk_Num(e,"vmax",10)),B=N===0?()=>{}:()=>this.#b.x=Math.round(Math.random()*N*2)-N,G=k===0?()=>{}:()=>this.#b.y=Math.round(Math.random()*k*2)-k;return this.#b.filters=[],CmnTween.tween(TW_INT_TRANS,e,this.#b,{x:0,y:0},()=>{B(),G()},()=>{o.remove(D),this.#e.visible=!0,this.#b.visible=!1,this.#b.x=0,this.#b.y=0},()=>{}),o.add(D),!1}#re(e){const{layer:t,render:r,name:o}=e;if(!t)throw"layerは必須です";const D=this.#o[this.#V(e)],N=D.fore;let k=()=>{};r&&!this.#c.isSkipping&&(N.renderStart(),k=()=>N.renderEnd());const B=CmnTween.cnvTweenArg(e,N),G=argChk_Boolean(e,"arrive",!1),U=argChk_Boolean(e,"backlay",!1),H=D.back.ctn;return CmnTween.tween(o??t,e,N,CmnTween.cnvTweenArg(e,N),()=>{},k,()=>{if(G&&Object.assign(N,B),U)for(const $ of Object.keys(CmnTween.hMemberCnt))H[$]=N[$]}),"filter"in e&&(N.ctn.filters=[Layer.bldFilters(e)],N.aFltHArg=[e]),!1}#N(e){return this.#R(e,t=>{const r=this.#o[this.#V({layer:t})];if(e.page==="both"){this.#w(r.fore,e),this.#w(r.back,e);return}const o=r.getPage(e);this.#w(o,e)}),!1}#w(e,t){const r=e.ctn;r.filters??=[],r.filters=[...r.filters,Layer.bldFilters(t)],e.aFltHArg.push(t)}#Q(e){return this.#R(e,t=>{const r=this.#o[this.#V({layer:t})];if(e.page==="both"){const D=r.fore,N=r.back;D.ctn.filters=null,N.ctn.filters=null,D.aFltHArg=[],N.aFltHArg=[];return}const o=r.getPage(e);o.ctn.filters=null,o.aFltHArg=[]}),!1}#z(e){return this.#R(e,t=>{const r=this.#o[this.#V({layer:t})];if(e.page==="both"){this.#X(r.fore,e),this.#X(r.back,e);return}const o=r.getPage(e);this.#X(o,e)}),!1}#X(e,t){const r=e.ctn;if(!r.filters)throw"フィルターがありません";const o=uint(argChk_Num(t,"index",0)),D=r.filters.length;if(D<=o)throw`フィルターの個数（${D}）を越えています`;e.aFltHArg[o].enabled=r.filters[o].enabled=argChk_Boolean(t,"enabled",!0)}static#k=10;static get msecChWait(){return LayerMng.#k}#F(e){const{text:t}=e;if(!t)throw"textは必須です";const r=this.#E(e);delete e.text,this.setNormalChWait(),this.#c.isSkipping?e.wait=0:"wait"in e&&argChk_Num(e,"wait",NaN);const o=encodeURIComponent(JSON.stringify(e));this.#m("add｜"+o,r);const D=argChk_Boolean(e,"record",!0),N=this.val.doRecLog();return D||this.val.setVal_Nochk("save","sn.doRecLog",D),r.tagCh(t.replaceAll("[r]",`
`)),this.val.setVal_Nochk("save","sn.doRecLog",N),this.#m("add_close｜",r),!1}#E=e=>{throw this.#C(),0};#ee(e){const t=this.#V(e,this.#D),r=this.#o[t].getPage(e);if(!(r instanceof TxtLayer))throw t+"はTxtLayerではありません";return r}setNormalChWait(){LayerMng.#k=this.scrItr.normalWait}#Z=e=>{throw this.#C(),0};#K(e){const{layer:t}=e;if(!t)throw"[current] layerは必須です";const r=this.#o[t];if(!r||!(r.getPage(e)instanceof TxtLayer))throw`${t}はTxtLayerではありません`;this.#I=r,this.recPagebreak(),this.#D=t,this.val.setVal_Nochk("save","const.sn.mesLayer",t);for(const o of this.#x){const{fore:D,back:N}=this.#o[o];D instanceof TxtLayer&&(D.isCur=N.isCur=o===t)}return!1}get currentTxtlayForeNeedErr(){return this.#C(),this.currentTxtlayFore}get currentTxtlayFore(){return this.#I?this.#I.fore:null}#I;#C=()=>{throw"文字レイヤーがありません。文字表示や操作する前に、[add_lay layer=（レイヤ名） class=txt]で文字レイヤを追加して下さい"};#V(e,t=""){const r=e.layer??t;if(r.includes(","))throw"layer名に「,」は使えません";if(!(r in this.#o))throw"属性 layer【"+r+"】が不正です。レイヤーがありません";return e.layer=r}#B={text:""};#W=[];recText(e){this.#B={text:e},this.val.setVal_Nochk("save","const.sn.sLog",String(this.val.getVal("const.sn.log.json")))}recPagebreak(){this.#B.text&&(this.#B.text=this.#B.text.replaceAll("</span><span class='sn_ch'>",""),this.#W.push(this.#B)>this.cfg.oCfg.log.max_len&&(this.#W=this.#W.slice(-this.cfg.oCfg.log.max_len)),this.#B={text:""})}#ae(e){const t=this.#E(e);return e.layer===this.#D&&e.page==="fore"&&this.recPagebreak(),t.clearText(),!1}#he(e){return this.#m("endlink｜",this.#E(e)),!1}#ie(e){return argChk_Boolean(e,"rec_page_break",!0)&&this.recPagebreak(),this.#I&&(this.#I.fore.clearLay(e),this.#I.back.clearLay(e)),!1}#le(e){if(!e.pic)throw"[graph] picは必須です";const t=encodeURIComponent(JSON.stringify(e));return this.#m("grp｜"+t,this.#E(e)),!1}#j(e){if(!e.fn&&!e.label&&!e.url)throw"fn,label,url いずれかは必須です";e.fn??=this.scrItr.scriptFn,e.style??="background-color: rgba(255,0,0,0.5);",e.style_hover??="background-color: rgba(255,0,0,0.9);",e.style_clicked??=e.style;const t=encodeURIComponent(JSON.stringify(e));return this.#m("link｜"+t,this.#E(e)),!1}#ue(e){return e.text=`
`,this.#F(e)}#se(e){return this.#ne({...e,text:"[r]"})}#ne(e){return this.#B={...e,text:this.#B.text},e.text?(e.record=!0,e.style??="",e.style+="display: none;",e.wait=0,this.#F(e)):!1}#ce(e){return this.#W=[],this.#B={text:e.text??""},this.val.setVal_Nochk("save","const.sn.sLog",e.text?`[{text:"${e.text}"}]`:"[]"),!1}#fe(e){const{t,r}=e;if(!t)throw"[ruby2] tは必須です";if(!r)throw"[ruby2] rは必須です";return e.text="｜"+encodeURIComponent(t)+"《"+encodeURIComponent(r)+"》",delete e.t,delete e.r,this.#F(e)}#de(e){const t=encodeURIComponent(JSON.stringify(e));return this.#m("span｜"+t,this.#E(e)),!1}#J(e){if(!e.t)throw"[tcy] tは必須です";const t=encodeURIComponent(JSON.stringify(e));return this.#m("tcy｜"+t,this.#E(e)),!1}#oe({layer:e}){console.group("🥟 [dump_lay]");for(const t of this.#M(e)){const{fore:r,back:o}=this.#o[t];try{console.info(`%c${r.name.slice(0,-7)} %o`,`color:#${CmnLib.isDarkMode?"49F":"05A"};`,JSON.parse(`{"back":{${o.dump()}}, "fore":{${r.dump()}}}`))}catch(D){console.error("dump_lay err:%o",D),console.error(`   back:${o.dump()}`),console.error(`   fore:${r.dump()}`)}}return console.groupEnd(),!1}#pe(e){const t=this.#V(e,this.#D),r=argChk_Boolean(e,"enabled",!0);return this.#E(e).enabled=r,this.val.setVal_Nochk("save","const.sn.layer."+t+".enabled",r),!1}#ge(e){return Pages.argChk_page(e,"back"),e.fn??=this.scrItr.scriptFn,this.#E(e).addButton(e),this.scrItr.recodeDesign(e),!1}record(){const e={};for(const t of this.#x){const r=this.#o[t];e[t]={cls:r.cls,fore:r.fore.record(),back:r.back.record()}}return e}playback(e){this.#W=JSON.parse(String(this.val.getVal("save:const.sn.sLog"))),this.#B={text:""};const t=[],r=[];for(const[D,{fore:N,fore:{idx:k},back:B,cls:G}]of Object.entries(e)){r.push({ln:D,idx:k});const U=this.#o[D]??=new Pages(D,G,this.#e,this.#r,{},this.sys,this.val,{isWait:!1});U.fore.playback(N,t),U.back.playback(B,t)}const o=this.#e.children.length;return t.push(new Promise(D=>{for(const{ln:N,idx:k}of r.sort(({idx:B},{idx:G})=>B===G?0:B<G?-1:1)){const{fore:B,back:G}=this.#o[N];if(!B)continue;const U=o>k?k:o-1;this.#e.setChildIndex(B.ctn,U),this.#r.setChildIndex(G.ctn,U)}D()})),t}}const LayerMng$1=Object.freeze(Object.defineProperty({__proto__:null,LayerMng},Symbol.toStringTag,{value:"Module"}));class TxtLayer extends Layer{static#t;static#e;static#r;static#s;static init(e,t,r,o,D,N){TxtLayer.#t=e,TxtStage.init(e,N),TxtLayer.#e=r,TxtLayer.#s=o,TxtLayer.#r=D,r.setDoRecProc(TxtLayer.chgDoRec),t.autowc=k=>TxtLayer.#n(k),t.autowc({enabled:!1,text:"",time:0}),t.ch_in_style=k=>TxtLayer.#i(k),t.ch_out_style=k=>TxtLayer.#a(k),TxtStage.initChStyle(),initStyle(),addStyle(e.matchPath(".+",SEARCH_PATH_ARG_EXT.FONT).flatMap(k=>Object.values(k).map(B=>`
@font-face {
	font-family: '${B}';
	src: url('${this.#t.searchPath(B,SEARCH_PATH_ARG_EXT.FONT)}');
}
`)).join("")+`
.sn_tx {
	pointer-events: none;
	user-select: none;
	-webkit-touch-callout: none;
	box-sizing: border-box;
}
.sn_ch {
	position: relative;
	display: inline-block;
}
`),TxtLayer.#i({name:"default",wait:500,alpha:0,x:"=0.3",y:"=0",scale_x:1,scale_y:1,rotate:0,join:!0,ease:"ease-out"}),TxtLayer.#a({name:"default",wait:0,alpha:0,x:"=0",y:"=0",scale_x:1,scale_y:1,rotate:0,join:!1,ease:"ease-out"})}static#i(e){const t=TxtStage.ch_in_style(e),r=t.x.startsWith("=")?`${t.nx*100}%`:`${t.nx}px`,o=t.y.startsWith("=")?`${t.ny*100}%`:`${t.ny}px`,{name:D}=e;return addStyle(`
.sn_ch_in_${D} {
	position: relative;
	display: inline-block;
}
.go_ch_in_${D} {
	opacity: ${t.alpha};
	position: relative;
	display: inline-block;
	animation: sn_ch_in_${D} ${t.wait}ms ${t.ease} 0s both;
}
@keyframes sn_ch_in_${D} {
	from {transform: rotate(${t.rotate}deg) scale(${t.scale_x}, ${t.scale_y}) translate(${r}, ${o})}
	to {opacity: 1; transform: none;}
}
`),!1}static#a(e){const t=TxtStage.ch_out_style(e),r=t.x.startsWith("=")?`${t.nx*100}%`:`${t.nx}px`,o=t.y.startsWith("=")?`${t.ny*100}%`:`${t.ny}px`,{name:D}=e;return addStyle(`
.go_ch_out_${D} {
	position: relative;
	display: inline-block;
	animation: go_ch_out_${D} ${t.wait}ms ${t.ease} 0s both;
}
@keyframes go_ch_out_${D} {
	to {
		opacity: ${t.alpha};
		transform: rotate(${t.rotate}deg) scale(${t.scale_x}, ${t.scale_y}) translate(${r}, ${o});
	}
`),!1}static#h;static#d;static setEvtMng(e,t,r){TxtLayer.#h=e,TxtLayer.#d=t,TxtStage.setEvtMng(e,r)}static#l=!1;static#f={};static#n(e){TxtLayer.#l=argChk_Boolean(e,"enabled",TxtLayer.#l),TxtLayer.#e.setVal_Nochk("save","const.sn.autowc.enabled",TxtLayer.#l);const{text:t}=e;if("text"in e!="time"in e)throw"[autowc] textとtimeは同時指定必須です";if(TxtLayer.#e.setVal_Nochk("save","const.sn.autowc.text",t),!t)return TxtLayer.#e.setVal_Nochk("save","const.sn.autowc.time",""),!1;const r=t.length;if(TxtLayer.#l&&r===0)throw'[autowc] enabled === false かつ text === "" は許されません';const o=String(e.time).split(",");if(o.length!==r)throw"[autowc] text文字数とtimeに記述された待ち時間（コンマ区切り）は同数にして下さい";TxtLayer.#f={};for(let D=0;D<r;++D)TxtLayer.#f[t[D]]=uint(o[D]);return TxtLayer.#e.setVal_Nochk("save","const.sn.autowc.time",e.time),!1}#c=0;#g=0;#m=!1;#p=void 0;#y="";#u=new TxtStage(this.ctn,()=>this.canFocus(),TxtLayer.#d);#A=new RubySpliter;#v=document.createElement("span");static#_={"text-align":0,"text-align-last":0,height:0,width:0,"padding-left":0,"padding-right":0,"padding-top":0,"padding-bottom":0};#o=new Container;constructor(){super(),this.ctn.addChild(this.#u),this.#A.init(this.#w),this.ctn.addChild(this.#o),this.#o.name="cntBtn",this.lay({style:`width: ${CmnLib.stageW}px; height: ${CmnLib.stageH}px; font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif; color: white; font-size: 24px; line-height: 1.5; padding: 16px;`,in_style:"default",out_style:"default",back_clear:"true"})}destroy(){this.#p&&(this.ctn.removeChild(this.#p).destroy(),this.#p=void 0),TxtLayer.#s.recPagebreak(),this.#u.destroy()}static destroy(){TxtLayer.#l=!1,TxtLayer.#f={},TxtLayer.#M=e=>e}set name(e){this.name_=e,this.#u.name=e}get name(){return this.name_}cvsResize(){this.#u.cvsResize()}cvsResizeChildren(){for(const e of this.#o.children)e.cvsResize()}procSetX(e){this.#u.lay({x:e})}procSetY(e){this.#u.lay({y:e})}lay(e){if(super.lay(e),Layer.setXY(this.ctn,e,this.ctn),e[":id_tag"]=this.name_.slice(0,-7),RubySpliter.setting(e),this.#O(e),this.#u.lay(e),"r_align"in e&&(this.#L=e.r_align??""),this.#R=CmnLib.isSafari?this.#u.tategaki?(o,D)=>`text-align: start; height: ${D}em; padding-top: ${o}; padding-bottom: ${o};`:(o,D)=>`text-align: start; width: ${D}em; padding-left: ${o}; padding-right: ${o};`:this.#u.tategaki?o=>`text-align: justify; text-align-last: justify; padding-top: ${o}; padding-bottom: ${o};`:o=>`text-align: justify; text-align-last: justify; padding-left: ${o}; padding-right: ${o};`,CmnLib.isFirefox&&(this.#T=this.#re),"r_style"in e)if(e.r_style){const o=document.createElement("span");o.style.cssText=e.r_style;const D=o.style.length,N=this.#v.style;for(let k=0;k<D;++k){const B=o.style[k];if(B in TxtLayer.#_){DebugMng.myTrace(`${B}は指定できません`,"W");continue}const G=o.style[B];G&&(N[B]=G)}}else this.#v.style.cssText="";if("alpha"in e)for(const o of this.#o.children)o.alpha=this.ctn.alpha;this.#x(e),this.#Y(e);const t=Reading.procID+`TxtLayer lay name:${this.name_}`,r=this.#q(e,o=>{o&&Reading.endProc(t)});return r&&Reading.beginProc(t),r}#x(e){const{in_style:t}=e;if(!t)return;const r=TxtStage.getChInStyle(t);if(!r)throw`存在しないin_style【${t}】です`;this.#D=t,this.#G=r.join}#D="";#G=!0;get width(){return this.#u.getWidth}get height(){return this.#u.getHeight}#Y(e){const{out_style:t}=e;if(t){if(!TxtStage.getChOutStyle(t))throw`存在しないout_style【${t}】です`;this.#$=t}}#$="";#H=new SpritesMng;#q(e,t){if("back_clear"in e)return argChk_Boolean(e,"back_clear",!1)&&(this.#c=0,this.#g=0,this.#m=!1,this.#y=""),t(!1),!1;this.#g=argChk_Num(e,"b_alpha",this.#g),this.#m=argChk_Boolean(e,"b_alpha_isfixed",this.#m);const r=(this.#m?1:Number(TxtLayer.#e.getVal("sys:TextLayer.Back.Alpha")))*this.#g;if(e.b_pic){if(this.#y!==e.b_pic)return this.#y=e.b_pic,this.#p&&(this.ctn.removeChild(this.#p),this.#p.destroy()),this.#H=new SpritesMng(this.#y,this.ctn,o=>{this.#p=o,o.name="back(pic)",o.visible=r>0,o.alpha=r,this.#u.setMySize(o.width,o.height),this.ctn.setChildIndex(o,0),t(!0)}),this.#H.ret}else"b_color"in e&&(this.#c=argChk_Color(e,"b_color",0),this.#p&&(this.ctn.removeChild(this.#p),this.#p.destroy()),this.#y="",this.ctn.addChildAt((this.#p=new Graphics).beginFill(this.#c,r).lineStyle(void 0).drawRect(0,0,this.#u.getWidth,this.#u.getHeight).endFill(),0),this.#p.name="back(color)");return this.#p&&(this.#p.visible=r>0,this.#p.alpha=r),t(!1),!1}chgBackAlpha(e){const t=this.#m?this.#g:e*this.#g;this.#p instanceof Graphics&&(this.#p&&(this.ctn.removeChild(this.#p),this.#p.destroy()),this.ctn.addChildAt((this.#p=new Graphics).beginFill(this.#c,t).lineStyle(void 0).drawRect(0,0,this.#u.getWidth,this.#u.getHeight).endFill(),0),this.#p.name="back(color)"),this.#p&&(this.#p.visible=t>0,this.#p.alpha=t)}#O(e){"noffs"in e&&(this.#b=e.noffs??"",this.#P=new RegExp(`[　${this.#b}]`)),"ffs"in e&&(this.#S??="",this.#U=this.#S===""?()=>"":t=>this.#P.test(t)?"":` font-feature-settings: ${this.#S};`)}#S="";#U=e=>"";#b="";#P=/[　]/;static chgDoRec(e){TxtLayer.#M=e?t=>t:t=>`<span class='offrec'>${t}</span>`}static#M=e=>e;isCur=!1;#R=()=>"";#T=(e,t,r,o="")=>{if(!r)return` style='${o}'`;const D=e.length*2;if(D-t.length<0)return` style='text-align: ${r}; ${o}'`;let N="";switch(r){case"justify":N=this.#R("0",D);break;case"121":N=this.#R(`calc(${(D-t.length)/(t.length*2)}em)`,D);break;case"even":N=this.#R(`calc(${(D-t.length)/(t.length+1)}em)`,D);break;case"1ruby":N=this.#R("1em",D);break;default:N=`text-align: ${r};`}return` style='${N} ${o}'`};#L="";#re(e,t,r,o=""){if(!r)return` style='${o}'`;const D=e.length*2;if(D-t.length<0)return` style='text-align: ${r}; ${o}'`;let N="";switch(r){case"left":N="ruby-align: start;";break;case"center":N="ruby-align: center;";break;case"right":N="ruby-align: start;";break;case"justify":N="ruby-align: space-between;";break;case"121":N="ruby-align: space-around;";break;case"even":const k=(D-t.length)/(t.length+1);N="ruby-align: space-between; "+(this.#u.tategaki?`padding-top: ${k}em; padding-bottom: ${k}em;`:`padding-left: ${k}em; padding-right: ${k}em;`);break;case"1ruby":N="ruby-align: space-between; "+(this.#u.tategaki?"padding-top: 1em; padding-bottom: 1em;":"padding-left: 1em; padding-right: 1em;");break;default:N=`text-align: ${r};`}return` style='${N} ${o}'`}tagCh(e){this.#A.putTxt(e)}#N=!1;get needGoTxt(){return this.#N}#w=(e,t)=>{TxtLayer.#t.oCfg.debug.putCh&&console.log(`🖊 文字表示 text:\`${e}\`(${e.charCodeAt(0).toString(16)}) ruby:\`${t}\` name:\`${this.name_}\``);const r=t.split("｜");let o="";const[D,...N]=r,k=N.join("｜");switch(r.length){case 1:if(this.#N=!0,e===`
`){this.#k?(this.#k=!1,o="<ruby>&emsp;<rt>&emsp;</rt></ruby><br/>"):o="<br/>";break}this.#k&&(this.#k=!1,t===""&&(t="&emsp;")),o=this.#Q(e,t,this.#L);break;default:switch(D){case"start":case"left":case"center":case"right":case"justify":case"121":case"even":case"1ruby":this.#k=!1,this.#N=!0,o=this.#Q(e,k,D);break;case"gotxt":this.#Z(),this.#N?(this.isCur&&TxtLayer.#s.recText(this.#F.join("").replace(/^<ruby>&emsp;<rt>&emsp;<\/rt><\/ruby>(<br\/>)+/,"").replaceAll(/style='(anim\S+ [^;]+;\s*)+/g,"style='").replaceAll(/( style=''| data-(add|arg|cmd)='[^']+'|\n+|\t+)/g,"").replaceAll(/class='sn_ch[^']+/g,"class='sn_ch").replaceAll("display: none;","").replaceAll("class='offrec'","style='display: none;'")),this.#u.goTxt(this.#F,this.#X===0),this.#N=!1,this.#X=0):this.isCur&&this.#u.noticeCompTxt();return;case"add":{const B=JSON.parse(k),{style:G="",wait:U=null}=B,{cl:H,sty:$}=this.#z(!0,U);this.#F.push(`<span${H} style='${$} display: inline; ${G}'>`),delete B.style,this.#ee(B)}return;case"add_close":this.#F.push("</span>"),this.#Z();return;case"grp":this.#N=!0;{const B=JSON.parse(k);if(B.id??=this.#F.length,B.id==="break"){this.#u.dispBreak(B);return}this.#k=!1,B.delay=this.#X,B.r??="",B.style??="",B.r_style??="";const{cl:G,sty:U,lnk:H}=this.#z(!0,B.wait);o=`<span${G} style='${U} ${B.style}'><ruby><span data-cmd='grp' data-arg='${JSON.stringify(B)}'${H} style='${U} display: inline;'>&emsp;</span><rt${H}${this.#T("　",B.r,this.#L,this.#v.style.cssText+(this.#E.at(-1)?.o.r_style??"")+B.r_style)}>${B.r}</rt></ruby></span>`}break;case"tcy":this.#k=!1,this.#N=!0;{const{t:B,r:G="",wait:U=null,style:H="",r_style:$=""}=JSON.parse(k);TxtLayer.#e.doRecLog()&&(this.#I+=e+(t?`《${t}》`:""),this.#C+=B);const V=CmnLib.isSafari?G.replaceAll(/[A-Za-z0-9]/g,W=>String.fromCharCode(W.charCodeAt(0)+65248)):G,{cl:Y,sty:X,lnk:z}=this.#z(!0,U);o=`<span${Y} style='${X}${this.#U(B)} ${H}'><ruby><span${z} style='${X} display: inline; text-combine-upright: all;'>${B}</span><rt${z}${this.#T(B,V,this.#L,this.#v.style.cssText+(this.#E.at(-1)?.o.r_style??"")+$)}>${V}</rt></ruby></span>`}break;case"del":TxtStage.delBreak();return;case"span":this.#N=!0,this.#K(JSON.parse(k));return;case"link":this.#N=!0;{const B=JSON.parse(k);B[":link"]=" data-lnk='@'";const{cl:G,sty:U,curpos:H}=this.#z(!1,B.wait);this.#F.push(`<span${G} style='${U} display: inline; ${B.style??""}' ${H} data-arg='${k}'>`),delete B.style,this.#K(B)}return;case"endlink":this.#N=!0,this.#F.push("</span>"),this.#Z();return;default:this.#N=!0,o=this.#Q(e,t,this.#L)}break}this.#F.push(TxtLayer.#M(o))};#Q(e,t,r){const o=e===" "?"&nbsp;":e==="　"?"&emsp;":e;TxtLayer.#e.doRecLog()&&(this.#I+=o+(t?`《${t}》`:""),e!==" "&&(this.#C+=e));const{cl:D,sty:N,lnk:k}=this.#z(!0,null,e);return t?`<span${D} style='${N} ${this.#U(e)}'><ruby>${Array.from(e).map((B,G)=>`<span${D}${k} style='${G>0?this.#z(!0,null,e).sty:N} display: inline;'>${B===" "?"&nbsp;":B==="　"?"&emsp;":B}</span>`).join("")}<rt${k}${this.#T(e,t,r,this.#v.style.cssText+(this.#E.at(-1)?.o.r_style??""))}>${t}</rt></ruby></span>`:`<span${D} style='${N} ${this.#U(e)}'${k}>${o}</span>`}#z(e,t,r=`
`){const o=this.#G?t??this.#E.at(0)?.o.wait??(TxtLayer.#l?TxtLayer.#f[r.at(0)??""]??0:LayerMng.msecChWait):0;TxtLayer.#h.isSkipping?this.#X=0:e&&this.#G&&(this.#X+=Number(o));const D=`data-add='{"ch_in_style":"${this.#D}", "ch_out_style":"${this.#$}"}'`;return{cl:` class='sn_ch sn_ch_yet sn_ch_in_${this.#D}'`,sty:`animation-delay: ${this.#X}ms;${this.#E.at(-1)?.o.style??""}`,lnk:(this.#E.at(0)?.o[":link"]??"")+" "+D,curpos:D}}#X=0;#k=!0;#F=[];#E=[];#ee(e){this.#E.push({o:e,r_align:this.#L,ch_in_style:this.#D,ch_out_style:this.#$}),"r_align"in e&&(this.#L=e.r_align),this.#x(e),this.#Y(e)}#Z(){const e=this.#E.pop();e&&(this.#L=e.r_align,this.#x({in_style:e.ch_in_style}),this.#Y({out_style:e.ch_out_style}))}#K(e){const t=this.#E.at(-1);if(!t){this.#ee(e);return}t.o={...t.o,...e},!e.style&&!e.r_style&&(t.o.style="",t.o.r_style=""),"r_align"in e&&(this.#L=e.r_align),this.#x(e),this.#Y(e)}click=()=>!this.ctn.interactiveChildren||!this.ctn.visible?!1:this.#u.skipChIn();clearText(){this.ctn.addChild(this.#u=this.#u.reNew()),this.#X=0,this.#k=!0,this.#F=[],this.#I="",this.#C="",TxtLayer.#s.recPagebreak()}#I="";#C="";get pageText(){return this.#I.replace("《&emsp;》","")}get pagePlainText(){return this.#C}get enabled(){return this.ctn.interactiveChildren}set enabled(e){this.ctn.interactiveChildren=e}addButton=e=>new Promise(t=>{e.key=`btn=[${this.#o.children.length}] `+this.name_,e[":id_tag"]=e.key.slice(0,-7),argChk_Boolean(e,"hint_tate",this.#u.tategaki);const r=new Button(e,TxtLayer.#h,()=>t(),()=>this.canFocus());r.name=JSON.stringify(e).replaceAll('"',"'"),this.#o.addChild(r)});canFocus(){return(this.ctn.interactiveChildren??!1)&&this.ctn.visible&&TxtLayer.#r(this)}clearLay(e){super.clearLay(e),this.clearText();for(const t of this.#o.removeChildren())t.destroy()}record=()=>({...super.record(),enabled:this.enabled,r_cssText:this.#v.style.cssText,r_align:this.#L,b_do:this.#p===void 0?void 0:this.#p instanceof Sprite?"Sprite":"Graphics",b_pic:this.#y,b_color:this.#c,b_alpha:this.#g,b_alpha_isfixed:this.#m,ffs:this.#S,txs:this.#u.record(),strNoFFS:this.#b,btns:this.#o.children.map(e=>e.name)});playback(e,t){super.playback(e,t),this.enabled=e.enabled,this.#v.style.cssText=e.r_cssText,this.#L=e.r_align,this.cvsResize(),this.#O(e),this.#u.playback(e.txs),this.#g=e.b_alpha,this.#m=e.b_alpha_isfixed,t=[t,new Promise(r=>{const o=e.b_do?e.b_do==="Sprite"?{b_pic:e.b_pic}:{b_color:e.b_color}:{b_pic:""};o.b_alpha=e.b_alpha,o.b_alpha_isfixed=e.b_alpha_isfixed,this.#q(o,D=>{D&&r()})||r()}),e.btns.map(r=>new Promise(o=>{this.addButton(JSON.parse(r.replaceAll("'",'"'))),o()}))].flat()}get cssText(){return this.#u.cssText}set cssText(e){this.#u.cssText=e}snapshot(e,t){e.render(this.ctn,{clear:!1}),this.#u.snapshot(e,t)}snapshot_end(){this.#u.snapshot_end()}makeDesignCast(e){this.ctn.visible&&this.#u.makeDesignCast(e)}makeDesignCastChildren(e){if(this.ctn.visible)for(const t of this.#o.children)t.makeDesignCast(e)}showDesignCast(){this.#u.showDesignCast()}showDesignCastChildren(){for(const e of this.#o.children)e.showDesignCast()}dump(){return this.#w("","gotxt｜"),super.dump()+`, "enabled":"${this.enabled}", ${this.#u.dump()}, "b_pic":"${this.#y}", "b_color":"${this.#c}", "b_alpha":${this.#g}, "b_alpha_isfixed":"${this.#m}", "width":${this.#u.getWidth}, "height":${this.#u.getHeight}, "pixi_obj":[${this.ctn.children.map(e=>`{"class":"${e instanceof Sprite?"Sprite":e instanceof Graphics?"Graphics":e instanceof Container?"Container":"?"}", "name":"${e.name}", "alpha":${e.alpha}, "x":${e.x}, "y":${e.y}, "visible":"${e.visible}"}`).join(",")}], "button":[${this.#o.children.map(e=>e.children[0]?.name??"{}").join(",")}]`}}class FocusMng{#t=[];#e=-1;#r=new EventListenerCtn;destroy(){this.#t=[],this.#e=-1,this.#r.clear()}add(e,t,r){if(this.#t.findIndex(k=>k.btn===e)>=0)return;if(e instanceof Container){e.on("pointerdown",()=>{for(let k=this.#t.length-1;k>=0;--k)if(this.#t[k].btn===e){this.#e=k;return}this.#e=-1}),this.#t.push({btn:e,on:t,off:r});return}this.#r.add(e,"focus",()=>{for(let k=this.#t.length-1;k>=0;--k)if(this.#t[k].btn===e){this.#e=k;return}this.#e=-1});let o=k=>{},D=e.localName==="button"||e.localName==="a"?k=>!k.isTrusted&&k.key==="Enter":k=>k.key==="Enter";const N=e;switch(N.type??""){case"checkbox":o=()=>N.checked=!N.checked;break;case"":e.querySelectorAll("input[type]").length>0&&(o=k=>this.#s(e,k.key),D=()=>!1);break;case"range":o=k=>{k.isTrusted||(k.key==="ArrowUp"?N.stepUp():N.stepDown())};break;case"text":case"textarea":o=k=>{if(k.isTrusted)return;let B=(N.selectionStart??0)+(k.key==="ArrowUp"?-1:1);B<0&&(B=0),N.setSelectionRange(B,B)};break}this.#r.add(e,EVNM_KEY,k=>{if(!(k.key!=="ArrowUp"&&k.key!=="ArrowDown"&&k.key!=="Enter")){if(k.stopImmediatePropagation(),D(k)){e.dispatchEvent(new MouseEvent("click"));return}o(k)}},{passive:!0}),e.hasAttribute("tabindex")||(e.tabIndex=0),this.#t.push({btn:e,on:t,off:r})}remove(e){const t=this.#t.findIndex(r=>r.btn===e);t<0||(this.#t.splice(t,1),this.#t.length===0?this.#e=-1:t<=this.#e&&--this.#e)}#s(e,t){const r=e.querySelectorAll("input[type]"),o=r.length;for(let D=0;D<o;++D)if(r[D].checked){r[(D+o+(t==="ArrowUp"?-1:1))%o].checked=!0;break}}isFocus(e){return this.#e<0?!1:this.#t[this.#e].btn===e}prev(){this.#a();const e=this.#t.length;if(e!==0){--this.#e<0&&(this.#e=e-1);for(let t=e;t>=1;--t){const r=(this.#e+t)%e;if(this.#t[r].on()){this.#e=r,this.#i(r);return}}this.#e=-1}}next(){this.#a();const e=this.#t.length;if(e!==0){++this.#e>=e&&(this.#e=0);for(let t=0;t<e;++t){const r=(this.#e+t)%e;if(this.#t[r].on()){this.#e=r,this.#i(r);return}}this.#e=-1}}#i=CmnLib.debugLog?e=>console.log(`👾 <FocusMng idx:${e} btn:%o`,this.#t[e].btn):()=>{};getFocus(){if(this.#e<0)return null;this.#a(),this.#e>=this.#t.length&&(this.#e=0);const e=this.#t[this.#e];return e.on()?e.btn:null}blur(){this.#a(),this.#e=-1,globalThis.focus()}#a(){for(let e=this.#t.length-1;e>=0;--e){const t=this.#t[e];!(t.btn instanceof Container)||t.btn.parent?t.off():this.#t.splice(e,1)}}}var top="top",bottom="bottom",right="right",left="left",auto="auto",basePlacements=[top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacements.reduce(function(n,e){return n.concat([e+"-"+start,e+"-"+end])},[]),placements=[].concat(basePlacements,[auto]).reduce(function(n,e){return n.concat([e,e+"-"+start,e+"-"+end])},[]),beforeRead="beforeRead",read="read",afterRead="afterRead",beforeMain="beforeMain",main$1="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,read,afterRead,beforeMain,main$1,afterMain,beforeWrite,write,afterWrite];function getNodeName(n){return n?(n.nodeName||"").toLowerCase():null}function getWindow(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function isElement(n){var e=getWindow(n).Element;return n instanceof e||n instanceof Element}function isHTMLElement(n){var e=getWindow(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function isShadowRoot(n){if(typeof ShadowRoot>"u")return!1;var e=getWindow(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function applyStyles(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var r=e.styles[t]||{},o=e.attributes[t]||{},D=e.elements[t];!isHTMLElement(D)||!getNodeName(D)||(Object.assign(D.style,r),Object.keys(o).forEach(function(N){var k=o[N];k===!1?D.removeAttribute(N):D.setAttribute(N,k===!0?"":k)}))})}function effect$2(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(r){var o=e.elements[r],D=e.attributes[r]||{},N=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:t[r]),k=N.reduce(function(B,G){return B[G]="",B},{});!isHTMLElement(o)||!getNodeName(o)||(Object.assign(o.style,k),Object.keys(D).forEach(function(B){o.removeAttribute(B)}))})}}const applyStyles$1={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:effect$2,requires:["computeStyles"]};function getBasePlacement(n){return n.split("-")[0]}var max=Math.max,min=Math.min,round=Math.round;function getUAString(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}function getBoundingClientRect(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var r=n.getBoundingClientRect(),o=1,D=1;e&&isHTMLElement(n)&&(o=n.offsetWidth>0&&round(r.width)/n.offsetWidth||1,D=n.offsetHeight>0&&round(r.height)/n.offsetHeight||1);var N=isElement(n)?getWindow(n):window,k=N.visualViewport,B=!isLayoutViewport()&&t,G=(r.left+(B&&k?k.offsetLeft:0))/o,U=(r.top+(B&&k?k.offsetTop:0))/D,H=r.width/o,$=r.height/D;return{width:H,height:$,top:U,right:G+H,bottom:U+$,left:G,x:G,y:U}}function getLayoutRect(n){var e=getBoundingClientRect(n),t=n.offsetWidth,r=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:r}}function contains(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&isShadowRoot(t)){var r=e;do{if(r&&n.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function getComputedStyle$1(n){return getWindow(n).getComputedStyle(n)}function isTableElement(n){return["table","td","th"].indexOf(getNodeName(n))>=0}function getDocumentElement(n){return((isElement(n)?n.ownerDocument:n.document)||window.document).documentElement}function getParentNode(n){return getNodeName(n)==="html"?n:n.assignedSlot||n.parentNode||(isShadowRoot(n)?n.host:null)||getDocumentElement(n)}function getTrueOffsetParent(n){return!isHTMLElement(n)||getComputedStyle$1(n).position==="fixed"?null:n.offsetParent}function getContainingBlock(n){var e=/firefox/i.test(getUAString()),t=/Trident/i.test(getUAString());if(t&&isHTMLElement(n)){var r=getComputedStyle$1(n);if(r.position==="fixed")return null}var o=getParentNode(n);for(isShadowRoot(o)&&(o=o.host);isHTMLElement(o)&&["html","body"].indexOf(getNodeName(o))<0;){var D=getComputedStyle$1(o);if(D.transform!=="none"||D.perspective!=="none"||D.contain==="paint"||["transform","perspective"].indexOf(D.willChange)!==-1||e&&D.willChange==="filter"||e&&D.filter&&D.filter!=="none")return o;o=o.parentNode}return null}function getOffsetParent(n){for(var e=getWindow(n),t=getTrueOffsetParent(n);t&&isTableElement(t)&&getComputedStyle$1(t).position==="static";)t=getTrueOffsetParent(t);return t&&(getNodeName(t)==="html"||getNodeName(t)==="body"&&getComputedStyle$1(t).position==="static")?e:t||getContainingBlock(n)||e}function getMainAxisFromPlacement(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function within(n,e,t){return max(n,min(e,t))}function withinMaxClamp(n,e,t){var r=within(n,e,t);return r>t?t:r}function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}function mergePaddingObject(n){return Object.assign({},getFreshSideObject(),n)}function expandToHashMap(n,e){return e.reduce(function(t,r){return t[r]=n,t},{})}var toPaddingObject=function(n,e){return n=typeof n=="function"?n(Object.assign({},e.rects,{placement:e.placement})):n,mergePaddingObject(typeof n!="number"?n:expandToHashMap(n,basePlacements))};function arrow(n){var e,t=n.state,r=n.name,o=n.options,D=t.elements.arrow,N=t.modifiersData.popperOffsets,k=getBasePlacement(t.placement),B=getMainAxisFromPlacement(k),G=[left,right].indexOf(k)>=0,U=G?"height":"width";if(!(!D||!N)){var H=toPaddingObject(o.padding,t),$=getLayoutRect(D),V=B==="y"?top:left,Y=B==="y"?bottom:right,X=t.rects.reference[U]+t.rects.reference[B]-N[B]-t.rects.popper[U],z=N[B]-t.rects.reference[B],W=getOffsetParent(D),q=W?B==="y"?W.clientHeight||0:W.clientWidth||0:0,K=X/2-z/2,Q=H[V],Z=q-$[U]-H[Y],ee=q/2-$[U]/2+K,J=within(Q,ee,Z),te=B;t.modifiersData[r]=(e={},e[te]=J,e.centerOffset=J-ee,e)}}function effect$1(n){var e=n.state,t=n.options,r=t.element,o=r===void 0?"[data-popper-arrow]":r;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||contains(e.elements.popper,o)&&(e.elements.arrow=o))}const arrow$1={name:"arrow",enabled:!0,phase:"main",fn:arrow,effect:effect$1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function getVariation(n){return n.split("-")[1]}var unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(n,e){var t=n.x,r=n.y,o=e.devicePixelRatio||1;return{x:round(t*o)/o||0,y:round(r*o)/o||0}}function mapToStyles(n){var e,t=n.popper,r=n.popperRect,o=n.placement,D=n.variation,N=n.offsets,k=n.position,B=n.gpuAcceleration,G=n.adaptive,U=n.roundOffsets,H=n.isFixed,$=N.x,V=$===void 0?0:$,Y=N.y,X=Y===void 0?0:Y,z=typeof U=="function"?U({x:V,y:X}):{x:V,y:X};V=z.x,X=z.y;var W=N.hasOwnProperty("x"),q=N.hasOwnProperty("y"),K=left,Q=top,Z=window;if(G){var ee=getOffsetParent(t),J="clientHeight",te="clientWidth";if(ee===getWindow(t)&&(ee=getDocumentElement(t),getComputedStyle$1(ee).position!=="static"&&k==="absolute"&&(J="scrollHeight",te="scrollWidth")),ee=ee,o===top||(o===left||o===right)&&D===end){Q=bottom;var oe=H&&ee===Z&&Z.visualViewport?Z.visualViewport.height:ee[J];X-=oe-r.height,X*=B?1:-1}if(o===left||(o===top||o===bottom)&&D===end){K=right;var ce=H&&ee===Z&&Z.visualViewport?Z.visualViewport.width:ee[te];V-=ce-r.width,V*=B?1:-1}}var fe=Object.assign({position:k},G&&unsetSides),me=U===!0?roundOffsetsByDPR({x:V,y:X},getWindow(t)):{x:V,y:X};if(V=me.x,X=me.y,B){var we;return Object.assign({},fe,(we={},we[Q]=q?"0":"",we[K]=W?"0":"",we.transform=(Z.devicePixelRatio||1)<=1?"translate("+V+"px, "+X+"px)":"translate3d("+V+"px, "+X+"px, 0)",we))}return Object.assign({},fe,(e={},e[Q]=q?X+"px":"",e[K]=W?V+"px":"",e.transform="",e))}function computeStyles(n){var e=n.state,t=n.options,r=t.gpuAcceleration,o=r===void 0?!0:r,D=t.adaptive,N=D===void 0?!0:D,k=t.roundOffsets,B=k===void 0?!0:k,G={placement:getBasePlacement(e.placement),variation:getVariation(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,mapToStyles(Object.assign({},G,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:N,roundOffsets:B})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,mapToStyles(Object.assign({},G,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:B})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const computeStyles$1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}};var passive={passive:!0};function effect(n){var e=n.state,t=n.instance,r=n.options,o=r.scroll,D=o===void 0?!0:o,N=r.resize,k=N===void 0?!0:N,B=getWindow(e.elements.popper),G=[].concat(e.scrollParents.reference,e.scrollParents.popper);return D&&G.forEach(function(U){U.addEventListener("scroll",t.update,passive)}),k&&B.addEventListener("resize",t.update,passive),function(){D&&G.forEach(function(U){U.removeEventListener("scroll",t.update,passive)}),k&&B.removeEventListener("resize",t.update,passive)}}const eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect,data:{}};var hash$1={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(n){return n.replace(/left|right|bottom|top/g,function(e){return hash$1[e]})}var hash={start:"end",end:"start"};function getOppositeVariationPlacement(n){return n.replace(/start|end/g,function(e){return hash[e]})}function getWindowScroll(n){var e=getWindow(n),t=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:t,scrollTop:r}}function getWindowScrollBarX(n){return getBoundingClientRect(getDocumentElement(n)).left+getWindowScroll(n).scrollLeft}function getViewportRect(n,e){var t=getWindow(n),r=getDocumentElement(n),o=t.visualViewport,D=r.clientWidth,N=r.clientHeight,k=0,B=0;if(o){D=o.width,N=o.height;var G=isLayoutViewport();(G||!G&&e==="fixed")&&(k=o.offsetLeft,B=o.offsetTop)}return{width:D,height:N,x:k+getWindowScrollBarX(n),y:B}}function getDocumentRect(n){var e,t=getDocumentElement(n),r=getWindowScroll(n),o=(e=n.ownerDocument)==null?void 0:e.body,D=max(t.scrollWidth,t.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),N=max(t.scrollHeight,t.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),k=-r.scrollLeft+getWindowScrollBarX(n),B=-r.scrollTop;return getComputedStyle$1(o||t).direction==="rtl"&&(k+=max(t.clientWidth,o?o.clientWidth:0)-D),{width:D,height:N,x:k,y:B}}function isScrollParent(n){var e=getComputedStyle$1(n),t=e.overflow,r=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+o+r)}function getScrollParent(n){return["html","body","#document"].indexOf(getNodeName(n))>=0?n.ownerDocument.body:isHTMLElement(n)&&isScrollParent(n)?n:getScrollParent(getParentNode(n))}function listScrollParents(n,e){var t;e===void 0&&(e=[]);var r=getScrollParent(n),o=r===((t=n.ownerDocument)==null?void 0:t.body),D=getWindow(r),N=o?[D].concat(D.visualViewport||[],isScrollParent(r)?r:[]):r,k=e.concat(N);return o?k:k.concat(listScrollParents(getParentNode(N)))}function rectToClientRect(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function getInnerBoundingClientRect(n,e){var t=getBoundingClientRect(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function getClientRectFromMixedType(n,e,t){return e===viewport?rectToClientRect(getViewportRect(n,t)):isElement(e)?getInnerBoundingClientRect(e,t):rectToClientRect(getDocumentRect(getDocumentElement(n)))}function getClippingParents(n){var e=listScrollParents(getParentNode(n)),t=["absolute","fixed"].indexOf(getComputedStyle$1(n).position)>=0,r=t&&isHTMLElement(n)?getOffsetParent(n):n;return isElement(r)?e.filter(function(o){return isElement(o)&&contains(o,r)&&getNodeName(o)!=="body"}):[]}function getClippingRect(n,e,t,r){var o=e==="clippingParents"?getClippingParents(n):[].concat(e),D=[].concat(o,[t]),N=D[0],k=D.reduce(function(B,G){var U=getClientRectFromMixedType(n,G,r);return B.top=max(U.top,B.top),B.right=min(U.right,B.right),B.bottom=min(U.bottom,B.bottom),B.left=max(U.left,B.left),B},getClientRectFromMixedType(n,N,r));return k.width=k.right-k.left,k.height=k.bottom-k.top,k.x=k.left,k.y=k.top,k}function computeOffsets(n){var e=n.reference,t=n.element,r=n.placement,o=r?getBasePlacement(r):null,D=r?getVariation(r):null,N=e.x+e.width/2-t.width/2,k=e.y+e.height/2-t.height/2,B;switch(o){case top:B={x:N,y:e.y-t.height};break;case bottom:B={x:N,y:e.y+e.height};break;case right:B={x:e.x+e.width,y:k};break;case left:B={x:e.x-t.width,y:k};break;default:B={x:e.x,y:e.y}}var G=o?getMainAxisFromPlacement(o):null;if(G!=null){var U=G==="y"?"height":"width";switch(D){case start:B[G]=B[G]-(e[U]/2-t[U]/2);break;case end:B[G]=B[G]+(e[U]/2-t[U]/2);break}}return B}function detectOverflow(n,e){e===void 0&&(e={});var t=e,r=t.placement,o=r===void 0?n.placement:r,D=t.strategy,N=D===void 0?n.strategy:D,k=t.boundary,B=k===void 0?clippingParents:k,G=t.rootBoundary,U=G===void 0?viewport:G,H=t.elementContext,$=H===void 0?popper:H,V=t.altBoundary,Y=V===void 0?!1:V,X=t.padding,z=X===void 0?0:X,W=mergePaddingObject(typeof z!="number"?z:expandToHashMap(z,basePlacements)),q=$===popper?reference:popper,K=n.rects.popper,Q=n.elements[Y?q:$],Z=getClippingRect(isElement(Q)?Q:Q.contextElement||getDocumentElement(n.elements.popper),B,U,N),ee=getBoundingClientRect(n.elements.reference),J=computeOffsets({reference:ee,element:K,placement:o}),te=rectToClientRect(Object.assign({},K,J)),oe=$===popper?te:ee,ce={top:Z.top-oe.top+W.top,bottom:oe.bottom-Z.bottom+W.bottom,left:Z.left-oe.left+W.left,right:oe.right-Z.right+W.right},fe=n.modifiersData.offset;if($===popper&&fe){var me=fe[o];Object.keys(ce).forEach(function(we){var Me=[right,bottom].indexOf(we)>=0?1:-1,Ee=[top,bottom].indexOf(we)>=0?"y":"x";ce[we]+=me[Ee]*Me})}return ce}function computeAutoPlacement(n,e){e===void 0&&(e={});var t=e,r=t.placement,o=t.boundary,D=t.rootBoundary,N=t.padding,k=t.flipVariations,B=t.allowedAutoPlacements,G=B===void 0?placements:B,U=getVariation(r),H=U?k?variationPlacements:variationPlacements.filter(function(Y){return getVariation(Y)===U}):basePlacements,$=H.filter(function(Y){return G.indexOf(Y)>=0});$.length===0&&($=H);var V=$.reduce(function(Y,X){return Y[X]=detectOverflow(n,{placement:X,boundary:o,rootBoundary:D,padding:N})[getBasePlacement(X)],Y},{});return Object.keys(V).sort(function(Y,X){return V[Y]-V[X]})}function getExpandedFallbackPlacements(n){if(getBasePlacement(n)===auto)return[];var e=getOppositePlacement(n);return[getOppositeVariationPlacement(n),e,getOppositeVariationPlacement(e)]}function flip(n){var e=n.state,t=n.options,r=n.name;if(!e.modifiersData[r]._skip){for(var o=t.mainAxis,D=o===void 0?!0:o,N=t.altAxis,k=N===void 0?!0:N,B=t.fallbackPlacements,G=t.padding,U=t.boundary,H=t.rootBoundary,$=t.altBoundary,V=t.flipVariations,Y=V===void 0?!0:V,X=t.allowedAutoPlacements,z=e.options.placement,W=getBasePlacement(z),q=W===z,K=B||(q||!Y?[getOppositePlacement(z)]:getExpandedFallbackPlacements(z)),Q=[z].concat(K).reduce(function(ve,Se){return ve.concat(getBasePlacement(Se)===auto?computeAutoPlacement(e,{placement:Se,boundary:U,rootBoundary:H,padding:G,flipVariations:Y,allowedAutoPlacements:X}):Se)},[]),Z=e.rects.reference,ee=e.rects.popper,J=new Map,te=!0,oe=Q[0],ce=0;ce<Q.length;ce++){var fe=Q[ce],me=getBasePlacement(fe),we=getVariation(fe)===start,Me=[top,bottom].indexOf(me)>=0,Ee=Me?"width":"height",ie=detectOverflow(e,{placement:fe,boundary:U,rootBoundary:H,altBoundary:$,padding:G}),ne=Me?we?right:left:we?bottom:top;Z[Ee]>ee[Ee]&&(ne=getOppositePlacement(ne));var se=getOppositePlacement(ne),ue=[];if(D&&ue.push(ie[me]<=0),k&&ue.push(ie[ne]<=0,ie[se]<=0),ue.every(function(ve){return ve})){oe=fe,te=!1;break}J.set(fe,ue)}if(te)for(var le=Y?3:1,he=function(ve){var Se=Q.find(function(ae){var Ae=J.get(ae);if(Ae)return Ae.slice(0,ve).every(function(xe){return xe})});if(Se)return oe=Se,"break"},pe=le;pe>0;pe--){var de=he(pe);if(de==="break")break}e.placement!==oe&&(e.modifiersData[r]._skip=!0,e.placement=oe,e.reset=!0)}}const flip$1={name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:!1}};function getSideOffsets(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function isAnySideFullyClipped(n){return[top,right,bottom,left].some(function(e){return n[e]>=0})}function hide(n){var e=n.state,t=n.name,r=e.rects.reference,o=e.rects.popper,D=e.modifiersData.preventOverflow,N=detectOverflow(e,{elementContext:"reference"}),k=detectOverflow(e,{altBoundary:!0}),B=getSideOffsets(N,r),G=getSideOffsets(k,o,D),U=isAnySideFullyClipped(B),H=isAnySideFullyClipped(G);e.modifiersData[t]={referenceClippingOffsets:B,popperEscapeOffsets:G,isReferenceHidden:U,hasPopperEscaped:H},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":U,"data-popper-escaped":H})}const hide$1={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:hide};function distanceAndSkiddingToXY(n,e,t){var r=getBasePlacement(n),o=[left,top].indexOf(r)>=0?-1:1,D=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,N=D[0],k=D[1];return N=N||0,k=(k||0)*o,[left,right].indexOf(r)>=0?{x:k,y:N}:{x:N,y:k}}function offset(n){var e=n.state,t=n.options,r=n.name,o=t.offset,D=o===void 0?[0,0]:o,N=placements.reduce(function(U,H){return U[H]=distanceAndSkiddingToXY(H,e.rects,D),U},{}),k=N[e.placement],B=k.x,G=k.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=B,e.modifiersData.popperOffsets.y+=G),e.modifiersData[r]=N}const offset$1={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:offset};function popperOffsets(n){var e=n.state,t=n.name;e.modifiersData[t]=computeOffsets({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const popperOffsets$1={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsets,data:{}};function getAltAxis(n){return n==="x"?"y":"x"}function preventOverflow(n){var e=n.state,t=n.options,r=n.name,o=t.mainAxis,D=o===void 0?!0:o,N=t.altAxis,k=N===void 0?!1:N,B=t.boundary,G=t.rootBoundary,U=t.altBoundary,H=t.padding,$=t.tether,V=$===void 0?!0:$,Y=t.tetherOffset,X=Y===void 0?0:Y,z=detectOverflow(e,{boundary:B,rootBoundary:G,padding:H,altBoundary:U}),W=getBasePlacement(e.placement),q=getVariation(e.placement),K=!q,Q=getMainAxisFromPlacement(W),Z=getAltAxis(Q),ee=e.modifiersData.popperOffsets,J=e.rects.reference,te=e.rects.popper,oe=typeof X=="function"?X(Object.assign({},e.rects,{placement:e.placement})):X,ce=typeof oe=="number"?{mainAxis:oe,altAxis:oe}:Object.assign({mainAxis:0,altAxis:0},oe),fe=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,me={x:0,y:0};if(ee){if(D){var we,Me=Q==="y"?top:left,Ee=Q==="y"?bottom:right,ie=Q==="y"?"height":"width",ne=ee[Q],se=ne+z[Me],ue=ne-z[Ee],le=V?-te[ie]/2:0,he=q===start?J[ie]:te[ie],pe=q===start?-te[ie]:-J[ie],de=e.elements.arrow,ve=V&&de?getLayoutRect(de):{width:0,height:0},Se=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:getFreshSideObject(),ae=Se[Me],Ae=Se[Ee],xe=within(0,J[ie],ve[ie]),Ce=K?J[ie]/2-le-xe-ae-ce.mainAxis:he-xe-ae-ce.mainAxis,Oe=K?-J[ie]/2+le+xe+Ae+ce.mainAxis:pe+xe+Ae+ce.mainAxis,Te=e.elements.arrow&&getOffsetParent(e.elements.arrow),De=Te?Q==="y"?Te.clientTop||0:Te.clientLeft||0:0,Ie=(we=fe?.[Q])!=null?we:0,_e=ne+Ce-Ie-De,Re=ne+Oe-Ie,Pe=within(V?min(se,_e):se,ne,V?max(ue,Re):ue);ee[Q]=Pe,me[Q]=Pe-ne}if(k){var be,$e=Q==="x"?top:left,Ye=Q==="x"?bottom:right,He=ee[Z],ze=Z==="y"?"height":"width",qe=He+z[$e],Ze=He-z[Ye],Ke=[top,left].indexOf(W)!==-1,Ge=(be=fe?.[Z])!=null?be:0,Ue=Ke?qe:He-J[ze]-te[ze]-Ge+ce.altAxis,Fe=Ke?He+J[ze]+te[ze]-Ge-ce.altAxis:Ze,Le=V&&Ke?withinMaxClamp(Ue,He,Fe):within(V?Ue:qe,He,V?Fe:Ze);ee[Z]=Le,me[Z]=Le-He}e.modifiersData[r]=me}}const preventOverflow$1={name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};function getHTMLElementScroll(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function getNodeScroll(n){return n===getWindow(n)||!isHTMLElement(n)?getWindowScroll(n):getHTMLElementScroll(n)}function isElementScaled(n){var e=n.getBoundingClientRect(),t=round(e.width)/n.offsetWidth||1,r=round(e.height)/n.offsetHeight||1;return t!==1||r!==1}function getCompositeRect(n,e,t){t===void 0&&(t=!1);var r=isHTMLElement(e),o=isHTMLElement(e)&&isElementScaled(e),D=getDocumentElement(e),N=getBoundingClientRect(n,o,t),k={scrollLeft:0,scrollTop:0},B={x:0,y:0};return(r||!r&&!t)&&((getNodeName(e)!=="body"||isScrollParent(D))&&(k=getNodeScroll(e)),isHTMLElement(e)?(B=getBoundingClientRect(e,!0),B.x+=e.clientLeft,B.y+=e.clientTop):D&&(B.x=getWindowScrollBarX(D))),{x:N.left+k.scrollLeft-B.x,y:N.top+k.scrollTop-B.y,width:N.width,height:N.height}}function order(n){var e=new Map,t=new Set,r=[];n.forEach(function(D){e.set(D.name,D)});function o(D){t.add(D.name);var N=[].concat(D.requires||[],D.requiresIfExists||[]);N.forEach(function(k){if(!t.has(k)){var B=e.get(k);B&&o(B)}}),r.push(D)}return n.forEach(function(D){t.has(D.name)||o(D)}),r}function orderModifiers(n){var e=order(n);return modifierPhases.reduce(function(t,r){return t.concat(e.filter(function(o){return o.phase===r}))},[])}function debounce(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function mergeByName(n){var e=n.reduce(function(t,r){var o=t[r.name];return t[r.name]=o?Object.assign({},o,r,{options:Object.assign({},o.options,r.options),data:Object.assign({},o.data,r.data)}):r,t},{});return Object.keys(e).map(function(t){return e[t]})}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function popperGenerator(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,r=t===void 0?[]:t,o=e.defaultOptions,D=o===void 0?DEFAULT_OPTIONS:o;return function(N,k,B){B===void 0&&(B=D);var G={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,D),modifiersData:{},elements:{reference:N,popper:k},attributes:{},styles:{}},U=[],H=!1,$={state:G,setOptions:function(X){var z=typeof X=="function"?X(G.options):X;Y(),G.options=Object.assign({},D,G.options,z),G.scrollParents={reference:isElement(N)?listScrollParents(N):N.contextElement?listScrollParents(N.contextElement):[],popper:listScrollParents(k)};var W=orderModifiers(mergeByName([].concat(r,G.options.modifiers)));return G.orderedModifiers=W.filter(function(q){return q.enabled}),V(),$.update()},forceUpdate:function(){if(!H){var X=G.elements,z=X.reference,W=X.popper;if(areValidElements(z,W)){G.rects={reference:getCompositeRect(z,getOffsetParent(W),G.options.strategy==="fixed"),popper:getLayoutRect(W)},G.reset=!1,G.placement=G.options.placement,G.orderedModifiers.forEach(function(te){return G.modifiersData[te.name]=Object.assign({},te.data)});for(var q=0;q<G.orderedModifiers.length;q++){if(G.reset===!0){G.reset=!1,q=-1;continue}var K=G.orderedModifiers[q],Q=K.fn,Z=K.options,ee=Z===void 0?{}:Z,J=K.name;typeof Q=="function"&&(G=Q({state:G,options:ee,name:J,instance:$})||G)}}}},update:debounce(function(){return new Promise(function(X){$.forceUpdate(),X(G)})}),destroy:function(){Y(),H=!0}};if(!areValidElements(N,k))return $;$.setOptions(B).then(function(X){!H&&B.onFirstUpdate&&B.onFirstUpdate(X)});function V(){G.orderedModifiers.forEach(function(X){var z=X.name,W=X.options,q=W===void 0?{}:W,K=X.effect;if(typeof K=="function"){var Q=K({state:G,name:z,instance:$,options:q}),Z=function(){};U.push(Q||Z)}})}function Y(){U.forEach(function(X){return X()}),U=[]}return $}}var defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1,offset$1,flip$1,preventOverflow$1,arrow$1,hide$1],createPopper=popperGenerator({defaultModifiers});class TinyGesture{constructor(e,t){this.element=e,this.touch1=null,this.touch2=null,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.touchMove1=null,this.touchMove2=null,this.touchMoveX=null,this.touchMoveY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapTimer=null,this.doubleTapWaiting=!1,this.thresholdX=0,this.thresholdY=0,this.disregardVelocityThresholdX=0,this.disregardVelocityThresholdY=0,this.swipingHorizontal=!1,this.swipingVertical=!1,this.swipingDirection=null,this.swipedHorizontal=!1,this.swipedVertical=!1,this.originalDistance=null,this.newDistance=null,this.scale=null,this.originalAngle=null,this.newAngle=null,this.rotation=null,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[],pinch:[],pinchend:[],rotate:[],rotateend:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.opts=Object.assign({},TinyGesture.defaults,t),this.element.addEventListener("touchstart",this._onTouchStart,passiveIfSupported),this.element.addEventListener("touchmove",this._onTouchMove,passiveIfSupported),this.element.addEventListener("touchend",this._onTouchEnd,passiveIfSupported),this.opts.mouseSupport&&!("ontouchstart"in window)&&(this.element.addEventListener("mousedown",this._onTouchStart,passiveIfSupported),document.addEventListener("mousemove",this._onTouchMove,passiveIfSupported),document.addEventListener("mouseup",this._onTouchEnd,passiveIfSupported))}destroy(){var e,t;this.element.removeEventListener("touchstart",this._onTouchStart),this.element.removeEventListener("touchmove",this._onTouchMove),this.element.removeEventListener("touchend",this._onTouchEnd),this.element.removeEventListener("mousedown",this._onTouchStart),document.removeEventListener("mousemove",this._onTouchMove),document.removeEventListener("mouseup",this._onTouchEnd),clearTimeout((e=this.longPressTimer)!==null&&e!==void 0?e:void 0),clearTimeout((t=this.doubleTapTimer)!==null&&t!==void 0?t:void 0)}on(e,t){if(this.handlers[e])return this.handlers[e].push(t),{type:e,fn:t,cancel:()=>this.off(e,t)}}off(e,t){if(this.handlers[e]){const r=this.handlers[e].indexOf(t);r!==-1&&this.handlers[e].splice(r,1)}}fire(e,t){for(let r=0;r<this.handlers[e].length;r++)this.handlers[e][r](t)}onTouchStart(e){var t,r,o,D,N,k,B,G,U,H,$,V,Y,X,z,W,q,K,Q,Z,ee,J,te,oe,ce,fe;let me=!1;if(e.type!=="mousedown"){if(this.touch1||(this.touch1=e.changedTouches[0],me=!0),(me&&e.changedTouches.length>1||!me)&&!this.touch2){this.touch2=[...e.changedTouches].find(we=>{var Me;return we.identifier!==((Me=this.touch1)===null||Me===void 0?void 0:Me.identifier)})||null,this.originalDistance=Math.sqrt(Math.pow(((r=(t=this.touch2)===null||t===void 0?void 0:t.screenX)!==null&&r!==void 0?r:0)-((k=(D=(o=this.touchMove1)===null||o===void 0?void 0:o.screenX)!==null&&D!==void 0?D:(N=this.touch1)===null||N===void 0?void 0:N.screenX)!==null&&k!==void 0?k:0),2)+Math.pow(((G=(B=this.touch2)===null||B===void 0?void 0:B.screenY)!==null&&G!==void 0?G:0)-((V=(H=(U=this.touchMove1)===null||U===void 0?void 0:U.screenY)!==null&&H!==void 0?H:($=this.touch1)===null||$===void 0?void 0:$.screenY)!==null&&V!==void 0?V:0),2)),this.originalAngle=Math.atan2(((X=(Y=this.touch2)===null||Y===void 0?void 0:Y.screenY)!==null&&X!==void 0?X:0)-((K=(W=(z=this.touchMove1)===null||z===void 0?void 0:z.screenY)!==null&&W!==void 0?W:(q=this.touch1)===null||q===void 0?void 0:q.screenY)!==null&&K!==void 0?K:0),((Z=(Q=this.touch2)===null||Q===void 0?void 0:Q.screenX)!==null&&Z!==void 0?Z:0)-((oe=(J=(ee=this.touchMove1)===null||ee===void 0?void 0:ee.screenX)!==null&&J!==void 0?J:(te=this.touch1)===null||te===void 0?void 0:te.screenX)!==null&&oe!==void 0?oe:0))/(Math.PI/180);return}if(!me)return}(me||e.type==="mousedown")&&(this.thresholdX=this.opts.threshold("x",this),this.thresholdY=this.opts.threshold("y",this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold("x",this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold("y",this),this.touchStartX=e.type==="mousedown"?e.screenX:((ce=this.touch1)===null||ce===void 0?void 0:ce.screenX)||0,this.touchStartY=e.type==="mousedown"?e.screenY:((fe=this.touch1)===null||fe===void 0?void 0:fe.screenY)||0,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.swipingDirection=null,this.longPressTimer=setTimeout(()=>this.fire("longpress",e),this.opts.longPressTime),this.scale=1,this.rotation=0,this.fire("panstart",e))}onTouchMove(e){var t,r,o,D,N,k,B,G,U,H,$,V,Y;if(e.type==="mousemove"&&(!this.touchStartX||this.touchEndX!==null))return;let X,z;if(e.type!=="mousemove"&&(X=[...e.changedTouches].find(W=>{var q;return W.identifier===((q=this.touch1)===null||q===void 0?void 0:q.identifier)}),this.touchMove1=X||this.touchMove1,z=[...e.changedTouches].find(W=>{var q;return W.identifier===((q=this.touch2)===null||q===void 0?void 0:q.identifier)}),this.touchMove2=z||this.touchMove2),e.type==="mousemove"||X){const W=(e.type==="mousemove"?e.screenX:(t=X?.screenX)!==null&&t!==void 0?t:0)-((r=this.touchStartX)!==null&&r!==void 0?r:0);this.velocityX=W-((o=this.touchMoveX)!==null&&o!==void 0?o:0),this.touchMoveX=W;const q=(e.type==="mousemove"?e.screenY:(D=X?.screenY)!==null&&D!==void 0?D:0)-((N=this.touchStartY)!==null&&N!==void 0?N:0);this.velocityY=q-((k=this.touchMoveY)!==null&&k!==void 0?k:0),this.touchMoveY=q;const K=Math.abs(this.touchMoveX),Q=Math.abs(this.touchMoveY);this.swipingHorizontal=K>this.thresholdX,this.swipingVertical=Q>this.thresholdY,this.swipingDirection=K>Q?this.swipingHorizontal?"horizontal":"pre-horizontal":this.swipingVertical?"vertical":"pre-vertical",Math.max(K,Q)>this.opts.pressThreshold&&clearTimeout((B=this.longPressTimer)!==null&&B!==void 0?B:void 0),this.fire("panmove",e)}e.type!=="mousemove"&&this.touchMove1!=null&&this.touchMove2!=null&&(this.newDistance=Math.sqrt(Math.pow(this.touchMove2.screenX-this.touchMove1.screenX,2)+Math.pow(this.touchMove2.screenY-this.touchMove1.screenY,2)),this.scale=this.newDistance/((G=this.originalDistance)!==null&&G!==void 0?G:0),this.fire("pinch",e),this.newAngle=Math.atan2(((U=this.touchMove2.screenY)!==null&&U!==void 0?U:0)-((H=this.touchMove1.screenY)!==null&&H!==void 0?H:0),(($=this.touchMove2.screenX)!==null&&$!==void 0?$:0)-((V=this.touchMove1.screenX)!==null&&V!==void 0?V:0))/(Math.PI/180),this.rotation=this.newAngle-((Y=this.originalAngle)!==null&&Y!==void 0?Y:0),this.fire("rotate",e))}onTouchEnd(e){var t,r,o,D,N,k,B,G,U,H;let $;if(e.type!=="mouseup"&&($=[...e.changedTouches].find(V=>{var Y;return V.identifier===((Y=this.touch1)===null||Y===void 0?void 0:Y.identifier)}),[...e.touches].find(V=>{var Y;return V.identifier===((Y=this.touch1)===null||Y===void 0?void 0:Y.identifier)})||(this.touch1=null,this.touchMove1=null),[...e.touches].find(V=>{var Y;return V.identifier===((Y=this.touch2)===null||Y===void 0?void 0:Y.identifier)})||(this.touch2=null,this.touchMove2=null)),!(e.type==="mouseup"&&(!this.touchStartX||this.touchEndX!==null))){if(e.type==="mouseup"||$){this.touchEndX=e.type==="mouseup"?e.screenX:(t=$?.screenX)!==null&&t!==void 0?t:0,this.touchEndY=e.type==="mouseup"?e.screenY:(r=$?.screenY)!==null&&r!==void 0?r:0,this.fire("panend",e),clearTimeout((o=this.longPressTimer)!==null&&o!==void 0?o:void 0);const V=this.touchEndX-((D=this.touchStartX)!==null&&D!==void 0?D:0),Y=Math.abs(V),X=this.touchEndY-((N=this.touchStartY)!==null&&N!==void 0?N:0),z=Math.abs(X),W=Math.sqrt(Math.pow(V,2)+Math.pow(X,2)),q=Math.abs(W),K=z/Y;Y>this.thresholdX||z>this.thresholdY||this.opts.diagonalSwipes&&(q>this.thresholdX||q>this.thresholdY)?(this.swipedHorizontal=Y>this.thresholdX||this.opts.diagonalSwipes&&q>this.thresholdX,this.swipedVertical=z>this.thresholdY||this.opts.diagonalSwipes&&q>this.thresholdY,(!this.opts.diagonalSwipes||K<Math.tan((45-this.opts.diagonalLimit)*Math.PI/180)||K>Math.tan((45+this.opts.diagonalLimit)*Math.PI/180))&&(Y>=z&&(this.swipedVertical=!1),z>Y&&(this.swipedHorizontal=!1)),this.swipedHorizontal&&(V<0?(((k=this.velocityX)!==null&&k!==void 0?k:0)<-this.opts.velocityThreshold||W<-this.disregardVelocityThresholdX)&&this.fire("swipeleft",e):(((B=this.velocityX)!==null&&B!==void 0?B:0)>this.opts.velocityThreshold||W>this.disregardVelocityThresholdX)&&this.fire("swiperight",e)),this.swipedVertical&&(X<0?(((G=this.velocityY)!==null&&G!==void 0?G:0)<-this.opts.velocityThreshold||W<-this.disregardVelocityThresholdY)&&this.fire("swipeup",e):(((U=this.velocityY)!==null&&U!==void 0?U:0)>this.opts.velocityThreshold||W>this.disregardVelocityThresholdY)&&this.fire("swipedown",e))):Y<this.opts.pressThreshold&&z<this.opts.pressThreshold&&(this.doubleTapWaiting?(this.doubleTapWaiting=!1,clearTimeout((H=this.doubleTapTimer)!==null&&H!==void 0?H:void 0),this.fire("doubletap",e)):(this.doubleTapWaiting=!0,this.doubleTapTimer=setTimeout(()=>this.doubleTapWaiting=!1,this.opts.doubleTapTime),this.fire("tap",e)))}!this.touch1&&!this.touch2&&(this.fire("pinchend",e),this.fire("rotateend",e),this.originalDistance=null,this.newDistance=null,this.scale=null,this.originalAngle=null,this.newAngle=null,this.rotation=null)}}}TinyGesture.defaults={threshold:(n,e)=>Math.max(25,Math.floor(.15*(n==="x"?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(n,e)=>Math.floor(.5*(n==="x"?e.element.clientWidth:e.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:15,longPressTime:500,doubleTapTime:300,mouseSupport:!0};let passiveIfSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveIfSupported={passive:!0}}}))}catch{}const EVNM_BUTTON="pointerdown",EVNM_CLICK="pointerdown",EVNM_KEY="keydown";class EventMng{constructor(e,t,r,o,D,N,k,B,G){if(this.cfg=e,this.hTag=t,this.appPixi=r,this.main=o,this.layMng=D,this.val=N,this.scrItr=B,this.sys=G,t.clear_event=q=>ReadingState.clear_event(q),t.event=q=>this.#A(q),t.set_cancel_skip=()=>!1,t.set_focus=q=>this.#_(q),k.setEvtMng(this),B.setOtherObj(this,D),TxtLayer.setEvtMng(this,G,B),D.setEvtMng(this),Reading.setFcs(this.#e),G.setFire((q,K)=>Reading.fire(q,K)),CmnLib.isDbg){const q={pause:()=>{if(!Reading.isWait)return;const K={};B.recodeDesign(K),G.callHook("_enterDesign",K),G.send2Dbg("_enterDesign",K)}};q.attach=q.stopOnEntry=q.stopOnStep=q.stopOnStepIn=q.stopOnStepOut=q.stopOnBackstep=q.pause,G.addHook(K=>q[K]?.())}addStyle(`
.sn_hint {
	background-color: #3c3225;
	color: white;
	padding: 4px 8px;
	border-radius: 4px;
	font-size: 1.2em;
	z-index: 10000;
	pointer-events: none;
	user-select: none;
}

.sn_hint_ar,
.sn_hint_ar::before {
	position: absolute;
	width: 8px;
	height: 8px;
	background: inherit;
}
.sn_hint_ar {
	visibility: hidden;
}
.sn_hint_ar::before {
	visibility: visible;
	content: '';
	transform: rotate(45deg);
}

.sn_hint[data-popper-placement^='top']		> .sn_hint_ar {bottom: -4px;}
.sn_hint[data-popper-placement^='bottom']	> .sn_hint_ar {top: -4px;}
.sn_hint[data-popper-placement^='left']		> .sn_hint_ar {right: -4px;}
.sn_hint[data-popper-placement^='right']	> .sn_hint_ar {left: -4px;}
`),o.cvs.parentElement?.insertAdjacentHTML("beforeend",`
<div class="sn_hint" role="tooltip">
	<span>Dummy</span>
	<div class="sn_hint_ar" data-popper-arrow></div>
</div>`),this.#g=document.querySelector(".sn_hint"),this.#m=this.#g.querySelector("span"),this.#p=createPopper(this.#c,this.#g),this.#g.hidden=!0,r.stage.interactive=!0,this.#t.add(document.body,EVNM_KEY,q=>this.#a(q)),this.#t.add(document.body,"keyup",()=>ReadingState.resetFired()),this.#t.add(o.cvs,"contextmenu",q=>{const K=this.#h(q)+"rightclick";Reading.fire(K,q,!0),q.preventDefault()});const U=e.oCfg.window.width,H=e.oCfg.window.height,$=Math.floor(U>H?H/3:U/3);this.#r=new TinyGesture(o.cvs,{velocityThreshold:0,disregardVelocityThreshold:q=>Math.floor($*(q==="x"?1:.5))});let V=!1;this.#r.on("tap",q=>{if(V)return;if(q instanceof TouchEvent){Reading.fire("click",q,!0),ReadingState.resetFired();return}if(q.button>1)return;const K=this.#h(q)+`${this.#s.get(q.button)??""}click`;Reading.fire(K,q,!0),ReadingState.resetFired()}),this.#t.add(window,"pointerup",()=>ReadingState.resetFired()),this.#t.add(window,"pointerout",()=>ReadingState.resetFired()),this.#r.on("longpress",q=>{if(V=!0,q instanceof TouchEvent){Reading.fire("longpress",q,!0);return}const K=this.#h(q)+`${this.#s.get(q.button)??""}longpress`;Reading.fire(K,q,!0)}),this.#r.on("panend",()=>{V&&queueMicrotask(()=>V=!1)}),["swiperight","swipeleft","swipeup","swipedown"].forEach(q=>{this.#r.on(q,K=>{if(K instanceof TouchEvent){Reading.fire(q,K,!0);return}const Q=this.#h(K)+q;Reading.fire(Q,K,!0)})});const Y=()=>N.setVal_Nochk("tmp","const.sn.navigator.language",navigator.language);this.#t.add(globalThis,"languagechange",q=>{Y(),Reading.fire("sn:chgNavLang",q),clearTextureCache()}),Y();const X=q=>{CmnLib.isDarkMode=q.matches,N.setVal_Nochk("tmp","const.sn.isDarkMode",CmnLib.isDarkMode)},z=globalThis.matchMedia("(prefers-color-scheme: dark)");X(z),this.#t.add(z,"change",q=>{X(q),Reading.fire("sn:chgDarkMode",q)});let W=(q,K)=>{};"WheelEvent"in globalThis&&(this.#t.add(o.cvs,"wheel",q=>this.#d(q),{passive:!0}),this.#i=q=>this.#t.add(q,"wheel",K=>this.#d(K),{passive:!0}),W=(q,K)=>q.add(o.cvs,"wheel",Q=>{Q.isComposing||Q.deltaY<=0||(Q.stopPropagation(),K())})),Reading.init(e,t,o,N,B,D,this,k,W),__vitePreload(()=>import("./gamepad.js"),[],import.meta.url).then(q=>q.g).then(({GamepadListener:q})=>{const K=new q({analog:!1,deadZone:.3});CmnLib.debugLog&&(K.on("gamepad:connected",ee=>console.log(`👺<'gamepad:connected' index:${ee.detail.index} id:${ee.detail.gamepad.id}`)),K.on("gamepad:disconnected",ee=>console.log(`👺<'gamepad:disconnected' index:${ee.detail.index} id:${ee.detail.gamepad?.id}`)));const Q=["","ArrowUp","","ArrowLeft","","ArrowRight","","ArrowDown",""],Z=[0,0];K.on("gamepad:axis",ee=>{if(!document.hasFocus())return;Z[ee.detail.axis]=ee.detail.value;const[J=0,te=0]=Z,oe=(te+1)*3+(J+1),ce=Q[oe];if(!ce)return;const fe=this.#e.getFocus();(!fe||fe instanceof Container?globalThis:fe).dispatchEvent(new KeyboardEvent(EVNM_KEY,{key:ce,bubbles:!0})),!(!fe||fe instanceof Container)&&(Reading.cancelAutoSkip(),fe.getAttribute("type")==="range"&&fe.dispatchEvent(new InputEvent("input",{bubbles:!0})))}),K.on("gamepad:button",ee=>{if(document.hasFocus())if(ee.detail.button%2===0){Reading.cancelAutoSkip();const J=this.#e.getFocus();(!J||J instanceof Container?document.body:J).dispatchEvent(new KeyboardEvent(EVNM_KEY,{key:"Enter",bubbles:!0}))}else Reading.fire("middleclick",ee,!0)}),K.start()}),this.#t.add(document,"keyup",q=>{q.isComposing||q.key in this.#o&&(this.#o[q.key]=0)}),N.defTmp("const.sn.key.alternate",()=>this.#o.Alt>0),N.defTmp("const.sn.key.command",()=>this.#o.Meta>0),N.defTmp("const.sn.key.control",()=>this.#o.Control>0),N.defTmp("const.sn.key.end",()=>this.#o.End>0),N.defTmp("const.sn.key.escape",()=>this.#o.Escape>0),N.defTmp("const.sn.key.back",()=>this.#o.GoBack>0)}#t=new EventListenerCtn;#e=new FocusMng;#r;#s=new Map([[0,""],[1,"middle"]]);resvFlameEvent(e){this.#t.add(e,EVNM_KEY,t=>this.#a(t)),this.#t.add(e,"contextmenu",t=>{Reading.fire(this.#h(t)+"rightclick",t,!0),t.preventDefault()}),this.#i(e),this.#t.add(e,EVNM_CLICK,t=>{if(t instanceof TouchEvent){Reading.fire("click",t,!0);return}if(t.button>1)return;const r=this.#h(t)+`${this.#s.get(t.button)??""}click`;Reading.fire(r,t,!0)}),this.#t.add(e,"pointerup",()=>ReadingState.resetFired()),this.#t.add(e,"pointerout",()=>ReadingState.resetFired())}#i=e=>{};#a(e){e.isComposing||(e.key in this.#o&&(this.#o[e.key]=e.repeat?2:1),e.preventDefault(),Reading.fire(SysBase.modKey(e)+e.key,e,!0))}#h(e){return(e.altKey?"alt+":"")+(e.ctrlKey?"ctrl+":"")+(e.metaKey?"meta+":"")+(e.shiftKey?"shift+":"")}#d(e){if(this.#l){this.#f=!0;return}this.#l=!0,this.#n();const t=this.#h(e)+(e.deltaY>0?"downwheel":"upwheel");Reading.fire(t,e,!0)}#l=!1;#f=!1;#n(){setTimeout(()=>{if(this.#f){this.#f=!1,this.#n();return}this.#l=!1},250)}destroy(){for(const e of Array.from(document.getElementsByClassName("sn_hint")))e.parentElement?.removeChild(e);this.#r.destroy(),ReadingState.destroy(),this.#e.destroy(),this.#t.clear()}unButton(e){this.#e.remove(e)}button(e,t,r,o,D){!e.fn&&!e.label&&!e.url&&this.main.errScript("fnまたはlabelまたはurlは必須です"),e.fn??=this.scrItr.scriptFn,t.interactive=!0,t.cursor="pointer";const N=e.key?.toLowerCase()??" ",k=argChk_Boolean(e,"global",!1);ReadingState.setEvt2Fnc(k,N,()=>this.main.resumeByJumpOrCall(e)),t.on(EVNM_BUTTON,({data:H})=>{const $=H.originalEvent;$.preventDefault(),ReadingState.isFirstFire()&&Reading.fire(N,$,!0)});const B=e.hint?()=>this.#u(e,t):()=>{},G=()=>{r(),this.#g.hidden=!0},U=()=>(B(),o());if(t.on("pointerover",U),t.on("pointerout",()=>{this.#e.isFocus(t)?U():G()}),t.on("pointerdown",()=>{this.#g.hidden=!0;const H=this.#e.getFocus();D(),H instanceof Button&&H.normal()}),t.on("pointerup",CmnLib.isMobile?G:()=>{this.#e.isFocus(t)?U():G()}),this.#e.add(t,U,G),e.clickse&&(e.clicksebuf??="SYS",this.cfg.searchPath(e.clickse,SEARCH_PATH_ARG_EXT.SOUND),t.on("pointerdown",()=>{this.hTag.playse({fn:e.clickse,buf:e.clicksebuf,join:!1})})),e.enterse&&(e.entersebuf??="SYS",this.cfg.searchPath(e.enterse,SEARCH_PATH_ARG_EXT.SOUND),t.on("pointerover",()=>{this.hTag.playse({fn:e.enterse,buf:e.entersebuf,join:!1})})),e.leavese&&(e.leavesebuf??="SYS",this.cfg.searchPath(e.leavese,SEARCH_PATH_ARG_EXT.SOUND),t.on("pointerout",()=>{this.hTag.playse({fn:e.leavese,buf:e.leavesebuf,join:!1})})),e.onenter){const H=N+e.onenter.toLowerCase(),$={fn:e.fn,label:e.onenter,call:!0,key:H};ReadingState.setEvt2Fnc(k,H,()=>this.main.resumeByJumpOrCall($)),t.on("pointerover",V=>Reading.fire(H,V))}if(e.onleave){const H=N+e.onleave.toLowerCase(),$={fn:e.fn,label:e.onleave,call:!0,key:H};ReadingState.setEvt2Fnc(k,H,()=>this.main.resumeByJumpOrCall($)),t.on("pointerout",V=>Reading.fire(H,V))}}#c={getBoundingClientRect:(e=0,t=0)=>DOMRect.fromRect({x:e,y:t,width:0,height:0})};#g;#m;#p;#y={placement:"bottom",modifiers:[{name:"flip",options:{fallbackPlacements:["top","bottom"]}}]};#u(e,t){const r=t instanceof Button?t.getBtnBounds():t.getBounds();if(e[":タグ名"]!=="link"){const o=t.parent.parent;r.x+=o.x,r.y+=o.y}if(!e.hint){this.#g.hidden=!0;return}this.#g.style.cssText=`position:${this.#g.style.position}; transform:${this.#g.style.transform};`+(e.hint_style??""),this.#m.style.cssText="",this.#m.textContent=e.hint??"";try{const o=e.hint_opt?{...this.#y,...JSON.parse(e.hint_opt)}:this.#y;this.#p.setOptions(o)}catch(o){console.error(mesErrJSON(e,"hint_opt",`dispHint 引数 hint_opt エラー ${o instanceof SyntaxError?o.message:""}`))}this.#c.getBoundingClientRect=()=>DOMRect.fromRect({x:this.sys.ofsLeft4elm+r.x*this.sys.cvsScale,y:this.sys.ofsTop4elm+r.y*this.sys.cvsScale,width:r.width,height:r.height}),this.#p.update(),this.#g.hidden=!1}hideHint(){this.#g.hidden=!0}cvsResize(){this.hideHint()}#A(e){const t=e.key;if(!t)throw"keyは必須です";const r=t.toLowerCase(),o=argChk_Boolean(e,"call",!1),D=argChk_Boolean(e,"global",!1),{fn:N,label:k,url:B}=e;if(argChk_Boolean(e,"del",!1)){if(N||k||o||B)throw"fn/label/callとdelは同時指定できません";return ReadingState.clear_eventer(t,D,r),!1}if(!N&&!k&&!B)throw"fn,label,url いずれかは必須です";if(e.fn??=this.scrItr.scriptFn,t.startsWith("dom=")){const G=ReadingState.getHtmlElmList(t);if(G.el.length===0){if(argChk_Boolean(e,"need_err",!0))throw`HTML内にセレクタ（${G.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;return!1}let U=["click",EVNM_KEY];switch(G.el[0].type??""){case"checkbox":U=["input"];break;case"range":U=["input"];break;case"text":case"textarea":U=["input","change"];break}const H=U.length;for(let $=0;$<H;++$){const V=U[$];G.el.forEach(Y=>{this.#t.add(Y,V,X=>{if(!Reading.isWait||this.layMng.getFrmDisabled(G.id)||V===EVNM_KEY&&X.key!=="Enter")return;const z=Y.dataset;for(const[W,q]of Object.entries(z))this.val.setVal_Nochk("tmp",`sn.event.domdata.${W}`,q);Reading.fire(t,X)}),$===0&&this.#e.add(Y,()=>this.#v(Y)?(Y.focus(),!0):!1,()=>{})})}}return ReadingState.setEvt2Fnc(D,r,()=>this.main.resumeByJumpOrCall(e)),!1}#v(e){if(e.offsetParent===null)return!1;let t=e;do{if(getComputedStyle(t).display==="none"||t.dataset.focus==="false"||t?.disabled)return!1;t=t.parentElement}while(t!==null);return!0}#_(e){const{add:t,del:r,to:o}=e;if(t?.startsWith("dom=")){const D=ReadingState.getHtmlElmList(t);if(D.el.length===0&&argChk_Boolean(e,"need_err",!0))throw`HTML内にセレクタ（${D.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;return D.el.forEach(N=>this.#e.add(N,()=>this.#v(N)?(N.focus(),!0):!1,()=>{})),!1}if(r?.startsWith("dom=")){const D=ReadingState.getHtmlElmList(r);if(D.el.length===0&&argChk_Boolean(e,"need_err",!0))throw`HTML内にセレクタ（${D.sel}）に対応する要素が見つかりません。存在しない場合を許容するなら、need_err=false と指定してください`;return D.el.forEach(N=>this.#e.remove(N)),!1}if(!o)throw"[set_focus] add か to は必須です";switch(o){case"null":this.#e.blur();break;case"next":this.#e.next();break;case"prev":this.#e.prev();break}return!1}get isSkipping(){return Reading.isSkipping?!0:Object.keys(this.#o).some(e=>this.#o[e]===2)}#o={Alt:0,Meta:0,Control:0,ArrowDown:0,End:0,Enter:0,Escape:0," ":0,GoBack:0}}const EventMng$1=Object.freeze(Object.defineProperty({__proto__:null,EVNM_BUTTON,EVNM_CLICK,EVNM_KEY,EventMng},Symbol.toStringTag,{value:"Module"})),PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(n=>{PACKET_TYPES_REVERSE[PACKET_TYPES[n]]=n});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,encodePacket=({type:n,data:e},t,r)=>withNativeBlob$1&&e instanceof Blob?t?r(e):encodeBlobAsBase64(e,r):withNativeArrayBuffer$2&&(e instanceof ArrayBuffer||isView$1(e))?t?r(e):encodeBlobAsBase64(new Blob([e]),r):r(PACKET_TYPES[n]+(e||"")),encodeBlobAsBase64=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function toArray(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(n,e){if(withNativeBlob$1&&n.data instanceof Blob)return n.data.arrayBuffer().then(toArray).then(e);if(withNativeArrayBuffer$2&&(n.data instanceof ArrayBuffer||isView$1(n.data)))return e(toArray(n.data));encodePacket(n,!1,t=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),e(TEXT_ENCODER.encode(t))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<chars.length;n++)lookup$1[chars.charCodeAt(n)]=n;const decode$1=n=>{let e=n.length*.75,t=n.length,r,o=0,D,N,k,B;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const G=new ArrayBuffer(e),U=new Uint8Array(G);for(r=0;r<t;r+=4)D=lookup$1[n.charCodeAt(r)],N=lookup$1[n.charCodeAt(r+1)],k=lookup$1[n.charCodeAt(r+2)],B=lookup$1[n.charCodeAt(r+3)],U[o++]=D<<2|N>>4,U[o++]=(N&15)<<4|k>>2,U[o++]=(k&3)<<6|B&63;return G},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(n,e)=>{if(typeof n!="string")return{type:"message",data:mapBinary(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:decodeBase64Packet(n.substring(1),e)}:PACKET_TYPES_REVERSE[t]?n.length>1?{type:PACKET_TYPES_REVERSE[t],data:n.substring(1)}:{type:PACKET_TYPES_REVERSE[t]}:ERROR_PACKET},decodeBase64Packet=(n,e)=>{if(withNativeArrayBuffer$1){const t=decode$1(n);return mapBinary(t,e)}else return{base64:!0,data:n}},mapBinary=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},SEPARATOR="",encodePayload=(n,e)=>{const t=n.length,r=new Array(t);let o=0;n.forEach((D,N)=>{encodePacket(D,!1,k=>{r[N]=k,++o===t&&e(r.join(SEPARATOR))})})},decodePayload=(n,e)=>{const t=n.split(SEPARATOR),r=[];for(let o=0;o<t.length;o++){const D=decodePacket(t[o],e);if(r.push(D),D.type==="error")break}return r};function createPacketEncoderStream(){return new TransformStream({transform(n,e){encodePacketToBinary(n,t=>{const r=t.length;let o;if(r<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,r);else if(r<65536){o=new Uint8Array(3);const D=new DataView(o.buffer);D.setUint8(0,126),D.setUint16(1,r)}else{o=new Uint8Array(9);const D=new DataView(o.buffer);D.setUint8(0,127),D.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(o[0]|=128),e.enqueue(o),e.enqueue(t)})}})}let TEXT_DECODER;function totalLength(n){return n.reduce((e,t)=>e+t.length,0)}function concatChunks(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let o=0;o<e;o++)t[o]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function createPacketDecoderStream(n,e){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const t=[];let r=0,o=-1,D=!1;return new TransformStream({transform(N,k){for(t.push(N);;){if(r===0){if(totalLength(t)<1)break;const B=concatChunks(t,1);D=(B[0]&128)===128,o=B[0]&127,o<126?r=3:o===126?r=1:r=2}else if(r===1){if(totalLength(t)<2)break;const B=concatChunks(t,2);o=new DataView(B.buffer,B.byteOffset,B.length).getUint16(0),r=3}else if(r===2){if(totalLength(t)<8)break;const B=concatChunks(t,8),G=new DataView(B.buffer,B.byteOffset,B.length),U=G.getUint32(0);if(U>Math.pow(2,21)-1){k.enqueue(ERROR_PACKET);break}o=U*Math.pow(2,32)+G.getUint32(4),r=3}else{if(totalLength(t)<o)break;const B=concatChunks(t,o);k.enqueue(decodePacket(D?B:TEXT_DECODER.decode(B),e)),r=0}if(o===0||o>n){k.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(n){if(n)return mixin(n)}function mixin(n){for(var e in Emitter.prototype)n[e]=Emitter.prototype[e];return n}Emitter.prototype.on=Emitter.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};Emitter.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,o=0;o<t.length;o++)if(r=t[o],r===e||r.fn===e){t.splice(o,1);break}return t.length===0&&delete this._callbacks["$"+n],this};Emitter.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,o=t.length;r<o;++r)t[r].apply(this,e)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};Emitter.prototype.hasListeners=function(n){return!!this.listeners(n).length};const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0),globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),defaultBinaryType="arraybuffer";function pick(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(n,e){e.useNativeTimers?(n.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),n.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(n.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),n.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(n){return typeof n=="string"?utf8Length(n):Math.ceil((n.byteLength||n.size)*BASE64_OVERHEAD)}function utf8Length(n){let e=0,t=0;for(let r=0,o=n.length;r<o;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function randomString(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function encode(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function decode(n){let e={},t=n.split("&");for(let r=0,o=t.length;r<o;r++){let D=t[r].split("=");e[decodeURIComponent(D[0])]=decodeURIComponent(D[1])}return e}class TransportError extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Transport extends Emitter{constructor(e){super(),this.writable=!1,installTimerFunctions(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new TransportError(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=encode(e);return t.length?"?"+t:""}}class Polling extends Transport{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};decodePayload(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,encodePayload(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=randomString()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const hasCORS=value;function empty(){}class BaseXHR extends Polling{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(o,D)=>{this.onError("xhr post error",o,D)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Request extends Emitter{constructor(e,t,r){super(),this.createRequest=e,installTimerFunctions(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=pick(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var o;r.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=Request.requestsCount++,Request.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=empty,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Request.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Request.requestsCount=0;Request.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const n="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(n,unloadHandler,!1)}}function unloadHandler(){for(let n in Request.requests)Request.requests.hasOwnProperty(n)&&Request.requests[n].abort()}const hasXHR2=function(){const n=newRequest({xdomain:!1});return n&&n.responseType!==null}();class XHR extends BaseXHR{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=hasXHR2&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Request(newRequest,this.uri(),e)}}function newRequest(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||hasCORS))return new XMLHttpRequest}catch{}if(!e)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class BaseWS extends Transport{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],o=t===e.length-1;encodePacket(r,this.supportsBinary,D=>{try{this.doWrite(r,D)}catch{}o&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=randomString()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const WebSocketCtor=globalThisShim.WebSocket||globalThisShim.MozWebSocket;class WS extends BaseWS{createSocket(e,t,r){return isReactNative?new WebSocketCtor(e,t,r):t?new WebSocketCtor(e,t):new WebSocketCtor(e)}doWrite(e,t){this.ws.send(t)}}class WT extends Transport{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),o=createPacketEncoderStream();o.readable.pipeTo(e.writable),this._writer=o.writable.getWriter();const D=()=>{r.read().then(({done:k,value:B})=>{k||(this.onPacket(B),D())}).catch(k=>{})};D();const N={type:"open"};this.query.sid&&(N.data=`{"sid":"${this.query.sid}"}`),this._writer.write(N).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],o=t===e.length-1;this._writer.write(r).then(()=>{o&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const transports={websocket:WS,webtransport:WT,polling:XHR},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let o=re.exec(n||""),D={},N=14;for(;N--;)D[parts[N]]=o[N]||"";return t!=-1&&r!=-1&&(D.source=e,D.host=D.host.substring(1,D.host.length-1).replace(/;/g,":"),D.authority=D.authority.replace("[","").replace("]","").replace(/;/g,":"),D.ipv6uri=!0),D.pathNames=pathNames(D,D.path),D.queryKey=queryKey(D,D.query),D}function pathNames(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function queryKey(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,o,D){o&&(t[o]=D)}),t}const withEventListeners=typeof addEventListener=="function"&&typeof removeEventListener=="function",OFFLINE_EVENT_LISTENERS=[];withEventListeners&&addEventListener("offline",()=>{OFFLINE_EVENT_LISTENERS.forEach(n=>n())},!1);class SocketWithoutUpgrade extends Emitter{constructor(e,t){if(super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=parse(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=parse(t.host).host);installTimerFunctions(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const o=r.prototype.name;this.transports.push(o),this._transportsByName[o]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode(this.opts.query)),withEventListeners&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=protocol$1,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&SocketWithoutUpgrade.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",SocketWithoutUpgrade.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=byteLength(r)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,nextTick(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,o){if(typeof t=="function"&&(o=t,t=void 0),typeof r=="function"&&(o=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const D={type:e,data:t,options:r};this.emitReserved("packetCreate",D),this.writeBuffer.push(D),o&&this.once("flush",o),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(SocketWithoutUpgrade.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),withEventListeners&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);r!==-1&&OFFLINE_EVENT_LISTENERS.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}SocketWithoutUpgrade.protocol=protocol$1;class SocketWithUpgrade extends SocketWithoutUpgrade{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;SocketWithoutUpgrade.priorWebsocketSuccess=!1;const o=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",H=>{if(!r)if(H.type==="pong"&&H.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;SocketWithoutUpgrade.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(U(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const $=new Error("probe error");$.transport=t.name,this.emitReserved("upgradeError",$)}}))};function D(){r||(r=!0,U(),t.close(),t=null)}const N=H=>{const $=new Error("probe error: "+H);$.transport=t.name,D(),this.emitReserved("upgradeError",$)};function k(){N("transport closed")}function B(){N("socket closed")}function G(H){t&&H.name!==t.name&&D()}const U=()=>{t.removeListener("open",o),t.removeListener("error",N),t.removeListener("close",k),this.off("close",B),this.off("upgrading",G)};t.once("open",o),t.once("error",N),t.once("close",k),this.once("close",B),this.once("upgrading",G),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let Socket$1=class extends SocketWithUpgrade{constructor(n,e={}){const t=typeof n=="object"?n:e;(!t.transports||t.transports&&typeof t.transports[0]=="string")&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(r=>transports[r]).filter(r=>!!r)),super(n,t)}};function url(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=parse(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString.call(File)==="[object FileConstructor]";function isBinary(n){return withNativeArrayBuffer&&(n instanceof ArrayBuffer||isView(n))||withNativeBlob&&n instanceof Blob||withNativeFile&&n instanceof File}function hasBinary(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(hasBinary(n[t]))return!0;return!1}if(isBinary(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return hasBinary(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&hasBinary(n[t]))return!0;return!1}function deconstructPacket(n){const e=[],t=n.data,r=n;return r.data=_deconstructPacket(t,e),r.attachments=e.length,{packet:r,buffers:e}}function _deconstructPacket(n,e){if(!n)return n;if(isBinary(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=_deconstructPacket(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=_deconstructPacket(n[r],e));return t}return n}function reconstructPacket(n,e){return n.data=_reconstructPacket(n.data,e),delete n.attachments,n}function _reconstructPacket(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=_reconstructPacket(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=_reconstructPacket(n[t],e));return n}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));class Encoder{constructor(e){this.replacer=e}encode(e){return(e.type===PacketType.EVENT||e.type===PacketType.ACK)&&hasBinary(e)?this.encodeAsBinary({type:e.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===PacketType.BINARY_EVENT||e.type===PacketType.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=deconstructPacket(e),r=this.encodeAsString(t.packet),o=t.buffers;return o.unshift(r),o}}function isObject(n){return Object.prototype.toString.call(n)==="[object Object]"}class Decoder extends Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===PacketType.BINARY_EVENT;r||t.type===PacketType.BINARY_ACK?(t.type=r?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(isBinary(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(PacketType[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===PacketType.BINARY_EVENT||r.type===PacketType.BINARY_ACK){const D=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const N=e.substring(D,t);if(N!=Number(N)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(N)}if(e.charAt(t+1)==="/"){const D=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(D,t)}else r.nsp="/";const o=e.charAt(t+1);if(o!==""&&Number(o)==o){const D=t+1;for(;++t;){const N=e.charAt(t);if(N==null||Number(N)!=N){--t;break}if(t===e.length)break}r.id=Number(e.substring(D,t+1))}if(e.charAt(++t)){const D=this.tryParse(e.substr(t));if(Decoder.isPayloadValid(r.type,D))r.data=D;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case PacketType.CONNECT:return isObject(t);case PacketType.DISCONNECT:return t===void 0;case PacketType.CONNECT_ERROR:return typeof t=="string"||isObject(t);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&RESERVED_EVENTS$1.indexOf(t[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder,Encoder,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[on(e,"open",this.onopen.bind(this)),on(e,"packet",this.onpacket.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,o,D;if(RESERVED_EVENTS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const N={type:PacketType.EVENT,data:t};if(N.options={},N.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const G=this.ids++,U=t.pop();this._registerAckCallback(G,U),N.id=G}const k=(o=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||o===void 0?void 0:o.writable,B=this.connected&&!(!((D=this.io.engine)===null||D===void 0)&&D._hasPingExpired());return this.flags.volatile&&!k||(B?(this.notifyOutgoingListeners(N),this.packet(N)):this.sendBuffer.push(N)),this.flags={},this}_registerAckCallback(e,t){var r;const o=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(o===void 0){this.acks[e]=t;return}const D=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let k=0;k<this.sendBuffer.length;k++)this.sendBuffer[k].id===e&&this.sendBuffer.splice(k,1);t.call(this,new Error("operation has timed out"))},o),N=(...k)=>{this.io.clearTimeoutFn(D),t.apply(this,k)};N.withError=!0,this.acks[e]=N}emitWithAck(e,...t){return new Promise((r,o)=>{const D=(N,k)=>N?o(N):r(k);D.withError=!0,t.push(D),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((o,...D)=>r!==this._queue[0]?void 0:(o!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(o)):(this._queue.shift(),t&&t(null,...D)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(e);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(e);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...o){r||(r=!0,t.packet({type:PacketType.ACK,id:e,data:o}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Backoff(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(n){this.ms=n};Backoff.prototype.setMax=function(n){this.max=n};Backoff.prototype.setJitter=function(n){this.jitter=n};class Manager extends Emitter{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,installTimerFunctions(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const o=t.parser||parser;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const o=on(t,"open",function(){r.onopen(),e&&e()}),D=k=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",k),e?e(k):this.maybeReconnectOnOpen()},N=on(t,"error",D);if(this._timeout!==!1){const k=this._timeout,B=this.setTimeoutFn(()=>{o(),D(new Error("timeout")),t.close()},k);this.opts.autoUnref&&B.unref(),this.subs.push(()=>{this.clearTimeoutFn(B)})}return this.subs.push(o),this.subs.push(N),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(on(e,"ping",this.onping.bind(this)),on(e,"data",this.ondata.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){nextTick(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Socket(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(o=>{o?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",o)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const cache={};function lookup(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=url(n,e.path||"/socket.io"),r=t.source,o=t.id,D=t.path,N=cache[o]&&D in cache[o].nsps,k=e.forceNew||e["force new connection"]||e.multiplex===!1||N;let B;return k?B=new Manager(r,e):(cache[o]||(cache[o]=new Manager(r,e)),B=cache[o]),t.query&&!e.query&&(e.query=t.queryKey),B.socket(t.path,e)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});class SysBase{constructor(e={},t){this.hPlg=e,this.arg=t}hFactoryCls={};elc=new EventListenerCtn;async loaded(...[e]){const t=e.snsys_pre;return delete e.snsys_pre,t?.init({getInfo:this.#r,addTag:()=>{},addLayCls:()=>{},searchPath:()=>"",getVal:()=>({}),resume:()=>{},render:()=>{},setDec:r=>this.dec=r,setDecAB:r=>this.#A=r,setEnc:r=>this.enc=r,getStK:r=>this.stk=r,getHash:r=>this.hash=r})}fetch=(e,t)=>fetch(e,t);destroy(){this.elc.clear()}resolution=1;cfg;async loadPath(e,t){this.cfg=t}data={sys:{},mark:{},kidoku:{}};async initVal(e,t,r){}flush(){if(this.#t){this.#e=!0;return}this.flushSub(),this.#t=setTimeout(()=>{this.#t=void 0,this.#e&&(this.#e=!1,this.flush())},500)}#t=void 0;#e=!1;flushSub(){}async run(){}val;main;init(e,t,r,o){this.val=r,this.main=o;let D="";try{r.setSys(this),D="sys",D+=Number(r.getVal("sys:TextLayer.Back.Alpha",1)),D="kidoku",r.saveKidoku()}catch(N){console.error(`セーブデータ（${D}）が壊れています。一度クリアする必要があります(b) %o`,N)}return e.close=N=>this.close(N),e.export=N=>this._export(N),e.import=N=>this._import(N),e.navigate_to=N=>this.navigate_to(N),e.title=N=>this.title(N),e.toggle_full_screen=N=>this.#y(N),e.update_check=N=>this.update_check(N),e.window=N=>this.window(N),r.setVal_Nochk("tmp","const.sn.isApp",()=>this.isApp),r.setVal_Nochk("tmp","const.sn.isDbg",()=>CmnLib.isDbg),r.setVal_Nochk("tmp","const.sn.isPackaged",()=>CmnLib.isPackaged),r.defTmp("const.sn.displayState",()=>this.isFullScr),r.setVal_Nochk("sys",SysBase.VALNM_CFG_NS,this.cfg.oCfg.save_ns),r.flush(),CmnLib.isDbg&&this.attach_debug(o),this.hFactoryCls={},Object.values(this.hPlg).map(N=>N.init({getInfo:this.#r,addTag:(k,B)=>{if(e[k])throw`すでに定義済みのタグ[${k}]です`;e[k]=B},addLayCls:(k,B)=>{if(this.hFactoryCls[k])throw`すでに定義済みのレイヤcls【${k}】です`;this.hFactoryCls[k]=B},searchPath:(k,B=SEARCH_PATH_ARG_EXT.DEFAULT)=>this.cfg.searchPath(k,B),getVal:r.getVal,resume:()=>o.resume(),render:(k,B,G=!1)=>t.renderer.render(k,{renderTexture:B,clear:G}),setDec:()=>{},setDecAB:()=>{},setEnc:()=>{},getStK:()=>{},getHash:()=>{}}))}static VALNM_CFG_NS="const.sn.cfg.ns";#r=()=>({window:{width:CmnLib.stageW,height:CmnLib.stageH}});#s=0;#i=0;#a=1;#h=0;#d=0;#l=0;#f=0;get cvsWidth(){return this.#s}get cvsHeight(){return this.#i}get cvsScale(){return this.#a}get ofsLeft4elm(){return this.#h}get ofsTop4elm(){return this.#d}get ofsPadLeft_Dom2PIXI(){return this.#l}get ofsPadTop_Dom2PIXI(){return this.#f}isFullScr=!1;cvsResize(){let e=globalThis.innerWidth,t=globalThis.innerHeight;const r=this.main.cvs,o=r.parentElement!==document.body;if(o){const B=globalThis.getComputedStyle(r);e=parseFloat(B.width),t=parseFloat(B.height)}if(CmnLib.isMobile){const B=(screen.orientation?.angle??0)%180===0;(B&&e>t||!B&&e<t)&&([e,t]=[t,e])}const D=r.getBoundingClientRect();if(argChk_Boolean(CmnLib.hDip,"expanding",!0)||o||CmnLib.stageW>e||CmnLib.stageH>t)if(CmnLib.stageW/CmnLib.stageH<=e/t?(this.#i=t,this.#s=CmnLib.stageW/CmnLib.stageH*t):(this.#s=e,this.#i=CmnLib.stageH/CmnLib.stageW*e),this.#a=this.#s/CmnLib.stageW,o)this.#l=0,this.#f=0;else{const B=1-this.#a;CmnLib.isMobile?(this.#l=(e-this.#s)/2*B,this.#f=(t-this.#i)/2*B):(this.#l=D.left*B,this.#f=D.top*B)}else this.#s=CmnLib.stageW,this.#i=CmnLib.stageH,this.#a=1,this.#l=0,this.#f=0;const N=r.parentElement.style;o||(N.position="relative",N.width=`${this.#s}px`,N.height=`${this.#i}px`);const k=r.style;k.width=N.width,k.height=N.height,o?(this.#h=D.left,this.#d=D.top):(this.#h=0,this.#d=0),this.isFullScr&&(this.#h+=(e-this.#s)/2,this.#d+=(t-this.#i)/2)}attach_debug(e){this.attach_debug=()=>{};const t=document.createElement("style");t.innerHTML=`/* SKYNovel Dbg */
.sn_BounceInOut { animation: sn_kfBounceInOut linear 1.5s; }
@keyframes sn_kfBounceInOut{
0%	{opacity: 0;	transform: scaleX(0.30) scaleY(0.30);}
10%	{opacity: 1;	transform: scaleX(1.10) scaleY(1.10);}
20%	{				transform: scaleX(0.95) scaleY(0.95);}
30%	{				transform: scaleX(1.00) scaleY(1.00);}
70%	{opacity: 1;}
100%{opacity: 0;}
}
.sn_BounceIn { animation: sn_kfBounceIn linear 0.3s; }
@keyframes sn_kfBounceIn{
0%	{opacity: 0;	transform: scaleX(0.30) scaleY(0.30);}
50%	{opacity: 1;	transform: scaleX(1.10) scaleY(1.10);}
100%{				transform: scaleX(0.95) scaleY(0.95);}
}
.sn_HopIn { animation: sn_kfHopIn linear 0.8s; }
@keyframes sn_kfHopIn{
0%	{transform:	translate(0px,   0px);}
15% {transform:	translate(0px, -25px);}
30% {transform:	translate(0px,   0px);}
45% {transform:	translate(0px, -15px);}
60% {transform:	translate(0px,   0px);}
75% {transform:	translate(0px,  -5px);}
100%{transform:	translate(0px,   0px);}
}`,document.getElementsByTagName("head")[0].appendChild(t),this.addHook((r,o)=>this.#c[r]?.(o)),this.#n=lookup(`http://localhost:${this.extPort}`),this.#n.on("data",(r,o)=>{this.callHook(r,o)}).on("disconnect",()=>e.setLoop(!0)),this.callHook=(r,o)=>{for(const D of this.#m)D(r,o)}}extPort=3776;end(){this.#n?.disconnect(),this.#n=void 0}#n=void 0;#c={auth:e=>{if(e.t!==this.cfg.oCfg.debuger_token){this.end();return}this.toast("接続")},continue:()=>this.toast("再生"),disconnect:()=>this.toast("切断"),restart:async e=>{this.send2Dbg(e?.ri??"",{}),this.end(),await this.run()},pause:()=>this.toast("一時停止"),stopOnEntry:()=>this.toast("一時停止"),stopOnDataBreakpoint:()=>this.toast("注意"),stopOnBreakpoint:()=>this.toast("注意"),stopOnStep:()=>this.toast("一歩進む"),stopOnStepIn:()=>this.toast("ステップイン"),stopOnStepOut:()=>this.toast("ステップアウト"),stopOnBackstep:()=>this.toast("一歩戻る"),_addPath:e=>this.cfg.addPath(e.fn,e.o)};toast(e){const t=document.body;for(const N of[...Array.from(t.getElementsByClassName("sn_BounceIn")),...Array.from(t.getElementsByClassName("sn_HopIn"))])N.remove();const r=document.createElement("img"),o=SysBase.#g[e];if(!o)throw new Error(`toast 名ミス=${e}`);r.src=`data:image/svg+xml;base64,${o.dat}`;const D=Math.min(CmnLib.stageW,CmnLib.stageH)/4*this.#a;r.width=r.height=D,r.style.cssText=`position: absolute;
left: ${(CmnLib.stageW-D)/2*this.#a+D*(o.dx??0)}px;
top: ${(CmnLib.stageH-D)/2*this.#a+D*(o.dy??0)}px;`,r.classList.add("sn_toast",o.ease??"sn_BounceInOut"),o.ease||r.addEventListener("animationend",()=>t.removeChild(r),{once:!0,passive:!0}),t.insertBefore(r,this.main.cvs)}static#g={接続:{dx:-1,dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtNjQwIDMyMGMwIDE3Ni43My0xNDMuMjcgMzIwLTMyMCAzMjBzLTMyMC0xNDMuMjctMzIwLTMyMCAxNDMuMjctMzIwIDMyMC0zMjAgMzIwIDE0My4yNyAzMjAgMzIweiIvPjxwYXRoIGlkPSJiIiBkPSJtMCAyOTJ2NTUuODhoMTI3LjEzYzEyLjM3IDQ2IDU0LjEyIDc5Ljg3IDEwNCA3OS44N2g3Ny44N3YtMjE1LjYyYy00Ni43MyAwLTcyLjY4IDAtNzcuODggMC00OS43NCAwLTkxLjYyIDMzLjg3LTEwMy45OSA3OS44Ny0xNi45NSAwLTU5LjMzIDAtMTI3LjEzIDB6Ii8+PHBhdGggaWQ9ImMiIGQ9Im01MTIuODggMjkyYy0xMi4zOC00Ni01NC4xMy03OS44Ny0xMDQtNzkuODctNS4yMSAwLTMxLjIxIDAtNzggMHYyMTUuNzRoNzcuODdjNDkuODggMCA5MS43NS0zMy44NyAxMDQtNzkuODdoMTI3LjI1di01NmMtNzYuMjcgMC0xMTguNjUgMC0xMjcuMTIgMHoiLz48L2RlZnM+PHVzZSBmaWxsPSIjMmUyZTJlIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9IiMzYWFiZDIiIHhsaW5rOmhyZWY9IiNiIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYiIvPjx1c2UgZmlsbD0iIzNhYWJkMiIgeGxpbms6aHJlZj0iI2MiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNjIi8+PC9zdmc+"},切断:{dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtNjQwIDMyMGMwIDE3Ni43My0xNDMuMjcgMzIwLTMyMCAzMjBzLTMyMC0xNDMuMjctMzIwLTMyMCAxNDMuMjctMzIwIDMyMC0zMjAgMzIwIDE0My4yNyAzMjAgMzIweiIvPjxwYXRoIGlkPSJiIiBkPSJtMTkxLjUzIDIyMS4yNGMtNDUuNjggMC04NC4wMSAzMS4wNC05NS4zIDczLjE2LTYuNDEgMC0zOC40OSAwLTk2LjIzIDB2NTEuMjFoOTYuMjNjMTEuMyA0Mi4xMSA0OS42MyA3My4xNiA5NS4zIDczLjE2aDcxLjMzdi00OC4yNGg1My43OHYtMTAxLjA1aC01My43OHYtNDguMjRjLTQyLjggMC02Ni41NyAwLTcxLjMzIDB6Ii8+PHBhdGggaWQ9ImMiIGQ9Im00NDguNDcgMjIxLjIzYy00Ljc2IDAtMjguNTMgMC03MS4zMyAwdjE5Ny41M2g3MS4zM2M0NS42OCAwIDgzLjk5LTMxLjA0IDk1LjI5LTczLjE1aDk2LjI0di01MS4yMWgtOTYuMjRjLTMzLjA4LTQ4Ljc4LTY0Ljg0LTczLjE3LTk1LjI5LTczLjE3eiIvPjwvZGVmcz48dXNlIGZpbGw9IiMyZTJlMmUiIHhsaW5rOmhyZWY9IiNhIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0iI2RmNTY1NiIgeGxpbms6aHJlZj0iI2IiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNiIi8+PHVzZSBmaWxsPSIjZGY1NjU2IiB4bGluazpocmVmPSIjYyIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2MiLz48L3N2Zz4="},再生:{dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem0yNTguODMgMTExLjA1Yy0xLjI5Ljc5LTIuOTMuODMtNC4yNi4wNC0xLjI5LS43NC0yLjExLTIuMTItMi4xMS0zLjY3IDAtNy4xNiAwLTQyLjk3IDAtMTA3LjQzczAtMTAwLjI3IDAtMTA3LjQzYzAtMS41My44Mi0yLjkzIDIuMTEtMy42OCAxLjMzLS43NiAyLjk3LS43MiA0LjI2LjA0IDE4IDEwLjc1IDE2MiA5Ni43MSAxODAgMTA3LjQ2IDEuMjkuNzMgMi4wNSAyLjE0IDIuMDUgMy42MSAwIDEuNDktLjc2IDIuODgtMi4wNSAzLjYzLTM2IDIxLjQ5LTE2MiA5Ni42OS0xODAgMTA3LjQzeiIvPjwvZGVmcz48cGF0aCBkPSJtMTU0LjU3IDE3MC4xOWgzNDYuMTV2MzA3LjY5aC0zNDYuMTV6IiBmaWxsPSIjZmZmIi8+PHVzZSBmaWxsPSIjMmUyZTJlIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2EiLz48L3N2Zz4="},一時停止:{dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem0yMDAgMTAwdi0yMDBoODB2MjAwem0xNjAgMHYtMjAwaDgwdjIwMHoiLz48L2RlZnM+PHBhdGggZD0ibTE0Ny40OSAxODAuNDFoMzUyLjR2MjgyLjY5aC0zNTIuNHoiIGZpbGw9IiNmZmYiLz48dXNlIGZpbGw9IiMyZTJlMmUiIHhsaW5rOmhyZWY9IiNhIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYSIvPjwvc3ZnPg=="},注意:{ease:"sn_HopIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMzQzLjM0IDI5LjJjLTEwLjM3LTE3Ljk3LTM2LjMxLTE3Ljk3LTQ2LjY5IDAtMjkuMyA1MC43NS0yNjMuNyA0NTYuNzQtMjkzIDUwNy40OS0xMC4zNyAxNy45NyAyLjU5IDQwLjQ0IDIzLjM0IDQwLjQ0aDU4Ni4wMWMyMC43NSAwIDMzLjcyLTIyLjQ2IDIzLjM1LTQwLjQ0LTU4LjYtMTAxLjUtMjYzLjctNDU2Ljc0LTI5My4wMS01MDcuNDl6bS0yMy4zNCA0ODIuODNjLTE0LjUyIDAtMjYuMjktMi43MS0yNi4yOS02LjA2IDAtNC4yMSAwLTM3Ljg2IDAtNDIuMDcgMC0zLjM1IDExLjc3LTYuMDcgMjYuMjktNi4wN3MyNi4yOSAyLjcyIDI2LjI5IDYuMDd2NDIuMDdjLTcuODQgNC4wNC0xNi42MSA2LjA2LTI2LjI5IDYuMDZ6bTIxLjk5LTEwMy44NGMwIDUuNDMtOS44NSA5LjgzLTIxLjk5IDkuODMtMTIuMTUgMC0yMS45OS00LjQtMjEuOTktOS44MyAwLS4xMy4wNy0uMjUuMDgtLjM4LTEuMzctMTcuNTYtMTIuMy0xNTguMDYtMTMuNjctMTc1LjYyIDAtNS40MyAxNS45My05Ljg0IDM1LjU4LTkuODRzMzUuNTggNC40MSAzNS41OCA5Ljg0Yy0uOTEgMTEuNy01LjQ3IDcwLjI1LTEzLjY3IDE3NS42Mi4wNi4xNi4wOC4yOS4wOC4zOHoiLz48L2RlZnM+PHBhdGggZD0ibTI0MS4yOSAxOTEuNDRoMTQ1LjQ5djM1MS42NmgtMTQ1LjQ5eiIgZmlsbD0iI2ZmZiIvPjx1c2UgZmlsbD0iI2QyYmYzYSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNhIi8+PC9zdmc+"},一歩進む:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem0zNzYuOTMgOTEuOTdjMC01My41MSAwLTgzLjI0IDAtODkuMTktLjE1LjE0LS4yNS4zNC0uNDQuNDUtMTYuMTEgOS42Mi0xNDQuOTUgODYuNTQtMTYxLjA2IDk2LjE1LTEuMTUuNjktMi42Mi43My0zLjgxLjAyLTEuMTUtLjY0LTEuODktMS44OS0xLjg5LTMuMjggMC02LjQxIDAtMzguNDQgMC05Ni4xMSAwLTU3LjY5IDAtODkuNzQgMC05Ni4xNSAwLTEuMzUuNzQtMi42MiAxLjg5LTMuMjkgMS4xOS0uNjggMi42Ni0uNjQgMy44MS4wNCAxNi4xMSA5LjYyIDE0NC45NSA4Ni41NCAxNjEuMDYgOTYuMTYuMTkuMS4yOS4zMS40NC40NSAwLTYuMTMgMC0zNi43NyAwLTkxLjkyaDUzLjMydjE4Ni42N3oiLz48L2RlZnM+PHBhdGggZD0ibTE0Ny40OSAxNTQuMmgzNTIuNHYzMDguOWgtMzUyLjR6IiBmaWxsPSIjZmZmIi8+PHVzZSBmaWxsPSIjMmUyZTJlIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2EiLz48L3N2Zz4="},一歩戻る:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem00MzAuMjcgOTYuMTRjMCAxLjM1LS43NCAyLjYyLTEuODkgMy4yOC0xLjE5LjY5LTIuNjYuNjUtMy44MS0uMDMtMTYuMTEtOS42Mi0xNDQuOTUtODYuNTQtMTYxLjA1LTk2LjE2LS4yLS4xLS4yOS0uMzEtLjQ1LS40NXY5MS45MmgtNTMuMzJ2LTE4Ni42N2g1My4zMnY4OS4xOWMuMTYtLjE0LjI1LS4zNC40NS0uNDUgMTYuMS05LjYyIDE0NC45NC04Ni41NCAxNjEuMDUtOTYuMTYgMS4xNS0uNjggMi42Mi0uNzIgMy44MS0uMDEgMS4xNS42NCAxLjg5IDEuODkgMS44OSAzLjI4djk2LjExeiIvPjwvZGVmcz48cGF0aCBkPSJtMTQ3LjQ5IDE1NC4yaDM1Mi40djMwOC45aC0zNTIuNHoiIGZpbGw9IiNmZmYiLz48dXNlIGZpbGw9IiMyZTJlMmUiIHhsaW5rOmhyZWY9IiNhIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYSIvPjwvc3ZnPg=="},ステップイン:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMTkuOTljMCAxNzYuNzQgMTQzLjI3IDMyMC4wMSAzMjAuMDEgMzIwLjAxIDE3Ni43MiAwIDMxOS45OS0xNDMuMjcgMzE5Ljk5LTMyMC4wMSAwLTE3Ni43Mi0xNDMuMjctMzE5Ljk5LTMxOS45OS0zMTkuOTktMTc2Ljc0IDAtMzIwLjAxIDE0My4yNy0zMjAuMDEgMzE5Ljk5em0xNTMuMDUtMjkuNzIgNTUuMTItNTUuMTMgMTExLjg0IDExMS44MiAxMTEuODItMTExLjgyIDU1LjEyIDU1LjEyLTE2Ni45NCAxNjYuOTd6Ii8+PC9kZWZzPjxwYXRoIGQ9Im0xNDcuNDkgMTU0LjJoMzUyLjR2MzA4LjloLTM1Mi40eiIgZmlsbD0iI2ZmZiIvPjx1c2UgZmlsbD0iIzJlMmUyZSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNhIi8+PC9zdmc+"},ステップアウト:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjAuMDFjMCAxNzYuNzIgMTQzLjI3IDMxOS45OSAzMTkuOTkgMzE5Ljk5IDE3Ni43NCAwIDMyMC4wMS0xNDMuMjcgMzIwLjAxLTMxOS45OSAwLTE3Ni43NC0xNDMuMjctMzIwLjAxLTMyMC4wMS0zMjAuMDEtMTc2LjcyIDAtMzE5Ljk5IDE0My4yNy0zMTkuOTkgMzIwLjAxem0zMTkuOTktMjYuOTgtMTExLjgyIDExMS44My01NS4xMi01NS4xMyAxNjYuOTQtMTY2Ljk2IDE2Ni45NiAxNjYuOTYtNTUuMTIgNTUuMTN6Ii8+PC9kZWZzPjxwYXRoIGQ9Im0xNDcuNDkgMTU0LjJoMzUyLjR2MzA4LjloLTM1Mi40eiIgZmlsbD0iI2ZmZiIvPjx1c2UgZmlsbD0iIzJlMmUyZSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNhIi8+PC9zdmc+"}};pathBaseCnvSnPath4Dbg="";fire;setFire(e){this.fire=e}#m=[];addHook(e){this.#m.push(e)}callHook=(e,t)=>{};send2Dbg=(e,t)=>{this.#n?.emit("data",e,t)};copyBMFolder=(e,t)=>{};eraseBMFolder=e=>{};close=()=>!1;_export=()=>!1;_import=()=>!1;navigate_to=()=>!1;title=e=>{const{text:t}=e;if(!t)throw"[title] textは必須です";return this.#p=t,this.titleSub(this.#p+this.#u),!1};#p="";titleSub(e){}#y=e=>{if(!e.key)return this.tglFlscr_sub(),!1;const t=e.key.toLowerCase();return this.elc.add(document,EVNM_KEY,r=>{SysBase.modKey(r)+r.key.toLowerCase()===t&&(r.stopPropagation(),this.tglFlscr_sub())},{passive:!0}),!1};static modKey(e){return(e.altKey?e.key==="Alt"?"":"alt+":"")+(e.ctrlKey?e.key==="Control"?"":"ctrl+":"")+(e.metaKey?e.key==="Meta"?"":"meta+":"")+(e.shiftKey?e.key==="Shift"?"":"shift+":"")}tglFlscr_sub(){}update_check=()=>!1;window=()=>!1;#u="";setTitleInfo(e){this.#u=e,this.titleSub(this.#p+this.#u)}#A=()=>Promise.resolve({ext_num:0,ab:new ArrayBuffer(0)});dec=(e,t)=>Promise.resolve(t);async decAB(e){const{ext_num:t,ab:r}=await this.#A(e),o=this.#v[t];return o?.fnc?await o.fnc(r):r}#v={1:{ext:"jpeg",fnc:e=>this.#_(e,"image/jpeg")},2:{ext:"png",fnc:e=>this.#_(e,"image/png")},3:{ext:"svg",fnc:e=>this.#_(e,"image/svg+xml")},4:{ext:"webp",fnc:e=>this.#_(e,"image/webp")},20:{ext:"mp4",fnc:e=>this.#o(e,"video/mp4")},21:{ext:"webm",fnc:e=>this.#o(e,"video/webm")},22:{ext:"ogv",fnc:e=>this.#o(e,"video/ogv")}};#_=(e,t)=>new Promise((r,o)=>{const D=new Blob([e],{type:t}),N=new Image;N.onload=()=>r(N),N.onerror=k=>o(k),N.src=URL.createObjectURL(D)});#o=(e,t)=>new Promise((r,o)=>{const D=new Blob([e],{type:t}),N=document.createElement("video");this.elc.add(N,"error",()=>o(N?.error?.message??"")),this.elc.add(N,"canplay",()=>r(N)),N.src=URL.createObjectURL(D)});enc=async e=>e;stk=()=>"";hash=e=>"";isApp=!1;$path_downloads="";get path_downloads(){return this.$path_downloads}$path_userdata="";get path_userdata(){return this.$path_userdata}capturePage(e,t,r,o){}async savePic(e,t){}async ensureFileSync(e){}async appendFile(e,t){}async outputFile(e,t){}}const SN_ID="skynovel";class Main{constructor(e){this.sys=e,skipHello(),Config.generate(e).then(t=>this.#a(t)).catch(t=>console.error("load err fn:prj.json e:%o",t))}cvs;#t=Object.create(null);#e;#r;#s;#i=[];async#a(e){const t={width:e.oCfg.window.width,height:e.oCfg.window.height,backgroundColor:parseColor(String(e.oCfg.init.bg_color)),resolution:globalThis.devicePixelRatio??1},r=document.getElementById(SN_ID);if(r){const N=r.cloneNode(!0);N.id=SN_ID,t.view=r;const k=r.parentNode;this.#i.unshift(()=>k.appendChild(N))}else{const N=document.createElement("canvas");N.id=SN_ID,t.view=N,document.body.appendChild(N),this.#i.unshift(()=>document.body.removeChild(N))}const o=new Application(t);this.#i.unshift(()=>{clearTextureCache(),this.sys.destroy(),o.destroy(!1)}),this.cvs=o.view,this.cvs.id=SN_ID+"_act",r||document.body.appendChild(this.cvs);const D=document.createElement("canvas")?.getContext("2d");if(!D)throw"#init cc err";CmnLib.cc4ColorName=D,await Promise.all([__vitePreload(()=>import("./Variable.js"),__vite__mapDeps([0,1,2]),import.meta.url),__vitePreload(()=>import("./PropParser.js"),__vite__mapDeps([1,2]),import.meta.url),__vitePreload(()=>import("./SoundMng.js"),__vite__mapDeps([3,2]),import.meta.url),Promise.resolve().then(()=>ScriptIterator$1),Promise.resolve().then(()=>LayerMng$1),Promise.resolve().then(()=>EventMng$1)]).then(async([{Variable:N},{PropParser:k},{SoundMng:B},{ScriptIterator:G},{LayerMng:U},{EventMng:H}])=>{const $=new N(e,this.#t),V=new k($,e.oCfg.init.escape??"\\");this.#h=(z,W,q,K)=>$.setVal_Nochk(z,W,q,K),this.#f=z=>V.getValAmpersand(z),this.#n=z=>V.parse(z),await Promise.allSettled(this.sys.init(this.#t,o,$,this)),this.#t.title({text:e.oCfg.book.title||"SKYNovel"});const Y=new B(e,this.#t,$,this,this.sys);this.#i.unshift(()=>Y.destroy()),this.#e=new G(e,this.#t,this,$,V,Y,this.sys),this.#i.unshift(()=>this.#e.destroy());const X=new DebugMng(this.sys,this.#t,this.#e);this.#i.unshift(()=>X.destroy()),this.errScript=(z,W=!0)=>{if(this.stop(),DebugMng.myTrace(z),CmnLib.debugLog&&console.log("🍜 SKYNovel err!"),W)throw z},this.#r=new U(e,this.#t,o,$,this,this.#e,this.sys,Y,V),this.#i.unshift(()=>this.#r.destroy()),this.#s=new H(e,this.#t,o,this,this.#r,$,Y,this.#e,this.sys),this.#i.unshift(()=>this.#s.destroy()),this.#i.unshift(()=>{this.stop(),this.#d=!1;const z=()=>!0;for(const W in this.#t)this.#t[W]=z})})}destroy(){this.resume=this.destroy=()=>{},this.cvs.parentElement?.removeChild(this.cvs);for(const e of this.#i)e();this.#i=[]}errScript=(e,t=!0)=>{};resumeByJumpOrCall(e){if(e.url){this.#t.navigate_to(e),this.#e.jumpJustBefore();return}if(this.#h("tmp","sn.eventArg",e.arg??""),this.#h("tmp","sn.eventLabel",e.label??""),argChk_Boolean(e,"call",!1)){if(this.#e.subIdxToken(),this.#t.call(e))return}else if(this.#t.clear_event({}),this.#t.jump(e))return;this.resume()}#h=(e,t,r,o=!1)=>{};resume(){this.#r.clearBreak(),this.#e.noticeBreak(!1),this.#s.hideHint(),queueMicrotask(()=>this.#l())}stop=()=>{this.#e.noticeBreak(!0)};setLoop(e,t=""){(this.#d=e)?this.resume():this.stop(),this.sys.setTitleInfo(t?` -- ${t}中`:"")}#d=!0;async#l(){let e="";try{for(;this.#d;){let t=this.#e.nextToken();if(!t)return;const r=t.charCodeAt(0);if(r!==9){if(r===10){this.#e.addLineNum(t.length);continue}if(r===91){if(e="タグ開始",this.#e.isBreak(t))return;const[o,D]=tagToken2Name_Args(t);e=`[${o}]例外`;const N=(t.match(/\n/g)??[]).length;if(N>0&&this.#e.addLineNum(N),await this.#e.タグ解析(o,D)){this.stop();return}continue}if(r===38){if(!t.endsWith("&")){if(e="変数計算",this.#e.isBreak(t))return;const o=splitAmpersand(t.slice(1));o.name=this.#f(o.name),o.text=String(this.#n(o.text)),this.#t.let(o);continue}if(e="変数操作",t.charAt(1)==="&")throw new Error("「&表示&」書式では「&」指定が不要です");t=String(this.#n(t.slice(1,-1)))}else if(r===59||r===42&&t.length>1)continue;e="文字表示",this.#r.setNormalChWait(),this.#r.currentTxtlayForeNeedErr.tagCh(t)}}}catch(t){this.errScript(`${e} ${t instanceof Error?`mes=${t.message}(${t.name})`:t}`,!1)}}#f=e=>"";#n=e=>{}}var util,hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;var n=o(),e=D(),t=N(),r=typeof window<"u"?window:commonjsGlobal;util={assign:n,create:e,trim:t,bind:k,slice:B,each:G,map:U,pluck:H,isList:$,isFunction:V,isObject:Y,Global:r};function o(){return Object.assign?Object.assign:function(X,z,W,q){for(var K=1;K<arguments.length;K++)G(Object(arguments[K]),function(Q,Z){X[Z]=Q});return X}}function D(){if(Object.create)return function(X,z,W,q){var K=B(arguments,1);return n.apply(this,[Object.create(X)].concat(K))};{let X=function(){};return function(z,W,q,K){var Q=B(arguments,1);return X.prototype=z,n.apply(this,[new X].concat(Q))}}}function N(){return String.prototype.trim?function(X){return String.prototype.trim.call(X)}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function k(X,z){return function(){return z.apply(X,Array.prototype.slice.call(arguments,0))}}function B(X,z){return Array.prototype.slice.call(X,z||0)}function G(X,z){H(X,function(W,q){return z(W,q),!1})}function U(X,z){var W=$(X)?[]:{};return H(X,function(q,K){return W[K]=z(q,K),!1}),W}function H(X,z){if($(X)){for(var W=0;W<X.length;W++)if(z(X[W],W))return X[W]}else for(var q in X)if(X.hasOwnProperty(q)&&z(X[q],q))return X[q]}function $(X){return X!=null&&typeof X!="function"&&typeof X.length=="number"}function V(X){return X&&{}.toString.call(X)==="[object Function]"}function Y(X){return X&&{}.toString.call(X)==="[object Object]"}return util}var storeEngine,hasRequiredStoreEngine;function requireStoreEngine(){if(hasRequiredStoreEngine)return storeEngine;hasRequiredStoreEngine=1;var n=requireUtil(),e=n.slice,t=n.pluck,r=n.each,o=n.bind,D=n.create,N=n.isList,k=n.isFunction,B=n.isObject;storeEngine={createStore:H};var G={version:"2.0.12",enabled:!1,get:function($,V){var Y=this.storage.read(this._namespacePrefix+$);return this._deserialize(Y,V)},set:function($,V){return V===void 0?this.remove($):(this.storage.write(this._namespacePrefix+$,this._serialize(V)),V)},remove:function($){this.storage.remove(this._namespacePrefix+$)},each:function($){var V=this;this.storage.each(function(Y,X){$.call(V,V._deserialize(Y),(X||"").replace(V._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function($){return this._namespacePrefix=="__storejs_"+$+"_"},createStore:function(){return H.apply(this,arguments)},addPlugin:function($){this._addPlugin($)},namespace:function($){return H(this.storage,this.plugins,$)}};function U(){var $=typeof console>"u"?null:console;if($){var V=$.warn?$.warn:$.log;V.apply($,arguments)}}function H($,V,Y){Y||(Y=""),$&&!N($)&&($=[$]),V&&!N(V)&&(V=[V]);var X=Y?"__storejs_"+Y+"_":"",z=Y?new RegExp("^"+X):null,W=/^[a-zA-Z0-9_\-]*$/;if(!W.test(Y))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var q={_namespacePrefix:X,_namespaceRegexp:z,_testStorage:function(Q){try{var Z="__storejs__test__";Q.write(Z,Z);var ee=Q.read(Z)===Z;return Q.remove(Z),ee}catch{return!1}},_assignPluginFnProp:function(Q,Z){var ee=this[Z];this[Z]=function(){var J=e(arguments,0),te=this;function oe(){if(ee)return r(arguments,function(fe,me){J[me]=fe}),ee.apply(te,J)}var ce=[oe].concat(J);return Q.apply(te,ce)}},_serialize:function(Q){return JSON.stringify(Q)},_deserialize:function(Q,Z){if(!Q)return Z;var ee="";try{ee=JSON.parse(Q)}catch{ee=Q}return ee!==void 0?ee:Z},_addStorage:function(Q){this.enabled||this._testStorage(Q)&&(this.storage=Q,this.enabled=!0)},_addPlugin:function(Q){var Z=this;if(N(Q)){r(Q,function(te){Z._addPlugin(te)});return}var ee=t(this.plugins,function(te){return Q===te});if(!ee){if(this.plugins.push(Q),!k(Q))throw new Error("Plugins must be function values that return objects");var J=Q.call(this);if(!B(J))throw new Error("Plugins must return an object of function properties");r(J,function(te,oe){if(!k(te))throw new Error("Bad plugin property: "+oe+" from plugin "+Q.name+". Plugins should only return functions.");Z._assignPluginFnProp(te,oe)})}},addStorage:function(Q){U("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(Q)}},K=D(q,G,{plugins:[]});return K.raw={},r(K,function(Q,Z){k(Q)&&(K.raw[Z]=o(K,Q))}),r($,function(Q){K._addStorage(Q)}),r(V,function(Q){K._addPlugin(Q)}),K}return storeEngine}var localStorage_1,hasRequiredLocalStorage;function requireLocalStorage(){if(hasRequiredLocalStorage)return localStorage_1;hasRequiredLocalStorage=1;var n=requireUtil(),e=n.Global;localStorage_1={name:"localStorage",read:r,write:o,each:D,remove:N,clearAll:k};function t(){return e.localStorage}function r(B){return t().getItem(B)}function o(B,G){return t().setItem(B,G)}function D(B){for(var G=t().length-1;G>=0;G--){var U=t().key(G);B(r(U),U)}}function N(B){return t().removeItem(B)}function k(){return t().clear()}return localStorage_1}var oldFFGlobalStorage,hasRequiredOldFFGlobalStorage;function requireOldFFGlobalStorage(){if(hasRequiredOldFFGlobalStorage)return oldFFGlobalStorage;hasRequiredOldFFGlobalStorage=1;var n=requireUtil(),e=n.Global;oldFFGlobalStorage={name:"oldFF-globalStorage",read:r,write:o,each:D,remove:N,clearAll:k};var t=e.globalStorage;function r(B){return t[B]}function o(B,G){t[B]=G}function D(B){for(var G=t.length-1;G>=0;G--){var U=t.key(G);B(t[U],U)}}function N(B){return t.removeItem(B)}function k(){D(function(B,G){delete t[B]})}return oldFFGlobalStorage}var oldIEUserDataStorage,hasRequiredOldIEUserDataStorage;function requireOldIEUserDataStorage(){if(hasRequiredOldIEUserDataStorage)return oldIEUserDataStorage;hasRequiredOldIEUserDataStorage=1;var n=requireUtil(),e=n.Global;oldIEUserDataStorage={name:"oldIE-userDataStorage",write:N,read:k,each:B,remove:G,clearAll:U};var t="storejs",r=e.document,o=V(),D=(e.navigator?e.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function N(Y,X){if(!D){var z=$(Y);o(function(W){W.setAttribute(z,X),W.save(t)})}}function k(Y){if(!D){var X=$(Y),z=null;return o(function(W){z=W.getAttribute(X)}),z}}function B(Y){o(function(X){for(var z=X.XMLDocument.documentElement.attributes,W=z.length-1;W>=0;W--){var q=z[W];Y(X.getAttribute(q.name),q.name)}})}function G(Y){var X=$(Y);o(function(z){z.removeAttribute(X),z.save(t)})}function U(){o(function(Y){var X=Y.XMLDocument.documentElement.attributes;Y.load(t);for(var z=X.length-1;z>=0;z--)Y.removeAttribute(X[z].name);Y.save(t)})}var H=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function $(Y){return Y.replace(/^\d/,"___$&").replace(H,"___")}function V(){if(!r||!r.documentElement||!r.documentElement.addBehavior)return null;var Y="script",X,z,W;try{z=new ActiveXObject("htmlfile"),z.open(),z.write("<"+Y+">document.w=window</"+Y+'><iframe src="/favicon.ico"></iframe>'),z.close(),X=z.w.frames[0].document,W=X.createElement("div")}catch{W=r.createElement("div"),X=r.body}return function(q){var K=[].slice.call(arguments,0);K.unshift(W),X.appendChild(W),W.addBehavior("#default#userData"),W.load(t),q.apply(this,K),X.removeChild(W)}}return oldIEUserDataStorage}var cookieStorage,hasRequiredCookieStorage;function requireCookieStorage(){if(hasRequiredCookieStorage)return cookieStorage;hasRequiredCookieStorage=1;var n=requireUtil(),e=n.Global,t=n.trim;cookieStorage={name:"cookieStorage",read:o,write:N,each:D,remove:k,clearAll:B};var r=e.document;function o(U){if(!U||!G(U))return null;var H="(?:^|.*;\\s*)"+escape(U).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(r.cookie.replace(new RegExp(H),"$1"))}function D(U){for(var H=r.cookie.split(/; ?/g),$=H.length-1;$>=0;$--)if(t(H[$])){var V=H[$].split("="),Y=unescape(V[0]),X=unescape(V[1]);U(X,Y)}}function N(U,H){U&&(r.cookie=escape(U)+"="+escape(H)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function k(U){!U||!G(U)||(r.cookie=escape(U)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function B(){D(function(U,H){k(H)})}function G(U){return new RegExp("(?:^|;\\s*)"+escape(U).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(r.cookie)}return cookieStorage}var sessionStorage_1,hasRequiredSessionStorage;function requireSessionStorage(){if(hasRequiredSessionStorage)return sessionStorage_1;hasRequiredSessionStorage=1;var n=requireUtil(),e=n.Global;sessionStorage_1={name:"sessionStorage",read:r,write:o,each:D,remove:N,clearAll:k};function t(){return e.sessionStorage}function r(B){return t().getItem(B)}function o(B,G){return t().setItem(B,G)}function D(B){for(var G=t().length-1;G>=0;G--){var U=t().key(G);B(r(U),U)}}function N(B){return t().removeItem(B)}function k(){return t().clear()}return sessionStorage_1}var memoryStorage_1,hasRequiredMemoryStorage;function requireMemoryStorage(){if(hasRequiredMemoryStorage)return memoryStorage_1;hasRequiredMemoryStorage=1,memoryStorage_1={name:"memoryStorage",read:e,write:t,each:r,remove:o,clearAll:D};var n={};function e(N){return n[N]}function t(N,k){n[N]=k}function r(N){for(var k in n)n.hasOwnProperty(k)&&N(n[k],k)}function o(N){delete n[N]}function D(N){n={}}return memoryStorage_1}var all,hasRequiredAll;function requireAll(){return hasRequiredAll||(hasRequiredAll=1,all=[requireLocalStorage(),requireOldFFGlobalStorage(),requireOldIEUserDataStorage(),requireCookieStorage(),requireSessionStorage(),requireMemoryStorage()]),all}var json2$1={},hasRequiredJson2$1;function requireJson2$1(){return hasRequiredJson2$1||(hasRequiredJson2$1=1,typeof JSON!="object"&&(JSON={}),function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(n){return rx_escapable.lastIndex=0,rx_escapable.test(n)?'"'+n.replace(rx_escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function str(n,e){var t,r,o,D,N=gap,k,B=e[n];switch(B&&typeof B=="object"&&typeof B.toJSON=="function"&&(B=B.toJSON(n)),typeof rep=="function"&&(B=rep.call(e,n,B)),typeof B){case"string":return quote(B);case"number":return isFinite(B)?String(B):"null";case"boolean":case"null":return String(B);case"object":if(!B)return"null";if(gap+=indent,k=[],Object.prototype.toString.apply(B)==="[object Array]"){for(D=B.length,t=0;t<D;t+=1)k[t]=str(t,B)||"null";return o=k.length===0?"[]":gap?`[
`+gap+k.join(`,
`+gap)+`
`+N+"]":"["+k.join(",")+"]",gap=N,o}if(rep&&typeof rep=="object")for(D=rep.length,t=0;t<D;t+=1)typeof rep[t]=="string"&&(r=rep[t],o=str(r,B),o&&k.push(quote(r)+(gap?": ":":")+o));else for(r in B)Object.prototype.hasOwnProperty.call(B,r)&&(o=str(r,B),o&&k.push(quote(r)+(gap?": ":":")+o));return o=k.length===0?"{}":gap?`{
`+gap+k.join(`,
`+gap)+`
`+N+"}":"{"+k.join(",")+"}",gap=N,o}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(n,e,t){var r;if(gap="",indent="",typeof t=="number")for(r=0;r<t;r+=1)indent+=" ";else typeof t=="string"&&(indent=t);if(rep=e,e&&typeof e!="function"&&(typeof e!="object"||typeof e.length!="number"))throw new Error("JSON.stringify");return str("",{"":n})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(n,e){var t,r,o=n[e];if(o&&typeof o=="object")for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(r=walk(o,t),r!==void 0?o[t]=r:delete o[t]);return reviver.call(n,e,o)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),json2$1}var json2,hasRequiredJson2;function requireJson2(){if(hasRequiredJson2)return json2;hasRequiredJson2=1,json2=n;function n(){return requireJson2$1(),{}}return json2}var store_legacy,hasRequiredStore_legacy;function requireStore_legacy(){if(hasRequiredStore_legacy)return store_legacy;hasRequiredStore_legacy=1;var n=requireStoreEngine(),e=requireAll(),t=[requireJson2()];return store_legacy=n.createStore(e,t),store_legacy}var store_legacyExports=requireStore_legacy();const store=getDefaultExportFromCjs(store_legacyExports);/*!
devtools-detect
https://github.com/sindresorhus/devtools-detect
By Sindre Sorhus
MIT License
*/const devtools={isOpen:!1,orientation:void 0},threshold=170,emitEvent=(n,e)=>{globalThis.dispatchEvent(new globalThis.CustomEvent("devtoolschange",{detail:{isOpen:n,orientation:e}}))},main=({emitEvents:n=!0}={})=>{const e=globalThis.outerWidth-globalThis.innerWidth>threshold,t=globalThis.outerHeight-globalThis.innerHeight>threshold,r=e?"vertical":"horizontal";!(t&&e)&&(globalThis.Firebug&&globalThis.Firebug.chrome&&globalThis.Firebug.chrome.isInitialized||e||t)?((!devtools.isOpen||devtools.orientation!==r)&&n&&emitEvent(!0,r),devtools.isOpen=!0,devtools.orientation=r):(devtools.isOpen&&n&&emitEvent(!1,void 0),devtools.isOpen=!1,devtools.orientation=void 0)};main({emitEvents:!1});setInterval(main,500);class SysWeb extends SysBase{#t;constructor(...[e={},t={cur:"prj/",crypto:!1,dip:""}]){super(e,t);const r=t.cur.split("/");this.#t=r.length>2?r.slice(0,-2).join("/")+"/":"",queueMicrotask(async()=>this.loaded(e,t))}async loaded(...[e,t]){await super.loaded(e,t),document.querySelectorAll("[data-prj]").forEach(N=>{const k=N.attributes.getNamedItem("data-prj");k&&N.addEventListener("click",async()=>this.runSN(k.value),{passive:!0})}),document.querySelectorAll("[data-reload]").forEach(N=>N.addEventListener("click",async()=>this.run(),{passive:!0})),t.dip&&(CmnLib.hDip=JSON.parse(t.dip));const r=new URLSearchParams(location.search),o=r.get("dip");if(o&&(CmnLib.hDip={...CmnLib.hDip,...JSON.parse(o.replaceAll("%2C",","))}),!argChk_Boolean(CmnLib.hDip,"oninit_run",!0))return;argChk_Boolean(CmnLib.hDip,"dbg",!1)&&(CmnLib.isDbg=!0,this.fetch=(N,k)=>fetch(N,{...k,mode:"cors"})),this.extPort=argChk_Num(CmnLib.hDip,"port",this.extPort);const D=r.get("cur");D&&(t.cur=this.#t+D+"/"),await this.run()}#e=":";async runSN(e){this.arg.cur=this.#t+e+"/",this.#e!==this.arg.cur&&(this.#e=this.arg.cur,await this.run())}run=async()=>{this.#r&&this.#r.destroy(),this.#r=new Main(this)};stop(){this.#r&&(this.#r.destroy(),this.#r=void 0)}#r=void 0;async loadPath(e,t){await super.loadPath(e,t);const r=this.arg.cur+"path.json",o=await this.fetch(r);if(!o.ok)throw Error(o.statusText);const D=await o.text(),N=JSON.parse(await this.dec(r,D));for(const[k,B]of Object.entries(N)){const G=e[k]=B;for(const[U,H]of Object.entries(G))U!==":cnt"&&(G[U]=this.arg.cur+H)}}async initVal(e,t,r){const o=encodeURIComponent(document.location.hostname);t["const.sn.isDebugger"]=o==="localhost"||o==="127.0.0.1";const D=this.cfg.getNs();this.flushSub=this.arg.crypto?async()=>{store.set(D+"sys_",await this.enc(JSON.stringify(this.data.sys))),store.set(D+"mark_",await this.enc(JSON.stringify(this.data.mark))),store.set(D+"kidoku_",await this.enc(JSON.stringify(this.data.kidoku)))}:()=>{store.set(D+"sys",this.data.sys),store.set(D+"mark",this.data.mark),store.set(D+"kidoku",this.data.kidoku)};const N=D+(this.arg.crypto?"sys_":"sys");if(t["const.sn.isFirstBoot"]=store.get(N)===void 0){this.data.sys=e.sys,this.data.mark=e.mark,this.data.kidoku=e.kidoku,this.flush(),r(this.data);return}if(!this.arg.crypto){this.data.sys=store.get(D+"sys"),this.data.mark=store.get(D+"mark"),this.data.kidoku=store.get(D+"kidoku"),r(this.data);return}let k="";try{k="sys",this.data.sys=JSON.parse(await this.dec("json",store.get(D+"sys_"))),k+=Number(this.val.getVal("sys:TextLayer.Back.Alpha",1)),k="mark",this.data.mark=JSON.parse(await this.dec("json",store.get(D+"mark_"))),k="kidoku",this.data.kidoku=JSON.parse(await this.dec("json",store.get(D+"kidoku_")))}catch(B){console.error(`セーブデータ（${k}）が壊れています。一度クリアする必要があります(a) %o`,B)}r(this.data)}init(e,t,r,o){super.init(e,t,r,o);const D=t.view.parentElement;if("requestFullscreen"in document.body)this.tglFlscr_sub=()=>this.isFullScr?document.exitFullscreen():D.requestFullscreen(),this.elc.add(document,"fullscreenchange",()=>this.isFullScr=!!document.fullscreenElement);else{const N=document;this.tglFlscr_sub=()=>this.isFullScr?N.webkitCancelFullScreen():D.webkitRequestFullscreen(),this.elc.add(document,"fullscreenchange",()=>this.isFullScr=!!N.webkitFullscreenElement)}return this.cfg.oCfg.debug.devtool||this.elc.add(globalThis,"devtoolschange",N=>{N.detail.isOpen&&(console.error("DevToolは禁止されています。許可する場合は【プロジェクト設定】の【devtool】をONに。"),o.destroy())},{once:!0,passive:!0}),[]}cvsResize(){if(super.cvsResize(),this.isFullScr){const e=this.main.cvs.style;e.width=e.height=""}}pathBaseCnvSnPath4Dbg="${pathbase}/";_export=()=>((async()=>{const e=JSON.stringify({sys:this.data.sys,mark:this.data.mark,kidoku:this.data.kidoku}),t=this.arg.crypto?await this.enc(e):e,r=new Blob([t],{type:"text/json"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=(this.arg.crypto?"":"no_crypto_")+this.cfg.getNs()+getDateStr("-","_","")+".swpd",o.click(),CmnLib.debugLog&&console.log("プレイデータをエクスポートしました"),setTimeout(()=>this.fire("sn:exported",new MouseEvent("click")),10)})(),!1);_import=()=>(new Promise((e,t)=>{const r=document.createElement("input");r.type="file",r.accept=".swpd, text/plain",r.onchange=()=>{const o=r.files?.[0];o?e(o):t()},r.click()}).then(async e=>{const t=await e.text(),r=JSON.parse(this.arg.crypto?await this.dec("json",t):t);if(!r.sys||!r.mark||!r.kidoku)throw new Error("異常なプレイデータです");if(r.sys[SysBase.VALNM_CFG_NS]!==this.cfg.oCfg.save_ns){console.error(`別のゲーム【プロジェクト名=${r.sys[SysBase.VALNM_CFG_NS]}】のプレイデータです`);return}this.data.sys=r.sys,this.data.mark=r.mark,this.data.kidoku=r.kidoku,this.flush(),this.val.updateData(r),CmnLib.debugLog&&console.log("プレイデータをインポートしました"),this.fire("sn:imported",new MouseEvent("click"))}).catch(e=>console.error(`異常なプレイデータです ${e.message}`)),!1);navigate_to=e=>{const{url:t}=e;if(!t)throw"[navigate_to] urlは必須です";return globalThis.open(t,"_blank"),!1};titleSub(e){document.title=e,document.querySelectorAll("[data-title]").forEach(t=>t.textContent=e)}async savePic(e,t){const r=document.createElement("a");r.href=t,r.download=e,r.click(),CmnLib.debugLog&&console.log("画像ファイルをダウンロードします")}#s={};async appendFile(e,t){const r=(this.#s[e]??"")+t;this.#s[e]=r,await this.outputFile(e,r)}async outputFile(e,t){const r=new Blob([t],{type:"text/json"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=e,o.click()}}const web=Object.freeze(Object.defineProperty({__proto__:null,CmnLib,Layer,SysWeb,argChk_Boolean,argChk_Num},Symbol.toStringTag,{value:"Module"}));export{BUF_SE as B,I,Layer as L,ReadingState as R,SndBuf as S,argChk_Boolean as a,argChk_Num as b,R as c,BUF_BGM as d,getDateStr as g,int as i,platform as p,uint as u,web as w};
