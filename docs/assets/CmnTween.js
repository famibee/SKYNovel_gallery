import{b as g,a as N,C as E}from"./web.js";import{I as B,W as a,S as v,x as b}from"./ReadState.js";class n{static#t={};static#n;static#a;static init(t,s){n.#t={},n.#n=t,n.#a=s,n.#a.ticker.add(n.#e)}static#e=()=>B();static destroy(){n.stopAllTw(),n.#a.ticker.remove(n.#e)}static setTwProp(t,s){const e=g(s,"repeat",1);return t.delay(g(s,"delay",0)).easing(n.ease(s.ease)).repeat(e>0?e-1:1/0).yoyo(N(s,"yoyo",!1))}static#s={"Back.In":t=>a.Back.In(t),"Back.InOut":t=>a.Back.InOut(t),"Back.Out":t=>a.Back.Out(t),"Bounce.In":t=>a.Bounce.In(t),"Bounce.InOut":t=>a.Bounce.InOut(t),"Bounce.Out":t=>a.Bounce.Out(t),"Circular.In":t=>a.Circular.In(t),"Circular.InOut":t=>a.Circular.InOut(t),"Circular.Out":t=>a.Circular.Out(t),"Cubic.In":t=>a.Cubic.In(t),"Cubic.InOut":t=>a.Cubic.InOut(t),"Cubic.Out":t=>a.Cubic.Out(t),"Elastic.In":t=>a.Elastic.In(t),"Elastic.InOut":t=>a.Elastic.InOut(t),"Elastic.Out":t=>a.Elastic.Out(t),"Exponential.In":t=>a.Exponential.In(t),"Exponential.InOut":t=>a.Exponential.InOut(t),"Exponential.Out":t=>a.Exponential.Out(t),"Linear.None":t=>a.Linear.None(t),"Quadratic.In":t=>a.Quadratic.In(t),"Quadratic.InOut":t=>a.Quadratic.InOut(t),"Quadratic.Out":t=>a.Quadratic.Out(t),"Quartic.In":t=>a.Quartic.In(t),"Quartic.InOut":t=>a.Quartic.InOut(t),"Quartic.Out":t=>a.Quartic.Out(t),"Quintic.In":t=>a.Quintic.In(t),"Quintic.InOut":t=>a.Quintic.InOut(t),"Quintic.Out":t=>a.Quintic.Out(t),"Sinusoidal.In":t=>a.Sinusoidal.In(t),"Sinusoidal.InOut":t=>a.Sinusoidal.InOut(t),"Sinusoidal.Out":t=>a.Sinusoidal.Out(t)};static ease(t){if(!t)return e=>a.Linear.None(e);const s=n.#s[t];if(!s)throw"異常なease指定です";return s}static hMemberCnt={alpha:0,height:0,rotation:0,scale_x:0,scale_y:0,pivot_x:0,pivot_y:0,width:0,x:0,y:0};static cnvTweenArg(t,s){const e={};for(const c of Object.keys(n.hMemberCnt)){const o=t[c];if(!o)continue;const i=String(o),O=i.startsWith("="),d=O?i.slice(1):i;if(!d)continue;const[p,r]=d.split(","),l=e[c]=parseFloat(p);r&&(e[c]+=Math.round(Math.random()*(parseFloat(r)-l+1))),O&&(e[c]+=parseFloat(s[c]))}return e}static stopAllTw(){n.#t={},v()}static tween(t,s,e,c,o,i,O,d=!0){const p=this.#n.isSkipping?0:g(s,"time",NaN),r=new b(e).to(c,p).onUpdate(o);n.setTwProp(r,s),n.#t[t]={tw:r,onEnd:O};const{path:l}=s;let h=r;if(l){E.debugLog&&console.group(`🍝 [${s[":タグ名"]}] path=${l}= start(${e.x},${e.y},${e.alpha})`);for(const{groups:u}of l.matchAll(n.#o)){const{x:f,x2:T,y:m,y2:C,o:x,o2:Q,json:w}=u;let I={};if(w)try{I=JSON.parse(w)}catch(k){console.error(`🍝 json=${w} `+k);continue}else(f??T)&&(I.x=f??T),(m??C)&&(I.y=m??C),(x??Q)&&(I.alpha=x??Q);const S=n.cnvTweenArg(I,e);E.debugLog&&console.info(`🍝 ${w??`{x:${f} y:${m} o:${x}}`} => hTo:${JSON.stringify(S)}`);const $=new b(e).to(S,p);n.setTwProp($,s),h.chain($),h=$}E.debugLog&&console.groupEnd()}h.onComplete(()=>{const u=n.#t[t];u&&(delete n.#t[t],u.tw=void 0,r.stop(),n.#n.breakEvent("tsy nm:"+t),u.onEnd?.(),i())});const{chain:y}=s;if(y){const u=n.#t[y];if(!u?.tw)throw`${y}は存在しない・または終了したトゥイーンです`;delete u.onEnd,u.tw.chain(r)}else d&&r.start();return r}static#o=/\(\s*(?:(?<x>[-=\d\.]+)|(['"])(?<x2>.*?)\2)?(?:\s*,\s*(?:(?<y>[-=\d\.]+)|(['"])(?<y2>.*?)\5)?(?:\s*,\s*(?:(?<o>[-=\d\.]+)|(['"])(?<o2>.*?)\8))?)?|(?<json>\{[^{}]*})/g;static wt(t){return n.#t[n.TW_INT_TRANS]?.tw?n.#n.waitEvent("tsy nm:"+n.TW_INT_TRANS,t,()=>n.finish_trans()):!1}static TW_INT_TRANS=`trans
`;static finish_trans(){return n.#t[n.TW_INT_TRANS]?.tw?.stop().end(),!1}static wait_tsy(t){const{layer:s="",id:e,name:c}=t,o=e?`frm
${e}`:c??s;if(!o)throw"トゥイーンが指定されていません";const i=n.#t[o];if(!i?.tw){if(N(t,"chk_exist_tw",!1))throw e?`フレームトゥイーン ${e} が見つかりません。`:`トゥイーン ${o} が見つかりません。(layer:${s} name:${c})`;return!1}return n.#n.waitEvent("tsy nm:"+o,t,()=>i.tw?.end())}static stop_tsy(t){const{layer:s="",id:e,name:c}=t,o=e?`frm
${e}`:c??s;if(!o)throw"トゥイーンが指定されていません";return n.#t[o]?.tw?.stop().end(),!1}static pause_tsy(t){const{layer:s="",id:e,name:c}=t,o=e?`frm
${e}`:c??s;if(!o)throw"トゥイーンが指定されていません";return n.#t[o]?.tw?.pause(),!1}static resume_tsy(t){const{layer:s="",id:e,name:c}=t,o=e?`frm
${e}`:c??s;if(!o)throw"トゥイーンが指定されていません";return n.#t[o]?.tw?.resume(),!1}}export{n as i};
