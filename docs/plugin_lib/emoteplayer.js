class EmoteDevice{constructor(){this.initRenderCanvas()&&this.initWebGL()&&this.initGLEnv()&&this.initRenderTexture()&&this.initEmoteDevice()&&this.initMembers()?this.initialized=!0:this.initialized=!1}initRenderCanvas(){return this.renderCanvas=EmotePlayer.renderCanvas,null==this.renderCanvas?(alert("Unable to initialize Emote Device. Set render canvas first."),!1):(this.width=this.renderCanvas.width,this.height=this.renderCanvas.height,!0)}initWebGL(){this.gl=null;try{GL.init();const e={antialias:!0,alpha:!0,depth:!1,stencil:!0};this.hgl=GL.createContext(this.renderCanvas,e),GL.makeContextCurrent(this.hgl),this.gl=GL.contexts[this.hgl].GLctx}catch(e){}return!!this.gl||(alert("Unable to initialize WebGL. Your browser may not support it."),!1)}createMat4(){const e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}initGLEnv(){if(!this.gl)return!1;const e=this.gl;this.shader_program=e.createProgram();const i=e.createShader(e.VERTEX_SHADER),t=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,"\n        precision mediump float;\n        attribute vec4 a_pos;\n        attribute vec2 a_texCoord;\n        uniform vec2 u_scrSize;\n        uniform vec2 u_texSize;\n        uniform mat4 u_mvpMat;\n        varying vec2 v_texCoord;\n\n        void main()\n        {\n\t        vec4 tmp;\n\t        tmp = u_mvpMat * a_pos;\n\t        gl_Position.x = (tmp.x *  2.0) / u_scrSize.x;\n\t        gl_Position.y = (tmp.y * -2.0) / u_scrSize.y;\n\t        gl_Position.z = a_pos.z;\n\t        gl_Position.w = a_pos.w;\n\t        v_texCoord.x = a_texCoord.x / u_texSize.x;\n\t        v_texCoord.y = a_texCoord.y / u_texSize.y;\n        }"),e.shaderSource(t,"\n        precision mediump float;\n        varying vec2 v_texCoord;\n        uniform sampler2D u_texUnitId;\n        uniform vec4 u_texColor;\n        \n        void main()\n        {\n\t        vec4 tmp;\n\t        tmp = texture2D(u_texUnitId, v_texCoord);\n            tmp *= u_texColor;\n            tmp.rgb *= tmp.a;\n            if (tmp.a <= 0.003) {\n                discard;\n            }\n\t        gl_FragColor = tmp;\n        }"),e.compileShader(i),e.compileShader(t),e.attachShader(this.shader_program,i),e.attachShader(this.shader_program,t),e.linkProgram(this.shader_program),this.aLoc=[],this.uLoc=[],this.aLoc[0]=e.getAttribLocation(this.shader_program,"a_pos"),this.aLoc[1]=e.getAttribLocation(this.shader_program,"a_texCoord"),this.uLoc[0]=e.getUniformLocation(this.shader_program,"u_scrSize"),this.uLoc[1]=e.getUniformLocation(this.shader_program,"u_texSize"),this.uLoc[2]=e.getUniformLocation(this.shader_program,"u_mvpMat"),this.uLoc[3]=e.getUniformLocation(this.shader_program,"u_texUnitId"),this.uLoc[4]=e.getUniformLocation(this.shader_program,"u_texColor"),e.enableVertexAttribArray(this.aLoc[0]),e.enableVertexAttribArray(this.aLoc[1]),this.pMatrix=this.createMat4(),this.vertexPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer);const a=[-this.width/2,-this.height/2,0,this.width/2,-this.height/2,0,this.width/2,this.height/2,0,-this.width/2,this.height/2,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(a),e.STATIC_DRAW),e.vertexAttribPointer(this.aLoc[0],3,e.FLOAT,!1,0,0),this.coordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.coordBuffer);const s=[0,this.height,this.width,this.height,this.width,0,0,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),e.vertexAttribPointer(this.aLoc[1],2,e.FLOAT,!1,0,0),this.vertexIndexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);return e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),e.disable(e.DEPTH_TEST),!0}initRenderTexture(){this.gl;return this.renderTexture=EmoteDevice_CreateEmoteTexture2(this.width,this.height),!0}initEmoteDevice(){return this.device=EmoteDevice_Initialize(),EmoteDevice_ChangeFrameBufferSize(this.width,this.height),!0}initMembers(){return this.playerList=[],this.animating=!1,this.date=new Date,!0}invalidateAllPlayersPhysics(){for(let e of this.playerList)e.invalidatePhysics()}registerPlayer(e){this.playerList.push(e),this.invalidateAnimation()}unregisterPlayer(e){this.playerList.splice(this.playerList.indexOf(e),1),this.checkCanvasHide(e.canvas),this.invalidateAnimation()}invalidateAnimation(){for(let e=0;e<this.playerList.length;e++)this.playerList[e].index=e;this.playerList.sort((e,i)=>null==e.canvas.id&&null!=i.canvas.id?-1:null!=e.canvas.id&&null==i.canvas.id?1:e.canvas.id<i.canvas.id?-1:e.canvas.id>i.canvas.id?1:e.zIndex<i.zIndex?-1:e.zIndex>i.zIndex?1:e.index-i.index),this.kickAnimation()}checkAnimationRequired(){return this.playerList.length>0}checkCanvasHide(e){if(null!=e&&!this.playerList.some(i=>i.canvas==e)){e.getContext("2d").clearRect(0,0,e.width,e.height)}}kickAnimation(){this.animating&&!this.checkAnimationRequired()?(this.animating=!1,cancelAnimationFrame(this.requestId)):!this.animating&&this.checkAnimationRequired()&&(this.animating=!0,this.lastAnimationTime=null,this.requestId=requestAnimationFrame(this.drawAnimation.bind(this)))}drawAnimation(e){null===this.lastAnimationTime&&(this.lastAnimationTime=e);const i=e,t=Math.min(100,i-this.lastAnimationTime)*EmotePlayer.MS2FRAME;this.lastAnimationTime=i;const a=this.gl;let s=null;const l=e=>{if(null==e)return;let i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),i.drawImage(this.renderCanvas,(e.width-this.width)/2,(e.height-this.height)/2)};EmoteDevice_SetMaskMode(EmotePlayer.maskMode),EmoteDevice_SetProtectTranslucentTextureColor(EmotePlayer.protectTranslucentTextureColor),EmoteDevice_SetMaskRegionClipping(EmotePlayer.maskRegionClipping);for(let e of this.playerList){if(e.canvas!==s&&(l(s),null!=(s=e.canvas)&&(a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT))),e.onUpdate(),!e.stepUpdate&&e.convolveCanvasMovementToPhysics){const i=e.canvasPosition,a=e.prevCanvasPosition,s=e.getState("scale"),l=[(i.left-a.left)/s*t,(i.top-a.top)/s*t];EmotePlayer_SetOuterForce(e.playerId,"bust",l[0],l[1],0,0),EmotePlayer_SetOuterForce(e.playerId,"parts",l[0],l[1],0,0),EmotePlayer_SetOuterForce(e.playerId,"hair",l[0],l[1],0,0)}var r=e.prevPracticalHide,o=e.practicalHide;if(e.prevPracticalHide=o,EmotePlayer.suspendWhenHide&&o)r||(console.log("skip"),e.skip());else if(e.prevCanvasPosition=e.canvasPosition,e.stepUpdate?e.modified&&(EmotePlayer_Step(e.playerId),EmotePlayer_Update(e.playerId,0)):EmotePlayer_Update(e.playerId,t*e.speed),e.modified=!1,null!=e.canvas&&!e.practicalHide){EmotePlayer_DrawToTexture2(e.playerId,this.renderTexture),a.useProgram(this.shader_program),a.bindBuffer(a.ARRAY_BUFFER,this.vertexPositionBuffer),a.vertexAttribPointer(this.aLoc[0],3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.coordBuffer),a.vertexAttribPointer(this.aLoc[1],2,a.FLOAT,!1,0,0),a.uniform2f(this.uLoc[0],this.width,this.height),a.uniform2f(this.uLoc[1],this.width,this.height),a.uniformMatrix4fv(this.uLoc[2],!1,this.pMatrix),a.uniform1i(this.uLoc[3],0),a.uniform4f(this.uLoc[4],EmotePlayer_GetVariable(e.playerId,"_globalR")/255,EmotePlayer_GetVariable(e.playerId,"_globalG")/255,EmotePlayer_GetVariable(e.playerId,"_globalB")/255,EmotePlayer_GetVariable(e.playerId,"_globalA")/255),a.activeTexture(a.TEXTURE0);var n=EmoteDevice_GetEmoteTexture2Tex(this.renderTexture);a.bindTexture(a.TEXTURE_2D,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.enable(a.BLEND),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}}l(s),this.requestId=requestAnimationFrame(this.drawAnimation.bind(this))}}class EmotePlayer{constructor(e=null){this._canvas=e,this.playerId=null,this.initialized=!1,this.initMembers(),EmotePlayer.requireDevice()}destroy(){unloadData(),EmotePlayer.releaseDevice()}initMembers(){this.initialized=!1,this.registered=!1,this.isCharaProfileAvailable=!1,this.prevPracticalHide=!0,this.charaHeight=0,this.charaProfile={},this.charaBounds={},this._meshDivisionRatio=1,this._hairScale=1,this._partsScale=1,this._bustScale=1,this._speed=1,this._windSpeed=0,this._windPowMin=0,this._windPowMax=2,this._coord=[0,0],this._scale=1,this._rot=0,this._vertexR=this._vertexG=this._vertexB=128,this._globalR=this._globalG=this._globalB=this._globalA=255,this._grayscale=0,this._zIndex=0,this._hide=!1,this._stepUpdate=!1,this.modified=!0,this._convolveCanvasMovementToPhysics=!1,this.prevCanvasPosition={left:0,top:0},this._variableList=[],this._variableListLoaded=!1,this._mainTimelineLabel="",this._mainTimelineLabels=[],this._mainTimelineLabelsLoaded=!1,this._diffTimelineSlot=["","","","","",""],this._diffTimelineFadeOutTime=300,this._diffTimelineLabels=[],this._diffTimelineLabelsLoaded=!1}get needsDrawing(){return this.initialized}invalidateDrawing(){const e=this.needsDrawing;this.registered!=e&&(e?(EmotePlayer.device.registerPlayer(this),this.onRegister()):(this.onUnregsiter(),EmotePlayer.device.unregisterPlayer(this)),this.registered=e)}get meshDivisionRatio(){return this._meshDivisionRatio}set meshDivisionRatio(e){this._meshDivisionRatio!=e&&(this._meshDivisionRatio=e)}get hairScale(){return this._hairScale}set hairScale(e){this._hairScale!=e&&(this._hairScale=e,this.invalidatePhysics())}get partsScale(){return this._partsScale}set partsScale(e){this._partsScale!=e&&(this._partsScale=e,this.invalidatePhysics())}get bustScale(){return this._bustScale}set bustScale(e){this._bustScale!=e&&(b,this._bustScale=e,this.invalidatePhysics())}invalidatePhysics(){this.initialized&&(EmotePlayer_SetHairScale(this.playerId,this.hairScale*EmotePlayer.globalHairScale),EmotePlayer_SetPartsScale(this.playerId,this.partsScale*EmotePlayer.globalPartsScale),EmotePlayer_SetBustScale(this.playerId,this.bustScale*EmotePlayer.globalBustScale))}get windSpeed(){return this._windSpeed}set windSpeed(e){this._windSpeed!=e&&(this._windSpeed=e,this.invalidateWind())}get windPowMin(){return this._windPowMin}set windPowMin(e){this._windPowMin!=e&&(this._windPowMin=e,this.invalidateWind())}get windPowMax(){return this._windPowMax}set windPowMax(e){this._windPowMax!=e&&(this._windPowMax=e,this.invalidateWind())}invalidateWind(){if(this.initialized)if(0==this._windSpeed)EmotePlayer_StopWind(this.playerId);else{const e=EmotePlayer.device.width/2;EmotePlayer_StartWind(this.playerId,-e,e,this._windSpeed,this._windPowMin,this._windPowMax)}}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,EmotePlayer.device.invalidateAnimation()}get practicalHide(){return this.initialized?this._hide||0==this._globalA&&0==EmotePlayer_GetVariable(this.playerId,"_globalA"):this._hide}get hide(){return this._hide}set hide(e){this._hide!=e&&(this._hide=e)}get canvas(){return this._canvas}set canvas(e){if(this._canvas===e)return;const i=this._canvas;this._canvas=e,EmotePlayer.device.checkCanvasHide(i),EmotePlayer.device.invalidateAnimation(),this.prevCanvasPosition=this.canvasPosition}colorStrToValue(e){return"#"==e.substr(0,1)&&(e=e.substr(1)),{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16)}}colorValueToStr(e,i,t){const a=e=>("0"+e.toString(16).toUpperCase()).substr(-2);return"#"+a(e)+a(i)+a(t)}getBinaryAsync(e){return new Promise((i,t)=>{const a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=(()=>{200===a.status||0===a.status?i(new Uint8Array(a.response)):t(new Error(a.statusText))}),a.onerror=(()=>t(new Error(a.statusText))),a.send()})}promiseLoadDataFromURL(...e){const i=(e=Array.prototype.concat.apply([],e)).map(e=>this.getBinaryAsync(e));return Promise.all(i).then(this.loadData.bind(this))}loadDataFromURL(...e){this.promiseLoadDataFromURL(...e).catch(e=>console.error(e))}unloadData(){this.initialized&&(EmotePlayer_Finish(this.playerId),this.playerId=null,this.initialized=!1,this.clearVariableList(),this.clearMainTimelineLabels(),this.clearDiffTimelineLabels(),this.clearCharaProfile(),this.invalidateDrawing())}loadData(...e){e=Array.prototype.concat.apply([],e),this.unloadData(),this.playerId=EmotePlayer_Initialize(e),this.initialized=!0,this.modified=!0,this.loadCharaProfile(),EmotePlayer_SetMeshDivisionRatio(this.playerId,this.meshDivisionRatio*EmotePlayer.globalMeshDivisionRatio),EmotePlayer_SetCoord(this.playerId,this._coord[0],this._coord[1],0,0),EmotePlayer_SetScale(this.playerId,this._scale,0,0),EmotePlayer_SetRot(this.playerId,this._rot,0,0),EmotePlayer_AddUserDefinedVariable(this.playerId,"_globalR"),EmotePlayer_AddUserDefinedVariable(this.playerId,"_globalG"),EmotePlayer_AddUserDefinedVariable(this.playerId,"_globalB"),EmotePlayer_AddUserDefinedVariable(this.playerId,"_globalA"),EmotePlayer_SetVariable(this.playerId,"_globalR",this._globalR,0,0),EmotePlayer_SetVariable(this.playerId,"_globalG",this._globalG,0,0),EmotePlayer_SetVariable(this.playerId,"_globalB",this._globalB,0,0),EmotePlayer_SetVariable(this.playerId,"_globalA",this._globalA,0,0),EmotePlayer_SetGrayscale(this.playerId,this._grayscale,0,0),EmotePlayer_SetColor(this.playerId,this._vertexR/255,this._vertexG/255,this._vertexB/255,1,0,0),this.invalidateWind(),this.invalidatePhysics(),""!=this._mainTimelineLabel&&EmotePlayer_PlayTimeline(this.playerId,this._mainTimelineLabel,EmotePlayer.TimelinePlayFlags.PARALLEL);for(let e of this._diffTimelineSlot)""!=e&&EmotePlayer_PlayTimeline(this.playerId,e,EmotePlayer.TimelinePlayFlags.PARALLEL|EmotePlayer.TimelinePlayFlags.DIFFERENCE);this.prevCanvasPosition=this.canvasPosition,this.invalidateDrawing()}loadCharaProfile(){if(this.isCharaProfileAvailable=EmotePlayer_IsCharaProfileAvailable(this.playerId),this.isCharaProfileAvailable){this.charaHeight=EmotePlayer_GetCharaHeight(this.playerId),this.charaProfile={};const e=EmotePlayer_CountCharaProfiles(this.playerId);for(let i=0;i<e;i++){const e=EmotePlayer_GetCharaProfileLabelAt(this.playerId,i),t=EmotePlayer_GetCharaProfile(this.playerId,e);this.charaProfile[e]=t}this.charaBounds={left:this.charaProfile.boundsLeft,top:this.charaProfile.boundsTop,right:this.charaProfile.boundsRight,bottom:this.charaProfile.boundsBottom},delete this.charaProfile.boundsLeft,delete this.charaProfile.boundsTop,delete this.charaProfile.boundsRight,delete this.charaProfile.boundsBottom}}clearCharaProfile(){this.isCharaProfileAvailable=!1,this.charaHeight=0,this.charaProfile={},this.charaBounds={}}getState(e){return this.initialized?EmotePlayer_GetState(this.playerId,e):0}getMarkerPosition(e){if(!this.initialized||null==this.canvas)return null;let i=[0,0];if(e in this.charaProfile){const t=this.getState("coordX"),a=this.getState("coordY"),s=this.getState("scale"),l=this.getState("rot"),r=Math.sin(l),o=Math.cos(l),n=0,h=this.charaProfile[e];i=[n*o*s+h*-r*s+t,n*r*s+h*o*s+a]}const t=this.canvas.width/2,a=this.canvas.height/2,s=this.canvas.getBoundingClientRect();return{x:i[0],y:i[1],offsetX:i[0]+t,offsetY:i[1]+a,clientX:i[0]+t+s.left,clientY:i[1]+a+s.top}}get speed(){return this._speed}set speed(e){this._speed=e}get coord(){return[].concat(this._coord)}set coord(e){this.setCoord(e[0],e[1])}get scale(){return this._scale}set scale(e){this.setScale(e)}get rot(){return this._rot}set rot(e){this.setRot(e)}get vertexColor(){return this.colorValueToStr(this._vertexR,this._vertexG,this._vertexB)}set vertexColor(e){this.setVertexColor(e)}get globalColor(){return this.colorValueToStr(this._globalR,this._globalG,this._globalB)}set globalColor(e){this.setGlobalColor(e)}get globalAlpha(){return this._globalA/255}set globalAlpha(e){this.setGlobalAlpha(e)}get grayscale(){return this._grayscale}set grayscale(e){this.setGrayscale(e)}setCoord(e,i,t=0,a=0){this._coord[0]==e&&this._coord[1]==i||(this._coord[0]=e,this._coord[1]=i,this.initialized&&(this.modified=!0,EmotePlayer_SetCoord(this.playerId,e,i,t*EmotePlayer.MS2FRAME,a)))}setScale(e,i=0,t=0){this._scale!=e&&(this._scale=e,this.initialized&&(this.modified=!0,EmotePlayer_SetScale(this.playerId,e,i*EmotePlayer.MS2FRAME,t)))}setRot(e,i=0,t=0){this._rot!=e&&(this._rot=e,this.initialized&&(this.modified=!0,EmotePlayer_SetRot(this.playerId,e,i*EmotePlayer.MS2FRAME,t)))}setVertexColor(e,i=0,t=0){e=this.colorStrToValue(e),this._vertexR==e.r&&this._vertexG==e.g&&this._vertexB==e.b||(this._vertexR=e.r,this._vertexG=e.g,this._vertexB=e.b,this.initialized&&(this.modified=!0,EmotePlayer_SetColor(this.playerId,e.r/255,e.g/255,e.b/255,1,i*EmotePlayer.MS2FRAME,t)))}setGlobalColor(e,i=0,t=0){e=this.colorStrToValue(e),this._globalR==e.r&&this._globalG==e.g&&this._globalB==e.b||(this._globalR=e.r,this._globalG=e.g,this._globalB=e.b,this.initialized&&(this.modified=!0,EmotePlayer_SetVariable(this.playerId,"_globalR",e.r,i*EmotePlayer.MS2FRAME,t),EmotePlayer_SetVariable(this.playerId,"_globalG",e.g,i*EmotePlayer.MS2FRAME,t),EmotePlayer_SetVariable(this.playerId,"_globalB",e.b,i*EmotePlayer.MS2FRAME,t)))}setGlobalAlpha(e,i=0,t=0){e*=255,this._globalA!=e&&(this._globalA=e,this.initialized&&(this.modified=!0,EmotePlayer_SetVariable(this.playerId,"_globalA",e,i*EmotePlayer.MS2FRAME,t)))}setGrayscale(e,i=0,t=0){this._grayscale!=e&&(this._grayscale=e,this.initialized&&(this.modified=!0,EmotePlayer_SetGrayscale(this.playerId,this._grayscale,i*EmotePlayer.MS2FRAME,t)))}get canvasPosition(){if(null==this.canvas)return this.prevCanvasPosition;{const e=this.canvas.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY}}}get convolveCanvasMovementToPhysics(){return this._convolveCanvasMovementToPhysics}set convolveCanvasMovementToPhysics(e){e!=this._convolveCanvasMovementToPhysics&&(this._convolveCanvasMovementToPhysics=e,this.initialized&&!e&&(EmotePlayer_SetOuterForce(this.playerId,"bust",0,0,0,0),EmotePlayer_SetOuterForce(this.playerId,"parts",0,0,0,0),EmotePlayer_SetOuterForce(this.playerId,"hair",0,0,0,0)))}isLoopTimeline(e){return!!this.initialized&&EmotePlayer_IsLoopTimeline(this.playerId,e)}getTimelineTotalMilliSeconds(e){return!!this.initialized&&EmotePlayer_GetTimelineTotalFrameCount(this.playerId,e)*EmotePlayer.FRAME2MS}playTimeline(e,i=0){this.initialized&&(this.modified=!0,EmotePlayer_PlayTimeline(this.playerId,e,i))}stopTimeline(e=""){this.initialized&&(this.modified=!0,EmotePlayer_StopTimeline(this.playerId,e))}isTimelinePlaying(e=""){return!!this.initialized&&EmotePlayer_IsTimelinePlaying(this.playerId,e)}setTimelineBlendRatio(e,i,t=0,a=0,s=!1){this.initialized&&(this.modified=!0,EmotePlayer_SetTimelineBlendRatio(this.playerId,e,i,t*EmotePlayer.MS2FRAME,a,s))}getTimelineBlendRatio(e){return this.initialized?EmotePlayer_GetTimelineTotalFrameCount(this.playerId,e):0}fadeInTimeline(e,i,t=0){this.initialized&&(this.modified=!0,EmotePlayer_FadeInTimeline(this.playerId,e,i*EmotePlayer.MS2FRAME,t))}fadeOutTimeline(e,i,t=0){this.initialized&&(this.modified=!0,EmotePlayer_FadeOutTimeline(this.playerId,e,i*EmotePlayer.MS2FRAME,t))}clearVariableList(){this._variableList=[],this._variableListLoaded=!1}touchVariableList(){if(this._variableListLoaded||!this.initialized)return;const e=EmotePlayer_CountVariables(this.playerId);for(let i=0;i<e;i++){const e={label:"",frameList:[],minValue:Number.MAX_VALUE,maxValue:Number.MIN_VALUE};e.label=EmotePlayer_GetVariableLabelAt(this.playerId,i);const t=EmotePlayer_CountVariableFrameAt(this.playerId,i);if(0!=t){for(let a=0;a<t;a++){const t={label:"",value:0};t.label=EmotePlayer_GetVariableFrameLabelAt(this.playerId,i,a),t.value=EmotePlayer_GetVariableFrameValueAt(this.playerId,i,a),e.minValue=Math.min(e.minValue,t.value),e.maxValue=Math.max(e.maxValue,t.value),e.frameList.push(t)}this._variableList.push(e)}}this._variableListLoaded=!0}get variableList(){return this.touchVariableList(),this._variableList}clearMainTimelineLabels(){this._mainTimelineLabels=[],this._mainTimelineLabelsLoaded=!1}touchMainTimelineLabels(){if(this._mainTimelineLabelsLoaded||!this.initialized)return;const e=EmotePlayer_CountMainTimelines(this.playerId);if(e>0)for(let i=0;i<e;i++)this._mainTimelineLabels.push(EmotePlayer_GetMainTimelineLabelAt(this.playerId,i));this._mainTimelineLabelsLoaded=!0}get mainTimelineLabels(){return this.touchMainTimelineLabels(),this._mainTimelineLabels}set mainTimelineLabel(e){this._mainTimelineLabel!=e&&(this.initialized?(""!=this._mainTimelineLabel&&EmotePlayer_StopTimeline(this.playerId,this._mainTimelineLabel),this._mainTimelineLabel=e,""!=this._mainTimelineLabel&&EmotePlayer_PlayTimeline(this.playerId,this._mainTimelineLabel,EmotePlayer.TimelinePlayFlags.PARALLEL),this.modified=!0):this._mainTimelineLabel=e)}get mainTimelineLabel(){return this._mainTimelineLabel}clearDiffTimelineLabels(){this._diffTimelineLabels=[],this._diffTimelineLabelsLoaded=!1}touchDiffTimelineLabels(){if(this._diffTimelineLabelsLoaded||!this.initialized)return;const e=EmotePlayer_CountDiffTimelines(this.playerId);if(e>0)for(let i=0;i<e;i++)this._diffTimelineLabels.push(EmotePlayer_GetDiffTimelineLabelAt(this.playerId,i));this._diffTimelineLabelsLoaded=!0}get diffTimelineLabels(){return this.touchDiffTimelineLabels(),this._diffTimelineLabels}set diffTimelineFadeoutTime(e){this._diffTimelineFadeOutTime=e}get diffTimelineFadeoutTime(){return this._diffTimelineFadeOutTime}set diffTimelineSlot1(e){this.setDiffTimelineLabel(0,e,this._diffTimelineFadeOutTime)}get diffTimelineSlot1(){return this.getDiffTimelineLabel(0)}set diffTimelineSlot2(e){this.setDiffTimelineLabel(1,e,this._diffTimelineFadeOutTime)}get diffTimelineSlot2(){return this.getDiffTimelineLabel(1)}set diffTimelineSlot3(e){this.setDiffTimelineLabel(2,e,this._diffTimelineFadeOutTime)}get diffTimelineSlot3(){return this.getDiffTimelineLabel(2)}set diffTimelineSlot4(e){this.setDiffTimelineLabel(3,e,this._diffTimelineFadeOutTime)}get diffTimelineSlot4(){return this.getDiffTimelineLabel(3)}set diffTimelineSlot5(e){this.setDiffTimelineLabel(4,e,this._diffTimelineFadeOutTime)}get diffTimelineSlot5(){return this.getDiffTimelineLabel(4)}set diffTimelineSlot6(e){this.setDiffTimelineLabel(5,e,this._diffTimelineFadeOutTime)}get diffTimelineSlot6(){return this.getDiffTimelineLabel(5)}setDiffTimelineLabel(e,i,t){this._diffTimelineSlot[e]!=i&&(this.initialized?(""!=this._diffTimelineSlot[e]&&EmotePlayer_FadeOutTimeline(this.playerId,this._diffTimelineSlot[e],t*EmotePlayer.MS2FRAME,0),this._diffTimelineSlot[e]=i,""!=this._diffTimelineSlot[e]&&EmotePlayer_PlayTimeline(this.playerId,this._diffTimelineSlot[e],EmotePlayer.TimelinePlayFlags.PARALLEL|EmotePlayer.TimelinePlayFlags.DIFFERENCE),this.modified=!0):this._diffTimelineSlot[e]=i)}getDiffTimelineLabel(e){return this.touchDiffTimelineLabels(),this._diffTimelineSlot[e]}get playingTimelineInfoList(){const e=[];if(!this.initialized)return e;const i=EmotePlayer_CountPlayingTimelines(this.playerId);for(let t=0;t<i;t++){const i={label:EmotePlayer_GetPlayingTimelineLabelAt(this.playerId,t),flags:EmotePlayer_GetPlayingTimelineFlagsAt(this.playerId,t)};e.push(i)}return e}get animating(){return!!this.initialized&&EmotePlayer_IsAnimating(this.playerId)}skip(){this.initialized&&(EmotePlayer_Skip(this.playerId),this.prevCanvasPosition=this.canvasPosition)}pass(){this.initialized&&(EmotePlayer_Pass(this.playerId),this.prevCanvasPosition=this.canvasPosition)}get stepUpdate(){return this._stepUpdate}set stepUpdate(e){this._stepUpdate!=e&&(this._stepUpdate=e,this.modified=!0)}setVariable(e,i,t=0,a=0){this.initialized&&(this.modified=!0,EmotePlayer_SetVariable(this.playerId,e,i,t*EmotePlayer.MS2FRAME,a))}getVariable(e){return this.initialized?EmotePlayer_GetVariable(this.playerId,e):0}setVariableDiff(e,i,t,a=0,s=0){this.initialized&&(this.modified=!0,EmotePlayer_SetVariableDiff(this.playerId,e,i,t,a*EmotePlayer.MS2FRAME,s))}getVariableDiff(e,i){return this.initialized?EmotePlayer_GetVariableDiff(this.playerId,e,i):0}startRecordAPILog(){this.initialized&&EmotePlayer_StartRecordAPILog(this.playerId)}stopRecordAPILog(){this.initialized&&EmotePlayer_StopRecordAPILog(this.playerId)}get recordingAPILog(){return!!this.initialized&&EmotePlayer_IsRecordingAPILog(this.playerId)}startReplayAPILog(){this.initialized&&EmotePlayer_StartReplayAPILog(this.playerId)}stopReplayAPILog(){this.initialized&&EmotePlayer_StopReplayAPILog(this.playerId)}get replayingAPILog(){return!!this.initialized&&EmotePlayer_IsReplayingAPILog(this.playerId)}clearAPILog(){this.initialized&&EmotePlayer_ClearAPILog(this.playerId)}set apiLog(e){this.initialized&&EmotePlayer_SetAPILog(this.playerId,e)}get apiLog(){return this.initialized?EmotePlayer_GetAPILog(this.playerId):""}onRegister(){}onUnregsiter(){}onUpdate(){}}EmotePlayer.TimelinePlayFlags={PARALLEL:1,DIFFERENCE:2},EmotePlayer.MaskMode={STENCIL:0,ALPHA:1},EmotePlayer.MS2FRAME=.06,EmotePlayer.FRAME2MS=1e3/60,EmotePlayer.deviceRefCount=0,EmotePlayer.device=null,EmotePlayer.renderCanvas=null,EmotePlayer.maskMode=EmotePlayer.MaskMode.ALPHA,EmotePlayer.protectTranslucentTextureColor=!0,EmotePlayer.maskRegionClipping=!0,EmotePlayer.suspendWhenHide=!0,EmotePlayer.globalMeshDivisionRatio=1;for(let e of["hairScale","partsScale","bustScale"]){const i="global"+e.charAt(0).toUpperCase()+e.slice(1),t=`_${i}`;EmotePlayer[t]=1,EmotePlayer.__defineGetter__(i,()=>EmotePlayer[t]),EmotePlayer.__defineSetter__(i,e=>{EmotePlayer[t]!=e&&(EmotePlayer[t]=e,EmotePlayer.device&&EmotePlayer.device.invalidateAllPlayersPhysics())})}EmotePlayer.setRenderCanvas=(e=>{EmotePlayer.renderCanvas=e}),EmotePlayer.createRenderCanvas=((e,i)=>{const t=document.getElementsByTagName("body")[0];null==t&&alert("can't state body element on DOM.");const a=document.createElement("canvas");a.width=e,a.height=i,a.style.display="none",a.style.backgroundColor="transparent",a.style.position="absolute",t.appendChild(a),EmotePlayer.renderCanvas=a}),EmotePlayer.requireDevice=(()=>{EmotePlayer.deviceRefCount++<=0&&(EmotePlayer.device=new EmoteDevice)}),EmotePlayer.releaseDevice=(()=>{--sEmotePlayer.deviceRefCount<=0&&(EmotePlayer.device.destroy(),EmotePlayer.device=null)});