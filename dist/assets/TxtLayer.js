import{z as K,M as rt,w as U,S as tt,d as R,u as L,q as j,C as N,l as C,r as lt,G as O,x as q,R as et,N as G,y as ot}from"./web.js";import{k as ct}from"./CmnTween.js";import{e as B}from"./SpritesMng.js";import{t as V}from"./DebugMng.js";import{a as M,W as dt}from"./Reading.js";import{o as st}from"./RubySpliter.js";import{Button as pt}from"./Button.js";import"../web.js";const H="„ÄÅ„ÄÇÔºåÔºéÔºâÔºΩÔΩù„Äâ„Äç„Äè„Äë„Äï‚Äù„Äü„ÅÅ„ÅÉ„ÅÖ„Åá„Åâ„Å£„ÇÉ„ÇÖ„Çá„Çé„Ç°„Ç£„Ç•„Çß„Ç©„ÉÉ„É£„É•„Éß„ÉÆ„Éµ„É∂ÔºÅÔºü!?‚Äº‚Åâ„Éª„Éº„Çù„Çû„ÉΩ„Éæ„ÄÖ",W="ÔºªÔºàÔΩõ„Äà„Äå„Äé„Äê„Äî‚Äú„Äù",I="‚îÄ‚Ä•‚Ä¶",X=H,it=new RegExp(`[${H}]`),gt=new RegExp(`[${W}]`),ut=new RegExp(`[${I}]`),ft=it;class yt{#c=H;#n=W;#l=I;#a=X;get Ë°åÈ†≠Á¶ÅÂâá(){return this.#c}get Ë°åÊú´Á¶ÅÂâá(){return this.#n}get ÂàÜÂâ≤Á¶ÅÊ≠¢(){return this.#l}get „Å∂„Çâ‰∏ã„Åí(){return this.#a}#e=it;#h=gt;#d=ut;#S=ft;break_fixed=!1;break_fixed_left=0;break_fixed_top=0;bura=!1;lay(t){t.kinsoku_sol&&(this.#c=t.kinsoku_sol,this.#e=new RegExp(`[${this.#c}]`)),t.kinsoku_eol&&(this.#n=t.kinsoku_eol,this.#r(),this.#h=new RegExp(`[${this.#n}]`)),t.kinsoku_dns&&(this.#l=t.kinsoku_dns,this.#m(),this.#d=new RegExp(`[${this.#l}]`)),t.kinsoku_bura&&(this.#a=t.kinsoku_bura,this.#r(),this.#m(),this.#S=new RegExp(`[${this.#a}]`)),"bura"in t&&(this.bura=R(t,"bura",!1)),this.break_fixed=R(t,"break_fixed",this.break_fixed),this.break_fixed_left=C(t,"break_fixed_left",this.break_fixed_left),this.break_fixed_top=C(t,"break_fixed_top",this.break_fixed_top)}#r(){const t=this.#n.length,e=this.#a.length;if(t<e)for(let s=0;s<t;++s){const i=this.#n[s];if(this.#a.includes(i))throw`Á¶ÅÂâá„ÅÆÁ´∂Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊñáÂ≠ó ${String(i)} „Åå„Å∂„Çâ‰∏ã„Åí „Å® Ë°åÊú´Á¶ÅÂâá „ÅÆ‰∏°Êñπ„Å´Âê´„Åæ„Çå„Åæ„Åô`}else for(let s=0;s<e;++s){const i=this.#a[s];if(this.#n.includes(i))throw`Á¶ÅÂâá„ÅÆÁ´∂Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊñáÂ≠ó ${String(i)} „Åå„Å∂„Çâ‰∏ã„Åí „Å® Ë°åÊú´Á¶ÅÂâá „ÅÆ‰∏°Êñπ„Å´Âê´„Åæ„Çå„Åæ„Åô`}}#m(){const t=this.#l.length,e=this.#a.length;if(t<e)for(let s=0;s<t;++s){const i=this.#l[s];if(this.#a.includes(i))throw`Á¶ÅÂâá„ÅÆÁ´∂Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊñáÂ≠ó ${String(i)} „Åå„Å∂„Çâ‰∏ã„Åí „Å® ÂàÜÂâ≤Á¶ÅÊ≠¢ „ÅÆ‰∏°Êñπ„Å´Âê´„Åæ„Çå„Åæ„Åô`}else for(let s=0;s<e;++s){const i=this.#a[s];if(this.#l.includes(i))throw`Á¶ÅÂâá„ÅÆÁ´∂Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊñáÂ≠ó ${String(i)} „Åå„Å∂„Çâ‰∏ã„Åí „Å® ÂàÜÂâ≤Á¶ÅÊ≠¢ „ÅÆ‰∏°Êñπ„Å´Âê´„Åæ„Çå„Åæ„Åô`}}reNew(t){t.#t(this.#c,this.#n,this.#l,this.#a),t.break_fixed=this.break_fixed,t.break_fixed_left=this.break_fixed_left,t.break_fixed_top=this.break_fixed_top,t.bura=this.bura}#t(t,e,s,i){this.#c!==t&&(this.#c=t,this.#e=new RegExp(`[${t}]`)),this.#n!==e&&(this.#n=e,this.#h=new RegExp(`[${e}]`)),this.#l!==s&&(this.#l=s,this.#d=new RegExp(`[${s}]`)),this.#a!==i&&(this.#a=i,this.#S=new RegExp(`[${i}]`))}record(){const t={break_fixed:this.break_fixed,break_fixed_left:this.break_fixed_left,break_fixed_top:this.break_fixed_top,bura:this.bura};return this.#c===H&&(t.Ë°åÈ†≠Á¶ÅÂâá=this.#c),this.#n===W&&(t.Ë°åÊú´Á¶ÅÂâá=this.#n),this.#l===I&&(t.ÂàÜÂâ≤Á¶ÅÊ≠¢=this.#l),this.#a===X&&(t.„Å∂„Çâ‰∏ã„Åí=this.#a),t}playback(t){t&&(this.#t(t.Ë°åÈ†≠Á¶ÅÂâá??H,t.Ë°åÊú´Á¶ÅÂâá??W,t.ÂàÜÂâ≤Á¶ÅÊ≠¢??I,t.„Å∂„Çâ‰∏ã„Åí??X),this.break_fixed=t.break_fixed,this.break_fixed_left=t.break_fixed_left,this.break_fixed_top=t.break_fixed_top,this.bura=t.bura)}hyph(t,e,s,i,a){let n,r=0,h=2,l=m=>(l=()=>!1,i===m?(i>0&&(t.innerHTML=a.replaceAll('class="sn_ch"','class="sn_ch sn_ch_in_default"')),!0):m<2);do{if(n=this.#f(t,e),r=n.length,l(r))break;let m=-1/0;for(;h<r;++h){const{elm:y,rect:$,ch:v}=n[h];if(y.tagName==="RT")continue;const x=s?$.y:$.x;if(m<=x||y.previousElementSibling?.tagName==="SPAN"&&y.previousElementSibling?.innerHTML.includes("<br>")||y.parentElement?.previousElementSibling?.tagName==="SPAN"&&y.parentElement?.previousElementSibling?.innerHTML.includes("<br>")){m=x,this.break_fixed||(this.break_fixed_left=$.x,this.break_fixed_top=$.y);continue}const f=this.#u(n,h),{elm:_,rect:k,ch:d}=n[f];if(!this.break_fixed){this.break_fixed_left=k.x,this.break_fixed_top=k.y;const b=globalThis.getComputedStyle(_),E=parseFloat(b.fontSize);s?this.break_fixed_top+=E:this.break_fixed_left+=E}m=-1/0;const o=h,{cont:u,ins:w}=this.bura?this.hyph_alg_bura(n,f,d,h):this.hyph_alg(n,f,d,h,v);if(h=w,u)continue;const T=n[h].elm,g=T.parentElement,p=document.createElement("br");if(g.classList.contains("sn_tx"))g.insertBefore(p,T);else{const b=g.parentElement;b.classList.contains("sn_ch")?b.parentElement.insertBefore(p,b):b.insertBefore(p,g)}h+=2,h<o&&(h=o),r=-1;break}}while(r<0);return[n,r]}#u(t,e){const s=e-1,{elm:i}=t[s];return i.tagName!=="RT"?s-(i.style.textCombineUpright==="all"?Array.from(i.textContent).length-1:0):s-Array.from(i.textContent).length}#f(t,e){const s=[];if(t.nodeType!==t.TEXT_NODE)return Array.from(t.childNodes).map(r=>this.#f(r,e)).flat();const i=t.ownerDocument.createRange();i.selectNodeContents(t);let a=0;const n=i.endOffset;for(;a<n;){i.setStart(t,a),i.setEnd(t,++a);const r=i.toString();s.push({ch:r,rect:e(i,r),elm:i.startContainer.parentElement})}return i.detach(),s}hyph_alg(t,e,s,i,a){let n=i;if(!this.#h.test(s)){if(this.#e.test(a))for(;(n=this.#u(t,n))>=0&&this.#e.test(t[n].ch););else if(!(s===a&&this.#d.test(s)))return{cont:!0,ins:n+1}}for(n=e;(n=this.#u(t,n))>=0&&this.#h.test(t[n].ch););return{cont:!1,ins:n+1}}hyph_alg_bura(t,e,s,i){const a=this.#u(t,e),{ch:n}=t[a];if(this.#S.test(n)||this.#e.test(n)){let h=e;(this.#S.test(s)||this.#e.test(s))&&++h;const l=this.#u(t,h),{ch:m}=t[l],{ch:y}=t[h];if(m===y&&this.#d.test(y))return{cont:!1,ins:l};if(!this.#h.test(m))return{cont:!1,ins:h};h=l;do if(!this.#h.test(t[h].ch))break;while((h=this.#u(t,h))>=0);return{cont:!1,ins:h+1}}const r=this.#u(t,a);if(i>=3){const{ch:h}=t[r];if(this.#d.test(n)&&h===n)return{cont:!1,ins:r};if(this.#h.test(h)){let l=r;for(;(l=this.#u(t,l))>=0&&this.#h.test(t[l].ch););return{cont:!1,ins:l+1}}}return{cont:!1,ins:a}}}function mt(Y,t,e,s,i,a=!0){const n={escape:d=>d.replaceAll(/([.*+?^${}()|[\]/\\])/g,"\\$1"),mimeType:d=>{const o=y(d).toLowerCase();return r()[o]||""},dataAsUrl:f,isDataUrl:$,resolveUrl:v,getAndEncode:x,asArray:d=>{const o=[],u=d.length;for(let w=0;w<u;++w)o.push(d[w]);return o}};function r(){const d="application/font-woff",o="image/jpeg";return{woff:d,woff2:d,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:o,jpeg:o,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}const h=_(),l=k();function m(d){return l.resolveAll().then(o=>{const u=document.createElement("style");return d.appendChild(u),u.appendChild(document.createTextNode(o)),d})}function y(d){return/\.([^./]*?)$/g.exec(d)?.[1]??""}function $(d){return d.search(/^(data:)/)!==-1}function v(d,o){const u=document.implementation.createHTMLDocument(),w=u.createElement("base");u.head.appendChild(w);const T=u.createElement("a");return u.body.appendChild(T),w.href=o,T.href=d,T.href}function x(d){return new Promise(function(o){const u=new XMLHttpRequest;u.onreadystatechange=w,u.ontimeout=T,u.responseType="blob",u.timeout=3e4,u.open("GET",d,!0),u.send();function w(){if(u.readyState!==4)return;if(u.status!==200){g("cannot fetch resource: "+d+", status: "+u.status);return}const p=new FileReader;p.onloadend=function(){const b=p.result.toString().split(/,/)[1];o(b)},p.readAsDataURL(u.response)}function T(){g("timeout of 30000ms occured while fetching resource: "+d)}function g(p){console.error(p),o("")}})}function f(d,o){return"data:"+o+";base64,"+d}function _(){const d=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:T,shouldProcess:o};function o(g){return g.search(d)!==-1}function u(g){const p=[];let b;for(;b=d.exec(g);)p.push(b[1]);return p.filter(function(E){return!n.isDataUrl(E)})}function w(g,p,b,E){return Promise.resolve(p).then(A=>b?n.resolveUrl(A,b):A).then(E||n.getAndEncode).then(A=>n.dataAsUrl(A,n.mimeType(p))).then(A=>g.replace(P(p),"$1"+A+"$3"));function P(A){return new RegExp(`(url\\(['"]?)(`+n.escape(A)+`)(['"]?\\))`,"g")}}function T(g,p,b){if(E())return Promise.resolve(g);return Promise.resolve(g).then(u).then(P=>{let A=Promise.resolve(g);for(const F of P)A=A.then(J=>w(J,F,p,b));return A});function E(){return!o(g)}}}function k(){return{resolveAll:d,impl:{readAll:o}};function d(){return o().then(u=>Promise.allSettled(u.map(w=>w.resolve()))).then(u=>u.join(`
`))}function o(){return Promise.resolve(n.asArray(document.styleSheets)).then(w).then(u).then(g=>g.map(T));function u(g){return g.filter(p=>p.type===CSSRule.FONT_FACE_RULE).filter(p=>h.shouldProcess(p.style.getPropertyValue("src")))}function w(g){const p=[];for(const b of g)try{if(b.href)continue;n.asArray(b.cssRules||[]).forEach(p.push.bind(p))}catch(E){console.error("Error while reading CSS rules from "+b.href,String(E))}return p}function T(g){return{resolve:function(){const p=(g.parentStyleSheet||{}).href;return h.inlineAll(g.cssText,p)},src(){return g.style.getPropertyValue("src")}}}}}Promise.resolve(t).then(d=>{const o=d.cloneNode(!0);return o.style.padding="0px",o.style.paddingRight=s+"px",o.style.paddingTop=i+"px",o.style.left="0px",o.style.top="0px",o.style.width=e.$width-e.pad_left-e.pad_right+"px",o.style.height=e.$height-e.pad_top-e.pad_bottom+"px",t.hidden=a,o}).then(m).then(d=>{d.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const o=new Image;return o.src=`data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="${String(e.$width)}px" height="${String(e.$height)}px"><foreignObject x="0" y="0" width="100%" height="100%">${new XMLSerializer().serializeToString(d).replaceAll("#","%23").replaceAll(`
`,"%0A")}</foreignObject></svg>`,new Promise(u=>{o.onload=()=>u(o)})}).then(d=>new Promise(o=>setTimeout(()=>o(d),100))).then(d=>{const o=document.createElement("canvas");o.width=e.$width,o.height=e.$height,o.getContext("2d").drawImage(d,0,0),Y(ot.from(o))}).catch(d=>V.myTrace(`goTxt() = ${String(d)}`))}class c extends j{constructor(t,e,s){super(),this.ctn=t,this.canFocus=e,this.sys=s,this.#e.classList.add("sn_tx"),this.#e.style.position="absolute",c.#n.view.parentElement.appendChild(this.#e),this.addChild(this.#h),this.addChild(this.#d),this.#d.name="grpDbgMasume";const i=N.debugLog?({ch:a,rect:{x:n,y:r,width:h,height:l}})=>console.log(`üçå masume ch:${a} x:${String(n)} y:${String(r)} w:${String(h)} h:${String(l)}`):()=>{};this.#m=c.#c.oCfg.debug.masume?a=>{i(a);const{x:n,y:r,width:h,height:l}=a.rect;this.#d.beginFill(6737151,.5).lineStyle(2,16724736,1).drawRect(n,r,h,l).endFill()}:()=>{},this.noticeCompTxt=s.isApp&&c.#c.oCfg.debug.dumpHtm?()=>{M.notifyEndProc(et);const a=this.#e.innerHTML;if(a==="")return;const{fn:n,ln:r}=c.#a.nowScrFnLn(),h=`dumpHtm ${t.name.slice(0,-7).replaceAll(":","=")}(fn=${n} line=${String(r)})`;s.outputFile(s.path_downloads+h+".htm",`<!doctype html><html><head><meta charset=utf-8><title>${h}</title>
<h1>${h}</h1>${a.replaceAll(/ class="sn_ch"|animation-delay: \d+ms; ?| data-add="{&quot;ch_in_style&quot;:&quot;default&quot;, &quot;ch_out_style&quot;:&quot;default&quot;}"/g,"").replaceAll(' style=""',"").replaceAll(/(<\/?ruby>)/g,`
$1
`).replaceAll(/<(br|\/span)>/g,`<$1>
`)}`)}:()=>M.notifyEndProc(et)}static#c;static#n;static init(t,e){c.#c=t,c.#n=e}static#l;static#a;static setEvtMng(t,e){c.#l=t,c.#a=e}static destroy(){c.#x=Object.create(null),c.#v=Object.create(null),c.delBreak()}#e=document.createElement("span");#h=new j;#d=new O;static#S={"background-color":0,"border-bottom-width":0,"border-left-width":0,"border-right-width":0,"border-top-width":0,"margin-bottom":0,"margin-left":0,"margin-right":0,"margin-top":0};#r=new yt;noticeCompTxt=()=>{};#m;#t={fontsize:24,$width:0,$height:0,pad_left:0,pad_right:0,pad_top:0,pad_bottom:0};lay(t){const e=this.#e.style;if("style"in t)if(t.style){const s=document.createElement("span");s.style.cssText=t.style;const i=s.style.length;for(let a=0;a<i;++a){const n=s.style[a];if(n in c.#S){V.myTrace(`${String(n)}„ÅØÊåáÂÆö„Åß„Åç„Åæ„Åõ„Çì`,"W");continue}e[n]=s.style[n]}!s.style.opacity&&"alpha"in t&&(e.opacity=String(this.ctn.alpha))}else this.#e.style.cssText="";else"alpha"in t&&(e.opacity=String(this.ctn.alpha));if("width"in t&&(e.width=String(t.width??"0")+"px"),"height"in t&&(e.height=String(t.height??"0")+"px"),"pl"in t&&(e.paddingLeft=String(t.pl??"0")+"px"),"pr"in t&&(e.paddingRight=String(t.pr??"0")+"px"),"pt"in t&&(e.paddingTop=String(t.pt??"0")+"px"),"pb"in t&&(e.paddingBottom=String(t.pb??"0")+"px"),this.#r.lay(t),this.#f(),this.#o=this.ctn.position.x,e.transformOrigin=`${String(this.ctn.pivot.x)}px ${String(this.ctn.pivot.y)}px`,this.cvsResize(),e.display=this.ctn.visible?"inline":"none",":redraw"in t&&this.#_>0){const s=[this.#e.innerHTML.replaceAll(/(animation-delay: )\d+ms/g,"$10ms"),`<span class='sn_ch' data-add='{"ch_in_style":"default"}'>&emsp;</span>`];this.#H(),this.goTxt(s,!0)}}#u=0;#f(){const t=this.#e.style,e=parseFloat(t.fontSize||"0");this.#t.fontsize=e,this.#t.pad_left=parseFloat(t.paddingLeft||"0"),this.#t.pad_right=parseFloat(t.paddingRight||"0"),this.#t.pad_top=parseFloat(t.paddingTop||"0"),this.#t.pad_bottom=parseFloat(t.paddingBottom||"0"),this.#t.$width=parseFloat(t.width||"0"),this.#t.$height=parseFloat(t.height||"0"),this.position.set(this.#t.pad_left,this.#t.pad_top),this.#p=t.writingMode==="vertical-rl",this.#i=0,this.#b=0;const s=t.lineHeight??"0";this.#u=this.#p?0:(s.endsWith("px")?parseFloat(s):e*parseFloat(s)-e)/2}cvsResize(){const t=this.#e.style,e=this.sys.cvsScale;t.left=`${String(this.sys.ofsLeft4elm+this.#o*e)}px`,t.top=`${String(this.sys.ofsTop4elm+this.ctn.position.y*e)}px`,t.transform=`rotate(${String(this.ctn.angle)}deg) scale(${String(this.ctn.scale.x*e)}, ${String(this.ctn.scale.y*e)})`}#o=0;#p=!1;get tategaki(){return this.#p}#i=0;#b=0;get infTL(){return this.#t}get getWidth(){return this.#t.$width}get getHeight(){return this.#t.$height}setMySize(t,e){this.#t.$width=t,this.#t.$height=e,this.#e.style.width=String(this.#t.$width)+"px",this.#e.style.height=String(this.#t.$height)+"px"}#s=[];goTxt(t,e){const s=()=>this.#y(t,e);this.#s.push(s)===1&&s()}#R=[];#_=0;static#W="<span class='sn_ch sn_ch_last'>&emsp;</span>";#y(t,e){c.#N.visible=!1;let s=this.#R.length,i="";if(s===0){if(c.#c.oCfg.debug.masume&&(N.debugLog&&console.log(`üçå masume ${this.name} v:${String(this.visible)} l:${String(this.x)} t:${String(this.y)} a:${String(this.alpha)} pl:${String(this.#t.pad_left)} pr:${String(this.#t.pad_right)} pt:${String(this.#t.pad_top)} pb:${String(this.#t.pad_bottom)} w:${String(this.#t.$width)} h:${String(this.#t.$height)}`),this.#d.clear().beginFill(3407616,.2).lineStyle(1,3407616,1).drawRect(-this.#t.pad_left,-this.#t.pad_top,this.#t.$width,this.#t.$height).endFill().beginFill(13311,.2).lineStyle(2,13311,1).drawRect(0,0,this.#t.$width-this.#t.pad_left-this.#t.pad_right,this.#t.$height-this.#t.pad_top-this.#t.pad_bottom).endFill()),this.#e.innerHTML=[...t].join("").replaceAll(/[\n\t]/g,"")+c.#W,!this.#r.break_fixed){const f=globalThis.getComputedStyle(this.#e),_=parseFloat(f.fontSize);this.#p?(this.#r.break_fixed_left=(this.#t.$width-this.#t.pad_left-this.#t.pad_right-_*1.5)*this.sys.cvsScale,this.#r.break_fixed_top=0):(this.#r.break_fixed_left=0,this.#r.break_fixed_top=_/2*this.sys.cvsScale)}}else i=this.#e.innerHTML,--s,this.#e.getElementsByClassName("sn_ch_last").item(0)?.remove(),this.#e.querySelectorAll(":scope > br").forEach(f=>f.remove()),this.#e.insertAdjacentHTML("beforeend",t.slice(this.#_).join("").replaceAll(/[\n\t]/g,"")+c.#W);this.#e.querySelectorAll(".sn_ch:has(> ruby)").forEach(f=>{f.style.background=""}),this.#_=t.length;const a=this.sys.cvsScale,n=this.#e.getBoundingClientRect(),r=n.left+this.#t.pad_left,h=n.top+this.#t.pad_top;let l;if(a===1)l=(f,_)=>{const k=f.getBoundingClientRect();return new G(k.left-r,k.top-h,k.width,k.height+("gjqy".includes(_)?this.#u:0))};else{const f=this.sys.ofsPadLeft_Dom2PIXI+n.left*(1-a),_=this.sys.ofsPadTop_Dom2PIXI+n.top*(1-a);l=(k,d)=>{const o=k.getBoundingClientRect();return new G((o.left-f)/a-r,(o.top-_)/a-h,o.width/a,(o.height+("gjqy".includes(d)?this.#u:0))/a)}}const[m,y]=this.#r.hyph(this.#e,l,this.#p,s,i);this.#R=m;const $=ct.ease(this.#C);for(let f=s;f<y;++f){const _=this.#R[f],{elm:{dataset:k,parentElement:d},rect:o}=_,u=JSON.parse(k.arg??'{"delay": 0}'),w=JSON.parse(k.add??"{}"),T=c.#x[w.ch_in_style];if(this.#m(_),k.cmd==="grp"){const g=new j;this.#h.addChild(g),new B(u.pic,g,p=>{this.#F(g,u,w,o,$,T??{}),g.parent||g.removeChild(p)})}if(k.lnk){const g=d.closest("[data-arg]"),p=JSON.parse(g.dataset.arg??"{}");p.key=`lnk=[${String(f)}] `+this.name;const b=new q;this.#F(b,p,w,o,$,T??{});const E=p.style??"",P=E+(p.style_hover??""),A=E+(p.style_clicked??""),F=p.r_style??"",J=F+(p.r_style_hover??""),nt=F+(p.r_style_clicked??""),Q=Array.from(g.getElementsByTagName("rt"));for(const z of Q)z.dataset.st_r_bk=z.style.cssText;const at=g.style.cssText,D=(z,ht)=>{g.style.cssText=at+z;for(const Z of Q)Z.style.cssText=Z.dataset.st_r_bk+ht};R(p,"enabled",!0)?c.#l.button(p,b,()=>D(E,F),()=>this.canFocus()?(D(P,J),!0):!1,()=>D(A,nt)):D(E+(p.style_disable??"color: gray;"),F+(p.r_style_disable??"color: gray;")),this.#h.addChild(b)}}const v=Array.from(this.#e.getElementsByClassName("sn_ch_yet"));this.#k=()=>{this.#k=()=>!1;for(const _ of v)_.className="sn_ch";c.#N.position.set(this.#r.break_fixed_left,this.#r.break_fixed_top),c.#N.visible=!0,this.noticeCompTxt();const f=this.#s.shift();return this.#s.length>0&&f(),!0};for(const f of v)f.className=f.className.replace("sn_ch_yet sn","go");s>0&&++s;let x;for(let f=y-2;f>=0;--f){const{elm:_}=this.#R[f];if(_.tagName==="SPAN"){x=_.parentElement?.tagName==="RUBY"?_.parentElement.parentElement??_:_;break}}if(!x||e||s===y){this.#k();return}x.addEventListener("animationend",()=>this.#k(),{once:!0})}#k=()=>!1;#F(t,e,s,i,a,n){t.alpha=0,e.x&&(i.x=e.x.startsWith("=")?i.x+parseInt(e.x.slice(1)):parseInt(e.x)),e.y&&(i.y=e.y.startsWith("=")?i.y+parseInt(e.y.slice(1)):parseInt(e.y)),e.width&&(i.width=parseInt(e.width)),e.height&&(i.height=parseInt(e.height)),e.wait&&(n.wait=e.wait),t.width=i.width,t.height=i.height,n.x?t.position.set(n.x.startsWith("=")?i.x+t.width*n.nx:n.nx,n.y.startsWith("=")?i.y+t.height*n.ny:n.ny):t.position.set(i.x,i.y);const r={sp:t,tw:new dt(t).to({alpha:1,x:i.x,y:i.y,width:i.width,height:i.height,angle:0},n.wait??0).easing(a).delay((s.wait??0)+(e.delay??0)).onComplete(()=>{r.tw=void 0}).start()};this.#L.push(r)}#L=[];skipChIn(){let t=this.#k();for(const e of this.#L)e.tw&&(e.tw.stop().end(),t=!0);return this.#L=[],t}static#x=Object.create(null);static#B=/[{\s.,*{]/;static initChStyle(){c.#x=Object.create(null),c.#v=Object.create(null)}static getChInStyle(t){return c.#x[t]}static ch_in_style(t){const{name:e}=t;if(!e)throw"name„ÅØÂøÖÈ†à„Åß„Åô";if(c.#B.test(e))throw`name„Äê${e}„Äë„Å´‰Ωø„Åà„Å™„ÅÑÊñáÂ≠ó„ÅåÂê´„Åæ„Çå„Åæ„Åô`;if(e in c.#x)throw`name„Äê${e}„Äë„ÅØ„Åô„Åß„Å´„ÅÇ„Çä„Åæ„Åô`;const s=String(t.x??"=0"),i=String(t.y??"=0");return c.#x[e]={wait:C(t,"wait",500),alpha:C(t,"alpha",0),x:s,y:i,nx:parseFloat(s.at(0)==="="?s.slice(1):s),ny:parseFloat(i.at(0)==="="?i.slice(1):i),scale_x:C(t,"scale_x",1),scale_y:C(t,"scale_y",1),rotate:C(t,"rotate",0),join:R(t,"join",!0),ease:t.ease??"ease-out"}}static#v=Object.create(null);static getChOutStyle(t){return c.#v[t]}static ch_out_style(t){const{name:e}=t;if(!e)throw"name„ÅØÂøÖÈ†à„Åß„Åô";if(c.#B.test(e))throw`name„Äê${e}„Äë„Å´‰Ωø„Åà„Å™„ÅÑÊñáÂ≠ó„ÅåÂê´„Åæ„Çå„Åæ„Åô`;if(e in c.#v)throw`name„Äê${e}„Äë„ÅØ„Åô„Åß„Å´„ÅÇ„Çä„Åæ„Åô`;const s=String(t.x??"=0"),i=String(t.y??"=0");return c.#v[e]={wait:C(t,"wait",500),alpha:C(t,"alpha",0),x:s,y:i,nx:parseFloat(s.at(0)==="="?s.slice(1):s),ny:parseFloat(i.at(0)==="="?i.slice(1):i),scale_x:C(t,"scale_x",1),scale_y:C(t,"scale_y",1),rotate:C(t,"rotate",0),join:R(t,"join",!1),ease:t.ease??"ease-out"}}static#N=new j;static#M=new B;dispBreak(t){c.delBreak();const e=c.#N;e.visible=!1,this.addChild(e),c.#M.destroy(),c.#M=new B(t.pic,e,s=>{e.parent?(s.x=C(t,"x",0),s.y=C(t,"y",0),s.width=C(t,"width",this.#t.fontsize),s.height=C(t,"height",this.#t.fontsize)):e.removeChild(s)})}static delBreak(){const t=c.#N;t.parent?.removeChild(t),c.#M.destroy()}#C="Quadratic.Out";#T="Quadratic.Out";#H(){this.#d.clear(),this.#R=[],this.#_=0,this.#s=[],this.skipChIn();const t=this.#e.cloneNode(!0);t.textContent="";const e=this.#e,s=Array.from(e.getElementsByClassName("sn_ch"));e.parentElement.insertBefore(t,e);let i=0;s.forEach(n=>{const r=JSON.parse(n.dataset.add??n.children[0]?.getAttribute("data-add")??n.children[0]?.children[0]?.getAttribute("data-add")??"{}");if(!r.ch_out_style)return;const h=c.#v[r.ch_out_style];if(h){if(h.wait===0){n.style.display="none";return}i+=h.wait,h.join||(n.style.animationDelay="0ms"),n.classList.add(`go_ch_out_${String(r.ch_out_style)}`)}});const a=()=>{e.parentElement.removeChild(e);for(const n of this.#h.removeChildren())n instanceof j&&c.#l.unButton(n),n.destroy()};i===0?(this.#e.textContent="",a()):e.lastElementChild?.addEventListener("animationend",a,{once:!0}),this.#e=t}reNew(){this.#H();const t=new c(this.ctn,()=>this.canFocus(),this.sys);return t.#t=this.#t,t.#e.style.cssText=this.#e.style.cssText,t.#o=this.#o,t.name=this.name,t.#f(),t.#P=this.#P,t.#C=this.#C,t.#T=this.#T,this.#r.reNew(t.#r),this.destroy(),t}#P=void 0;record(){return{infTL:this.#t,cssText:this.#e.style.cssText,left:this.#o,ch_filter:this.#P,fi_easing:this.#C,fo_easing:this.#T,hyph:this.#r.record()}}playback(t){this.#t=t.infTL,this.position.set(this.#t.pad_left,this.#t.pad_top),this.#e.style.cssText=t.cssText,this.#o=t.left,this.#f(),this.#P=t.ch_filter,this.#C=t.fi_easing,this.#T=t.fo_easing,this.#r.playback(t.hyph)}get cssText(){return this.#e.style.cssText}set cssText(t){this.#e.style.cssText=t}#g=void 0;snapshot(t,e){mt(s=>{this.#g=q.from(s),this.#p&&(this.#g.x+=N.stageW-(this.#o+this.#t.$width)),this.#g.y-=this.#b,this.#g.texture.frame=new G(0,0,Math.min(this.#g.width,this.#t.$width-this.#o),Math.min(this.#g.height,this.#t.$height)),this.#h.addChild(this.#g),t.render(this.#g,{clear:!1}),e()},this.#e,this.#t,this.#i,this.#b,!1)}snapshot_end(){this.#g&&(this.#h.removeChild(this.#g),this.#g=void 0)}makeDesignCast(t){}showDesignCast(){}dump(){const t=[],e=this.#e.style,s=e.length;for(let i=0;i<s;++i){const a=e[i];t.push(`"${String(a)}":"${e[a].replaceAll(/(["\\])/g,"\\$1")}"`)}return`"txt":"${this.#e.textContent.replaceAll(/(["\\])/g,"\\$1")}", "style":{${t.join(",")}}`}destroy(){c.delBreak(),this.#e.parentElement.removeChild(this.#e),this.removeChild(this.#h),this.removeChild(this.#d),super.destroy()}}class S extends K{static#c;static#n;static#l;static#a;static init(t,e,s,i,a,n){this.#c=t,c.init(t,n),this.#n=s,this.#a=i,this.#l=a,s.setDoRecProc(r=>this.chgDoRec(r)),e.autowc=r=>this.#u(r),e.autowc({enabled:!1,text:"",time:0}),e.ch_in_style=r=>this.#e(r),e.ch_out_style=r=>this.#h(r),c.initChStyle(),rt(),U(t.matchPath(".+",tt.FONT).flatMap(r=>Object.values(r).map(h=>`
@font-face {
	font-family: '${String(h)}';
	src: url('${this.#c.searchPath(String(h),tt.FONT)}');
}
`)).join("")+`
.sn_tx {
	pointer-events: none;
	user-select: none;
	-webkit-touch-callout: none;
	box-sizing: border-box;
}
.sn_ch {
	position: relative;
	display: inline-block;
}
`),this.#e({name:"default",wait:500,alpha:0,x:"=0.3",y:"=0",scale_x:1,scale_y:1,rotate:0,join:!0,ease:"ease-out"}),this.#h({name:"default",wait:0,alpha:0,x:"=0",y:"=0",scale_x:1,scale_y:1,rotate:0,join:!1,ease:"ease-out"})}static#e(t){const{x:e,y:s,nx:i,ny:a,alpha:n,wait:r,ease:h,rotate:l,scale_x:m,scale_y:y}=c.ch_in_style(t),$=e.startsWith("=")?`${String(i*100)}%`:`${String(i)}px`,v=s.startsWith("=")?`${String(a*100)}%`:`${String(a)}px`,{name:x=""}=t;return U(`
.sn_ch_in_${x} {
	position: relative;
	display: inline-block;
}
.go_ch_in_${x} {
	opacity: ${String(n)};
	position: relative;
	display: inline-block;
	animation: sn_ch_in_${x} ${String(r)}ms ${h} 0s both;
}
@keyframes sn_ch_in_${x} {
	from {transform: rotate(${String(l)}deg) scale(${String(m)}, ${String(y)}) translate(${$}, ${v})}
	to {opacity: 1; transform: none;}
}
`),!1}static#h(t){const{x:e,y:s,nx:i,ny:a,alpha:n,wait:r,ease:h,rotate:l,scale_x:m,scale_y:y}=c.ch_out_style(t),$=e.startsWith("=")?`${String(i*100)}%`:`${String(i)}px`,v=s.startsWith("=")?`${String(a*100)}%`:`${String(a)}px`,{name:x=""}=t;return U(`
.go_ch_out_${x} {
	position: relative;
	display: inline-block;
	animation: go_ch_out_${x} ${String(r)}ms ${h} 0s both;
}
@keyframes go_ch_out_${x} {
	to {
		opacity: ${String(n)};
		transform: rotate(${String(l)}deg) scale(${String(m)}, ${String(y)}) translate(${$}, ${v});
	}
`),!1}static#d=10;static set msecChWait(t){S.#d=t}static get msecChWait(){return S.#d}static#S;static#r;static setEvtMng(t,e,s){this.#S=t,this.#r=e,c.setEvtMng(t,s)}static#m=!1;static#t={};static#u(t){this.#m=R(t,"enabled",this.#m),this.#n.setVal_Nochk("save","const.sn.autowc.enabled",this.#m);const{text:e}=t;if("text"in t!="time"in t)throw"[autowc] text„Å®time„ÅØÂêåÊôÇÊåáÂÆöÂøÖÈ†à„Åß„Åô";if(this.#n.setVal_Nochk("save","const.sn.autowc.text",e),!e)return this.#n.setVal_Nochk("save","const.sn.autowc.time",""),!1;const s=e.length;if(this.#m&&s===0)throw'[autowc] enabled === false „Åã„Å§ text === "" „ÅØË®±„Åï„Çå„Åæ„Åõ„Çì';const i=String(t.time).split(",");if(i.length!==s)throw"[autowc] textÊñáÂ≠óÊï∞„Å®time„Å´Ë®òËø∞„Åï„Çå„ÅüÂæÖ„Å°ÊôÇÈñìÔºà„Ç≥„É≥„ÉûÂå∫Âàá„ÇäÔºâ„ÅØÂêåÊï∞„Å´„Åó„Å¶‰∏ã„Åï„ÅÑ";this.#t={};for(let a=0;a<s;++a)this.#t[e[a]]=L(i[a]);return this.#n.setVal_Nochk("save","const.sn.autowc.time",t.time),!1}#f=0;#o=0;#p=!1;#i=void 0;#b="";#s=new c(this.ctn,()=>this.canFocus(),S.#r);#R=new st;#_=document.createElement("span");static#W={"text-align":0,"text-align-last":0,height:0,width:0,"padding-left":0,"padding-right":0,"padding-top":0,"padding-bottom":0};#y=new j;constructor(){super(),this.ctn.addChild(this.#s),this.#R.init(this.#X),this.ctn.addChild(this.#y),this.#y.name="cntBtn",this.lay({style:`width: ${String(N.stageW)}px; height: ${String(N.stageH)}px; font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Ê∏∏„Ç¥„Ç∑„ÉÉ„ÇØ Medium', meiryo, sans-serif; color: white; font-size: 24px; line-height: 1.5; padding: ${String(16)}px;`,in_style:"default",out_style:"default",back_clear:"true"})}destroy(){this.#i&&(this.ctn.removeChild(this.#i).destroy(),this.#i=void 0),S.#a.pagebreak(),this.#s.destroy()}static destroy(){this.#m=!1,this.#t={},this.#g=t=>t}set name(t){this.name_=t,this.#s.name=t}get name(){return this.name_}cvsResize(){this.#s.cvsResize()}cvsResizeChildren(){for(const t of this.#y.children)t.cvsResize()}procSetX(t){this.#s.lay({x:t})}procSetY(t){this.#s.lay({y:t})}lay(t){if(super.lay(t),K.setXY(this.ctn,t,this.ctn),t[":id_tag"]=this.name_.slice(0,-7),st.setting(t),this.#M(t),this.#s.lay(t),"r_align"in t&&(this.#$=t.r_align??""),this.#z=N.isSafari?this.#s.tategaki?(i,a)=>`text-align: start; height: ${String(a)}em; padding-top: ${i}; padding-bottom: ${i};`:(i,a)=>`text-align: start; width: ${String(a)}em; padding-left: ${i}; padding-right: ${i};`:this.#s.tategaki?i=>`text-align: justify; text-align-last: justify; padding-top: ${i}; padding-bottom: ${i};`:i=>`text-align: justify; text-align-last: justify; padding-left: ${i}; padding-right: ${i};`,N.isFirefox&&(this.#I=this.#Q),"r_style"in t)if(t.r_style){const i=document.createElement("span");i.style.cssText=t.r_style;const a=i.style.length,n=this.#_.style;for(let r=0;r<a;++r){const h=i.style[r];if(h in S.#W){V.myTrace(`${String(h)}„ÅØÊåáÂÆö„Åß„Åç„Åæ„Åõ„Çì`,"W");continue}const l=i.style[h];l&&(n[h]=l)}}else this.#_.style.cssText="";if("alpha"in t)for(const i of this.#y.children)i.alpha=this.ctn.alpha;this.#k(t),this.#x(t);const e=M.procID+`TxtLayer lay name:${this.name_}`,s=this.#N(t,i=>{i&&M.endProc(e)});return s&&M.beginProc(e),s}#k(t){const{in_style:e}=t;if(!e)return;const s=c.getChInStyle(e);if(!s)throw`Â≠òÂú®„Åó„Å™„ÅÑin_style„Äê${e}„Äë„Åß„Åô`;this.#F=e,this.#L=s.join}#F="";#L=!0;get width(){return this.#s.getWidth}get height(){return this.#s.getHeight}#x(t){const{out_style:e}=t;if(e){if(!c.getChOutStyle(e))throw`Â≠òÂú®„Åó„Å™„ÅÑout_style„Äê${e}„Äë„Åß„Åô`;this.#B=e}}#B="";#v=new B;#N(t,e){if("back_clear"in t)return R(t,"back_clear",!1)&&(this.#f=0,this.#o=0,this.#p=!1,this.#b=""),e(!1),!1;this.#o=C(t,"b_alpha",this.#o),this.#p=R(t,"b_alpha_isfixed",this.#p);const s=(this.#p?1:Number(S.#n.getVal("sys:TextLayer.Back.Alpha")))*this.#o;if(t.b_pic){if(this.#b!==t.b_pic)return this.#b=t.b_pic,this.#i&&(this.ctn.removeChild(this.#i),this.#i.destroy()),this.#v=new B(this.#b,this.ctn,i=>{this.#i=i,i.name="back(pic)",i.visible=s>0,i.alpha=s,this.#s.setMySize(i.width,i.height),this.ctn.setChildIndex(i,0),e(!0)}),this.#v.ret}else"b_color"in t&&(this.#f=lt(t,"b_color",0),this.#i&&(this.ctn.removeChild(this.#i),this.#i.destroy()),this.#b="",this.ctn.addChildAt((this.#i=new O).beginFill(this.#f,s).lineStyle(void 0).drawRect(0,0,this.#s.getWidth,this.#s.getHeight).endFill(),0),this.#i.name="back(color)");return this.#i&&(this.#i.visible=s>0,this.#i.alpha=s),e(!1),!1}chgBackAlpha(t){const e=this.#p?this.#o:t*this.#o;this.#i instanceof O&&(this.#i&&(this.ctn.removeChild(this.#i),this.#i.destroy()),this.ctn.addChildAt((this.#i=new O).beginFill(this.#f,e).lineStyle(void 0).drawRect(0,0,this.#s.getWidth,this.#s.getHeight).endFill(),0),this.#i.name="back(color)"),this.#i&&(this.#i.visible=e>0,this.#i.alpha=e)}#M(t){"noffs"in t&&(this.#H=t.noffs??"",this.#P=new RegExp(`[„ÄÄ${this.#H}]`)),"ffs"in t&&(this.#C??="",this.#T=this.#C===""?()=>"":e=>this.#P.test(e)?"":` font-feature-settings: ${this.#C};`)}#C="";#T=t=>"";#H="";#P=/[„ÄÄ]/;static chgDoRec(t){this.#g=t?e=>e:e=>`<span class='offrec'>${e}</span>`}static#g=t=>t;isCur=!1;#z=()=>"";#I=(t,e,s,i="")=>{if(!s)return` style='${i}'`;const a=t.length*2;if(a-e.length<0)return` style='text-align: ${s}; ${i}'`;let n="";switch(s){case"justify":n=this.#z("0",a);break;case"121":n=this.#z(`calc(${String((a-e.length)/(e.length*2))}em)`,a);break;case"even":n=this.#z(`calc(${String((a-e.length)/(e.length+1))}em)`,a);break;case"1ruby":n=this.#z("1em",a);break;default:n=`text-align: ${s};`}return` style='${n} ${i}'`};#$="";#Q(t,e,s,i=""){if(!s)return` style='${i}'`;const a=t.length*2;if(a-e.length<0)return` style='text-align: ${s}; ${i}'`;let n="";switch(s){case"left":n="ruby-align: start;";break;case"center":n="ruby-align: center;";break;case"right":n="ruby-align: start;";break;case"justify":n="ruby-align: space-between;";break;case"121":n="ruby-align: space-around;";break;case"even":{const r=` ${String((a-e.length)/(e.length+1))}em;`;n="ruby-align: space-between; "+(this.#s.tategaki?`padding-top:${r} padding-bottom:${r}`:`padding-left:${r} padding-right:${r}`)}break;case"1ruby":n="ruby-align: space-between; "+(this.#s.tategaki?"padding-top: 1em; padding-bottom: 1em;":"padding-left: 1em; padding-right: 1em;");break;default:n=`text-align: ${s};`}return` style='${n} ${i}'`}tagCh(t){this.#R.putTxt(t)}#w=!1;get needGoTxt(){return this.#w}#X=(t,e)=>{let s=e;S.#c.oCfg.debug.putCh&&console.log(`üñä ÊñáÂ≠óË°®Á§∫ text:\`${t}\`(${t.charCodeAt(0).toString(16)}) ruby:\`${s}\` name:\`${this.name_}\``);const i=s.split("ÔΩú");let a="";const[n,...r]=i,h=r.join("ÔΩú");switch(i.length){case 1:if(this.#w=!0,t===`
`){this.#j?(this.#j=!1,a="<ruby>&emsp;<rt>&emsp;</rt></ruby><br/>"):a="<br/>";break}this.#j&&(this.#j=!1,s===""&&(s="&emsp;")),a=this.#U(t,s,this.#$);break;default:switch(n){case"start":case"left":case"center":case"right":case"justify":case"121":case"even":case"1ruby":this.#j=!1,this.#w=!0,a=this.#U(t,h,n);break;case"gotxt":this.#G(),this.#w?(this.isCur&&S.#a.recText(this.#E.join("").replace(/^<ruby>&emsp;<rt>&emsp;<\/rt><\/ruby>(<br\/>)+/,"").replaceAll(/style='(anim\S+ [^;]+;\s*)+/g,"style='").replaceAll(/( style=''| data-(add|arg|cmd)='[^']+'|\n+|\t+)/g,"").replaceAll(/class='sn_ch[^']+/g,"class='sn_ch").replaceAll("display: none;","").replaceAll("class='offrec'","style='display: none;'")),this.#s.goTxt(this.#E,this.#O===0),this.#w=!1,this.#O=0):this.isCur&&this.#s.noticeCompTxt();return;case"add":{const l=JSON.parse(h),{style:m="",wait:y=null}=l,{cl:$,sty:v}=this.#D(!0,y?L(y):null);this.#E.push(`<span${$} style='${v} display: inline; ${m}'>`),delete l.style,this.#V(l)}return;case"add_close":this.#E.push("</span>"),this.#G();return;case"grp":this.#w=!0;{const l=JSON.parse(h);if(l.id??=String(this.#E.length),l.id==="break"){this.#s.dispBreak(l);return}this.#j=!1,l.delay=this.#O,l.r??="",l.style??="",l.r_style??="";const{r:m,wait:y=null,r_style:$}=l,{cl:v,sty:x,lnk:f}=this.#D(!0,y?L(y):null);a=`<span${v} style='${x} ${l.style}'><ruby><span data-cmd='grp' data-arg='${JSON.stringify(l)}'${f} style='${x} display: inline;'>&emsp;</span><rt${f}${this.#I("„ÄÄ",m,this.#$,this.#_.style.cssText+(this.#A.at(-1)?.o.r_style??"")+$)}>${l.r}</rt></ruby></span>`}break;case"tcy":this.#j=!1,this.#w=!0;{const{t:l="",r:m="",wait:y=null,style:$="",r_style:v=""}=JSON.parse(h);S.#n.doRecLog()&&(this.#q+=t+(s?`„Ää${s}„Äã`:""),this.#J+=l);const x=N.isSafari?m.replaceAll(/[A-Za-z0-9]/g,d=>String.fromCharCode(d.charCodeAt(0)+65248)):m,{cl:f,sty:_,lnk:k}=this.#D(!0,y?L(y):null);a=`<span${f} style='${_}${this.#T(l)} ${$}'><ruby><span${k} style='${_} display: inline; text-combine-upright: all;'>${l}</span><rt${k}${this.#I(l,x,this.#$,this.#_.style.cssText+(this.#A.at(-1)?.o.r_style??"")+v)}>${x}</rt></ruby></span>`}break;case"del":c.delBreak();return;case"span":this.#w=!0,this.#Y(JSON.parse(h));return;case"link":this.#w=!0;{const l=JSON.parse(h);l[":link"]=" data-lnk='@'";const{cl:m,sty:y,curpos:$}=this.#D(!1,l.wait?L(l.wait):null);this.#E.push(`<span${m} style='${y} display: inline; ${l.style??""}' ${$} data-arg='${h}'>`),delete l.style,this.#Y(l)}return;case"endlink":this.#w=!0,this.#E.push("</span>"),this.#G();return;default:this.#w=!0,a=this.#U(t,s,this.#$)}break}this.#E.push(S.#g(a))};#U(t,e,s){const i=t===" "?"&nbsp;":t==="„ÄÄ"?"&emsp;":t;S.#n.doRecLog()&&(this.#q+=i+(e?`„Ää${e}„Äã`:""),t!==" "&&(this.#J+=t));const{cl:a,sty:n,lnk:r}=this.#D(!0,null,t);return e?`<span${a} style='${n} ${this.#T(t)}'><ruby>${Array.from(t).map((h,l)=>`<span${a}${r} style='${l>0?this.#D(!0,null,t).sty:n} display: inline;'>${h===" "?"&nbsp;":h==="„ÄÄ"?"&emsp;":h}</span>`).join("")}<rt${r}${this.#I(t,e,s,this.#_.style.cssText+(this.#A.at(-1)?.o.r_style??""))}>${e}</rt></ruby></span>`:`<span${a} style='${n} ${this.#T(t)}'${r}>${i}</span>`}#D(t,e,s=`
`){const i=this.#L?e??this.#A.at(0)?.o.wait??(S.#m?S.#t[s.at(0)??""]??0:S.msecChWait):0;S.#S.isSkipping?this.#O=0:t&&this.#L&&(this.#O+=L(i));const a=`data-add='{"ch_in_style":"${this.#F}", "ch_out_style":"${this.#B}"}'`;return{cl:` class='sn_ch sn_ch_yet sn_ch_in_${this.#F}'`,sty:`animation-delay: ${String(this.#O)}ms;${this.#A.at(-1)?.o.style??""}`,lnk:(this.#A.at(0)?.o[":link"]??"")+" "+a,curpos:a}}#O=0;#j=!0;#E=[];#A=[];#V(t){this.#A.push({o:t,r_align:this.#$,ch_in_style:this.#F,ch_out_style:this.#B}),t.r_align&&(this.#$=t.r_align),this.#k(t),this.#x(t)}#G(){const t=this.#A.pop();t&&(this.#$=t.r_align,this.#k({in_style:t.ch_in_style}),this.#x({out_style:t.ch_out_style}))}#Y(t){const e=this.#A.at(-1);if(!e){this.#V(t);return}e.o={...e.o,...t},!t.style&&!t.r_style&&(e.o.style="",e.o.r_style=""),t.r_align&&(this.#$=t.r_align),this.#k(t),this.#x(t)}click=()=>!this.ctn.interactiveChildren||!this.ctn.visible?!1:this.#s.skipChIn();clearText(){this.ctn.addChild(this.#s=this.#s.reNew()),this.#O=0,this.#j=!0,this.#E=[],this.#q="",this.#J="",S.#a.pagebreak()}#q="";#J="";get pageText(){return this.#q.replace("„Ää&emsp;„Äã","")}get pagePlainText(){return this.#J}get enabled(){return this.ctn.interactiveChildren}set enabled(t){this.ctn.interactiveChildren=t}addButton=t=>new Promise(e=>{t.key=`btn=[${String(this.#y.children.length)}] `+this.name_,t[":id_tag"]=t.key.slice(0,-7),R(t,"hint_tate",this.#s.tategaki);const s=new pt(t,S.#S,()=>e(),()=>this.canFocus());s.name=JSON.stringify(t).replaceAll('"',"'"),this.#y.addChild(s)});canFocus(){return(this.ctn.interactiveChildren??!1)&&this.ctn.visible&&S.#l(this)}clearLay(t){super.clearLay(t),this.clearText();for(const e of this.#y.removeChildren())e.destroy()}record=()=>({...super.record(),enabled:this.enabled,r_cssText:this.#_.style.cssText,r_align:this.#$,b_do:this.#i===void 0?void 0:this.#i instanceof q?"Sprite":"Graphics",b_pic:this.#b,b_color:this.#f,b_alpha:this.#o,b_alpha_isfixed:this.#p,ffs:this.#C,txs:this.#s.record(),strNoFFS:this.#H,btns:this.#y.children.map(t=>t.name)});playback(t,e){super.playback(t,e),this.enabled=t.enabled,this.#_.style.cssText=t.r_cssText,this.#$=t.r_align,this.cvsResize(),this.#M(t),this.#s.playback(t.txs),this.#o=t.b_alpha,this.#p=t.b_alpha_isfixed,e.push(new Promise(s=>{const i=t.b_do?t.b_do==="Sprite"?{b_pic:t.b_pic}:{b_color:t.b_color}:{b_pic:""};i.b_alpha=t.b_alpha,i.b_alpha_isfixed=t.b_alpha_isfixed,this.#N(i,a=>{a&&s()})||s()}),...t.btns.map(s=>this.addButton(JSON.parse(s.replaceAll("'",'"')))).flat())}get cssText(){return this.#s.cssText}set cssText(t){this.#s.cssText=t}snapshot(t,e){t.render(this.ctn,{clear:!1}),this.#s.snapshot(t,e)}snapshot_end(){this.#s.snapshot_end()}makeDesignCast(t){this.ctn.visible&&this.#s.makeDesignCast(t)}makeDesignCastChildren(t){if(this.ctn.visible)for(const e of this.#y.children)e.makeDesignCast(t)}showDesignCast(){this.#s.showDesignCast()}showDesignCastChildren(){for(const t of this.#y.children)t.showDesignCast()}dump(){return this.#X("","gotxtÔΩú"),super.dump()+`, "enabled":"${String(this.enabled)}", ${this.#s.dump()}, "b_pic":"${this.#b}", "b_color":"${String(this.#f)}", "b_alpha":${String(this.#o)}, "b_alpha_isfixed":"${String(this.#p)}", "width":${String(this.#s.getWidth)}, "height":${String(this.#s.getHeight)}, "pixi_obj":[${this.ctn.children.map(t=>`{"class":"${t instanceof q?"Sprite":t instanceof O?"Graphics":t instanceof j?"Container":"?"}", "name":"${t.name}", "alpha":${String(t.alpha)}, "x":${String(t.x)}, "y":${String(t.y)}, "visible":"${String(t.visible)}"}`).join(",")}], "button":[${this.#y.children.map(t=>t.children[0]?.name??"{}").join(",")}]`}}const vt=Object.freeze(Object.defineProperty({__proto__:null,TxtLayer:S},Symbol.toStringTag,{value:"Module"}));export{S as T,c as a,vt as b};
