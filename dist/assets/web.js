const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/platform.js","web.js","assets/Main.js","assets/DebugMng.js","assets/TxtLayer.js","assets/CmnTween.js","assets/Reading.js","assets/SpritesMng.js","assets/RubySpliter.js","assets/Button.js","assets/GrpLayer.js"])))=>i.map(i=>d[i]);
import{_ as __vitePreload}from"../web.js";function int(n){return parseInt(String(n),10)}function uint(n){const e=parseInt(String(n),10);return e<0?-e:e}"toInt"in String.prototype||(String.prototype.toInt=function(){return int(this)});"toUint"in String.prototype||(String.prototype.toUint=function(){const n=int(this);return n<0?-n:n});function getDateStr(n="/",e=" ",t=":",r=""){const o=new Date;return String(o.getFullYear())+n+String(100+o.getMonth()+1).slice(1,3)+n+String(100+o.getDate()).slice(1,3)+e+String(100+o.getHours()).slice(1,3)+t+String(100+o.getMinutes()).slice(1,3)+(r===""?"":r+String(o.getMilliseconds()))}const css_key4del="/* SKYNovel */";function initStyle(){const n=document.getElementsByTagName("head")[0],e=n.children.length;for(let t=e-1;t>=0;--t){const r=n.children[t];r instanceof HTMLStyleElement&&r.innerText.startsWith(css_key4del)&&n.removeChild(r)}}function addStyle(n){const e=document.createElement("style");e.innerHTML=css_key4del+n,document.getElementsByTagName("head")[0].appendChild(e)}const EVNM_BUTTON="pointerdown",EVNM_CLICK="pointerdown",EVNM_KEY="keydown",RPN_COMP_CHIN="compChIn";function argChk_Num(n,e,t){const r=n[e];if(!(e in n)){if(isNaN(t))throw`[${n[":タグ名"]??""}]属性 ${e} は必須です`;return n[e]=t,t}const o=String(r).startsWith("0x")?parseInt(r):parseFloat(r);if(isNaN(o))throw`[${n[":タグ名"]??""}]属性 ${e} の値【${String(r)}】が数値ではありません`;return n[e]=o,o}function argChk_Boolean(n,e,t){if(!(e in n))return n[e]=t,t;const r=n[e];if(r===null)return!1;const o=String(r);return n[e]=o==="false"?!1:!!o}function parseColor(n){if(n.startsWith("#"))return parseInt(n.slice(1),16);const e=Number(n);if(!isNaN(e))return e;if(n==="black")return 0;CmnLib.cc4ColorName.fillStyle=n;const t=CmnLib.cc4ColorName.fillStyle;if(t==="#000000")throw`色名前 ${n} が異常です`;return parseInt(t.slice(1),16)}function argChk_Color(n,e,t){const r=n[e];return r?n[e]=parseColor(String(r)):(n[e]=t,t)}const REG_ERRMES_JSON=/JSON at position (\d+)$/;function mesErrJSON(n,e="",t=""){const r=(REG_ERRMES_JSON.exec(t)??["",""])[1];return`[${n[":タグ名"]??""}] ${e} 属性の解析エラー : ${t}
${String(n[e])}${r?`
${"^".padStart(Number(r))}`:""}`}const REG_FN=/^[^/.]+$|[^/]+(?=\.)/;function getFn(n){return(REG_FN.exec(n)??[""])[0]}class CmnLib{static async init(){const e=await __vitePreload(()=>import("./platform.js"),__vite__mapDeps([0,1])).then(t=>t.p);this.platform=JSON.stringify(e),this.plat_desc=e.description??"",this.isSafari=e.name==="Safari",this.isFirefox=e.name==="Firefox",this.isMac=(e.os?.family??"").includes("OS X"),this.isMobile=!/(Windows|OS X)/.test(e.os?.family??"")}static stageW=0;static stageH=0;static debugLog=!1;static platform;static plat_desc;static isSafari;static isFirefox;static isMac;static isMobile;static hDip={};static isDbg=!1;static isPackaged=!1;static needClick2Play(){return"AudioContext"in globalThis?(CmnLib.#t=new globalThis.AudioContext,CmnLib.needClick2Play=()=>CmnLib.#t.state==="suspended"):CmnLib.needClick2Play=()=>!1,CmnLib.needClick2Play()}static#t;static isDarkMode=!1;static cc4ColorName}function creSAVEDATA(){return{"sn.userFnTail":"","const.sn.autowc.enabled":!1,"const.sn.autowc.text":"","const.sn.autowc.time":0,"const.sn.mesLayer":"","const.sn.styPaging":"color: yellow; text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;","sn.doRecLog":!1,"const.sn.sLog":"[]","const.sn.loopPlaying":"{}","const.sn.scriptFn":"","const.sn.scriptIdx":0}}function creSYS_DATA(){return{"const.sn.cfg.ns":"","const.sn.aPageLog":"[]","const.sn.nativeWindow.x":0,"const.sn.nativeWindow.y":0,"const.sn.nativeWindow.w":CmnLib.stageW,"const.sn.nativeWindow.h":CmnLib.stageH,"const.sn.save.place":1,"const.sn.sound.BGM.volume":1,"const.sn.sound.SE.volume":1,"const.sn.sound.SYS.volume":1,"sn.auto.msecLineWait":500,"sn.auto.msecLineWait_Kidoku":500,"sn.auto.msecPageWait":3500,"sn.auto.msecPageWait_Kidoku":3500,"sn.skip.mode":"s","sn.sound.BGM.vol_mul_talking":1,"sn.sound.global_volume":(n,e)=>1,"sn.sound.movie_volume":(n,e)=>1,"sn.tagCh.canskip":!0,"sn.tagCh.doWait":!0,"sn.tagCh.doWait_Kidoku":!0,"sn.tagCh.msecWait":10,"sn.tagCh.msecWait_Kidoku":10,"TextLayer.Back.Alpha":.5}}function creTMP_DATA(){return{"const.Date.getDateStr":()=>getDateStr(),"const.Date.getTime":()=>new Date().getTime(),"const.sn.bookmark.json":"[]","const.sn.config.window.width":0,"const.sn.config.window.height":0,"const.sn.config.book.title":"","const.sn.config.book.version":"","const.sn.displayState":!1,"const.sn.isApp":!1,"const.sn.isDbg":!1,"const.sn.isPackaged":!1,"const.sn.isPaging":!1,"const.sn.isDarkMode":!1,"const.sn.isDebugger":!0,"const.sn.isFirstBoot":!0,"const.sn.isKidoku":!0,"const.sn.key.alternate":!1,"const.sn.key.back":!1,"const.sn.key.command":!1,"const.sn.key.control":!1,"const.sn.key.end":!1,"const.sn.key.escape":!1,"const.sn.last_page_plain_text":"","const.sn.last_page_text":"","const.sn.Math.PI":Math.PI,"const.sn.navigator.language":"jp","const.sn.needClick2Play":!1,"const.sn.platform":CmnLib.platform,"const.sn.screenResolutionX":screen.availWidth,"const.sn.screenResolutionY":screen.availHeight,"const.sn.sound.codecs":"","const.sn.aIfStk.length":1,"const.sn.vctCallStk.length":0,"sn.auto.enabled":!1,"sn.button.fontFamily":"'Hiragino Sans', 'Hiragino Kaku Gothic ProN', '游ゴシック Medium', meiryo, sans-serif","sn.eventArg":"","sn.eventLabel":"","sn.skip.all":!1,"sn.skip.enabled":!1,"sn.tagL.enabled":!0}}function finallyConstructor(n){var e=this.constructor;return this.then(function(t){return e.resolve(n()).then(function(){return t})},function(t){return e.resolve(n()).then(function(){return e.reject(t)})})}function allSettled(n){var e=this;return new e(function(t,r){if(!(n&&typeof n.length<"u"))return r(new TypeError(typeof n+" "+n+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(n);if(o.length===0)return t([]);var s=o.length;function a(h,l){if(l&&(typeof l=="object"||typeof l=="function")){var c=l.then;if(typeof c=="function"){c.call(l,function(_){a(h,_)},function(_){o[h]={status:"rejected",reason:_},--s===0&&t(o)});return}}o[h]={status:"fulfilled",value:l},--s===0&&t(o)}for(var u=0;u<o.length;u++)a(u,o[u])})}function AggregateError$1(n,e){this.name="AggregateError",this.errors=n,this.message=e||""}AggregateError$1.prototype=Error.prototype;function any(n){var e=this;return new e(function(t,r){if(!(n&&typeof n.length<"u"))return r(new TypeError("Promise.any accepts an array"));var o=Array.prototype.slice.call(n);if(o.length===0)return r();for(var s=[],a=0;a<o.length;a++)try{e.resolve(o[a]).then(t).catch(function(u){s.push(u),s.length===o.length&&r(new AggregateError$1(s,"All promises were rejected"))})}catch(u){r(u)}})}var setTimeoutFunc=setTimeout;function isArray(n){return!!(n&&typeof n.length<"u")}function noop(){}function bind(n,e){return function(){n.apply(e,arguments)}}function Promise$1(n){if(!(this instanceof Promise$1))throw new TypeError("Promises must be constructed via new");if(typeof n!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(n,this)}function handle(n,e){for(;n._state===3;)n=n._value;if(n._state===0){n._deferreds.push(e);return}n._handled=!0,Promise$1._immediateFn(function(){var t=n._state===1?e.onFulfilled:e.onRejected;if(t===null){(n._state===1?resolve:reject)(e.promise,n._value);return}var r;try{r=t(n._value)}catch(o){reject(e.promise,o);return}resolve(e.promise,r)})}function resolve(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e=="object"||typeof e=="function")){var t=e.then;if(e instanceof Promise$1){n._state=3,n._value=e,finale(n);return}else if(typeof t=="function"){doResolve(bind(t,e),n);return}}n._state=1,n._value=e,finale(n)}catch(r){reject(n,r)}}function reject(n,e){n._state=2,n._value=e,finale(n)}function finale(n){n._state===2&&n._deferreds.length===0&&Promise$1._immediateFn(function(){n._handled||Promise$1._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)handle(n,n._deferreds[e]);n._deferreds=null}function Handler(n,e,t){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.promise=t}function doResolve(n,e){var t=!1;try{n(function(r){t||(t=!0,resolve(e,r))},function(r){t||(t=!0,reject(e,r))})}catch(r){if(t)return;t=!0,reject(e,r)}}Promise$1.prototype.catch=function(n){return this.then(null,n)};Promise$1.prototype.then=function(n,e){var t=new this.constructor(noop);return handle(this,new Handler(n,e,t)),t};Promise$1.prototype.finally=finallyConstructor;Promise$1.all=function(n){return new Promise$1(function(e,t){if(!isArray(n))return t(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(n);if(r.length===0)return e([]);var o=r.length;function s(u,h){try{if(h&&(typeof h=="object"||typeof h=="function")){var l=h.then;if(typeof l=="function"){l.call(h,function(c){s(u,c)},t);return}}r[u]=h,--o===0&&e(r)}catch(c){t(c)}}for(var a=0;a<r.length;a++)s(a,r[a])})};Promise$1.any=any;Promise$1.allSettled=allSettled;Promise$1.resolve=function(n){return n&&typeof n=="object"&&n.constructor===Promise$1?n:new Promise$1(function(e){e(n)})};Promise$1.reject=function(n){return new Promise$1(function(e,t){t(n)})};Promise$1.race=function(n){return new Promise$1(function(e,t){if(!isArray(n))return t(new TypeError("Promise.race accepts an array"));for(var r=0,o=n.length;r<o;r++)Promise$1.resolve(n[r]).then(e,t)})};Promise$1._immediateFn=typeof setImmediate=="function"&&function(n){setImmediate(n)}||function(n){setTimeoutFunc(n,0)};Promise$1._unhandledRejectionFn=function(n){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",n)};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function getAugmentedNamespace(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),t}var objectAssign$1,hasRequiredObjectAssign;function requireObjectAssign(){if(hasRequiredObjectAssign)return objectAssign$1;hasRequiredObjectAssign=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function o(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var a={},u=0;u<10;u++)a["_"+String.fromCharCode(u)]=u;var h=Object.getOwnPropertyNames(a).map(function(c){return a[c]});if(h.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(c){l[c]=c}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return objectAssign$1=o()?Object.assign:function(s,a){for(var u,h=r(s),l,c=1;c<arguments.length;c++){u=Object(arguments[c]);for(var _ in u)e.call(u,_)&&(h[_]=u[_]);if(n){l=n(u);for(var d=0;d<l.length;d++)t.call(u,l[d])&&(h[l[d]]=u[l[d]])}}return h},objectAssign$1}var objectAssignExports=requireObjectAssign();const objectAssign=getDefaultExportFromCjs(objectAssignExports);typeof globalThis>"u"&&(typeof self<"u"?self.globalThis=self:typeof global<"u"&&(global.globalThis=global));globalThis.Promise||(globalThis.Promise=Promise$1);Object.assign||(Object.assign=objectAssign);var ONE_FRAME_TIME=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});if(!(globalThis.performance&&globalThis.performance.now)){var startTime_1=Date.now();globalThis.performance||(globalThis.performance={}),globalThis.performance.now=function(){return Date.now()-startTime_1}}var lastTime=Date.now(),vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!globalThis.requestAnimationFrame;++x){var p=vendors[x];globalThis.requestAnimationFrame=globalThis[p+"RequestAnimationFrame"],globalThis.cancelAnimationFrame=globalThis[p+"CancelAnimationFrame"]||globalThis[p+"CancelRequestAnimationFrame"]}globalThis.requestAnimationFrame||(globalThis.requestAnimationFrame=function(n){if(typeof n!="function")throw new TypeError(n+"is not a function");var e=Date.now(),t=ONE_FRAME_TIME+lastTime-e;return t<0&&(t=0),lastTime=e,globalThis.self.setTimeout(function(){lastTime=Date.now(),n(performance.now())},t)});globalThis.cancelAnimationFrame||(globalThis.cancelAnimationFrame=function(n){return clearTimeout(n)});Math.sign||(Math.sign=function(n){return n=Number(n),n===0||isNaN(n)?n:n>0?1:-1});Number.isInteger||(Number.isInteger=function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n});globalThis.ArrayBuffer||(globalThis.ArrayBuffer=Array);globalThis.Float32Array||(globalThis.Float32Array=Array);globalThis.Uint32Array||(globalThis.Uint32Array=Array);globalThis.Uint16Array||(globalThis.Uint16Array=Array);globalThis.Uint8Array||(globalThis.Uint8Array=Array);globalThis.Int32Array||(globalThis.Int32Array=Array);var ENV;(function(n){n[n.WEBGL_LEGACY=0]="WEBGL_LEGACY",n[n.WEBGL=1]="WEBGL",n[n.WEBGL2=2]="WEBGL2"})(ENV||(ENV={}));var RENDERER_TYPE;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.WEBGL=1]="WEBGL",n[n.CANVAS=2]="CANVAS"})(RENDERER_TYPE||(RENDERER_TYPE={}));var BUFFER_BITS;(function(n){n[n.COLOR=16384]="COLOR",n[n.DEPTH=256]="DEPTH",n[n.STENCIL=1024]="STENCIL"})(BUFFER_BITS||(BUFFER_BITS={}));var BLEND_MODES;(function(n){n[n.NORMAL=0]="NORMAL",n[n.ADD=1]="ADD",n[n.MULTIPLY=2]="MULTIPLY",n[n.SCREEN=3]="SCREEN",n[n.OVERLAY=4]="OVERLAY",n[n.DARKEN=5]="DARKEN",n[n.LIGHTEN=6]="LIGHTEN",n[n.COLOR_DODGE=7]="COLOR_DODGE",n[n.COLOR_BURN=8]="COLOR_BURN",n[n.HARD_LIGHT=9]="HARD_LIGHT",n[n.SOFT_LIGHT=10]="SOFT_LIGHT",n[n.DIFFERENCE=11]="DIFFERENCE",n[n.EXCLUSION=12]="EXCLUSION",n[n.HUE=13]="HUE",n[n.SATURATION=14]="SATURATION",n[n.COLOR=15]="COLOR",n[n.LUMINOSITY=16]="LUMINOSITY",n[n.NORMAL_NPM=17]="NORMAL_NPM",n[n.ADD_NPM=18]="ADD_NPM",n[n.SCREEN_NPM=19]="SCREEN_NPM",n[n.NONE=20]="NONE",n[n.SRC_OVER=0]="SRC_OVER",n[n.SRC_IN=21]="SRC_IN",n[n.SRC_OUT=22]="SRC_OUT",n[n.SRC_ATOP=23]="SRC_ATOP",n[n.DST_OVER=24]="DST_OVER",n[n.DST_IN=25]="DST_IN",n[n.DST_OUT=26]="DST_OUT",n[n.DST_ATOP=27]="DST_ATOP",n[n.ERASE=26]="ERASE",n[n.SUBTRACT=28]="SUBTRACT",n[n.XOR=29]="XOR"})(BLEND_MODES||(BLEND_MODES={}));var DRAW_MODES;(function(n){n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(DRAW_MODES||(DRAW_MODES={}));var FORMATS;(function(n){n[n.RGBA=6408]="RGBA",n[n.RGB=6407]="RGB",n[n.RG=33319]="RG",n[n.RED=6403]="RED",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.ALPHA=6406]="ALPHA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(FORMATS||(FORMATS={}));var TARGETS;(function(n){n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(TARGETS||(TARGETS={}));var TYPES;(function(n){n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.BYTE=5120]="BYTE",n[n.SHORT=5122]="SHORT",n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.HALF_FLOAT=36193]="HALF_FLOAT"})(TYPES||(TYPES={}));var SAMPLER_TYPES;(function(n){n[n.FLOAT=0]="FLOAT",n[n.INT=1]="INT",n[n.UINT=2]="UINT"})(SAMPLER_TYPES||(SAMPLER_TYPES={}));var SCALE_MODES;(function(n){n[n.NEAREST=0]="NEAREST",n[n.LINEAR=1]="LINEAR"})(SCALE_MODES||(SCALE_MODES={}));var WRAP_MODES;(function(n){n[n.CLAMP=33071]="CLAMP",n[n.REPEAT=10497]="REPEAT",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(WRAP_MODES||(WRAP_MODES={}));var MIPMAP_MODES;(function(n){n[n.OFF=0]="OFF",n[n.POW2=1]="POW2",n[n.ON=2]="ON",n[n.ON_MANUAL=3]="ON_MANUAL"})(MIPMAP_MODES||(MIPMAP_MODES={}));var ALPHA_MODES;(function(n){n[n.NPM=0]="NPM",n[n.UNPACK=1]="UNPACK",n[n.PMA=2]="PMA",n[n.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",n[n.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",n[n.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",n[n.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(ALPHA_MODES||(ALPHA_MODES={}));var CLEAR_MODES;(function(n){n[n.NO=0]="NO",n[n.YES=1]="YES",n[n.AUTO=2]="AUTO",n[n.BLEND=0]="BLEND",n[n.CLEAR=1]="CLEAR",n[n.BLIT=2]="BLIT"})(CLEAR_MODES||(CLEAR_MODES={}));var GC_MODES;(function(n){n[n.AUTO=0]="AUTO",n[n.MANUAL=1]="MANUAL"})(GC_MODES||(GC_MODES={}));var PRECISION;(function(n){n.LOW="lowp",n.MEDIUM="mediump",n.HIGH="highp"})(PRECISION||(PRECISION={}));var MASK_TYPES;(function(n){n[n.NONE=0]="NONE",n[n.SCISSOR=1]="SCISSOR",n[n.STENCIL=2]="STENCIL",n[n.SPRITE=3]="SPRITE",n[n.COLOR=4]="COLOR"})(MASK_TYPES||(MASK_TYPES={}));var COLOR_MASK_BITS;(function(n){n[n.RED=1]="RED",n[n.GREEN=2]="GREEN",n[n.BLUE=4]="BLUE",n[n.ALPHA=8]="ALPHA"})(COLOR_MASK_BITS||(COLOR_MASK_BITS={}));var MSAA_QUALITY;(function(n){n[n.NONE=0]="NONE",n[n.LOW=2]="LOW",n[n.MEDIUM=4]="MEDIUM",n[n.HIGH=8]="HIGH"})(MSAA_QUALITY||(MSAA_QUALITY={}));var BUFFER_TYPE;(function(n){n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(BUFFER_TYPE||(BUFFER_TYPE={}));var BrowserAdapter={createCanvas:function(n,e){var t=document.createElement("canvas");return t.width=n,t.height=e,t},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var n;return(n=document.baseURI)!==null&&n!==void 0?n:window.location.href},fetch:function(n,e){return fetch(n,e)}},appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(n){return typeof n<"u"&&n.platform==="MacIntel"&&typeof n.maxTouchPoints=="number"&&n.maxTouchPoints>1&&typeof MSStream>"u"};function createMatch(n){return function(e){return e.test(n)}}function isMobile$1(n){var e={userAgent:"",platform:"",maxTouchPoints:0};!n&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof n=="string"?e.userAgent=n:n&&n.userAgent&&(e={userAgent:n.userAgent,platform:n.platform,maxTouchPoints:n.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var o=createMatch(t),s={apple:{phone:o(appleIphone)&&!o(windowsPhone),ipod:o(appleIpod),tablet:!o(appleIphone)&&(o(appleTablet)||isAppleTabletOnIos13(e))&&!o(windowsPhone),universal:o(appleUniversal),device:(o(appleIphone)||o(appleIpod)||o(appleTablet)||o(appleUniversal)||isAppleTabletOnIos13(e))&&!o(windowsPhone)},amazon:{phone:o(amazonPhone),tablet:!o(amazonPhone)&&o(amazonTablet),device:o(amazonPhone)||o(amazonTablet)},android:{phone:!o(windowsPhone)&&o(amazonPhone)||!o(windowsPhone)&&o(androidPhone),tablet:!o(windowsPhone)&&!o(amazonPhone)&&!o(androidPhone)&&(o(amazonTablet)||o(androidTablet)),device:!o(windowsPhone)&&(o(amazonPhone)||o(amazonTablet)||o(androidPhone)||o(androidTablet))||o(/\bokhttp\b/i)},windows:{phone:o(windowsPhone),tablet:o(windowsTablet),device:o(windowsPhone)||o(windowsTablet)},other:{blackberry:o(otherBlackBerry),blackberry10:o(otherBlackBerry10),opera:o(otherOpera),firefox:o(otherFirefox),chrome:o(otherChrome),device:o(otherBlackBerry)||o(otherBlackBerry10)||o(otherOpera)||o(otherFirefox)||o(otherChrome)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var isMobile=isMobile$1(globalThis.navigator);function canUploadSameBuffer(){return!isMobile.apple.device}function maxRecommendedTextures(n){var e=!0;if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){var t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(t){var r=parseInt(t[1],10);r<11&&(e=!1)}}if(isMobile.android.device){var t=navigator.userAgent.match(/Android\s([0-9.]*)/);if(t){var r=parseInt(t[1],10);r<7&&(e=!1)}}}return e?n:4}var settings={ADAPTER:BrowserAdapter,MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:MSAA_QUALITY.NONE,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function o(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function s(h,l,c,_,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var y=new o(c,_||h,d),m=t?t+l:l;return h._events[m]?h._events[m].fn?h._events[m]=[h._events[m],y]:h._events[m].push(y):(h._events[m]=y,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var h=[],l,c;if(this._eventsCount===0)return h;for(c in l=this._events)e.call(l,c)&&h.push(t?c.slice(1):c);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(l)):h},u.prototype.listeners=function(h){var l=t?t+h:h,c=this._events[l];if(!c)return[];if(c.fn)return[c.fn];for(var _=0,d=c.length,y=new Array(d);_<d;_++)y[_]=c[_].fn;return y},u.prototype.listenerCount=function(h){var l=t?t+h:h,c=this._events[l];return c?c.fn?1:c.length:0},u.prototype.emit=function(h,l,c,_,d,y){var m=t?t+h:h;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,T,A;if(g.fn){switch(g.once&&this.removeListener(h,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,c),!0;case 4:return g.fn.call(g.context,l,c,_),!0;case 5:return g.fn.call(g.context,l,c,_,d),!0;case 6:return g.fn.call(g.context,l,c,_,d,y),!0}for(A=1,T=new Array(v-1);A<v;A++)T[A-1]=arguments[A];g.fn.apply(g.context,T)}else{var O=g.length,w;for(A=0;A<O;A++)switch(g[A].once&&this.removeListener(h,g[A].fn,void 0,!0),v){case 1:g[A].fn.call(g[A].context);break;case 2:g[A].fn.call(g[A].context,l);break;case 3:g[A].fn.call(g[A].context,l,c);break;case 4:g[A].fn.call(g[A].context,l,c,_);break;default:if(!T)for(w=1,T=new Array(v-1);w<v;w++)T[w-1]=arguments[w];g[A].fn.apply(g[A].context,T)}}return!0},u.prototype.on=function(h,l,c){return s(this,h,l,c,!1)},u.prototype.once=function(h,l,c){return s(this,h,l,c,!0)},u.prototype.removeListener=function(h,l,c,_){var d=t?t+h:h;if(!this._events[d])return this;if(!l)return a(this,d),this;var y=this._events[d];if(y.fn)y.fn===l&&(!_||y.once)&&(!c||y.context===c)&&a(this,d);else{for(var m=0,g=[],v=y.length;m<v;m++)(y[m].fn!==l||_&&!y[m].once||c&&y[m].context!==c)&&g.push(y[m]);g.length?this._events[d]=g.length===1?g[0]:g:a(this,d)}return this},u.prototype.removeAllListeners=function(h){var l;return h?(l=t?t+h:h,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,n.exports=u})(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const i=getDefaultExportFromCjs(eventemitter3Exports);var earcut$1={exports:{}},hasRequiredEarcut;function requireEarcut(){if(hasRequiredEarcut)return earcut$1.exports;hasRequiredEarcut=1,earcut$1.exports=n,earcut$1.exports.default=n;function n(S,M,R){R=R||2;var C=M&&M.length,D=C?M[0]*R:S.length,P=e(S,0,D,R,!0),B=[];if(!P||P.next===P.prev)return B;var L,Y,z,$,W,et,K;if(C&&(P=h(S,M,P,R)),S.length>80*R){L=z=S[0],Y=$=S[1];for(var V=R;V<D;V+=R)W=S[V],et=S[V+1],W<L&&(L=W),et<Y&&(Y=et),W>z&&(z=W),et>$&&($=et);K=Math.max(z-L,$-Y),K=K!==0?32767/K:0}return r(P,B,R,L,Y,K,0),B}function e(S,M,R,C,D){var P,B;if(D===q(S,M,R,C)>0)for(P=M;P<R;P+=C)B=H(P,S[P],S[P+1],B);else for(P=R-C;P>=M;P-=C)B=H(P,S[P],S[P+1],B);return B&&w(B,B.next)&&(Q(B),B=B.next),B}function t(S,M){if(!S)return S;M||(M=S);var R=S,C;do if(C=!1,!R.steiner&&(w(R,R.next)||O(R.prev,R,R.next)===0)){if(Q(R),R=M=R.prev,R===R.next)break;C=!0}else R=R.next;while(C||R!==M);return M}function r(S,M,R,C,D,P,B){if(S){!B&&P&&y(S,C,D,P);for(var L=S,Y,z;S.prev!==S.next;){if(Y=S.prev,z=S.next,P?s(S,C,D,P):o(S)){M.push(Y.i/R|0),M.push(S.i/R|0),M.push(z.i/R|0),Q(S),S=z.next,L=z.next;continue}if(S=z,S===L){B?B===1?(S=a(t(S),M,R),r(S,M,R,C,D,P,2)):B===2&&u(S,M,R,C,D,P):r(t(S),M,R,C,D,P,1);break}}}}function o(S){var M=S.prev,R=S,C=S.next;if(O(M,R,C)>=0)return!1;for(var D=M.x,P=R.x,B=C.x,L=M.y,Y=R.y,z=C.y,$=D<P?D<B?D:B:P<B?P:B,W=L<Y?L<z?L:z:Y<z?Y:z,et=D>P?D>B?D:B:P>B?P:B,K=L>Y?L>z?L:z:Y>z?Y:z,V=C.next;V!==M;){if(V.x>=$&&V.x<=et&&V.y>=W&&V.y<=K&&T(D,L,P,Y,B,z,V.x,V.y)&&O(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function s(S,M,R,C){var D=S.prev,P=S,B=S.next;if(O(D,P,B)>=0)return!1;for(var L=D.x,Y=P.x,z=B.x,$=D.y,W=P.y,et=B.y,K=L<Y?L<z?L:z:Y<z?Y:z,V=$<W?$<et?$:et:W<et?W:et,Z=L>Y?L>z?L:z:Y>z?Y:z,rt=$>W?$>et?$:et:W>et?W:et,st=g(K,V,M,R,C),it=g(Z,rt,M,R,C),J=S.prevZ,nt=S.nextZ;J&&J.z>=st&&nt&&nt.z<=it;){if(J.x>=K&&J.x<=Z&&J.y>=V&&J.y<=rt&&J!==D&&J!==B&&T(L,$,Y,W,z,et,J.x,J.y)&&O(J.prev,J,J.next)>=0||(J=J.prevZ,nt.x>=K&&nt.x<=Z&&nt.y>=V&&nt.y<=rt&&nt!==D&&nt!==B&&T(L,$,Y,W,z,et,nt.x,nt.y)&&O(nt.prev,nt,nt.next)>=0))return!1;nt=nt.nextZ}for(;J&&J.z>=st;){if(J.x>=K&&J.x<=Z&&J.y>=V&&J.y<=rt&&J!==D&&J!==B&&T(L,$,Y,W,z,et,J.x,J.y)&&O(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;nt&&nt.z<=it;){if(nt.x>=K&&nt.x<=Z&&nt.y>=V&&nt.y<=rt&&nt!==D&&nt!==B&&T(L,$,Y,W,z,et,nt.x,nt.y)&&O(nt.prev,nt,nt.next)>=0)return!1;nt=nt.nextZ}return!0}function a(S,M,R){var C=S;do{var D=C.prev,P=C.next.next;!w(D,P)&&E(D,C,C.next,P)&&N(D,P)&&N(P,D)&&(M.push(D.i/R|0),M.push(C.i/R|0),M.push(P.i/R|0),Q(C),Q(C.next),C=S=P),C=C.next}while(C!==S);return t(C)}function u(S,M,R,C,D,P){var B=S;do{for(var L=B.next.next;L!==B.prev;){if(B.i!==L.i&&A(B,L)){var Y=X(B,L);B=t(B,B.next),Y=t(Y,Y.next),r(B,M,R,C,D,P,0),r(Y,M,R,C,D,P,0);return}L=L.next}B=B.next}while(B!==S)}function h(S,M,R,C){var D=[],P,B,L,Y,z;for(P=0,B=M.length;P<B;P++)L=M[P]*C,Y=P<B-1?M[P+1]*C:S.length,z=e(S,L,Y,C,!1),z===z.next&&(z.steiner=!0),D.push(v(z));for(D.sort(l),P=0;P<D.length;P++)R=c(D[P],R);return R}function l(S,M){return S.x-M.x}function c(S,M){var R=_(S,M);if(!R)return M;var C=X(R,S);return t(C,C.next),t(R,R.next)}function _(S,M){var R=M,C=S.x,D=S.y,P=-1/0,B;do{if(D<=R.y&&D>=R.next.y&&R.next.y!==R.y){var L=R.x+(D-R.y)*(R.next.x-R.x)/(R.next.y-R.y);if(L<=C&&L>P&&(P=L,B=R.x<R.next.x?R:R.next,L===C))return B}R=R.next}while(R!==M);if(!B)return null;var Y=B,z=B.x,$=B.y,W=1/0,et;R=B;do C>=R.x&&R.x>=z&&C!==R.x&&T(D<$?C:P,D,z,$,D<$?P:C,D,R.x,R.y)&&(et=Math.abs(D-R.y)/(C-R.x),N(R,S)&&(et<W||et===W&&(R.x>B.x||R.x===B.x&&d(B,R)))&&(B=R,W=et)),R=R.next;while(R!==Y);return B}function d(S,M){return O(S.prev,S,M.prev)<0&&O(M.next,S,S.next)<0}function y(S,M,R,C){var D=S;do D.z===0&&(D.z=g(D.x,D.y,M,R,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==S);D.prevZ.nextZ=null,D.prevZ=null,m(D)}function m(S){var M,R,C,D,P,B,L,Y,z=1;do{for(R=S,S=null,P=null,B=0;R;){for(B++,C=R,L=0,M=0;M<z&&(L++,C=C.nextZ,!!C);M++);for(Y=z;L>0||Y>0&&C;)L!==0&&(Y===0||!C||R.z<=C.z)?(D=R,R=R.nextZ,L--):(D=C,C=C.nextZ,Y--),P?P.nextZ=D:S=D,D.prevZ=P,P=D;R=C}P.nextZ=null,z*=2}while(B>1);return S}function g(S,M,R,C,D){return S=(S-R)*D|0,M=(M-C)*D|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,M=(M|M<<8)&16711935,M=(M|M<<4)&252645135,M=(M|M<<2)&858993459,M=(M|M<<1)&1431655765,S|M<<1}function v(S){var M=S,R=S;do(M.x<R.x||M.x===R.x&&M.y<R.y)&&(R=M),M=M.next;while(M!==S);return R}function T(S,M,R,C,D,P,B,L){return(D-B)*(M-L)>=(S-B)*(P-L)&&(S-B)*(C-L)>=(R-B)*(M-L)&&(R-B)*(P-L)>=(D-B)*(C-L)}function A(S,M){return S.next.i!==M.i&&S.prev.i!==M.i&&!k(S,M)&&(N(S,M)&&N(M,S)&&G(S,M)&&(O(S.prev,S,M.prev)||O(S,M.prev,M))||w(S,M)&&O(S.prev,S,S.next)>0&&O(M.prev,M,M.next)>0)}function O(S,M,R){return(M.y-S.y)*(R.x-M.x)-(M.x-S.x)*(R.y-M.y)}function w(S,M){return S.x===M.x&&S.y===M.y}function E(S,M,R,C){var D=b(O(S,M,R)),P=b(O(S,M,C)),B=b(O(R,C,S)),L=b(O(R,C,M));return!!(D!==P&&B!==L||D===0&&I(S,R,M)||P===0&&I(S,C,M)||B===0&&I(R,S,C)||L===0&&I(R,M,C))}function I(S,M,R){return M.x<=Math.max(S.x,R.x)&&M.x>=Math.min(S.x,R.x)&&M.y<=Math.max(S.y,R.y)&&M.y>=Math.min(S.y,R.y)}function b(S){return S>0?1:S<0?-1:0}function k(S,M){var R=S;do{if(R.i!==S.i&&R.next.i!==S.i&&R.i!==M.i&&R.next.i!==M.i&&E(R,R.next,S,M))return!0;R=R.next}while(R!==S);return!1}function N(S,M){return O(S.prev,S,S.next)<0?O(S,M,S.next)>=0&&O(S,S.prev,M)>=0:O(S,M,S.prev)<0||O(S,S.next,M)<0}function G(S,M){var R=S,C=!1,D=(S.x+M.x)/2,P=(S.y+M.y)/2;do R.y>P!=R.next.y>P&&R.next.y!==R.y&&D<(R.next.x-R.x)*(P-R.y)/(R.next.y-R.y)+R.x&&(C=!C),R=R.next;while(R!==S);return C}function X(S,M){var R=new tt(S.i,S.x,S.y),C=new tt(M.i,M.x,M.y),D=S.next,P=M.prev;return S.next=M,M.prev=S,R.next=D,D.prev=R,C.next=R,R.prev=C,P.next=C,C.prev=P,C}function H(S,M,R,C){var D=new tt(S,M,R);return C?(D.next=C.next,D.prev=C,C.next.prev=D,C.next=D):(D.prev=D,D.next=D),D}function Q(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function tt(S,M,R){this.i=S,this.x=M,this.y=R,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(S,M,R,C){var D=M&&M.length,P=D?M[0]*R:S.length,B=Math.abs(q(S,0,P,R));if(D)for(var L=0,Y=M.length;L<Y;L++){var z=M[L]*R,$=L<Y-1?M[L+1]*R:S.length;B-=Math.abs(q(S,z,$,R))}var W=0;for(L=0;L<C.length;L+=3){var et=C[L]*R,K=C[L+1]*R,V=C[L+2]*R;W+=Math.abs((S[et]-S[V])*(S[K+1]-S[et+1])-(S[et]-S[K])*(S[V+1]-S[et+1]))}return B===0&&W===0?0:Math.abs((W-B)/B)};function q(S,M,R,C){for(var D=0,P=M,B=R-C;P<R;P+=C)D+=(S[B]-S[P])*(S[P+1]+S[B+1]),B=P;return D}return n.flatten=function(S){for(var M=S[0][0].length,R={vertices:[],holes:[],dimensions:M},C=0,D=0;D<S.length;D++){for(var P=0;P<S[D].length;P++)for(var B=0;B<M;B++)R.vertices.push(S[D][P][B]);D>0&&(C+=S[D-1].length,R.holes.push(C))}return R},earcut$1.exports}var earcutExports=requireEarcut();const earcut=getDefaultExportFromCjs(earcutExports);var url$2={},punycode$1={exports:{}},punycode=punycode$1.exports,hasRequiredPunycode;function requirePunycode(){return hasRequiredPunycode||(hasRequiredPunycode=1,(function(n,e){(function(t){var r=e&&!e.nodeType&&e,o=n&&!n.nodeType&&n,s=typeof commonjsGlobal=="object"&&commonjsGlobal;(s.global===s||s.window===s||s.self===s)&&(t=s);var a,u=2147483647,h=36,l=1,c=26,_=38,d=700,y=72,m=128,g="-",v=/^xn--/,T=/[^\x20-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,O={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=h-l,E=Math.floor,I=String.fromCharCode,b;function k(D){throw new RangeError(O[D])}function N(D,P){for(var B=D.length,L=[];B--;)L[B]=P(D[B]);return L}function G(D,P){var B=D.split("@"),L="";B.length>1&&(L=B[0]+"@",D=B[1]),D=D.replace(A,".");var Y=D.split("."),z=N(Y,P).join(".");return L+z}function X(D){for(var P=[],B=0,L=D.length,Y,z;B<L;)Y=D.charCodeAt(B++),Y>=55296&&Y<=56319&&B<L?(z=D.charCodeAt(B++),(z&64512)==56320?P.push(((Y&1023)<<10)+(z&1023)+65536):(P.push(Y),B--)):P.push(Y);return P}function H(D){return N(D,function(P){var B="";return P>65535&&(P-=65536,B+=I(P>>>10&1023|55296),P=56320|P&1023),B+=I(P),B}).join("")}function Q(D){return D-48<10?D-22:D-65<26?D-65:D-97<26?D-97:h}function tt(D,P){return D+22+75*(D<26)-((P!=0)<<5)}function q(D,P,B){var L=0;for(D=B?E(D/d):D>>1,D+=E(D/P);D>w*c>>1;L+=h)D=E(D/w);return E(L+(w+1)*D/(D+_))}function S(D){var P=[],B=D.length,L,Y=0,z=m,$=y,W,et,K,V,Z,rt,st,it,J;for(W=D.lastIndexOf(g),W<0&&(W=0),et=0;et<W;++et)D.charCodeAt(et)>=128&&k("not-basic"),P.push(D.charCodeAt(et));for(K=W>0?W+1:0;K<B;){for(V=Y,Z=1,rt=h;K>=B&&k("invalid-input"),st=Q(D.charCodeAt(K++)),(st>=h||st>E((u-Y)/Z))&&k("overflow"),Y+=st*Z,it=rt<=$?l:rt>=$+c?c:rt-$,!(st<it);rt+=h)J=h-it,Z>E(u/J)&&k("overflow"),Z*=J;L=P.length+1,$=q(Y-V,L,V==0),E(Y/L)>u-z&&k("overflow"),z+=E(Y/L),Y%=L,P.splice(Y++,0,z)}return H(P)}function M(D){var P,B,L,Y,z,$,W,et,K,V,Z,rt=[],st,it,J,nt;for(D=X(D),st=D.length,P=m,B=0,z=y,$=0;$<st;++$)Z=D[$],Z<128&&rt.push(I(Z));for(L=Y=rt.length,Y&&rt.push(g);L<st;){for(W=u,$=0;$<st;++$)Z=D[$],Z>=P&&Z<W&&(W=Z);for(it=L+1,W-P>E((u-B)/it)&&k("overflow"),B+=(W-P)*it,P=W,$=0;$<st;++$)if(Z=D[$],Z<P&&++B>u&&k("overflow"),Z==P){for(et=B,K=h;V=K<=z?l:K>=z+c?c:K-z,!(et<V);K+=h)nt=et-V,J=h-V,rt.push(I(tt(V+nt%J,0))),et=E(nt/J);rt.push(I(tt(et,0))),z=q(B,it,L==Y),B=0,++L}++B,++P}return rt.join("")}function R(D){return G(D,function(P){return v.test(P)?S(P.slice(4).toLowerCase()):P})}function C(D){return G(D,function(P){return T.test(P)?"xn--"+M(P):P})}if(a={version:"1.4.1",ucs2:{decode:X,encode:H},decode:S,encode:M,toASCII:C,toUnicode:R},r&&o)if(n.exports==r)o.exports=a;else for(b in a)a.hasOwnProperty(b)&&(r[b]=a[b]);else t.punycode=a})(punycode)})(punycode$1,punycode$1.exports)),punycode$1.exports}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var objectInspect,hasRequiredObjectInspect;function requireObjectInspect(){if(hasRequiredObjectInspect)return objectInspect;hasRequiredObjectInspect=1;var n=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=n&&e&&typeof e.get=="function"?e.get:null,r=n&&Map.prototype.forEach,o=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=o&&s&&typeof s.get=="function"?s.get:null,u=o&&Set.prototype.forEach,h=typeof WeakMap=="function"&&WeakMap.prototype,l=h?WeakMap.prototype.has:null,c=typeof WeakSet=="function"&&WeakSet.prototype,_=c?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,y=d?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,g=Object.prototype.toString,v=Function.prototype.toString,T=String.prototype.match,A=String.prototype.slice,O=String.prototype.replace,w=String.prototype.toUpperCase,E=String.prototype.toLowerCase,I=RegExp.prototype.test,b=Array.prototype.concat,k=Array.prototype.join,N=Array.prototype.slice,G=Math.floor,X=typeof BigInt=="function"?BigInt.prototype.valueOf:null,H=Object.getOwnPropertySymbols,Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,tt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",q=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===tt||!0)?Symbol.toStringTag:null,S=Object.prototype.propertyIsEnumerable,M=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(F){return F.__proto__}:null);function R(F,U){if(F===1/0||F===-1/0||F!==F||F&&F>-1e3&&F<1e3||I.call(/e/,U))return U;var ut=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof F=="number"){var lt=F<0?-G(-F):G(F);if(lt!==F){var ct=String(lt),at=A.call(U,ct.length+1);return O.call(ct,ut,"$&_")+"."+O.call(O.call(at,/([0-9]{3})/g,"$&_"),/_$/,"")}}return O.call(U,ut,"$&_")}var C=require$$0,D=C.custom,P=it(D)?D:null,B={__proto__:null,double:'"',single:"'"},L={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};objectInspect=function F(U,ut,lt,ct){var at=ut||{};if(ot(at,"quoteStyle")&&!ot(B,at.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ot(at,"maxStringLength")&&(typeof at.maxStringLength=="number"?at.maxStringLength<0&&at.maxStringLength!==1/0:at.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var vt=ot(at,"customInspect")?at.customInspect:!0;if(typeof vt!="boolean"&&vt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ot(at,"indent")&&at.indent!==null&&at.indent!=="	"&&!(parseInt(at.indent,10)===at.indent&&at.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ot(at,"numericSeparator")&&typeof at.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Et=at.numericSeparator;if(typeof U>"u")return"undefined";if(U===null)return"null";if(typeof U=="boolean")return U?"true":"false";if(typeof U=="string")return Ut(U,at);if(typeof U=="number"){if(U===0)return 1/0/U>0?"0":"-0";var dt=String(U);return Et?R(U,dt):dt}if(typeof U=="bigint"){var Tt=String(U)+"n";return Et?R(U,Tt):Tt}var wt=typeof at.depth>"u"?5:at.depth;if(typeof lt>"u"&&(lt=0),lt>=wt&&wt>0&&typeof U=="object")return W(U)?"[Array]":"[Object]";var bt=Qt(at,lt);if(typeof ct>"u")ct=[];else if(ft(ct,U)>=0)return"[Circular]";function _t(xt,It,ee){if(It&&(ct=N.call(ct),ct.push(It)),ee){var $t={depth:at.depth};return ot(at,"quoteStyle")&&($t.quoteStyle=at.quoteStyle),F(xt,$t,lt+1,ct)}return F(xt,at,lt+1,ct)}if(typeof U=="function"&&!K(U)){var jt=pt(U),Xt=Ot(U,_t);return"[Function"+(jt?": "+jt:" (anonymous)")+"]"+(Xt.length>0?" { "+k.call(Xt,", ")+" }":"")}if(it(U)){var Ht=tt?O.call(String(U),/^(Symbol\(.*\))_[^)]*$/,"$1"):Q.call(U);return typeof U=="object"&&!tt?St(Ht):Ht}if(Zt(U)){for(var At="<"+E.call(String(U.nodeName)),Ct=U.attributes||[],Mt=0;Mt<Ct.length;Mt++)At+=" "+Ct[Mt].name+"="+Y(z(Ct[Mt].value),"double",at);return At+=">",U.childNodes&&U.childNodes.length&&(At+="..."),At+="</"+E.call(String(U.nodeName))+">",At}if(W(U)){if(U.length===0)return"[]";var Nt=Ot(U,_t);return bt&&!Jt(Nt)?"["+Dt(Nt,bt)+"]":"[ "+k.call(Nt,", ")+" ]"}if(V(U)){var Lt=Ot(U,_t);return!("cause"in Error.prototype)&&"cause"in U&&!S.call(U,"cause")?"{ ["+String(U)+"] "+k.call(b.call("[cause]: "+_t(U.cause),Lt),", ")+" }":Lt.length===0?"["+String(U)+"]":"{ ["+String(U)+"] "+k.call(Lt,", ")+" }"}if(typeof U=="object"&&vt){if(P&&typeof U[P]=="function"&&C)return C(U,{depth:wt-lt});if(vt!=="symbol"&&typeof U.inspect=="function")return U.inspect()}if(gt(U)){var Yt=[];return r&&r.call(U,function(xt,It){Yt.push(_t(It,U,!0)+" => "+_t(xt,U))}),Gt("Map",t.call(U),Yt,bt)}if(Rt(U)){var zt=[];return u&&u.call(U,function(xt){zt.push(_t(xt,U))}),Gt("Set",a.call(U),zt,bt)}if(yt(U))return Pt("WeakMap");if(Wt(U))return Pt("WeakSet");if(mt(U))return Pt("WeakRef");if(rt(U))return St(_t(Number(U)));if(J(U))return St(_t(X.call(U)));if(st(U))return St(m.call(U));if(Z(U))return St(_t(String(U)));if(typeof window<"u"&&U===window)return"{ [object Window] }";if(typeof globalThis<"u"&&U===globalThis||typeof commonjsGlobal<"u"&&U===commonjsGlobal)return"{ [object globalThis] }";if(!et(U)&&!K(U)){var Ft=Ot(U,_t),qt=M?M(U)===Object.prototype:U instanceof Object||U.constructor===Object,Bt=U instanceof Object?"":"null prototype",Vt=!qt&&q&&Object(U)===U&&q in U?A.call(ht(U),8,-1):Bt?"Object":"",te=qt||typeof U.constructor!="function"?"":U.constructor.name?U.constructor.name+" ":"",kt=te+(Vt||Bt?"["+k.call(b.call([],Vt||[],Bt||[]),": ")+"] ":"");return Ft.length===0?kt+"{}":bt?kt+"{"+Dt(Ft,bt)+"}":kt+"{ "+k.call(Ft,", ")+" }"}return String(U)};function Y(F,U,ut){var lt=ut.quoteStyle||U,ct=B[lt];return ct+F+ct}function z(F){return O.call(String(F),/"/g,"&quot;")}function $(F){return!q||!(typeof F=="object"&&(q in F||typeof F[q]<"u"))}function W(F){return ht(F)==="[object Array]"&&$(F)}function et(F){return ht(F)==="[object Date]"&&$(F)}function K(F){return ht(F)==="[object RegExp]"&&$(F)}function V(F){return ht(F)==="[object Error]"&&$(F)}function Z(F){return ht(F)==="[object String]"&&$(F)}function rt(F){return ht(F)==="[object Number]"&&$(F)}function st(F){return ht(F)==="[object Boolean]"&&$(F)}function it(F){if(tt)return F&&typeof F=="object"&&F instanceof Symbol;if(typeof F=="symbol")return!0;if(!F||typeof F!="object"||!Q)return!1;try{return Q.call(F),!0}catch{}return!1}function J(F){if(!F||typeof F!="object"||!X)return!1;try{return X.call(F),!0}catch{}return!1}var nt=Object.prototype.hasOwnProperty||function(F){return F in this};function ot(F,U){return nt.call(F,U)}function ht(F){return g.call(F)}function pt(F){if(F.name)return F.name;var U=T.call(v.call(F),/^function\s*([\w$]+)/);return U?U[1]:null}function ft(F,U){if(F.indexOf)return F.indexOf(U);for(var ut=0,lt=F.length;ut<lt;ut++)if(F[ut]===U)return ut;return-1}function gt(F){if(!t||!F||typeof F!="object")return!1;try{t.call(F);try{a.call(F)}catch{return!0}return F instanceof Map}catch{}return!1}function yt(F){if(!l||!F||typeof F!="object")return!1;try{l.call(F,l);try{_.call(F,_)}catch{return!0}return F instanceof WeakMap}catch{}return!1}function mt(F){if(!y||!F||typeof F!="object")return!1;try{return y.call(F),!0}catch{}return!1}function Rt(F){if(!a||!F||typeof F!="object")return!1;try{a.call(F);try{t.call(F)}catch{return!0}return F instanceof Set}catch{}return!1}function Wt(F){if(!_||!F||typeof F!="object")return!1;try{_.call(F,_);try{l.call(F,l)}catch{return!0}return F instanceof WeakSet}catch{}return!1}function Zt(F){return!F||typeof F!="object"?!1:typeof HTMLElement<"u"&&F instanceof HTMLElement?!0:typeof F.nodeName=="string"&&typeof F.getAttribute=="function"}function Ut(F,U){if(F.length>U.maxStringLength){var ut=F.length-U.maxStringLength,lt="... "+ut+" more character"+(ut>1?"s":"");return Ut(A.call(F,0,U.maxStringLength),U)+lt}var ct=L[U.quoteStyle||"single"];ct.lastIndex=0;var at=O.call(O.call(F,ct,"\\$1"),/[\x00-\x1f]/g,Kt);return Y(at,"single",U)}function Kt(F){var U=F.charCodeAt(0),ut={8:"b",9:"t",10:"n",12:"f",13:"r"}[U];return ut?"\\"+ut:"\\x"+(U<16?"0":"")+w.call(U.toString(16))}function St(F){return"Object("+F+")"}function Pt(F){return F+" { ? }"}function Gt(F,U,ut,lt){var ct=lt?Dt(ut,lt):k.call(ut,", ");return F+" ("+U+") {"+ct+"}"}function Jt(F){for(var U=0;U<F.length;U++)if(ft(F[U],`
`)>=0)return!1;return!0}function Qt(F,U){var ut;if(F.indent==="	")ut="	";else if(typeof F.indent=="number"&&F.indent>0)ut=k.call(Array(F.indent+1)," ");else return null;return{base:ut,prev:k.call(Array(U+1),ut)}}function Dt(F,U){if(F.length===0)return"";var ut=`
`+U.prev+U.base;return ut+k.call(F,","+ut)+`
`+U.prev}function Ot(F,U){var ut=W(F),lt=[];if(ut){lt.length=F.length;for(var ct=0;ct<F.length;ct++)lt[ct]=ot(F,ct)?U(F[ct],F):""}var at=typeof H=="function"?H(F):[],vt;if(tt){vt={};for(var Et=0;Et<at.length;Et++)vt["$"+at[Et]]=at[Et]}for(var dt in F)ot(F,dt)&&(ut&&String(Number(dt))===dt&&dt<F.length||tt&&vt["$"+dt]instanceof Symbol||(I.call(/[^\w$]/,dt)?lt.push(U(dt,F)+": "+U(F[dt],F)):lt.push(dt+": "+U(F[dt],F))));if(typeof H=="function")for(var Tt=0;Tt<at.length;Tt++)S.call(F,at[Tt])&&lt.push("["+U(at[Tt])+"]: "+U(F[at[Tt]],F));return lt}return objectInspect}var sideChannelList,hasRequiredSideChannelList;function requireSideChannelList(){if(hasRequiredSideChannelList)return sideChannelList;hasRequiredSideChannelList=1;var n=requireObjectInspect(),e=requireType(),t=function(u,h,l){for(var c=u,_;(_=c.next)!=null;c=_)if(_.key===h)return c.next=_.next,l||(_.next=u.next,u.next=_),_},r=function(u,h){if(u){var l=t(u,h);return l&&l.value}},o=function(u,h,l){var c=t(u,h);c?c.value=l:u.next={key:h,next:u.next,value:l}},s=function(u,h){return u?!!t(u,h):!1},a=function(u,h){if(u)return t(u,h,!0)};return sideChannelList=function(){var u,h={assert:function(l){if(!h.has(l))throw new e("Side channel does not contain "+n(l))},delete:function(l){var c=u&&u.next,_=a(u,l);return _&&c&&c===_&&(u=void 0),!!_},get:function(l){return r(u,l)},has:function(l){return s(u,l)},set:function(l,c){u||(u={next:void 0}),o(u,l,c)}};return h},sideChannelList}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round$1,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round$1=Math.round),round$1}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(n){return n!==n}),_isNaN}var sign$1,hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign$1;hasRequiredSign=1;var n=require_isNaN();return sign$1=function(e){return n(e)||e===0?e:e<0?-1:1},sign$1}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var n=requireGOPD();if(n)try{n([],"length")}catch{n=null}return gopd=n,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return esDefineProperty=n,esDefineProperty}var shams,hasRequiredShams;function requireShams(){return hasRequiredShams||(hasRequiredShams=1,shams=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var n={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var r=42;n[e]=r;for(var o in n)return!1;if(typeof Object.keys=="function"&&Object.keys(n).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(n).length!==0)return!1;var s=Object.getOwnPropertySymbols(n);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(n,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(n,e);if(a.value!==r||a.enumerable!==!0)return!1}return!0}),shams}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var n=typeof Symbol<"u"&&Symbol,e=requireShams();return hasSymbols=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var n=requireEsObjectAtoms();return Object_getPrototypeOf=n.getPrototypeOf||null,Object_getPrototypeOf}var implementation,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation;hasRequiredImplementation=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",o=function(u,h){for(var l=[],c=0;c<u.length;c+=1)l[c]=u[c];for(var _=0;_<h.length;_+=1)l[_+u.length]=h[_];return l},s=function(u,h){for(var l=[],c=h,_=0;c<u.length;c+=1,_+=1)l[_]=u[c];return l},a=function(u,h){for(var l="",c=0;c<u.length;c+=1)l+=u[c],c+1<u.length&&(l+=h);return l};return implementation=function(u){var h=this;if(typeof h!="function"||e.apply(h)!==r)throw new TypeError(n+h);for(var l=s(arguments,1),c,_=function(){if(this instanceof c){var v=h.apply(this,o(l,arguments));return Object(v)===v?v:this}return h.apply(u,o(l,arguments))},d=t(0,h.length-l.length),y=[],m=0;m<d;m++)y[m]="$"+m;if(c=Function("binder","return function ("+a(y,",")+"){ return binder.apply(this,arguments); }")(_),h.prototype){var g=function(){};g.prototype=h.prototype,c.prototype=new g,g.prototype=null}return c},implementation}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var n=requireImplementation();return functionBind=Function.prototype.bind||n,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var n=requireFunctionBind(),e=requireFunctionApply(),t=requireFunctionCall(),r=requireReflectApply();return actualApply=r||n.call(t,e),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var n=requireFunctionBind(),e=requireType(),t=requireFunctionCall(),r=requireActualApply();return callBindApplyHelpers=function(o){if(o.length<1||typeof o[0]!="function")throw new e("a function is required");return r(n,t,o)},callBindApplyHelpers}var get,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get;hasRequiredGet=1;var n=requireCallBindApplyHelpers(),e=requireGopd(),t;try{t=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!t&&e&&e(Object.prototype,"__proto__"),o=Object,s=o.getPrototypeOf;return get=r&&typeof r.get=="function"?n([r.get]):typeof s=="function"?(function(a){return s(a==null?a:o(a))}):!1,get}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var n=requireReflect_getPrototypeOf(),e=requireObject_getPrototypeOf(),t=requireGet();return getProto=n?function(r){return n(r)}:e?function(r){if(!r||typeof r!="object"&&typeof r!="function")throw new TypeError("getProto: not an object");return e(r)}:t?function(r){return t(r)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=requireFunctionBind();return hasown=t.call(n,e),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var n,e=requireEsObjectAtoms(),t=requireEsErrors(),r=require_eval(),o=requireRange(),s=requireRef(),a=requireSyntax(),u=requireType(),h=requireUri(),l=requireAbs(),c=requireFloor(),_=requireMax(),d=requireMin(),y=requirePow(),m=requireRound(),g=requireSign(),v=Function,T=function(K){try{return v('"use strict"; return ('+K+").constructor;")()}catch{}},A=requireGopd(),O=requireEsDefineProperty(),w=function(){throw new u},E=A?(function(){try{return arguments.callee,w}catch{try{return A(arguments,"callee").get}catch{return w}}})():w,I=requireHasSymbols()(),b=requireGetProto(),k=requireObject_getPrototypeOf(),N=requireReflect_getPrototypeOf(),G=requireFunctionApply(),X=requireFunctionCall(),H={},Q=typeof Uint8Array>"u"||!b?n:b(Uint8Array),tt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":I&&b?b([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":H,"%AsyncGenerator%":H,"%AsyncGeneratorFunction%":H,"%AsyncIteratorPrototype%":H,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":H,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":I&&b?b(b([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!I||!b?n:b(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":A,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":o,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!I||!b?n:b(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":I&&b?b(""[Symbol.iterator]()):n,"%Symbol%":I?Symbol:n,"%SyntaxError%":a,"%ThrowTypeError%":E,"%TypedArray%":Q,"%TypeError%":u,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":X,"%Function.prototype.apply%":G,"%Object.defineProperty%":O,"%Object.getPrototypeOf%":k,"%Math.abs%":l,"%Math.floor%":c,"%Math.max%":_,"%Math.min%":d,"%Math.pow%":y,"%Math.round%":m,"%Math.sign%":g,"%Reflect.getPrototypeOf%":N};if(b)try{null.error}catch(K){var q=b(b(K));tt["%Error.prototype%"]=q}var S=function K(V){var Z;if(V==="%AsyncFunction%")Z=T("async function () {}");else if(V==="%GeneratorFunction%")Z=T("function* () {}");else if(V==="%AsyncGeneratorFunction%")Z=T("async function* () {}");else if(V==="%AsyncGenerator%"){var rt=K("%AsyncGeneratorFunction%");rt&&(Z=rt.prototype)}else if(V==="%AsyncIteratorPrototype%"){var st=K("%AsyncGenerator%");st&&b&&(Z=b(st.prototype))}return tt[V]=Z,Z},M={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},R=requireFunctionBind(),C=requireHasown(),D=R.call(X,Array.prototype.concat),P=R.call(G,Array.prototype.splice),B=R.call(X,String.prototype.replace),L=R.call(X,String.prototype.slice),Y=R.call(X,RegExp.prototype.exec),z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,$=/\\(\\)?/g,W=function(K){var V=L(K,0,1),Z=L(K,-1);if(V==="%"&&Z!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(Z==="%"&&V!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var rt=[];return B(K,z,function(st,it,J,nt){rt[rt.length]=J?B(nt,$,"$1"):it||st}),rt},et=function(K,V){var Z=K,rt;if(C(M,Z)&&(rt=M[Z],Z="%"+rt[0]+"%"),C(tt,Z)){var st=tt[Z];if(st===H&&(st=S(Z)),typeof st>"u"&&!V)throw new u("intrinsic "+K+" exists, but is not available. Please file an issue!");return{alias:rt,name:Z,value:st}}throw new a("intrinsic "+K+" does not exist!")};return getIntrinsic=function(K,V){if(typeof K!="string"||K.length===0)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof V!="boolean")throw new u('"allowMissing" argument must be a boolean');if(Y(/^%?[^%]*%?$/,K)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Z=W(K),rt=Z.length>0?Z[0]:"",st=et("%"+rt+"%",V),it=st.name,J=st.value,nt=!1,ot=st.alias;ot&&(rt=ot[0],P(Z,D([0,1],ot)));for(var ht=1,pt=!0;ht<Z.length;ht+=1){var ft=Z[ht],gt=L(ft,0,1),yt=L(ft,-1);if((gt==='"'||gt==="'"||gt==="`"||yt==='"'||yt==="'"||yt==="`")&&gt!==yt)throw new a("property names with quotes must have matching quotes");if((ft==="constructor"||!pt)&&(nt=!0),rt+="."+ft,it="%"+rt+"%",C(tt,it))J=tt[it];else if(J!=null){if(!(ft in J)){if(!V)throw new u("base intrinsic for "+K+" exists, but the property is not available.");return}if(A&&ht+1>=Z.length){var mt=A(J,ft);pt=!!mt,pt&&"get"in mt&&!("originalValue"in mt.get)?J=mt.get:J=J[ft]}else pt=C(J,ft),J=J[ft];pt&&!nt&&(tt[it]=J)}}return J},getIntrinsic}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var n=requireGetIntrinsic(),e=requireCallBindApplyHelpers(),t=e([n("%String.prototype.indexOf%")]);return callBound=function(r,o){var s=n(r,!!o);return typeof s=="function"&&t(r,".prototype.")>-1?e([s]):s},callBound}var sideChannelMap,hasRequiredSideChannelMap;function requireSideChannelMap(){if(hasRequiredSideChannelMap)return sideChannelMap;hasRequiredSideChannelMap=1;var n=requireGetIntrinsic(),e=requireCallBound(),t=requireObjectInspect(),r=requireType(),o=n("%Map%",!0),s=e("Map.prototype.get",!0),a=e("Map.prototype.set",!0),u=e("Map.prototype.has",!0),h=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return sideChannelMap=!!o&&function(){var c,_={assert:function(d){if(!_.has(d))throw new r("Side channel does not contain "+t(d))},delete:function(d){if(c){var y=h(c,d);return l(c)===0&&(c=void 0),y}return!1},get:function(d){if(c)return s(c,d)},has:function(d){return c?u(c,d):!1},set:function(d,y){c||(c=new o),a(c,d,y)}};return _},sideChannelMap}var sideChannelWeakmap,hasRequiredSideChannelWeakmap;function requireSideChannelWeakmap(){if(hasRequiredSideChannelWeakmap)return sideChannelWeakmap;hasRequiredSideChannelWeakmap=1;var n=requireGetIntrinsic(),e=requireCallBound(),t=requireObjectInspect(),r=requireSideChannelMap(),o=requireType(),s=n("%WeakMap%",!0),a=e("WeakMap.prototype.get",!0),u=e("WeakMap.prototype.set",!0),h=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return sideChannelWeakmap=s?(function(){var c,_,d={assert:function(y){if(!d.has(y))throw new o("Side channel does not contain "+t(y))},delete:function(y){if(s&&y&&(typeof y=="object"||typeof y=="function")){if(c)return l(c,y)}else if(r&&_)return _.delete(y);return!1},get:function(y){return s&&y&&(typeof y=="object"||typeof y=="function")&&c?a(c,y):_&&_.get(y)},has:function(y){return s&&y&&(typeof y=="object"||typeof y=="function")&&c?h(c,y):!!_&&_.has(y)},set:function(y,m){s&&y&&(typeof y=="object"||typeof y=="function")?(c||(c=new s),u(c,y,m)):r&&(_||(_=r()),_.set(y,m))}};return d}):r,sideChannelWeakmap}var sideChannel,hasRequiredSideChannel;function requireSideChannel(){if(hasRequiredSideChannel)return sideChannel;hasRequiredSideChannel=1;var n=requireType(),e=requireObjectInspect(),t=requireSideChannelList(),r=requireSideChannelMap(),o=requireSideChannelWeakmap(),s=o||r||t;return sideChannel=function(){var a,u={assert:function(h){if(!u.has(h))throw new n("Side channel does not contain "+e(h))},delete:function(h){return!!a&&a.delete(h)},get:function(h){return a&&a.get(h)},has:function(h){return!!a&&a.has(h)},set:function(h,l){a||(a=s()),a.set(h,l)}};return u},sideChannel}var formats$1,hasRequiredFormats;function requireFormats(){if(hasRequiredFormats)return formats$1;hasRequiredFormats=1;var n=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return formats$1={default:t.RFC3986,formatters:{RFC1738:function(r){return n.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},formats$1}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;var n=requireFormats(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=(function(){for(var v=[],T=0;T<256;++T)v.push("%"+((T<16?"0":"")+T.toString(16)).toUpperCase());return v})(),o=function(v){for(;v.length>1;){var T=v.pop(),A=T.obj[T.prop];if(t(A)){for(var O=[],w=0;w<A.length;++w)typeof A[w]<"u"&&O.push(A[w]);T.obj[T.prop]=O}}},s=function(v,T){for(var A=T&&T.plainObjects?{__proto__:null}:{},O=0;O<v.length;++O)typeof v[O]<"u"&&(A[O]=v[O]);return A},a=function v(T,A,O){if(!A)return T;if(typeof A!="object"&&typeof A!="function"){if(t(T))T.push(A);else if(T&&typeof T=="object")(O&&(O.plainObjects||O.allowPrototypes)||!e.call(Object.prototype,A))&&(T[A]=!0);else return[T,A];return T}if(!T||typeof T!="object")return[T].concat(A);var w=T;return t(T)&&!t(A)&&(w=s(T,O)),t(T)&&t(A)?(A.forEach(function(E,I){if(e.call(T,I)){var b=T[I];b&&typeof b=="object"&&E&&typeof E=="object"?T[I]=v(b,E,O):T.push(E)}else T[I]=E}),T):Object.keys(A).reduce(function(E,I){var b=A[I];return e.call(E,I)?E[I]=v(E[I],b,O):E[I]=b,E},w)},u=function(v,T){return Object.keys(T).reduce(function(A,O){return A[O]=T[O],A},v)},h=function(v,T,A){var O=v.replace(/\+/g," ");if(A==="iso-8859-1")return O.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(O)}catch{return O}},l=1024,c=function(v,T,A,O,w){if(v.length===0)return v;var E=v;if(typeof v=="symbol"?E=Symbol.prototype.toString.call(v):typeof v!="string"&&(E=String(v)),A==="iso-8859-1")return escape(E).replace(/%u[0-9a-f]{4}/gi,function(H){return"%26%23"+parseInt(H.slice(2),16)+"%3B"});for(var I="",b=0;b<E.length;b+=l){for(var k=E.length>=l?E.slice(b,b+l):E,N=[],G=0;G<k.length;++G){var X=k.charCodeAt(G);if(X===45||X===46||X===95||X===126||X>=48&&X<=57||X>=65&&X<=90||X>=97&&X<=122||w===n.RFC1738&&(X===40||X===41)){N[N.length]=k.charAt(G);continue}if(X<128){N[N.length]=r[X];continue}if(X<2048){N[N.length]=r[192|X>>6]+r[128|X&63];continue}if(X<55296||X>=57344){N[N.length]=r[224|X>>12]+r[128|X>>6&63]+r[128|X&63];continue}G+=1,X=65536+((X&1023)<<10|k.charCodeAt(G)&1023),N[N.length]=r[240|X>>18]+r[128|X>>12&63]+r[128|X>>6&63]+r[128|X&63]}I+=N.join("")}return I},_=function(v){for(var T=[{obj:{o:v},prop:"o"}],A=[],O=0;O<T.length;++O)for(var w=T[O],E=w.obj[w.prop],I=Object.keys(E),b=0;b<I.length;++b){var k=I[b],N=E[k];typeof N=="object"&&N!==null&&A.indexOf(N)===-1&&(T.push({obj:E,prop:k}),A.push(N))}return o(T),v},d=function(v){return Object.prototype.toString.call(v)==="[object RegExp]"},y=function(v){return!v||typeof v!="object"?!1:!!(v.constructor&&v.constructor.isBuffer&&v.constructor.isBuffer(v))},m=function(v,T){return[].concat(v,T)},g=function(v,T){if(t(v)){for(var A=[],O=0;O<v.length;O+=1)A.push(T(v[O]));return A}return T(v)};return utils={arrayToObject:s,assign:u,combine:m,compact:_,decode:h,encode:c,isBuffer:y,isRegExp:d,maybeMap:g,merge:a},utils}var stringify_1,hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify_1;hasRequiredStringify=1;var n=requireSideChannel(),e=requireUtils(),t=requireFormats(),r=Object.prototype.hasOwnProperty,o={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,v){return g+"["+v+"]"},repeat:function(g){return g}},s=Array.isArray,a=Array.prototype.push,u=function(g,v){a.apply(g,s(v)?v:[v])},h=Date.prototype.toISOString,l=t.default,c={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:t.formatters[l],indices:!1,serializeDate:function(g){return h.call(g)},skipNulls:!1,strictNullHandling:!1},_=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},y=function g(v,T,A,O,w,E,I,b,k,N,G,X,H,Q,tt,q,S,M){for(var R=v,C=M,D=0,P=!1;(C=C.get(d))!==void 0&&!P;){var B=C.get(v);if(D+=1,typeof B<"u"){if(B===D)throw new RangeError("Cyclic object value");P=!0}typeof C.get(d)>"u"&&(D=0)}if(typeof N=="function"?R=N(T,R):R instanceof Date?R=H(R):A==="comma"&&s(R)&&(R=e.maybeMap(R,function(J){return J instanceof Date?H(J):J})),R===null){if(E)return k&&!q?k(T,c.encoder,S,"key",Q):T;R=""}if(_(R)||e.isBuffer(R)){if(k){var L=q?T:k(T,c.encoder,S,"key",Q);return[tt(L)+"="+tt(k(R,c.encoder,S,"value",Q))]}return[tt(T)+"="+tt(String(R))]}var Y=[];if(typeof R>"u")return Y;var z;if(A==="comma"&&s(R))q&&k&&(R=e.maybeMap(R,k)),z=[{value:R.length>0?R.join(",")||null:void 0}];else if(s(N))z=N;else{var $=Object.keys(R);z=G?$.sort(G):$}var W=b?String(T).replace(/\./g,"%2E"):String(T),et=O&&s(R)&&R.length===1?W+"[]":W;if(w&&s(R)&&R.length===0)return et+"[]";for(var K=0;K<z.length;++K){var V=z[K],Z=typeof V=="object"&&V&&typeof V.value<"u"?V.value:R[V];if(!(I&&Z===null)){var rt=X&&b?String(V).replace(/\./g,"%2E"):String(V),st=s(R)?typeof A=="function"?A(et,rt):et:et+(X?"."+rt:"["+rt+"]");M.set(v,D);var it=n();it.set(d,M),u(Y,g(Z,st,A,O,w,E,I,b,A==="comma"&&q&&s(R)?null:k,N,G,X,H,Q,tt,q,S,it))}}return Y},m=function(g){if(!g)return c;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var v=g.charset||c.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var T=t.default;if(typeof g.format<"u"){if(!r.call(t.formatters,g.format))throw new TypeError("Unknown format option provided.");T=g.format}var A=t.formatters[T],O=c.filter;(typeof g.filter=="function"||s(g.filter))&&(O=g.filter);var w;if(g.arrayFormat in o?w=g.arrayFormat:"indices"in g?w=g.indices?"indices":"repeat":w=c.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var E=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:c.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:c.addQueryPrefix,allowDots:E,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:c.allowEmptyArrays,arrayFormat:w,charset:v,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:c.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?c.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:c.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:c.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:c.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:c.encodeValuesOnly,filter:O,format:T,formatter:A,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:c.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:c.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:c.strictNullHandling}};return stringify_1=function(g,v){var T=g,A=m(v),O,w;typeof A.filter=="function"?(w=A.filter,T=w("",T)):s(A.filter)&&(w=A.filter,O=w);var E=[];if(typeof T!="object"||T===null)return"";var I=o[A.arrayFormat],b=I==="comma"&&A.commaRoundTrip;O||(O=Object.keys(T)),A.sort&&O.sort(A.sort);for(var k=n(),N=0;N<O.length;++N){var G=O[N],X=T[G];A.skipNulls&&X===null||u(E,y(X,G,I,b,A.allowEmptyArrays,A.strictNullHandling,A.skipNulls,A.encodeDotInKeys,A.encode?A.encoder:null,A.filter,A.sort,A.allowDots,A.serializeDate,A.format,A.formatter,A.encodeValuesOnly,A.charset,k))}var H=E.join(A.delimiter),Q=A.addQueryPrefix===!0?"?":"";return A.charsetSentinel&&(A.charset==="iso-8859-1"?Q+="utf8=%26%2310003%3B&":Q+="utf8=%E2%9C%93&"),H.length>0?Q+H:""},stringify_1}var parse$1,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse$1;hasRequiredParse=1;var n=requireUtils(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},o=function(d){return d.replace(/&#(\d+);/g,function(y,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,y,m){if(d&&typeof d=="string"&&y.comma&&d.indexOf(",")>-1)return d.split(",");if(y.throwOnLimitExceeded&&m>=y.arrayLimit)throw new RangeError("Array limit exceeded. Only "+y.arrayLimit+" element"+(y.arrayLimit===1?"":"s")+" allowed in an array.");return d},a="utf8=%26%2310003%3B",u="utf8=%E2%9C%93",h=function(d,y){var m={__proto__:null},g=y.ignoreQueryPrefix?d.replace(/^\?/,""):d;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var v=y.parameterLimit===1/0?void 0:y.parameterLimit,T=g.split(y.delimiter,y.throwOnLimitExceeded?v+1:v);if(y.throwOnLimitExceeded&&T.length>v)throw new RangeError("Parameter limit exceeded. Only "+v+" parameter"+(v===1?"":"s")+" allowed.");var A=-1,O,w=y.charset;if(y.charsetSentinel)for(O=0;O<T.length;++O)T[O].indexOf("utf8=")===0&&(T[O]===u?w="utf-8":T[O]===a&&(w="iso-8859-1"),A=O,O=T.length);for(O=0;O<T.length;++O)if(O!==A){var E=T[O],I=E.indexOf("]="),b=I===-1?E.indexOf("="):I+1,k,N;b===-1?(k=y.decoder(E,r.decoder,w,"key"),N=y.strictNullHandling?null:""):(k=y.decoder(E.slice(0,b),r.decoder,w,"key"),N=n.maybeMap(s(E.slice(b+1),y,t(m[k])?m[k].length:0),function(X){return y.decoder(X,r.decoder,w,"value")})),N&&y.interpretNumericEntities&&w==="iso-8859-1"&&(N=o(String(N))),E.indexOf("[]=")>-1&&(N=t(N)?[N]:N);var G=e.call(m,k);G&&y.duplicates==="combine"?m[k]=n.combine(m[k],N):(!G||y.duplicates==="last")&&(m[k]=N)}return m},l=function(d,y,m,g){var v=0;if(d.length>0&&d[d.length-1]==="[]"){var T=d.slice(0,-1).join("");v=Array.isArray(y)&&y[T]?y[T].length:0}for(var A=g?y:s(y,m,v),O=d.length-1;O>=0;--O){var w,E=d[O];if(E==="[]"&&m.parseArrays)w=m.allowEmptyArrays&&(A===""||m.strictNullHandling&&A===null)?[]:n.combine([],A);else{w=m.plainObjects?{__proto__:null}:{};var I=E.charAt(0)==="["&&E.charAt(E.length-1)==="]"?E.slice(1,-1):E,b=m.decodeDotInKeys?I.replace(/%2E/g,"."):I,k=parseInt(b,10);!m.parseArrays&&b===""?w={0:A}:!isNaN(k)&&E!==b&&String(k)===b&&k>=0&&m.parseArrays&&k<=m.arrayLimit?(w=[],w[k]=A):b!=="__proto__"&&(w[b]=A)}A=w}return A},c=function(d,y,m,g){if(d){var v=m.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,T=/(\[[^[\]]*])/,A=/(\[[^[\]]*])/g,O=m.depth>0&&T.exec(v),w=O?v.slice(0,O.index):v,E=[];if(w){if(!m.plainObjects&&e.call(Object.prototype,w)&&!m.allowPrototypes)return;E.push(w)}for(var I=0;m.depth>0&&(O=A.exec(v))!==null&&I<m.depth;){if(I+=1,!m.plainObjects&&e.call(Object.prototype,O[1].slice(1,-1))&&!m.allowPrototypes)return;E.push(O[1])}if(O){if(m.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+m.depth+" and strictDepth is true");E.push("["+v.slice(O.index)+"]")}return l(E,y,m,g)}},_=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof d.throwOnLimitExceeded<"u"&&typeof d.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var y=typeof d.charset>"u"?r.charset:d.charset,m=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(m!=="combine"&&m!=="first"&&m!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:g,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:y,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||n.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:m,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof d.throwOnLimitExceeded=="boolean"?d.throwOnLimitExceeded:!1}};return parse$1=function(d,y){var m=_(y);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var g=typeof d=="string"?h(d,m):d,v=m.plainObjects?{__proto__:null}:{},T=Object.keys(g),A=0;A<T.length;++A){var O=T[A],w=c(O,g[O],m,typeof d=="string");v=n.merge(v,w,m)}return m.allowSparse===!0?v:n.compact(v)},parse$1}var lib,hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var n=requireStringify(),e=requireParse(),t=requireFormats();return lib={formats:t,parse:e,stringify:n},lib}var hasRequiredUrl;function requireUrl(){if(hasRequiredUrl)return url$2;hasRequiredUrl=1;var n=requirePunycode();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(s),u=["'"].concat(a),h=["%","/","?",";","#"].concat(u),l=["/","?","#"],c=255,_=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=requireLib();function T(E,I,b){if(E&&typeof E=="object"&&E instanceof e)return E;var k=new e;return k.parse(E,I,b),k}e.prototype.parse=function(E,I,b){if(typeof E!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof E);var k=E.indexOf("?"),N=k!==-1&&k<E.indexOf("#")?"?":"#",G=E.split(N),X=/\\/g;G[0]=G[0].replace(X,"/"),E=G.join(N);var H=E;if(H=H.trim(),!b&&E.split("#").length===1){var Q=o.exec(H);if(Q)return this.path=H,this.href=H,this.pathname=Q[1],Q[2]?(this.search=Q[2],I?this.query=v.parse(this.search.substr(1)):this.query=this.search.substr(1)):I&&(this.search="",this.query={}),this}var tt=t.exec(H);if(tt){tt=tt[0];var q=tt.toLowerCase();this.protocol=q,H=H.substr(tt.length)}if(b||tt||H.match(/^\/\/[^@/]+@[^@/]+/)){var S=H.substr(0,2)==="//";S&&!(tt&&m[tt])&&(H=H.substr(2),this.slashes=!0)}if(!m[tt]&&(S||tt&&!g[tt])){for(var M=-1,R=0;R<l.length;R++){var C=H.indexOf(l[R]);C!==-1&&(M===-1||C<M)&&(M=C)}var D,P;M===-1?P=H.lastIndexOf("@"):P=H.lastIndexOf("@",M),P!==-1&&(D=H.slice(0,P),H=H.slice(P+1),this.auth=decodeURIComponent(D)),M=-1;for(var R=0;R<h.length;R++){var C=H.indexOf(h[R]);C!==-1&&(M===-1||C<M)&&(M=C)}M===-1&&(M=H.length),this.host=H.slice(0,M),H=H.slice(M),this.parseHost(),this.hostname=this.hostname||"";var B=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!B)for(var L=this.hostname.split(/\./),R=0,Y=L.length;R<Y;R++){var z=L[R];if(z&&!z.match(_)){for(var $="",W=0,et=z.length;W<et;W++)z.charCodeAt(W)>127?$+="x":$+=z[W];if(!$.match(_)){var K=L.slice(0,R),V=L.slice(R+1),Z=z.match(d);Z&&(K.push(Z[1]),V.unshift(Z[2])),V.length&&(H="/"+V.join(".")+H),this.hostname=K.join(".");break}}}this.hostname.length>c?this.hostname="":this.hostname=this.hostname.toLowerCase(),B||(this.hostname=n.toASCII(this.hostname));var rt=this.port?":"+this.port:"",st=this.hostname||"";this.host=st+rt,this.href+=this.host,B&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),H[0]!=="/"&&(H="/"+H))}if(!y[q])for(var R=0,Y=u.length;R<Y;R++){var it=u[R];if(H.indexOf(it)!==-1){var J=encodeURIComponent(it);J===it&&(J=escape(it)),H=H.split(it).join(J)}}var nt=H.indexOf("#");nt!==-1&&(this.hash=H.substr(nt),H=H.slice(0,nt));var ot=H.indexOf("?");if(ot!==-1?(this.search=H.substr(ot),this.query=H.substr(ot+1),I&&(this.query=v.parse(this.query)),H=H.slice(0,ot)):I&&(this.search="",this.query={}),H&&(this.pathname=H),g[q]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var rt=this.pathname||"",ht=this.search||"";this.path=rt+ht}return this.href=this.format(),this};function A(E){return typeof E=="string"&&(E=T(E)),E instanceof e?E.format():e.prototype.format.call(E)}e.prototype.format=function(){var E=this.auth||"";E&&(E=encodeURIComponent(E),E=E.replace(/%3A/i,":"),E+="@");var I=this.protocol||"",b=this.pathname||"",k=this.hash||"",N=!1,G="";this.host?N=E+this.host:this.hostname&&(N=E+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(N+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(G=v.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var X=this.search||G&&"?"+G||"";return I&&I.substr(-1)!==":"&&(I+=":"),this.slashes||(!I||g[I])&&N!==!1?(N="//"+(N||""),b&&b.charAt(0)!=="/"&&(b="/"+b)):N||(N=""),k&&k.charAt(0)!=="#"&&(k="#"+k),X&&X.charAt(0)!=="?"&&(X="?"+X),b=b.replace(/[?#]/g,function(H){return encodeURIComponent(H)}),X=X.replace("#","%23"),I+N+b+X+k};function O(E,I){return T(E,!1,!0).resolve(I)}e.prototype.resolve=function(E){return this.resolveObject(T(E,!1,!0)).format()};function w(E,I){return E?T(E,!1,!0).resolveObject(I):I}return e.prototype.resolveObject=function(E){if(typeof E=="string"){var I=new e;I.parse(E,!1,!0),E=I}for(var b=new e,k=Object.keys(this),N=0;N<k.length;N++){var G=k[N];b[G]=this[G]}if(b.hash=E.hash,E.href==="")return b.href=b.format(),b;if(E.slashes&&!E.protocol){for(var X=Object.keys(E),H=0;H<X.length;H++){var Q=X[H];Q!=="protocol"&&(b[Q]=E[Q])}return g[b.protocol]&&b.hostname&&!b.pathname&&(b.pathname="/",b.path=b.pathname),b.href=b.format(),b}if(E.protocol&&E.protocol!==b.protocol){if(!g[E.protocol]){for(var tt=Object.keys(E),q=0;q<tt.length;q++){var S=tt[q];b[S]=E[S]}return b.href=b.format(),b}if(b.protocol=E.protocol,!E.host&&!m[E.protocol]){for(var Y=(E.pathname||"").split("/");Y.length&&!(E.host=Y.shift()););E.host||(E.host=""),E.hostname||(E.hostname=""),Y[0]!==""&&Y.unshift(""),Y.length<2&&Y.unshift(""),b.pathname=Y.join("/")}else b.pathname=E.pathname;if(b.search=E.search,b.query=E.query,b.host=E.host||"",b.auth=E.auth,b.hostname=E.hostname||E.host,b.port=E.port,b.pathname||b.search){var M=b.pathname||"",R=b.search||"";b.path=M+R}return b.slashes=b.slashes||E.slashes,b.href=b.format(),b}var C=b.pathname&&b.pathname.charAt(0)==="/",D=E.host||E.pathname&&E.pathname.charAt(0)==="/",P=D||C||b.host&&E.pathname,B=P,L=b.pathname&&b.pathname.split("/")||[],Y=E.pathname&&E.pathname.split("/")||[],z=b.protocol&&!g[b.protocol];if(z&&(b.hostname="",b.port=null,b.host&&(L[0]===""?L[0]=b.host:L.unshift(b.host)),b.host="",E.protocol&&(E.hostname=null,E.port=null,E.host&&(Y[0]===""?Y[0]=E.host:Y.unshift(E.host)),E.host=null),P=P&&(Y[0]===""||L[0]==="")),D)b.host=E.host||E.host===""?E.host:b.host,b.hostname=E.hostname||E.hostname===""?E.hostname:b.hostname,b.search=E.search,b.query=E.query,L=Y;else if(Y.length)L||(L=[]),L.pop(),L=L.concat(Y),b.search=E.search,b.query=E.query;else if(E.search!=null){if(z){b.host=L.shift(),b.hostname=b.host;var $=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;$&&(b.auth=$.shift(),b.hostname=$.shift(),b.host=b.hostname)}return b.search=E.search,b.query=E.query,(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.href=b.format(),b}if(!L.length)return b.pathname=null,b.search?b.path="/"+b.search:b.path=null,b.href=b.format(),b;for(var W=L.slice(-1)[0],et=(b.host||E.host||L.length>1)&&(W==="."||W==="..")||W==="",K=0,V=L.length;V>=0;V--)W=L[V],W==="."?L.splice(V,1):W===".."?(L.splice(V,1),K++):K&&(L.splice(V,1),K--);if(!P&&!B)for(;K--;K)L.unshift("..");P&&L[0]!==""&&(!L[0]||L[0].charAt(0)!=="/")&&L.unshift(""),et&&L.join("/").substr(-1)!=="/"&&L.push("");var Z=L[0]===""||L[0]&&L[0].charAt(0)==="/";if(z){b.hostname=Z?"":L.length?L.shift():"",b.host=b.hostname;var $=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;$&&(b.auth=$.shift(),b.hostname=$.shift(),b.host=b.hostname)}return P=P||b.host&&L.length,P&&!Z&&L.unshift(""),L.length>0?b.pathname=L.join("/"):(b.pathname=null,b.path=null),(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.auth=E.auth||b.auth,b.slashes=b.slashes||E.slashes,b.href=b.format(),b},e.prototype.parseHost=function(){var E=this.host,I=r.exec(E);I&&(I=I[0],I!==":"&&(this.port=I.substr(1)),E=E.substr(0,E.length-I.length)),E&&(this.hostname=E)},url$2.parse=T,url$2.resolve=O,url$2.resolveObject=w,url$2.format=A,url$2.Url=e,url$2}var urlExports=requireUrl(),url$1={parse:urlExports.parse,format:urlExports.format,resolve:urlExports.resolve};settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var saidHello=!1,VERSION="6.5.10";function skipHello(){saidHello=!0}function sayHello(n){var e;if(!saidHello){if(settings.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var t=[`
 %c %c %c PixiJS `+VERSION+" - ✰ "+n+` ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=globalThis.console).log.apply(e,t)}else globalThis.console&&globalThis.console.log("PixiJS "+VERSION+" - "+n+" - http://www.pixijs.com/");saidHello=!0}}var supported;function isWebGLSupported(){return typeof supported>"u"&&(supported=(function(){var n={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;var e=settings.ADAPTER.createCanvas(),t=e.getContext("webgl",n)||e.getContext("experimental-webgl",n),r=!!(t&&t.getContextAttributes().stencil);if(t){var o=t.getExtension("WEBGL_lose_context");o&&o.loseContext()}return t=null,r}catch{return!1}})()),supported}var aliceblue="#f0f8ff",antiquewhite="#faebd7",aqua="#00ffff",aquamarine="#7fffd4",azure="#f0ffff",beige="#f5f5dc",bisque="#ffe4c4",black="#000000",blanchedalmond="#ffebcd",blue="#0000ff",blueviolet="#8a2be2",brown="#a52a2a",burlywood="#deb887",cadetblue="#5f9ea0",chartreuse="#7fff00",chocolate="#d2691e",coral="#ff7f50",cornflowerblue="#6495ed",cornsilk="#fff8dc",crimson="#dc143c",cyan="#00ffff",darkblue="#00008b",darkcyan="#008b8b",darkgoldenrod="#b8860b",darkgray="#a9a9a9",darkgreen="#006400",darkgrey="#a9a9a9",darkkhaki="#bdb76b",darkmagenta="#8b008b",darkolivegreen="#556b2f",darkorange="#ff8c00",darkorchid="#9932cc",darkred="#8b0000",darksalmon="#e9967a",darkseagreen="#8fbc8f",darkslateblue="#483d8b",darkslategray="#2f4f4f",darkslategrey="#2f4f4f",darkturquoise="#00ced1",darkviolet="#9400d3",deeppink="#ff1493",deepskyblue="#00bfff",dimgray="#696969",dimgrey="#696969",dodgerblue="#1e90ff",firebrick="#b22222",floralwhite="#fffaf0",forestgreen="#228b22",fuchsia="#ff00ff",gainsboro="#dcdcdc",ghostwhite="#f8f8ff",goldenrod="#daa520",gold="#ffd700",gray="#808080",green="#008000",greenyellow="#adff2f",grey="#808080",honeydew="#f0fff0",hotpink="#ff69b4",indianred="#cd5c5c",indigo="#4b0082",ivory="#fffff0",khaki="#f0e68c",lavenderblush="#fff0f5",lavender="#e6e6fa",lawngreen="#7cfc00",lemonchiffon="#fffacd",lightblue="#add8e6",lightcoral="#f08080",lightcyan="#e0ffff",lightgoldenrodyellow="#fafad2",lightgray="#d3d3d3",lightgreen="#90ee90",lightgrey="#d3d3d3",lightpink="#ffb6c1",lightsalmon="#ffa07a",lightseagreen="#20b2aa",lightskyblue="#87cefa",lightslategray="#778899",lightslategrey="#778899",lightsteelblue="#b0c4de",lightyellow="#ffffe0",lime="#00ff00",limegreen="#32cd32",linen="#faf0e6",magenta="#ff00ff",maroon="#800000",mediumaquamarine="#66cdaa",mediumblue="#0000cd",mediumorchid="#ba55d3",mediumpurple="#9370db",mediumseagreen="#3cb371",mediumslateblue="#7b68ee",mediumspringgreen="#00fa9a",mediumturquoise="#48d1cc",mediumvioletred="#c71585",midnightblue="#191970",mintcream="#f5fffa",mistyrose="#ffe4e1",moccasin="#ffe4b5",navajowhite="#ffdead",navy="#000080",oldlace="#fdf5e6",olive="#808000",olivedrab="#6b8e23",orange="#ffa500",orangered="#ff4500",orchid="#da70d6",palegoldenrod="#eee8aa",palegreen="#98fb98",paleturquoise="#afeeee",palevioletred="#db7093",papayawhip="#ffefd5",peachpuff="#ffdab9",peru="#cd853f",pink="#ffc0cb",plum="#dda0dd",powderblue="#b0e0e6",purple="#800080",rebeccapurple="#663399",red="#ff0000",rosybrown="#bc8f8f",royalblue="#4169e1",saddlebrown="#8b4513",salmon="#fa8072",sandybrown="#f4a460",seagreen="#2e8b57",seashell="#fff5ee",sienna="#a0522d",silver="#c0c0c0",skyblue="#87ceeb",slateblue="#6a5acd",slategray="#708090",slategrey="#708090",snow="#fffafa",springgreen="#00ff7f",steelblue="#4682b4",tan="#d2b48c",teal="#008080",thistle="#d8bfd8",tomato="#ff6347",turquoise="#40e0d0",violet="#ee82ee",wheat="#f5deb3",white="#ffffff",whitesmoke="#f5f5f5",yellow="#ffff00",yellowgreen="#9acd32",cssColorNames={aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,goldenrod,gold,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavenderblush,lavender,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen};function hex2rgb(n,e){return e===void 0&&(e=[]),e[0]=(n>>16&255)/255,e[1]=(n>>8&255)/255,e[2]=(n&255)/255,e}function hex2string(n){var e=n.toString(16);return e="000000".substring(0,6-e.length)+e,"#"+e}function string2hex(n){return typeof n=="string"&&(n=cssColorNames[n.toLowerCase()]||n,n[0]==="#"&&(n=n.slice(1))),parseInt(n,16)}function mapPremultipliedBlendModes(){for(var n=[],e=[],t=0;t<32;t++)n[t]=t,e[t]=t;n[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,n[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,n[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,e[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,e[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,e[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;var r=[];return r.push(e),r.push(n),r}var premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(n,e){return premultiplyBlendMode[e?1:0][n]}function premultiplyRgba(n,e,t,r){return t=t||new Float32Array(4),r||r===void 0?(t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e):(t[0]=n[0],t[1]=n[1],t[2]=n[2]),t[3]=e,t}function premultiplyTint(n,e){if(e===1)return(e*255<<24)+n;if(e===0)return 0;var t=n>>16&255,r=n>>8&255,o=n&255;return t=t*e+.5|0,r=r*e+.5|0,o=o*e+.5|0,(e*255<<24)+(t<<16)+(r<<8)+o}function premultiplyTintToRgba(n,e,t,r){return t=t||new Float32Array(4),t[0]=(n>>16&255)/255,t[1]=(n>>8&255)/255,t[2]=(n&255)/255,(r||r===void 0)&&(t[0]*=e,t[1]*=e,t[2]*=e),t[3]=e,t}function createIndicesForQuads(n,e){e===void 0&&(e=null);var t=n*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+t);for(var r=0,o=0;r<t;r+=6,o+=4)e[r+0]=o+0,e[r+1]=o+1,e[r+2]=o+2,e[r+3]=o+0,e[r+4]=o+2,e[r+5]=o+3;return e}function getBufferType(n){if(n.BYTES_PER_ELEMENT===4)return n instanceof Float32Array?"Float32Array":n instanceof Uint32Array?"Uint32Array":"Int32Array";if(n.BYTES_PER_ELEMENT===2){if(n instanceof Uint16Array)return"Uint16Array"}else if(n.BYTES_PER_ELEMENT===1&&n instanceof Uint8Array)return"Uint8Array";return null}function nextPow2(n){return n+=n===0?1:0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1}function isPow2(n){return!(n&n-1)&&!!n}function log2(n){var e=(n>65535?1:0)<<4;n>>>=e;var t=(n>255?1:0)<<3;return n>>>=t,e|=t,t=(n>15?1:0)<<2,n>>>=t,e|=t,t=(n>3?1:0)<<1,n>>>=t,e|=t,e|n>>1}function removeItems(n,e,t){var r=n.length,o;if(!(e>=r||t===0)){t=e+t>r?r-e:t;var s=r-t;for(o=e;o<s;++o)n[o]=n[o+t];n.length=s}}function sign(n){return n===0?0:n<0?-1:1}var nextUid=0;function uid(){return++nextUid}var warnings={};function deprecation(n,e,t){if(t===void 0&&(t=3),!warnings[e]){var r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+n):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+`
Deprecated since v`+n),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+n),console.warn(r))),warnings[e]=!0}}var ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);function clearTextureCache(){var n;for(n in TextureCache)delete TextureCache[n];for(n in BaseTextureCache)delete BaseTextureCache[n]}var CanvasRenderTarget=(function(){function n(e,t,r){this.canvas=settings.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||settings.RESOLUTION,this.resize(e,t)}return n.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},n.prototype.resize=function(e,t){this.canvas.width=Math.round(e*this.resolution),this.canvas.height=Math.round(t*this.resolution)},n.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(n.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=Math.round(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=Math.round(e)},enumerable:!1,configurable:!0}),n})();function trimCanvas(n){var e=n.width,t=n.height,r=n.getContext("2d",{willReadFrequently:!0}),o=r.getImageData(0,0,e,t),s=o.data,a=s.length,u={top:null,left:null,right:null,bottom:null},h=null,l,c,_;for(l=0;l<a;l+=4)s[l+3]!==0&&(c=l/4%e,_=~~(l/4/e),u.top===null&&(u.top=_),(u.left===null||c<u.left)&&(u.left=c),(u.right===null||u.right<c)&&(u.right=c+1),(u.bottom===null||u.bottom<_)&&(u.bottom=_));return u.top!==null&&(e=u.right-u.left,t=u.bottom-u.top+1,h=r.getImageData(u.left,u.top,e,t)),{height:t,width:e,data:h}}var tempAnchor$1;function determineCrossOrigin(n,e){if(e===void 0&&(e=globalThis.location),n.indexOf("data:")===0)return"";e=e||globalThis.location,tempAnchor$1||(tempAnchor$1=document.createElement("a")),tempAnchor$1.href=n;var t=url$1.parse(tempAnchor$1.href),r=!t.port&&e.port===""||t.port===e.port;return t.hostname!==e.hostname||!r||t.protocol!==e.protocol?"anonymous":""}function getResolutionOfUrl(n,e){var t=settings.RETINA_PREFIX.exec(n);return t?parseFloat(t[1]):e!==void 0?e:1}var PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180,SHAPES;(function(n){n[n.POLY=0]="POLY",n[n.RECT=1]="RECT",n[n.CIRC=2]="CIRC",n[n.ELIP=3]="ELIP",n[n.RREC=4]="RREC"})(SHAPES||(SHAPES={}));var Point=(function(){function n(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this.x=0,this.y=0,this.x=e,this.y=t}return n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},n.prototype.copyTo=function(e){return e.set(this.x,this.y),e},n.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},n.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x=e,this.y=t,this},n.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},n})(),tempPoints$1=[new Point,new Point,new Point,new Point],Rectangle=(function(){function n(e,t,r,o){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(o),this.type=SHAPES.RECT}return Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(n,"EMPTY",{get:function(){return new n(0,0,0,0)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},n.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},n.prototype.contains=function(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height},n.prototype.intersects=function(e,t){if(!t){var r=this.x<e.x?e.x:this.x,o=this.right>e.right?e.right:this.right;if(o<=r)return!1;var s=this.y<e.y?e.y:this.y,a=this.bottom>e.bottom?e.bottom:this.bottom;return a>s}var u=this.left,h=this.right,l=this.top,c=this.bottom;if(h<=u||c<=l)return!1;var _=tempPoints$1[0].set(e.left,e.top),d=tempPoints$1[1].set(e.left,e.bottom),y=tempPoints$1[2].set(e.right,e.top),m=tempPoints$1[3].set(e.right,e.bottom);if(y.x<=_.x||d.y<=_.y)return!1;var g=Math.sign(t.a*t.d-t.b*t.c);if(g===0||(t.apply(_,_),t.apply(d,d),t.apply(y,y),t.apply(m,m),Math.max(_.x,d.x,y.x,m.x)<=u||Math.min(_.x,d.x,y.x,m.x)>=h||Math.max(_.y,d.y,y.y,m.y)<=l||Math.min(_.y,d.y,y.y,m.y)>=c))return!1;var v=g*(d.y-_.y),T=g*(_.x-d.x),A=v*u+T*l,O=v*h+T*l,w=v*u+T*c,E=v*h+T*c;if(Math.max(A,O,w,E)<=v*_.x+T*_.y||Math.min(A,O,w,E)>=v*m.x+T*m.y)return!1;var I=g*(_.y-y.y),b=g*(y.x-_.x),k=I*u+b*l,N=I*h+b*l,G=I*u+b*c,X=I*h+b*c;return!(Math.max(k,N,G,X)<=I*_.x+b*_.y||Math.min(k,N,G,X)>=I*m.x+b*m.y)},n.prototype.pad=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this},n.prototype.fit=function(e){var t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),o=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=o,this.height=Math.max(s-o,0),this},n.prototype.ceil=function(e,t){e===void 0&&(e=1),t===void 0&&(t=.001);var r=Math.ceil((this.x+this.width-t)*e)/e,o=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=o-this.y,this},n.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),o=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=o,this.height=s-o,this},n.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},n})(),Circle=(function(){function n(e,t,r){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),this.x=e,this.y=t,this.radius=r,this.type=SHAPES.CIRC}return n.prototype.clone=function(){return new n(this.x,this.y,this.radius)},n.prototype.contains=function(e,t){if(this.radius<=0)return!1;var r=this.radius*this.radius,o=this.x-e,s=this.y-t;return o*=o,s*=s,o+s<=r},n.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},n.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},n})(),Ellipse=(function(){function n(e,t,r,o){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),this.x=e,this.y=t,this.width=r,this.height=o,this.type=SHAPES.ELIP}return n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,o=(t-this.y)/this.height;return r*=r,o*=o,r+o<=1},n.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},n.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},n})(),Polygon=(function(){function n(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];var o=Array.isArray(t[0])?t[0]:t;if(typeof o[0]!="number"){for(var s=[],a=0,u=o.length;a<u;a++)s.push(o[a].x,o[a].y);o=s}this.points=o,this.type=SHAPES.POLY,this.closeStroke=!0}return n.prototype.clone=function(){var e=this.points.slice(),t=new n(e);return t.closeStroke=this.closeStroke,t},n.prototype.contains=function(e,t){for(var r=!1,o=this.points.length/2,s=0,a=o-1;s<o;a=s++){var u=this.points[s*2],h=this.points[s*2+1],l=this.points[a*2],c=this.points[a*2+1],_=h>t!=c>t&&e<(l-u)*((t-h)/(c-h))+u;_&&(r=!r)}return r},n.prototype.toString=function(){return"[@pixi/math:Polygon"+("closeStroke="+this.closeStroke)+("points="+this.points.reduce(function(e,t){return e+", "+t},"")+"]")},n})(),RoundedRectangle=(function(){function n(e,t,r,o,s){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=20),this.x=e,this.y=t,this.width=r,this.height=o,this.radius=s,this.type=SHAPES.RREC}return n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height,this.radius)},n.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){var r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;var o=e-(this.x+r),s=t-(this.y+r),a=r*r;if(o*o+s*s<=a||(o=e-(this.x+this.width-r),o*o+s*s<=a)||(s=t-(this.y+this.height-r),o*o+s*s<=a)||(o=e-(this.x+r),o*o+s*s<=a))return!0}return!1},n.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+("width="+this.width+" height="+this.height+" radius="+this.radius+"]")},n})(),ObservablePoint=(function(){function n(e,t,r,o){r===void 0&&(r=0),o===void 0&&(o=0),this._x=r,this._y=o,this.cb=e,this.scope=t}return n.prototype.clone=function(e,t){return e===void 0&&(e=this.cb),t===void 0&&(t=this.scope),new n(e,t,this._x,this._y)},n.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this},n.prototype.copyFrom=function(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},n.prototype.copyTo=function(e){return e.set(this._x,this._y),e},n.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},n.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),n})(),Matrix=(function(){function n(e,t,r,o,s,a){e===void 0&&(e=1),t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=1),s===void 0&&(s=0),a===void 0&&(a=0),this.array=null,this.a=e,this.b=t,this.c=r,this.d=o,this.tx=s,this.ty=a}return n.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},n.prototype.set=function(e,t,r,o,s,a){return this.a=e,this.b=t,this.c=r,this.d=o,this.tx=s,this.ty=a,this},n.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},n.prototype.apply=function(e,t){t=t||new Point;var r=e.x,o=e.y;return t.x=this.a*r+this.c*o+this.tx,t.y=this.b*r+this.d*o+this.ty,t},n.prototype.applyInverse=function(e,t){t=t||new Point;var r=1/(this.a*this.d+this.c*-this.b),o=e.x,s=e.y;return t.x=this.d*r*o+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*s+-this.b*r*o+(-this.ty*this.a+this.tx*this.b)*r,t},n.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},n.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},n.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),o=this.a,s=this.c,a=this.tx;return this.a=o*t-this.b*r,this.b=o*r+this.b*t,this.c=s*t-this.d*r,this.d=s*r+this.d*t,this.tx=a*t-this.ty*r,this.ty=a*r+this.ty*t,this},n.prototype.append=function(e){var t=this.a,r=this.b,o=this.c,s=this.d;return this.a=e.a*t+e.b*o,this.b=e.a*r+e.b*s,this.c=e.c*t+e.d*o,this.d=e.c*r+e.d*s,this.tx=e.tx*t+e.ty*o+this.tx,this.ty=e.tx*r+e.ty*s+this.ty,this},n.prototype.setTransform=function(e,t,r,o,s,a,u,h,l){return this.a=Math.cos(u+l)*s,this.b=Math.sin(u+l)*s,this.c=-Math.sin(u-h)*a,this.d=Math.cos(u-h)*a,this.tx=e-(r*this.a+o*this.c),this.ty=t-(r*this.b+o*this.d),this},n.prototype.prepend=function(e){var t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){var r=this.a,o=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=o*e.a+this.d*e.c,this.d=o*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},n.prototype.decompose=function(e){var t=this.a,r=this.b,o=this.c,s=this.d,a=e.pivot,u=-Math.atan2(-o,s),h=Math.atan2(r,t),l=Math.abs(u+h);return l<1e-5||Math.abs(PI_2-l)<1e-5?(e.rotation=h,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=u,e.skew.y=h),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(o*o+s*s),e.position.x=this.tx+(a.x*t+a.y*o),e.position.y=this.ty+(a.x*r+a.y*s),e},n.prototype.invert=function(){var e=this.a,t=this.b,r=this.c,o=this.d,s=this.tx,a=e*o-t*r;return this.a=o/a,this.b=-t/a,this.c=-r/a,this.d=e/a,this.tx=(r*this.ty-o*s)/a,this.ty=-(e*this.ty-t*s)/a,this},n.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.prototype.clone=function(){var e=new n;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},n.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},n.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},n.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(n,"IDENTITY",{get:function(){return new n},enumerable:!1,configurable:!0}),Object.defineProperty(n,"TEMP_MATRIX",{get:function(){return new n},enumerable:!1,configurable:!0}),n})(),ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(var n=0;n<16;n++){var e=[];rotationCayley.push(e);for(var t=0;t<16;t++)for(var r=signum(ux[n]*ux[t]+vx[n]*uy[t]),o=signum(uy[n]*ux[t]+vy[n]*uy[t]),s=signum(ux[n]*vx[t]+vx[n]*vy[t]),a=signum(uy[n]*vx[t]+vy[n]*vy[t]),u=0;u<16;u++)if(ux[u]===r&&uy[u]===o&&vx[u]===s&&vy[u]===a){e.push(u);break}}for(var n=0;n<16;n++){var h=new Matrix;h.set(ux[n],uy[n],vx[n],vy[n],0,0),rotationMatrices.push(h)}}init();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(n){return ux[n]},uY:function(n){return uy[n]},vX:function(n){return vx[n]},vY:function(n){return vy[n]},inv:function(n){return n&8?n&15:-n&7},add:function(n,e){return rotationCayley[n][e]},sub:function(n,e){return rotationCayley[n][groupD8.inv(e)]},rotate180:function(n){return n^4},isVertical:function(n){return(n&3)===2},byDirection:function(n,e){return Math.abs(n)*2<=Math.abs(e)?e>=0?groupD8.S:groupD8.N:Math.abs(e)*2<=Math.abs(n)?n>0?groupD8.E:groupD8.W:e>0?n>0?groupD8.SE:groupD8.SW:n>0?groupD8.NE:groupD8.NW},matrixAppendRotationInv:function(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var o=rotationMatrices[groupD8.inv(e)];o.tx=t,o.ty=r,n.append(o)}},Transform=(function(){function n(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return n.prototype.onChange=function(){this._localID++},n.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},n.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},n.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},n.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,o=this.worldTransform;o.a=t.a*r.a+t.b*r.c,o.b=t.a*r.b+t.b*r.d,o.c=t.c*r.a+t.d*r.c,o.d=t.c*r.b+t.d*r.d,o.tx=t.tx*r.a+t.ty*r.c+r.tx,o.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},n.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(n.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),n.IDENTITY=new n,n})();settings.SORTABLE_CHILDREN=!1;var Bounds=(function(){function n(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return n.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},n.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},n.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(e=e||new Rectangle(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},n.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},n.prototype.addPointMatrix=function(e,t){var r=e.a,o=e.b,s=e.c,a=e.d,u=e.tx,h=e.ty,l=r*t.x+s*t.y+u,c=o*t.x+a*t.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)},n.prototype.addQuad=function(e){var t=this.minX,r=this.minY,o=this.maxX,s=this.maxY,a=e[0],u=e[1];t=a<t?a:t,r=u<r?u:r,o=a>o?a:o,s=u>s?u:s,a=e[2],u=e[3],t=a<t?a:t,r=u<r?u:r,o=a>o?a:o,s=u>s?u:s,a=e[4],u=e[5],t=a<t?a:t,r=u<r?u:r,o=a>o?a:o,s=u>s?u:s,a=e[6],u=e[7],t=a<t?a:t,r=u<r?u:r,o=a>o?a:o,s=u>s?u:s,this.minX=t,this.minY=r,this.maxX=o,this.maxY=s},n.prototype.addFrame=function(e,t,r,o,s){this.addFrameMatrix(e.worldTransform,t,r,o,s)},n.prototype.addFrameMatrix=function(e,t,r,o,s){var a=e.a,u=e.b,h=e.c,l=e.d,c=e.tx,_=e.ty,d=this.minX,y=this.minY,m=this.maxX,g=this.maxY,v=a*t+h*r+c,T=u*t+l*r+_;d=v<d?v:d,y=T<y?T:y,m=v>m?v:m,g=T>g?T:g,v=a*o+h*r+c,T=u*o+l*r+_,d=v<d?v:d,y=T<y?T:y,m=v>m?v:m,g=T>g?T:g,v=a*t+h*s+c,T=u*t+l*s+_,d=v<d?v:d,y=T<y?T:y,m=v>m?v:m,g=T>g?T:g,v=a*o+h*s+c,T=u*o+l*s+_,d=v<d?v:d,y=T<y?T:y,m=v>m?v:m,g=T>g?T:g,this.minX=d,this.minY=y,this.maxX=m,this.maxY=g},n.prototype.addVertexData=function(e,t,r){for(var o=this.minX,s=this.minY,a=this.maxX,u=this.maxY,h=t;h<r;h+=2){var l=e[h],c=e[h+1];o=l<o?l:o,s=c<s?c:s,a=l>a?l:a,u=c>u?c:u}this.minX=o,this.minY=s,this.maxX=a,this.maxY=u},n.prototype.addVertices=function(e,t,r,o){this.addVerticesMatrix(e.worldTransform,t,r,o)},n.prototype.addVerticesMatrix=function(e,t,r,o,s,a){s===void 0&&(s=0),a===void 0&&(a=s);for(var u=e.a,h=e.b,l=e.c,c=e.d,_=e.tx,d=e.ty,y=this.minX,m=this.minY,g=this.maxX,v=this.maxY,T=r;T<o;T+=2){var A=t[T],O=t[T+1],w=u*A+l*O+_,E=c*O+h*A+d;y=Math.min(y,w-s),g=Math.max(g,w+s),m=Math.min(m,E-a),v=Math.max(v,E+a)}this.minX=y,this.minY=m,this.maxX=g,this.maxY=v},n.prototype.addBounds=function(e){var t=this.minX,r=this.minY,o=this.maxX,s=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>o?e.maxX:o,this.maxY=e.maxY>s?e.maxY:s},n.prototype.addBoundsMask=function(e,t){var r=e.minX>t.minX?e.minX:t.minX,o=e.minY>t.minY?e.minY:t.minY,s=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=s&&o<=a){var u=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=r<u?r:u,this.minY=o<h?o:h,this.maxX=s>l?s:l,this.maxY=a>c?a:c}},n.prototype.addBoundsMatrix=function(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)},n.prototype.addBoundsArea=function(e,t){var r=e.minX>t.x?e.minX:t.x,o=e.minY>t.y?e.minY:t.y,s=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=s&&o<=a){var u=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=r<u?r:u,this.minY=o<h?o:h,this.maxX=s>l?s:l,this.maxY=a>c?a:c}},n.prototype.pad=function(e,t){e===void 0&&(e=0),t===void 0&&(t=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)},n.prototype.addFramePad=function(e,t,r,o,s,a){e-=s,t-=a,r+=s,o+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>o?this.maxY:o},n})(),extendStatics$j=function(n,e){return extendStatics$j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$j(n,e)};function __extends$j(n,e){extendStatics$j(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var DisplayObject=(function(n){__extends$j(e,n);function e(){var t=n.call(this)||this;return t.tempDisplayObjectParent=null,t.transform=new Transform,t.alpha=1,t.visible=!0,t.renderable=!0,t.cullable=!1,t.cullArea=null,t.parent=null,t.worldAlpha=1,t._lastSortedIndex=0,t._zIndex=0,t.filterArea=null,t.filters=null,t._enabledFilters=null,t._bounds=new Bounds,t._localBounds=null,t._boundsID=0,t._boundsRect=null,t._localBoundsRect=null,t._mask=null,t._maskRefCount=0,t._destroyed=!1,t.isSprite=!1,t.isMask=!1,t}return e.mixin=function(t){for(var r=Object.keys(t),o=0;o<r.length;++o){var s=r[o];Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t,s))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Rectangle),r=this._boundsRect),this._bounds.getRectangle(r)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);var r=this.transform,o=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,a=this._boundsID;this._bounds=this._localBounds;var u=this.getBounds(!1,t);return this.parent=o,this.transform=r,this._bounds=s,this._bounds.updateID+=this._boundsID-a,u},e.prototype.toGlobal=function(t,r,o){return o===void 0&&(o=!1),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)},e.prototype.toLocal=function(t,r,o,s){return r&&(t=r.toGlobal(t,o,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,o)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,r,o,s,a,u,h,l,c){return t===void 0&&(t=0),r===void 0&&(r=0),o===void 0&&(o=1),s===void 0&&(s=1),a===void 0&&(a=0),u===void 0&&(u=0),h===void 0&&(h=0),l===void 0&&(l=0),c===void 0&&(c=0),this.position.x=t,this.position.y=r,this.scale.x=o||1,this.scale.y=s||1,this.rotation=a,this.skew.x=u,this.skew.y=h,this.pivot.x=l,this.pivot.y=c,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*RAD_TO_DEG},set:function(t){this.transform.rotation=t*DEG_TO_RAD},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask!==t){if(this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){var r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}},enumerable:!1,configurable:!0}),e})(i),TemporaryDisplayObject=(function(n){__extends$j(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.sortDirty=null,t}return e})(DisplayObject);DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;function sortChildren(n,e){return n.zIndex===e.zIndex?n._lastSortedIndex-e._lastSortedIndex:n.zIndex-e.zIndex}var Container=(function(n){__extends$j(e,n);function e(){var t=n.call(this)||this;return t.children=[],t.sortableChildren=settings.SORTABLE_CHILDREN,t.sortDirty=!1,t}return e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,r=[],o=0;o<arguments.length;o++)r[o]=t[o];if(r.length>1)for(var s=0;s<r.length;s++)this.addChild(r[s]);else{var a=r[0];a.parent&&a.parent.removeChild(a),a.parent=this,this.sortDirty=!0,a.transform._parentID=-1,this.children.push(a),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",a,this,this.children.length-1),a.emit("added",this)}return r[0]},e.prototype.addChildAt=function(t,r){if(r<0||r>this.children.length)throw new Error(t+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(r,0,t),this._boundsID++,this.onChildrenChange(r),t.emit("added",this),this.emit("childAdded",t,this,r),t},e.prototype.swapChildren=function(t,r){if(t!==r){var o=this.getChildIndex(t),s=this.getChildIndex(r);this.children[o]=r,this.children[s]=t,this.onChildrenChange(o<s?o:s)}},e.prototype.getChildIndex=function(t){var r=this.children.indexOf(t);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},e.prototype.setChildIndex=function(t,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var o=this.getChildIndex(t);removeItems(this.children,o,1),this.children.splice(r,0,t),this.onChildrenChange(r)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,r=[],o=0;o<arguments.length;o++)r[o]=t[o];if(r.length>1)for(var s=0;s<r.length;s++)this.removeChild(r[s]);else{var a=r[0],u=this.children.indexOf(a);if(u===-1)return null;a.parent=null,a.transform._parentID=-1,removeItems(this.children,u,1),this._boundsID++,this.onChildrenChange(u),a.emit("removed",this),this.emit("childRemoved",a,this,u)}return r[0]},e.prototype.removeChildAt=function(t){var r=this.getChildAt(t);return r.parent=null,r.transform._parentID=-1,removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),r.emit("removed",this),this.emit("childRemoved",r,this,t),r},e.prototype.removeChildren=function(t,r){t===void 0&&(t=0),r===void 0&&(r=this.children.length);var o=t,s=r,a=s-o,u;if(a>0&&a<=s){u=this.children.splice(o,a);for(var h=0;h<u.length;++h)u[h].parent=null,u[h].transform&&(u[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var h=0;h<u.length;++h)u[h].emit("removed",this),this.emit("childRemoved",u[h],this,h);return u}else if(a===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,r=0,o=this.children.length;r<o;++r){var s=this.children[r];s._lastSortedIndex=r,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,r=this.children.length;t<r;++t){var o=this.children[t];o.visible&&o.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var r=this.children[t];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var o=r._mask.isMaskData?r._mask.maskObject:r._mask;o?(o.calculateBounds(),this._bounds.addBoundsMask(r._bounds,o._bounds)):this._bounds.addBounds(r._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(t,r){r===void 0&&(r=!1);var o=n.prototype.getLocalBounds.call(this,t);if(!r)for(var s=0,a=this.children.length;s<a;++s){var u=this.children[s];u.visible&&u.updateTransform()}return o},e.prototype._calculateBounds=function(){},e.prototype._renderWithCulling=function(t){var r=t.renderTexture.sourceFrame;if(r.width>0&&r.height>0){var o,s;if(this.cullArea?(o=this.cullArea,s=this.worldTransform):this._render!==e.prototype._render&&(o=this.getBounds(!0)),o&&r.intersects(o,s))this._render(t);else if(this.cullArea)return;for(var a=0,u=this.children.length;a<u;++a){var h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}},e.prototype.render=function(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(var r=0,o=this.children.length;r<o;++r)this.children[r].render(t)}},e.prototype.renderAdvanced=function(t){var r=this.filters,o=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var s=0;s<r.length;s++)r[s].enabled&&this._enabledFilters.push(r[s])}var a=r&&this._enabledFilters&&this._enabledFilters.length||o&&(!o.isMaskData||o.enabled&&(o.autoDetect||o.type!==MASK_TYPES.NONE));if(a&&t.batch.flush(),r&&this._enabledFilters&&this._enabledFilters.length&&t.filter.push(this,this._enabledFilters),o&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(var s=0,u=this.children.length;s<u;++s)this.children[s].render(t)}a&&t.batch.flush(),o&&t.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(t){n.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof t=="boolean"?t:t&&t.children,o=this.removeChildren(0,this.children.length);if(r)for(var s=0;s<o.length;++s)o[s].destroy(t)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var r=this.getLocalBounds().width;r!==0?this.scale.x=t/r:this.scale.x=1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var r=this.getLocalBounds().height;r!==0?this.scale.y=t/r:this.scale.y=1,this._height=t},enumerable:!1,configurable:!0}),e})(DisplayObject);Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;var __assign$1=function(){return __assign$1=Object.assign||function(n){for(var e=arguments,t,r=1,o=arguments.length;r<o;r++){t=e[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},__assign$1.apply(this,arguments)},ExtensionType;(function(n){n.Application="application",n.RendererPlugin="renderer-webgl-plugin",n.CanvasRendererPlugin="renderer-canvas-plugin",n.Loader="loader",n.LoadParser="load-parser",n.ResolveParser="resolve-parser",n.CacheParser="cache-parser",n.DetectionParser="detection-parser"})(ExtensionType||(ExtensionType={}));var normalizeExtension=function(n){if(typeof n=="function"||typeof n=="object"&&n.extension){if(!n.extension)throw new Error("Extension class must have an extension object");var e=typeof n.extension!="object"?{type:n.extension}:n.extension;n=__assign$1(__assign$1({},e),{ref:n})}if(typeof n=="object")n=__assign$1({},n);else throw new Error("Invalid extension type");return typeof n.type=="string"&&(n.type=[n.type]),n},extensions={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var n=arguments,e=this,t=[],r=0;r<arguments.length;r++)t[r]=n[r];return t.map(normalizeExtension).forEach(function(o){o.type.forEach(function(s){var a,u;return(u=(a=e._removeHandlers)[s])===null||u===void 0?void 0:u.call(a,o)})}),this},add:function(){for(var n=arguments,e=this,t=[],r=0;r<arguments.length;r++)t[r]=n[r];return t.map(normalizeExtension).forEach(function(o){o.type.forEach(function(s){var a=e._addHandlers,u=e._queue;a[s]?a[s](o):(u[s]=u[s]||[],u[s].push(o))})}),this},handle:function(n,e,t){var r=this._addHandlers=this._addHandlers||{},o=this._removeHandlers=this._removeHandlers||{};if(r[n]||o[n])throw new Error("Extension type "+n+" already has a handler");r[n]=e,o[n]=t;var s=this._queue;return s[n]&&(s[n].forEach(function(a){return e(a)}),delete s[n]),this},handleByMap:function(n,e){return this.handle(n,function(t){e[t.name]=t.ref},function(t){delete e[t.name]})},handleByList:function(n,e){return this.handle(n,function(t){var r,o;e.includes(t.ref)||(e.push(t.ref),n===ExtensionType.Loader&&((o=(r=t.ref).add)===null||o===void 0||o.call(r)))},function(t){var r=e.indexOf(t.ref);r!==-1&&e.splice(r,1)})}},Runner=(function(){function n(e){this.items=[],this._name=e,this._aliasCount=0}return n.prototype.emit=function(e,t,r,o,s,a,u,h){if(arguments.length>8)throw new Error("max arguments reached");var l=this,c=l.name,_=l.items;this._aliasCount++;for(var d=0,y=_.length;d<y;d++)_[d][c](e,t,r,o,s,a,u,h);return _===this.items&&this._aliasCount--,this},n.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},n.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},n.prototype.remove=function(e){var t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this},n.prototype.contains=function(e){return this.items.indexOf(e)!==-1},n.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},n.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(n.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),n})();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});settings.TARGET_FPMS=.06;var UPDATE_PRIORITY;(function(n){n[n.INTERACTION=50]="INTERACTION",n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY"})(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=(function(){function n(e,t,r,o){t===void 0&&(t=null),r===void 0&&(r=0),o===void 0&&(o=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=o}return n.prototype.match=function(e,t){return t===void 0&&(t=null),this.fn===e&&this.context===t},n.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t},n.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},n.prototype.destroy=function(e){e===void 0&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.next;return this.next=e?null:t,this.previous=null,t},n})(),Ticker=(function(){function n(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&e._requestId===null&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return n.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},n.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},n.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},n.prototype.add=function(e,t,r){return r===void 0&&(r=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(e,t,r))},n.prototype.addOnce=function(e,t,r){return r===void 0&&(r=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(e,t,r,!0))},n.prototype._addListener=function(e){var t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this},n.prototype.remove=function(e,t){for(var r=this._head.next;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(n.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,t=this._head;t=t.next;)e++;return e},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},n.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},n.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},n.prototype.update=function(e){e===void 0&&(e=performance.now());var t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){var r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var o=this._head,s=o.next;s;)s=s.emit(this.deltaTime);o.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(n.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){if(e===0)this._minElapsedMS=0;else{var t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"shared",{get:function(){if(!n._shared){var e=n._shared=new n;e.autoStart=!0,e._protected=!0}return n._shared},enumerable:!1,configurable:!0}),Object.defineProperty(n,"system",{get:function(){if(!n._system){var e=n._system=new n;e.autoStart=!0,e._protected=!0}return n._system},enumerable:!1,configurable:!0}),n})(),TickerPlugin=(function(){function n(){}return n.init=function(e){var t=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){t._ticker.stop()},this.start=function(){t._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ticker.shared:new Ticker,e.autoStart&&this.start()},n.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}},n.extension=ExtensionType.Application,n})();settings.PREFER_ENV=isMobile.any?ENV.WEBGL:ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[];function autoDetectResource(n,e){if(!n)return null;var t="";if(typeof n=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(n);r&&(t=r[1].toLowerCase())}for(var o=INSTALLED.length-1;o>=0;--o){var s=INSTALLED[o];if(s.test&&s.test(n,t))return new s(n,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var extendStatics$i=function(n,e){return extendStatics$i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$i(n,e)};function __extends$i(n,e){extendStatics$i(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var __assign=function(){return __assign=Object.assign||function(n){for(var e=arguments,t,r=1,o=arguments.length;r<o;r++){t=e[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},__assign.apply(this,arguments)};function __rest(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t}var Resource=(function(){function n(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}return n.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},n.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},n.prototype.resize=function(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))},Object.defineProperty(n.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),n.prototype.update=function(){this.destroyed||this.onUpdate.emit()},n.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),n.prototype.style=function(e,t,r){return!1},n.prototype.dispose=function(){},n.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},n.test=function(e,t){return!1},n})(),BufferResource=(function(n){__extends$i(e,n);function e(t,r){var o=this,s=r||{},a=s.width,u=s.height;if(!a||!u)throw new Error("BufferResource width or height invalid");return o=n.call(this,a,u)||this,o.data=t,o}return e.prototype.upload=function(t,r,o){var s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ALPHA_MODES.UNPACK);var a=r.realWidth,u=r.realHeight;return o.width===a&&o.height===u?s.texSubImage2D(r.target,0,0,0,a,u,r.format,o.type,this.data):(o.width=a,o.height=u,s.texImage2D(r.target,0,o.internalFormat,a,u,0,r.format,o.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e})(Resource),defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM},BaseTexture=(function(n){__extends$i(e,n);function e(t,r){t===void 0&&(t=null),r===void 0&&(r=null);var o=n.call(this)||this;r=r||{};var s=r.alphaMode,a=r.mipmap,u=r.anisotropicLevel,h=r.scaleMode,l=r.width,c=r.height,_=r.wrapMode,d=r.format,y=r.type,m=r.target,g=r.resolution,v=r.resourceOptions;return t&&!(t instanceof Resource)&&(t=autoDetectResource(t,v),t.internal=!0),o.resolution=g||settings.RESOLUTION,o.width=Math.round((l||0)*o.resolution)/o.resolution,o.height=Math.round((c||0)*o.resolution)/o.resolution,o._mipmap=a!==void 0?a:settings.MIPMAP_TEXTURES,o.anisotropicLevel=u!==void 0?u:settings.ANISOTROPIC_LEVEL,o._wrapMode=_||settings.WRAP_MODE,o._scaleMode=h!==void 0?h:settings.SCALE_MODE,o.format=d||FORMATS.RGBA,o.type=y||TYPES.UNSIGNED_BYTE,o.target=m||TARGETS.TEXTURE_2D,o.alphaMode=s!==void 0?s:ALPHA_MODES.UNPACK,o.uid=uid(),o.touched=0,o.isPowerOfTwo=!1,o._refreshPOT(),o._glTextures={},o.dirtyId=0,o.dirtyStyleId=0,o.cacheId=null,o.valid=l>0&&c>0,o.textureCacheIds=[],o.destroyed=!1,o.resource=null,o._batchEnabled=0,o._batchLocation=0,o.parentTextureArray=null,o.setResource(t),o}return Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,r){var o;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,o=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,o=!0),o&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,r,o){return o=o||this.resolution,this.setRealSize(t*o,r*o,o)},e.prototype.setRealSize=function(t,r,o){return this.resolution=o||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(r)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},e.prototype.setResolution=function(t){var r=this.resolution;return r===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*r)/t,this.height=Math.round(this.height*r)/t,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,r,o){o===void 0&&(o=settings.STRICT_TEXTURE_CACHE);var s=typeof t=="string",a=null;if(s)a=t;else{if(!t._pixiId){var u=r&&r.pixiIdPrefix||"pixiid";t._pixiId=u+"_"+uid()}a=t._pixiId}var h=BaseTextureCache[a];if(s&&o&&!h)throw new Error('The cacheId "'+a+'" does not exist in BaseTextureCache.');return h||(h=new e(t,r),h.cacheId=a,e.addToCache(h,a)),h},e.fromBuffer=function(t,r,o,s){t=t||new Float32Array(r*o*4);var a=new BufferResource(t,{width:r,height:o}),u=t instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new e(a,Object.assign({},defaultBufferOptions,s||{width:r,height:o,type:u}))},e.addToCache=function(t,r){r&&(t.textureCacheIds.indexOf(r)===-1&&t.textureCacheIds.push(r),BaseTextureCache[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),BaseTextureCache[r]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var r=BaseTextureCache[t];if(r){var o=r.textureCacheIds.indexOf(t);return o>-1&&r.textureCacheIds.splice(o,1),delete BaseTextureCache[t],r}}else if(t&&t.textureCacheIds){for(var s=0;s<t.textureCacheIds.length;++s)delete BaseTextureCache[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e})(i),AbstractMultiResource=(function(n){__extends$i(e,n);function e(t,r){var o=this,s=r||{},a=s.width,u=s.height;o=n.call(this,a,u)||this,o.items=[],o.itemDirtyIds=[];for(var h=0;h<t;h++){var l=new BaseTexture;o.items.push(l),o.itemDirtyIds.push(-2)}return o.length=t,o._load=null,o.baseTexture=null,o}return e.prototype.initFromArray=function(t,r){for(var o=0;o<this.length;o++)t[o]&&(t[o].castToBaseTexture?this.addBaseTextureAt(t[o].castToBaseTexture(),o):t[o]instanceof Resource?this.addResourceAt(t[o],o):this.addResourceAt(autoDetectResource(t[o],r),o))},e.prototype.dispose=function(){for(var t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this},e.prototype.bind=function(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");n.prototype.bind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)},e.prototype.unbind=function(t){n.prototype.unbind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.items.map(function(s){return s.resource}).filter(function(s){return s}),o=r.map(function(s){return s.load()});return this._load=Promise.all(o).then(function(){var s=t.items[0],a=s.realWidth,u=s.realHeight;return t.resize(a,u),Promise.resolve(t)}),this._load},e})(Resource),ArrayResource=(function(n){__extends$i(e,n);function e(t,r){var o=this,s=r||{},a=s.width,u=s.height,h,l;return Array.isArray(t)?(h=t,l=t.length):l=t,o=n.call(this,l,{width:a,height:u})||this,h&&o.initFromArray(h,r),o}return e.prototype.addBaseTextureAt=function(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},e.prototype.bind=function(t){n.prototype.bind.call(this,t),t.target=TARGETS.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,r,o){var s=this,a=s.length,u=s.itemDirtyIds,h=s.items,l=t.gl;o.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,o.internalFormat,this._width,this._height,a,0,r.format,o.type,null);for(var c=0;c<a;c++){var _=h[c];u[c]<_.dirtyId&&(u[c]=_.dirtyId,_.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,c,_.resource.width,_.resource.height,1,r.format,o.type,_.resource.source))}return!0},e})(AbstractMultiResource),BaseImageResource=(function(n){__extends$i(e,n);function e(t){var r=this,o=t,s=o.naturalWidth||o.videoWidth||o.width,a=o.naturalHeight||o.videoHeight||o.height;return r=n.call(this,s,a)||this,r.source=t,r.noSubImage=!1,r}return e.crossOrigin=function(t,r,o){o===void 0&&r.indexOf("data:")!==0?t.crossOrigin=determineCrossOrigin(r):o!==!1&&(t.crossOrigin=typeof o=="string"?o:"anonymous")},e.prototype.upload=function(t,r,o,s){var a=t.gl,u=r.realWidth,h=r.realHeight;if(s=s||this.source,s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&r.target===a.TEXTURE_2D&&o.width===u&&o.height===h?a.texSubImage2D(a.TEXTURE_2D,0,0,0,r.format,o.type,s):(o.width=u,o.height=h,a.texImage2D(r.target,0,o.internalFormat,r.format,o.type,s)),!0},e.prototype.update=function(){if(!this.destroyed){var t=this.source,r=t.naturalWidth||t.videoWidth||t.width,o=t.naturalHeight||t.videoHeight||t.height;this.resize(r,o),n.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e})(Resource),CanvasResource=(function(n){__extends$i(e,n);function e(t){return n.call(this,t)||this}return e.test=function(t){var r=globalThis.OffscreenCanvas;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e})(BaseImageResource),CubeResource=(function(n){__extends$i(e,n);function e(t,r){var o=this,s=r||{},a=s.width,u=s.height,h=s.autoLoad,l=s.linkBaseTexture;if(t&&t.length!==e.SIDES)throw new Error("Invalid length. Got "+t.length+", expected 6");o=n.call(this,6,{width:a,height:u})||this;for(var c=0;c<e.SIDES;c++)o.items[c].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+c;return o.linkBaseTexture=l!==!1,t&&o.initFromArray(t,r),h!==!1&&o.load(),o}return e.prototype.bind=function(t){n.prototype.bind.call(this,t),t.target=TARGETS.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,r,o){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+r,t.parentTextureArray=this.baseTexture,this.items[r]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[r]=t,this},e.prototype.upload=function(t,r,o){for(var s=this.itemDirtyIds,a=0;a<e.SIDES;a++){var u=this.items[a];(s[a]<u.dirtyId||o.dirtyId<r.dirtyId)&&(u.valid&&u.resource?(u.resource.upload(t,u,o),s[a]=u.dirtyId):s[a]<-1&&(t.gl.texImage2D(u.target,0,o.internalFormat,r.realWidth,r.realHeight,0,r.format,o.type,null),s[a]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e})(AbstractMultiResource),ImageResource=(function(n){__extends$i(e,n);function e(t,r){var o=this;if(r=r||{},!(t instanceof HTMLImageElement)){var s=new Image;BaseImageResource.crossOrigin(s,t,r.crossorigin),s.src=t,t=s}return o=n.call(this,t)||this,!t.complete&&o._width&&o._height&&(o._width=0,o._height=0),o.url=t.src,o._process=null,o.preserveBitmap=!1,o.createBitmap=(r.createBitmap!==void 0?r.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,o.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,o.bitmap=null,o._load=null,r.autoLoad!==!1&&o.load(),o}return e.prototype.load=function(t){var r=this;return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise(function(o,s){var a=r.source;r.url=a.src;var u=function(){r.destroyed||(a.onload=null,a.onerror=null,r.resize(a.width,a.height),r._load=null,r.createBitmap?o(r.process()):o(r))};a.complete&&a.src?u():(a.onload=u,a.onerror=function(h){s(h),r.onError.emit(h)})}),this._load)},e.prototype.process=function(){var t=this,r=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var o=globalThis.createImageBitmap,s=!r.crossOrigin||r.crossOrigin==="anonymous";return this._process=fetch(r.src,{mode:s?"cors":"no-cors"}).then(function(a){return a.blob()}).then(function(a){return o(a,0,0,r.width,r.height,{premultiplyAlpha:t.alphaMode===null||t.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})}).then(function(a){return t.destroyed?Promise.reject():(t.bitmap=a,t.update(),t._process=null,Promise.resolve(t))}),this._process},e.prototype.upload=function(t,r,o){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return n.prototype.upload.call(this,t,r,o);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(n.prototype.upload.call(this,t,r,o,this.bitmap),!this.preserveBitmap){var s=!0,a=r._glTextures;for(var u in a){var h=a[u];if(h!==o&&h.dirtyId!==r.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,n.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return typeof t=="string"||t instanceof HTMLImageElement},e})(BaseImageResource),SVGResource=(function(n){__extends$i(e,n);function e(t,r){var o=this;return r=r||{},o=n.call(this,settings.ADAPTER.createCanvas())||this,o._width=0,o._height=0,o.svg=t,o.scale=r.scale||1,o._overrideWidth=r.width,o._overrideHeight=r.height,o._resolve=null,o._crossorigin=r.crossorigin,o._load=null,r.autoLoad!==!1&&o.load(),o}return e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(r){if(t._resolve=function(){t.resize(t.source.width,t.source.height),r(t)},e.SVG_XML.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var t=this,r=new Image;BaseImageResource.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(o){t._resolve&&(r.onerror=null,t.onError.emit(o))},r.onload=function(){if(t._resolve){var o=r.width,s=r.height;if(!o||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var a=o*t.scale,u=s*t.scale;(t._overrideWidth||t._overrideHeight)&&(a=t._overrideWidth||t._overrideHeight/s*o,u=t._overrideHeight||t._overrideWidth/o*s),a=Math.round(a),u=Math.round(u);var h=t.source;h.width=a,h.height=u,h._pixiId="canvas_"+uid(),h.getContext("2d").drawImage(r,0,0,o,s,0,0,a,u),t._resolve(),t._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),o={};return r&&(o[r[1]]=Math.round(parseFloat(r[3])),o[r[5]]=Math.round(parseFloat(r[7]))),o},e.prototype.dispose=function(){n.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,r){return r==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&e.SVG_XML.test(t)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e})(BaseImageResource),VideoResource=(function(n){__extends$i(e,n);function e(t,r){var o=this;if(r=r||{},!(t instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);var a=t[0].src||t[0];BaseImageResource.crossOrigin(s,a,r.crossorigin);for(var u=0;u<t.length;++u){var h=document.createElement("source"),l=t[u],c=l.src,_=l.mime;c=c||t[u];var d=c.split("?").shift().toLowerCase(),y=d.slice(d.lastIndexOf(".")+1);_=_||e.MIME_TYPES[y]||"video/"+y,h.src=c,h.type=_,s.appendChild(h)}t=s}return o=n.call(this,t)||this,o.noSubImage=!0,o._autoUpdate=!0,o._isConnectedToTicker=!1,o._updateFPS=r.updateFPS||0,o._msToNextUpdate=0,o.autoPlay=r.autoPlay!==!1,o._load=null,o._resolve=null,o._onCanPlay=o._onCanPlay.bind(o),o._onError=o._onError.bind(o),r.autoLoad!==!1&&o.load(),o}return e.prototype.update=function(t){if(!this.destroyed){var r=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(n.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(o){t.valid?o(t):(t._resolve=o,r.load())}),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()},e.prototype._isSourceReady=function(){var t=this.source;return t.readyState>2},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(t.videoWidth,t.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);var t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),n.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,r){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e})(BaseImageResource),ImageBitmapResource=(function(n){__extends$i(e,n);function e(t){return n.call(this,t)||this}return e.test=function(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&t instanceof ImageBitmap},e})(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var DepthResource=(function(n){__extends$i(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.upload=function(t,r,o){var s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ALPHA_MODES.UNPACK);var a=r.realWidth,u=r.realHeight;return o.width===a&&o.height===u?s.texSubImage2D(r.target,0,0,0,a,u,r.format,o.type,this.data):(o.width=a,o.height=u,s.texImage2D(r.target,0,o.internalFormat,a,u,0,r.format,o.type,this.data)),!0},e})(BufferResource),Framebuffer=(function(){function n(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}return Object.defineProperty(n.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),n.prototype.addColorTexture=function(e,t){return e===void 0&&(e=0),this.colorTextures[e]=t||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},n.prototype.addDepthTexture=function(e){return this.depthTexture=e||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},n.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},n.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},n.prototype.resize=function(e,t){if(e=Math.round(e),t=Math.round(t),!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var o=this.colorTextures[r],s=o.resolution;o.setSize(e/s,t/s)}if(this.depthTexture){var s=this.depthTexture.resolution;this.depthTexture.setSize(e/s,t/s)}}},n.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},n.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},n})(),BaseRenderTexture=(function(n){__extends$i(e,n);function e(t){t===void 0&&(t={});var r=this;if(typeof t=="number"){var o=arguments[0],s=arguments[1],a=arguments[2],u=arguments[3];t={width:o,height:s,scaleMode:a,resolution:u}}return t.width=t.width||100,t.height=t.height||100,t.multisample=t.multisample!==void 0?t.multisample:MSAA_QUALITY.NONE,r=n.call(this,null,t)||this,r.mipmap=MIPMAP_MODES.OFF,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new Framebuffer(r.realWidth,r.realHeight).addColorTexture(0,r),r.framebuffer.multisample=t.multisample,r.maskStack=[],r.filterStack=[{}],r}return e.prototype.resize=function(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),n.prototype.dispose.call(this)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e})(BaseTexture),TextureUvs=(function(){function n(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return n.prototype.set=function(e,t,r){var o=t.width,s=t.height;if(r){var a=e.width/2/o,u=e.height/2/s,h=e.x/o+a,l=e.y/s+u;r=groupD8.add(r,groupD8.NW),this.x0=h+a*groupD8.uX(r),this.y0=l+u*groupD8.uY(r),r=groupD8.add(r,2),this.x1=h+a*groupD8.uX(r),this.y1=l+u*groupD8.uY(r),r=groupD8.add(r,2),this.x2=h+a*groupD8.uX(r),this.y2=l+u*groupD8.uY(r),r=groupD8.add(r,2),this.x3=h+a*groupD8.uX(r),this.y3=l+u*groupD8.uY(r)}else this.x0=e.x/o,this.y0=e.y/s,this.x1=(e.x+e.width)/o,this.y1=e.y/s,this.x2=(e.x+e.width)/o,this.y2=(e.y+e.height)/s,this.x3=e.x/o,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},n.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},n})(),DEFAULT_UVS=new TextureUvs;function removeAllHandlers(n){n.destroy=function(){},n.on=function(){},n.once=function(){},n.emit=function(){}}var Texture=(function(n){__extends$i(e,n);function e(t,r,o,s,a,u){var h=n.call(this)||this;if(h.noFrame=!1,r||(h.noFrame=!0,r=new Rectangle(0,0,1,1)),t instanceof e&&(t=t.baseTexture),h.baseTexture=t,h._frame=r,h.trim=s,h.valid=!1,h._uvs=DEFAULT_UVS,h.uvMatrix=null,h.orig=o||r,h._rotate=Number(a||0),a===!0)h._rotate=2;else if(h._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return h.defaultAnchor=u?new Point(u.x,u.y):new Point(0,0),h._updateID=0,h.textureCacheIds=[],t.valid?h.noFrame?t.valid&&h.onBaseTextureUpdated(t):h.frame=r:t.once("loaded",h.onBaseTextureUpdated,h),h.noFrame&&t.on("update",h.onBaseTextureUpdated,h),h}return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture.resource;r&&r.url&&TextureCache[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),o=new e(this.baseTexture,!this.noFrame&&t,r,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(o._frame=t),o},e.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,o){r===void 0&&(r={}),o===void 0&&(o=settings.STRICT_TEXTURE_CACHE);var s=typeof t=="string",a=null;if(s)a=t;else if(t instanceof BaseTexture){if(!t.cacheId){var u=r&&r.pixiIdPrefix||"pixiid";t.cacheId=u+"-"+uid(),BaseTexture.addToCache(t,t.cacheId)}a=t.cacheId}else{if(!t._pixiId){var u=r&&r.pixiIdPrefix||"pixiid";t._pixiId=u+"_"+uid()}a=t._pixiId}var h=TextureCache[a];if(s&&o&&!h)throw new Error('The cacheId "'+a+'" does not exist in TextureCache.');return!h&&!(t instanceof BaseTexture)?(r.resolution||(r.resolution=getResolutionOfUrl(t)),h=new e(new BaseTexture(t,r)),h.baseTexture.cacheId=a,BaseTexture.addToCache(h.baseTexture,a),e.addToCache(h,a)):!h&&t instanceof BaseTexture&&(h=new e(t),e.addToCache(h,a)),h},e.fromURL=function(t,r){var o=Object.assign({autoLoad:!1},r?.resourceOptions),s=e.from(t,Object.assign({resourceOptions:o},r),!1),a=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):a.load().then(function(){return Promise.resolve(s)})},e.fromBuffer=function(t,r,o,s){return new e(BaseTexture.fromBuffer(t,r,o,s))},e.fromLoader=function(t,r,o,s){var a=new BaseTexture(t,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(r)},s)),u=a.resource;u instanceof ImageResource&&(u.url=r);var h=new e(a);return o||(o=r),BaseTexture.addToCache(h.baseTexture,o),e.addToCache(h,o),o!==r&&(BaseTexture.addToCache(h.baseTexture,r),e.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(function(l){h.baseTexture.once("loaded",function(){return l(h)})})},e.addToCache=function(t,r){r&&(t.textureCacheIds.indexOf(r)===-1&&t.textureCacheIds.push(r),TextureCache[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),TextureCache[r]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var r=TextureCache[t];if(r){var o=r.textureCacheIds.indexOf(t);return o>-1&&r.textureCacheIds.splice(o,1),delete TextureCache[t],r}}else if(t&&t.textureCacheIds){for(var s=0;s<t.textureCacheIds.length;++s)TextureCache[t.textureCacheIds[s]]===t&&delete TextureCache[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var r=t.x,o=t.y,s=t.width,a=t.height,u=r+s>this.baseTexture.width,h=o+a>this.baseTexture.height;if(u||h){var l=u&&h?"and":"or",c="X: "+r+" + "+s+" = "+(r+s)+" > "+this.baseTexture.width,_="Y: "+o+" + "+a+" = "+(o+a)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(c+" "+l+" "+_))}this.valid=s&&a&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(e,"EMPTY",{get:function(){return e._EMPTY||(e._EMPTY=new e(new BaseTexture),removeAllHandlers(e._EMPTY),removeAllHandlers(e._EMPTY.baseTexture)),e._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WHITE",{get:function(){if(!e._WHITE){var t=settings.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),e._WHITE=new e(BaseTexture.from(t)),removeAllHandlers(e._WHITE),removeAllHandlers(e._WHITE.baseTexture)}return e._WHITE},enumerable:!1,configurable:!0}),e})(i),RenderTexture=(function(n){__extends$i(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.valid=!0,o.filterFrame=null,o.filterPoolKey=null,o.updateUvs(),o}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,r,o){o===void 0&&(o=!0);var s=this.baseTexture.resolution,a=Math.round(t*s)/s,u=Math.round(r*s)/s;this.valid=a>0&&u>0,this._frame.width=this.orig.width=a,this._frame.height=this.orig.height=u,o&&this.baseTexture.resize(a,u),this.updateUvs()},e.prototype.setResolution=function(t){var r=this.baseTexture;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))},e.create=function(t){for(var r=arguments,o=[],s=1;s<arguments.length;s++)o[s-1]=r[s];return typeof t=="number"&&(deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:o[0],scaleMode:o[1],resolution:o[2]}),new e(new BaseRenderTexture(t))},e})(Texture),RenderTexturePool=(function(){function n(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return n.prototype.createTexture=function(e,t,r){r===void 0&&(r=MSAA_QUALITY.NONE);var o=new BaseRenderTexture(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new RenderTexture(o)},n.prototype.getOptimalTexture=function(e,t,r,o){r===void 0&&(r=1),o===void 0&&(o=MSAA_QUALITY.NONE);var s;e=Math.ceil(e*r-1e-6),t=Math.ceil(t*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=nextPow2(e),t=nextPow2(t),s=((e&65535)<<16|t&65535)>>>0,o>1&&(s+=o*4294967296)):s=o>1?-o:-1,this.texturePool[s]||(this.texturePool[s]=[]);var a=this.texturePool[s].pop();return a||(a=this.createTexture(e,t,o)),a.filterPoolKey=s,a.setResolution(r),a},n.prototype.getFilterTexture=function(e,t,r){var o=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||MSAA_QUALITY.NONE);return o.filterFrame=e.filterFrame,o},n.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},n.prototype.returnFilterTexture=function(e){this.returnTexture(e)},n.prototype.clear=function(e){if(e=e!==!1,e)for(var t in this.texturePool){var r=this.texturePool[t];if(r)for(var o=0;o<r.length;o++)r[o].destroy(!0)}this.texturePool={}},n.prototype.setScreenSize=function(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(var t in this.texturePool)if(Number(t)<0){var r=this.texturePool[t];if(r)for(var o=0;o<r.length;o++)r[o].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}},n.SCREEN_KEY=-1,n})(),Attribute=(function(){function n(e,t,r,o,s,a,u){t===void 0&&(t=0),r===void 0&&(r=!1),o===void 0&&(o=TYPES.FLOAT),this.buffer=e,this.size=t,this.normalized=r,this.type=o,this.stride=s,this.start=a,this.instance=u}return n.prototype.destroy=function(){this.buffer=null},n.from=function(e,t,r,o,s){return new n(e,t,r,o,s)},n})(),UID$4=0,Buffer=(function(){function n(e,t,r){t===void 0&&(t=!0),r===void 0&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}return n.prototype.update=function(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++},n.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},n.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(n.prototype,"index",{get:function(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),n.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new n(e)},n})(),map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(n,e){for(var t=0,r=0,o={},s=0;s<n.length;s++)r+=e[s],t+=n[s].length;for(var a=new ArrayBuffer(t*4),u=null,h=0,s=0;s<n.length;s++){var l=e[s],c=n[s],_=getBufferType(c);o[_]||(o[_]=new map$1[_](a)),u=o[_];for(var d=0;d<c.length;d++){var y=(d/l|0)*r+h,m=d%l;u[y+m]=c[d]}h+=l}return new Float32Array(a)}var byteSizeMap$1={5126:4,5123:2,5121:1},UID$3=0,map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Geometry=(function(){function n(e,t){e===void 0&&(e=[]),t===void 0&&(t={}),this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}return n.prototype.addAttribute=function(e,t,r,o,s,a,u,h){if(r===void 0&&(r=0),o===void 0&&(o=!1),h===void 0&&(h=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Buffer||(t instanceof Array&&(t=new Float32Array(t)),t=new Buffer(t));var l=e.split("|");if(l.length>1){for(var c=0;c<l.length;c++)this.addAttribute(l[c],t,r,o,s);return this}var _=this.buffers.indexOf(t);return _===-1&&(this.buffers.push(t),_=this.buffers.length-1),this.attributes[e]=new Attribute(_,r,o,s,a,u,h),this.instanced=this.instanced||h,this},n.prototype.getAttribute=function(e){return this.attributes[e]},n.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},n.prototype.addIndex=function(e){return e instanceof Buffer||(e instanceof Array&&(e=new Uint16Array(e)),e=new Buffer(e)),e.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.indexOf(e)===-1&&this.buffers.push(e),this},n.prototype.getIndex=function(){return this.indexBuffer},n.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var e=[],t=[],r=new Buffer,o;for(o in this.attributes){var s=this.attributes[o],a=this.buffers[s.buffer];e.push(a.data),t.push(s.size*byteSizeMap$1[s.type]/4),s.buffer=0}for(r.data=interleaveTypedArrays(e,t),o=0;o<this.buffers.length;o++)this.buffers[o]!==this.indexBuffer&&this.buffers[o].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},n.prototype.getSize=function(){for(var e in this.attributes){var t=this.attributes[e],r=this.buffers[t.buffer];return r.data.length/(t.stride/4||t.size)}return 0},n.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},n.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},n.prototype.clone=function(){for(var e=new n,t=0;t<this.buffers.length;t++)e.buffers[t]=new Buffer(this.buffers[t].data.slice(0));for(var t in this.attributes){var r=this.attributes[t];e.attributes[t]=new Attribute(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),e},n.merge=function(e){for(var t=new n,r=[],o=[],s=[],a,u=0;u<e.length;u++){a=e[u];for(var h=0;h<a.buffers.length;h++)o[h]=o[h]||0,o[h]+=a.buffers[h].data.length,s[h]=0}for(var u=0;u<a.buffers.length;u++)r[u]=new map[getBufferType(a.buffers[u].data)](o[u]),t.buffers[u]=new Buffer(r[u]);for(var u=0;u<e.length;u++){a=e[u];for(var h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,s[h]),s[h]+=a.buffers[h].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;for(var l=0,c=0,_=0,d=0,u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){d=u;break}for(var u in a.attributes){var y=a.attributes[u];(y.buffer|0)===d&&(c+=y.size*byteSizeMap$1[y.type]/4)}for(var u=0;u<e.length;u++){for(var m=e[u].indexBuffer.data,h=0;h<m.length;h++)t.indexBuffer.data[h+_]+=l;l+=e[u].buffers[d].data.length/c,_+=m.length}}return t},n})(),Quad=(function(n){__extends$i(e,n);function e(){var t=n.call(this)||this;return t.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),t}return e})(Geometry),QuadUv=(function(n){__extends$i(e,n);function e(){var t=n.call(this)||this;return t.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.vertexBuffer=new Buffer(t.vertices),t.uvBuffer=new Buffer(t.uvs),t.addAttribute("aVertexPosition",t.vertexBuffer).addAttribute("aTextureCoord",t.uvBuffer).addIndex([0,1,2,0,2,3]),t}return e.prototype.map=function(t,r){var o=0,s=0;return this.uvs[0]=o,this.uvs[1]=s,this.uvs[2]=o+r.width/t.width,this.uvs[3]=s,this.uvs[4]=o+r.width/t.width,this.uvs[5]=s+r.height/t.height,this.uvs[6]=o,this.uvs[7]=s+r.height/t.height,o=r.x,s=r.y,this.vertices[0]=o,this.vertices[1]=s,this.vertices[2]=o+r.width,this.vertices[3]=s,this.vertices[4]=o+r.width,this.vertices[5]=s+r.height,this.vertices[6]=o,this.vertices[7]=s+r.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e})(Geometry),UID$2=0,UniformGroup=(function(){function n(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!t,this.ubo=!!r,e instanceof Buffer?(this.buffer=e,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Buffer(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}return n.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},n.prototype.add=function(e,t,r){if(!this.ubo)this.uniforms[e]=new n(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},n.from=function(e,t,r){return new n(e,t,r)},n.uboFrom=function(e,t){return new n(e,t??!0,!0)},n})(),FilterState=(function(){function n(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}return n.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},n})(),tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$2=new Matrix,FilterSystem=(function(){function n(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return n.prototype.push=function(e,t){for(var r,o,s=this.renderer,a=this.defaultFilterStack,u=this.statePool.pop()||new FilterState,h=this.renderer.renderTexture,l=t[0].resolution,c=t[0].multisample,_=t[0].padding,d=t[0].autoFit,y=(r=t[0].legacy)!==null&&r!==void 0?r:!0,m=1;m<t.length;m++){var g=t[m];l=Math.min(l,g.resolution),c=Math.min(c,g.multisample),_=this.useMaxPadding?Math.max(_,g.padding):_+g.padding,d=d&&g.autoFit,y=y||((o=g.legacy)!==null&&o!==void 0?o:!0)}a.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),a.push(u),u.resolution=l,u.multisample=c,u.legacy=y,u.target=e,u.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),u.sourceFrame.pad(_);var v=this.tempRect.copyFrom(h.sourceFrame);s.projection.transform&&this.transformAABB(tempMatrix$2.copyFrom(s.projection.transform).invert(),v),d?(u.sourceFrame.fit(v),(u.sourceFrame.width<=0||u.sourceFrame.height<=0)&&(u.sourceFrame.width=0,u.sourceFrame.height=0)):u.sourceFrame.intersects(v)||(u.sourceFrame.width=0,u.sourceFrame.height=0),this.roundFrame(u.sourceFrame,h.current?h.current.resolution:s.resolution,h.sourceFrame,h.destinationFrame,s.projection.transform),u.renderTexture=this.getOptimalFilterTexture(u.sourceFrame.width,u.sourceFrame.height,l,c),u.filters=t,u.destinationFrame.width=u.renderTexture.width,u.destinationFrame.height=u.renderTexture.height;var T=this.tempRect;T.x=0,T.y=0,T.width=u.sourceFrame.width,T.height=u.sourceFrame.height,u.renderTexture.filterFrame=u.sourceFrame,u.bindingSourceFrame.copyFrom(h.sourceFrame),u.bindingDestinationFrame.copyFrom(h.destinationFrame),u.transform=s.projection.transform,s.projection.transform=null,h.bind(u.renderTexture,u.sourceFrame,T),s.framebuffer.clear(0,0,0,0)},n.prototype.pop=function(){var e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;var o=this.globalUniforms.uniforms;o.outputFrame=t.sourceFrame,o.resolution=t.resolution;var s=o.inputSize,a=o.inputPixel,u=o.inputClamp;if(s[0]=t.destinationFrame.width,s[1]=t.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=Math.round(s[0]*t.resolution),a[1]=Math.round(s[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],u[0]=.5*a[2],u[1]=.5*a[3],u[2]=t.sourceFrame.width*s[2]-.5*a[2],u[3]=t.sourceFrame.height*s[3]-.5*a[3],t.legacy){var h=o.filterArea;h[0]=t.destinationFrame.width,h[1]=t.destinationFrame.height,h[2]=t.sourceFrame.x,h[3]=t.sourceFrame.y,o.filterClamp=o.inputClamp}this.globalUniforms.update();var l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,l.renderTexture,CLEAR_MODES.BLEND,t),this.returnFilterTexture(t.renderTexture);else{var c=t.renderTexture,_=this.getOptimalFilterTexture(c.width,c.height,t.resolution);_.filterFrame=c.filterFrame;var d=0;for(d=0;d<r.length-1;++d){d===1&&t.multisample>1&&(_=this.getOptimalFilterTexture(c.width,c.height,t.resolution),_.filterFrame=c.filterFrame),r[d].apply(this,c,_,CLEAR_MODES.CLEAR,t);var y=c;c=_,_=y}r[d].apply(this,c,l.renderTexture,CLEAR_MODES.BLEND,t),d>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(_)}t.clear(),this.statePool.push(t)},n.prototype.bindAndClear=function(e,t){t===void 0&&(t=CLEAR_MODES.CLEAR);var r=this.renderer,o=r.renderTexture,s=r.state;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame){var a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,o.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?o.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var u=s.stateId&1||this.forceClear;(t===CLEAR_MODES.CLEAR||t===CLEAR_MODES.BLIT&&u)&&this.renderer.framebuffer.clear(0,0,0,0)},n.prototype.applyFilter=function(e,t,r,o){var s=this.renderer;s.state.set(e.state),this.bindAndClear(r,o),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(DRAW_MODES.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))},n.prototype.calculateSpriteMatrix=function(e,t){var r=this.activeState,o=r.sourceFrame,s=r.destinationFrame,a=t._texture.orig,u=e.set(s.width,0,0,s.height,o.x,o.y),h=t.worldTransform.copyTo(Matrix.TEMP_MATRIX);return h.invert(),u.prepend(h),u.scale(1/a.width,1/a.height),u.translate(t.anchor.x,t.anchor.y),u},n.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},n.prototype.getOptimalFilterTexture=function(e,t,r,o){return r===void 0&&(r=1),o===void 0&&(o=MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(e,t,r,o)},n.prototype.getFilterTexture=function(e,t,r){if(typeof e=="number"){var o=e;e=t,t=o}e=e||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||MSAA_QUALITY.NONE);return s.filterFrame=e.filterFrame,s},n.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},n.prototype.emptyPool=function(){this.texturePool.clear(!0)},n.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},n.prototype.transformAABB=function(e,t){var r=tempPoints[0],o=tempPoints[1],s=tempPoints[2],a=tempPoints[3];r.set(t.left,t.top),o.set(t.left,t.bottom),s.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(r,r),e.apply(o,o),e.apply(s,s),e.apply(a,a);var u=Math.min(r.x,o.x,s.x,a.x),h=Math.min(r.y,o.y,s.y,a.y),l=Math.max(r.x,o.x,s.x,a.x),c=Math.max(r.y,o.y,s.y,a.y);t.x=u,t.y=h,t.width=l-u,t.height=c-h},n.prototype.roundFrame=function(e,t,r,o,s){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(s){var a=s.a,u=s.b,h=s.c,l=s.d;if((Math.abs(u)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}s=s?tempMatrix$2.copyFrom(s):tempMatrix$2.identity(),s.translate(-r.x,-r.y).scale(o.width/r.width,o.height/r.height).translate(o.x,o.y),this.transformAABB(s,e),e.ceil(t),this.transformAABB(s.invert(),e)}},n})(),ObjectRenderer=(function(){function n(e){this.renderer=e}return n.prototype.flush=function(){},n.prototype.destroy=function(){this.renderer=null},n.prototype.start=function(){},n.prototype.stop=function(){this.flush()},n.prototype.render=function(e){},n})(),BatchSystem=(function(){function n(e){this.renderer=e,this.emptyRenderer=new ObjectRenderer(e),this.currentRenderer=this.emptyRenderer}return n.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},n.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},n.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},n.prototype.copyBoundTextures=function(e,t){for(var r=this.renderer.texture.boundTextures,o=t-1;o>=0;--o)e[o]=r[o]||null,e[o]&&(e[o]._batchLocation=o)},n.prototype.boundArray=function(e,t,r,o){for(var s=e.elements,a=e.ids,u=e.count,h=0,l=0;l<u;l++){var c=s[l],_=c._batchLocation;if(_>=0&&_<o&&t[_]===c){a[l]=_;continue}for(;h<o;){var d=t[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}a[l]=h,c._batchLocation=h,t[h]=c;break}}},n.prototype.destroy=function(){this.renderer=null},n})(),CONTEXT_UID_COUNTER=0,ContextSystem=(function(){function n(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(n.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),n.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++},n.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(e)},n.prototype.initFromOptions=function(e){var t=this.createContext(this.renderer.view,e);this.initFromContext(t)},n.prototype.createContext=function(e,t){var r;if(settings.PREFER_ENV>=ENV.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},n.prototype.getExtensions=function(){var e=this.gl,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})},n.prototype.handleContextLost=function(e){var t=this;e.preventDefault(),setTimeout(function(){t.gl.isContextLost()&&t.extensions.loseContext&&t.extensions.loseContext.restoreContext()},0)},n.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},n.prototype.destroy=function(){var e=this.renderer.view;this.renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},n.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},n.prototype.validateContext=function(e){var t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var o=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=o,o||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},n})(),GLFramebuffer=(function(){function n(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return n})(),tempRectangle=new Rectangle,FramebufferSystem=(function(){function n(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}return n.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=function(o){return t.drawBuffersWEBGL(o)}:(this.hasMRT=!1,e.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},n.prototype.bind=function(e,t,r){r===void 0&&(r=0);var o=this.gl;if(e){var s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,o.bindFramebuffer(o.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,s.mipLevel=r),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,s.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var a=0;a<e.colorTextures.length;a++){var u=e.colorTextures[a];this.renderer.texture.unbind(u.parentTextureArray||u)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){var h=t.width>>r,l=t.height>>r,c=h/t.width;this.setViewport(t.x*c,t.y*c,h,l)}else{var h=e.width>>r,l=e.height>>r;this.setViewport(0,0,h,l)}}else this.current&&(this.current=null,o.bindFramebuffer(o.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},n.prototype.setViewport=function(e,t,r,o){var s=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),o=Math.round(o),(s.width!==r||s.height!==o||s.x!==e||s.y!==t)&&(s.x=e,s.y=t,s.width=r,s.height=o,this.gl.viewport(e,t,r,o))},Object.defineProperty(n.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),n.prototype.clear=function(e,t,r,o,s){s===void 0&&(s=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH);var a=this.gl;a.clearColor(e,t,r,o),a.clear(s)},n.prototype.initFramebuffer=function(e){var t=this.gl,r=new GLFramebuffer(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r},n.prototype.resizeFramebuffer=function(e){var t=this.gl,r=e.glFramebuffers[this.CONTEXT_UID];r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.RGBA8,e.width,e.height)),r.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));var o=e.colorTextures,s=o.length;t.drawBuffers||(s=Math.min(s,1));for(var a=0;a<s;a++){var u=o[a],h=u.parentTextureArray||u;this.renderer.texture.bind(h,0)}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)},n.prototype.updateFramebuffer=function(e,t){var r=this.gl,o=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures,a=s.length;r.drawBuffers||(a=Math.min(a,1)),o.multisample>1&&this.canMultisampleFramebuffer(e)?(o.msaaBuffer=o.msaaBuffer||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,o.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,o.multisample,r.RGBA8,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,o.msaaBuffer)):o.msaaBuffer&&(r.deleteRenderbuffer(o.msaaBuffer),o.msaaBuffer=null,o.blitFramebuffer&&(o.blitFramebuffer.dispose(),o.blitFramebuffer=null));for(var u=[],h=0;h<a;h++){var l=s[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),!(h===0&&o.msaaBuffer)&&(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,t),u.push(r.COLOR_ATTACHMENT0+h))}if(u.length>1&&r.drawBuffers(u),e.depthTexture){var _=this.writeDepthTexture;if(_){var d=e.depthTexture;this.renderer.texture.bind(d,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,t)}}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(o.stencil=o.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,o.stencil),o.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,o.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,o.stencil)):o.stencil&&(r.deleteRenderbuffer(o.stencil),o.stencil=null)},n.prototype.canMultisampleFramebuffer=function(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture},n.prototype.detectSamples=function(e){var t=this.msaaSamples,r=MSAA_QUALITY.NONE;if(e<=1||t===null)return r;for(var o=0;o<t.length;o++)if(t[o]<=e){r=t[o];break}return r===1&&(r=MSAA_QUALITY.NONE),r},n.prototype.blit=function(e,t,r){var o=this,s=o.current,a=o.renderer,u=o.gl,h=o.CONTEXT_UID;if(a.context.webGLVersion===2&&s){var l=s.glFramebuffers[h];if(l){if(!e){if(!l.msaaBuffer)return;var c=s.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new Framebuffer(s.width,s.height),l.blitFramebuffer.addColorTexture(0,c)),e=l.blitFramebuffer,e.colorTextures[0]!==c&&(e.colorTextures[0]=c,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=tempRectangle,t.width=s.width,t.height=s.height),r||(r=t);var _=t.width===r.width&&t.height===r.height;this.bind(e),u.bindFramebuffer(u.READ_FRAMEBUFFER,l.framebuffer),u.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,u.COLOR_BUFFER_BIT,_?u.NEAREST:u.LINEAR)}}},n.prototype.disposeFramebuffer=function(e,t){var r=e.glFramebuffers[this.CONTEXT_UID],o=this.gl;if(r){delete e.glFramebuffers[this.CONTEXT_UID];var s=this.managedFramebuffers.indexOf(e);s>=0&&this.managedFramebuffers.splice(s,1),e.disposeRunner.remove(this),t||(o.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&o.deleteRenderbuffer(r.msaaBuffer),r.stencil&&o.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}},n.prototype.disposeAll=function(e){var t=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)},n.prototype.forceStencil=function(){var e=this.current;if(e){var t=e.glFramebuffers[this.CONTEXT_UID];if(!(!t||t.stencil)){e.stencil=!0;var r=e.width,o=e.height,s=this.gl,a=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a),t.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,t.multisample,s.DEPTH24_STENCIL8,r,o):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,r,o),t.stencil=a,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)}}},n.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle},n.prototype.destroy=function(){this.renderer=null},n})(),byteSizeMap={5126:4,5123:2,5121:1},GeometrySystem=(function(){function n(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return n.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){var r=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=function(){return r.createVertexArrayOES()},e.bindVertexArray=function(s){return r.bindVertexArrayOES(s)},e.deleteVertexArray=function(s){return r.deleteVertexArrayOES(s)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(t.webGLVersion!==2){var o=e.getExtension("ANGLE_instanced_arrays");o?(e.vertexAttribDivisor=function(s,a){return o.vertexAttribDivisorANGLE(s,a)},e.drawElementsInstanced=function(s,a,u,h,l){return o.drawElementsInstancedANGLE(s,a,u,h,l)},e.drawArraysInstanced=function(s,a,u,h){return o.drawArraysInstancedANGLE(s,a,u,h)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex},n.prototype.bind=function(e,t){t=t||this.renderer.shader.shader;var r=this.gl,o=e.glVertexArrayObjects[this.CONTEXT_UID],s=!1;o||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=o={},s=!0);var a=o[t.program.id]||this.initGeometryVao(e,t,s);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()},n.prototype.reset=function(){this.unbind()},n.prototype.updateBuffers=function(){for(var e=this._activeGeometry,t=this.renderer.buffer,r=0;r<e.buffers.length;r++){var o=e.buffers[r];t.update(o)}},n.prototype.checkCompatibility=function(e,t){var r=e.attributes,o=t.attributeData;for(var s in o)if(!r[s])throw new Error('shader and geometry incompatible, geometry missing the "'+s+'" attribute')},n.prototype.getSignature=function(e,t){var r=e.attributes,o=t.attributeData,s=["g",e.id];for(var a in r)o[a]&&s.push(a,o[a].location);return s.join("-")},n.prototype.initGeometryVao=function(e,t,r){r===void 0&&(r=!0);var o=this.gl,s=this.CONTEXT_UID,a=this.renderer.buffer,u=t.program;u.glPrograms[s]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,u);var h=this.getSignature(e,u),l=e.glVertexArrayObjects[this.CONTEXT_UID],c=l[h];if(c)return l[u.id]=c,c;var _=e.buffers,d=e.attributes,y={},m={};for(var g in _)y[g]=0,m[g]=0;for(var g in d)!d[g].size&&u.attributeData[g]?d[g].size=u.attributeData[g].size:d[g].size||console.warn("PIXI Geometry attribute '"+g+"' size cannot be determined (likely the bound shader does not have the attribute)"),y[d[g].buffer]+=d[g].size*byteSizeMap[d[g].type];for(var g in d){var v=d[g],T=v.size;v.stride===void 0&&(y[v.buffer]===T*byteSizeMap[v.type]?v.stride=0:v.stride=y[v.buffer]),v.start===void 0&&(v.start=m[v.buffer],m[v.buffer]+=T*byteSizeMap[v.type])}c=o.createVertexArray(),o.bindVertexArray(c);for(var A=0;A<_.length;A++){var O=_[A];a.bind(O),r&&O._glBuffers[s].refCount++}return this.activateVao(e,u),this._activeVao=c,l[u.id]=c,l[h]=c,c},n.prototype.disposeGeometry=function(e,t){var r;if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var o=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,a=e.buffers,u=(r=this.renderer)===null||r===void 0?void 0:r.buffer;if(e.disposeRunner.remove(this),!!o){if(u)for(var h=0;h<a.length;h++){var l=a[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&u.dispose(a[h],t))}if(!t){for(var c in o)if(c[0]==="g"){var _=o[c];this._activeVao===_&&this.unbind(),s.deleteVertexArray(_)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},n.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedGeometries),r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)},n.prototype.activateVao=function(e,t){var r=this.gl,o=this.CONTEXT_UID,s=this.renderer.buffer,a=e.buffers,u=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);var h=null;for(var l in u){var c=u[l],_=a[c.buffer],d=_._glBuffers[o];if(t.attributeData[l]){h!==d&&(s.bind(_),h=d);var y=t.attributeData[l].location;if(r.enableVertexAttribArray(y),r.vertexAttribPointer(y,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)r.vertexAttribDivisor(y,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},n.prototype.draw=function(e,t,r,o){var s=this.gl,a=this._activeGeometry;if(a.indexBuffer){var u=a.indexBuffer.data.BYTES_PER_ELEMENT,h=u===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;u===2||u===4&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(e,t||a.indexBuffer.data.length,h,(r||0)*u,o||1):s.drawElements(e,t||a.indexBuffer.data.length,h,(r||0)*u):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(e,r,t||a.getSize(),o||1):s.drawArrays(e,r,t||a.getSize());return this},n.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},n.prototype.destroy=function(){this.renderer=null},n})(),MaskData=(function(){function n(e){e===void 0&&(e=null),this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=settings.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(n.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},n.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},n})();function compileShader(n,e,t){var r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}function logPrettyShaderError(n,e){var t=n.getShaderSource(e).split(`
`).map(function(l,c){return c+": "+l}),r=n.getShaderInfoLog(e),o=r.split(`
`),s={},a=o.map(function(l){return parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(l){return l&&!s[l]?(s[l]=!0,!0):!1}),u=[""];a.forEach(function(l){t[l-1]="%c"+t[l-1]+"%c",u.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var h=t.join(`
`);u[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,u),console.groupEnd()}function logProgramError(n,e,t,r){n.getProgramParameter(e,n.LINK_STATUS)||(n.getShaderParameter(t,n.COMPILE_STATUS)||logPrettyShaderError(n,t),n.getShaderParameter(r,n.COMPILE_STATUS)||logPrettyShaderError(n,r),console.error("PixiJS Error: Could not initialize shader."),n.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",n.getProgramInfoLog(e)))}function booleanArray(n){for(var e=new Array(n),t=0;t<e.length;t++)e[t]=!1;return e}function defaultValue(n,e){switch(n){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return booleanArray(2*e);case"bvec3":return booleanArray(3*e);case"bvec4":return booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var unknownContext={},context=unknownContext;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var n=settings.ADAPTER.createCanvas(),e=void 0;settings.PREFER_ENV>=ENV.WEBGL2&&(e=n.getContext("webgl2",{})),e||(e=n.getContext("webgl",{})||n.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),context=e}return context}var maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;var n=getTestContext();if(n&&n.getShaderPrecisionFormat){var e=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT);maxFragmentPrecision=e.precision?PRECISION.HIGH:PRECISION.MEDIUM}}return maxFragmentPrecision}function setPrecision(n,e,t){if(n.substring(0,9)!=="precision"){var r=e;return e===PRECISION.HIGH&&t!==PRECISION.HIGH&&(r=PRECISION.MEDIUM),"precision "+r+` float;
`+n}else if(t!==PRECISION.HIGH&&n.substring(0,15)==="precision highp")return n.replace("precision highp","precision mediump");return n}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(n){return GLSL_TO_SIZE[n]}var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(n,e){if(!GL_TABLE){var t=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var r=0;r<t.length;++r){var o=t[r];GL_TABLE[n[o]]=GL_TO_GLSL_TYPES[o]}}return GL_TABLE[e]}var uniformParsers=[{test:function(n){return n.type==="float"&&n.size===1&&!n.isArray},code:function(n){return`
            if(uv["`+n+'"] !== ud["'+n+`"].value)
            {
                ud["`+n+'"].value = uv["'+n+`"]
                gl.uniform1f(ud["`+n+'"].location, uv["'+n+`"])
            }
            `}},{test:function(n,e){return(n.type==="sampler2D"||n.type==="samplerCube"||n.type==="sampler2DArray")&&n.size===1&&!n.isArray&&(e==null||e.castToBaseTexture!==void 0)},code:function(n){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+n+`"], t);

            if(ud["`+n+`"].value !== t)
            {
                ud["`+n+`"].value = t;
                gl.uniform1i(ud["`+n+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(n,e){return n.type==="mat3"&&n.size===1&&!n.isArray&&e.a!==void 0},code:function(n){return`
            gl.uniformMatrix3fv(ud["`+n+'"].location, false, uv["'+n+`"].toArray(true));
            `},codeUbo:function(n){return`
                var `+n+"_matrix = uv."+n+`.toArray(true);

                data[offset] = `+n+`_matrix[0];
                data[offset+1] = `+n+`_matrix[1];
                data[offset+2] = `+n+`_matrix[2];
        
                data[offset + 4] = `+n+`_matrix[3];
                data[offset + 5] = `+n+`_matrix[4];
                data[offset + 6] = `+n+`_matrix[5];
        
                data[offset + 8] = `+n+`_matrix[6];
                data[offset + 9] = `+n+`_matrix[7];
                data[offset + 10] = `+n+`_matrix[8];
            `}},{test:function(n,e){return n.type==="vec2"&&n.size===1&&!n.isArray&&e.x!==void 0},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+n+`"].location, v.x, v.y);
                }`},codeUbo:function(n){return`
                v = uv.`+n+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(n){return n.type==="vec2"&&n.size===1&&!n.isArray},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+n+`"].location, v[0], v[1]);
                }
            `}},{test:function(n,e){return n.type==="vec4"&&n.size===1&&!n.isArray&&e.width!==void 0},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+n+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(n){return`
                    v = uv.`+n+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(n){return n.type==="vec4"&&n.size===1&&!n.isArray},code:function(n){return`
                cv = ud["`+n+`"].value;
                v = uv["`+n+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+n+`"].location, v[0], v[1], v[2], v[3])
                }`}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(n,e){var t,r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var o in n.uniforms){var s=e[o];if(!s){!((t=n.uniforms[o])===null||t===void 0)&&t.group&&(n.uniforms[o].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+o+", '"+o+`');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.`+o+`, syncData);
                    `));continue}for(var a=n.uniforms[o],u=!1,h=0;h<uniformParsers.length;h++)if(uniformParsers[h].test(s,a)){r.push(uniformParsers[h].code(o,a)),u=!0;break}if(!u){var l=s.size===1&&!s.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS,c=l[s.type].replace("location",'ud["'+o+'"].location');r.push(`
            cu = ud["`+o+`"];
            cv = cu.value;
            v = uv["`+o+`"];
            `+c+";")}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}var fragTemplate$1=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(n){for(var e="",t=0;t<n;++t)t>0&&(e+=`
else `),t<n-1&&(e+="if(test == "+t+".0){}");return e}function checkMaxIfStatementsInShader(n,e){if(n===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var t=e.createShader(e.FRAGMENT_SHADER);;){var r=fragTemplate$1.replace(/%forloop%/gi,generateIfTestSrc(n));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))n=n/2|0;else break}return n}var unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{var n=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=n({a:"b"},"a","b")===!0}catch{unsafeEval=!1}return unsafeEval}var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,UID$1=0,nameCache={},Program=(function(){function n(e,t,r){r===void 0&&(r="pixi-shader"),this.id=UID$1++,this.vertexSrc=e||n.defaultVertexSrc,this.fragmentSrc=t||n.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),nameCache[r]?(nameCache[r]++,r+="-"+nameCache[r]):nameCache[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(n,"defaultVertexSrc",{get:function(){return defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(n,"defaultFragmentSrc",{get:function(){return defaultFragment$2},enumerable:!1,configurable:!0}),n.from=function(e,t,r){var o=e+t,s=ProgramCache[o];return s||(ProgramCache[o]=s=new n(e,t,r)),s},n})(),Shader=(function(){function n(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof UniformGroup?this.uniformGroup=t:this.uniformGroup=new UniformGroup(t):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}return n.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var r in t.uniforms){var o=t.uniforms[r];if(o.group&&this.checkUniformExists(e,o))return!0}return!1},n.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(n.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),n.from=function(e,t,r){var o=Program.from(e,t);return new n(o,r)},n})(),BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5,State=(function(){function n(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(n.prototype,"blend",{get:function(){return!!(this.data&1<<BLEND$1)},set:function(e){!!(this.data&1<<BLEND$1)!==e&&(this.data^=1<<BLEND$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"offsets",{get:function(){return!!(this.data&1<<OFFSET$1)},set:function(e){!!(this.data&1<<OFFSET$1)!==e&&(this.data^=1<<OFFSET$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"culling",{get:function(){return!!(this.data&1<<CULLING$1)},set:function(e){!!(this.data&1<<CULLING$1)!==e&&(this.data^=1<<CULLING$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"depthTest",{get:function(){return!!(this.data&1<<DEPTH_TEST$1)},set:function(e){!!(this.data&1<<DEPTH_TEST$1)!==e&&(this.data^=1<<DEPTH_TEST$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"depthMask",{get:function(){return!!(this.data&1<<DEPTH_MASK$1)},set:function(e){!!(this.data&1<<DEPTH_MASK$1)!==e&&(this.data^=1<<DEPTH_MASK$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<WINDING$1)},set:function(e){!!(this.data&1<<WINDING$1)!==e&&(this.data^=1<<WINDING$1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==BLEND_MODES.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),n.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},n.for2d=function(){var e=new n;return e.depthTest=!1,e.blend=!0,e},n})(),defaultFragment$1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex$2=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Filter=(function(n){__extends$i(e,n);function e(t,r,o){var s=this,a=Program.from(t||e.defaultVertexSrc,r||e.defaultFragmentSrc);return s=n.call(this,a,o)||this,s.padding=0,s.resolution=settings.FILTER_RESOLUTION,s.multisample=settings.FILTER_MULTISAMPLE,s.enabled=!0,s.autoFit=!0,s.state=new State,s}return e.prototype.apply=function(t,r,o,s,a){t.applyFilter(this,r,o,s)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return defaultVertex$2},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return defaultFragment$1},enumerable:!1,configurable:!0}),e})(Shader),vertex$4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,fragment$7=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,tempMat$1=new Matrix,TextureMatrix=(function(){function n(e,t){this._texture=e,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}return Object.defineProperty(n.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),n.prototype.multiplyUvs=function(e,t){t===void 0&&(t=e);for(var r=this.mapCoord,o=0;o<e.length;o+=2){var s=e[o],a=e[o+1];t[o]=s*r.a+a*r.c+r.tx,t[o+1]=s*r.b+a*r.d+r.ty}return t},n.prototype.update=function(e){var t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;var r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var o=t.orig,s=t.trim;s&&(tempMat$1.set(o.width/s.width,0,0,o.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(tempMat$1));var a=t.baseTexture,u=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return u[0]=(t._frame.x+h+l)/a.width,u[1]=(t._frame.y+h+l)/a.height,u[2]=(t._frame.x+t._frame.width-h+l)/a.width,u[3]=(t._frame.y+t._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&t.rotate===0,!0},n})(),SpriteMaskFilter=(function(n){__extends$i(e,n);function e(t,r,o){var s=this,a=null;return typeof t!="string"&&r===void 0&&o===void 0&&(a=t,t=void 0,r=void 0,o=void 0),s=n.call(this,t||vertex$4,r||fragment$7,o)||this,s.maskSprite=a,s.maskMatrix=new Matrix,s}return Object.defineProperty(e.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,r,o,s){var a=this._maskSprite,u=a._texture;u.valid&&(u.uvMatrix||(u.uvMatrix=new TextureMatrix(u,0)),u.uvMatrix.update(),this.uniforms.npmAlpha=u.baseTexture.alphaMode?0:1,this.uniforms.mask=u,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,a).prepend(u.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=u.uvMatrix.uClampFrame,t.applyFilter(this,r,o,s))},e})(Filter),MaskSystem=(function(){function n(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return n.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},n.prototype.push=function(e,t){var r=t;if(!r.isMaskData){var o=this.maskDataPool.pop()||new MaskData;o.pooled=!0,o.maskObject=t,r=o}var s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==MASK_TYPES.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(r);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(r);break;case MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case MASK_TYPES.COLOR:this.pushColorMask(r);break}r.type===MASK_TYPES.SPRITE&&this.maskStack.push(r)},n.prototype.pop=function(e){var t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(t);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(t);break;case MASK_TYPES.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){var r=this.maskStack[this.maskStack.length-1];r.type===MASK_TYPES.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}},n.prototype.detect=function(e){var t=e.maskObject;t?t.isSprite?e.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=MASK_TYPES.SCISSOR:e.type=MASK_TYPES.STENCIL:e.type=MASK_TYPES.COLOR},n.prototype.pushSpriteMask=function(e){var t,r,o=e.maskObject,s=e._target,a=e._filters;a||(a=this.alphaMaskPool[this.alphaMaskIndex],a||(a=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter]));var u=this.renderer,h=u.renderTexture,l,c;if(h.current){var _=h.current;l=e.resolution||_.resolution,c=(t=e.multisample)!==null&&t!==void 0?t:_.multisample}else l=e.resolution||u.resolution,c=(r=e.multisample)!==null&&r!==void 0?r:u.multisample;a[0].resolution=l,a[0].multisample=c,a[0].maskSprite=o;var d=s.filterArea;s.filterArea=o.getBounds(!0),u.filter.push(s,a),s.filterArea=d,e._filters||this.alphaMaskIndex++},n.prototype.popSpriteMask=function(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},n.prototype.pushColorMask=function(e){var t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},n.prototype.popColorMask=function(e){var t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)},n.prototype.destroy=function(){this.renderer=null},n})(),AbstractMaskSystem=(function(){function n(e){this.renderer=e,this.maskStack=[],this.glConst=0}return n.prototype.getStackLength=function(){return this.maskStack.length},n.prototype.setMaskStack=function(e){var t=this.renderer.gl,r=this.getStackLength();this.maskStack=e;var o=this.getStackLength();o!==r&&(o===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))},n.prototype._useCurrent=function(){},n.prototype.destroy=function(){this.renderer=null,this.maskStack=null},n})(),tempMatrix$1=new Matrix,rectPool=[],ScissorSystem=(function(n){__extends$i(e,n);function e(t){var r=n.call(this,t)||this;return r.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,r}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.calcScissorRect=function(t){var r;if(!t._scissorRectLocal){var o=t._scissorRect,s=t.maskObject,a=this.renderer,u=a.renderTexture,h=s.getBounds(!0,(r=rectPool.pop())!==null&&r!==void 0?r:new Rectangle);this.roundFrameToPixels(h,u.current?u.current.resolution:a.resolution,u.sourceFrame,u.destinationFrame,a.projection.transform),o&&h.fit(o),t._scissorRectLocal=h}},e.isMatrixRotated=function(t){if(!t)return!1;var r=t.a,o=t.b,s=t.c,a=t.d;return(Math.abs(o)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(r)>1e-4||Math.abs(a)>1e-4)},e.prototype.testScissor=function(t){var r=t.maskObject;if(!r.isFastRect||!r.isFastRect()||e.isMatrixRotated(r.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var o=t._scissorRectLocal;return o.width>0&&o.height>0},e.prototype.roundFrameToPixels=function(t,r,o,s,a){e.isMatrixRotated(a)||(a=a?tempMatrix$1.copyFrom(a):tempMatrix$1.identity(),a.translate(-o.x,-o.y).scale(s.width/o.width,s.height/o.height).translate(s.x,s.y),this.renderer.filter.transformAABB(a,t),t.fit(s),t.x=Math.round(t.x*r),t.y=Math.round(t.y*r),t.width=Math.round(t.width*r),t.height=Math.round(t.height*r))},e.prototype.push=function(t){t._scissorRectLocal||this.calcScissorRect(t);var r=this.renderer.gl;t._scissorRect||r.enable(r.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()},e.prototype.pop=function(t){var r=this.renderer.gl;t&&rectPool.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():r.disable(r.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,r;this.renderer.renderTexture.current?r=t.y:r=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,r,t.width,t.height)},e})(AbstractMaskSystem),StencilSystem=(function(n){__extends$i(e,n);function e(t){var r=n.call(this,t)||this;return r.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,r}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var r=t.maskObject,o=this.renderer.gl,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),o.clearStencil(0),o.clear(o.STENCIL_BUFFER_BIT),o.enable(o.STENCIL_TEST)),t._stencilCounter++;var a=t._colorMask;a!==0&&(t._colorMask=0,o.colorMask(!1,!1,!1,!1)),o.stencilFunc(o.EQUAL,s,4294967295),o.stencilOp(o.KEEP,o.KEEP,o.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,a!==0&&(t._colorMask=a,o.colorMask((a&1)!==0,(a&2)!==0,(a&4)!==0,(a&8)!==0)),this._useCurrent()},e.prototype.pop=function(t){var r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{var o=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=o?o._colorMask:15;s!==0&&(o._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(o._colorMask=s,r.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e})(AbstractMaskSystem),ProjectionSystem=(function(){function n(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}return n.prototype.update=function(e,t,r,o){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,o),this.transform&&this.projectionMatrix.append(this.transform);var s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)},n.prototype.calculateProjection=function(e,t,r,o){var s=this.projectionMatrix,a=o?-1:1;s.identity(),s.a=1/t.width*2,s.d=a*(1/t.height*2),s.tx=-1-t.x*s.a,s.ty=-a-t.y*s.d},n.prototype.setTransform=function(e){},n.prototype.destroy=function(){this.renderer=null},n})(),tempRect=new Rectangle,tempRect2=new Rectangle,RenderTextureSystem=(function(){function n(e){this.renderer=e,this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}return n.prototype.bind=function(e,t,r){e===void 0&&(e=null);var o=this.renderer;this.current=e;var s,a,u;e?(s=e.baseTexture,u=s.resolution,t||(tempRect.width=e.frame.width,tempRect.height=e.frame.height,t=tempRect),r||(tempRect2.x=e.frame.x,tempRect2.y=e.frame.y,tempRect2.width=t.width,tempRect2.height=t.height,r=tempRect2),a=s.framebuffer):(u=o.resolution,t||(tempRect.width=o.screen.width,tempRect.height=o.screen.height,t=tempRect),r||(r=tempRect,r.width=t.width,r.height=t.height));var h=this.viewportFrame;h.x=r.x*u,h.y=r.y*u,h.width=r.width*u,h.height=r.height*u,e||(h.y=o.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,t,u,!a),e?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)},n.prototype.clear=function(e,t){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.clearColor;var r=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer.screen,s=r.width!==o.width||r.height!==o.height;if(s){var a=this.viewportFrame,u=a.x,h=a.y,l=a.width,c=a.height;u=Math.round(u),h=Math.round(h),l=Math.round(l),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(u,h,l,c)}this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],t),s&&this.renderer.scissor.pop()},n.prototype.resize=function(){this.bind(null)},n.prototype.reset=function(){this.bind(null)},n.prototype.destroy=function(){this.renderer=null},n})();function uboUpdate(n,e,t,r,o){t.buffer.update(o)}var UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function createUBOElements(n){for(var e=n.map(function(h){return{data:h,offset:0,dataLen:0,dirty:0}}),t=0,r=0,o=0,s=0;s<e.length;s++){var a=e[s];if(t=GLSL_TO_STD40_SIZE[a.data.type],a.data.size>1&&(t=Math.max(t,16)*a.data.size),a.dataLen=t,r%t!==0&&r<16){var u=r%t%16;r+=u,o+=u}r+t>16?(o=Math.ceil(o/16)*16,a.offset=o,o+=t,r=t):(a.offset=o,r+=t,o+=t)}return o=Math.ceil(o/16)*16,{uboElements:e,size:o}}function getUBOData(n,e){var t=[];for(var r in n)e[r]&&t.push(e[r]);return t.sort(function(o,s){return o.index-s.index}),t}function generateUniformBufferSync(n,e){if(!n.autoManage)return{size:0,syncFunc:uboUpdate};for(var t=getUBOData(n.uniforms,e),r=createUBOElements(t),o=r.uboElements,s=r.size,a=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],u=0;u<o.length;u++){for(var h=o[u],l=n.uniforms[h.data.name],c=h.data.name,_=!1,d=0;d<uniformParsers.length;d++){var y=uniformParsers[d];if(y.codeUbo&&y.test(h.data,l)){a.push("offset = "+h.offset/4+";",uniformParsers[d].codeUbo(h.data.name,l)),_=!0;break}}if(!_)if(h.data.size>1){var m=mapSize(h.data.type),g=Math.max(GLSL_TO_STD40_SIZE[h.data.type]/16,1),v=m/g,T=(4-v%4)%4;a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;

                t = 0;

                for(var i=0; i < `+h.data.size*g+`; i++)
                {
                    for(var j = 0; j < `+v+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+T+`;
                }

                `)}else{var A=UBO_TO_SINGLE_SETTERS[h.data.type];a.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+h.offset/4+`;
                `+A+`;
                `)}}return a.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",a.join(`
`))}}var GLProgram=(function(){function n(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return n.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},n})();function getAttributeData(n,e){for(var t={},r=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var s=e.getActiveAttrib(n,o);if(s.name.indexOf("gl_")!==0){var a=mapType(e,s.type),u={type:a,name:s.name,size:mapSize(a),location:e.getAttribLocation(n,s.name)};t[s.name]=u}}return t}function getUniformData(n,e){for(var t={},r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS),o=0;o<r;o++){var s=e.getActiveUniform(n,o),a=s.name.replace(/\[.*?\]$/,""),u=!!s.name.match(/\[.*?\]$/),h=mapType(e,s.type);t[a]={name:a,index:o,type:h,size:s.size,isArray:u,value:defaultValue(h,s.size)}}return t}function generateProgram(n,e){var t=compileShader(n,n.VERTEX_SHADER,e.vertexSrc),r=compileShader(n,n.FRAGMENT_SHADER,e.fragmentSrc),o=n.createProgram();if(n.attachShader(o,t),n.attachShader(o,r),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)||logProgramError(n,o,t,r),e.attributeData=getAttributeData(o,n),e.uniformData=getUniformData(o,n),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var s=Object.keys(e.attributeData);s.sort(function(c,_){return c>_?1:-1});for(var a=0;a<s.length;a++)e.attributeData[s[a]].location=a,n.bindAttribLocation(o,a,s[a]);n.linkProgram(o)}n.deleteShader(t),n.deleteShader(r);var u={};for(var a in e.uniformData){var h=e.uniformData[a];u[a]={location:n.getUniformLocation(o,a),value:defaultValue(h.type,h.size)}}var l=new GLProgram(o,u);return l}var UID=0,defaultSyncData={textureCount:0,uboCount:0},ShaderSystem=(function(){function n(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}return n.prototype.systemCheck=function(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},n.prototype.contextChange=function(e){this.gl=e,this.reset()},n.prototype.bind=function(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;var r=e.program,o=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(o.program)),t||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(e.uniformGroup,defaultSyncData)),o},n.prototype.setUniforms=function(e){var t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)},n.prototype.syncUniformGroup=function(e,t){var r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))},n.prototype.syncUniforms=function(e,t,r){var o=e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e);o(t.uniformData,e.uniforms,this.renderer,r)},n.prototype.createSyncGroups=function(e){var t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=generateUniformsSync(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]},n.prototype.syncUniformBufferGroup=function(e,t){var r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;var o=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),o(r.uniformData,e.uniforms,this.renderer,defaultSyncData,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])},n.prototype.createSyncBufferGroup=function(e,t,r){var o=this.renderer.gl;this.renderer.buffer.bind(e.buffer);var s=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,o.uniformBlockBinding(t.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;var a=this.getSignature(e,this.shader.program.uniformData,"ubo"),u=this._uboCache[a];if(u||(u=this._uboCache[a]=generateUniformBufferSync(e,this.shader.program.uniformData)),e.autoManage){var h=new Float32Array(u.size/4);e.buffer.update(h)}return t.uniformGroups[e.id]=u.syncFunc,t.uniformGroups[e.id]},n.prototype.getSignature=function(e,t,r){var o=e.uniforms,s=[r+"-"];for(var a in o)s.push(a),t[a]&&s.push(t[a].type);return s.join("-")},n.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},n.prototype.generateProgram=function(e){var t=this.gl,r=e.program,o=generateProgram(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=o,o},n.prototype.reset=function(){this.program=null,this.shader=null},n.prototype.disposeShader=function(e){this.shader===e&&(this.shader=null)},n.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},n})();function mapWebGLBlendModesToPixi(n,e){return e===void 0&&(e=[]),e[BLEND_MODES.NORMAL]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD]=[n.ONE,n.ONE],e[BLEND_MODES.MULTIPLY]=[n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SCREEN]=[n.ONE,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.OVERLAY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DARKEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LIGHTEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_DODGE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_BURN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HARD_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SOFT_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DIFFERENCE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.EXCLUSION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HUE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SATURATION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LUMINOSITY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.NONE]=[0,0],e[BLEND_MODES.NORMAL_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD_NPM]=[n.SRC_ALPHA,n.ONE,n.ONE,n.ONE],e[BLEND_MODES.SCREEN_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SRC_IN]=[n.DST_ALPHA,n.ZERO],e[BLEND_MODES.SRC_OUT]=[n.ONE_MINUS_DST_ALPHA,n.ZERO],e[BLEND_MODES.SRC_ATOP]=[n.DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_OVER]=[n.ONE_MINUS_DST_ALPHA,n.ONE],e[BLEND_MODES.DST_IN]=[n.ZERO,n.SRC_ALPHA],e[BLEND_MODES.DST_OUT]=[n.ZERO,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_ATOP]=[n.ONE_MINUS_DST_ALPHA,n.SRC_ALPHA],e[BLEND_MODES.XOR]=[n.ONE_MINUS_DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SUBTRACT]=[n.ONE,n.ONE,n.ONE,n.ONE,n.FUNC_REVERSE_SUBTRACT,n.FUNC_ADD],e}var BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,StateSystem=(function(){function n(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State,this.defaultState.blend=!0}return n.prototype.contextChange=function(e){this.gl=e,this.blendModes=mapWebGLBlendModesToPixi(e),this.set(this.defaultState),this.reset()},n.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var t=this.stateId^e.data,r=0;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,e)},n.prototype.forceState=function(e){e=e||this.defaultState;for(var t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(var t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data},n.prototype.setBlend=function(e){this.updateCheck(n.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},n.prototype.setOffset=function(e){this.updateCheck(n.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},n.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},n.prototype.setDepthMask=function(e){this.gl.depthMask(e)},n.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},n.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},n.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},n.prototype.setPolygonOffset=function(e,t){this.gl.polygonOffset(e,t)},n.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},n.prototype.updateCheck=function(e,t){var r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)},n.checkBlendMode=function(e,t){e.setBlendMode(t.blendMode)},n.checkPolygonOffset=function(e,t){e.setPolygonOffset(1,t.polygonOffset)},n.prototype.destroy=function(){this.gl=null},n})(),TextureGCSystem=(function(){function n(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=settings.GC_MAX_IDLE,this.checkCountMax=settings.GC_MAX_CHECK_COUNT,this.mode=settings.GC_MODE}return n.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},n.prototype.run=function(){for(var e=this.renderer.texture,t=e.managedTextures,r=!1,o=0;o<t.length;o++){var s=t[o];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(e.destroyTexture(s,!0),t[o]=null,r=!0)}if(r){for(var a=0,o=0;o<t.length;o++)t[o]!==null&&(t[a++]=t[o]);t.length=a}},n.prototype.unload=function(e){var t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(var o=e.children.length-1;o>=0;o--)this.unload(e.children[o])},n.prototype.destroy=function(){this.renderer=null},n})();function mapTypeAndFormatToInternalFormat(n){var e,t,r,o,s,a,u,h,l,c,_,d,y,m,g,v,T,A,O,w,E,I,b;return"WebGL2RenderingContext"in globalThis&&n instanceof globalThis.WebGL2RenderingContext?b=(e={},e[TYPES.UNSIGNED_BYTE]=(t={},t[FORMATS.RGBA]=n.RGBA8,t[FORMATS.RGB]=n.RGB8,t[FORMATS.RG]=n.RG8,t[FORMATS.RED]=n.R8,t[FORMATS.RGBA_INTEGER]=n.RGBA8UI,t[FORMATS.RGB_INTEGER]=n.RGB8UI,t[FORMATS.RG_INTEGER]=n.RG8UI,t[FORMATS.RED_INTEGER]=n.R8UI,t[FORMATS.ALPHA]=n.ALPHA,t[FORMATS.LUMINANCE]=n.LUMINANCE,t[FORMATS.LUMINANCE_ALPHA]=n.LUMINANCE_ALPHA,t),e[TYPES.BYTE]=(r={},r[FORMATS.RGBA]=n.RGBA8_SNORM,r[FORMATS.RGB]=n.RGB8_SNORM,r[FORMATS.RG]=n.RG8_SNORM,r[FORMATS.RED]=n.R8_SNORM,r[FORMATS.RGBA_INTEGER]=n.RGBA8I,r[FORMATS.RGB_INTEGER]=n.RGB8I,r[FORMATS.RG_INTEGER]=n.RG8I,r[FORMATS.RED_INTEGER]=n.R8I,r),e[TYPES.UNSIGNED_SHORT]=(o={},o[FORMATS.RGBA_INTEGER]=n.RGBA16UI,o[FORMATS.RGB_INTEGER]=n.RGB16UI,o[FORMATS.RG_INTEGER]=n.RG16UI,o[FORMATS.RED_INTEGER]=n.R16UI,o[FORMATS.DEPTH_COMPONENT]=n.DEPTH_COMPONENT16,o),e[TYPES.SHORT]=(s={},s[FORMATS.RGBA_INTEGER]=n.RGBA16I,s[FORMATS.RGB_INTEGER]=n.RGB16I,s[FORMATS.RG_INTEGER]=n.RG16I,s[FORMATS.RED_INTEGER]=n.R16I,s),e[TYPES.UNSIGNED_INT]=(a={},a[FORMATS.RGBA_INTEGER]=n.RGBA32UI,a[FORMATS.RGB_INTEGER]=n.RGB32UI,a[FORMATS.RG_INTEGER]=n.RG32UI,a[FORMATS.RED_INTEGER]=n.R32UI,a[FORMATS.DEPTH_COMPONENT]=n.DEPTH_COMPONENT24,a),e[TYPES.INT]=(u={},u[FORMATS.RGBA_INTEGER]=n.RGBA32I,u[FORMATS.RGB_INTEGER]=n.RGB32I,u[FORMATS.RG_INTEGER]=n.RG32I,u[FORMATS.RED_INTEGER]=n.R32I,u),e[TYPES.FLOAT]=(h={},h[FORMATS.RGBA]=n.RGBA32F,h[FORMATS.RGB]=n.RGB32F,h[FORMATS.RG]=n.RG32F,h[FORMATS.RED]=n.R32F,h[FORMATS.DEPTH_COMPONENT]=n.DEPTH_COMPONENT32F,h),e[TYPES.HALF_FLOAT]=(l={},l[FORMATS.RGBA]=n.RGBA16F,l[FORMATS.RGB]=n.RGB16F,l[FORMATS.RG]=n.RG16F,l[FORMATS.RED]=n.R16F,l),e[TYPES.UNSIGNED_SHORT_5_6_5]=(c={},c[FORMATS.RGB]=n.RGB565,c),e[TYPES.UNSIGNED_SHORT_4_4_4_4]=(_={},_[FORMATS.RGBA]=n.RGBA4,_),e[TYPES.UNSIGNED_SHORT_5_5_5_1]=(d={},d[FORMATS.RGBA]=n.RGB5_A1,d),e[TYPES.UNSIGNED_INT_2_10_10_10_REV]=(y={},y[FORMATS.RGBA]=n.RGB10_A2,y[FORMATS.RGBA_INTEGER]=n.RGB10_A2UI,y),e[TYPES.UNSIGNED_INT_10F_11F_11F_REV]=(m={},m[FORMATS.RGB]=n.R11F_G11F_B10F,m),e[TYPES.UNSIGNED_INT_5_9_9_9_REV]=(g={},g[FORMATS.RGB]=n.RGB9_E5,g),e[TYPES.UNSIGNED_INT_24_8]=(v={},v[FORMATS.DEPTH_STENCIL]=n.DEPTH24_STENCIL8,v),e[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=(T={},T[FORMATS.DEPTH_STENCIL]=n.DEPTH32F_STENCIL8,T),e):b=(A={},A[TYPES.UNSIGNED_BYTE]=(O={},O[FORMATS.RGBA]=n.RGBA,O[FORMATS.RGB]=n.RGB,O[FORMATS.ALPHA]=n.ALPHA,O[FORMATS.LUMINANCE]=n.LUMINANCE,O[FORMATS.LUMINANCE_ALPHA]=n.LUMINANCE_ALPHA,O),A[TYPES.UNSIGNED_SHORT_5_6_5]=(w={},w[FORMATS.RGB]=n.RGB,w),A[TYPES.UNSIGNED_SHORT_4_4_4_4]=(E={},E[FORMATS.RGBA]=n.RGBA,E),A[TYPES.UNSIGNED_SHORT_5_5_5_1]=(I={},I[FORMATS.RGBA]=n.RGBA,I),A),b}var GLTexture=(function(){function n(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}return n})(),TextureSystem=(function(){function n(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}return n.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(e);var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(var r=0;r<t;r++)this.boundTextures[r]=null;this.emptyTextures={};var o=new GLTexture(e.createTexture());e.bindTexture(e.TEXTURE_2D,o.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=o,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new GLTexture(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var r=0;r<6;r++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var r=0;r<this.boundTextures.length;r++)this.bind(null,r)},n.prototype.bind=function(e,t){t===void 0&&(t=0);var r=this.gl;if(e=e?.castToBaseTexture(),e&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;var o=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,o.texture)),o.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):o.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null},n.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},n.prototype.unbind=function(e){var t=this,r=t.gl,o=t.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var s=0;s<o.length;s++)o[s]===this.unknownTexture&&this.bind(null,s)}for(var s=0;s<o.length;s++)o[s]===e&&(this.currentLocation!==s&&(r.activeTexture(r.TEXTURE0+s),this.currentLocation=s),r.bindTexture(e.target,this.emptyTextures[e.target].texture),o[s]=null)},n.prototype.ensureSamplerType=function(e){var t=this,r=t.boundTextures,o=t.hasIntegerTextures,s=t.CONTEXT_UID;if(o)for(var a=e-1;a>=0;--a){var u=r[a];if(u){var h=u._glTextures[s];h.samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(u)}}},n.prototype.initTexture=function(e){var t=new GLTexture(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t},n.prototype.initTextureType=function(e,t){var r,o;t.internalFormat=(o=(r=this.internalFormats[e.type])===null||r===void 0?void 0:r[e.format])!==null&&o!==void 0?o:e.format,this.webGLVersion===2&&e.type===TYPES.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type},n.prototype.updateTexture=function(e){var t=e._glTextures[this.CONTEXT_UID];if(t){var r=this.renderer;if(this.initTextureType(e,t),e.resource&&e.resource.upload(r,e,t))t.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var o=e.realWidth,s=e.realHeight,a=r.gl;(t.width!==o||t.height!==s||t.dirtyId<0)&&(t.width=o,t.height=s,a.texImage2D(e.target,0,t.internalFormat,o,s,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}},n.prototype.destroyTexture=function(e,t){var r=this.gl;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){var o=this.managedTextures.indexOf(e);o!==-1&&removeItems(this.managedTextures,o,1)}},n.prototype.updateTextureStyle=function(e){var t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=WRAP_MODES.CLAMP:t.wrapMode=e.wrapMode,e.resource&&e.resource.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)},n.prototype.setStyle=function(e,t){var r=this.gl;if(t.mipmap&&e.mipmap!==MIPMAP_MODES.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var o=this.renderer.context.extensions.anisotropicFiltering;if(o&&e.anisotropicLevel>0&&e.scaleMode===SCALE_MODES.LINEAR){var s=Math.min(e.anisotropicLevel,r.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,o.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST)},n.prototype.destroy=function(){this.renderer=null},n})(),tempMatrix=new Matrix,AbstractRenderer=(function(n){__extends$i(e,n);function e(t,r){t===void 0&&(t=RENDERER_TYPE.UNKNOWN);var o=n.call(this)||this;return r=Object.assign({},settings.RENDER_OPTIONS,r),o.options=r,o.type=t,o.screen=new Rectangle(0,0,r.width,r.height),o.view=r.view||settings.ADAPTER.createCanvas(),o.resolution=r.resolution||settings.RESOLUTION,o.useContextAlpha=r.useContextAlpha,o.autoDensity=!!r.autoDensity,o.preserveDrawingBuffer=r.preserveDrawingBuffer,o.clearBeforeRender=r.clearBeforeRender,o._backgroundColor=0,o._backgroundColorRgba=[0,0,0,1],o._backgroundColorString="#000000",o.backgroundColor=r.backgroundColor||o._backgroundColor,o.backgroundAlpha=r.backgroundAlpha,r.transparent!==void 0&&(deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),o.useContextAlpha=r.transparent,o.backgroundAlpha=r.transparent?0:1),o._lastObjectRendered=null,o.plugins={},o}return e.prototype.initPlugins=function(t){for(var r in t)this.plugins[r]=new t[r](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,r){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(r*this.resolution);var o=this.view.width/this.resolution,s=this.view.height/this.resolution;this.screen.width=o,this.screen.height=s,this.autoDensity&&(this.view.style.width=o+"px",this.view.style.height=s+"px"),this.emit("resize",o,s)},e.prototype.generateTexture=function(t,r,o,s){r===void 0&&(r={}),typeof r=="number"&&(deprecation("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),r={scaleMode:r,resolution:o,region:s});var a=r.region,u=__rest(r,["region"]);s=a||t.getLocalBounds(null,!0),s.width===0&&(s.width=1),s.height===0&&(s.height=1);var h=RenderTexture.create(__assign({width:s.width,height:s.height},u));return tempMatrix.tx=-s.x,tempMatrix.ty=-s.y,this.render(t,{renderTexture:h,clear:!1,transform:tempMatrix,skipUpdateTransform:!!t.parent}),h},e.prototype.destroy=function(t){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var o=this;o.plugins=null,o.type=RENDERER_TYPE.UNKNOWN,o.view=null,o.screen=null,o._tempDisplayObjectParent=null,o.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=hex2string(t),hex2rgb(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e})(i),GLBuffer=(function(){function n(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return n})(),BufferSystem=(function(){function n(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}return n.prototype.destroy=function(){this.renderer=null},n.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},n.prototype.bind=function(e){var t=this,r=t.gl,o=t.CONTEXT_UID,s=e._glBuffers[o]||this.createGLBuffer(e);r.bindBuffer(e.type,s.buffer)},n.prototype.bindBufferBase=function(e,t){var r=this,o=r.gl,s=r.CONTEXT_UID;if(this.boundBufferBases[t]!==e){var a=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,o.bindBufferBase(o.UNIFORM_BUFFER,t,a.buffer)}},n.prototype.bindBufferRange=function(e,t,r){var o=this,s=o.gl,a=o.CONTEXT_UID;r=r||0;var u=e._glBuffers[a]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,u.buffer,r*256,256)},n.prototype.update=function(e){var t=this,r=t.gl,o=t.CONTEXT_UID,s=e._glBuffers[o];if(e._updateID!==s.updateID)if(s.updateID=e._updateID,r.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)r.bufferSubData(e.type,0,e.data);else{var a=e.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,r.bufferData(e.type,e.data,a)}},n.prototype.dispose=function(e,t){if(this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var r=e._glBuffers[this.CONTEXT_UID],o=this.gl;e.disposeRunner.remove(this),r&&(t||o.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}},n.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedBuffers),r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)},n.prototype.createGLBuffer=function(e){var t=this,r=t.CONTEXT_UID,o=t.gl;return e._glBuffers[r]=new GLBuffer(o.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[r]},n})(),Renderer=(function(n){__extends$i(e,n);function e(t){var r=n.call(this,RENDERER_TYPE.WEBGL,t)||this;return t=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange"),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize")},r.runners.contextChange.add(r),r.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0),r.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(BufferSystem,"buffer").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch"),r.initPlugins(e.__plugins),r.multisample=void 0,t.context?r.context.initFromContext(t.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:t.antialias,premultipliedAlpha:r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,sayHello(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return e.create=function(t){if(isWebGLSupported())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var t=this.gl,r;if(this.context.webGLVersion===1){var o=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,o)}else{var o=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,o)}r>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:r>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:r>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE},e.prototype.addSystem=function(t,r){var o=new t(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=o;for(var s in this.runners)this.runners[s].add(o);return this},e.prototype.render=function(t,r){var o,s,a,u;if(r&&(r instanceof RenderTexture?(deprecation("6.0.0","Renderer#render arguments changed, use options instead."),o=r,s=arguments[2],a=arguments[3],u=arguments[4]):(o=r.renderTexture,s=r.clear,a=r.transform,u=r.skipUpdateTransform)),this.renderingToScreen=!o,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=a,!this.context.isLost){if(o||(this._lastObjectRendered=t),!u){var h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}this.renderTexture.bind(o),this.batch.currentRenderer.start(),(s!==void 0?s:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),o&&o.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(t,r,o,s){r===void 0&&(r={});var a=n.prototype.generateTexture.call(this,t,r,o,s);return this.framebuffer.blit(),a},e.prototype.resize=function(t,r){n.prototype.resize.call(this,t,r),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(t){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();n.prototype.destroy.call(this,t),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,r){deprecation("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),extensions.add({name:t,type:ExtensionType.RendererPlugin,ref:r})},e.__plugins={},e})(AbstractRenderer);extensions.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);function autoDetectRenderer(n){return Renderer.create(n)}var $defaultVertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,$defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,defaultVertex$1=$defaultVertex,defaultFilterVertex=$defaultFilterVertex,BatchDrawCall=(function(){function n(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}return n})(),BatchTextureArray=(function(){function n(){this.elements=[],this.ids=[],this.count=0}return n.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},n})(),ViewableBuffer=(function(){function n(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(n.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),n.prototype.view=function(e){return this[e+"View"]},n.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},n.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},n})(),AbstractBatchRenderer=(function(n){__extends$i(e,n);function e(t){var r=n.call(this,t)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=State.for2d(),r.size=settings.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),t.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return e.prototype.contextChange=function(){var t=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,r=e._textureArrayPool,o=this.size/4,s=Math.floor(o/this.MAX_TEXTURES)+1;t.length<o;)t.push(new BatchDrawCall);for(;r.length<s;)r.push(new BatchTextureArray);for(var a=0;a<this.MAX_TEXTURES;a++)this._tempBoundTextures[a]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this,r=t._bufferedTextures,o=t.MAX_TEXTURES,s=e._textureArrayPool,a=this.renderer.batch,u=this._tempBoundTextures,h=this.renderer.textureGC.count,l=++BaseTexture._globalBatch,c=0,_=s[0],d=0;a.copyBoundTextures(u,o);for(var y=0;y<this._bufferSize;++y){var m=r[y];r[y]=null,m._batchEnabled!==l&&(_.count>=o&&(a.boundArray(_,u,l,o),this.buildDrawCalls(_,d,y),d=y,_=s[++c],++l),m._batchEnabled=l,m.touched=h,_.elements[_.count++]=m)}_.count>0&&(a.boundArray(_,u,l,o),this.buildDrawCalls(_,d,this._bufferSize),++c,++l);for(var y=0;y<u.length;y++)u[y]=null;BaseTexture._globalBatch=l},e.prototype.buildDrawCalls=function(t,r,o){var s=this,a=s._bufferedElements,u=s._attributeBuffer,h=s._indexBuffer,l=s.vertexSize,c=e._drawCallPool,_=this._dcIndex,d=this._aIndex,y=this._iIndex,m=c[_];m.start=this._iIndex,m.texArray=t;for(var g=r;g<o;++g){var v=a[g],T=v._texture.baseTexture,A=premultiplyBlendMode[T.alphaMode?1:0][v.blendMode];a[g]=null,r<g&&m.blend!==A&&(m.size=y-m.start,r=g,m=c[++_],m.texArray=t,m.start=y),this.packInterleavedGeometry(v,u,h,d,y),d+=v.vertexData.length/2*l,y+=v.indices.length,m.blend=A}r<o&&(m.size=y-m.start,++_),this._dcIndex=_,this._aIndex=d,this._iIndex=y},e.prototype.bindAndClearTexArray=function(t){for(var r=this.renderer.texture,o=0;o<t.count;o++)r.bind(t.elements[o],t.ids[o]),t.elements[o]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,r=t._packedGeometries,o=t._attributeBuffer,s=t._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(o.rawBinaryData),r[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(o.rawBinaryData),r[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,r=this.renderer,o=r.gl,s=r.state,a=e._drawCallPool,u=null,h=0;h<t;h++){var l=a[h],c=l.texArray,_=l.type,d=l.size,y=l.start,m=l.blend;u!==c&&(u=c,this.bindAndClearTexArray(c)),this.state.blendMode=m,s.set(this.state),o.drawElements(_,d,o.UNSIGNED_SHORT,y*2)}},e.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),n.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var r=nextPow2(Math.ceil(t/8)),o=log2(r),s=r*8;this._aBuffers.length<=o&&(this._iBuffers.length=o+1);var a=this._aBuffers[s];return a||(this._aBuffers[s]=a=new ViewableBuffer(s*this.vertexSize*4)),a},e.prototype.getIndexBuffer=function(t){var r=nextPow2(Math.ceil(t/12)),o=log2(r),s=r*12;this._iBuffers.length<=o&&(this._iBuffers.length=o+1);var a=this._iBuffers[o];return a||(this._iBuffers[o]=a=new Uint16Array(s)),a},e.prototype.packInterleavedGeometry=function(t,r,o,s,a){for(var u=r.uint32View,h=r.float32View,l=s/this.vertexSize,c=t.uvs,_=t.indices,d=t.vertexData,y=t._texture.baseTexture._batchLocation,m=Math.min(t.worldAlpha,1),g=m<1&&t._texture.baseTexture.alphaMode?premultiplyTint(t._tintRGB,m):t._tintRGB+(m*255<<24),v=0;v<d.length;v+=2)h[s++]=d[v],h[s++]=d[v+1],h[s++]=c[v],h[s++]=c[v+1],u[s++]=g,h[s++]=y;for(var v=0;v<_.length;v++)o[a++]=l+_[v]},e._drawCallPool=[],e._textureArrayPool=[],e})(ObjectRenderer),BatchShaderGenerator=(function(){function n(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return n.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=UniformGroup.from({uSamplers:t},!0);var o=this.fragTemplate;o=o.replace(/%count%/gi,""+e),o=o.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Program(this.vertexSrc,o)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[e]};return new Shader(this.programCache[e],s)},n.prototype.generateSampleSrc=function(e){var t="";t+=`
`,t+=`
`;for(var r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+="if(vTextureId < "+r+".5)"),t+=`
{`,t+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",t+=`
}`;return t+=`
`,t+=`
`,t},n})(),BatchGeometry=(function(n){__extends$i(e,n);function e(t){t===void 0&&(t=!1);var r=n.call(this)||this;return r._buffer=new Buffer(null,t,!1),r._indexBuffer=new Buffer(null,t,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",r._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,TYPES.FLOAT).addIndex(r._indexBuffer),r}return e})(Geometry),defaultVertex=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,defaultFragment=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,BatchPluginFactory=(function(){function n(){}return n.create=function(e){var t=Object.assign({vertex:defaultVertex,fragment:defaultFragment,geometryClass:BatchGeometry,vertexSize:6},e),r=t.vertex,o=t.fragment,s=t.vertexSize,a=t.geometryClass;return(function(u){__extends$i(h,u);function h(l){var c=u.call(this,l)||this;return c.shaderGenerator=new BatchShaderGenerator(r,o),c.geometryClass=a,c.vertexSize=s,c}return h})(AbstractBatchRenderer)},Object.defineProperty(n,"defaultVertexSrc",{get:function(){return defaultVertex},enumerable:!1,configurable:!0}),Object.defineProperty(n,"defaultFragmentTemplate",{get:function(){return defaultFragment},enumerable:!1,configurable:!0}),n})(),BatchRenderer=BatchPluginFactory.create();Object.assign(BatchRenderer,{extension:{name:"batch",type:ExtensionType.RendererPlugin}});var accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);var KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2,AccessibilityManager=(function(){function n(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile.tablet||isMobile.phone)&&this.createTouchHook();var t=document.createElement("div");t.style.width=DIV_TOUCH_SIZE+"px",t.style.height=DIV_TOUCH_SIZE+"px",t.style.position="absolute",t.style.top=DIV_TOUCH_POS_X+"px",t.style.left=DIV_TOUCH_POS_Y+"px",t.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(n.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),n.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width=DIV_HOOK_SIZE+"px",t.style.height=DIV_HOOK_SIZE+"px",t.style.position="absolute",t.style.top=DIV_HOOK_POS_X+"px",t.style.left=DIV_HOOK_POS_Y+"px",t.style.zIndex=DIV_HOOK_ZINDEX.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",function(){e._isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t},n.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},n.prototype.activate=function(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)===null||e===void 0||e.appendChild(this.div))},n.prototype.deactivate=function(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)===null||e===void 0||e.removeChild(this.div))},n.prototype.updateAccessibleObjects=function(e){if(!(!e.visible||!e.accessibleChildren)){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);var t=e.children;if(t)for(var r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}},n.prototype.update=function(){var e=performance.now();if(!(isMobile.android.device&&e<this.androidUpdateCount)&&(this.androidUpdateCount=e+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),r=t.left,o=t.top,s=t.width,a=t.height,u=this.renderer,h=u.width,l=u.height,c=u.resolution,_=s/h*c,d=a/l*c,y=this.div;y.style.left=r+"px",y.style.top=o+"px",y.style.width=h+"px",y.style.height=l+"px";for(var m=0;m<this.children.length;m++){var g=this.children[m];if(g.renderId!==this.renderId)g._accessibleActive=!1,removeItems(this.children,m,1),this.div.removeChild(g._accessibleDiv),this.pool.push(g._accessibleDiv),g._accessibleDiv=null,m--;else{y=g._accessibleDiv;var v=g.hitArea,T=g.worldTransform;g.hitArea?(y.style.left=(T.tx+v.x*T.a)*_+"px",y.style.top=(T.ty+v.y*T.d)*d+"px",y.style.width=v.width*T.a*_+"px",y.style.height=v.height*T.d*d+"px"):(v=g.getBounds(),this.capHitArea(v),y.style.left=v.x*_+"px",y.style.top=v.y*d+"px",y.style.width=v.width*_+"px",y.style.height=v.height*d+"px",y.title!==g.accessibleTitle&&g.accessibleTitle!==null&&(y.title=g.accessibleTitle),y.getAttribute("aria-label")!==g.accessibleHint&&g.accessibleHint!==null&&y.setAttribute("aria-label",g.accessibleHint)),(g.accessibleTitle!==y.title||g.tabIndex!==y.tabIndex)&&(y.title=g.accessibleTitle,y.tabIndex=g.tabIndex,this.debug&&this.updateDebugHTML(y))}}this.renderId++}},n.prototype.updateDebugHTML=function(e){e.innerHTML="type: "+e.type+"</br> title : "+e.title+"</br> tabIndex: "+e.tabIndex},n.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);var t=this.renderer,r=t.width,o=t.height;e.x+e.width>r&&(e.width=r-e.x),e.y+e.height>o&&(e.height=o-e.y)},n.prototype.addChild=function(e){var t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=DIV_TOUCH_SIZE+"px",t.style.height=DIV_TOUCH_SIZE+"px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=DIV_TOUCH_ZINDEX.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title="displayObject "+e.tabIndex),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},n.prototype._onClick=function(e){var t=this.renderer.plugins.interaction,r=e.target.displayObject,o=t.eventData;t.dispatchEvent(r,"click",o),t.dispatchEvent(r,"pointertap",o),t.dispatchEvent(r,"tap",o)},n.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var t=this.renderer.plugins.interaction,r=e.target.displayObject,o=t.eventData;t.dispatchEvent(r,"mouseover",o)},n.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var t=this.renderer.plugins.interaction,r=e.target.displayObject,o=t.eventData;t.dispatchEvent(r,"mouseout",o)},n.prototype._onKeyDown=function(e){e.keyCode===KEY_CODE_TAB&&this.activate()},n.prototype._onMouseMove=function(e){e.movementX===0&&e.movementY===0||this.deactivate()},n.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},n.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]},n})(),InteractionData=(function(){function n(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(n.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),n.prototype.getLocalPosition=function(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)},n.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var t="buttons"in e&&e.buttons;this.buttons=Number.isInteger(t)?t:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},n.prototype.reset=function(){this.isPrimary=!1},n})(),extendStatics$h=function(n,e){return extendStatics$h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$h(n,e)};function __extends$h(n,e){extendStatics$h(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var InteractionEvent=(function(){function n(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return n.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},n.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},n})(),InteractionTrackingData=(function(){function n(e){this._pointerId=e,this._flags=n.FLAGS.NONE}return n.prototype._doSet=function(e,t){t?this._flags=this._flags|e:this._flags=this._flags&~e},Object.defineProperty(n.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"none",{get:function(){return this._flags===n.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"over",{get:function(){return(this._flags&n.FLAGS.OVER)!==0},set:function(e){this._doSet(n.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rightDown",{get:function(){return(this._flags&n.FLAGS.RIGHT_DOWN)!==0},set:function(e){this._doSet(n.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leftDown",{get:function(){return(this._flags&n.FLAGS.LEFT_DOWN)!==0},set:function(e){this._doSet(n.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),n.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),n})(),TreeSearch=(function(){function n(){this._tempPoint=new Point}return n.prototype.recursiveFindHit=function(e,t,r,o,s){var a;if(!t||!t.visible)return!1;var u=e.data.global;s=t.interactive||s;var h=!1,l=s,c=!0;if(t.hitArea)o&&(t.worldTransform.applyInverse(u,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?h=!0:(o=!1,c=!1)),l=!1;else if(t._mask&&o){var _=t._mask.isMaskData?t._mask.maskObject:t._mask;_&&!(!((a=_.containsPoint)===null||a===void 0)&&a.call(_,u))&&(o=!1)}if(c&&t.interactiveChildren&&t.children)for(var d=t.children,y=d.length-1;y>=0;y--){var m=d[y],g=this.recursiveFindHit(e,m,r,o,l);if(g){if(!m.parent)continue;l=!1,g&&(e.target&&(o=!1),h=!0)}}return s&&(o&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(u)&&(h=!0),t.interactive&&(h&&!e.target&&(e.target=t),r&&r(e,t,!!h))),h},n.prototype.findHit=function(e,t,r,o){this.recursiveFindHit(e,t,r,o,!1)},n})(),interactiveTarget={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(n){n?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};DisplayObject.mixin(interactiveTarget);var MOUSE_POINTER_ID=1,hitTestEvent={target:null,data:{global:null}},InteractionManager=(function(n){__extends$h(e,n);function e(t,r){var o=n.call(this)||this;return r=r||{},o.renderer=t,o.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,o.interactionFrequency=r.interactionFrequency||10,o.mouse=new InteractionData,o.mouse.identifier=MOUSE_POINTER_ID,o.mouse.global.set(-999999),o.activeInteractionData={},o.activeInteractionData[MOUSE_POINTER_ID]=o.mouse,o.interactionDataPool=[],o.eventData=new InteractionEvent,o.interactionDOMElement=null,o.moveWhenInside=!1,o.eventsAdded=!1,o.tickerAdded=!1,o.mouseOverRenderer=!("PointerEvent"in globalThis),o.supportsTouchEvents="ontouchstart"in globalThis,o.supportsPointerEvents=!!globalThis.PointerEvent,o.onPointerUp=o.onPointerUp.bind(o),o.processPointerUp=o.processPointerUp.bind(o),o.onPointerCancel=o.onPointerCancel.bind(o),o.processPointerCancel=o.processPointerCancel.bind(o),o.onPointerDown=o.onPointerDown.bind(o),o.processPointerDown=o.processPointerDown.bind(o),o.onPointerMove=o.onPointerMove.bind(o),o.processPointerMove=o.processPointerMove.bind(o),o.onPointerOut=o.onPointerOut.bind(o),o.processPointerOverOut=o.processPointerOverOut.bind(o),o.onPointerOver=o.onPointerOver.bind(o),o.cursorStyles={default:"inherit",pointer:"pointer"},o.currentCursorMode=null,o.cursor=null,o.resolution=1,o.delayedEvents=[],o.search=new TreeSearch,o._tempDisplayObject=new TemporaryDisplayObject,o._eventListenerOptions={capture:!0,passive:!1},o._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,o.setTargetElement(o.renderer.view,o.renderer.resolution),o}return Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,r){return hitTestEvent.target=null,hitTestEvent.data.global=t,r||(r=this.lastObjectRendered),this.processInteractive(hitTestEvent,r,null,!0),hitTestEvent.target},e.prototype.setTargetElement=function(t,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=r,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var t in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var r=this.activeInteractionData[t];if(r.originalEvent&&r.pointerType!=="touch"){var o=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){t=t||"default";var r=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(r=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var o=this.cursorStyles[t];if(o)switch(typeof o){case"string":r&&(this.interactionDOMElement.style.cursor=o);break;case"function":o(t);break;case"object":r&&Object.assign(this.interactionDOMElement.style,o);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,r,o){(!o.stopPropagationHint||t===o.stopsPropagatingAt)&&(o.currentTarget=t,o.type=r,t.emit(r,o),t[r]&&t[r](o))},e.prototype.delayDispatchEvent=function(t,r,o){this.delayedEvents.push({displayObject:t,eventString:r,eventData:o})},e.prototype.mapPositionToPoint=function(t,r,o){var s;this.interactionDOMElement.parentElement?s=this.interactionDOMElement.getBoundingClientRect():s={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var a=1/this.resolution;t.x=(r-s.left)*(this.interactionDOMElement.width/s.width)*a,t.y=(o-s.top)*(this.interactionDOMElement.height/s.height)*a},e.prototype.processInteractive=function(t,r,o,s){var a=this.search.findHit(t,r,o,s),u=this.delayedEvents;if(!u.length)return a;t.stopPropagationHint=!1;var h=u.length;this.delayedEvents=[];for(var l=0;l<h;l++){var c=u[l],_=c.displayObject,d=c.eventString,y=c.eventData;y.stopsPropagatingAt===_&&(y.stopPropagationHint=!0),this.dispatchEvent(_,d,y)}return a},e.prototype.onPointerDown=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t);if(this.autoPreventDefault&&r[0].isNormalized){var o=t.cancelable||!("cancelable"in t);o&&t.preventDefault()}for(var s=r.length,a=0;a<s;a++){var u=r[a],h=this.getInteractionDataForPointerId(u),l=this.configureInteractionEventForDOMEvent(this.eventData,u,h);if(l.data.originalEvent=t,this.processInteractive(l,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",l),u.pointerType==="touch")this.emit("touchstart",l);else if(u.pointerType==="mouse"||u.pointerType==="pen"){var c=u.button===2;this.emit(c?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,r,o){var s=t.data,a=t.data.identifier;if(o){if(r.trackedPointers[a]||(r.trackedPointers[a]=new InteractionTrackingData(a)),this.dispatchEvent(r,"pointerdown",t),s.pointerType==="touch")this.dispatchEvent(r,"touchstart",t);else if(s.pointerType==="mouse"||s.pointerType==="pen"){var u=s.button===2;u?r.trackedPointers[a].rightDown=!0:r.trackedPointers[a].leftDown=!0,this.dispatchEvent(r,u?"rightdown":"mousedown",t)}}},e.prototype.onPointerComplete=function(t,r,o){var s=this.normalizeToPointerData(t),a=s.length,u=t.target;t.composedPath&&t.composedPath().length>0&&(u=t.composedPath()[0]);for(var h=u!==this.interactionDOMElement?"outside":"",l=0;l<a;l++){var c=s[l],_=this.getInteractionDataForPointerId(c),d=this.configureInteractionEventForDOMEvent(this.eventData,c,_);if(d.data.originalEvent=t,this.processInteractive(d,this.lastObjectRendered,o,r||!h),this.emit(r?"pointercancel":"pointerup"+h,d),c.pointerType==="mouse"||c.pointerType==="pen"){var y=c.button===2;this.emit(y?"rightup"+h:"mouseup"+h,d)}else c.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+h,d),this.releaseInteractionDataForPointerId(c.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,r){var o=t.data,s=t.data.identifier;r.trackedPointers[s]!==void 0&&(delete r.trackedPointers[s],this.dispatchEvent(r,"pointercancel",t),o.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,r,o){var s=t.data,a=t.data.identifier,u=r.trackedPointers[a],h=s.pointerType==="touch",l=s.pointerType==="mouse"||s.pointerType==="pen",c=!1;if(l){var _=s.button===2,d=InteractionTrackingData.FLAGS,y=_?d.RIGHT_DOWN:d.LEFT_DOWN,m=u!==void 0&&u.flags&y;o?(this.dispatchEvent(r,_?"rightup":"mouseup",t),m&&(this.dispatchEvent(r,_?"rightclick":"click",t),c=!0)):m&&this.dispatchEvent(r,_?"rightupoutside":"mouseupoutside",t),u&&(_?u.rightDown=!1:u.leftDown=!1)}o?(this.dispatchEvent(r,"pointerup",t),h&&this.dispatchEvent(r,"touchend",t),u&&((!l||c)&&this.dispatchEvent(r,"pointertap",t),h&&(this.dispatchEvent(r,"tap",t),u.over=!1))):u&&(this.dispatchEvent(r,"pointerupoutside",t),h&&this.dispatchEvent(r,"touchendoutside",t)),u&&u.none&&delete r.trackedPointers[a]},e.prototype.onPointerMove=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var o=r.length,s=0;s<o;s++){var a=r[s],u=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,u);h.data.originalEvent=t,this.processInteractive(h,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",h),a.pointerType==="touch"&&this.emit("touchmove",h),(a.pointerType==="mouse"||a.pointerType==="pen")&&this.emit("mousemove",h)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,r,o){var s=t.data,a=s.pointerType==="touch",u=s.pointerType==="mouse"||s.pointerType==="pen";u&&this.processPointerOverOut(t,r,o),(!this.moveWhenInside||o)&&(this.dispatchEvent(r,"pointermove",t),a&&this.dispatchEvent(r,"touchmove",t),u&&this.dispatchEvent(r,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t),o=r[0];o.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var s=this.getInteractionDataForPointerId(o),a=this.configureInteractionEventForDOMEvent(this.eventData,o,s);a.data.originalEvent=o,this.processInteractive(a,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",a),o.pointerType==="mouse"||o.pointerType==="pen"?this.emit("mouseout",a):this.releaseInteractionDataForPointerId(s.identifier)}},e.prototype.processPointerOverOut=function(t,r,o){var s=t.data,a=t.data.identifier,u=s.pointerType==="mouse"||s.pointerType==="pen",h=r.trackedPointers[a];o&&!h&&(h=r.trackedPointers[a]=new InteractionTrackingData(a)),h!==void 0&&(o&&this.mouseOverRenderer?(h.over||(h.over=!0,this.delayDispatchEvent(r,"pointerover",t),u&&this.delayDispatchEvent(r,"mouseover",t)),u&&this.cursor===null&&(this.cursor=r.cursor)):h.over&&(h.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),u&&this.dispatchEvent(r,"mouseout",t),h.none&&delete r.trackedPointers[a]))},e.prototype.onPointerOver=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t),o=r[0],s=this.getInteractionDataForPointerId(o),a=this.configureInteractionEventForDOMEvent(this.eventData,o,s);a.data.originalEvent=o,o.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",a),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mouseover",a)}},e.prototype.getInteractionDataForPointerId=function(t){var r=t.pointerId,o;return r===MOUSE_POINTER_ID||t.pointerType==="mouse"?o=this.mouse:this.activeInteractionData[r]?o=this.activeInteractionData[r]:(o=this.interactionDataPool.pop()||new InteractionData,o.identifier=r,this.activeInteractionData[r]=o),o.copyEvent(t),o},e.prototype.releaseInteractionDataForPointerId=function(t){var r=this.activeInteractionData[t];r&&(delete this.activeInteractionData[t],r.reset(),this.interactionDataPool.push(r))},e.prototype.configureInteractionEventForDOMEvent=function(t,r,o){return t.data=o,this.mapPositionToPoint(o.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=o.global.x,r.globalY=o.global.y),o.originalEvent=r,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var o=0,s=t.changedTouches.length;o<s;o++){var a=t.changedTouches[o];typeof a.button>"u"&&(a.button=t.touches.length?1:0),typeof a.buttons>"u"&&(a.buttons=t.touches.length?1:0),typeof a.isPrimary>"u"&&(a.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof a.width>"u"&&(a.width=a.radiusX||1),typeof a.height>"u"&&(a.height=a.radiusY||1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="touch"),typeof a.pointerId>"u"&&(a.pointerId=a.identifier||0),typeof a.pressure>"u"&&(a.pressure=a.force||.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),typeof a.layerX>"u"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY>"u"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,r.push(a)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){var u=t;typeof u.isPrimary>"u"&&(u.isPrimary=!0),typeof u.width>"u"&&(u.width=1),typeof u.height>"u"&&(u.height=1),typeof u.tiltX>"u"&&(u.tiltX=0),typeof u.tiltY>"u"&&(u.tiltY=0),typeof u.pointerType>"u"&&(u.pointerType="mouse"),typeof u.pointerId>"u"&&(u.pointerId=MOUSE_POINTER_ID),typeof u.pressure>"u"&&(u.pressure=.5),typeof u.twist>"u"&&(u.twist=0),typeof u.tangentialPressure>"u"&&(u.tangentialPressure=0),u.isNormalized=!0,r.push(u)}else r.push(t);return r},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e.extension={name:"interaction",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]},e})(i),TEMP_RECT=new Rectangle,BYTES_PER_PIXEL=4,Extract=(function(){function n(e){this.renderer=e}return n.prototype.image=function(e,t,r){var o=new Image;return o.src=this.base64(e,t,r),o},n.prototype.base64=function(e,t,r){return this.canvas(e).toDataURL(t,r)},n.prototype.canvas=function(e,t){var r=this._rawPixels(e,t),o=r.pixels,s=r.width,a=r.height,u=r.flipY,h=new CanvasRenderTarget(s,a,1),l=h.context.getImageData(0,0,s,a);if(n.arrayPostDivide(o,l.data),h.context.putImageData(l,0,0),u){var c=new CanvasRenderTarget(h.width,h.height,1);c.context.scale(1,-1),c.context.drawImage(h.canvas,0,-a),h.destroy(),h=c}return h.canvas},n.prototype.pixels=function(e,t){var r=this._rawPixels(e,t).pixels;return n.arrayPostDivide(r,r),r},n.prototype._rawPixels=function(e,t){var r=this.renderer,o,s=!1,a,u=!1;if(e)if(e instanceof RenderTexture)a=e;else{var h=r.context.webGLVersion>=2?r.multisample:MSAA_QUALITY.NONE;if(a=this.renderer.generateTexture(e,{multisample:h}),h!==MSAA_QUALITY.NONE){var l=RenderTexture.create({width:a.width,height:a.height});r.framebuffer.bind(a.framebuffer),r.framebuffer.blit(l.framebuffer),r.framebuffer.bind(null),a.destroy(!0),a=l}u=!0}a?(o=a.baseTexture.resolution,t=t??a.frame,s=!1,r.renderTexture.bind(a)):(o=r.resolution,t||(t=TEMP_RECT,t.width=r.width,t.height=r.height),s=!0,r.renderTexture.bind(null));var c=Math.round(t.width*o),_=Math.round(t.height*o),d=new Uint8Array(BYTES_PER_PIXEL*c*_),y=r.gl;return y.readPixels(Math.round(t.x*o),Math.round(t.y*o),c,_,y.RGBA,y.UNSIGNED_BYTE,d),u&&a.destroy(!0),{pixels:d,width:c,height:_,flipY:s}},n.prototype.destroy=function(){this.renderer=null},n.arrayPostDivide=function(e,t){for(var r=0;r<e.length;r+=4){var o=t[r+3]=e[r+3];o!==0?(t[r]=Math.round(Math.min(e[r]*255/o,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/o,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/o,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}},n.extension={name:"extract",type:ExtensionType.RendererPlugin},n})(),SignalBinding=(function(){function n(e,t,r){t===void 0&&(t=!1),this._fn=e,this._once=t,this._thisArg=r,this._next=this._prev=this._owner=null}return n.prototype.detach=function(){return this._owner===null?!1:(this._owner.detach(this),!0)},n})();function _addSignalBinding(n,e){return n._head?(n._tail._next=e,e._prev=n._tail,n._tail=e):(n._head=e,n._tail=e),e._owner=n,e}var Signal=(function(){function n(){this._head=this._tail=void 0}return n.prototype.handlers=function(e){e===void 0&&(e=!1);var t=this._head;if(e)return!!t;for(var r=[];t;)r.push(t),t=t._next;return r},n.prototype.has=function(e){if(!(e instanceof SignalBinding))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return e._owner===this},n.prototype.dispatch=function(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];var o=this._head;if(!o)return!1;for(;o;)o._once&&this.detach(o),o._fn.apply(o._thisArg,t),o=o._next;return!0},n.prototype.add=function(e,t){if(t===void 0&&(t=null),typeof e!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return _addSignalBinding(this,new SignalBinding(e,!1,t))},n.prototype.once=function(e,t){if(t===void 0&&(t=null),typeof e!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return _addSignalBinding(this,new SignalBinding(e,!0,t))},n.prototype.detach=function(e){if(!(e instanceof SignalBinding))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return e._owner!==this?this:(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,e._next===null&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null,this)},n.prototype.detachAll=function(){var e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this},n})();function parseUri(n,e){e=e||{};for(var t={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=t.parser[e.strictMode?"strict":"loose"].exec(n),o={},s=14;s--;)o[t.key[s]]=r[s]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,function(a,u,h){u&&(o[t.q.name][u]=h)}),o}var useXdr,tempAnchor=null,STATUS_NONE=0,STATUS_OK=200,STATUS_EMPTY=204,STATUS_IE_BUG_EMPTY=1223,STATUS_TYPE_OK=2;function _noop$1(){}function setExtMap(n,e,t){e&&e.indexOf(".")===0&&(e=e.substring(1)),e&&(n[e]=t)}function reqType(n){return n.toString().replace("object ","")}var LoaderResource=(function(){function n(e,t,r){if(this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,typeof e!="string"||typeof t!="string")throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(n.STATUS_FLAGS.DATA_URL,t.indexOf("data:")===0),this.name=e,this.url=t,this.extension=this._getExtension(),this.data=null,this.crossOrigin=r.crossOrigin===!0?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=n.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Signal,this.onProgress=new Signal,this.onComplete=new Signal,this.onAfterMiddleware=new Signal}return n.setExtensionLoadType=function(e,t){setExtMap(n._loadTypeMap,e,t)},n.setExtensionXhrType=function(e,t){setExtMap(n._xhrTypeMap,e,t)},Object.defineProperty(n.prototype,"isDataUrl",{get:function(){return this._hasFlag(n.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isComplete",{get:function(){return this._hasFlag(n.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._hasFlag(n.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),n.prototype.complete=function(){this._clearEvents(),this._finish()},n.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=n.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},n.prototype.load=function(e){var t=this;if(!this.isLoading){if(this.isComplete){e&&setTimeout(function(){return e(t)},1);return}else e&&this.onComplete.once(e);switch(this._setFlag(n.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case n.LOAD_TYPE.IMAGE:this.type=n.TYPE.IMAGE,this._loadElement("image");break;case n.LOAD_TYPE.AUDIO:this.type=n.TYPE.AUDIO,this._loadSourceElement("audio");break;case n.LOAD_TYPE.VIDEO:this.type=n.TYPE.VIDEO,this._loadSourceElement("video");break;case n.LOAD_TYPE.XHR:default:typeof useXdr>"u"&&(useXdr=!!(globalThis.XDomainRequest&&!("withCredentials"in new XMLHttpRequest))),useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},n.prototype._hasFlag=function(e){return(this._flags&e)!==0},n.prototype._setFlag=function(e,t){this._flags=t?this._flags|e:this._flags&~e},n.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},n.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(n.STATUS_FLAGS.COMPLETE,!0),this._setFlag(n.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},n.prototype._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:e==="image"&&typeof globalThis.Image<"u"?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},n.prototype._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:e==="audio"&&typeof globalThis.Audio<"u"?this.data=new Audio:this.data=document.createElement(e),this.data===null){this.abort("Unsupported element: "+e);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(e,this.url[r],Array.isArray(t)?t[r]:t));else{var t=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(t)?t[0]:t))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},n.prototype._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;this.crossOrigin==="use-credentials"&&(e.withCredentials=!0),e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===n.XHR_RESPONSE_TYPE.JSON||this.xhrType===n.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=n.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},n.prototype._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var e=this.xhr=new globalThis.XDomainRequest;e.timeout=this.timeout||5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXhrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){return e.send()},1)},n.prototype._createSource=function(e,t,r){r||(r=e+"/"+this._getExtension(t));var o=document.createElement("source");return o.src=t,o.type=r,o},n.prototype._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},n.prototype._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},n.prototype._onTimeout=function(){this.abort("Load timed out.")},n.prototype._xhrOnError=function(){var e=this.xhr;this.abort(reqType(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},n.prototype._xhrOnTimeout=function(){var e=this.xhr;this.abort(reqType(e)+" Request timed out.")},n.prototype._xhrOnAbort=function(){var e=this.xhr;this.abort(reqType(e)+" Request was aborted by the user.")},n.prototype._xhrOnLoad=function(){var e=this.xhr,t="",r=typeof e.status>"u"?STATUS_OK:e.status;(e.responseType===""||e.responseType==="text"||typeof e.responseType>"u")&&(t=e.responseText),r===STATUS_NONE&&(t.length>0||e.responseType===n.XHR_RESPONSE_TYPE.BUFFER)?r=STATUS_OK:r===STATUS_IE_BUG_EMPTY&&(r=STATUS_EMPTY);var o=r/100|0;if(o===STATUS_TYPE_OK)if(this.xhrType===n.XHR_RESPONSE_TYPE.TEXT)this.data=t,this.type=n.TYPE.TEXT;else if(this.xhrType===n.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(t),this.type=n.TYPE.JSON}catch(u){this.abort("Error trying to parse loaded json: "+u);return}else if(this.xhrType===n.XHR_RESPONSE_TYPE.DOCUMENT)try{if(globalThis.DOMParser){var s=new DOMParser;this.data=s.parseFromString(t,"text/xml")}else{var a=document.createElement("div");a.innerHTML=t,this.data=a}this.type=n.TYPE.XML}catch(u){this.abort("Error trying to parse loaded xml: "+u);return}else this.data=e.response||t;else{this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL);return}this.complete()},n.prototype._determineCrossOrigin=function(e,t){if(e.indexOf("data:")===0)return"";if(globalThis.origin!==globalThis.location.origin)return"anonymous";t=t||globalThis.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=e;var r=parseUri(tempAnchor.href,{strictMode:!0}),o=!r.port&&t.port===""||r.port===t.port,s=r.protocol?r.protocol+":":"";return r.host!==t.hostname||!o||s!==t.protocol?"anonymous":""},n.prototype._determineXhrType=function(){return n._xhrTypeMap[this.extension]||n.XHR_RESPONSE_TYPE.TEXT},n.prototype._determineLoadType=function(){return n._loadTypeMap[this.extension]||n.LOAD_TYPE.XHR},n.prototype._getExtension=function(e){e===void 0&&(e=this.url);var t="";if(this.isDataUrl){var r=e.indexOf("/");t=e.substring(r+1,e.indexOf(";",r))}else{var o=e.indexOf("?"),s=e.indexOf("#"),a=Math.min(o>-1?o:e.length,s>-1?s:e.length);e=e.substring(0,a),t=e.substring(e.lastIndexOf(".")+1)}return t.toLowerCase()},n.prototype._getMimeFromXhrType=function(e){switch(e){case n.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case n.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case n.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case n.XHR_RESPONSE_TYPE.JSON:return"application/json";case n.XHR_RESPONSE_TYPE.DEFAULT:case n.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},n})();(function(n){(function(e){e[e.NONE=0]="NONE",e[e.DATA_URL=1]="DATA_URL",e[e.COMPLETE=2]="COMPLETE",e[e.LOADING=4]="LOADING"})(n.STATUS_FLAGS||(n.STATUS_FLAGS={})),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.XML=2]="XML",e[e.IMAGE=3]="IMAGE",e[e.AUDIO=4]="AUDIO",e[e.VIDEO=5]="VIDEO",e[e.TEXT=6]="TEXT"})(n.TYPE||(n.TYPE={})),(function(e){e[e.XHR=1]="XHR",e[e.IMAGE=2]="IMAGE",e[e.AUDIO=3]="AUDIO",e[e.VIDEO=4]="VIDEO"})(n.LOAD_TYPE||(n.LOAD_TYPE={})),(function(e){e.DEFAULT="text",e.BUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json",e.TEXT="text"})(n.XHR_RESPONSE_TYPE||(n.XHR_RESPONSE_TYPE={})),n._loadTypeMap={gif:n.LOAD_TYPE.IMAGE,png:n.LOAD_TYPE.IMAGE,bmp:n.LOAD_TYPE.IMAGE,jpg:n.LOAD_TYPE.IMAGE,jpeg:n.LOAD_TYPE.IMAGE,tif:n.LOAD_TYPE.IMAGE,tiff:n.LOAD_TYPE.IMAGE,webp:n.LOAD_TYPE.IMAGE,tga:n.LOAD_TYPE.IMAGE,avif:n.LOAD_TYPE.IMAGE,svg:n.LOAD_TYPE.IMAGE,"svg+xml":n.LOAD_TYPE.IMAGE,mp3:n.LOAD_TYPE.AUDIO,ogg:n.LOAD_TYPE.AUDIO,wav:n.LOAD_TYPE.AUDIO,mp4:n.LOAD_TYPE.VIDEO,webm:n.LOAD_TYPE.VIDEO},n._xhrTypeMap={xhtml:n.XHR_RESPONSE_TYPE.DOCUMENT,html:n.XHR_RESPONSE_TYPE.DOCUMENT,htm:n.XHR_RESPONSE_TYPE.DOCUMENT,xml:n.XHR_RESPONSE_TYPE.DOCUMENT,tmx:n.XHR_RESPONSE_TYPE.DOCUMENT,svg:n.XHR_RESPONSE_TYPE.DOCUMENT,tsx:n.XHR_RESPONSE_TYPE.DOCUMENT,gif:n.XHR_RESPONSE_TYPE.BLOB,png:n.XHR_RESPONSE_TYPE.BLOB,bmp:n.XHR_RESPONSE_TYPE.BLOB,jpg:n.XHR_RESPONSE_TYPE.BLOB,jpeg:n.XHR_RESPONSE_TYPE.BLOB,tif:n.XHR_RESPONSE_TYPE.BLOB,tiff:n.XHR_RESPONSE_TYPE.BLOB,webp:n.XHR_RESPONSE_TYPE.BLOB,tga:n.XHR_RESPONSE_TYPE.BLOB,avif:n.XHR_RESPONSE_TYPE.BLOB,json:n.XHR_RESPONSE_TYPE.JSON,text:n.XHR_RESPONSE_TYPE.TEXT,txt:n.XHR_RESPONSE_TYPE.TEXT,ttf:n.XHR_RESPONSE_TYPE.BUFFER,otf:n.XHR_RESPONSE_TYPE.BUFFER},n.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})(LoaderResource||(LoaderResource={}));function _noop(){}function onlyOnce(n){return function(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];if(n===null)throw new Error("Callback was already called.");var o=n;n=null,o.apply(this,t)}}var AsyncQueueItem=(function(){function n(e,t){this.data=e,this.callback=t}return n})(),AsyncQueue=(function(){function n(e,t){var r=this;if(t===void 0&&(t=1),this.workers=0,this.saturated=_noop,this.unsaturated=_noop,this.empty=_noop,this.drain=_noop,this.error=_noop,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(o,s,a){if(a&&typeof a!="function")throw new Error("task callback must be a function");if(r.started=!0,o==null&&r.idle()){setTimeout(function(){return r.drain()},1);return}var u=new AsyncQueueItem(o,typeof a=="function"?a:_noop);s?r._tasks.unshift(u):r._tasks.push(u),setTimeout(r.process,1)},this.process=function(){for(;!r.paused&&r.workers<r.concurrency&&r._tasks.length;){var o=r._tasks.shift();r._tasks.length===0&&r.empty(),r.workers+=1,r.workers===r.concurrency&&r.saturated(),r._worker(o.data,onlyOnce(r._next(o)))}},this._worker=e,t===0)throw new Error("Concurrency must not be zero");this.concurrency=t,this.buffer=t/4}return n.prototype._next=function(e){var t=this;return function(){for(var r=arguments,o=[],s=0;s<arguments.length;s++)o[s]=r[s];t.workers-=1,e.callback.apply(e,o),o[0]!=null&&t.error(o[0],e.data),t.workers<=t.concurrency-t.buffer&&t.unsaturated(),t.idle()&&t.drain(),t.process()}},n.prototype.push=function(e,t){this._insert(e,!1,t)},n.prototype.kill=function(){this.workers=0,this.drain=_noop,this.started=!1,this._tasks=[]},n.prototype.unshift=function(e,t){this._insert(e,!0,t)},n.prototype.length=function(){return this._tasks.length},n.prototype.running=function(){return this.workers},n.prototype.idle=function(){return this._tasks.length+this.workers===0},n.prototype.pause=function(){this.paused!==!0&&(this.paused=!0)},n.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var e=1;e<=this.concurrency;e++)this.process()}},n.eachSeries=function(e,t,r,o){var s=0,a=e.length;function u(h){if(h||s===a){r&&r(h);return}o?setTimeout(function(){t(e[s++],u)},1):t(e[s++],u)}u()},n.queue=function(e,t){return new n(e,t)},n})(),MAX_PROGRESS=100,rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=(function(){function n(e,t){var r=this;e===void 0&&(e=""),t===void 0&&(t=10),this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,l){return r._loadResource(h,l)},this.resources={},this.baseUrl=e,this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(h,l){return r._loadResource(h,l)},this._queue=AsyncQueue.queue(this._boundLoadResource,t),this._queue.pause(),this.resources={},this.onProgress=new Signal,this.onError=new Signal,this.onLoad=new Signal,this.onStart=new Signal,this.onComplete=new Signal;for(var o=0;o<n._plugins.length;++o){var s=n._plugins[o],a=s.pre,u=s.use;a&&this.pre(a),u&&this.use(u)}this._protected=!1}return n.prototype._add=function(e,t,r,o){if(this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(t=this._prepareUrl(t),this.resources[e]=new LoaderResource(e,t,r),typeof o=="function"&&this.resources[e].onAfterMiddleware.once(o),this.loading){for(var s=r.parentResource,a=[],u=0;u<s.children.length;++u)s.children[u].isComplete||a.push(s.children[u]);var h=s.progressChunk*(a.length+1),l=h/(a.length+2);s.children.push(this.resources[e]),s.progressChunk=l;for(var u=0;u<a.length;++u)a[u].progressChunk=l;this.resources[e].progressChunk=l}return this._queue.push(this.resources[e]),this},n.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},n.prototype.use=function(e){return this._afterMiddleware.push(e),this},n.prototype.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var e in this.resources){var t=this.resources[e];t._onLoadBinding&&t._onLoadBinding.detach(),t.isLoading&&t.abort("loader reset")}return this.resources={},this},n.prototype.load=function(e){if(deprecation("6.5.0","@pixi/loaders is being replaced with @pixi/assets in the next major release."),typeof e=="function"&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var t=this._queue._tasks.length,r=MAX_PROGRESS/t,o=0;o<this._queue._tasks.length;++o)this._queue._tasks[o].data.progressChunk=r;this._onStart(),this._queue.resume()}return this},Object.defineProperty(n.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e},enumerable:!1,configurable:!0}),n.prototype._prepareUrl=function(e){var t=parseUri(e,{strictMode:!0}),r;if(t.protocol||!t.path||e.indexOf("//")===0?r=e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&e.charAt(0)!=="/"?r=this.baseUrl+"/"+e:r=this.baseUrl+e,this.defaultQueryString){var o=rgxExtractUrlHash.exec(r)[0];r=r.slice(0,r.length-o.length),r.indexOf("?")!==-1?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=o}return r},n.prototype._loadResource=function(e,t){var r=this;e._dequeue=t,AsyncQueue.eachSeries(this._beforeMiddleware,function(o,s){o.call(r,e,function(){s(e.isComplete?{}:null)})},function(){e.isComplete?r._onLoad(e):(e._onLoadBinding=e.onComplete.once(r._onLoad,r),e.load())},!0)},n.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},n.prototype._onComplete=function(){this.progress=MAX_PROGRESS,this.loading=!1,this.onComplete.dispatch(this,this.resources)},n.prototype._onLoad=function(e){var t=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),AsyncQueue.eachSeries(this._afterMiddleware,function(r,o){r.call(t,e,o)},function(){e.onAfterMiddleware.dispatch(e),t.progress=Math.min(MAX_PROGRESS,t.progress+e.progressChunk),t.onProgress.dispatch(t,e),e.error?t.onError.dispatch(e.error,t,e):t.onLoad.dispatch(t,e),t._resourcesParsing.splice(t._resourcesParsing.indexOf(e),1),t._queue.idle()&&t._resourcesParsing.length===0&&t._onComplete()},!0)},n.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(n,"shared",{get:function(){var e=n._shared;return e||(e=new n,e._protected=!0,n._shared=e),e},enumerable:!1,configurable:!0}),n.registerPlugin=function(e){return deprecation("6.5.0","Loader.registerPlugin() is deprecated, use extensions.add() instead."),extensions.add({type:ExtensionType.Loader,ref:e}),n},n._plugins=[],n})();extensions.handleByList(ExtensionType.Loader,Loader._plugins);Loader.prototype.add=function(n,e,t,r){if(Array.isArray(n)){for(var o=0;o<n.length;++o)this.add(n[o]);return this}if(typeof n=="object"&&(t=n,r=e||t.callback||t.onComplete,e=t.url,n=t.name||t.key||t.url),typeof e!="string"&&(r=t,t=e,e=n),typeof e!="string")throw new Error("No url passed to add resource to loader.");return typeof t=="function"&&(r=t,t=null),this._add(n,e,t,r)};var AppLoaderPlugin=(function(){function n(){}return n.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?Loader.shared:new Loader},n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.extension=ExtensionType.Application,n})(),TextureLoader=(function(){function n(){}return n.add=function(){LoaderResource.setExtensionLoadType("svg",LoaderResource.LOAD_TYPE.XHR),LoaderResource.setExtensionXhrType("svg",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},n.use=function(e,t){if(e.data&&(e.type===LoaderResource.TYPE.IMAGE||e.extension==="svg")){var r=e.data,o=e.url,s=e.name,a=e.metadata;Texture.fromLoader(r,o,s,a).then(function(u){e.texture=u,t()}).catch(t)}else t()},n.extension=ExtensionType.Loader,n})(),_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(n){for(var e="",t=0;t<n.length;){for(var r=[0,0,0],o=[0,0,0,0],s=0;s<r.length;++s)t<n.length?r[s]=n.charCodeAt(t++)&255:r[s]=0;o[0]=r[0]>>2,o[1]=(r[0]&3)<<4|r[1]>>4,o[2]=(r[1]&15)<<2|r[2]>>6,o[3]=r[2]&63;var a=t-(n.length-1);switch(a){case 2:o[3]=64,o[2]=64;break;case 1:o[3]=64;break}for(var s=0;s<o.length;++s)e+=_keyStr.charAt(o[s])}return e}function parsing(n,e){if(!n.data){e();return}if(n.xhr&&n.xhrType===LoaderResource.XHR_RESPONSE_TYPE.BLOB){if(!self.Blob||typeof n.data=="string"){var t=n.xhr.getResponseHeader("content-type");if(t&&t.indexOf("image")===0){n.data=new Image,n.data.src="data:"+t+";base64,"+encodeBinary(n.xhr.responseText),n.type=LoaderResource.TYPE.IMAGE,n.data.onload=function(){n.data.onload=null,e()};return}}else if(n.data.type.indexOf("image")===0){var r=globalThis.URL||globalThis.webkitURL,o=r.createObjectURL(n.data);n.blob=n.data,n.data=new Image,n.data.src=o,n.type=LoaderResource.TYPE.IMAGE,n.data.onload=function(){r.revokeObjectURL(o),n.data.onload=null,e()};return}}e()}var ParsingLoader=(function(){function n(){}return n.extension=ExtensionType.Loader,n.use=parsing,n})();extensions.add(TextureLoader,ParsingLoader);var _a$2,INTERNAL_FORMATS;(function(n){n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR"})(INTERNAL_FORMATS||(INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=(_a$2={},_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a$2[INTERNAL_FORMATS.COMPRESSED_RGBA_ASTC_4x4_KHR]=1,_a$2),extendStatics$g=function(n,e){return extendStatics$g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$g(n,e)};function __extends$g(n,e){extendStatics$g(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function __awaiter(n,e,t,r){function o(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function u(c){try{l(r.next(c))}catch(_){a(_)}}function h(c){try{l(r.throw(c))}catch(_){a(_)}}function l(c){c.done?s(c.value):o(c.value).then(u,h)}l((r=r.apply(n,[])).next())})}function __generator(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,o,s,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(c){return h([l,c])}}function h(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,o=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],o=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var BlobResource=(function(n){__extends$g(e,n);function e(t,r){r===void 0&&(r={width:1,height:1,autoLoad:!0});var o=this,s,a;return typeof t=="string"?(s=t,a=new Uint8Array):(s=null,a=t),o=n.call(this,a,r)||this,o.origin=s,o.buffer=a?new ViewableBuffer(a):null,o.origin&&r.autoLoad!==!1&&o.load(),a&&a.length&&(o.loaded=!0,o.onBlobLoaded(o.buffer.rawBinaryData)),o}return e.prototype.onBlobLoaded=function(t){},e.prototype.load=function(){return __awaiter(this,void 0,Promise,function(){var t,r,o;return __generator(this,function(s){switch(s.label){case 0:return[4,fetch(this.origin)];case 1:return t=s.sent(),[4,t.blob()];case 2:return r=s.sent(),[4,r.arrayBuffer()];case 3:return o=s.sent(),this.data=new Uint32Array(o),this.buffer=new ViewableBuffer(o),this.loaded=!0,this.onBlobLoaded(o),this.update(),[2,this]}})})},e})(BufferResource),CompressedTextureResource=(function(n){__extends$g(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.format=r.format,o.levels=r.levels||1,o._width=r.width,o._height=r.height,o._extension=e._formatToExtension(o.format),(r.levelBuffers||o.buffer)&&(o._levelBuffers=r.levelBuffers||e._createLevelBuffers(t instanceof Uint8Array?t:o.buffer.uint8View,o.format,o.levels,4,4,o.width,o.height)),o}return e.prototype.upload=function(t,r,o){var s=t.gl,a=t.context.extensions[this._extension];if(!a)throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var u=0,h=this.levels;u<h;u++){var l=this._levelBuffers[u],c=l.levelID,_=l.levelWidth,d=l.levelHeight,y=l.levelBuffer;s.compressedTexImage2D(s.TEXTURE_2D,c,this.format,_,d,0,y)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(t,r,o,s,a,u,h){for(var l=new Array(o),c=t.byteOffset,_=u,d=h,y=_+s-1&~(s-1),m=d+a-1&~(a-1),g=y*m*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[r],v=0;v<o;v++)l[v]={levelID:v,levelWidth:o>1?_:y,levelHeight:o>1?d:m,levelBuffer:new Uint8Array(t.buffer,c,g)},c+=g,_=_>>1||1,d=d>>1||1,y=_+s-1&~(s-1),m=d+a-1&~(a-1),g=y*m*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[r];return l},e})(BlobResource),CompressedTextureLoader=(function(){function n(){}return n.use=function(e,t){var r=e.data,o=this;if(e.type===LoaderResource.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var s=r.textures,a=void 0,u=void 0,h=0,l=s.length;h<l;h++){var c=s[h],_=c.src,d=c.format;if(d||(u=_),n.textureFormats[d]){a=_;break}}if(a=a||u,!a){t(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));return}if(a===e.url){t(new Error("URL of compressed texture cannot be the same as the manifest's URL"));return}var y={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},m=url$1.resolve(e.url.replace(o.baseUrl,""),a),g=r.cacheID;o.add(g,m,y,function(v){if(v.error){t(v.error);return}var T=v.texture,A=T===void 0?null:T,O=v.textures,w=O===void 0?{}:O;Object.assign(e,{texture:A,textures:w}),t()})}else t()},Object.defineProperty(n,"textureExtensions",{get:function(){if(!n._textureExtensions){var e=settings.ADAPTER.createCanvas(),t=e.getContext("webgl");if(!t)return console.warn("WebGL not available for compressed textures. Silently failing."),{};var r={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};n._textureExtensions=r}return n._textureExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(n,"textureFormats",{get:function(){if(!n._textureFormats){var e=n.textureExtensions;n._textureFormats={};for(var t in e){var r=e[t];r&&Object.assign(n._textureFormats,Object.getPrototypeOf(r))}}return n._textureFormats},enumerable:!1,configurable:!0}),n.extension=ExtensionType.Loader,n})();function registerCompressedTextures(n,e,t){var r={textures:{},texture:null};if(!e)return r;var o=e.map(function(s){return new Texture(new BaseTexture(s,Object.assign({mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},t)))});return o.forEach(function(s,a){var u=s.baseTexture,h=n+"-"+(a+1);BaseTexture.addToCache(u,h),Texture.addToCache(s,h),a===0&&(BaseTexture.addToCache(u,n),Texture.addToCache(s,n),r.texture=s),r.textures[h]=s}),r}var _a$1,_b$1,DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={FOURCC:2},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},DXGI_FORMAT;(function(n){n[n.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",n[n.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",n[n.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",n[n.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",n[n.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",n[n.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",n[n.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",n[n.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",n[n.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",n[n.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",n[n.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",n[n.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",n[n.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",n[n.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",n[n.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",n[n.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",n[n.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",n[n.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",n[n.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",n[n.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",n[n.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",n[n.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",n[n.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",n[n.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",n[n.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",n[n.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",n[n.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",n[n.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",n[n.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",n[n.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",n[n.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",n[n.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",n[n.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",n[n.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",n[n.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",n[n.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",n[n.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",n[n.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",n[n.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",n[n.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",n[n.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",n[n.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",n[n.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",n[n.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",n[n.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",n[n.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",n[n.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",n[n.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",n[n.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",n[n.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",n[n.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",n[n.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",n[n.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",n[n.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",n[n.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",n[n.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",n[n.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",n[n.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",n[n.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",n[n.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",n[n.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",n[n.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",n[n.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",n[n.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",n[n.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",n[n.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",n[n.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",n[n.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",n[n.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",n[n.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",n[n.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",n[n.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",n[n.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",n[n.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",n[n.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",n[n.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",n[n.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",n[n.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",n[n.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",n[n.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",n[n.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",n[n.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",n[n.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",n[n.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",n[n.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",n[n.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",n[n.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",n[n.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",n[n.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",n[n.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",n[n.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",n[n.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",n[n.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",n[n.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",n[n.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",n[n.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",n[n.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",n[n.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",n[n.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",n[n.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",n[n.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",n[n.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",n[n.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",n[n.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",n[n.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",n[n.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",n[n.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",n[n.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",n[n.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",n[n.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",n[n.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",n[n.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",n[n.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",n[n.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",n[n.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",n[n.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",n[n.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",n[n.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",n[n.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",n[n.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",n[n.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",n[n.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"})(DXGI_FORMAT||(DXGI_FORMAT={}));var D3D10_RESOURCE_DIMENSION;(function(n){n[n.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",n[n.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",n[n.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"})(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT=(_a$1={},_a$1[FOURCC_DXT1]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[FOURCC_DXT3]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[FOURCC_DXT5]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=(_b$1={},_b$1[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b$1[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b$1);function parseDDS(n){var e=new Uint32Array(n),t=e[0];if(t!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");var r=new Uint32Array(n,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),o=r[DDS_FIELDS.HEIGHT],s=r[DDS_FIELDS.WIDTH],a=r[DDS_FIELDS.MIPMAP_COUNT],u=new Uint32Array(n,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),h=u[PF_FLAGS];if(h&DDPF_FOURCC){var l=u[DDS_PF_FIELDS.FOURCC];if(l!==FOURCC_DX10){var c=FOURCC_TO_FORMAT[l],_=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,d=new Uint8Array(n,_),y=new CompressedTextureResource(d,{format:c,width:s,height:o,levels:a});return[y]}var m=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,g=new Uint32Array(e.buffer,m,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),v=g[DDS_DX10_FIELDS.DXGI_FORMAT],T=g[DDS_DX10_FIELDS.RESOURCE_DIMENSION],A=g[DDS_DX10_FIELDS.MISC_FLAG],O=g[DDS_DX10_FIELDS.ARRAY_SIZE],w=DXGI_TO_FORMAT[v];if(w===void 0)throw new Error("DDSParser cannot parse texture data with DXGI format "+v);if(A===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(T===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");var E=new Array,I=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(O===1)E.push(new Uint8Array(n,I));else{for(var b=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[w],k=0,N=s,G=o,X=0;X<a;X++){var H=Math.max(1,N+3&-4),Q=Math.max(1,G+3&-4),tt=H*Q*b;k+=tt,N=N>>>1,G=G>>>1}for(var q=I,X=0;X<O;X++)E.push(new Uint8Array(n,q,k)),q+=k}return E.map(function(S){return new CompressedTextureResource(S,{format:w,width:s,height:o,levels:a})})}throw h&DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):h&DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):h&DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}var _a$3,_b,_c,FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT=(_a$3={},_a$3[TYPES.UNSIGNED_BYTE]=1,_a$3[TYPES.UNSIGNED_SHORT]=2,_a$3[TYPES.INT]=4,_a$3[TYPES.UNSIGNED_INT]=4,_a$3[TYPES.FLOAT]=4,_a$3[TYPES.HALF_FLOAT]=8,_a$3),FORMATS_TO_COMPONENTS=(_b={},_b[FORMATS.RGBA]=4,_b[FORMATS.RGB]=3,_b[FORMATS.RG]=2,_b[FORMATS.RED]=1,_b[FORMATS.LUMINANCE]=1,_b[FORMATS.LUMINANCE_ALPHA]=2,_b[FORMATS.ALPHA]=1,_b),TYPES_TO_BYTES_PER_PIXEL=(_c={},_c[TYPES.UNSIGNED_SHORT_4_4_4_4]=2,_c[TYPES.UNSIGNED_SHORT_5_5_5_1]=2,_c[TYPES.UNSIGNED_SHORT_5_6_5]=2,_c);function parseKTX(n,e,t){t===void 0&&(t=!1);var r=new DataView(e);if(!validate(n,r))return null;var o=r.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,s=r.getUint32(KTX_FIELDS.GL_TYPE,o),a=r.getUint32(KTX_FIELDS.GL_FORMAT,o),u=r.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,o),h=r.getUint32(KTX_FIELDS.PIXEL_WIDTH,o),l=r.getUint32(KTX_FIELDS.PIXEL_HEIGHT,o)||1,c=r.getUint32(KTX_FIELDS.PIXEL_DEPTH,o)||1,_=r.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,o)||1,d=r.getUint32(KTX_FIELDS.NUMBER_OF_FACES,o),y=r.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,o),m=r.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,o);if(l===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(_!==1)throw new Error("WebGL does not support array textures");var g=4,v=4,T=h+3&-4,A=l+3&-4,O=new Array(_),w=h*l;s===0&&(w=T*A);var E;if(s!==0?TYPES_TO_BYTES_PER_COMPONENT[s]?E=TYPES_TO_BYTES_PER_COMPONENT[s]*FORMATS_TO_COMPONENTS[a]:E=TYPES_TO_BYTES_PER_PIXEL[s]:E=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[u],E===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var I=t?parseKvData(r,m,o):null,b=w*E,k=b,N=h,G=l,X=T,H=A,Q=FILE_HEADER_SIZE+m,tt=0;tt<y;tt++){for(var q=r.getUint32(Q,o),S=Q+4,M=0;M<_;M++){var R=O[M];R||(R=O[M]=new Array(y)),R[tt]={levelID:tt,levelWidth:y>1||s!==0?N:X,levelHeight:y>1||s!==0?G:H,levelBuffer:new Uint8Array(e,S,k)},S+=k}Q+=q+4,Q=Q%4!==0?Q+4-Q%4:Q,N=N>>1||1,G=G>>1||1,X=N+g-1&-4,H=G+v-1&-4,k=X*H*E}return s!==0?{uncompressed:O.map(function(C){var D=C[0].levelBuffer,P=!1;return s===TYPES.FLOAT?D=new Float32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4):s===TYPES.UNSIGNED_INT?(P=!0,D=new Uint32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)):s===TYPES.INT&&(P=!0,D=new Int32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)),{resource:new BufferResource(D,{width:C[0].levelWidth,height:C[0].levelHeight}),type:s,format:P?convertFormatToInteger(a):a}}),kvData:I}:{compressed:O.map(function(C){return new CompressedTextureResource(null,{format:u,width:h,height:l,levels:y,levelBuffers:C})}),kvData:I}}function validate(n,e){for(var t=0;t<FILE_IDENTIFIER.length;t++)if(e.getUint8(t)!==FILE_IDENTIFIER[t])return console.error(n+" is not a valid *.ktx file!"),!1;return!0}function convertFormatToInteger(n){switch(n){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return n}}function parseKvData(n,e,t){for(var r=new Map,o=0;o<e;){var s=n.getUint32(FILE_HEADER_SIZE+o,t),a=FILE_HEADER_SIZE+o+4,u=3-(s+3)%4;if(s===0||s>e-o){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}for(var h=0;h<s&&n.getUint8(a+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}var l=new TextDecoder().decode(new Uint8Array(n.buffer,a,h)),c=new DataView(n.buffer,a+h+1,s-h-1);r.set(l,c),o+=4+s+u}return r}LoaderResource.setExtensionXhrType("dds",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DDSLoader=(function(){function n(){}return n.use=function(e,t){if(e.extension==="dds"&&e.data)try{Object.assign(e,registerCompressedTextures(e.name||e.url,parseDDS(e.data),e.metadata))}catch(r){t(r);return}t()},n.extension=ExtensionType.Loader,n})();LoaderResource.setExtensionXhrType("ktx",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var KTXLoader=(function(){function n(){}return n.use=function(e,t){if(e.extension==="ktx"&&e.data)try{var r=e.name||e.url,o=parseKTX(r,e.data,this.loadKeyValueData),s=o.compressed,a=o.uncompressed,u=o.kvData;if(s){var h=registerCompressedTextures(r,s,e.metadata);if(u&&h.textures)for(var l in h.textures)h.textures[l].baseTexture.ktxKeyValueData=u;Object.assign(e,h)}else if(a){var c={};a.forEach(function(_,d){var y=new Texture(new BaseTexture(_.resource,{mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,type:_.type,format:_.format})),m=r+"-"+(d+1);u&&(y.baseTexture.ktxKeyValueData=u),BaseTexture.addToCache(y.baseTexture,m),Texture.addToCache(y,m),d===0&&(c[r]=y,BaseTexture.addToCache(y.baseTexture,r),Texture.addToCache(y,r)),c[m]=y}),Object.assign(e,{textures:c})}}catch(_){t(_);return}t()},n.extension=ExtensionType.Loader,n.loadKeyValueData=!1,n})(),extendStatics$f=function(n,e){return extendStatics$f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$f(n,e)};function __extends$f(n,e){extendStatics$f(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}(function(n){__extends$f(e,n);function e(t,r,o,s){t===void 0&&(t=1500),o===void 0&&(o=16384),s===void 0&&(s=!1);var a=n.call(this)||this,u=16384;return o>u&&(o=u),a._properties=[!1,!0,!1,!1,!1],a._maxSize=t,a._batchSize=o,a._buffers=null,a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=BLEND_MODES.NORMAL,a.autoResize=s,a.roundPixels=!0,a.baseTexture=null,a.setProperties(r),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,hex2rgb(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var r=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return r.onChildrenChange(0)})),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var r=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e})(Container);var ParticleBuffer=(function(){function n(e,t,r){this.geometry=new Geometry,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<e.length;++o){var s=e[o];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||TYPES.FLOAT,offset:s.offset},t[o]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return n.prototype.initBuffers=function(){var e=this.geometry,t=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];o.offset=t,t+=o.size,this.dynamicStride+=o.size}var s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);var a=0;this.staticStride=0;for(var r=0;r<this.staticProperties.length;++r){var o=this.staticProperties[r];o.offset=a,a+=o.size,this.staticStride+=o.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(var r=0;r<this.dynamicProperties.length;++r){var o=this.dynamicProperties[r];e.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===TYPES.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(var r=0;r<this.staticProperties.length;++r){var o=this.staticProperties[r];e.addAttribute(o.attributeName,this.staticBuffer,0,o.type===TYPES.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}},n.prototype.uploadDynamic=function(e,t,r){for(var o=0;o<this.dynamicProperties.length;o++){var s=this.dynamicProperties[o];s.uploadFunction(e,t,r,s.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++},n.prototype.uploadStatic=function(e,t,r){for(var o=0;o<this.staticProperties.length;o++){var s=this.staticProperties[o];s.uploadFunction(e,t,r,s.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++},n.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},n})(),fragment$6=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,ParticleRenderer=(function(n){__extends$f(e,n);function e(t){var r=n.call(this,t)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Matrix,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=Shader.from(vertex$3,fragment$6,{}),r.state=State.for2d(),r}return e.prototype.render=function(t){var r=t.children,o=t._maxSize,s=t._batchSize,a=this.renderer,u=r.length;if(u!==0){u>o&&!t.autoResize&&(u=o);var h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));var l=r[0]._texture.baseTexture,c=l.alphaMode>0;this.state.blendMode=correctBlendMode(t.blendMode,c),a.state.set(this.state);var _=a.gl,d=t.worldTransform.copyTo(this.tempMatrix);d.prepend(a.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,c),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);for(var y=!1,m=0,g=0;m<u;m+=s,g+=1){var v=u-m;v>s&&(v=s),g>=h.length&&h.push(this._generateOneMoreBuffer(t));var T=h[g];T.uploadDynamic(r,m,v);var A=t._bufferUpdateIDs[g]||0;y=y||T._updateID<A,y&&(T._updateID=t._updateID,T.uploadStatic(r,m,v)),a.geometry.bind(T.geometry),_.drawElements(_.TRIANGLES,v*6,_.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var r=[],o=t._maxSize,s=t._batchSize,a=t._properties,u=0;u<o;u+=s)r.push(new ParticleBuffer(this.properties,a,s));return r},e.prototype._generateOneMoreBuffer=function(t){var r=t._batchSize,o=t._properties;return new ParticleBuffer(this.properties,o,r)},e.prototype.uploadVertices=function(t,r,o,s,a,u){for(var h=0,l=0,c=0,_=0,d=0;d<o;++d){var y=t[r+d],m=y._texture,g=y.scale.x,v=y.scale.y,T=m.trim,A=m.orig;T?(l=T.x-y.anchor.x*A.width,h=l+T.width,_=T.y-y.anchor.y*A.height,c=_+T.height):(h=A.width*(1-y.anchor.x),l=A.width*-y.anchor.x,c=A.height*(1-y.anchor.y),_=A.height*-y.anchor.y),s[u]=l*g,s[u+1]=_*v,s[u+a]=h*g,s[u+a+1]=_*v,s[u+a*2]=h*g,s[u+a*2+1]=c*v,s[u+a*3]=l*g,s[u+a*3+1]=c*v,u+=a*4}},e.prototype.uploadPosition=function(t,r,o,s,a,u){for(var h=0;h<o;h++){var l=t[r+h].position;s[u]=l.x,s[u+1]=l.y,s[u+a]=l.x,s[u+a+1]=l.y,s[u+a*2]=l.x,s[u+a*2+1]=l.y,s[u+a*3]=l.x,s[u+a*3+1]=l.y,u+=a*4}},e.prototype.uploadRotation=function(t,r,o,s,a,u){for(var h=0;h<o;h++){var l=t[r+h].rotation;s[u]=l,s[u+a]=l,s[u+a*2]=l,s[u+a*3]=l,u+=a*4}},e.prototype.uploadUvs=function(t,r,o,s,a,u){for(var h=0;h<o;++h){var l=t[r+h]._texture._uvs;l?(s[u]=l.x0,s[u+1]=l.y0,s[u+a]=l.x1,s[u+a+1]=l.y1,s[u+a*2]=l.x2,s[u+a*2+1]=l.y2,s[u+a*3]=l.x3,s[u+a*3+1]=l.y3,u+=a*4):(s[u]=0,s[u+1]=0,s[u+a]=0,s[u+a+1]=0,s[u+a*2]=0,s[u+a*2+1]=0,s[u+a*3]=0,s[u+a*3+1]=0,u+=a*4)}},e.prototype.uploadTint=function(t,r,o,s,a,u){for(var h=0;h<o;++h){var l=t[r+h],c=l._texture.baseTexture.alphaMode>0,_=l.alpha,d=_<1&&c?premultiplyTint(l._tintRGB,_):l._tintRGB+(_*255<<24);s[u]=d,s[u+a]=d,s[u+a*2]=d,s[u+a*3]=d,u+=a*4}},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e.extension={name:"particle",type:ExtensionType.RendererPlugin},e})(ObjectRenderer),LINE_JOIN;(function(n){n.MITER="miter",n.BEVEL="bevel",n.ROUND="round"})(LINE_JOIN||(LINE_JOIN={}));var LINE_CAP;(function(n){n.BUTT="butt",n.ROUND="round",n.SQUARE="square"})(LINE_CAP||(LINE_CAP={}));var GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(n,e){if(e===void 0&&(e=20),!this.adaptive||!n||isNaN(n))return e;var t=Math.ceil(n/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}},FillStyle=(function(){function n(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}return n.prototype.clone=function(){var e=new n;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},n.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1},n.prototype.destroy=function(){this.texture=null,this.matrix=null},n})(),extendStatics$e=function(n,e){return extendStatics$e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$e(n,e)};function __extends$e(n,e){extendStatics$e(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function fixOrientation(n,e){var t,r;e===void 0&&(e=!1);var o=n.length;if(!(o<6)){for(var s=0,a=0,u=n[o-2],h=n[o-1];a<o;a+=2){var l=n[a],c=n[a+1];s+=(l-u)*(c+h),u=l,h=c}if(!e&&s>0||e&&s<=0)for(var _=o/2,a=_+_%2;a<o;a+=2){var d=o-a-2,y=o-a-1,m=a,g=a+1;t=[n[m],n[d]],n[d]=t[0],n[m]=t[1],r=[n[g],n[y]],n[y]=r[0],n[g]=r[1]}}}var buildPoly={build:function(n){n.points=n.shape.points.slice()},triangulate:function(n,e){var t=n.points,r=n.holes,o=e.points,s=e.indices;if(t.length>=6){fixOrientation(t,!1);for(var a=[],u=0;u<r.length;u++){var h=r[u];fixOrientation(h.points,!0),a.push(t.length/2),t=t.concat(h.points)}var l=earcut(t,a,2);if(!l)return;for(var c=o.length/2,u=0;u<l.length;u+=3)s.push(l[u]+c),s.push(l[u+1]+c),s.push(l[u+2]+c);for(var u=0;u<t.length;u++)o.push(t[u])}}},buildCircle={build:function(n){var e=n.points,t,r,o,s,a,u;if(n.type===SHAPES.CIRC){var h=n.shape;t=h.x,r=h.y,a=u=h.radius,o=s=0}else if(n.type===SHAPES.ELIP){var l=n.shape;t=l.x,r=l.y,a=l.width,u=l.height,o=s=0}else{var c=n.shape,_=c.width/2,d=c.height/2;t=c.x+_,r=c.y+d,a=u=Math.max(0,Math.min(c.radius,Math.min(_,d))),o=_-a,s=d-u}if(!(a>=0&&u>=0&&o>=0&&s>=0)){e.length=0;return}var y=Math.ceil(2.3*Math.sqrt(a+u)),m=y*8+(o?4:0)+(s?4:0);if(e.length=m,m!==0){if(y===0){e.length=8,e[0]=e[6]=t+o,e[1]=e[3]=r+s,e[2]=e[4]=t-o,e[5]=e[7]=r-s;return}var g=0,v=y*4+(o?2:0)+2,T=v,A=m;{var O=o+a,w=s,E=t+O,I=t-O,b=r+w;if(e[g++]=E,e[g++]=b,e[--v]=b,e[--v]=I,s){var k=r-w;e[T++]=I,e[T++]=k,e[--A]=k,e[--A]=E}}for(var N=1;N<y;N++){var G=Math.PI/2*(N/y),O=o+Math.cos(G)*a,w=s+Math.sin(G)*u,E=t+O,I=t-O,b=r+w,k=r-w;e[g++]=E,e[g++]=b,e[--v]=b,e[--v]=I,e[T++]=I,e[T++]=k,e[--A]=k,e[--A]=E}{var O=o,w=s+u,E=t+O,I=t-O,b=r+w,k=r-w;e[g++]=E,e[g++]=b,e[--A]=k,e[--A]=E,o&&(e[g++]=I,e[g++]=b,e[--A]=k,e[--A]=I)}}},triangulate:function(n,e){var t=n.points,r=e.points,o=e.indices;if(t.length!==0){var s=r.length/2,a=s,u,h;if(n.type!==SHAPES.RREC){var l=n.shape;u=l.x,h=l.y}else{var c=n.shape;u=c.x+c.width/2,h=c.y+c.height/2}var _=n.matrix;r.push(n.matrix?_.a*u+_.c*h+_.tx:u,n.matrix?_.b*u+_.d*h+_.ty:h),s++,r.push(t[0],t[1]);for(var d=2;d<t.length;d+=2)r.push(t[d],t[d+1]),o.push(s++,a,s);o.push(a+1,a,s)}}},buildRectangle={build:function(n){var e=n.shape,t=e.x,r=e.y,o=e.width,s=e.height,a=n.points;a.length=0,a.push(t,r,t+o,r,t+o,r+s,t,r+s)},triangulate:function(n,e){var t=n.points,r=e.points,o=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(o,o+1,o+2,o+1,o+2,o+3)}};function getPt(n,e,t){var r=e-n;return n+r*t}function quadraticBezierCurve(n,e,t,r,o,s,a){a===void 0&&(a=[]);for(var u=20,h=a,l=0,c=0,_=0,d=0,y=0,m=0,g=0,v=0;g<=u;++g)v=g/u,l=getPt(n,t,v),c=getPt(e,r,v),_=getPt(t,o,v),d=getPt(r,s,v),y=getPt(l,_,v),m=getPt(c,d,v),!(g===0&&h[h.length-2]===y&&h[h.length-1]===m)&&h.push(y,m);return h}var buildRoundedRectangle={build:function(n){if(Graphics.nextRoundedRectBehavior){buildCircle.build(n);return}var e=n.shape,t=n.points,r=e.x,o=e.y,s=e.width,a=e.height,u=Math.max(0,Math.min(e.radius,Math.min(s,a)/2));t.length=0,u?(quadraticBezierCurve(r,o+u,r,o,r+u,o,t),quadraticBezierCurve(r+s-u,o,r+s,o,r+s,o+u,t),quadraticBezierCurve(r+s,o+a-u,r+s,o+a,r+s-u,o+a,t),quadraticBezierCurve(r+u,o+a,r,o+a,r,o+a-u,t)):t.push(r,o,r+s,o,r+s,o+a,r,o+a)},triangulate:function(n,e){if(Graphics.nextRoundedRectBehavior){buildCircle.triangulate(n,e);return}for(var t=n.points,r=e.points,o=e.indices,s=r.length/2,a=earcut(t,null,2),u=0,h=a.length;u<h;u+=3)o.push(a[u]+s),o.push(a[u+1]+s),o.push(a[u+2]+s);for(var u=0,h=t.length;u<h;u++)r.push(t[u],t[++u])}};function square(n,e,t,r,o,s,a,u){var h=n-t*o,l=e-r*o,c=n+t*s,_=e+r*s,d,y;a?(d=r,y=-t):(d=-r,y=t);var m=h+d,g=l+y,v=c+d,T=_+y;return u.push(m,g),u.push(v,T),2}function round(n,e,t,r,o,s,a,u){var h=t-n,l=r-e,c=Math.atan2(h,l),_=Math.atan2(o-n,s-e);u&&c<_?c+=Math.PI*2:!u&&c>_&&(_+=Math.PI*2);var d=c,y=_-c,m=Math.abs(y),g=Math.sqrt(h*h+l*l),v=(15*m*Math.sqrt(g)/Math.PI>>0)+1,T=y/v;if(d+=T,u){a.push(n,e),a.push(t,r);for(var A=1,O=d;A<v;A++,O+=T)a.push(n,e),a.push(n+Math.sin(O)*g,e+Math.cos(O)*g);a.push(n,e),a.push(o,s)}else{a.push(t,r),a.push(n,e);for(var A=1,O=d;A<v;A++,O+=T)a.push(n+Math.sin(O)*g,e+Math.cos(O)*g),a.push(n,e);a.push(o,s),a.push(n,e)}return v*2}function buildNonNativeLine(n,e){var t=n.shape,r=n.points||t.points.slice(),o=e.closePointEps;if(r.length!==0){var s=n.lineStyle,a=new Point(r[0],r[1]),u=new Point(r[r.length-2],r[r.length-1]),h=t.type!==SHAPES.POLY||t.closeStroke,l=Math.abs(a.x-u.x)<o&&Math.abs(a.y-u.y)<o;if(h){r=r.slice(),l&&(r.pop(),r.pop(),u.set(r[r.length-2],r[r.length-1]));var c=(a.x+u.x)*.5,_=(u.y+a.y)*.5;r.unshift(c,_),r.push(c,_)}var d=e.points,y=r.length/2,m=r.length,g=d.length/2,v=s.width/2,T=v*v,A=s.miterLimit*s.miterLimit,O=r[0],w=r[1],E=r[2],I=r[3],b=0,k=0,N=-(w-I),G=O-E,X=0,H=0,Q=Math.sqrt(N*N+G*G);N/=Q,G/=Q,N*=v,G*=v;var tt=s.alignment,q=(1-tt)*2,S=tt*2;h||(s.cap===LINE_CAP.ROUND?m+=round(O-N*(q-S)*.5,w-G*(q-S)*.5,O-N*q,w-G*q,O+N*S,w+G*S,d,!0)+2:s.cap===LINE_CAP.SQUARE&&(m+=square(O,w,N,G,q,S,!0,d))),d.push(O-N*q,w-G*q),d.push(O+N*S,w+G*S);for(var M=1;M<y-1;++M){O=r[(M-1)*2],w=r[(M-1)*2+1],E=r[M*2],I=r[M*2+1],b=r[(M+1)*2],k=r[(M+1)*2+1],N=-(w-I),G=O-E,Q=Math.sqrt(N*N+G*G),N/=Q,G/=Q,N*=v,G*=v,X=-(I-k),H=E-b,Q=Math.sqrt(X*X+H*H),X/=Q,H/=Q,X*=v,H*=v;var R=E-O,C=w-I,D=E-b,P=k-I,B=R*D+C*P,L=C*D-P*R,Y=L<0;if(Math.abs(L)<.001*Math.abs(B)){d.push(E-N*q,I-G*q),d.push(E+N*S,I+G*S),B>=0&&(s.join===LINE_JOIN.ROUND?m+=round(E,I,E-N*q,I-G*q,E-X*q,I-H*q,d,!1)+4:m+=2,d.push(E-X*S,I-H*S),d.push(E+X*q,I+H*q));continue}var z=(-N+O)*(-G+I)-(-N+E)*(-G+w),$=(-X+b)*(-H+I)-(-X+E)*(-H+k),W=(R*$-D*z)/L,et=(P*z-C*$)/L,K=(W-E)*(W-E)+(et-I)*(et-I),V=E+(W-E)*q,Z=I+(et-I)*q,rt=E-(W-E)*S,st=I-(et-I)*S,it=Math.min(R*R+C*C,D*D+P*P),J=Y?q:S,nt=it+J*J*T,ot=K<=nt;ot?s.join===LINE_JOIN.BEVEL||K/T>A?(Y?(d.push(V,Z),d.push(E+N*S,I+G*S),d.push(V,Z),d.push(E+X*S,I+H*S)):(d.push(E-N*q,I-G*q),d.push(rt,st),d.push(E-X*q,I-H*q),d.push(rt,st)),m+=2):s.join===LINE_JOIN.ROUND?Y?(d.push(V,Z),d.push(E+N*S,I+G*S),m+=round(E,I,E+N*S,I+G*S,E+X*S,I+H*S,d,!0)+4,d.push(V,Z),d.push(E+X*S,I+H*S)):(d.push(E-N*q,I-G*q),d.push(rt,st),m+=round(E,I,E-N*q,I-G*q,E-X*q,I-H*q,d,!1)+4,d.push(E-X*q,I-H*q),d.push(rt,st)):(d.push(V,Z),d.push(rt,st)):(d.push(E-N*q,I-G*q),d.push(E+N*S,I+G*S),s.join===LINE_JOIN.ROUND?Y?m+=round(E,I,E+N*S,I+G*S,E+X*S,I+H*S,d,!0)+2:m+=round(E,I,E-N*q,I-G*q,E-X*q,I-H*q,d,!1)+2:s.join===LINE_JOIN.MITER&&K/T<=A&&(Y?(d.push(rt,st),d.push(rt,st)):(d.push(V,Z),d.push(V,Z)),m+=2),d.push(E-X*q,I-H*q),d.push(E+X*S,I+H*S),m+=2)}O=r[(y-2)*2],w=r[(y-2)*2+1],E=r[(y-1)*2],I=r[(y-1)*2+1],N=-(w-I),G=O-E,Q=Math.sqrt(N*N+G*G),N/=Q,G/=Q,N*=v,G*=v,d.push(E-N*q,I-G*q),d.push(E+N*S,I+G*S),h||(s.cap===LINE_CAP.ROUND?m+=round(E-N*(q-S)*.5,I-G*(q-S)*.5,E-N*q,I-G*q,E+N*S,I+G*S,d,!1)+2:s.cap===LINE_CAP.SQUARE&&(m+=square(E,I,N,G,q,S,!1,d)));for(var ht=e.indices,pt=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon,M=g;M<m+g-2;++M)O=d[M*2],w=d[M*2+1],E=d[(M+1)*2],I=d[(M+1)*2+1],b=d[(M+2)*2],k=d[(M+2)*2+1],!(Math.abs(O*(I-k)+E*(k-w)+b*(w-I))<pt)&&ht.push(M,M+1,M+2)}}function buildNativeLine(n,e){var t=0,r=n.shape,o=n.points||r.points,s=r.type!==SHAPES.POLY||r.closeStroke;if(o.length!==0){var a=e.points,u=e.indices,h=o.length/2,l=a.length/2,c=l;for(a.push(o[0],o[1]),t=1;t<h;t++)a.push(o[t*2],o[t*2+1]),u.push(c,c+1),c++;s&&u.push(c,l)}}function buildLine(n,e){n.lineStyle.native?buildNativeLine(n,e):buildNonNativeLine(n,e)}var ArcUtils=(function(){function n(){}return n.curveTo=function(e,t,r,o,s,a){var u=a[a.length-2],h=a[a.length-1],l=h-t,c=u-e,_=o-t,d=r-e,y=Math.abs(l*d-c*_);if(y<1e-8||s===0)return(a[a.length-2]!==e||a[a.length-1]!==t)&&a.push(e,t),null;var m=l*l+c*c,g=_*_+d*d,v=l*_+c*d,T=s*Math.sqrt(m)/y,A=s*Math.sqrt(g)/y,O=T*v/m,w=A*v/g,E=T*d+A*c,I=T*_+A*l,b=c*(A+O),k=l*(A+O),N=d*(T+w),G=_*(T+w),X=Math.atan2(k-I,b-E),H=Math.atan2(G-I,N-E);return{cx:E+e,cy:I+t,radius:s,startAngle:X,endAngle:H,anticlockwise:c*_>d*l}},n.arc=function(e,t,r,o,s,a,u,h,l){for(var c=u-a,_=GRAPHICS_CURVES._segmentsCount(Math.abs(c)*s,Math.ceil(Math.abs(c)/PI_2)*40),d=c/(_*2),y=d*2,m=Math.cos(d),g=Math.sin(d),v=_-1,T=v%1/v,A=0;A<=v;++A){var O=A+T*A,w=d+a+y*O,E=Math.cos(w),I=-Math.sin(w);l.push((m*E+g*I)*s+r,(m*-I+g*E)*s+o)}},n})(),BezierUtils=(function(){function n(){}return n.curveLength=function(e,t,r,o,s,a,u,h){for(var l=10,c=0,_=0,d=0,y=0,m=0,g=0,v=0,T=0,A=0,O=0,w=0,E=e,I=t,b=1;b<=l;++b)_=b/l,d=_*_,y=d*_,m=1-_,g=m*m,v=g*m,T=v*e+3*g*_*r+3*m*d*s+y*u,A=v*t+3*g*_*o+3*m*d*a+y*h,O=E-T,w=I-A,E=T,I=A,c+=Math.sqrt(O*O+w*w);return c},n.curveTo=function(e,t,r,o,s,a,u){var h=u[u.length-2],l=u[u.length-1];u.length-=2;var c=GRAPHICS_CURVES._segmentsCount(n.curveLength(h,l,e,t,r,o,s,a)),_=0,d=0,y=0,m=0,g=0;u.push(h,l);for(var v=1,T=0;v<=c;++v)T=v/c,_=1-T,d=_*_,y=d*_,m=T*T,g=m*T,u.push(y*h+3*d*T*e+3*_*m*r+g*s,y*l+3*d*T*t+3*_*m*o+g*a)},n})(),QuadraticUtils=(function(){function n(){}return n.curveLength=function(e,t,r,o,s,a){var u=e-2*r+s,h=t-2*o+a,l=2*r-2*e,c=2*o-2*t,_=4*(u*u+h*h),d=4*(u*l+h*c),y=l*l+c*c,m=2*Math.sqrt(_+d+y),g=Math.sqrt(_),v=2*_*g,T=2*Math.sqrt(y),A=d/g;return(v*m+g*d*(m-T)+(4*y*_-d*d)*Math.log((2*g+A+m)/(A+T)))/(4*v)},n.curveTo=function(e,t,r,o,s){for(var a=s[s.length-2],u=s[s.length-1],h=GRAPHICS_CURVES._segmentsCount(n.curveLength(a,u,e,t,r,o)),l=0,c=0,_=1;_<=h;++_){var d=_/h;l=a+(e-a)*d,c=u+(t-u)*d,s.push(l+(e+(r-e)*d-l)*d,c+(t+(o-t)*d-c)*d)}},n})(),BatchPart=(function(){function n(){this.reset()}return n.prototype.begin=function(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r},n.prototype.end=function(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start},n.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},n})(),_a,FILL_COMMANDS=(_a={},_a[SHAPES.POLY]=buildPoly,_a[SHAPES.CIRC]=buildCircle,_a[SHAPES.ELIP]=buildCircle,_a[SHAPES.RECT]=buildRectangle,_a[SHAPES.RREC]=buildRoundedRectangle,_a),BATCH_POOL=[],DRAW_CALL_POOL=[],GraphicsData=(function(){function n(e,t,r,o){t===void 0&&(t=null),r===void 0&&(r=null),o===void 0&&(o=null),this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=o,this.type=e.type}return n.prototype.clone=function(){return new n(this.shape,this.fillStyle,this.lineStyle,this.matrix)},n.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},n})(),tmpPoint=new Point,GraphicsGeometry=(function(n){__extends$e(e,n);function e(){var t=n.call(this)||this;return t.closePointEps=1e-4,t.boundsPadding=0,t.uvsFloat32=null,t.indicesUint16=null,t.batchable=!1,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.drawCalls=[],t.batchDirty=-1,t.batches=[],t.dirty=0,t.cacheDirty=-1,t.clearDirty=0,t.shapeIndex=0,t._bounds=new Bounds,t.boundsDirty=-1,t}return Object.defineProperty(e.prototype,"bounds",{get:function(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[t]);this.drawCalls.length=0;for(var t=0;t<this.batches.length;t++){var r=this.batches[t];r.reset(),BATCH_POOL.push(r)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,r,o,s){r===void 0&&(r=null),o===void 0&&(o=null),s===void 0&&(s=null);var a=new GraphicsData(t,r,o,s);return this.graphicsData.push(a),this.dirty++,this},e.prototype.drawHole=function(t,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var o=new GraphicsData(t,null,null,r),s=this.graphicsData[this.graphicsData.length-1];return o.lineStyle=s.lineStyle,s.holes.push(o),this.dirty++,this},e.prototype.destroy=function(){n.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var r=this.graphicsData,o=0;o<r.length;++o){var s=r[o];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,tmpPoint):tmpPoint.copyFrom(t),s.shape.contains(tmpPoint.x,tmpPoint.y))){var a=!1;if(s.holes)for(var u=0;u<s.holes.length;u++){var h=s.holes[u];if(h.shape.contains(tmpPoint.x,tmpPoint.y)){a=!0;break}}if(!a)return!0}}return!1},e.prototype.updateBatches=function(){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var t=this.uvs,r=this.graphicsData,o=null,s=null;this.batches.length>0&&(o=this.batches[this.batches.length-1],s=o.style);for(var a=this.shapeIndex;a<r.length;a++){this.shapeIndex++;var u=r[a],h=u.fillStyle,l=u.lineStyle,c=FILL_COMMANDS[u.type];c.build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(h.visible||l.visible)&&this.processHoles(u.holes);for(var _=0;_<2;_++){var d=_===0?h:l;if(d.visible){var y=d.texture.baseTexture,m=this.indices.length,g=this.points.length/2;y.wrapMode=WRAP_MODES.REPEAT,_===0?this.processFill(u):this.processLine(u);var v=this.points.length/2-g;v!==0&&(o&&!this._compareStyles(s,d)&&(o.end(m,g),o=null),o||(o=BATCH_POOL.pop()||new BatchPart,o.begin(d,m,g),this.batches.push(o),s=d),this.addUvs(this.points,t,d.texture,g,v,d.matrix))}}}var T=this.indices.length,A=this.points.length/2;if(o&&o.end(T,A),this.batches.length===0){this.batchable=!0;return}var O=A>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&O===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=O?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},e.prototype._compareStyles=function(t,r){return!(!t||!r||t.texture.baseTexture!==r.texture.baseTexture||t.color+t.alpha!==r.color+r.alpha||!!t.native!=!!r.native)},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,r=this.graphicsData.length;t<r;t++){var o=this.graphicsData[t],s=o.fillStyle,a=o.lineStyle;if(s&&!s.texture.baseTexture.valid||a&&!a.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,r=0,o=t.length;r<o;r++)for(var s=t[r],a=0;a<s.size;a++){var u=s.start+a;this.indicesUint16[u]=this.indicesUint16[u]-s.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var t=this.batches,r=0;r<t.length;r++)if(t[r].style.native)return!1;return this.points.length<e.BATCHABLE_SIZE*2},e.prototype.buildDrawCalls=function(){for(var t=++BaseTexture._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[r]);this.drawCalls.length=0;var o=this.colors,s=this.textureIds,a=DRAW_CALL_POOL.pop();a||(a=new BatchDrawCall,a.texArray=new BatchTextureArray),a.texArray.count=0,a.start=0,a.size=0,a.type=DRAW_MODES.TRIANGLES;var u=0,h=null,l=0,c=!1,_=DRAW_MODES.TRIANGLES,d=0;this.drawCalls.push(a);for(var r=0;r<this.batches.length;r++){var y=this.batches[r],m=8,g=y.style,v=g.texture.baseTexture;c!==!!g.native&&(c=!!g.native,_=c?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES,h=null,u=m,t++),h!==v&&(h=v,v._batchEnabled!==t&&(u===m&&(t++,u=0,a.size>0&&(a=DRAW_CALL_POOL.pop(),a||(a=new BatchDrawCall,a.texArray=new BatchTextureArray),this.drawCalls.push(a)),a.start=d,a.size=0,a.texArray.count=0,a.type=_),v.touched=1,v._batchEnabled=t,v._batchLocation=u,v.wrapMode=WRAP_MODES.REPEAT,a.texArray.elements[a.texArray.count++]=v,u++)),a.size+=y.size,d+=y.size,l=v._batchLocation,this.addColors(o,g.color,g.alpha,y.attribSize,y.attribStart),this.addTextureIds(s,l,y.attribSize,y.attribStart)}BaseTexture._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,r=this.uvs,o=this.colors,s=this.textureIds,a=new ArrayBuffer(t.length*3*4),u=new Float32Array(a),h=new Uint32Array(a),l=0,c=0;c<t.length/2;c++)u[l++]=t[c*2],u[l++]=t[c*2+1],u[l++]=r[c*2],u[l++]=r[c*2+1],h[l++]=o[c],u[l++]=s[c];this._buffer.update(a),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){if(t.holes.length)buildPoly.triangulate(t,this);else{var r=FILL_COMMANDS[t.type];r.triangulate(t,this)}},e.prototype.processLine=function(t){buildLine(t,this);for(var r=0;r<t.holes.length;r++)buildLine(t.holes[r],this)},e.prototype.processHoles=function(t){for(var r=0;r<t.length;r++){var o=t[r],s=FILL_COMMANDS[o.type];s.build(o),o.matrix&&this.transformPoints(o.points,o.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,r){for(var o=0;o<t.length/2;o++){var s=t[o*2],a=t[o*2+1];t[o*2]=r.a*s+r.c*a+r.tx,t[o*2+1]=r.b*s+r.d*a+r.ty}},e.prototype.addColors=function(t,r,o,s,a){a===void 0&&(a=0);var u=(r>>16)+(r&65280)+((r&255)<<16),h=premultiplyTint(u,o);t.length=Math.max(t.length,a+s);for(var l=0;l<s;l++)t[a+l]=h},e.prototype.addTextureIds=function(t,r,o,s){s===void 0&&(s=0),t.length=Math.max(t.length,s+o);for(var a=0;a<o;a++)t[s+a]=r},e.prototype.addUvs=function(t,r,o,s,a,u){u===void 0&&(u=null);for(var h=0,l=r.length,c=o.frame;h<a;){var _=t[(s+h)*2],d=t[(s+h)*2+1];if(u){var y=u.a*_+u.c*d+u.tx;d=u.b*_+u.d*d+u.ty,_=y}h++,r.push(_/c.width,d/c.height)}var m=o.baseTexture;(c.width<m.width||c.height<m.height)&&this.adjustUvs(r,o,l,a)},e.prototype.adjustUvs=function(t,r,o,s){for(var a=r.baseTexture,u=1e-6,h=o+s*2,l=r.frame,c=l.width/a.width,_=l.height/a.height,d=l.x/l.width,y=l.y/l.height,m=Math.floor(t[o]+u),g=Math.floor(t[o+1]+u),v=o+2;v<h;v+=2)m=Math.min(m,Math.floor(t[v]+u)),g=Math.min(g,Math.floor(t[v+1]+u));d-=m,y-=g;for(var v=o;v<h;v+=2)t[v]=(t[v]+d)*c,t[v+1]=(t[v+1]+y)*_},e.BATCHABLE_SIZE=100,e})(BatchGeometry),LineStyle=(function(n){__extends$e(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.width=0,t.alignment=.5,t.native=!1,t.cap=LINE_CAP.BUTT,t.join=LINE_JOIN.MITER,t.miterLimit=10,t}return e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){n.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e})(FillStyle),temp=new Float32Array(3),DEFAULT_SHADERS={},Graphics=(function(n){__extends$e(e,n);function e(t){t===void 0&&(t=null);var r=n.call(this)||this;return r.shader=null,r.pluginName="batch",r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r._fillStyle=new FillStyle,r._lineStyle=new LineStyle,r._matrix=null,r._holeMode=!1,r.state=State.for2d(),r._geometry=t||new GraphicsGeometry,r._geometry.refCount++,r._transformID=-1,r.tint=16777215,r.blendMode=BLEND_MODES.NORMAL,r}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t,r,o,s,a){return t===void 0&&(t=null),r===void 0&&(r=0),o===void 0&&(o=1),s===void 0&&(s=.5),a===void 0&&(a=!1),typeof t=="number"&&(t={width:t,color:r,alpha:o,alignment:s,native:a}),this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){t=Object.assign({width:0,texture:Texture.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[r-2],t[r-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,r){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=r,this},e.prototype.lineTo=function(t,r){this.currentPath||this.moveTo(0,0);var o=this.currentPath.points,s=o[o.length-2],a=o[o.length-1];return(s!==t||a!==r)&&o.push(t,r),this},e.prototype._initCurve=function(t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,r]):this.moveTo(t,r)},e.prototype.quadraticCurveTo=function(t,r,o,s){this._initCurve();var a=this.currentPath.points;return a.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(t,r,o,s,a),this},e.prototype.bezierCurveTo=function(t,r,o,s,a,u){return this._initCurve(),BezierUtils.curveTo(t,r,o,s,a,u,this.currentPath.points),this},e.prototype.arcTo=function(t,r,o,s,a){this._initCurve(t,r);var u=this.currentPath.points,h=ArcUtils.curveTo(t,r,o,s,a,u);if(h){var l=h.cx,c=h.cy,_=h.radius,d=h.startAngle,y=h.endAngle,m=h.anticlockwise;this.arc(l,c,_,d,y,m)}return this},e.prototype.arc=function(t,r,o,s,a,u){if(u===void 0&&(u=!1),s===a)return this;!u&&a<=s?a+=PI_2:u&&s<=a&&(s+=PI_2);var h=a-s;if(h===0)return this;var l=t+Math.cos(s)*o,c=r+Math.sin(s)*o,_=this._geometry.closePointEps,d=this.currentPath?this.currentPath.points:null;if(d){var y=Math.abs(d[d.length-2]-l),m=Math.abs(d[d.length-1]-c);y<_&&m<_||d.push(l,c)}else this.moveTo(l,c),d=this.currentPath.points;return ArcUtils.arc(l,c,t,r,o,s,a,u,d),this},e.prototype.beginFill=function(t,r){return t===void 0&&(t=0),r===void 0&&(r=1),this.beginTextureFill({texture:Texture.WHITE,color:t,alpha:r})},e.prototype.beginTextureFill=function(t){t=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,r,o,s){return this.drawShape(new Rectangle(t,r,o,s))},e.prototype.drawRoundedRect=function(t,r,o,s,a){return this.drawShape(new RoundedRectangle(t,r,o,s,a))},e.prototype.drawCircle=function(t,r,o){return this.drawShape(new Circle(t,r,o))},e.prototype.drawEllipse=function(t,r,o,s){return this.drawShape(new Ellipse(t,r,o,s))},e.prototype.drawPolygon=function(){for(var t=arguments,r=[],o=0;o<arguments.length;o++)r[o]=t[o];var s,a=!0,u=r[0];u.points?(a=u.closeStroke,s=u.points):Array.isArray(r[0])?s=r[0]:s=r;var h=new Polygon(s);return h.closeStroke=a,this.drawShape(h),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===SHAPES.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var r=this._geometry;r.updateBatches(),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,r=this.blendMode,o=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=o,this.vertexData=new Float32Array(t.points);for(var s=0;s<o;s++){var a=t.batches[s],u=a.style.color,h=new Float32Array(this.vertexData.buffer,a.attribStart*4*2,a.attribSize*2),l=new Float32Array(t.uvsFloat32.buffer,a.attribStart*4*2,a.attribSize*2),c=new Uint16Array(t.indicesUint16.buffer,a.start*2,a.size),_={vertexData:h,blendMode:r,indices:c,uvs:l,_batchRGB:hex2rgb(u),_tintRGB:u,_texture:a.style.texture,alpha:a.style.alpha,worldAlpha:1};this.batches[s]=_}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,o=this.batches.length;r<o;r++){var s=this.batches[r];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}},e.prototype._renderDirect=function(t){var r=this._resolveDirectShader(t),o=this._geometry,s=this.tint,a=this.worldAlpha,u=r.uniforms,h=o.drawCalls;u.translationMatrix=this.transform.worldTransform,u.tint[0]=(s>>16&255)/255*a,u.tint[1]=(s>>8&255)/255*a,u.tint[2]=(s&255)/255*a,u.tint[3]=a,t.shader.bind(r),t.geometry.bind(o,r),t.state.set(this.state);for(var l=0,c=h.length;l<c;l++)this._renderDrawCallDirect(t,o.drawCalls[l])},e.prototype._renderDrawCallDirect=function(t,r){for(var o=r.texArray,s=r.type,a=r.size,u=r.start,h=o.count,l=0;l<h;l++)t.texture.bind(o.elements[l],l);t.geometry.draw(s,a,u)},e.prototype._resolveDirectShader=function(t){var r=this.shader,o=this.pluginName;if(!r){if(!DEFAULT_SHADERS[o]){for(var s=t.plugins[o].MAX_TEXTURES,a=new Int32Array(s),u=0;u<s;u++)a[u]=u;var h={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:a},!0)},l=t.plugins[o]._shader.program;DEFAULT_SHADERS[o]=new Shader(l,h)}r=DEFAULT_SHADERS[o]}return r},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var r=t.bounds,o=r.minX,s=r.minY,a=r.maxX,u=r.maxY;this._bounds.addFrame(this.transform,o,s,a,u)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=hex2rgb(this.tint,temp),r=0;r<this.batches.length;r++){var o=this.batches[r],s=o._batchRGB,a=t[0]*s[0]*255,u=t[1]*s[1]*255,h=t[2]*s[2]*255,l=(a<<16)+(u<<8)+(h|0);o._tintRGB=(l>>16)+(l&65280)+((l&255)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var r=this.transform.worldTransform,o=r.a,s=r.b,a=r.c,u=r.d,h=r.tx,l=r.ty,c=this._geometry.points,_=this.vertexData,d=0,y=0;y<c.length;y+=2){var m=c[y],g=c[y+1];_[d++]=o*m+a*g+h,_[d++]=u*g+s*m+l}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,n.prototype.destroy.call(this,t)},e.nextRoundedRectBehavior=!1,e._TEMP_POINT=new Point,e})(Container),extendStatics$d=function(n,e){return extendStatics$d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$d(n,e)};function __extends$d(n,e){extendStatics$d(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var tempPoint$2=new Point,indices=new Uint16Array([0,1,2,0,2,3]),Sprite=(function(n){__extends$d(e,n);function e(t){var r=n.call(this)||this;return r._anchor=new ObservablePoint(r._onAnchorUpdate,r,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=BLEND_MODES.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=t||Texture.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=indices,r.pluginName="batch",r.isSprite=!0,r._roundPixels=settings.ROUND_PIXELS,r}return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===t._updateID)){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var r=this.transform.worldTransform,o=r.a,s=r.b,a=r.c,u=r.d,h=r.tx,l=r.ty,c=this.vertexData,_=t.trim,d=t.orig,y=this._anchor,m=0,g=0,v=0,T=0;if(_?(g=_.x-y._x*d.width,m=g+_.width,T=_.y-y._y*d.height,v=T+_.height):(g=-y._x*d.width,m=g+d.width,T=-y._y*d.height,v=T+d.height),c[0]=o*g+a*T+h,c[1]=u*T+s*g+l,c[2]=o*m+a*T+h,c[3]=u*T+s*m+l,c[4]=o*m+a*v+h,c[5]=u*v+s*m+l,c[6]=o*g+a*v+h,c[7]=u*v+s*g+l,this._roundPixels)for(var A=settings.RESOLUTION,O=0;O<c.length;++O)c[O]=Math.round((c[O]*A|0)/A)}},e.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,r=this.vertexTrimmedData,o=t.orig,s=this._anchor,a=this.transform.worldTransform,u=a.a,h=a.b,l=a.c,c=a.d,_=a.tx,d=a.ty,y=-s._x*o.width,m=y+o.width,g=-s._y*o.height,v=g+o.height;r[0]=u*y+l*g+_,r[1]=c*g+h*y+d,r[2]=u*m+l*g+_,r[3]=c*g+h*m+d,r[4]=u*m+l*v+_,r[5]=c*v+h*m+d,r[6]=u*y+l*v+_,r[7]=c*v+h*y+d},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._localBounds.getRectangle(t)):n.prototype.getLocalBounds.call(this,t)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint$2);var r=this._texture.orig.width,o=this._texture.orig.height,s=-r*this.anchor.x,a=0;return tempPoint$2.x>=s&&tempPoint$2.x<s+r&&(a=-o*this.anchor.y,tempPoint$2.y>=a&&tempPoint$2.y<a+o)},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof t=="boolean"?t:t&&t.texture;if(r){var o=typeof t=="boolean"?t:t&&t.baseTexture;this._texture.destroy(!!o)}this._texture=null},e.from=function(t,r){var o=t instanceof Texture?t:Texture.from(t,r);return new e(o)},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var r=sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var r=sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e})(Container),extendStatics$c=function(n,e){return extendStatics$c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$c(n,e)};function __extends$c(n,e){extendStatics$c(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var TEXT_GRADIENT;(function(n){n[n.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",n[n.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(TEXT_GRADIENT||(TEXT_GRADIENT={}));var defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],TextStyle=(function(){function n(e){this.styleID=0,this.reset(),deepCopyProperties(this,e,e)}return n.prototype.clone=function(){var e={};return deepCopyProperties(e,this,defaultStyle),new n(e)},n.prototype.reset=function(){deepCopyProperties(this,defaultStyle,defaultStyle)},Object.defineProperty(n.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"breakWords",{get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(e){var t=getColor(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fill",{get:function(){return this._fill},set:function(e){var t=getColor(e);this._fill!==t&&(this._fill=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(e){areArraysEqual(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leading",{get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"stroke",{get:function(){return this._stroke},set:function(e){var t=getColor(e);this._stroke!==t&&(this._stroke=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"trim",{get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},enumerable:!1,configurable:!0}),n.prototype.toFontString=function(){var e=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(var r=t.length-1;r>=0;r--){var o=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(o)&&genericFontFamilies.indexOf(o)<0&&(o='"'+o+'"'),t[r]=o}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+t.join(",")},n})();function getSingleColor(n){return typeof n=="number"?hex2string(n):(typeof n=="string"&&n.indexOf("0x")===0&&(n=n.replace("0x","#")),n)}function getColor(n){if(Array.isArray(n)){for(var e=0;e<n.length;++e)n[e]=getSingleColor(n[e]);return n}else return getSingleColor(n)}function areArraysEqual(n,e){if(!Array.isArray(n)||!Array.isArray(e)||n.length!==e.length)return!1;for(var t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}function deepCopyProperties(n,e,t){for(var r in t)Array.isArray(e[r])?n[r]=e[r].slice():n[r]=e[r]}var contextSettings={willReadFrequently:!0},TextMetrics=(function(){function n(e,t,r,o,s,a,u,h,l){this.text=e,this.style=t,this.width=r,this.height=o,this.lines=s,this.lineWidths=a,this.lineHeight=u,this.maxLineWidth=h,this.fontProperties=l}return n.measureText=function(e,t,r,o){o===void 0&&(o=n._canvas),r=r??t.wordWrap;var s=t.toFontString(),a=n.measureFont(s);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);var u=o.getContext("2d",contextSettings);u.font=s;for(var h=r?n.wordWrap(e,t,o):e,l=h.split(/(?:\r\n|\r|\n)/),c=new Array(l.length),_=0,d=0;d<l.length;d++){var y=u.measureText(l[d]).width+(l[d].length-1)*t.letterSpacing;c[d]=y,_=Math.max(_,y)}var m=_+t.strokeThickness;t.dropShadow&&(m+=t.dropShadowDistance);var g=t.lineHeight||a.fontSize+t.strokeThickness,v=Math.max(g,a.fontSize+t.strokeThickness)+(l.length-1)*(g+t.leading);return t.dropShadow&&(v+=t.dropShadowDistance),new n(e,t,m,v,l,c,g+t.leading,_,a)},n.wordWrap=function(e,t,r){r===void 0&&(r=n._canvas);for(var o=r.getContext("2d",contextSettings),s=0,a="",u="",h=Object.create(null),l=t.letterSpacing,c=t.whiteSpace,_=n.collapseSpaces(c),d=n.collapseNewlines(c),y=!_,m=t.wordWrapWidth+l,g=n.tokenize(e),v=0;v<g.length;v++){var T=g[v];if(n.isNewline(T)){if(!d){u+=n.addLine(a),y=!_,a="",s=0;continue}T=" "}if(_){var A=n.isBreakingSpace(T),O=n.isBreakingSpace(a[a.length-1]);if(A&&O)continue}var w=n.getFromCache(T,l,h,o);if(w>m)if(a!==""&&(u+=n.addLine(a),a="",s=0),n.canBreakWords(T,t.breakWords))for(var E=n.wordWrapSplit(T),I=0;I<E.length;I++){for(var b=E[I],k=1;E[I+k];){var N=E[I+k],G=b[b.length-1];if(!n.canBreakChars(G,N,T,I,t.breakWords))b+=N;else break;k++}I+=b.length-1;var X=n.getFromCache(b,l,h,o);X+s>m&&(u+=n.addLine(a),y=!1,a="",s=0),a+=b,s+=X}else{a.length>0&&(u+=n.addLine(a),a="",s=0);var H=v===g.length-1;u+=n.addLine(T,!H),y=!1,a="",s=0}else w+s>m&&(y=!1,u+=n.addLine(a),a="",s=0),(a.length>0||!n.isBreakingSpace(T)||y)&&(a+=T,s+=w)}return u+=n.addLine(a,!1),u},n.addLine=function(e,t){return t===void 0&&(t=!0),e=n.trimRight(e),e=t?e+`
`:e,e},n.getFromCache=function(e,t,r,o){var s=r[e];if(typeof s!="number"){var a=e.length*t;s=o.measureText(e).width+a,r[e]=s}return s},n.collapseSpaces=function(e){return e==="normal"||e==="pre-line"},n.collapseNewlines=function(e){return e==="normal"},n.trimRight=function(e){if(typeof e!="string")return"";for(var t=e.length-1;t>=0;t--){var r=e[t];if(!n.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},n.isNewline=function(e){return typeof e!="string"?!1:n._newlines.indexOf(e.charCodeAt(0))>=0},n.isBreakingSpace=function(e,t){return typeof e!="string"?!1:n._breakingSpaces.indexOf(e.charCodeAt(0))>=0},n.tokenize=function(e){var t=[],r="";if(typeof e!="string")return t;for(var o=0;o<e.length;o++){var s=e[o],a=e[o+1];if(n.isBreakingSpace(s,a)||n.isNewline(s)){r!==""&&(t.push(r),r=""),t.push(s);continue}r+=s}return r!==""&&t.push(r),t},n.canBreakWords=function(e,t){return t},n.canBreakChars=function(e,t,r,o,s){return!0},n.wordWrapSplit=function(e){return e.split("")},n.measureFont=function(e){if(n._fonts[e])return n._fonts[e];var t={ascent:0,descent:0,fontSize:0},r=n._canvas,o=n._context;o.font=e;var s=n.METRICS_STRING+n.BASELINE_SYMBOL,a=Math.ceil(o.measureText(s).width),u=Math.ceil(o.measureText(n.BASELINE_SYMBOL).width),h=Math.ceil(n.HEIGHT_MULTIPLIER*u);u=u*n.BASELINE_MULTIPLIER|0,r.width=a,r.height=h,o.fillStyle="#f00",o.fillRect(0,0,a,h),o.font=e,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText(s,0,u);var l=o.getImageData(0,0,a,h).data,c=l.length,_=a*4,d=0,y=0,m=!1;for(d=0;d<u;++d){for(var g=0;g<_;g+=4)if(l[y+g]!==255){m=!0;break}if(!m)y+=_;else break}for(t.ascent=u-d,y=c-_,m=!1,d=h;d>u;--d){for(var g=0;g<_;g+=4)if(l[y+g]!==255){m=!0;break}if(!m)y-=_;else break}return t.descent=d-u,t.fontSize=t.ascent+t.descent,n._fonts[e]=t,t},n.clearMetrics=function(e){e===void 0&&(e=""),e?delete n._fonts[e]:n._fonts={}},Object.defineProperty(n,"_canvas",{get:function(){if(!n.__canvas){var e=void 0;try{var t=new OffscreenCanvas(0,0),r=t.getContext("2d",contextSettings);if(r&&r.measureText)return n.__canvas=t,t;e=settings.ADAPTER.createCanvas()}catch{e=settings.ADAPTER.createCanvas()}e.width=e.height=10,n.__canvas=e}return n.__canvas},enumerable:!1,configurable:!0}),Object.defineProperty(n,"_context",{get:function(){return n.__context||(n.__context=n._canvas.getContext("2d",contextSettings)),n.__context},enumerable:!1,configurable:!0}),n})();TextMetrics._fonts={};TextMetrics.METRICS_STRING="|ÉqÅ";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics.HEIGHT_MULTIPLIER=2;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Text=(function(n){__extends$c(e,n);function e(t,r,o){var s=this,a=!1;o||(o=settings.ADAPTER.createCanvas(),a=!0),o.width=3,o.height=3;var u=Texture.from(o);return u.orig=new Rectangle,u.trim=new Rectangle,s=n.call(this,u)||this,s._ownCanvas=a,s.canvas=o,s.context=o.getContext("2d",{willReadFrequently:!0}),s._resolution=settings.RESOLUTION,s._autoResolution=!0,s._text=null,s._style=null,s._styleListener=null,s._font="",s.text=t,s.style=r,s.localStyleID=-1,s}return e.prototype.updateText=function(t){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&t)){this._font=this._style.toFontString();var o=this.context,s=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=s.width,u=s.height,h=s.lines,l=s.lineHeight,c=s.lineWidths,_=s.maxLineWidth,d=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,a)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,u)+r.padding*2)*this._resolution),o.scale(this._resolution,this._resolution),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.font=this._font,o.lineWidth=r.strokeThickness,o.textBaseline=r.textBaseline,o.lineJoin=r.lineJoin,o.miterLimit=r.miterLimit;for(var y,m,g=r.dropShadow?2:1,v=0;v<g;++v){var T=r.dropShadow&&v===0,A=T?Math.ceil(Math.max(1,u)+r.padding*2):0,O=A*this._resolution;if(T){o.fillStyle="black",o.strokeStyle="black";var w=r.dropShadowColor,E=hex2rgb(typeof w=="number"?w:string2hex(w)),I=r.dropShadowBlur*this._resolution,b=r.dropShadowDistance*this._resolution;o.shadowColor="rgba("+E[0]*255+","+E[1]*255+","+E[2]*255+","+r.dropShadowAlpha+")",o.shadowBlur=I,o.shadowOffsetX=Math.cos(r.dropShadowAngle)*b,o.shadowOffsetY=Math.sin(r.dropShadowAngle)*b+O}else o.fillStyle=this._generateFillStyle(r,h,s),o.strokeStyle=r.stroke,o.shadowColor="black",o.shadowBlur=0,o.shadowOffsetX=0,o.shadowOffsetY=0;var k=(l-d.fontSize)/2;(!e.nextLineHeightBehavior||l-d.fontSize<0)&&(k=0);for(var N=0;N<h.length;N++)y=r.strokeThickness/2,m=r.strokeThickness/2+N*l+d.ascent+k,r.align==="right"?y+=_-c[N]:r.align==="center"&&(y+=(_-c[N])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(h[N],y+r.padding,m+r.padding-A,!0),r.fill&&this.drawLetterSpacing(h[N],y+r.padding,m+r.padding-A)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,r,o,s){s===void 0&&(s=!1);var a=this._style,u=a.letterSpacing,h=e.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(u===0||h){h&&(this.context.letterSpacing=u,this.context.textLetterSpacing=u),s?this.context.strokeText(t,r,o):this.context.fillText(t,r,o);return}for(var l=r,c=Array.from?Array.from(t):t.split(""),_=this.context.measureText(t).width,d=0,y=0;y<c.length;++y){var m=c[y];s?this.context.strokeText(m,l,o):this.context.fillText(m,l,o);for(var g="",v=y+1;v<c.length;++v)g+=c[v];d=this.context.measureText(g).width,l+=_-d+u,_=d}},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var r=trimCanvas(t);r.data&&(t.width=r.width,t.height=r.height,this.context.putImageData(r.data,0,0))}var o=this._texture,s=this._style,a=s.trim?0:s.padding,u=o.baseTexture;o.trim.width=o._frame.width=t.width/this._resolution,o.trim.height=o._frame.height=t.height/this._resolution,o.trim.x=-a,o.trim.y=-a,o.orig.width=o._frame.width-a*2,o.orig.height=o._frame.height-a*2,this._onTextureUpdate(),u.setRealSize(t.width,t.height,this._resolution),o.updateUvs(),this.dirty=!1},e.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),n.prototype._render.call(this,t)},e.prototype.updateTransform=function(){this.updateText(!0),n.prototype.updateTransform.call(this)},e.prototype.getBounds=function(t,r){return this.updateText(!0),this._textureID===-1&&(t=!1),n.prototype.getBounds.call(this,t,r)},e.prototype.getLocalBounds=function(t){return this.updateText(!0),n.prototype.getLocalBounds.call(this,t)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,r,o){var s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;var a,u=t.dropShadow?t.dropShadowDistance:0,h=t.padding||0,l=this.canvas.width/this._resolution-u-h*2,c=this.canvas.height/this._resolution-u-h*2,_=s.slice(),d=t.fillGradientStops.slice();if(!d.length)for(var y=_.length+1,m=1;m<y;++m)d.push(m/y);if(_.unshift(s[0]),d.unshift(0),_.push(s[s.length-1]),d.push(1),t.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){a=this.context.createLinearGradient(l/2,h,l/2,c+h);for(var g=o.fontProperties.fontSize+t.strokeThickness,m=0;m<r.length;m++){var v=o.lineHeight*(m-1)+g,T=o.lineHeight*m,A=T;m>0&&v>T&&(A=(T+v)/2);var O=T+g,w=o.lineHeight*(m+1),E=O;m+1<r.length&&w<O&&(E=(O+w)/2);for(var I=(E-A)/c,b=0;b<_.length;b++){var k=0;typeof d[b]=="number"?k=d[b]:k=b/_.length;var N=Math.min(1,Math.max(0,A/c+k*I));N=Number(N.toFixed(5)),a.addColorStop(N,_[b])}}}else{a=this.context.createLinearGradient(h,c/2,l+h,c/2);for(var G=_.length+1,X=1,m=0;m<_.length;m++){var H=void 0;typeof d[m]=="number"?H=d[m]:H=X/G,a.addColorStop(H,_[m]),X++}}return a},e.prototype.destroy=function(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},defaultDestroyOptions,t),n.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var r=sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var r=sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},t instanceof TextStyle?this._style=t:this._style=new TextStyle(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e.experimentalLetterSpacing=!1,e})(Sprite);settings.UPLOADS_PER_FRAME=4;var extendStatics$b=function(n,e){return extendStatics$b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$b(n,e)};function __extends$b(n,e){extendStatics$b(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var CountLimiter=(function(){function n(e){this.maxItemsPerFrame=e,this.itemsLeft=0}return n.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},n.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},n})();function findMultipleBaseTextures(n,e){var t=!1;if(n&&n._textures&&n._textures.length){for(var r=0;r<n._textures.length;r++)if(n._textures[r]instanceof Texture){var o=n._textures[r].baseTexture;e.indexOf(o)===-1&&(e.push(o),t=!0)}}return t}function findBaseTexture(n,e){if(n.baseTexture instanceof BaseTexture){var t=n.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function findTexture(n,e){if(n._texture&&n._texture instanceof Texture){var t=n._texture.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function drawText(n,e){return e instanceof Text?(e.updateText(!0),!0):!1}function calculateTextStyle(n,e){if(e instanceof TextStyle){var t=e.toFontString();return TextMetrics.measureFont(t),!0}return!1}function findText(n,e){if(n instanceof Text){e.indexOf(n.style)===-1&&e.push(n.style),e.indexOf(n)===-1&&e.push(n);var t=n._texture.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function findTextStyle(n,e){return n instanceof TextStyle?(e.indexOf(n)===-1&&e.push(n),!0):!1}var BasePrepare=(function(){function n(e){var t=this;this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){t.queue&&t.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}return n.prototype.upload=function(e,t){var r=this;return typeof e=="function"&&(t=e,e=null),t&&deprecation("6.5.0","BasePrepare.upload callback is deprecated, use the return Promise instead."),new Promise(function(o){e&&r.add(e);var s=function(){t?.(),o()};r.queue.length?(r.completes.push(s),r.ticking||(r.ticking=!0,Ticker.system.addOnce(r.tick,r,UPDATE_PRIORITY.UTILITY))):s()})},n.prototype.tick=function(){setTimeout(this.delayedTick,0)},n.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],t=!1;if(e&&!e._destroyed){for(var r=0,o=this.uploadHooks.length;r<o;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var s=this.completes.slice(0);this.completes.length=0;for(var r=0,o=s.length;r<o;r++)s[r]()}},n.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},n.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},n.prototype.add=function(e){for(var t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Container)for(var t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this},n.prototype.destroy=function(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},n})();function uploadBaseTextures(n,e){return e instanceof BaseTexture?(e._glTextures[n.CONTEXT_UID]||n.texture.bind(e),!0):!1}function uploadGraphics(n,e){if(!(e instanceof Graphics))return!1;var t=e.geometry;e.finishPoly(),t.updateBatches();for(var r=t.batches,o=0;o<r.length;o++){var s=r[o].style.texture;s&&uploadBaseTextures(n,s.baseTexture)}return t.batchable||n.geometry.bind(t,e._resolveDirectShader(n)),!0}function findGraphics(n,e){return n instanceof Graphics?(e.push(n),!0):!1}var Prepare=(function(n){__extends$b(e,n);function e(t){var r=n.call(this,t)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(findGraphics),r.registerUploadHook(uploadBaseTextures),r.registerUploadHook(uploadGraphics),r}return e.extension={name:"prepare",type:ExtensionType.RendererPlugin},e})(BasePrepare),Spritesheet=(function(){function n(e,t,r){r===void 0&&(r=null),this.linkedSheets=[],this._texture=e instanceof Texture?e:null,this.baseTexture=e instanceof BaseTexture?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;var o=this.baseTexture.resource;this.resolution=this._updateResolution(r||(o?o.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return n.prototype._updateResolution=function(e){e===void 0&&(e=null);var t=this.data.meta.scale,r=getResolutionOfUrl(e,null);return r===null&&(r=t!==void 0?parseFloat(t):1),r!==1&&this.baseTexture.setResolution(r),r},n.prototype.parse=function(e){var t=this;return e&&deprecation("6.5.0","Spritesheet.parse callback is deprecated, use the return Promise instead."),new Promise(function(r){t._callback=function(o){e?.(o),r(o)},t._batchIndex=0,t._frameKeys.length<=n.BATCH_SIZE?(t._processFrames(0),t._processAnimations(),t._parseComplete()):t._nextBatch()})},n.prototype._processFrames=function(e){for(var t=e,r=n.BATCH_SIZE;t-e<r&&t<this._frameKeys.length;){var o=this._frameKeys[t],s=this._frames[o],a=s.frame;if(a){var u=null,h=null,l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,c=new Rectangle(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?u=new Rectangle(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):u=new Rectangle(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(h=new Rectangle(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[o]=new Texture(this.baseTexture,u,c,h,s.rotated?2:0,s.anchor),Texture.addToCache(this.textures[o],o)}t++}},n.prototype._processAnimations=function(){var e=this.data.animations||{};for(var t in e){this.animations[t]=[];for(var r=0;r<e[t].length;r++){var o=e[t][r];this.animations[t].push(this.textures[o])}}},n.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},n.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*n.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*n.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},n.prototype.destroy=function(e){var t;e===void 0&&(e=!1);for(var r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)===null||t===void 0||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]},n.BATCH_SIZE=1e3,n})(),SpritesheetLoader=(function(){function n(){}return n.use=function(e,t){var r,o,s=this,a=e.name+"_image";if(!e.data||e.type!==LoaderResource.TYPE.JSON||!e.data.frames||s.resources[a]){t();return}var u=(o=(r=e.data)===null||r===void 0?void 0:r.meta)===null||o===void 0?void 0:o.related_multi_packs;if(Array.isArray(u))for(var h=function(m){if(typeof m!="string")return"continue";var g=m.replace(".json",""),v=url$1.resolve(e.url.replace(s.baseUrl,""),m);if(s.resources[g]||Object.values(s.resources).some(function(A){return url$1.format(url$1.parse(A.url))===v}))return"continue";var T={crossOrigin:e.crossOrigin,loadType:LoaderResource.LOAD_TYPE.XHR,xhrType:LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};s.add(g,v,T)},l=0,c=u;l<c.length;l++){var _=c[l];h(_)}var d={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},y=n.getResourcePath(e,s.baseUrl);s.add(a,y,d,function(m){if(m.error){t(m.error);return}var g=new Spritesheet(m.texture,e.data,e.url);g.parse().then(function(){e.spritesheet=g,e.textures=g.textures,t()})})},n.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:url$1.resolve(e.url.replace(t,""),e.data.meta.image)},n.extension=ExtensionType.Loader,n})(),extendStatics$a=function(n,e){return extendStatics$a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$a(n,e)};function __extends$a(n,e){extendStatics$a(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var tempPoint$1=new Point;(function(n){__extends$a(e,n);function e(t,r,o){r===void 0&&(r=100),o===void 0&&(o=100);var s=n.call(this,t)||this;return s.tileTransform=new Transform,s._width=r,s._height=o,s.uvMatrix=s.texture.uvMatrix||new TextureMatrix(t),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,r=this._height*-this._anchor._y,o=this._width*(1-this._anchor._x),s=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,r,o,s)},e.prototype.getLocalBounds=function(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):n.prototype.getLocalBounds.call(this,t)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint$1);var r=this._width,o=this._height,s=-r*this.anchor._x;if(tempPoint$1.x>=s&&tempPoint$1.x<s+r){var a=-o*this.anchor._y;if(tempPoint$1.y>=a&&tempPoint$1.y<a+o)return!0}return!1},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r){var o=t instanceof Texture?t:Texture.from(t,r);return new e(o,r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e})(Sprite);var fragmentSimpleSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,gl1VertexSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl1FragmentSrc=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,gl2VertexSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl2FragmentSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,tempMat=new Matrix,TilingSpriteRenderer=(function(n){__extends$a(e,n);function e(t){var r=n.call(this,t)||this;return t.runners.contextChange.add(r),r.quad=new QuadUv,r.state=State.for2d(),r}return e.prototype.contextChange=function(){var t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,r),this.shader=t.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,r):Shader.from(gl1VertexSrc,gl1FragmentSrc,r)},e.prototype.render=function(t){var r=this.renderer,o=this.quad,s=o.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);var a=t.uvRespectAnchor?t.anchor.x:0,u=t.uvRespectAnchor?t.anchor.y:0;s=o.uvs,s[0]=s[6]=-a,s[1]=s[3]=-u,s[2]=s[4]=1-a,s[5]=s[7]=1-u,o.invalidate();var h=t._texture,l=h.baseTexture,c=l.alphaMode>0,_=t.tileTransform.localTransform,d=t.uvMatrix,y=l.isPowerOfTwo&&h.frame.width===l.width&&h.frame.height===l.height;y&&(l._glTextures[r.CONTEXT_UID]?y=l.wrapMode!==WRAP_MODES.CLAMP:l.wrapMode===WRAP_MODES.CLAMP&&(l.wrapMode=WRAP_MODES.REPEAT));var m=y?this.simpleShader:this.shader,g=h.width,v=h.height,T=t._width,A=t._height;tempMat.set(_.a*g/T,_.b*g/A,_.c*v/T,_.d*v/A,_.tx/T,_.ty/A),tempMat.invert(),y?tempMat.prepend(d.mapCoord):(m.uniforms.uMapCoord=d.mapCoord.toArray(!0),m.uniforms.uClampFrame=d.uClampFrame,m.uniforms.uClampOffset=d.uClampOffset),m.uniforms.uTransform=tempMat.toArray(!0),m.uniforms.uColor=premultiplyTintToRgba(t.tint,t.worldAlpha,m.uniforms.uColor,c),m.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),m.uniforms.uSampler=h,r.shader.bind(m),r.geometry.bind(o),this.state.blendMode=correctBlendMode(t.blendMode,c),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin},e})(ObjectRenderer),extendStatics$9=function(n,e){return extendStatics$9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$9(n,e)};function __extends$9(n,e){extendStatics$9(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var MeshBatchUvs=(function(){function n(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return n.prototype.update=function(e){if(!(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}},n})(),tempPoint=new Point,tempPolygon=new Polygon,Mesh=(function(n){__extends$9(e,n);function e(t,r,o,s){s===void 0&&(s=DRAW_MODES.TRIANGLES);var a=n.call(this)||this;return a.geometry=t,a.shader=r,a.state=o||State.for2d(),a.drawMode=s,a.start=0,a.size=0,a.uvs=null,a.indices=null,a.vertexData=new Float32Array(1),a.vertexDirty=-1,a._transformID=-1,a._roundPixels=settings.ROUND_PIXELS,a.batchUvs=null,a}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var r=this.geometry.buffers[0].data,o=this.shader;o.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&r.length<e.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),t.batch.flush(),r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(r),t.state.set(this.state),t.geometry.bind(this.geometry,r),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var r=this.geometry,o=this.shader;o.uvMatrix&&(o.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=o._tintRGB,this._texture=o.texture;var s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,r=t.buffers[0],o=r.data,s=r._updateID;if(!(s===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==o.length&&(this.vertexData=new Float32Array(o.length));for(var a=this.transform.worldTransform,u=a.a,h=a.b,l=a.c,c=a.d,_=a.tx,d=a.ty,y=this.vertexData,m=0;m<y.length/2;m++){var g=o[m*2],v=o[m*2+1];y[m*2]=u*g+l*v+_,y[m*2+1]=h*g+c*v+d}if(this._roundPixels)for(var T=settings.RESOLUTION,m=0;m<y.length;++m)y[m]=Math.round((y[m]*T|0)/T);this.vertexDirty=s}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],r=this.shader;r.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(t,r.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,tempPoint);for(var r=this.geometry.getBuffer("aVertexPosition").data,o=tempPolygon.points,s=this.geometry.getIndex().data,a=s.length,u=this.drawMode===4?3:1,h=0;h+2<a;h+=u){var l=s[h]*2,c=s[h+1]*2,_=s[h+2]*2;if(o[0]=r[l],o[1]=r[l+1],o[2]=r[c],o[3]=r[c+1],o[4]=r[_],o[5]=r[_+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e})(Container),fragment$5=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,MeshMaterial=(function(n){__extends$9(e,n);function e(t,r){var o=this,s={uSampler:t,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};return r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(s,r.uniforms),o=n.call(this,r.program||Program.from(vertex$2,fragment$5),s)||this,o._colorDirty=!1,o.uvMatrix=new TextureMatrix(t),o.batchable=r.program===void 0,o.pluginName=r.pluginName,o.tint=r.tint,o.alpha=r.alpha,o}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e})(Shader),MeshGeometry=(function(n){__extends$9(e,n);function e(t,r,o){var s=n.call(this)||this,a=new Buffer(t),u=new Buffer(r,!0),h=new Buffer(o,!0,!0);return s.addAttribute("aVertexPosition",a,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",u,2,!1,TYPES.FLOAT).addIndex(h),s._updateId=-1,s}return Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e})(Geometry),extendStatics$8=function(n,e){return extendStatics$8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$8(n,e)};function __extends$8(n,e){extendStatics$8(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var BitmapFontData=(function(){function n(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}return n})(),TextFormat=(function(){function n(){}return n.test=function(e){return typeof e=="string"&&e.indexOf("info face=")===0},n.parse=function(e){var t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var o in t){var s=t[o].match(/^[a-z]+/gm)[0],a=t[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(var h in a){var l=a[h].split("="),c=l[0],_=l[1].replace(/"/gm,""),d=parseFloat(_),y=isNaN(d)?_:d;u[c]=y}r[s].push(u)}var m=new BitmapFontData;return r.info.forEach(function(g){return m.info.push({face:g.face,size:parseInt(g.size,10)})}),r.common.forEach(function(g){return m.common.push({lineHeight:parseInt(g.lineHeight,10)})}),r.page.forEach(function(g){return m.page.push({id:parseInt(g.id,10),file:g.file})}),r.char.forEach(function(g){return m.char.push({id:parseInt(g.id,10),page:parseInt(g.page,10),x:parseInt(g.x,10),y:parseInt(g.y,10),width:parseInt(g.width,10),height:parseInt(g.height,10),xoffset:parseInt(g.xoffset,10),yoffset:parseInt(g.yoffset,10),xadvance:parseInt(g.xadvance,10)})}),r.kerning.forEach(function(g){return m.kerning.push({first:parseInt(g.first,10),second:parseInt(g.second,10),amount:parseInt(g.amount,10)})}),r.distanceField.forEach(function(g){return m.distanceField.push({distanceRange:parseInt(g.distanceRange,10),fieldType:g.fieldType})}),m},n})(),XMLFormat=(function(){function n(){}return n.test=function(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},n.parse=function(e){for(var t=new BitmapFontData,r=e.getElementsByTagName("info"),o=e.getElementsByTagName("common"),s=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),u=e.getElementsByTagName("kerning"),h=e.getElementsByTagName("distanceField"),l=0;l<r.length;l++)t.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(var l=0;l<o.length;l++)t.common.push({lineHeight:parseInt(o[l].getAttribute("lineHeight"),10)});for(var l=0;l<s.length;l++)t.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(var l=0;l<a.length;l++){var c=a[l];t.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(var l=0;l<u.length;l++)t.kerning.push({first:parseInt(u[l].getAttribute("first"),10),second:parseInt(u[l].getAttribute("second"),10),amount:parseInt(u[l].getAttribute("amount"),10)});for(var l=0;l<h.length;l++)t.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return t},n})(),XMLStringFormat=(function(){function n(){}return n.test=function(e){if(typeof e=="string"&&e.indexOf("<font>")>-1){var t=new globalThis.DOMParser().parseFromString(e,"text/xml");return XMLFormat.test(t)}return!1},n.parse=function(e){var t=new globalThis.DOMParser().parseFromString(e,"text/xml");return XMLFormat.parse(t)},n})(),formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(n){for(var e=0;e<formats.length;e++)if(formats[e].test(n))return formats[e];return null}function generateFillStyle(n,e,t,r,o,s){var a=t.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;var u,h=t.dropShadow?t.dropShadowDistance:0,l=t.padding||0,c=n.width/r-h-l*2,_=n.height/r-h-l*2,d=a.slice(),y=t.fillGradientStops.slice();if(!y.length)for(var m=d.length+1,g=1;g<m;++g)y.push(g/m);if(d.unshift(a[0]),y.unshift(0),d.push(a[a.length-1]),y.push(1),t.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){u=e.createLinearGradient(c/2,l,c/2,_+l);for(var v=0,T=s.fontProperties.fontSize+t.strokeThickness,A=T/_,g=0;g<o.length;g++)for(var O=s.lineHeight*g,w=0;w<d.length;w++){var E=0;typeof y[w]=="number"?E=y[w]:E=w/d.length;var I=O/_+E*A,b=Math.max(v,I);b=Math.min(b,1),u.addColorStop(b,d[w]),v=b}}else{u=e.createLinearGradient(l,_/2,c+l,_/2);for(var k=d.length+1,N=1,g=0;g<d.length;g++){var G=void 0;typeof y[g]=="number"?G=y[g]:G=N/k,u.addColorStop(G,d[g]),N++}}return u}function drawGlyph(n,e,t,r,o,s,a){var u=t.text,h=t.fontProperties;e.translate(r,o),e.scale(s,s);var l=a.strokeThickness/2,c=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=generateFillStyle(n,e,a,s,[u],t),e.strokeStyle=a.stroke,a.dropShadow){var _=a.dropShadowColor,d=hex2rgb(typeof _=="number"?_:string2hex(_)),y=a.dropShadowBlur*s,m=a.dropShadowDistance*s;e.shadowColor="rgba("+d[0]*255+","+d[1]*255+","+d[2]*255+","+a.dropShadowAlpha+")",e.shadowBlur=y,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*m,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*m}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(u,l,c+t.lineHeight-h.descent),a.fill&&e.fillText(u,l,c+t.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function splitTextToCharacters(n){return Array.from?Array.from(n):n.split("")}function resolveCharacters(n){typeof n=="string"&&(n=[n]);for(var e=[],t=0,r=n.length;t<r;t++){var o=n[t];if(Array.isArray(o)){if(o.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+o.length+".");var s=o[0].charCodeAt(0),a=o[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(var u=s,h=a;u<=h;u++)e.push(String.fromCharCode(u))}else e.push.apply(e,splitTextToCharacters(o))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}function extractCharCode(n){return n.codePointAt?n.codePointAt(0):n.charCodeAt(0)}var BitmapFont=(function(){function n(e,t,r){var o,s,a=e.info[0],u=e.common[0],h=e.page[0],l=e.distanceField[0],c=getResolutionOfUrl(h.file),_={};this._ownsTextures=r,this.font=a.face,this.size=a.size,this.lineHeight=u.lineHeight/c,this.chars={},this.pageTextures=_;for(var d=0;d<e.page.length;d++){var y=e.page[d],m=y.id,g=y.file;_[m]=t instanceof Array?t[d]:t[g],l?.fieldType&&l.fieldType!=="none"&&(_[m].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,_[m].baseTexture.mipmap=MIPMAP_MODES.OFF)}for(var d=0;d<e.char.length;d++){var v=e.char[d],m=v.id,T=v.page,A=e.char[d],O=A.x,w=A.y,E=A.width,I=A.height,b=A.xoffset,k=A.yoffset,N=A.xadvance;O/=c,w/=c,E/=c,I/=c,b/=c,k/=c,N/=c;var G=new Rectangle(O+_[T].frame.x/c,w+_[T].frame.y/c,E,I);this.chars[m]={xOffset:b,yOffset:k,xAdvance:N,kerning:{},texture:new Texture(_[T].baseTexture,G),page:T}}for(var d=0;d<e.kerning.length;d++){var X=e.kerning[d],H=X.first,Q=X.second,tt=X.amount;H/=c,Q/=c,tt/=c,this.chars[Q]&&(this.chars[Q].kerning[H]=tt)}this.distanceFieldRange=l?.distanceRange,this.distanceFieldType=(s=(o=l?.fieldType)===null||o===void 0?void 0:o.toLowerCase())!==null&&s!==void 0?s:"none"}return n.prototype.destroy=function(){for(var e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(var e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null},n.install=function(e,t,r){var o;if(e instanceof BitmapFontData)o=e;else{var s=autoDetectFormat(e);if(!s)throw new Error("Unrecognized data format for font.");o=s.parse(e)}t instanceof Texture&&(t=[t]);var a=new n(o,t,r);return n.available[a.font]=a,a},n.uninstall=function(e){var t=n.available[e];if(!t)throw new Error("No font found named '"+e+"'");t.destroy(),delete n.available[e]},n.from=function(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var o=Object.assign({},n.defaultOptions,r),s=o.chars,a=o.padding,u=o.resolution,h=o.textureWidth,l=o.textureHeight,c=resolveCharacters(s),_=t instanceof TextStyle?t:new TextStyle(t),d=h,y=new BitmapFontData;y.info[0]={face:_.fontFamily,size:_.fontSize},y.common[0]={lineHeight:_.fontSize};for(var m=0,g=0,v,T,A,O=0,w=[],E=0;E<c.length;E++){v||(v=settings.ADAPTER.createCanvas(),v.width=h,v.height=l,T=v.getContext("2d"),A=new BaseTexture(v,{resolution:u}),w.push(new Texture(A)),y.page.push({id:w.length-1,file:""}));var I=c[E],b=TextMetrics.measureText(I,_,!1,v),k=b.width,N=Math.ceil(b.height),G=Math.ceil((_.fontStyle==="italic"?2:1)*k);if(g>=l-N*u){if(g===0)throw new Error("[BitmapFont] textureHeight "+l+"px is too small "+("(fontFamily: '"+_.fontFamily+"', fontSize: "+_.fontSize+"px, char: '"+I+"')"));--E,v=null,T=null,A=null,g=0,m=0,O=0;continue}if(O=Math.max(N+b.fontProperties.descent,O),G*u+m>=d){if(m===0)throw new Error("[BitmapFont] textureWidth "+h+"px is too small "+("(fontFamily: '"+_.fontFamily+"', fontSize: "+_.fontSize+"px, char: '"+I+"')"));--E,g+=O*u,g=Math.ceil(g),m=0,O=0;continue}drawGlyph(v,T,b,m,g,u,_);var X=extractCharCode(b.text);y.char.push({id:X,page:w.length-1,x:m/u,y:g/u,width:G,height:N,xoffset:0,yoffset:0,xadvance:Math.ceil(k-(_.dropShadow?_.dropShadowDistance:0)-(_.stroke?_.strokeThickness:0))}),m+=(G+2*a)*u,m=Math.ceil(m)}if(!r?.skipKerning)for(var E=0,H=c.length;E<H;E++)for(var Q=c[E],tt=0;tt<H;tt++){var q=c[tt],S=T.measureText(Q).width,M=T.measureText(q).width,R=T.measureText(Q+q).width,C=R-(S+M);C&&y.kerning.push({first:extractCharCode(Q),second:extractCharCode(q),amount:C})}var D=new n(y,w,!0);return n.available[e]!==void 0&&n.uninstall(e),n.available[e]=D,D},n.ALPHA=[["a","z"],["A","Z"]," "],n.NUMERIC=[["0","9"]],n.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],n.ASCII=[[" ","~"]],n.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:n.ALPHANUMERIC},n.available={},n})(),msdfFrag=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,msdfVert=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`,pageMeshDataDefaultPageMeshData=[],pageMeshDataMSDFPageMeshData=[],charRenderDataPool=[];(function(n){__extends$8(e,n);function e(t,r){r===void 0&&(r={});var o=n.call(this)||this;o._tint=16777215;var s=Object.assign({},e.styleDefaults,r),a=s.align,u=s.tint,h=s.maxWidth,l=s.letterSpacing,c=s.fontName,_=s.fontSize;if(!BitmapFont.available[c])throw new Error('Missing BitmapFont "'+c+'"');return o._activePagesMeshData=[],o._textWidth=0,o._textHeight=0,o._align=a,o._tint=u,o._font=void 0,o._fontName=c,o._fontSize=_,o.text=t,o._maxWidth=h,o._maxLineHeight=0,o._letterSpacing=l,o._anchor=new ObservablePoint(function(){o.dirty=!0},o,0,0),o._roundPixels=settings.ROUND_PIXELS,o.dirty=!0,o._resolution=settings.RESOLUTION,o._autoResolution=!0,o._textureCache={},o}return e.prototype.updateText=function(){for(var t,r=BitmapFont.available[this._fontName],o=this.fontSize,s=o/r.size,a=new Point,u=[],h=[],l=[],c=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",_=splitTextToCharacters(c),d=this._maxWidth*r.size/o,y=r.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData,m=null,g=0,v=0,T=0,A=-1,O=0,w=0,E=0,I=0,b=0;b<_.length;b++){var k=_[b],N=extractCharCode(k);if(/(?:\s)/.test(k)&&(A=b,O=g,I++),k==="\r"||k===`
`){h.push(g),l.push(-1),v=Math.max(v,g),++T,++w,a.x=0,a.y+=r.lineHeight,m=null,I=0;continue}var G=r.chars[N];if(G){m&&G.kerning[m]&&(a.x+=G.kerning[m]);var X=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};X.texture=G.texture,X.line=T,X.charCode=N,X.position.x=a.x+G.xOffset+this._letterSpacing/2,X.position.y=a.y+G.yOffset,X.prevSpaces=I,u.push(X),g=X.position.x+Math.max(G.xAdvance-G.xOffset,G.texture.orig.width),a.x+=G.xAdvance+this._letterSpacing,E=Math.max(E,G.yOffset+G.texture.height),m=N,A!==-1&&d>0&&a.x>d&&(++w,removeItems(u,1+A-w,1+b-A),b=A,A=-1,h.push(O),l.push(u.length>0?u[u.length-1].prevSpaces:0),v=Math.max(v,O),T++,a.x=0,a.y+=r.lineHeight,m=null,I=0)}}var H=_[_.length-1];H!=="\r"&&H!==`
`&&(/(?:\s)/.test(H)&&(g=O),h.push(g),v=Math.max(v,g),l.push(-1));for(var Q=[],b=0;b<=T;b++){var tt=0;this._align==="right"?tt=v-h[b]:this._align==="center"?tt=(v-h[b])/2:this._align==="justify"&&(tt=l[b]<0?0:(v-h[b])/l[b]),Q.push(tt)}var q=u.length,S={},M=[],R=this._activePagesMeshData;y.push.apply(y,R);for(var b=0;b<q;b++){var C=u[b].texture,D=C.baseTexture.uid;if(!S[D]){var P=y.pop();if(!P){var B=new MeshGeometry,L=void 0,Y=void 0;r.distanceFieldType==="none"?(L=new MeshMaterial(Texture.EMPTY),Y=BLEND_MODES.NORMAL):(L=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}}),Y=BLEND_MODES.NORMAL_NPM);var z=new Mesh(B,L);z.blendMode=Y,P={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:z,vertices:null,uvs:null,indices:null}}P.index=0,P.indexCount=0,P.vertexCount=0,P.uvsCount=0,P.total=0;var $=this._textureCache;$[D]=$[D]||new Texture(C.baseTexture),P.mesh.texture=$[D],P.mesh.tint=this._tint,M.push(P),S[D]=P}S[D].total++}for(var b=0;b<R.length;b++)M.indexOf(R[b])===-1&&this.removeChild(R[b].mesh);for(var b=0;b<M.length;b++)M[b].mesh.parent!==this&&this.addChild(M[b].mesh);this._activePagesMeshData=M;for(var b in S){var P=S[b],W=P.total;if(!(((t=P.indices)===null||t===void 0?void 0:t.length)>6*W)||P.vertices.length<Mesh.BATCHABLE_SIZE*2)P.vertices=new Float32Array(8*W),P.uvs=new Float32Array(8*W),P.indices=new Uint16Array(6*W);else for(var et=P.total,K=P.vertices,V=et*4*2;V<K.length;V++)K[V]=0;P.mesh.size=6*W}for(var b=0;b<q;b++){var k=u[b],Z=k.position.x+Q[k.line]*(this._align==="justify"?k.prevSpaces:1);this._roundPixels&&(Z=Math.round(Z));var rt=Z*s,st=k.position.y*s,C=k.texture,it=S[C.baseTexture.uid],J=C.frame,nt=C._uvs,ot=it.index++;it.indices[ot*6+0]=0+ot*4,it.indices[ot*6+1]=1+ot*4,it.indices[ot*6+2]=2+ot*4,it.indices[ot*6+3]=0+ot*4,it.indices[ot*6+4]=2+ot*4,it.indices[ot*6+5]=3+ot*4,it.vertices[ot*8+0]=rt,it.vertices[ot*8+1]=st,it.vertices[ot*8+2]=rt+J.width*s,it.vertices[ot*8+3]=st,it.vertices[ot*8+4]=rt+J.width*s,it.vertices[ot*8+5]=st+J.height*s,it.vertices[ot*8+6]=rt,it.vertices[ot*8+7]=st+J.height*s,it.uvs[ot*8+0]=nt.x0,it.uvs[ot*8+1]=nt.y0,it.uvs[ot*8+2]=nt.x1,it.uvs[ot*8+3]=nt.y1,it.uvs[ot*8+4]=nt.x2,it.uvs[ot*8+5]=nt.y2,it.uvs[ot*8+6]=nt.x3,it.uvs[ot*8+7]=nt.y3}this._textWidth=v*s,this._textHeight=(a.y+r.lineHeight)*s;for(var b in S){var P=S[b];if(this.anchor.x!==0||this.anchor.y!==0)for(var ht=0,pt=this._textWidth*this.anchor.x,ft=this._textHeight*this.anchor.y,gt=0;gt<P.total;gt++)P.vertices[ht++]-=pt,P.vertices[ht++]-=ft,P.vertices[ht++]-=pt,P.vertices[ht++]-=ft,P.vertices[ht++]-=pt,P.vertices[ht++]-=ft,P.vertices[ht++]-=pt,P.vertices[ht++]-=ft;this._maxLineHeight=E*s;var yt=P.mesh.geometry.getBuffer("aVertexPosition"),mt=P.mesh.geometry.getBuffer("aTextureCoord"),Rt=P.mesh.geometry.getIndex();yt.data=P.vertices,mt.data=P.uvs,Rt.data=P.indices,yt.update(),mt.update(),Rt.update()}for(var b=0;b<u.length;b++)charRenderDataPool.push(u[b]);this._font=r,this.dirty=!1},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);var r=BitmapFont.available[this._fontName],o=r.distanceFieldRange,s=r.distanceFieldType,a=r.size;if(s!=="none")for(var u=this.worldTransform,h=u.a,l=u.b,c=u.c,_=u.d,d=Math.sqrt(h*h+l*l),y=Math.sqrt(c*c+_*_),m=(Math.abs(d)+Math.abs(y))/2,g=this.fontSize/a,v=0,T=this._activePagesMeshData;v<T.length;v++){var A=T[v];A.mesh.shader.uniforms.uFWidth=m*o*g*this._resolution}n.prototype._render.call(this,t)},e.prototype.getLocalBounds=function(){return this.validate(),n.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){var t=BitmapFont.available[this._fontName];if(!t)throw new Error('Missing BitmapFont "'+this._fontName+'"');this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!BitmapFont.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){var t;return(t=this._fontSize)!==null&&t!==void 0?t:BitmapFont.available[this._fontName].size},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.prototype.destroy=function(t){var r=this._textureCache,o=BitmapFont.available[this._fontName],s=o.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;s.push.apply(s,this._activePagesMeshData);for(var a=0,u=this._activePagesMeshData;a<u.length;a++){var h=u[a];this.removeChild(h.mesh)}this._activePagesMeshData=[],s.filter(function(_){return r[_.mesh.texture.baseTexture.uid]}).forEach(function(_){_.mesh.texture=Texture.EMPTY});for(var l in r){var c=r[l];c.destroy(),delete r[l]}this._font=null,this._textureCache=null,n.prototype.destroy.call(this,t)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e})(Container);var BitmapFontLoader=(function(){function n(){}return n.add=function(){LoaderResource.setExtensionXhrType("fnt",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},n.use=function(e,t){var r=autoDetectFormat(e.data);if(!r){t();return}for(var o=n.getBaseUrl(this,e),s=r.parse(e.data),a={},u=function(g){a[g.metadata.pageFile]=g.texture,Object.keys(a).length===s.page.length&&(e.bitmapFont=BitmapFont.install(s,a,!0),t())},h=0;h<s.page.length;++h){var l=s.page[h].file,c=o+l,_=!1;for(var d in this.resources){var y=this.resources[d];if(y.url===c){y.metadata.pageFile=l,y.texture?u(y):y.onAfterMiddleware.add(u),_=!0;break}}if(!_){var m={crossOrigin:e.crossOrigin,loadType:LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(c,m,u)}}},n.getBaseUrl=function(e,t){var r=t.isDataUrl?"":n.dirname(t.url);return t.isDataUrl&&(r==="."&&(r=""),e.baseUrl&&r&&e.baseUrl.charAt(e.baseUrl.length-1)==="/"&&(r+="/")),r=r.replace(e.baseUrl,""),r&&r.charAt(r.length-1)!=="/"&&(r+="/"),r},n.dirname=function(e){var t=e.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return t===e?".":t===""?"/":t},n.extension=ExtensionType.Loader,n})(),extendStatics$7=function(n,e){return extendStatics$7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$7(n,e)};function __extends$7(n,e){extendStatics$7(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment$4=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;(function(n){__extends$7(e,n);function e(t){t===void 0&&(t=1);var r=n.call(this,defaultVertex$1,fragment$4,{uAlpha:1})||this;return r.alpha=t,r}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e})(Filter);var extendStatics$6=function(n,e){return extendStatics$6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$6(n,e)};function __extends$6(n,e){extendStatics$6(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vertTemplate=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function generateBlurVertSource(n,e){var t=Math.ceil(n/2),r=vertTemplate,o="",s;e?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<n;a++){var u=s.replace("%index%",a.toString());u=u.replace("%sampleIndex%",a-(t-1)+".0"),o+=u,o+=`
`}return r=r.replace("%blur%",o),r=r.replace("%size%",n.toString()),r}var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function generateBlurFragSource(n){for(var e=GAUSSIAN_VALUES[n],t=e.length,r=fragTemplate,o="",s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",a,u=0;u<n;u++){var h=s.replace("%index%",u.toString());a=u,u>=t&&(a=n-u-1),h=h.replace("%value%",e[a].toString()),o+=h,o+=`
`}return r=r.replace("%blur%",o),r=r.replace("%size%",n.toString()),r}var BlurFilterPass=(function(n){__extends$6(e,n);function e(t,r,o,s,a){r===void 0&&(r=8),o===void 0&&(o=4),s===void 0&&(s=settings.FILTER_RESOLUTION),a===void 0&&(a=5);var u=this,h=generateBlurVertSource(a,t),l=generateBlurFragSource(a);return u=n.call(this,h,l)||this,u.horizontal=t,u.resolution=s,u._quality=0,u.quality=o,u.blur=r,u}return e.prototype.apply=function(t,r,o,s){if(o?this.horizontal?this.uniforms.strength=1/o.width*(o.width/r.width):this.uniforms.strength=1/o.height*(o.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,o,s);else{var a=t.getFilterTexture(),u=t.renderer,h=r,l=a;this.state.blend=!1,t.applyFilter(this,h,l,CLEAR_MODES.CLEAR);for(var c=1;c<this.passes-1;c++){t.bindAndClear(h,CLEAR_MODES.BLIT),this.uniforms.uSampler=l;var _=l;l=h,h=_,u.shader.bind(this),u.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,o,s),t.returnFilterTexture(a)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+Math.abs(t)*2,this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e})(Filter),BlurFilter$1=(function(n){__extends$6(e,n);function e(t,r,o,s){t===void 0&&(t=8),r===void 0&&(r=4),o===void 0&&(o=settings.FILTER_RESOLUTION),s===void 0&&(s=5);var a=n.call(this)||this;return a.blurXFilter=new BlurFilterPass(!0,t,r,o,s),a.blurYFilter=new BlurFilterPass(!1,t,r,o,s),a.resolution=o,a.quality=r,a.blur=t,a.repeatEdgePixels=!1,a}return e.prototype.apply=function(t,r,o,s){var a=Math.abs(this.blurXFilter.strength),u=Math.abs(this.blurYFilter.strength);if(a&&u){var h=t.getFilterTexture();this.blurXFilter.apply(t,r,h,CLEAR_MODES.CLEAR),this.blurYFilter.apply(t,h,o,s),t.returnFilterTexture(h)}else u?this.blurYFilter.apply(t,r,o,s):this.blurXFilter.apply(t,r,o,s)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e})(Filter),extendStatics$5=function(n,e){return extendStatics$5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$5(n,e)};function __extends$5(n,e){extendStatics$5(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment$3=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,ColorMatrixFilter$1=(function(n){__extends$5(e,n);function e(){var t=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return t=n.call(this,defaultFilterVertex,fragment$3,r)||this,t.alpha=1,t}return e.prototype._loadMatrix=function(t,r){r===void 0&&(r=!1);var o=t;r&&(this._multiply(o,this.uniforms.m,t),o=this._colorMatrix(o)),this.uniforms.m=o},e.prototype._multiply=function(t,r,o){return t[0]=r[0]*o[0]+r[1]*o[5]+r[2]*o[10]+r[3]*o[15],t[1]=r[0]*o[1]+r[1]*o[6]+r[2]*o[11]+r[3]*o[16],t[2]=r[0]*o[2]+r[1]*o[7]+r[2]*o[12]+r[3]*o[17],t[3]=r[0]*o[3]+r[1]*o[8]+r[2]*o[13]+r[3]*o[18],t[4]=r[0]*o[4]+r[1]*o[9]+r[2]*o[14]+r[3]*o[19]+r[4],t[5]=r[5]*o[0]+r[6]*o[5]+r[7]*o[10]+r[8]*o[15],t[6]=r[5]*o[1]+r[6]*o[6]+r[7]*o[11]+r[8]*o[16],t[7]=r[5]*o[2]+r[6]*o[7]+r[7]*o[12]+r[8]*o[17],t[8]=r[5]*o[3]+r[6]*o[8]+r[7]*o[13]+r[8]*o[18],t[9]=r[5]*o[4]+r[6]*o[9]+r[7]*o[14]+r[8]*o[19]+r[9],t[10]=r[10]*o[0]+r[11]*o[5]+r[12]*o[10]+r[13]*o[15],t[11]=r[10]*o[1]+r[11]*o[6]+r[12]*o[11]+r[13]*o[16],t[12]=r[10]*o[2]+r[11]*o[7]+r[12]*o[12]+r[13]*o[17],t[13]=r[10]*o[3]+r[11]*o[8]+r[12]*o[13]+r[13]*o[18],t[14]=r[10]*o[4]+r[11]*o[9]+r[12]*o[14]+r[13]*o[19]+r[14],t[15]=r[15]*o[0]+r[16]*o[5]+r[17]*o[10]+r[18]*o[15],t[16]=r[15]*o[1]+r[16]*o[6]+r[17]*o[11]+r[18]*o[16],t[17]=r[15]*o[2]+r[16]*o[7]+r[17]*o[12]+r[18]*o[17],t[18]=r[15]*o[3]+r[16]*o[8]+r[17]*o[13]+r[18]*o[18],t[19]=r[15]*o[4]+r[16]*o[9]+r[17]*o[14]+r[18]*o[19]+r[19],t},e.prototype._colorMatrix=function(t){var r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},e.prototype.brightness=function(t,r){var o=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.tint=function(t,r){var o=t>>16&255,s=t>>8&255,a=t&255,u=[o/255,0,0,0,0,0,s/255,0,0,0,0,0,a/255,0,0,0,0,0,1,0];this._loadMatrix(u,r)},e.prototype.greyscale=function(t,r){var o=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.blackAndWhite=function(t){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.hue=function(t,r){t=(t||0)/180*Math.PI;var o=Math.cos(t),s=Math.sin(t),a=Math.sqrt,u=1/3,h=a(u),l=o+(1-o)*u,c=u*(1-o)-h*s,_=u*(1-o)+h*s,d=u*(1-o)+h*s,y=o+u*(1-o),m=u*(1-o)-h*s,g=u*(1-o)-h*s,v=u*(1-o)+h*s,T=o+u*(1-o),A=[l,c,_,0,0,d,y,m,0,0,g,v,T,0,0,0,0,0,1,0];this._loadMatrix(A,r)},e.prototype.contrast=function(t,r){var o=(t||0)+1,s=-.5*(o-1),a=[o,0,0,0,s,0,o,0,0,s,0,0,o,0,s,0,0,0,1,0];this._loadMatrix(a,r)},e.prototype.saturate=function(t,r){t===void 0&&(t=0);var o=t*2/3+1,s=(o-1)*-.5,a=[o,s,s,0,0,s,o,s,0,0,s,s,o,0,0,0,0,0,1,0];this._loadMatrix(a,r)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.sepia=function(t){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.technicolor=function(t){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.polaroid=function(t){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.toBGR=function(t){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.kodachrome=function(t){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.browni=function(t){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.vintage=function(t){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.colorTone=function(t,r,o,s,a){t=t||.2,r=r||.15,o=o||16770432,s=s||3375104;var u=(o>>16&255)/255,h=(o>>8&255)/255,l=(o&255)/255,c=(s>>16&255)/255,_=(s>>8&255)/255,d=(s&255)/255,y=[.3,.59,.11,0,0,u,h,l,t,0,c,_,d,r,0,u-c,h-_,l-d,0,0];this._loadMatrix(y,a)},e.prototype.night=function(t,r){t=t||.1;var o=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.predator=function(t,r){var o=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.lsd=function(t){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.reset=function(){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e})(Filter);ColorMatrixFilter$1.prototype.grayscale=ColorMatrixFilter$1.prototype.greyscale;var extendStatics$4=function(n,e){return extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$4(n,e)};function __extends$4(n,e){extendStatics$4(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment$2=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,vertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;(function(n){__extends$4(e,n);function e(t,r){var o=this,s=new Matrix;return t.renderable=!1,o=n.call(this,vertex$1,fragment$2,{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,o.maskSprite=t,o.maskMatrix=s,r==null&&(r=20),o.scale=new Point(r,r),o}return e.prototype.apply=function(t,r,o,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var a=this.maskSprite.worldTransform,u=Math.sqrt(a.a*a.a+a.b*a.b),h=Math.sqrt(a.c*a.c+a.d*a.d);u!==0&&h!==0&&(this.uniforms.rotation[0]=a.a/u,this.uniforms.rotation[1]=a.b/u,this.uniforms.rotation[2]=a.c/h,this.uniforms.rotation[3]=a.d/h),t.applyFilter(this,r,o,s)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e})(Filter);var extendStatics$3=function(n,e){return extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$3(n,e)};function __extends$3(n,e){extendStatics$3(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vertex=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,fragment$1=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;(function(n){__extends$3(e,n);function e(){return n.call(this,vertex,fragment$1)||this}return e})(Filter);var extendStatics$2=function(n,e){return extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$2(n,e)};function __extends$2(n,e){extendStatics$2(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fragment=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,NoiseFilter$1=(function(n){__extends$2(e,n);function e(t,r){t===void 0&&(t=.5),r===void 0&&(r=Math.random());var o=n.call(this,defaultFilterVertex,fragment,{uNoise:0,uSeed:0})||this;return o.noise=t,o.seed=r,o}return Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e})(Filter),_tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;DisplayObject.prototype._cacheAsBitmapMultisample=MSAA_QUALITY.NONE;var CacheData=(function(){function n(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return n})();Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(n){n!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(n){n!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(n){if(this._cacheAsBitmap!==n){this._cacheAsBitmap=n;var e;n?(this._cacheData||(this._cacheData=new CacheData),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}});DisplayObject.prototype._renderCached=function(n){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(n),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(n))};DisplayObject.prototype._initCachedDisplayObject=function(n){var e;if(!(this._cacheData&&this._cacheData.sprite)){var t=this.alpha;this.alpha=1,n.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters&&this.filters.length){var o=this.filters[0].padding;r.pad(o)}r.ceil(settings.RESOLUTION);var s=n.renderTexture.current,a=n.renderTexture.sourceFrame.clone(),u=n.renderTexture.destinationFrame.clone(),h=n.projection.transform,l=RenderTexture.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||n.resolution,multisample:(e=this.cacheAsBitmapMultisample)!==null&&e!==void 0?e:n.multisample}),c="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=c,BaseTexture.addToCache(l.baseTexture,c),Texture.addToCache(l,c);var _=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,n.render(this,{renderTexture:l,clear:!0,transform:_,skipUpdateTransform:!1}),n.framebuffer.blit(),n.projection.transform=h,n.renderTexture.bind(s,a,u),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;var d=new Sprite(l);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(r.x/r.width),d.anchor.y=-(r.y/r.height),d.alpha=t,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}};DisplayObject.prototype._renderCachedCanvas=function(n){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(n),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(n))};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(n){if(!(this._cacheData&&this._cacheData.sprite)){var e=this.getLocalBounds(null,!0),t=this.alpha;this.alpha=1;var r=n.context,o=n._projTransform;e.ceil(settings.RESOLUTION);var s=RenderTexture.create({width:e.width,height:e.height}),a="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=a,BaseTexture.addToCache(s.baseTexture,a),Texture.addToCache(s,a);var u=_tempMatrix;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=e.x,u.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,n.render(this,{renderTexture:s,clear:!0,transform:u,skipUpdateTransform:!1}),n.context=r,n._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;var h=new Sprite(s);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(e.x/e.width),h.anchor.y=-(e.y/e.height),h.alpha=t,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=n._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)}};DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(n){this.cacheAsBitmap=!1,this.destroy(n)};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function(n,e){for(var t=0,r=this.children.length;t<r;t++)if(this.children[t].name===n)return this.children[t];if(e)for(var t=0,r=this.children.length;t<r;t++){var o=this.children[t];if(o.getChildByName){var s=o.getChildByName(n,!0);if(s)return s}}return null};DisplayObject.prototype.getGlobalPosition=function(n,e){return n===void 0&&(n=new Point),e===void 0&&(e=!1),this.parent?this.parent.toGlobal(this.position,n,e):(n.x=this.position.x,n.y=this.position.y),n};var ResizePlugin=(function(){function n(){}return n.init=function(e){var t=this;Object.defineProperty(this,"resizeTo",{set:function(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){t._resizeTo&&(t.cancelResize(),t._resizeId=requestAnimationFrame(function(){return t.resize()}))},this.cancelResize=function(){t._resizeId&&(cancelAnimationFrame(t._resizeId),t._resizeId=null)},this.resize=function(){if(t._resizeTo){t.cancelResize();var r,o;if(t._resizeTo===globalThis.window)r=globalThis.innerWidth,o=globalThis.innerHeight;else{var s=t._resizeTo,a=s.clientWidth,u=s.clientHeight;r=a,o=u}t.renderer.resize(r,o)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},n.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},n.extension=ExtensionType.Application,n})(),Application=(function(){function n(e){var t=this;this.stage=new Container,e=Object.assign({forceCanvas:!1},e),this.renderer=autoDetectRenderer(e),n._plugins.forEach(function(r){r.init.call(t,e)})}return n.registerPlugin=function(e){deprecation("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),extensions.add({type:ExtensionType.Application,ref:e})},n.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(n.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),n.prototype.destroy=function(e,t){var r=this,o=n._plugins.slice(0);o.reverse(),o.forEach(function(s){s.destroy.call(r)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null},n._plugins=[],n})();extensions.handleByList(ExtensionType.Application,Application._plugins);extensions.add(ResizePlugin);var extendStatics$1=function(n,e){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics$1(n,e)};function __extends$1(n,e){extendStatics$1(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var PlaneGeometry=(function(n){__extends$1(e,n);function e(t,r,o,s){t===void 0&&(t=100),r===void 0&&(r=100),o===void 0&&(o=10),s===void 0&&(s=10);var a=n.call(this)||this;return a.segWidth=o,a.segHeight=s,a.width=t,a.height=r,a.build(),a}return e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,r=[],o=[],s=[],a=this.segWidth-1,u=this.segHeight-1,h=this.width/a,l=this.height/u,c=0;c<t;c++){var _=c%this.segWidth,d=c/this.segWidth|0;r.push(_*h,d*l),o.push(_/a,d/u)}for(var y=a*u,c=0;c<y;c++){var m=c%a,g=c/a|0,v=g*this.segWidth+m,T=g*this.segWidth+m+1,A=(g+1)*this.segWidth+m,O=(g+1)*this.segWidth+m+1;s.push(v,T,A,T,O,A)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(o),this.indexBuffer.data=new Uint16Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e})(MeshGeometry),RopeGeometry=(function(n){__extends$1(e,n);function e(t,r,o){t===void 0&&(t=200),o===void 0&&(o=0);var s=n.call(this,new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6))||this;return s.points=r,s._width=t,s.textureScale=o,s.build(),s}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var r=this.getBuffer("aVertexPosition"),o=this.getBuffer("aTextureCoord"),s=this.getIndex();if(!(t.length<1)){r.data.length/4!==t.length&&(r.data=new Float32Array(t.length*4),o.data=new Float32Array(t.length*4),s.data=new Uint16Array((t.length-1)*6));var a=o.data,u=s.data;a[0]=0,a[1]=0,a[2]=0,a[3]=1;for(var h=0,l=t[0],c=this._width*this.textureScale,_=t.length,d=0;d<_;d++){var y=d*4;if(this.textureScale>0){var m=l.x-t[d].x,g=l.y-t[d].y,v=Math.sqrt(m*m+g*g);l=t[d],h+=v/c}else h=d/(_-1);a[y]=h,a[y+1]=0,a[y+2]=h,a[y+3]=1}for(var T=0,d=0;d<_-1;d++){var y=d*2;u[T++]=y,u[T++]=y+1,u[T++]=y+2,u[T++]=y+2,u[T++]=y+1,u[T++]=y+3}o.update(),s.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var r=t[0],o,s=0,a=0,u=this.buffers[0].data,h=t.length,l=0;l<h;l++){var c=t[l],_=l*4;l<t.length-1?o=t[l+1]:o=c,a=-(o.x-r.x),s=o.y-r.y;var d=Math.sqrt(s*s+a*a),y=this.textureScale>0?this.textureScale*this._width/2:this._width/2;s/=d,a/=d,s*=y,a*=y,u[_]=c.x+s,u[_+1]=c.y+a,u[_+2]=c.x-s,u[_+3]=c.y-a,r=c}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e})(MeshGeometry);(function(n){__extends$1(e,n);function e(t,r,o){o===void 0&&(o=0);var s=this,a=new RopeGeometry(t.height,r,o),u=new MeshMaterial(t);return o>0&&(t.baseTexture.wrapMode=WRAP_MODES.REPEAT),s=n.call(this,a,u)||this,s.autoUpdate=!0,s}return e.prototype._render=function(t){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),n.prototype._render.call(this,t)},e})(Mesh);var SimplePlane=(function(n){__extends$1(e,n);function e(t,r,o){var s=this,a=new PlaneGeometry(t.width,t.height,r,o),u=new MeshMaterial(Texture.WHITE);return s=n.call(this,a,u)||this,s.texture=t,s.autoResize=!0,s}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry,r=this.shader.texture,o=r.width,s=r.height;this.autoResize&&(t.width!==o||t.height!==s)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),n.prototype._render.call(this,t)},e.prototype.destroy=function(t){this.shader.texture.off("update",this.textureUpdated,this),n.prototype.destroy.call(this,t)},e})(Mesh);(function(n){__extends$1(e,n);function e(t,r,o,s,a){t===void 0&&(t=Texture.EMPTY);var u=this,h=new MeshGeometry(r,o,s);h.getBuffer("aVertexPosition").static=!1;var l=new MeshMaterial(t);return u=n.call(this,h,l,null,a)||this,u.autoUpdate=!0,u}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),n.prototype._render.call(this,t)},e})(Mesh);var DEFAULT_BORDER_SIZE=10;(function(n){__extends$1(e,n);function e(t,r,o,s,a){r===void 0&&(r=DEFAULT_BORDER_SIZE),o===void 0&&(o=DEFAULT_BORDER_SIZE),s===void 0&&(s=DEFAULT_BORDER_SIZE),a===void 0&&(a=DEFAULT_BORDER_SIZE);var u=n.call(this,Texture.WHITE,4,4)||this;return u._origWidth=t.orig.width,u._origHeight=t.orig.height,u._width=u._origWidth,u._height=u._origHeight,u._leftWidth=r,u._rightWidth=s,u._topHeight=o,u._bottomHeight=a,u.texture=t,u}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,r=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*r,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*r,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,r=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*r,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*r,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,r=this._width>t?1:this._width/t,o=this._topHeight+this._bottomHeight,s=this._height>o?1:this._height/o,a=Math.min(r,s);return a},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,r=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var o=1/this._origWidth,s=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=o*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-o*this._rightWidth,r[9]=r[11]=r[13]=r[15]=s*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-s*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e})(SimplePlane);var extendStatics=function(n,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},extendStatics(n,e)};function __extends(n,e){extendStatics(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var AnimatedSprite=(function(n){__extends(e,n);function e(t,r){r===void 0&&(r=!0);var o=n.call(this,t[0]instanceof Texture?t[0]:t[0].texture)||this;return o._textures=null,o._durations=null,o._autoUpdate=r,o._isConnectedToTicker=!1,o.animationSpeed=1,o.loop=!0,o.updateAnchor=!1,o.onComplete=null,o.onFrameChange=null,o.onLoop=null,o._currentTime=0,o._playing=!1,o._previousFrame=null,o.textures=t,o}return e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var r=this.animationSpeed*t,o=this.currentFrame;if(this._durations!==null){var s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];var a=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o?this.onLoop():this.animationSpeed<0&&this.currentFrame>o&&this.onLoop()),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(t){this.stop(),n.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var r=[],o=0;o<t.length;++o)r.push(Texture.from(t[o]));return new e(r)},e.fromImages=function(t){for(var r=[],o=0;o<t.length;++o)r.push(Texture.from(t[o]));return new e(r)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<t.length;r++)this._textures.push(t[r].texture),this._durations.push(t[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e})(Sprite);extensions.add(AccessibilityManager,Extract,InteractionManager,ParticleRenderer,Prepare,BatchRenderer,TilingSpriteRenderer,BitmapFontLoader,CompressedTextureLoader,DDSLoader,KTXLoader,SpritesheetLoader,TickerPlugin,AppLoaderPlugin);var filters={BlurFilter:BlurFilter$1,ColorMatrixFilter:ColorMatrixFilter$1,NoiseFilter:NoiseFilter$1};class EventListenerCtn{#t=[];add(e,t,r,o={}){if(e instanceof i){e.on(t,r,o),this.#t.push(()=>e.off(t,r,o));return}e.addEventListener(t,r,o),this.#t.push(()=>e.removeEventListener(t,r,{capture:o.capture??!1}))}clear(){for(const e of this.#t)e();this.#t=[]}get isEmpty(){return this.#t.length===0}}var SEARCH_PATH_ARG_EXT=(n=>(n.DEFAULT="",n.SP_GSM="png|jpg|jpeg|json|svg|webp|mp4|webm",n.SCRIPT="sn|ssn",n.FONT="woff2|woff|otf|ttf",n.SOUND="mp3|m4a|ogg|aac|flac|wav",n.HTML="htm|html",n.CSS="css",n.SN="sn",n.TST_PNGPNG_="png|png_",n.TST_HH="hh",n.TST_EEE="eee",n.TST_GGG="ggg",n.TST_PNGXML="png|xml",n))(SEARCH_PATH_ARG_EXT||{});function creCFG(){return{save_ns:"",window:{width:300,height:300},book:{title:"",creator:"",cre_url:"",publisher:"",pub_url:"",detail:"",version:"1.0"},log:{max_len:64},init:{bg_color:"#000000",tagch_msecwait:10,auto_msecpagewait:3500,escape:""},debug:{devtool:!1,dumpHtm:!1,token:!1,tag:!1,putCh:!1,debugLog:!1,baseTx:!1,masume:!1,variable:!1},code:{},debuger_token:""}}class ConfigBase{constructor(e){this.sys=e}oCfg=creCFG();userFnTail="";hPathFn2Exts={};async load(e){this.oCfg.save_ns=e.save_ns??this.oCfg.save_ns,e.window??={width:300,height:300},this.oCfg.window.width=e.window.width,this.oCfg.window.height=e.window.height,this.oCfg.book={...this.oCfg.book,...e.book},this.oCfg.log.max_len=e.log?.max_len??this.oCfg.log.max_len,this.oCfg.init={...this.oCfg.init,...e.init},this.oCfg.debug={...this.oCfg.debug,...e.debug},this.oCfg.debuger_token=e.debuger_token;const t=this.sys.arg.cur+"path.json",r=await this.sys.fetch(t);if(!r.ok)throw Error(r.statusText);const o=await r.text(),s=JSON.parse(await this.sys.dec(t,o));for(const[a,u]of Object.entries(s)){const h=this.hPathFn2Exts[a]=u;for(const[l,c]of Object.entries(h))l!==":cnt"&&(h[l]=this.sys.arg.cur+c)}if(this.#t=this.matchPath("^breakline$","png|jpg|jpeg|json|svg|webp|mp4|webm").length>0,this.#e=this.matchPath("^breakpage$","png|jpg|jpeg|json|svg|webp|mp4|webm").length>0,this.sys.arg.crypto)for(const[a,u]of Object.entries(this.hPathFn2Exts))for(const[h,l]of Object.entries(u)){if(!h.startsWith(":")||!h.endsWith(":id"))continue;const c=l.slice(l.lastIndexOf("/")+1),_=u[h.slice(0,-10)]??"",d=await(await this.sys.fetch(_)).text(),y=this.sys.hash(d);if(c!==y)throw`ファイル改竄エラーです fn:${_}`}}#t=!1;get existsBreakline(){return this.#t}#e=!1;get existsBreakpage(){return this.#e}get headNs(){return`skynovel.${this.oCfg.save_ns} - `}#i=/([^/\s]+)\.([^\d]\w+)/;searchPath(e,t=""){if(!e)throw"[searchPath] fnが空です";if(e.startsWith("http://"))return e;const r=e.match(this.#i);let o=r?r[1]??"":e;const s=r?r[2]:"";if(this.userFnTail){const h=o+"@@"+this.userFnTail;if(h in this.hPathFn2Exts){if(t==="")o=h;else for(const l of Object.keys(this.hPathFn2Exts[h]??{}))if(`|${t}|`.includes(`|${l}|`)){o=h;break}}}const a=this.hPathFn2Exts[o];if(!a)throw`サーチパスに存在しないファイル【${e}】です`;if(!s){const h=int(a[":cnt"]);if(t===""){if(h>1)throw`指定ファイル【${e}】が複数マッチします。サーチ対象拡張子群【${t}】で絞り込むか、ファイル名を個別にして下さい。`;return e}const l=`|${t}|`;if(h>1){let c=0;for(const _ of Object.keys(a))if(l.includes(`|${_}|`)&&++c>1)throw`指定ファイル【${e}】が複数マッチします。サーチ対象拡張子群【${t}】で絞り込むか、ファイル名を個別にして下さい。`}for(const[c,_]of Object.entries(a))if(l.includes(`|${c}|`))return _;throw`サーチ対象拡張子群【${t}】にマッチするファイルがサーチパスに存在しません。探索ファイル名=【${e}】`}if(t!==""&&!`|${t}|`.includes(`|${s}|`))throw`指定ファイルの拡張子【${s}】は、サーチ対象拡張子群【${t}】にマッチしません。探索ファイル名=【${e}】`;const u=a[s];if(!u)throw`サーチパスに存在しない拡張子【${s}】です。探索ファイル名=【${e}】、サーチ対象拡張子群【${t}】`;return u}matchPath(e,t=""){const r=[],o=new RegExp(e),s=new RegExp(t);for(const[a,u]of Object.entries(this.hPathFn2Exts)){if(a.search(o)===-1)continue;if(t===""){r.push(u);continue}const h={};let l=!1;for(const c of Object.keys(u))c.search(s)!==-1&&(h[c]=a,l=!0);l&&r.push(h)}return r}addPath(e,t){const r={};for(const[o,s]of Object.entries(t))r[o]=(o.startsWith(":")?"":this.sys.arg.cur)+String(s);this.hPathFn2Exts[e]=r}}const PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(n=>{PACKET_TYPES_REVERSE[PACKET_TYPES[n]]=n});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,encodePacket=({type:n,data:e},t,r)=>withNativeBlob$1&&e instanceof Blob?t?r(e):encodeBlobAsBase64(e,r):withNativeArrayBuffer$2&&(e instanceof ArrayBuffer||isView$1(e))?t?r(e):encodeBlobAsBase64(new Blob([e]),r):r(PACKET_TYPES[n]+(e||"")),encodeBlobAsBase64=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function toArray(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(n,e){if(withNativeBlob$1&&n.data instanceof Blob)return n.data.arrayBuffer().then(toArray).then(e);if(withNativeArrayBuffer$2&&(n.data instanceof ArrayBuffer||isView$1(n.data)))return e(toArray(n.data));encodePacket(n,!1,t=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),e(TEXT_ENCODER.encode(t))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<chars.length;n++)lookup$1[chars.charCodeAt(n)]=n;const decode$1=n=>{let e=n.length*.75,t=n.length,r,o=0,s,a,u,h;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),c=new Uint8Array(l);for(r=0;r<t;r+=4)s=lookup$1[n.charCodeAt(r)],a=lookup$1[n.charCodeAt(r+1)],u=lookup$1[n.charCodeAt(r+2)],h=lookup$1[n.charCodeAt(r+3)],c[o++]=s<<2|a>>4,c[o++]=(a&15)<<4|u>>2,c[o++]=(u&3)<<6|h&63;return l},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(n,e)=>{if(typeof n!="string")return{type:"message",data:mapBinary(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:decodeBase64Packet(n.substring(1),e)}:PACKET_TYPES_REVERSE[t]?n.length>1?{type:PACKET_TYPES_REVERSE[t],data:n.substring(1)}:{type:PACKET_TYPES_REVERSE[t]}:ERROR_PACKET},decodeBase64Packet=(n,e)=>{if(withNativeArrayBuffer$1){const t=decode$1(n);return mapBinary(t,e)}else return{base64:!0,data:n}},mapBinary=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},SEPARATOR="",encodePayload=(n,e)=>{const t=n.length,r=new Array(t);let o=0;n.forEach((s,a)=>{encodePacket(s,!1,u=>{r[a]=u,++o===t&&e(r.join(SEPARATOR))})})},decodePayload=(n,e)=>{const t=n.split(SEPARATOR),r=[];for(let o=0;o<t.length;o++){const s=decodePacket(t[o],e);if(r.push(s),s.type==="error")break}return r};function createPacketEncoderStream(){return new TransformStream({transform(n,e){encodePacketToBinary(n,t=>{const r=t.length;let o;if(r<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,r);else if(r<65536){o=new Uint8Array(3);const s=new DataView(o.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{o=new Uint8Array(9);const s=new DataView(o.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(o[0]|=128),e.enqueue(o),e.enqueue(t)})}})}let TEXT_DECODER;function totalLength(n){return n.reduce((e,t)=>e+t.length,0)}function concatChunks(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let o=0;o<e;o++)t[o]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function createPacketDecoderStream(n,e){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const t=[];let r=0,o=-1,s=!1;return new TransformStream({transform(a,u){for(t.push(a);;){if(r===0){if(totalLength(t)<1)break;const h=concatChunks(t,1);s=(h[0]&128)===128,o=h[0]&127,o<126?r=3:o===126?r=1:r=2}else if(r===1){if(totalLength(t)<2)break;const h=concatChunks(t,2);o=new DataView(h.buffer,h.byteOffset,h.length).getUint16(0),r=3}else if(r===2){if(totalLength(t)<8)break;const h=concatChunks(t,8),l=new DataView(h.buffer,h.byteOffset,h.length),c=l.getUint32(0);if(c>Math.pow(2,21)-1){u.enqueue(ERROR_PACKET);break}o=c*Math.pow(2,32)+l.getUint32(4),r=3}else{if(totalLength(t)<o)break;const h=concatChunks(t,o);u.enqueue(decodePacket(s?h:TEXT_DECODER.decode(h),e)),r=0}if(o===0||o>n){u.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(n){if(n)return mixin(n)}function mixin(n){for(var e in Emitter.prototype)n[e]=Emitter.prototype[e];return n}Emitter.prototype.on=Emitter.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};Emitter.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,o=0;o<t.length;o++)if(r=t[o],r===e||r.fn===e){t.splice(o,1);break}return t.length===0&&delete this._callbacks["$"+n],this};Emitter.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,o=t.length;r<o;++r)t[r].apply(this,e)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};Emitter.prototype.hasListeners=function(n){return!!this.listeners(n).length};const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0),globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),defaultBinaryType="arraybuffer";function pick(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(n,e){e.useNativeTimers?(n.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),n.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(n.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),n.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(n){return typeof n=="string"?utf8Length(n):Math.ceil((n.byteLength||n.size)*BASE64_OVERHEAD)}function utf8Length(n){let e=0,t=0;for(let r=0,o=n.length;r<o;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function randomString(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function encode(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function decode(n){let e={},t=n.split("&");for(let r=0,o=t.length;r<o;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class TransportError extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Transport extends Emitter{constructor(e){super(),this.writable=!1,installTimerFunctions(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new TransportError(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=encode(e);return t.length?"?"+t:""}}class Polling extends Transport{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};decodePayload(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,encodePayload(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=randomString()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const hasCORS=value;function empty(){}class BaseXHR extends Polling{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(o,s)=>{this.onError("xhr post error",o,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Request extends Emitter{constructor(e,t,r){super(),this.createRequest=e,installTimerFunctions(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=pick(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var o;r.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=Request.requestsCount++,Request.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=empty,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Request.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Request.requestsCount=0;Request.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const n="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(n,unloadHandler,!1)}}function unloadHandler(){for(let n in Request.requests)Request.requests.hasOwnProperty(n)&&Request.requests[n].abort()}const hasXHR2=(function(){const n=newRequest({xdomain:!1});return n&&n.responseType!==null})();class XHR extends BaseXHR{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=hasXHR2&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Request(newRequest,this.uri(),e)}}function newRequest(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||hasCORS))return new XMLHttpRequest}catch{}if(!e)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class BaseWS extends Transport{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],o=t===e.length-1;encodePacket(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}o&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=randomString()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const WebSocketCtor=globalThisShim.WebSocket||globalThisShim.MozWebSocket;class WS extends BaseWS{createSocket(e,t,r){return isReactNative?new WebSocketCtor(e,t,r):t?new WebSocketCtor(e,t):new WebSocketCtor(e)}doWrite(e,t){this.ws.send(t)}}class WT extends Transport{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),o=createPacketEncoderStream();o.readable.pipeTo(e.writable),this._writer=o.writable.getWriter();const s=()=>{r.read().then(({done:u,value:h})=>{u||(this.onPacket(h),s())}).catch(u=>{})};s();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],o=t===e.length-1;this._writer.write(r).then(()=>{o&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const transports={websocket:WS,webtransport:WT,polling:XHR},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let o=re.exec(n||""),s={},a=14;for(;a--;)s[parts[a]]=o[a]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=pathNames(s,s.path),s.queryKey=queryKey(s,s.query),s}function pathNames(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function queryKey(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,o,s){o&&(t[o]=s)}),t}const withEventListeners=typeof addEventListener=="function"&&typeof removeEventListener=="function",OFFLINE_EVENT_LISTENERS=[];withEventListeners&&addEventListener("offline",()=>{OFFLINE_EVENT_LISTENERS.forEach(n=>n())},!1);class SocketWithoutUpgrade extends Emitter{constructor(e,t){if(super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=parse(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=parse(t.host).host);installTimerFunctions(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const o=r.prototype.name;this.transports.push(o),this._transportsByName[o]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode(this.opts.query)),withEventListeners&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=protocol$1,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&SocketWithoutUpgrade.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",SocketWithoutUpgrade.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=byteLength(r)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,nextTick(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,o){if(typeof t=="function"&&(o=t,t=void 0),typeof r=="function"&&(o=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),o&&this.once("flush",o),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(SocketWithoutUpgrade.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),withEventListeners&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);r!==-1&&OFFLINE_EVENT_LISTENERS.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}SocketWithoutUpgrade.protocol=protocol$1;class SocketWithUpgrade extends SocketWithoutUpgrade{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;SocketWithoutUpgrade.priorWebsocketSuccess=!1;const o=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",_=>{if(!r)if(_.type==="pong"&&_.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;SocketWithoutUpgrade.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function s(){r||(r=!0,c(),t.close(),t=null)}const a=_=>{const d=new Error("probe error: "+_);d.transport=t.name,s(),this.emitReserved("upgradeError",d)};function u(){a("transport closed")}function h(){a("socket closed")}function l(_){t&&_.name!==t.name&&s()}const c=()=>{t.removeListener("open",o),t.removeListener("error",a),t.removeListener("close",u),this.off("close",h),this.off("upgrading",l)};t.once("open",o),t.once("error",a),t.once("close",u),this.once("close",h),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let Socket$1=class extends SocketWithUpgrade{constructor(n,e={}){const t=typeof n=="object"?n:e;(!t.transports||t.transports&&typeof t.transports[0]=="string")&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(r=>transports[r]).filter(r=>!!r)),super(n,t)}};function url(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=parse(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+e,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString.call(File)==="[object FileConstructor]";function isBinary(n){return withNativeArrayBuffer&&(n instanceof ArrayBuffer||isView(n))||withNativeBlob&&n instanceof Blob||withNativeFile&&n instanceof File}function hasBinary(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(hasBinary(n[t]))return!0;return!1}if(isBinary(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return hasBinary(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&hasBinary(n[t]))return!0;return!1}function deconstructPacket(n){const e=[],t=n.data,r=n;return r.data=_deconstructPacket(t,e),r.attachments=e.length,{packet:r,buffers:e}}function _deconstructPacket(n,e){if(!n)return n;if(isBinary(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=_deconstructPacket(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=_deconstructPacket(n[r],e));return t}return n}function reconstructPacket(n,e){return n.data=_reconstructPacket(n.data,e),delete n.attachments,n}function _reconstructPacket(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=_reconstructPacket(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=_reconstructPacket(n[t],e));return n}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));class Encoder{constructor(e){this.replacer=e}encode(e){return(e.type===PacketType.EVENT||e.type===PacketType.ACK)&&hasBinary(e)?this.encodeAsBinary({type:e.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===PacketType.BINARY_EVENT||e.type===PacketType.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=deconstructPacket(e),r=this.encodeAsString(t.packet),o=t.buffers;return o.unshift(r),o}}function isObject(n){return Object.prototype.toString.call(n)==="[object Object]"}class Decoder extends Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===PacketType.BINARY_EVENT;r||t.type===PacketType.BINARY_ACK?(t.type=r?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(isBinary(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(PacketType[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===PacketType.BINARY_EVENT||r.type===PacketType.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const a=e.substring(s,t);if(a!=Number(a)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(a)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const o=e.charAt(t+1);if(o!==""&&Number(o)==o){const s=t+1;for(;++t;){const a=e.charAt(t);if(a==null||Number(a)!=a){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Decoder.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case PacketType.CONNECT:return isObject(t);case PacketType.DISCONNECT:return t===void 0;case PacketType.CONNECT_ERROR:return typeof t=="string"||isObject(t);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&RESERVED_EVENTS$1.indexOf(t[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder,Encoder,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[on(e,"open",this.onopen.bind(this)),on(e,"packet",this.onpacket.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,o,s;if(RESERVED_EVENTS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const a={type:PacketType.EVENT,data:t};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const l=this.ids++,c=t.pop();this._registerAckCallback(l,c),a.id=l}const u=(o=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||o===void 0?void 0:o.writable,h=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!u||(h?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(e,t){var r;const o=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(o===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let u=0;u<this.sendBuffer.length;u++)this.sendBuffer[u].id===e&&this.sendBuffer.splice(u,1);t.call(this,new Error("operation has timed out"))},o),a=(...u)=>{this.io.clearTimeoutFn(s),t.apply(this,u)};a.withError=!0,this.acks[e]=a}emitWithAck(e,...t){return new Promise((r,o)=>{const s=(a,u)=>a?o(a):r(u);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((o,...s)=>r!==this._queue[0]?void 0:(o!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(o)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(e);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(e);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...o){r||(r=!0,t.packet({type:PacketType.ACK,id:e,data:o}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Backoff(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(n){this.ms=n};Backoff.prototype.setMax=function(n){this.max=n};Backoff.prototype.setJitter=function(n){this.jitter=n};class Manager extends Emitter{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,installTimerFunctions(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const o=t.parser||parser;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const o=on(t,"open",function(){r.onopen(),e&&e()}),s=u=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",u),e?e(u):this.maybeReconnectOnOpen()},a=on(t,"error",s);if(this._timeout!==!1){const u=this._timeout,h=this.setTimeoutFn(()=>{o(),s(new Error("timeout")),t.close()},u);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}return this.subs.push(o),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(on(e,"ping",this.onping.bind(this)),on(e,"data",this.ondata.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){nextTick(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Socket(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(o=>{o?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",o)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const cache={};function lookup(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=url(n,e.path||"/socket.io"),r=t.source,o=t.id,s=t.path,a=cache[o]&&s in cache[o].nsps,u=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let h;return u?h=new Manager(r,e):(cache[o]||(cache[o]=new Manager(r,e)),h=cache[o]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});class SysBase{constructor(e={},t){this.hPlg=e,this.arg=t}elc=new EventListenerCtn;hFactoryCls={};destroy(){this.elc.clear()}async loaded(...[e]){const t=e.snsys_pre;return delete e.snsys_pre,t?.init({getInfo:this.#i,addTag:()=>{},addLayCls:()=>{},searchPath:()=>"",getVal:()=>({}),resume:()=>{},render:()=>{},setDec:r=>{this.dec=r},setDecAB:r=>{this.#g=r},setEnc:r=>{this.enc=r},getStK:r=>{this.stk=r},getHash:r=>{this.hash=r}})}main=void 0;cfg;setMain(e,t){this.main=e,this.cfg=t}async run(){const[{Main:e},{TxtLayer:t},{GrpLayer:r}]=await Promise.all([__vitePreload(()=>import("./Main.js"),__vite__mapDeps([2,1,3])).then(o=>o.M),__vitePreload(()=>import("./TxtLayer.js"),__vite__mapDeps([4,5,6,7,3,8,9,1])).then(o=>o.b),__vitePreload(()=>import("./GrpLayer.js"),__vite__mapDeps([10,7,3,6,1])).then(o=>o.a)]);this.hFactoryCls={grp:()=>new r,txt:()=>new t},this.run=async()=>{this.main?.destroy(),this.main=await e.generate(this)},await this.run()}stop(){this.main?.destroy(),this.main=void 0}fetch=(e,t)=>fetch(e,t);data={sys:creSYS_DATA(),mark:{},kidoku:{}};async initVal(e,t){}flush(){if(this.#t){this.#e=!0;return}this.flushSub(),this.#t=setTimeout(()=>{this.#t=void 0,this.#e&&(this.#e=!1,this.flush())},500)}#t=void 0;#e=!1;flushSub(){}val;init(e,t,r){const o=[];this.val=r;let s="";return o.push(r.init().then(()=>{s="sys",s+=String(r.getVal("sys:TextLayer.Back.Alpha",1)),s="kidoku",r.saveKidoku()}).catch(a=>console.error(`セーブデータ（${s}）が壊れています。一度クリアする必要があります(b) %o`,a))),e.close=a=>this.close(a),e.export=a=>this._export(a),e.import=a=>this._import(a),e.navigate_to=a=>this.navigate_to(a),e.title=a=>this.title(a),e.toggle_full_screen=a=>this.#v(a),e.update_check=a=>this.update_check(a),e.window=a=>this.window(a),e.title({text:this.cfg.oCfg.book.title||"SKYNovel"}),r.defTmp("const.sn.isApp",()=>this.isApp),r.defTmp("const.sn.isDbg",()=>CmnLib.isDbg),r.defTmp("const.sn.isPackaged",()=>CmnLib.isPackaged),r.defTmp("const.sn.needClick2Play",()=>CmnLib.needClick2Play()),r.defTmp("const.sn.displayState",()=>this.isFullScr),r.setVal_Nochk("sys","const.sn.cfg.ns",this.cfg.oCfg.save_ns),r.flush(),CmnLib.isDbg&&this.attach_debug(this.main),[...o,...Object.values(this.hPlg).map(a=>a.init({getInfo:this.#i,addTag:(u,h)=>{if(u in e)throw`すでに定義済みのタグ[${u}]です`;e[u]=h},addLayCls:(u,h)=>{if(u in this.hFactoryCls)throw`すでに定義済みのレイヤcls【${u}】です`;this.hFactoryCls[u]=h},searchPath:(u,h=SEARCH_PATH_ARG_EXT.DEFAULT)=>this.cfg.searchPath(u,h),getVal:(u,h)=>r.getVal(u,h),resume:()=>this.main?.resume(),render:(u,h,l=!1)=>t.renderer.render(u,{renderTexture:h,clear:l}),setDec:()=>{},setDecAB:()=>{},setEnc:()=>{},getStK:()=>{},getHash:()=>{}}))]}#i=()=>({window:{width:CmnLib.stageW,height:CmnLib.stageH}});#r=0;#n=0;#o=1;#h=0;#l=0;#s=0;#a=0;get cvsWidth(){return this.#r}get cvsHeight(){return this.#n}get cvsScale(){return this.#o}get ofsLeft4elm(){return this.#h}get ofsTop4elm(){return this.#l}get ofsPadLeft_Dom2PIXI(){return this.#s}get ofsPadTop_Dom2PIXI(){return this.#a}isFullScr=!1;cvsResize(){if(!this.main)return;let e=globalThis.innerWidth,t=globalThis.innerHeight;const r=this.main.cvs,o=r.parentElement!==document.body;if(o){const h=globalThis.getComputedStyle(r);e=parseFloat(h.width),t=parseFloat(h.height)}if(CmnLib.isMobile){const h=screen.orientation.angle%180===0;(h&&e>t||!h&&e<t)&&([e,t]=[t,e])}const s=r.getBoundingClientRect();if(argChk_Boolean(CmnLib.hDip,"expanding",!0)||o||CmnLib.stageW>e||CmnLib.stageH>t)if(CmnLib.stageW/CmnLib.stageH<=e/t?(this.#n=t,this.#r=CmnLib.stageW/CmnLib.stageH*t):(this.#r=e,this.#n=CmnLib.stageH/CmnLib.stageW*e),this.#o=this.#r/CmnLib.stageW,o)this.#s=0,this.#a=0;else{const h=1-this.#o;CmnLib.isMobile?(this.#s=(e-this.#r)/2*h,this.#a=(t-this.#n)/2*h):(this.#s=s.left*h,this.#a=s.top*h)}else this.#r=CmnLib.stageW,this.#n=CmnLib.stageH,this.#o=1,this.#s=0,this.#a=0;const a=r.parentElement.style;o||(a.position="relative",a.width=`${String(this.#r)}px`,a.height=`${String(this.#n)}px`);const u=r.style;u.width=a.width,u.height=a.height,o?(this.#h=s.left,this.#l=s.top):(this.#h=0,this.#l=0),this.isFullScr&&(this.#h+=(e-this.#r)/2,this.#l+=(t-this.#n)/2)}use4ViteElectron(e,t,r,o){return!1}attach_debug(e){this.attach_debug=()=>{};const t=document.createElement("style");t.innerHTML=`/* SKYNovel Dbg */
.sn_BounceInOut { animation: sn_kfBounceInOut linear 1.5s; }
@keyframes sn_kfBounceInOut{
0%	{opacity: 0;	transform: scaleX(0.30) scaleY(0.30);}
10%	{opacity: 1;	transform: scaleX(1.10) scaleY(1.10);}
20%	{				transform: scaleX(0.95) scaleY(0.95);}
30%	{				transform: scaleX(1.00) scaleY(1.00);}
70%	{opacity: 1;}
100%{opacity: 0;}
}
.sn_BounceIn { animation: sn_kfBounceIn linear 0.3s; }
@keyframes sn_kfBounceIn{
0%	{opacity: 0;	transform: scaleX(0.30) scaleY(0.30);}
50%	{opacity: 1;	transform: scaleX(1.10) scaleY(1.10);}
100%{				transform: scaleX(0.95) scaleY(0.95);}
}
.sn_HopIn { animation: sn_kfHopIn linear 0.8s; }
@keyframes sn_kfHopIn{
0%	{transform:	translate(0px,   0px);}
15% {transform:	translate(0px, -25px);}
30% {transform:	translate(0px,   0px);}
45% {transform:	translate(0px, -15px);}
60% {transform:	translate(0px,   0px);}
75% {transform:	translate(0px,  -5px);}
100%{transform:	translate(0px,   0px);}
}`,document.getElementsByTagName("head")[0].appendChild(t),this.addHook((r,o)=>this.#y[r]?.(o)),this.#u=lookup(`http://localhost:${String(this.extPort)}`),this.#u.on("data",(r,o)=>{this.callHook(r,o)}).on("disconnect",()=>e.setLoop(!0)),this.callHook=(r,o)=>{for(const s of this.#_)s(r,o)}}extPort=3776;end(){this.#u?.disconnect(),this.#u=void 0}#u=void 0;#y={auth:e=>{if(e.t!==this.cfg.oCfg.debuger_token){this.end();return}this.toast("接続")},continue:()=>this.toast("再生"),disconnect:()=>this.toast("切断"),restart:e=>{this.send2Dbg(e?.ri??"",{}),this.end(),this.run()},pause:()=>this.toast("一時停止"),stopOnEntry:()=>this.toast("一時停止"),stopOnDataBreakpoint:()=>this.toast("注意"),stopOnBreakpoint:()=>this.toast("注意"),stopOnStep:()=>this.toast("一歩進む"),stopOnStepIn:()=>this.toast("ステップイン"),stopOnStepOut:()=>this.toast("ステップアウト"),stopOnBackstep:()=>this.toast("一歩戻る"),_addPath:e=>this.cfg.addPath(e.fn,e.o)};toast(e){if(!this.main)return;const t=document.body;for(const a of[...Array.from(t.getElementsByClassName("sn_BounceIn")),...Array.from(t.getElementsByClassName("sn_HopIn"))])a.remove();const r=document.createElement("img"),o=SysBase.#m[e];if(!o)throw new Error(`toast 名ミス=${e}`);r.src=`data:image/svg+xml;base64,${o.dat}`;const s=Math.min(CmnLib.stageW,CmnLib.stageH)/4*this.#o;r.width=r.height=s,r.style.cssText=`position: absolute;
left: ${String((CmnLib.stageW-s)/2*this.#o+s*(o.dx??0))}px;
top: ${String((CmnLib.stageH-s)/2*this.#o+s*(o.dy??0))}px;`,r.classList.add("sn_toast",o.ease??"sn_BounceInOut"),o.ease||r.addEventListener("animationend",()=>t.removeChild(r),{once:!0,passive:!0}),t.insertBefore(r,this.main.cvs)}static#m={接続:{dx:-1,dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtNjQwIDMyMGMwIDE3Ni43My0xNDMuMjcgMzIwLTMyMCAzMjBzLTMyMC0xNDMuMjctMzIwLTMyMCAxNDMuMjctMzIwIDMyMC0zMjAgMzIwIDE0My4yNyAzMjAgMzIweiIvPjxwYXRoIGlkPSJiIiBkPSJtMCAyOTJ2NTUuODhoMTI3LjEzYzEyLjM3IDQ2IDU0LjEyIDc5Ljg3IDEwNCA3OS44N2g3Ny44N3YtMjE1LjYyYy00Ni43MyAwLTcyLjY4IDAtNzcuODggMC00OS43NCAwLTkxLjYyIDMzLjg3LTEwMy45OSA3OS44Ny0xNi45NSAwLTU5LjMzIDAtMTI3LjEzIDB6Ii8+PHBhdGggaWQ9ImMiIGQ9Im01MTIuODggMjkyYy0xMi4zOC00Ni01NC4xMy03OS44Ny0xMDQtNzkuODctNS4yMSAwLTMxLjIxIDAtNzggMHYyMTUuNzRoNzcuODdjNDkuODggMCA5MS43NS0zMy44NyAxMDQtNzkuODdoMTI3LjI1di01NmMtNzYuMjcgMC0xMTguNjUgMC0xMjcuMTIgMHoiLz48L2RlZnM+PHVzZSBmaWxsPSIjMmUyZTJlIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9IiMzYWFiZDIiIHhsaW5rOmhyZWY9IiNiIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYiIvPjx1c2UgZmlsbD0iIzNhYWJkMiIgeGxpbms6aHJlZj0iI2MiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNjIi8+PC9zdmc+"},切断:{dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtNjQwIDMyMGMwIDE3Ni43My0xNDMuMjcgMzIwLTMyMCAzMjBzLTMyMC0xNDMuMjctMzIwLTMyMCAxNDMuMjctMzIwIDMyMC0zMjAgMzIwIDE0My4yNyAzMjAgMzIweiIvPjxwYXRoIGlkPSJiIiBkPSJtMTkxLjUzIDIyMS4yNGMtNDUuNjggMC04NC4wMSAzMS4wNC05NS4zIDczLjE2LTYuNDEgMC0zOC40OSAwLTk2LjIzIDB2NTEuMjFoOTYuMjNjMTEuMyA0Mi4xMSA0OS42MyA3My4xNiA5NS4zIDczLjE2aDcxLjMzdi00OC4yNGg1My43OHYtMTAxLjA1aC01My43OHYtNDguMjRjLTQyLjggMC02Ni41NyAwLTcxLjMzIDB6Ii8+PHBhdGggaWQ9ImMiIGQ9Im00NDguNDcgMjIxLjIzYy00Ljc2IDAtMjguNTMgMC03MS4zMyAwdjE5Ny41M2g3MS4zM2M0NS42OCAwIDgzLjk5LTMxLjA0IDk1LjI5LTczLjE1aDk2LjI0di01MS4yMWgtOTYuMjRjLTMzLjA4LTQ4Ljc4LTY0Ljg0LTczLjE3LTk1LjI5LTczLjE3eiIvPjwvZGVmcz48dXNlIGZpbGw9IiMyZTJlMmUiIHhsaW5rOmhyZWY9IiNhIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0iI2RmNTY1NiIgeGxpbms6aHJlZj0iI2IiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNiIi8+PHVzZSBmaWxsPSIjZGY1NjU2IiB4bGluazpocmVmPSIjYyIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2MiLz48L3N2Zz4="},再生:{dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem0yNTguODMgMTExLjA1Yy0xLjI5Ljc5LTIuOTMuODMtNC4yNi4wNC0xLjI5LS43NC0yLjExLTIuMTItMi4xMS0zLjY3IDAtNy4xNiAwLTQyLjk3IDAtMTA3LjQzczAtMTAwLjI3IDAtMTA3LjQzYzAtMS41My44Mi0yLjkzIDIuMTEtMy42OCAxLjMzLS43NiAyLjk3LS43MiA0LjI2LjA0IDE4IDEwLjc1IDE2MiA5Ni43MSAxODAgMTA3LjQ2IDEuMjkuNzMgMi4wNSAyLjE0IDIuMDUgMy42MSAwIDEuNDktLjc2IDIuODgtMi4wNSAzLjYzLTM2IDIxLjQ5LTE2MiA5Ni42OS0xODAgMTA3LjQzeiIvPjwvZGVmcz48cGF0aCBkPSJtMTU0LjU3IDE3MC4xOWgzNDYuMTV2MzA3LjY5aC0zNDYuMTV6IiBmaWxsPSIjZmZmIi8+PHVzZSBmaWxsPSIjMmUyZTJlIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2EiLz48L3N2Zz4="},一時停止:{dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem0yMDAgMTAwdi0yMDBoODB2MjAwem0xNjAgMHYtMjAwaDgwdjIwMHoiLz48L2RlZnM+PHBhdGggZD0ibTE0Ny40OSAxODAuNDFoMzUyLjR2MjgyLjY5aC0zNTIuNHoiIGZpbGw9IiNmZmYiLz48dXNlIGZpbGw9IiMyZTJlMmUiIHhsaW5rOmhyZWY9IiNhIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYSIvPjwvc3ZnPg=="},注意:{ease:"sn_HopIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMzQzLjM0IDI5LjJjLTEwLjM3LTE3Ljk3LTM2LjMxLTE3Ljk3LTQ2LjY5IDAtMjkuMyA1MC43NS0yNjMuNyA0NTYuNzQtMjkzIDUwNy40OS0xMC4zNyAxNy45NyAyLjU5IDQwLjQ0IDIzLjM0IDQwLjQ0aDU4Ni4wMWMyMC43NSAwIDMzLjcyLTIyLjQ2IDIzLjM1LTQwLjQ0LTU4LjYtMTAxLjUtMjYzLjctNDU2Ljc0LTI5My4wMS01MDcuNDl6bS0yMy4zNCA0ODIuODNjLTE0LjUyIDAtMjYuMjktMi43MS0yNi4yOS02LjA2IDAtNC4yMSAwLTM3Ljg2IDAtNDIuMDcgMC0zLjM1IDExLjc3LTYuMDcgMjYuMjktNi4wN3MyNi4yOSAyLjcyIDI2LjI5IDYuMDd2NDIuMDdjLTcuODQgNC4wNC0xNi42MSA2LjA2LTI2LjI5IDYuMDZ6bTIxLjk5LTEwMy44NGMwIDUuNDMtOS44NSA5LjgzLTIxLjk5IDkuODMtMTIuMTUgMC0yMS45OS00LjQtMjEuOTktOS44MyAwLS4xMy4wNy0uMjUuMDgtLjM4LTEuMzctMTcuNTYtMTIuMy0xNTguMDYtMTMuNjctMTc1LjYyIDAtNS40MyAxNS45My05Ljg0IDM1LjU4LTkuODRzMzUuNTggNC40MSAzNS41OCA5Ljg0Yy0uOTEgMTEuNy01LjQ3IDcwLjI1LTEzLjY3IDE3NS42Mi4wNi4xNi4wOC4yOS4wOC4zOHoiLz48L2RlZnM+PHBhdGggZD0ibTI0MS4yOSAxOTEuNDRoMTQ1LjQ5djM1MS42NmgtMTQ1LjQ5eiIgZmlsbD0iI2ZmZiIvPjx1c2UgZmlsbD0iI2QyYmYzYSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNhIi8+PC9zdmc+"},一歩進む:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem0zNzYuOTMgOTEuOTdjMC01My41MSAwLTgzLjI0IDAtODkuMTktLjE1LjE0LS4yNS4zNC0uNDQuNDUtMTYuMTEgOS42Mi0xNDQuOTUgODYuNTQtMTYxLjA2IDk2LjE1LTEuMTUuNjktMi42Mi43My0zLjgxLjAyLTEuMTUtLjY0LTEuODktMS44OS0xLjg5LTMuMjggMC02LjQxIDAtMzguNDQgMC05Ni4xMSAwLTU3LjY5IDAtODkuNzQgMC05Ni4xNSAwLTEuMzUuNzQtMi42MiAxLjg5LTMuMjkgMS4xOS0uNjggMi42Ni0uNjQgMy44MS4wNCAxNi4xMSA5LjYyIDE0NC45NSA4Ni41NCAxNjEuMDYgOTYuMTYuMTkuMS4yOS4zMS40NC40NSAwLTYuMTMgMC0zNi43NyAwLTkxLjkyaDUzLjMydjE4Ni42N3oiLz48L2RlZnM+PHBhdGggZD0ibTE0Ny40OSAxNTQuMmgzNTIuNHYzMDguOWgtMzUyLjR6IiBmaWxsPSIjZmZmIi8+PHVzZSBmaWxsPSIjMmUyZTJlIiB4bGluazpocmVmPSIjYSIvPjx1c2UgZmlsbD0ibm9uZSIgeGxpbms6aHJlZj0iI2EiLz48L3N2Zz4="},一歩戻る:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjBjMCAxNzYuNzIgMTQzLjI4IDMyMCAzMjAgMzIwczMyMC0xNDMuMjggMzIwLTMyMC0xNDMuMjgtMzIwLTMyMC0zMjAtMzIwIDE0My4yOC0zMjAgMzIwem00MzAuMjcgOTYuMTRjMCAxLjM1LS43NCAyLjYyLTEuODkgMy4yOC0xLjE5LjY5LTIuNjYuNjUtMy44MS0uMDMtMTYuMTEtOS42Mi0xNDQuOTUtODYuNTQtMTYxLjA1LTk2LjE2LS4yLS4xLS4yOS0uMzEtLjQ1LS40NXY5MS45MmgtNTMuMzJ2LTE4Ni42N2g1My4zMnY4OS4xOWMuMTYtLjE0LjI1LS4zNC40NS0uNDUgMTYuMS05LjYyIDE0NC45NC04Ni41NCAxNjEuMDUtOTYuMTYgMS4xNS0uNjggMi42Mi0uNzIgMy44MS0uMDEgMS4xNS42NCAxLjg5IDEuODkgMS44OSAzLjI4djk2LjExeiIvPjwvZGVmcz48cGF0aCBkPSJtMTQ3LjQ5IDE1NC4yaDM1Mi40djMwOC45aC0zNTIuNHoiIGZpbGw9IiNmZmYiLz48dXNlIGZpbGw9IiMyZTJlMmUiIHhsaW5rOmhyZWY9IiNhIi8+PHVzZSBmaWxsPSJub25lIiB4bGluazpocmVmPSIjYSIvPjwvc3ZnPg=="},ステップイン:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMTkuOTljMCAxNzYuNzQgMTQzLjI3IDMyMC4wMSAzMjAuMDEgMzIwLjAxIDE3Ni43MiAwIDMxOS45OS0xNDMuMjcgMzE5Ljk5LTMyMC4wMSAwLTE3Ni43Mi0xNDMuMjctMzE5Ljk5LTMxOS45OS0zMTkuOTktMTc2Ljc0IDAtMzIwLjAxIDE0My4yNy0zMjAuMDEgMzE5Ljk5em0xNTMuMDUtMjkuNzIgNTUuMTItNTUuMTMgMTExLjg0IDExMS44MiAxMTEuODItMTExLjgyIDU1LjEyIDU1LjEyLTE2Ni45NCAxNjYuOTd6Ii8+PC9kZWZzPjxwYXRoIGQ9Im0xNDcuNDkgMTU0LjJoMzUyLjR2MzA4LjloLTM1Mi40eiIgZmlsbD0iI2ZmZiIvPjx1c2UgZmlsbD0iIzJlMmUyZSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNhIi8+PC9zdmc+"},ステップアウト:{ease:"sn_BounceIn",dat:"PHN2ZyBoZWlnaHQ9IjY0MCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDY0MCA2NDAiIHdpZHRoPSI2NDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJtMCAzMjAuMDFjMCAxNzYuNzIgMTQzLjI3IDMxOS45OSAzMTkuOTkgMzE5Ljk5IDE3Ni43NCAwIDMyMC4wMS0xNDMuMjcgMzIwLjAxLTMxOS45OSAwLTE3Ni43NC0xNDMuMjctMzIwLjAxLTMyMC4wMS0zMjAuMDEtMTc2LjcyIDAtMzE5Ljk5IDE0My4yNy0zMTkuOTkgMzIwLjAxem0zMTkuOTktMjYuOTgtMTExLjgyIDExMS44My01NS4xMi01NS4xMyAxNjYuOTQtMTY2Ljk2IDE2Ni45NiAxNjYuOTYtNTUuMTIgNTUuMTN6Ii8+PC9kZWZzPjxwYXRoIGQ9Im0xNDcuNDkgMTU0LjJoMzUyLjR2MzA4LjloLTM1Mi40eiIgZmlsbD0iI2ZmZiIvPjx1c2UgZmlsbD0iIzJlMmUyZSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIGZpbGw9Im5vbmUiIHhsaW5rOmhyZWY9IiNhIi8+PC9zdmc+"}};pathBaseCnvSnPath4Dbg="";fire;setFire(e){this.fire=e}#_=[];addHook(e){this.#_.push(e)}callHook=(e,t)=>{};send2Dbg=(e,t)=>{this.#u?.emit("data",e,t)};copyBMFolder=(e,t)=>{};eraseBMFolder=e=>{};close=()=>!1;_export=()=>!1;_import=()=>!1;navigate_to=()=>!1;title=e=>{const{text:t}=e;if(!t)throw"[title] textは必須です";return this.#f=t,this.titleSub(this.#f+this.#p),!1};#f="";titleSub(e){}#v=e=>{if(!e.key)return this.tglFlscr_sub().catch(r=>SysBase.tglFlscr_HdrErr(r)),!1;const t=e.key.toLowerCase();return this.elc.add(document,EVNM_KEY,r=>{SysBase.modKey(r)+r.key.toLowerCase()===t&&(r.stopPropagation(),this.tglFlscr_sub().catch(o=>SysBase.tglFlscr_HdrErr(o)))},{passive:!0}),!1};static tglFlscr_HdrErr(e){e instanceof TypeError&&console.error("フルスクリーン化でエラーです。ブラウザ環境でキー入力きっかけでないと発生します"),console.error(`fn:SysBase.ts tglFlscr ${String(e)}`)}static modKey(e){return(e.altKey?e.key==="Alt"?"":"alt+":"")+(e.ctrlKey?e.key==="Control"?"":"ctrl+":"")+(e.metaKey?e.key==="Meta"?"":"meta+":"")+(e.shiftKey?e.key==="Shift"?"":"shift+":"")}async tglFlscr_sub(){}update_check=()=>!1;window=()=>!1;#p="";setTitleInfo(e){this.#p=e,this.titleSub(this.#f+this.#p)}#g=()=>Promise.resolve({ext_num:0,ab:new ArrayBuffer(0)});dec=(e,t)=>Promise.resolve(t);async decAB(e){const{ext_num:t,ab:r}=await this.#g(e),o=this.#T[t];return o?.fnc?await o.fnc(r):r}#T={1:{ext:"jpeg",fnc:e=>this.#c(e,"image/jpeg")},2:{ext:"png",fnc:e=>this.#c(e,"image/png")},3:{ext:"svg",fnc:e=>this.#c(e,"image/svg+xml")},4:{ext:"webp",fnc:e=>this.#c(e,"image/webp")},20:{ext:"mp4",fnc:e=>this.#d(e,"video/mp4")},21:{ext:"webm",fnc:e=>this.#d(e,"video/webm")},22:{ext:"ogv",fnc:e=>this.#d(e,"video/ogv")}};#c=(e,t)=>new Promise((r,o)=>{const s=new Blob([e],{type:t}),a=new Image;a.onload=()=>r(a),a.onerror=u=>o(new Error(u instanceof Event?u.type:u)),a.src=URL.createObjectURL(s)});#d=(e,t)=>new Promise((r,o)=>{const s=new Blob([e],{type:t}),a=document.createElement("video");this.elc.add(a,"error",()=>o(new Error(a.error?.message??""))),this.elc.add(a,"canplay",()=>r(a)),a.src=URL.createObjectURL(s)});enc=async e=>e;stk=()=>"";hash=e=>"";isApp=!1;$path_downloads="";get path_downloads(){return this.$path_downloads}$path_userdata="";get path_userdata(){return this.$path_userdata}capturePage(e,t,r,o){}async savePic(e,t){}async ensureFile(e){}async appendFile(e,t){}async outputFile(e,t){}}var util,hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;var n=o(),e=s(),t=a(),r=typeof window<"u"?window:commonjsGlobal;util={assign:n,create:e,trim:t,bind:u,slice:h,each:l,map:c,pluck:_,isList:d,isFunction:y,isObject:m,Global:r};function o(){return Object.assign?Object.assign:function(g,v,T,A){for(var O=1;O<arguments.length;O++)l(Object(arguments[O]),function(w,E){g[E]=w});return g}}function s(){if(Object.create)return function(g,v,T,A){var O=h(arguments,1);return n.apply(this,[Object.create(g)].concat(O))};{let g=function(){};return function(v,T,A,O){var w=h(arguments,1);return g.prototype=v,n.apply(this,[new g].concat(w))}}}function a(){return String.prototype.trim?function(g){return String.prototype.trim.call(g)}:function(g){return g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function u(g,v){return function(){return v.apply(g,Array.prototype.slice.call(arguments,0))}}function h(g,v){return Array.prototype.slice.call(g,v||0)}function l(g,v){_(g,function(T,A){return v(T,A),!1})}function c(g,v){var T=d(g)?[]:{};return _(g,function(A,O){return T[O]=v(A,O),!1}),T}function _(g,v){if(d(g)){for(var T=0;T<g.length;T++)if(v(g[T],T))return g[T]}else for(var A in g)if(g.hasOwnProperty(A)&&v(g[A],A))return g[A]}function d(g){return g!=null&&typeof g!="function"&&typeof g.length=="number"}function y(g){return g&&{}.toString.call(g)==="[object Function]"}function m(g){return g&&{}.toString.call(g)==="[object Object]"}return util}var storeEngine,hasRequiredStoreEngine;function requireStoreEngine(){if(hasRequiredStoreEngine)return storeEngine;hasRequiredStoreEngine=1;var n=requireUtil(),e=n.slice,t=n.pluck,r=n.each,o=n.bind,s=n.create,a=n.isList,u=n.isFunction,h=n.isObject;storeEngine={createStore:_};var l={version:"2.0.12",enabled:!1,get:function(d,y){var m=this.storage.read(this._namespacePrefix+d);return this._deserialize(m,y)},set:function(d,y){return y===void 0?this.remove(d):(this.storage.write(this._namespacePrefix+d,this._serialize(y)),y)},remove:function(d){this.storage.remove(this._namespacePrefix+d)},each:function(d){var y=this;this.storage.each(function(m,g){d.call(y,y._deserialize(m),(g||"").replace(y._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(d){return this._namespacePrefix=="__storejs_"+d+"_"},createStore:function(){return _.apply(this,arguments)},addPlugin:function(d){this._addPlugin(d)},namespace:function(d){return _(this.storage,this.plugins,d)}};function c(){var d=typeof console>"u"?null:console;if(d){var y=d.warn?d.warn:d.log;y.apply(d,arguments)}}function _(d,y,m){m||(m=""),d&&!a(d)&&(d=[d]),y&&!a(y)&&(y=[y]);var g=m?"__storejs_"+m+"_":"",v=m?new RegExp("^"+g):null,T=/^[a-zA-Z0-9_\-]*$/;if(!T.test(m))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var A={_namespacePrefix:g,_namespaceRegexp:v,_testStorage:function(w){try{var E="__storejs__test__";w.write(E,E);var I=w.read(E)===E;return w.remove(E),I}catch{return!1}},_assignPluginFnProp:function(w,E){var I=this[E];this[E]=function(){var b=e(arguments,0),k=this;function N(){if(I)return r(arguments,function(X,H){b[H]=X}),I.apply(k,b)}var G=[N].concat(b);return w.apply(k,G)}},_serialize:function(w){return JSON.stringify(w)},_deserialize:function(w,E){if(!w)return E;var I="";try{I=JSON.parse(w)}catch{I=w}return I!==void 0?I:E},_addStorage:function(w){this.enabled||this._testStorage(w)&&(this.storage=w,this.enabled=!0)},_addPlugin:function(w){var E=this;if(a(w)){r(w,function(k){E._addPlugin(k)});return}var I=t(this.plugins,function(k){return w===k});if(!I){if(this.plugins.push(w),!u(w))throw new Error("Plugins must be function values that return objects");var b=w.call(this);if(!h(b))throw new Error("Plugins must return an object of function properties");r(b,function(k,N){if(!u(k))throw new Error("Bad plugin property: "+N+" from plugin "+w.name+". Plugins should only return functions.");E._assignPluginFnProp(k,N)})}},addStorage:function(w){c("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(w)}},O=s(A,l,{plugins:[]});return O.raw={},r(O,function(w,E){u(w)&&(O.raw[E]=o(O,w))}),r(d,function(w){O._addStorage(w)}),r(y,function(w){O._addPlugin(w)}),O}return storeEngine}var localStorage_1,hasRequiredLocalStorage;function requireLocalStorage(){if(hasRequiredLocalStorage)return localStorage_1;hasRequiredLocalStorage=1;var n=requireUtil(),e=n.Global;localStorage_1={name:"localStorage",read:r,write:o,each:s,remove:a,clearAll:u};function t(){return e.localStorage}function r(h){return t().getItem(h)}function o(h,l){return t().setItem(h,l)}function s(h){for(var l=t().length-1;l>=0;l--){var c=t().key(l);h(r(c),c)}}function a(h){return t().removeItem(h)}function u(){return t().clear()}return localStorage_1}var oldFFGlobalStorage,hasRequiredOldFFGlobalStorage;function requireOldFFGlobalStorage(){if(hasRequiredOldFFGlobalStorage)return oldFFGlobalStorage;hasRequiredOldFFGlobalStorage=1;var n=requireUtil(),e=n.Global;oldFFGlobalStorage={name:"oldFF-globalStorage",read:r,write:o,each:s,remove:a,clearAll:u};var t=e.globalStorage;function r(h){return t[h]}function o(h,l){t[h]=l}function s(h){for(var l=t.length-1;l>=0;l--){var c=t.key(l);h(t[c],c)}}function a(h){return t.removeItem(h)}function u(){s(function(h,l){delete t[h]})}return oldFFGlobalStorage}var oldIEUserDataStorage,hasRequiredOldIEUserDataStorage;function requireOldIEUserDataStorage(){if(hasRequiredOldIEUserDataStorage)return oldIEUserDataStorage;hasRequiredOldIEUserDataStorage=1;var n=requireUtil(),e=n.Global;oldIEUserDataStorage={name:"oldIE-userDataStorage",write:a,read:u,each:h,remove:l,clearAll:c};var t="storejs",r=e.document,o=y(),s=(e.navigator?e.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function a(m,g){if(!s){var v=d(m);o(function(T){T.setAttribute(v,g),T.save(t)})}}function u(m){if(!s){var g=d(m),v=null;return o(function(T){v=T.getAttribute(g)}),v}}function h(m){o(function(g){for(var v=g.XMLDocument.documentElement.attributes,T=v.length-1;T>=0;T--){var A=v[T];m(g.getAttribute(A.name),A.name)}})}function l(m){var g=d(m);o(function(v){v.removeAttribute(g),v.save(t)})}function c(){o(function(m){var g=m.XMLDocument.documentElement.attributes;m.load(t);for(var v=g.length-1;v>=0;v--)m.removeAttribute(g[v].name);m.save(t)})}var _=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function d(m){return m.replace(/^\d/,"___$&").replace(_,"___")}function y(){if(!r||!r.documentElement||!r.documentElement.addBehavior)return null;var m="script",g,v,T;try{v=new ActiveXObject("htmlfile"),v.open(),v.write("<"+m+">document.w=window</"+m+'><iframe src="/favicon.ico"></iframe>'),v.close(),g=v.w.frames[0].document,T=g.createElement("div")}catch{T=r.createElement("div"),g=r.body}return function(A){var O=[].slice.call(arguments,0);O.unshift(T),g.appendChild(T),T.addBehavior("#default#userData"),T.load(t),A.apply(this,O),g.removeChild(T)}}return oldIEUserDataStorage}var cookieStorage,hasRequiredCookieStorage;function requireCookieStorage(){if(hasRequiredCookieStorage)return cookieStorage;hasRequiredCookieStorage=1;var n=requireUtil(),e=n.Global,t=n.trim;cookieStorage={name:"cookieStorage",read:o,write:a,each:s,remove:u,clearAll:h};var r=e.document;function o(c){if(!c||!l(c))return null;var _="(?:^|.*;\\s*)"+escape(c).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(r.cookie.replace(new RegExp(_),"$1"))}function s(c){for(var _=r.cookie.split(/; ?/g),d=_.length-1;d>=0;d--)if(t(_[d])){var y=_[d].split("="),m=unescape(y[0]),g=unescape(y[1]);c(g,m)}}function a(c,_){c&&(r.cookie=escape(c)+"="+escape(_)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function u(c){!c||!l(c)||(r.cookie=escape(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function h(){s(function(c,_){u(_)})}function l(c){return new RegExp("(?:^|;\\s*)"+escape(c).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(r.cookie)}return cookieStorage}var sessionStorage_1,hasRequiredSessionStorage;function requireSessionStorage(){if(hasRequiredSessionStorage)return sessionStorage_1;hasRequiredSessionStorage=1;var n=requireUtil(),e=n.Global;sessionStorage_1={name:"sessionStorage",read:r,write:o,each:s,remove:a,clearAll:u};function t(){return e.sessionStorage}function r(h){return t().getItem(h)}function o(h,l){return t().setItem(h,l)}function s(h){for(var l=t().length-1;l>=0;l--){var c=t().key(l);h(r(c),c)}}function a(h){return t().removeItem(h)}function u(){return t().clear()}return sessionStorage_1}var memoryStorage_1,hasRequiredMemoryStorage;function requireMemoryStorage(){if(hasRequiredMemoryStorage)return memoryStorage_1;hasRequiredMemoryStorage=1,memoryStorage_1={name:"memoryStorage",read:e,write:t,each:r,remove:o,clearAll:s};var n={};function e(a){return n[a]}function t(a,u){n[a]=u}function r(a){for(var u in n)n.hasOwnProperty(u)&&a(n[u],u)}function o(a){delete n[a]}function s(a){n={}}return memoryStorage_1}var all,hasRequiredAll;function requireAll(){return hasRequiredAll||(hasRequiredAll=1,all=[requireLocalStorage(),requireOldFFGlobalStorage(),requireOldIEUserDataStorage(),requireCookieStorage(),requireSessionStorage(),requireMemoryStorage()]),all}var json2$1={},hasRequiredJson2$1;function requireJson2$1(){return hasRequiredJson2$1||(hasRequiredJson2$1=1,typeof JSON!="object"&&(JSON={}),(function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(n){return rx_escapable.lastIndex=0,rx_escapable.test(n)?'"'+n.replace(rx_escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function str(n,e){var t,r,o,s,a=gap,u,h=e[n];switch(h&&typeof h=="object"&&typeof h.toJSON=="function"&&(h=h.toJSON(n)),typeof rep=="function"&&(h=rep.call(e,n,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,u=[],Object.prototype.toString.apply(h)==="[object Array]"){for(s=h.length,t=0;t<s;t+=1)u[t]=str(t,h)||"null";return o=u.length===0?"[]":gap?`[
`+gap+u.join(`,
`+gap)+`
`+a+"]":"["+u.join(",")+"]",gap=a,o}if(rep&&typeof rep=="object")for(s=rep.length,t=0;t<s;t+=1)typeof rep[t]=="string"&&(r=rep[t],o=str(r,h),o&&u.push(quote(r)+(gap?": ":":")+o));else for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(o=str(r,h),o&&u.push(quote(r)+(gap?": ":":")+o));return o=u.length===0?"{}":gap?`{
`+gap+u.join(`,
`+gap)+`
`+a+"}":"{"+u.join(",")+"}",gap=a,o}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(n,e,t){var r;if(gap="",indent="",typeof t=="number")for(r=0;r<t;r+=1)indent+=" ";else typeof t=="string"&&(indent=t);if(rep=e,e&&typeof e!="function"&&(typeof e!="object"||typeof e.length!="number"))throw new Error("JSON.stringify");return str("",{"":n})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(n,e){var t,r,o=n[e];if(o&&typeof o=="object")for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(r=walk(o,t),r!==void 0?o[t]=r:delete o[t]);return reviver.call(n,e,o)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()),json2$1}var json2,hasRequiredJson2;function requireJson2(){if(hasRequiredJson2)return json2;hasRequiredJson2=1,json2=n;function n(){return requireJson2$1(),{}}return json2}var store_legacy,hasRequiredStore_legacy;function requireStore_legacy(){if(hasRequiredStore_legacy)return store_legacy;hasRequiredStore_legacy=1;var n=requireStoreEngine(),e=requireAll(),t=[requireJson2()];return store_legacy=n.createStore(e,t),store_legacy}var store_legacyExports=requireStore_legacy();const store=getDefaultExportFromCjs(store_legacyExports),devtools={isOpen:!1,orientation:void 0},threshold=170,emitEvent=(n,e)=>{globalThis.dispatchEvent(new globalThis.CustomEvent("devtoolschange",{detail:{isOpen:n,orientation:e}}))},main=({emitEvents:n=!0}={})=>{const e=globalThis.outerWidth-globalThis.innerWidth>threshold,t=globalThis.outerHeight-globalThis.innerHeight>threshold,r=e?"vertical":"horizontal";!(t&&e)&&(globalThis.Firebug&&globalThis.Firebug.chrome&&globalThis.Firebug.chrome.isInitialized||e||t)?((!devtools.isOpen||devtools.orientation!==r)&&n&&emitEvent(!0,r),devtools.isOpen=!0,devtools.orientation=r):(devtools.isOpen&&n&&emitEvent(!1,void 0),devtools.isOpen=!1,devtools.orientation=void 0)};main({emitEvents:!1});setInterval(main,500);class SysWeb extends SysBase{#t;constructor(...[e={},t={cur:"prj/",crypto:!1,dip:""}]){super(e,t);const r=t.cur.split("/");this.#t=r.length>2?r.slice(0,-2).join("/")+"/":"",this.loaded(e,t)}async loaded(...[e,t]){await super.loaded(e,t),document.querySelectorAll("[data-prj]").forEach(a=>{const u=a.attributes.getNamedItem("data-prj");u&&a.addEventListener("click",()=>{this.runSN(u.value)},{passive:!0})}),document.querySelectorAll("[data-reload]").forEach(a=>a.addEventListener("click",()=>{this.run()},{passive:!0})),t.dip&&(CmnLib.hDip=JSON.parse(t.dip));const r=new URLSearchParams(location.search),o=r.get("dip");if(o&&(CmnLib.hDip={...CmnLib.hDip,...JSON.parse(o.replaceAll("%2C",","))}),!argChk_Boolean(CmnLib.hDip,"oninit_run",!0))return;argChk_Boolean(CmnLib.hDip,"dbg",!1)&&(CmnLib.isDbg=!0,this.fetch=(a,u)=>fetch(a,{...u,mode:"cors"})),this.extPort=argChk_Num(CmnLib.hDip,"port",this.extPort);const s=r.get("cur");s&&(t.cur=this.#t+s+"/"),await this.run()}#e=":";async runSN(e){this.arg.cur=this.#t+e+"/",this.#e!==this.arg.cur&&(this.#e=this.arg.cur,await this.run())}async initVal(e,t){const r=encodeURIComponent(document.location.hostname);e["const.sn.isDebugger"]=r==="localhost"||r==="127.0.0.1";const o=this.cfg.headNs;this.flushSub=this.arg.crypto?async()=>{store.set(o+"sys_",await this.enc(JSON.stringify(this.data.sys))),store.set(o+"mark_",await this.enc(JSON.stringify(this.data.mark))),store.set(o+"kidoku_",await this.enc(JSON.stringify(this.data.kidoku)))}:()=>{store.set(o+"sys",this.data.sys),store.set(o+"mark",this.data.mark),store.set(o+"kidoku",this.data.kidoku)};const s=o+(this.arg.crypto?"sys_":"sys");if(e["const.sn.isFirstBoot"]=store.get(s)===void 0){this.data.sys={},this.data.mark={},this.data.kidoku={},t(this.data);return}if(!this.arg.crypto){this.data.sys=store.get(o+"sys"),this.data.mark=store.get(o+"mark"),this.data.kidoku=store.get(o+"kidoku"),t(this.data);return}let a="";try{a="sys",this.data.sys=JSON.parse(await this.dec("json",store.get(o+"sys_"))),a+=String(this.val.getVal("sys:TextLayer.Back.Alpha",1)),a="mark",this.data.mark=JSON.parse(await this.dec("json",store.get(o+"mark_"))),a="kidoku",this.data.kidoku=JSON.parse(await this.dec("json",store.get(o+"kidoku_")))}catch(u){console.error(`セーブデータ（${a}）が壊れています。一度クリアする必要があります(a) %o`,u)}t(this.data)}init(e,t,r){const o=super.init(e,t,r),s=t.view.parentElement;if("requestFullscreen"in document.body)this.tglFlscr_sub=this.isFullScr?()=>document.exitFullscreen():()=>s.requestFullscreen(),this.elc.add(document,"fullscreenchange",()=>{this.isFullScr=!!document.fullscreenElement});else{const a=document;this.tglFlscr_sub=this.isFullScr?()=>a.webkitCancelFullScreen():()=>s.webkitRequestFullscreen(),this.elc.add(document,"fullscreenchange",()=>{this.isFullScr=!!a.webkitFullscreenElement})}return this.cfg.oCfg.debug.devtool||this.elc.add(globalThis,"devtoolschange",a=>{a.detail.isOpen&&(console.error("DevToolは禁止されています。許可する場合は【プロジェクト設定】の【devtool】をONに。"),this.main?.destroy())},{once:!0,passive:!0}),o}cvsResize(){if(super.cvsResize(),!this.isFullScr||!this.main)return;const e=this.main.cvs.style;e.width=e.height=""}pathBaseCnvSnPath4Dbg="${pathbase}/";_export=()=>((async()=>{const e=JSON.stringify({sys:this.data.sys,mark:this.data.mark,kidoku:this.data.kidoku}),t=this.arg.crypto?await this.enc(e):e,r=new Blob([t],{type:"text/json"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=(this.arg.crypto?"":"no_crypto_")+this.cfg.headNs+getDateStr("-","_","")+".swpd",o.click(),CmnLib.debugLog&&console.log("プレイデータをエクスポートしました"),setTimeout(()=>this.fire("sn:exported",new MouseEvent("click")),10)})(),!1);_import=()=>(new Promise((e,t)=>{const r=document.createElement("input");r.type="file",r.accept=".swpd, text/plain",r.onchange=()=>{const o=r.files?.[0];o?e(o):t(new Error("ファイル選択に失敗しました"))},r.click()}).then(async e=>{const t=await e.text(),r=JSON.parse(this.arg.crypto?await this.dec("json",t):t);if(r.sys["const.sn.cfg.ns"]!==this.cfg.oCfg.save_ns){console.error(`別のゲーム【プロジェクト名=${r.sys["const.sn.cfg.ns"]}】のプレイデータです`);return}this.data.sys=r.sys,this.data.mark=r.mark,this.data.kidoku=r.kidoku,this.flush(),this.val.updateData(r),CmnLib.debugLog&&console.log("プレイデータをインポートしました"),this.fire("sn:imported",new MouseEvent("click"))}).catch(e=>console.error(`異常なプレイデータです ${String(e)}`)),!1);navigate_to=e=>{const{url:t}=e;if(!t)throw"[navigate_to] urlは必須です";return globalThis.open(t,"_blank"),!1};titleSub(e){document.title=e,document.querySelectorAll("[data-title]").forEach(t=>{t.textContent=e})}async savePic(e,t){const r=document.createElement("a");r.href=t,r.download=e,r.click(),CmnLib.debugLog&&console.log("画像ファイルをダウンロードします")}#i={};async appendFile(e,t){const r=(this.#i[e]??"")+t;this.#i[e]=r,await this.outputFile(e,r)}async outputFile(e,t){const r=new Blob([t],{type:"text/json"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=e,o.click()}}const{BlurFilter,ColorMatrixFilter,NoiseFilter}=filters;class Layer{layname="";name_="";set name(e){this.name_=e}get name(){return this.name_}ctn=new Sprite(Texture.EMPTY);get alpha(){return this.ctn.alpha}set alpha(e){this.ctn.alpha=e}get height(){return this.ctn.height}get rotation(){return this.ctn.angle}set rotation(e){this.ctn.angle=e}get scale_x(){return this.ctn.scale.x}set scale_x(e){this.ctn.scale.x=e}get scale_y(){return this.ctn.scale.y}set scale_y(e){this.ctn.scale.y=e}get width(){return this.ctn.width}get x(){return this.ctn.x}set x(e){this.procSetX(e),this.ctn.x=e}procSetX(e){}get y(){return this.ctn.y}set y(e){this.procSetY(e),this.ctn.y=e}procSetY(e){}destroy(){}lay(e){const t=this.ctn;return"alpha"in e&&(t.alpha=argChk_Num(e,"alpha",1)),Layer.setBlendmode(t,e),("pivot_x"in e||"pivot_y"in e)&&t.pivot.set(argChk_Num(e,"pivot_x",t.pivot.x),argChk_Num(e,"pivot_y",t.pivot.y)),"rotation"in e&&(t.angle=argChk_Num(e,"rotation",0)),("scale_x"in e||"scale_y"in e)&&t.scale.set(argChk_Num(e,"scale_x",t.scale.x),argChk_Num(e,"scale_y",t.scale.y)),"visible"in e&&(t.visible=argChk_Boolean(e,"visible",!0)),"filter"in e&&(t.filters=[Layer.bldFilters(e)],this.aFltHArg=[e]),!1}aFltHArg=[];static bldFilters(e){const{filter:t=""}=e,r=Layer.hBldFilter[t];if(!r)throw"filter が異常です";const o=r(e);o.enabled=argChk_Boolean(e,"enable_filter",!0);const{blendmode:s}=e;return s&&(o.blendMode=Layer.getBlendmodeNum(s)),o}static hBldFilter={blur:e=>{const t=new BlurFilter(argChk_Num(e,"strength",8),argChk_Num(e,"quality",4),"resolution"in e?argChk_Num(e,"resolution",0):void 0,argChk_Num(e,"kernel_size",5));return t.blurX=uint(argChk_Num(e,"blur_x",2)),t.blurY=uint(argChk_Num(e,"blur_y",2)),t.repeatEdgePixels=argChk_Boolean(e,"repeat_edge_pixels",!1),t},noise:e=>new NoiseFilter(argChk_Num(e,"noise",.5),"seed"in e?argChk_Num(e,"seed",0):void 0),color_matrix:e=>{const t=new ColorMatrixFilter;t.alpha=uint(argChk_Num(e,"alpha",1));const{matrix:r=""}=e;if(r){const o=r.split(","),s=o.length;if(s!==20)throw`matrix の個数（${String(s)}）が 20 ではありません`;for(let a=0;a<s;++a)t.matrix[a]=uint(o[a])}else t.matrix[0]=uint(argChk_Num(e,"rtor",1)),t.matrix[1]=uint(argChk_Num(e,"gtor",0)),t.matrix[2]=uint(argChk_Num(e,"btor",0)),t.matrix[3]=uint(argChk_Num(e,"ator",0)),t.matrix[4]=uint(argChk_Num(e,"pr",0)),t.matrix[5]=uint(argChk_Num(e,"rtog",0)),t.matrix[6]=uint(argChk_Num(e,"gtog",1)),t.matrix[7]=uint(argChk_Num(e,"btog",0)),t.matrix[8]=uint(argChk_Num(e,"atog",0)),t.matrix[9]=uint(argChk_Num(e,"pg",0)),t.matrix[10]=uint(argChk_Num(e,"rtob",0)),t.matrix[11]=uint(argChk_Num(e,"gtob",0)),t.matrix[12]=uint(argChk_Num(e,"btob",1)),t.matrix[13]=uint(argChk_Num(e,"atob",0)),t.matrix[14]=uint(argChk_Num(e,"pb",0)),t.matrix[15]=uint(argChk_Num(e,"rtoa",0)),t.matrix[16]=uint(argChk_Num(e,"gtoa",0)),t.matrix[17]=uint(argChk_Num(e,"btoa",0)),t.matrix[18]=uint(argChk_Num(e,"atoa",1)),t.matrix[19]=uint(argChk_Num(e,"pa",0));return t},black_and_white:e=>{const t=new ColorMatrixFilter;return t.blackAndWhite(argChk_Boolean(e,"multiply",!1)),t},brightness:e=>{const t=new ColorMatrixFilter;return t.brightness(argChk_Num(e,"b",.5),argChk_Boolean(e,"multiply",!1)),t},browni:e=>{const t=new ColorMatrixFilter;return t.browni(argChk_Boolean(e,"multiply",!0)),t},color_tone:e=>{const t=new ColorMatrixFilter;return t.colorTone(argChk_Num(e,"desaturation",.5),argChk_Num(e,"toned",.5),argChk_Num(e,"light_color",16770432),argChk_Num(e,"dark_color",16770432),argChk_Boolean(e,"multiply",!1)),t},contrast:e=>{const t=new ColorMatrixFilter;return t.contrast(argChk_Num(e,"amount",.5),argChk_Boolean(e,"multiply",!1)),t},grayscale:e=>{const t=new ColorMatrixFilter;return t.grayscale(argChk_Num(e,"scale",.5),argChk_Boolean(e,"multiply",!1)),t},hue:e=>{const t=new ColorMatrixFilter;return t.hue(argChk_Num(e,"f_rotation",90),argChk_Boolean(e,"multiply",!1)),t},kodachrome:e=>{const t=new ColorMatrixFilter;return t.kodachrome(argChk_Boolean(e,"multiply",!0)),t},lsd:e=>{const t=new ColorMatrixFilter;return t.lsd(argChk_Boolean(e,"multiply",!1)),t},negative:e=>{const t=new ColorMatrixFilter;return t.negative(argChk_Boolean(e,"multiply",!1)),t},night:e=>{const t=new ColorMatrixFilter;return t.night(argChk_Num(e,"intensity",.5),argChk_Boolean(e,"multiply",!1)),t},polaroid:e=>{const t=new ColorMatrixFilter;return t.polaroid(argChk_Boolean(e,"multiply",!1)),t},predator:e=>{const t=new ColorMatrixFilter;return t.predator(argChk_Num(e,"amount",.5),argChk_Boolean(e,"multiply",!1)),t},saturate:e=>{const t=new ColorMatrixFilter;return t.saturate(argChk_Num(e,"amount",.5),argChk_Boolean(e,"multiply",!1)),t},sepia:e=>{const t=new ColorMatrixFilter;return t.sepia(argChk_Boolean(e,"multiply",!1)),t},technicolor:e=>{const t=new ColorMatrixFilter;return t.technicolor(argChk_Boolean(e,"multiply",!0)),t},tint:e=>{const t=new ColorMatrixFilter;return t.tint(argChk_Num(e,"f_color",8947848),argChk_Boolean(e,"multiply",!1)),t},to_bgr:e=>{const t=new ColorMatrixFilter;return t.toBGR(argChk_Boolean(e,"multiply",!1)),t},vintage:e=>{const t=new ColorMatrixFilter;return t.vintage(argChk_Boolean(e,"multiply",!0)),t}};static setBlendmode(e,t){const{blendmode:r}=t;if(!r)return;const o=Layer.getBlendmodeNum(r);e instanceof Sprite&&(e.blendMode=o);for(const s of e.children)s instanceof Sprite&&(s.blendMode=o)}static getBlendmodeNum(e){if(!e)return BLEND_MODES.NORMAL;const t=Layer.#t[e];if(t!==void 0)return t;throw`${e} はサポートされない blendmode です`}static#t={normal:BLEND_MODES.NORMAL,add:BLEND_MODES.ADD,multiply:BLEND_MODES.MULTIPLY,screen:BLEND_MODES.SCREEN};static getNum2Blendmode(e){return Layer.#e[e]??"normal"}static#e={0:"normal",1:"add",2:"multiply",3:"screen"};get containMovement(){return!1}renderStart(e){}renderEnd(){}clearLay(e){this.ctn.alpha=1,this.ctn.blendMode=BLEND_MODES.NORMAL,this.ctn.pivot.set(0,0),this.ctn.angle=0,this.ctn.scale.set(1,1),argChk_Boolean(e,"clear_filter",!1)&&(this.ctn.filters=null,this.aFltHArg=[])}copy(e,t){const r=this.name_;this.playback(e.record(),t),this.name=r}record(){return{name:this.name_,idx:this.ctn.parent.getChildIndex(this.ctn),alpha:this.ctn.alpha,blendMode:this.ctn.blendMode,rotation:this.ctn.angle,scale_x:this.ctn.scale.x,scale_y:this.ctn.scale.y,pivot_x:this.ctn.pivot.x,pivot_y:this.ctn.pivot.y,x:this.ctn.x,y:this.ctn.y,visible:this.ctn.visible,aFltHArg:this.aFltHArg}}playback(e,t){this.name=e.name,this.clearLay({clear_filter:!0}),this.ctn.alpha=e.alpha,this.ctn.blendMode=e.blendMode,this.ctn.angle=e.rotation,this.ctn.scale.set(e.scale_x,e.scale_y),this.ctn.pivot.set(e.pivot_x,e.pivot_y),this.ctn.position.set(e.x,e.y),this.ctn.visible=e.visible,this.aFltHArg=e.aFltHArg??[],this.ctn.filters=this.aFltHArg.length===0?null:this.aFltHArg.map(r=>Layer.bldFilters(r))}snapshot(e,t){e.render(this.ctn,{clear:!1}),t()}snapshot_end(){}makeDesignCast(e){}makeDesignCastChildren(e){}showDesignCast(){}showDesignCastChildren(){}cvsResize(){}cvsResizeChildren(){}dump(){return` "idx":${String(this.ctn.parent.getChildIndex(this.ctn))}, "visible":"${String(this.ctn.visible)}", "left":${String(this.ctn.x)}, "top":${String(this.ctn.y)}, "alpha":${String(this.ctn.alpha)}, "rotation":${String(this.ctn.angle)}, "name":"${this.name_}", "scale_x":${String(this.ctn.scale.x)}, "scale_y":${String(this.ctn.scale.y)}, "filters": [${this.aFltHArg.map(e=>`"${e.filter??""}"`).join(",")}]`}static setXY(e,t,r,o=!1,s=!1){if(t.pos){Layer.setXYByPos(e,t.pos,r);return}const a=e.getBounds(),u=r.scale.x<0?-r.scale.x:r.scale.x,h=u===1?a.width:a.width*u,l=r.scale.y<0?-r.scale.y:r.scale.y,c=l===1?a.height:a.height*l;let _=r.x;"left"in t?(_=argChk_Num(t,"left",0),_>-1&&_<1&&(_*=CmnLib.stageW)):"center"in t?(_=argChk_Num(t,"center",0),_>-1&&_<1&&(_*=CmnLib.stageW),_-=(s?h/3:h)/2):"right"in t?(_=argChk_Num(t,"right",0),_>-1&&_<1&&(_*=CmnLib.stageW),_-=s?h/3:h):"s_right"in t&&(_=argChk_Num(t,"s_right",0),_>-1&&_<1&&(_*=CmnLib.stageW),_=CmnLib.stageW-_-(s?h/3:h)),r.x=int(r.scale.x<0?_+(s?h/3:h):_);let d=r.y;"top"in t?(d=argChk_Num(t,"top",0),d>-1&&d<1&&(d*=CmnLib.stageH)):"middle"in t?(d=argChk_Num(t,"middle",0),d>-1&&d<1&&(d*=CmnLib.stageH),d-=c/2):"bottom"in t?(d=argChk_Num(t,"bottom",0),d>-1&&d<1&&(d*=CmnLib.stageH),d-=c):"s_bottom"in t&&(d=argChk_Num(t,"s_bottom",0),d>-1&&d<1&&(d*=CmnLib.stageH),d=CmnLib.stageH-d-c),r.y=int(r.scale.y<0?d+c:d),o&&!("left"in t)&&!("center"in t)&&!("right"in t)&&!("s_right"in t)&&!("top"in t)&&!("middle"in t)&&!("bottom"in t)&&!("s_bottom"in t)&&Layer.setXYByPos(e,"c",r)}static setXYByPos(e,t,r){if(t==="stay")return;const o=e.getBounds(),s=r.scale.x<0?-r.scale.x:r.scale.x,a=s===1?o.width:o.width*s,u=r.scale.y<0?-r.scale.y:r.scale.y,h=u===1?o.height:o.height*u;let l=0;!t||t==="c"?l=CmnLib.stageW*.5:t==="r"?l=CmnLib.stageW-a*.5:t==="l"?l=a*.5:l=int(t),r.x=int(l-a*.5),r.y=CmnLib.stageH-h,r.scale.x<0&&(r.x+=a),r.scale.y<0&&(r.y+=h)}static setXYCenter(e){const t=e.getBounds();e.x=(CmnLib.stageW-t.width)*.5,e.y=(CmnLib.stageH-t.height)*.5}}const web=Object.freeze(Object.defineProperty({__proto__:null,CmnLib,Layer,SysWeb,argChk_Boolean,argChk_Num},Symbol.toStringTag,{value:"Module"}));export{Application as A,AnimatedSprite as B,CmnLib as C,EVNM_KEY as D,EventListenerCtn as E,Filter as F,Graphics as G,EVNM_CLICK as H,SysBase as I,EVNM_BUTTON as J,mesErrJSON as K,Loader as L,initStyle as M,Rectangle as N,TextStyle as O,Text as P,TextureCache as Q,RPN_COMP_CHIN as R,SEARCH_PATH_ARG_EXT as S,Ticker as T,BLEND_MODES as U,web as V,getFn as a,clearTextureCache as b,commonjsGlobal as c,argChk_Boolean as d,ConfigBase as e,getDateStr as f,getDefaultExportFromCjs as g,creSAVEDATA as h,creTMP_DATA as i,int as j,creSYS_DATA as k,argChk_Num as l,LoaderResource as m,i as n,extensions as o,parseColor as p,Container as q,argChk_Color as r,skipHello as s,autoDetectRenderer as t,uint as u,RenderTexture as v,addStyle as w,Sprite as x,Texture as y,Layer as z};
