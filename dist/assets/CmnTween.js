import{l as m,d as L,C as Q}from"./web.js";import{z as P,E as i,K as v,W as N,a as C}from"./Reading.js";const x=`trans
`,S="tsy nm:";class T{static#t={};static#s;static#i;static init(t,n){this.#t={},this.#s=t,this.#i=n,this.#i.ticker.add(this.#a)}static#a=()=>P();static destroy(){this.stopAllTw(),this.#i.ticker.remove(this.#a)}static setTwProp(t,n){const s=m(n,"repeat",1);return t.delay(m(n,"delay",0)).easing(this.ease(n.ease)).repeat(s>0?s-1:1/0).yoyo(L(n,"yoyo",!1))}static#e={"Back.In":t=>i.Back.In(t),"Back.InOut":t=>i.Back.InOut(t),"Back.Out":t=>i.Back.Out(t),"Bounce.In":t=>i.Bounce.In(t),"Bounce.InOut":t=>i.Bounce.InOut(t),"Bounce.Out":t=>i.Bounce.Out(t),"Circular.In":t=>i.Circular.In(t),"Circular.InOut":t=>i.Circular.InOut(t),"Circular.Out":t=>i.Circular.Out(t),"Cubic.In":t=>i.Cubic.In(t),"Cubic.InOut":t=>i.Cubic.InOut(t),"Cubic.Out":t=>i.Cubic.Out(t),"Elastic.In":t=>i.Elastic.In(t),"Elastic.InOut":t=>i.Elastic.InOut(t),"Elastic.Out":t=>i.Elastic.Out(t),"Exponential.In":t=>i.Exponential.In(t),"Exponential.InOut":t=>i.Exponential.InOut(t),"Exponential.Out":t=>i.Exponential.Out(t),"Linear.None":t=>i.Linear.None(t),"Quadratic.In":t=>i.Quadratic.In(t),"Quadratic.InOut":t=>i.Quadratic.InOut(t),"Quadratic.Out":t=>i.Quadratic.Out(t),"Quartic.In":t=>i.Quartic.In(t),"Quartic.InOut":t=>i.Quartic.InOut(t),"Quartic.Out":t=>i.Quartic.Out(t),"Quintic.In":t=>i.Quintic.In(t),"Quintic.InOut":t=>i.Quintic.InOut(t),"Quintic.Out":t=>i.Quintic.Out(t),"Sinusoidal.In":t=>i.Sinusoidal.In(t),"Sinusoidal.InOut":t=>i.Sinusoidal.InOut(t),"Sinusoidal.Out":t=>i.Sinusoidal.Out(t)};static ease(t){if(!t)return s=>i.Linear.None(s);const n=this.#e[t];if(!n)throw"ç•°å¸¸ãªeaseæŒ‡å®šã§ã™";return n}static aLayerPrpNm=["alpha","height","rotation","scale_x","scale_y","pivot_x","pivot_y","width","x","y"];static cnvTweenArg(t,n){const s={};for(const a of T.aLayerPrpNm){const c=t[a];if(!c)continue;const r=String(c),h=r.startsWith("="),p=h?r.slice(1):r;if(!p)continue;const[d="0",o]=p.split(","),u=s[a]=parseFloat(d);o&&(s[a]+=Math.round(Math.random()*(parseFloat(o)-u+1))),h&&(s[a]+=parseFloat(n[a]))}return s}static stopAllTw(){this.#t={},v()}static tween(t,n,s,a,c,r,h,p=!0){const d=this.#s.isSkipping?0:m(n,"time",NaN),o=new N(s).to(a,d).onUpdate(e=>c(e));this.setTwProp(o,n),this.#t[t]={tw:o,onEnd:h};const{path:u}=n;let I=o;if(u){Q.debugLog&&console.group(`ğŸ [${n[":ã‚¿ã‚°å"]}] path=${u}= start(${s.x},${s.y},${s.alpha})`);for(const{groups:e}of u.matchAll(this.#o)){const{x:f,x2:$,y,y2:b,o:g,o2:B,json:O}=e;let l={};if(O)try{l=JSON.parse(O)}catch(_){console.error(`ğŸ json=${O} `+String(_));continue}else(f??$)&&(l.x=f??$),(y??b)&&(l.y=y??b),(g??B)&&(l.alpha=Number(g??B));const k=this.cnvTweenArg(l,s);Q.debugLog&&console.info(`ğŸ ${O??`{x:${f} y:${y} o:${g}}`} => hTo:${JSON.stringify(k)}`);const E=new N(s).to(k,d);this.setTwProp(E,n),I.chain(E),I=E}Q.debugLog&&console.groupEnd()}I.onComplete(()=>{const e=this.#t[t];e?.tw&&(delete this.#t[t],e.tw=void 0,o.stop(),e.onEnd?.(),r(),C.notifyEndProc(S+t))});const{chain:w}=n;if(w){const e=this.#t[w];if(!e?.tw)throw`${w}ã¯å­˜åœ¨ã—ãªã„ãƒ»ã¾ãŸã¯çµ‚äº†ã—ãŸãƒˆã‚¥ã‚¤ãƒ¼ãƒ³ã§ã™`;delete e.onEnd,e.tw.chain(o)}else p&&o.start();return o}static#o=/\(\s*(?:(?<x>[-=\d.]+)|(['"])(?<x2>.*?)\2)?(?:\s*,\s*(?:(?<y>[-=\d.]+)|(['"])(?<y2>.*?)\5)?(?:\s*,\s*(?:(?<o>[-=\d.]+)|(['"])(?<o2>.*?)\8))?)?|(?<json>\{[^{}]*})/g;static wt(t){if(!this.#t[x]?.tw)return!1;const n=()=>this.stopEndTrans();return C.beginProc(x,n,!0,n),!0}static stopEndTrans(){this.#t[x]?.tw?.stop().end()}static wait_tsy(t){const n=this.#n(t),s=this.#t[n];if(!s?.tw)return!1;const a=()=>s.tw?.end();return C.beginProc(S+n,a,!0,a),!0}static#n(t){const{layer:n="",id:s,name:a}=t,c=s?`frm
${s}`:a??n;if(!c)throw"ãƒˆã‚¥ã‚¤ãƒ¼ãƒ³ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“";return c}static stop_tsy(t){const n=this.#n(t);return this.#t[n]?.tw?.stop().end(),!1}static pause_tsy(t){const n=this.#n(t);return this.#t[n]?.tw?.pause(),!1}static resume_tsy(t){const n=this.#n(t);return this.#t[n]?.tw?.resume(),!1}}export{x as _,T as k};
