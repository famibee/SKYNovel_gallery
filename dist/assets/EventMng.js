const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gamepad.js","assets/chunk.js"])))=>i.map(i=>d[i]);
import{t as e}from"../web.js";import{r as t}from"./chunk.js";import{i as n,m as r,n as i,o as a,r as o,s,t as c}from"./CmnLib.js";import{_ as l,i as u}from"./pixi2.js";import{t as d}from"./EventListenerCtn.js";import{n as f}from"./ConfigBase.js";import"./Layer.js";import"./DebugMng.js";import{i as p,r as m}from"./Reading.js";import"./SpritesMng.js";import{Button as h}from"./Button.js";import"./CmnInterface.js";import{t as g}from"./SysBase.js";import{TxtLayer as _}from"./TxtLayer.js";var v=class{#e=[];#t=-1;#n=new d;constructor(e,t){this.#a=t.isApp?()=>e.focus():()=>globalThis.focus()}destroy(){this.#e=[],this.#t=-1,this.#n.clear()}add(e,t,r){if(this.#e.findIndex(t=>t.btn===e)>=0)return;if(e instanceof u){e.on(`pointerdown`,()=>{for(let t=this.#e.length-1;t>=0;--t)if(this.#e[t].btn===e){this.#t=t;return}this.#t=-1}),this.#e.push({btn:e,on:t,off:r});return}this.#n.add(e,`focus`,()=>{for(let t=this.#e.length-1;t>=0;--t)if(this.#e[t].btn===e){this.#t=t;return}this.#t=-1});let i=e=>{},a=e.localName===`button`||e.localName===`a`?e=>!e.isTrusted&&e.key===`Enter`:e=>e.key===`Enter`,o=e;switch(o.type??``){case`checkbox`:i=()=>{o.checked=!o.checked};break;case``:e.querySelectorAll(`input[type]`).length>0&&(i=t=>this.#r(e,t.key),a=()=>!1);break;case`range`:i=e=>{e.isTrusted||(e.key===`ArrowUp`?o.stepUp():o.stepDown())};break;case`text`:case`textarea`:i=e=>{if(e.isTrusted)return;let t=(o.selectionStart??0)+(e.key===`ArrowUp`?-1:1);t<0&&(t=0),o.setSelectionRange(t,t)};break}this.#n.add(e,n,t=>{if(!(t.key!==`ArrowUp`&&t.key!==`ArrowDown`&&t.key!==`Enter`)){if(t.stopImmediatePropagation(),a(t)){e.dispatchEvent(new MouseEvent(`click`));return}i(t)}},{passive:!0}),e.hasAttribute(`tabindex`)||(e.tabIndex=0),this.#e.push({btn:e,on:t,off:r})}remove(e){let t=this.#e.findIndex(t=>t.btn===e);t<0||(this.#e.splice(t,1),this.#e.length===0?this.#t=-1:t<=this.#t&&--this.#t)}#r(e,t){let n=e.querySelectorAll(`input[type]`),r=n.length;for(let e=0;e<r;++e)if(n[e].checked){n[(e+r+(t===`ArrowUp`?-1:1))%r].checked=!0;break}}isFocus(e){return this.#t<0?!1:this.#e[this.#t].btn===e}prev(){this.#o();let e=this.#e.length;if(e!==0){--this.#t<0&&(this.#t=e-1);for(let t=e;t>=1;--t){let n=(this.#t+t)%e;if(this.#e[n].on()){this.#t=n,this.#i(n);return}}this.#t=-1}}next(){this.#o();let e=this.#e.length;if(e!==0){++this.#t>=e&&(this.#t=0);for(let t=0;t<e;++t){let n=(this.#t+t)%e;if(this.#e[n].on()){this.#t=n,this.#i(n);return}}this.#t=-1}}#i=c.debugLog?e=>console.log(`üëæ <FocusMng idx:${String(e)} btn:%o`,this.#e[e].btn):()=>{};getFocus(){if(this.#t<0)return null;this.#o(),this.#t>=this.#e.length&&(this.#t=0);let e=this.#e[this.#t];return e.on()?e.btn:null}blur(){this.#o(),this.#t=-1,this.#a()}#a=()=>{};#o(){for(let e=this.#e.length-1;e>=0;--e){let t=this.#e[e];!(t.btn instanceof u)||t.btn.parent?t.off():this.#e.splice(e,1)}}},y=`bottom`,b=`right`,x=`left`,S=`auto`,C=[`top`,y,b,x],w=`start`,T=`clippingParents`,E=`viewport`,D=`popper`,O=`reference`,k=C.reduce(function(e,t){return e.concat([t+`-`+w,t+`-end`])},[]),A=[].concat(C,[S]).reduce(function(e,t){return e.concat([t,t+`-`+w,t+`-end`])},[]),j=[`beforeRead`,`read`,`afterRead`,`beforeMain`,`main`,`afterMain`,`beforeWrite`,`write`,`afterWrite`];function M(e){return e?(e.nodeName||``).toLowerCase():null}function N(e){if(e==null)return window;if(e.toString()!==`[object Window]`){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function P(e){return e instanceof N(e).Element||e instanceof Element}function F(e){return e instanceof N(e).HTMLElement||e instanceof HTMLElement}function I(e){return typeof ShadowRoot>`u`?!1:e instanceof N(e).ShadowRoot||e instanceof ShadowRoot}function ee(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];!F(i)||!M(i)||(Object.assign(i.style,n),Object.keys(r).forEach(function(e){var t=r[e];t===!1?i.removeAttribute(e):i.setAttribute(e,t===!0?``:t)}))})}function L(e){var t=e.state,n={popper:{position:t.options.strategy,left:`0`,top:`0`,margin:`0`},arrow:{position:`absolute`},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(e){var r=t.elements[e],i=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce(function(e,t){return e[t]=``,e},{});!F(r)||!M(r)||(Object.assign(r.style,a),Object.keys(i).forEach(function(e){r.removeAttribute(e)}))})}}var te={name:`applyStyles`,enabled:!0,phase:`write`,fn:ee,effect:L,requires:[`computeStyles`]};function R(e){return e.split(`-`)[0]}var z=Math.max,B=Math.min,V=Math.round;function H(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+`/`+e.version}).join(` `):navigator.userAgent}function ne(){return!/^((?!chrome|android).)*safari/i.test(H())}function U(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var r=e.getBoundingClientRect(),i=1,a=1;t&&F(e)&&(i=e.offsetWidth>0&&V(r.width)/e.offsetWidth||1,a=e.offsetHeight>0&&V(r.height)/e.offsetHeight||1);var o=(P(e)?N(e):window).visualViewport,s=!ne()&&n,c=(r.left+(s&&o?o.offsetLeft:0))/i,l=(r.top+(s&&o?o.offsetTop:0))/a,u=r.width/i,d=r.height/a;return{width:u,height:d,top:l,right:c+u,bottom:l+d,left:c,x:c,y:l}}function re(e){var t=U(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function ie(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&I(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function W(e){return N(e).getComputedStyle(e)}function G(e){return[`table`,`td`,`th`].indexOf(M(e))>=0}function K(e){return((P(e)?e.ownerDocument:e.document)||window.document).documentElement}function q(e){return M(e)===`html`?e:e.assignedSlot||e.parentNode||(I(e)?e.host:null)||K(e)}function J(e){return!F(e)||W(e).position===`fixed`?null:e.offsetParent}function ae(e){var t=/firefox/i.test(H());if(/Trident/i.test(H())&&F(e)&&W(e).position===`fixed`)return null;var n=q(e);for(I(n)&&(n=n.host);F(n)&&[`html`,`body`].indexOf(M(n))<0;){var r=W(n);if(r.transform!==`none`||r.perspective!==`none`||r.contain===`paint`||[`transform`,`perspective`].indexOf(r.willChange)!==-1||t&&r.willChange===`filter`||t&&r.filter&&r.filter!==`none`)return n;n=n.parentNode}return null}function oe(e){for(var t=N(e),n=J(e);n&&G(n)&&W(n).position===`static`;)n=J(n);return n&&(M(n)===`html`||M(n)===`body`&&W(n).position===`static`)?t:n||ae(e)||t}function se(e){return[`top`,`bottom`].indexOf(e)>=0?`x`:`y`}function ce(e,t,n){return z(e,B(t,n))}function le(e,t,n){var r=ce(e,t,n);return r>n?n:r}function ue(){return{top:0,right:0,bottom:0,left:0}}function de(e){return Object.assign({},ue(),e)}function fe(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}var pe=function(e,t){return e=typeof e==`function`?e(Object.assign({},t.rects,{placement:t.placement})):e,de(typeof e==`number`?fe(e,C):e)};function me(e){var t,n=e.state,r=e.name,i=e.options,a=n.elements.arrow,o=n.modifiersData.popperOffsets,s=R(n.placement),c=se(s),l=[`left`,`right`].indexOf(s)>=0?`height`:`width`;if(!(!a||!o)){var u=pe(i.padding,n),d=re(a),f=c===`y`?`top`:x,p=c===`y`?y:b,m=n.rects.reference[l]+n.rects.reference[c]-o[c]-n.rects.popper[l],h=o[c]-n.rects.reference[c],g=oe(a),_=g?c===`y`?g.clientHeight||0:g.clientWidth||0:0,v=m/2-h/2,S=u[f],C=_-d[l]-u[p],w=_/2-d[l]/2+v,T=ce(S,w,C),E=c;n.modifiersData[r]=(t={},t[E]=T,t.centerOffset=T-w,t)}}function he(e){var t=e.state,n=e.options.element,r=n===void 0?`[data-popper-arrow]`:n;r!=null&&(typeof r==`string`&&(r=t.elements.popper.querySelector(r),!r)||ie(t.elements.popper,r)&&(t.elements.arrow=r))}var ge={name:`arrow`,enabled:!0,phase:`main`,fn:me,effect:he,requires:[`popperOffsets`],requiresIfExists:[`preventOverflow`]};function Y(e){return e.split(`-`)[1]}var X={top:`auto`,right:`auto`,bottom:`auto`,left:`auto`};function _e(e,t){var n=e.x,r=e.y,i=t.devicePixelRatio||1;return{x:V(n*i)/i||0,y:V(r*i)/i||0}}function ve(e){var t,n=e.popper,r=e.popperRect,i=e.placement,a=e.variation,o=e.offsets,s=e.position,c=e.gpuAcceleration,l=e.adaptive,u=e.roundOffsets,d=e.isFixed,f=o.x,p=f===void 0?0:f,m=o.y,h=m===void 0?0:m,g=typeof u==`function`?u({x:p,y:h}):{x:p,y:h};p=g.x,h=g.y;var _=o.hasOwnProperty(`x`),v=o.hasOwnProperty(`y`),S=x,C=`top`,w=window;if(l){var T=oe(n),E=`clientHeight`,D=`clientWidth`;if(T===N(n)&&(T=K(n),W(T).position!==`static`&&s===`absolute`&&(E=`scrollHeight`,D=`scrollWidth`)),T=T,i===`top`||(i===`left`||i===`right`)&&a===`end`){C=y;var O=d&&T===w&&w.visualViewport?w.visualViewport.height:T[E];h-=O-r.height,h*=c?1:-1}if(i===`left`||(i===`top`||i===`bottom`)&&a===`end`){S=b;var k=d&&T===w&&w.visualViewport?w.visualViewport.width:T[D];p-=k-r.width,p*=c?1:-1}}var A=Object.assign({position:s},l&&X),j=u===!0?_e({x:p,y:h},N(n)):{x:p,y:h};if(p=j.x,h=j.y,c){var M;return Object.assign({},A,(M={},M[C]=v?`0`:``,M[S]=_?`0`:``,M.transform=(w.devicePixelRatio||1)<=1?`translate(`+p+`px, `+h+`px)`:`translate3d(`+p+`px, `+h+`px, 0)`,M))}return Object.assign({},A,(t={},t[C]=v?h+`px`:``,t[S]=_?p+`px`:``,t.transform=``,t))}function ye(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=r===void 0?!0:r,a=n.adaptive,o=a===void 0?!0:a,s=n.roundOffsets,c=s===void 0?!0:s,l={placement:R(t.placement),variation:Y(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:t.options.strategy===`fixed`};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,ve(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,ve(Object.assign({},l,{offsets:t.modifiersData.arrow,position:`absolute`,adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var be={name:`computeStyles`,enabled:!0,phase:`beforeWrite`,fn:ye,data:{}},Z={passive:!0};function xe(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,a=i===void 0?!0:i,o=r.resize,s=o===void 0?!0:o,c=N(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&l.forEach(function(e){e.addEventListener(`scroll`,n.update,Z)}),s&&c.addEventListener(`resize`,n.update,Z),function(){a&&l.forEach(function(e){e.removeEventListener(`scroll`,n.update,Z)}),s&&c.removeEventListener(`resize`,n.update,Z)}}var Se={name:`eventListeners`,enabled:!0,phase:`write`,fn:function(){},effect:xe,data:{}},Ce={left:`right`,right:`left`,bottom:`top`,top:`bottom`};function we(e){return e.replace(/left|right|bottom|top/g,function(e){return Ce[e]})}var Te={start:`end`,end:`start`};function Ee(e){return e.replace(/start|end/g,function(e){return Te[e]})}function De(e){var t=N(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Oe(e){return U(K(e)).left+De(e).scrollLeft}function ke(e,t){var n=N(e),r=K(e),i=n.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,c=0;if(i){a=i.width,o=i.height;var l=ne();(l||!l&&t===`fixed`)&&(s=i.offsetLeft,c=i.offsetTop)}return{width:a,height:o,x:s+Oe(e),y:c}}function Ae(e){var t=K(e),n=De(e),r=e.ownerDocument?.body,i=z(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),a=z(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-n.scrollLeft+Oe(e),s=-n.scrollTop;return W(r||t).direction===`rtl`&&(o+=z(t.clientWidth,r?r.clientWidth:0)-i),{width:i,height:a,x:o,y:s}}function je(e){var t=W(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function Me(e){return[`html`,`body`,`#document`].indexOf(M(e))>=0?e.ownerDocument.body:F(e)&&je(e)?e:Me(q(e))}function Ne(e,t){t===void 0&&(t=[]);var n=Me(e),r=n===e.ownerDocument?.body,i=N(n),a=r?[i].concat(i.visualViewport||[],je(n)?n:[]):n,o=t.concat(a);return r?o:o.concat(Ne(q(a)))}function Pe(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Fe(e,t){var n=U(e,!1,t===`fixed`);return n.top+=e.clientTop,n.left+=e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}function Ie(e,t,n){return t===`viewport`?Pe(ke(e,n)):P(t)?Fe(t,n):Pe(Ae(K(e)))}function Le(e){var t=Ne(q(e)),n=[`absolute`,`fixed`].indexOf(W(e).position)>=0&&F(e)?oe(e):e;return P(n)?t.filter(function(e){return P(e)&&ie(e,n)&&M(e)!==`body`}):[]}function Re(e,t,n,r){var i=t===`clippingParents`?Le(e):[].concat(t),a=[].concat(i,[n]),o=a[0],s=a.reduce(function(t,n){var i=Ie(e,n,r);return t.top=z(i.top,t.top),t.right=B(i.right,t.right),t.bottom=B(i.bottom,t.bottom),t.left=z(i.left,t.left),t},Ie(e,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function ze(e){var t=e.reference,n=e.element,r=e.placement,i=r?R(r):null,a=r?Y(r):null,o=t.x+t.width/2-n.width/2,s=t.y+t.height/2-n.height/2,c;switch(i){case`top`:c={x:o,y:t.y-n.height};break;case y:c={x:o,y:t.y+t.height};break;case b:c={x:t.x+t.width,y:s};break;case x:c={x:t.x-n.width,y:s};break;default:c={x:t.x,y:t.y}}var l=i?se(i):null;if(l!=null){var u=l===`y`?`height`:`width`;switch(a){case w:c[l]=c[l]-(t[u]/2-n[u]/2);break;case`end`:c[l]=c[l]+(t[u]/2-n[u]/2);break;default:}}return c}function Be(e,t){t===void 0&&(t={});var n=t,r=n.placement,i=r===void 0?e.placement:r,a=n.strategy,o=a===void 0?e.strategy:a,s=n.boundary,c=s===void 0?T:s,l=n.rootBoundary,u=l===void 0?E:l,d=n.elementContext,f=d===void 0?D:d,p=n.altBoundary,m=p===void 0?!1:p,h=n.padding,g=h===void 0?0:h,_=de(typeof g==`number`?fe(g,C):g),v=f===`popper`?O:D,y=e.rects.popper,b=e.elements[m?v:f],x=Re(P(b)?b:b.contextElement||K(e.elements.popper),c,u,o),S=U(e.elements.reference),w=ze({reference:S,element:y,strategy:`absolute`,placement:i}),k=Pe(Object.assign({},y,w)),A=f===`popper`?k:S,j={top:x.top-A.top+_.top,bottom:A.bottom-x.bottom+_.bottom,left:x.left-A.left+_.left,right:A.right-x.right+_.right},M=e.modifiersData.offset;if(f===`popper`&&M){var N=M[i];Object.keys(j).forEach(function(e){var t=[`right`,`bottom`].indexOf(e)>=0?1:-1,n=[`top`,`bottom`].indexOf(e)>=0?`y`:`x`;j[e]+=N[n]*t})}return j}function Ve(e,t){t===void 0&&(t={});var n=t,r=n.placement,i=n.boundary,a=n.rootBoundary,o=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,l=c===void 0?A:c,u=Y(r),d=u?s?k:k.filter(function(e){return Y(e)===u}):C,f=d.filter(function(e){return l.indexOf(e)>=0});f.length===0&&(f=d);var p=f.reduce(function(t,n){return t[n]=Be(e,{placement:n,boundary:i,rootBoundary:a,padding:o})[R(n)],t},{});return Object.keys(p).sort(function(e,t){return p[e]-p[t]})}function He(e){if(R(e)===`auto`)return[];var t=we(e);return[Ee(e),t,Ee(t)]}function Ue(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,a=i===void 0?!0:i,o=n.altAxis,s=o===void 0?!0:o,c=n.fallbackPlacements,l=n.padding,u=n.boundary,d=n.rootBoundary,f=n.altBoundary,p=n.flipVariations,m=p===void 0?!0:p,h=n.allowedAutoPlacements,g=t.options.placement,_=R(g)===g,v=c||(_||!m?[we(g)]:He(g)),S=[g].concat(v).reduce(function(e,n){return e.concat(R(n)===`auto`?Ve(t,{placement:n,boundary:u,rootBoundary:d,padding:l,flipVariations:m,allowedAutoPlacements:h}):n)},[]),C=t.rects.reference,T=t.rects.popper,E=new Map,D=!0,O=S[0],k=0;k<S.length;k++){var A=S[k],j=R(A),M=Y(A)===w,N=[`top`,y].indexOf(j)>=0,P=N?`width`:`height`,F=Be(t,{placement:A,boundary:u,rootBoundary:d,altBoundary:f,padding:l}),I=N?M?b:x:M?y:`top`;C[P]>T[P]&&(I=we(I));var ee=we(I),L=[];if(a&&L.push(F[j]<=0),s&&L.push(F[I]<=0,F[ee]<=0),L.every(function(e){return e})){O=A,D=!1;break}E.set(A,L)}if(D)for(var te=m?3:1,z=function(e){var t=S.find(function(t){var n=E.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return O=t,`break`},B=te;B>0&&z(B)!==`break`;B--);t.placement!==O&&(t.modifiersData[r]._skip=!0,t.placement=O,t.reset=!0)}}var We={name:`flip`,enabled:!0,phase:`main`,fn:Ue,requiresIfExists:[`offset`],data:{_skip:!1}};function Ge(e,t,n){return n===void 0&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Ke(e){return[`top`,b,y,x].some(function(t){return e[t]>=0})}function qe(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,a=t.modifiersData.preventOverflow,o=Be(t,{elementContext:`reference`}),s=Be(t,{altBoundary:!0}),c=Ge(o,r),l=Ge(s,i,a),u=Ke(c),d=Ke(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}var Je={name:`hide`,enabled:!0,phase:`main`,requiresIfExists:[`preventOverflow`],fn:qe};function Ye(e,t,n){var r=R(e),i=[`left`,`top`].indexOf(r)>=0?-1:1,a=typeof n==`function`?n(Object.assign({},t,{placement:e})):n,o=a[0],s=a[1];return o||=0,s=(s||0)*i,[`left`,`right`].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}function Xe(e){var t=e.state,n=e.options,r=e.name,i=n.offset,a=i===void 0?[0,0]:i,o=A.reduce(function(e,n){return e[n]=Ye(n,t.rects,a),e},{}),s=o[t.placement],c=s.x,l=s.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[r]=o}var Ze={name:`offset`,enabled:!0,phase:`main`,requires:[`popperOffsets`],fn:Xe};function Qe(e){var t=e.state,n=e.name;t.modifiersData[n]=ze({reference:t.rects.reference,element:t.rects.popper,strategy:`absolute`,placement:t.placement})}var $e={name:`popperOffsets`,enabled:!0,phase:`read`,fn:Qe,data:{}};function et(e){return e===`x`?`y`:`x`}function tt(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,a=i===void 0?!0:i,o=n.altAxis,s=o===void 0?!1:o,c=n.boundary,l=n.rootBoundary,u=n.altBoundary,d=n.padding,f=n.tether,p=f===void 0?!0:f,m=n.tetherOffset,h=m===void 0?0:m,g=Be(t,{boundary:c,rootBoundary:l,padding:d,altBoundary:u}),_=R(t.placement),v=Y(t.placement),S=!v,C=se(_),w=et(C),T=t.modifiersData.popperOffsets,E=t.rects.reference,D=t.rects.popper,O=typeof h==`function`?h(Object.assign({},t.rects,{placement:t.placement})):h,k=typeof O==`number`?{mainAxis:O,altAxis:O}:Object.assign({mainAxis:0,altAxis:0},O),A=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,j={x:0,y:0};if(T){if(a){var M=C===`y`?`top`:x,N=C===`y`?y:b,P=C===`y`?`height`:`width`,F=T[C],I=F+g[M],ee=F-g[N],L=p?-D[P]/2:0,te=v===`start`?E[P]:D[P],V=v===`start`?-D[P]:-E[P],H=t.elements.arrow,ne=p&&H?re(H):{width:0,height:0},U=t.modifiersData[`arrow#persistent`]?t.modifiersData[`arrow#persistent`].padding:ue(),ie=U[M],W=U[N],G=ce(0,E[P],ne[P]),K=S?E[P]/2-L-G-ie-k.mainAxis:te-G-ie-k.mainAxis,q=S?-E[P]/2+L+G+W+k.mainAxis:V+G+W+k.mainAxis,J=t.elements.arrow&&oe(t.elements.arrow),ae=J?C===`y`?J.clientTop||0:J.clientLeft||0:0,de=A?.[C]??0,fe=F+K-de-ae,pe=F+q-de,me=ce(p?B(I,fe):I,F,p?z(ee,pe):ee);T[C]=me,j[C]=me-F}if(s){var he=C===`x`?`top`:x,ge=C===`x`?y:b,X=T[w],_e=w===`y`?`height`:`width`,ve=X+g[he],ye=X-g[ge],be=[`top`,x].indexOf(_)!==-1,Z=A?.[w]??0,xe=be?ve:X-E[_e]-D[_e]-Z+k.altAxis,Se=be?X+E[_e]+D[_e]-Z-k.altAxis:ye,Ce=p&&be?le(xe,X,Se):ce(p?xe:ve,X,p?Se:ye);T[w]=Ce,j[w]=Ce-X}t.modifiersData[r]=j}}var nt={name:`preventOverflow`,enabled:!0,phase:`main`,fn:tt,requiresIfExists:[`offset`]};function rt(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function it(e){return e===N(e)||!F(e)?De(e):rt(e)}function at(e){var t=e.getBoundingClientRect(),n=V(t.width)/e.offsetWidth||1,r=V(t.height)/e.offsetHeight||1;return n!==1||r!==1}function ot(e,t,n){n===void 0&&(n=!1);var r=F(t),i=F(t)&&at(t),a=K(t),o=U(e,i,n),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&((M(t)!==`body`||je(a))&&(s=it(t)),F(t)?(c=U(t,!0),c.x+=t.clientLeft,c.y+=t.clientTop):a&&(c.x=Oe(a))),{x:o.left+s.scrollLeft-c.x,y:o.top+s.scrollTop-c.y,width:o.width,height:o.height}}function st(e){var t=new Map,n=new Set,r=[];e.forEach(function(e){t.set(e.name,e)});function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}}),r.push(e)}return e.forEach(function(e){n.has(e.name)||i(e)}),r}function ct(e){var t=st(e);return j.reduce(function(e,n){return e.concat(t.filter(function(e){return e.phase===n}))},[])}function lt(e){var t;return function(){return t||=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(e())})}),t}}function ut(e){var t=e.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{});return Object.keys(t).map(function(e){return t[e]})}var dt={placement:`bottom`,modifiers:[],strategy:`absolute`};function ft(){return![...arguments].some(function(e){return!(e&&typeof e.getBoundingClientRect==`function`)})}function pt(e){e===void 0&&(e={});var t=e,n=t.defaultModifiers,r=n===void 0?[]:n,i=t.defaultOptions,a=i===void 0?dt:i;return function(e,t,n){n===void 0&&(n=a);var i={placement:`bottom`,orderedModifiers:[],options:Object.assign({},dt,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],s=!1,c={state:i,setOptions:function(n){var o=typeof n==`function`?n(i.options):n;u(),i.options=Object.assign({},a,i.options,o),i.scrollParents={reference:P(e)?Ne(e):e.contextElement?Ne(e.contextElement):[],popper:Ne(t)};var s=ct(ut([].concat(r,i.options.modifiers)));return i.orderedModifiers=s.filter(function(e){return e.enabled}),l(),c.update()},forceUpdate:function(){if(!s){var e=i.elements,t=e.reference,n=e.popper;if(ft(t,n)){i.rects={reference:ot(t,oe(n),i.options.strategy===`fixed`),popper:re(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach(function(e){return i.modifiersData[e.name]=Object.assign({},e.data)});for(var r=0;r<i.orderedModifiers.length;r++){if(i.reset===!0){i.reset=!1,r=-1;continue}var a=i.orderedModifiers[r],o=a.fn,l=a.options,u=l===void 0?{}:l,d=a.name;typeof o==`function`&&(i=o({state:i,options:u,name:d,instance:c})||i)}}}},update:lt(function(){return new Promise(function(e){c.forceUpdate(),e(i)})}),destroy:function(){u(),s=!0}};if(!ft(e,t))return c;c.setOptions(n).then(function(e){!s&&n.onFirstUpdate&&n.onFirstUpdate(e)});function l(){i.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,r=n===void 0?{}:n,a=e.effect;if(typeof a==`function`){var s=a({state:i,name:t,instance:c,options:r});o.push(s||function(){})}})}function u(){o.forEach(function(e){return e()}),o=[]}return c}}var mt=pt({defaultModifiers:[Se,$e,be,te,Ze,We,nt,ge,Je]}),ht=class e{constructor(t,n){this.element=t,this.touch1=null,this.touch2=null,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.touchMove1=null,this.touchMove2=null,this.touchMoveX=null,this.touchMoveY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapTimer=null,this.doubleTapWaiting=!1,this.thresholdX=0,this.thresholdY=0,this.disregardVelocityThresholdX=0,this.disregardVelocityThresholdY=0,this.swipingHorizontal=!1,this.swipingVertical=!1,this.swipingDirection=null,this.swipedHorizontal=!1,this.swipedVertical=!1,this.originalDistance=null,this.newDistance=null,this.scale=null,this.originalAngle=null,this.newAngle=null,this.rotation=null,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[],pinch:[],pinchend:[],rotate:[],rotateend:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.opts=Object.assign({},e.defaults,n),this.element.addEventListener(`touchstart`,this._onTouchStart,Q),this.element.addEventListener(`touchmove`,this._onTouchMove,Q),this.element.addEventListener(`touchend`,this._onTouchEnd,Q),this.opts.mouseSupport&&!(`ontouchstart`in window)&&(this.element.addEventListener(`mousedown`,this._onTouchStart,Q),document.addEventListener(`mousemove`,this._onTouchMove,Q),document.addEventListener(`mouseup`,this._onTouchEnd,Q))}destroy(){this.element.removeEventListener(`touchstart`,this._onTouchStart),this.element.removeEventListener(`touchmove`,this._onTouchMove),this.element.removeEventListener(`touchend`,this._onTouchEnd),this.element.removeEventListener(`mousedown`,this._onTouchStart),document.removeEventListener(`mousemove`,this._onTouchMove),document.removeEventListener(`mouseup`,this._onTouchEnd),clearTimeout(this.longPressTimer??void 0),clearTimeout(this.doubleTapTimer??void 0)}on(e,t){if(this.handlers[e])return this.handlers[e].push(t),{type:e,fn:t,cancel:()=>this.off(e,t)}}off(e,t){if(this.handlers[e]){let n=this.handlers[e].indexOf(t);n!==-1&&this.handlers[e].splice(n,1)}}fire(e,t){for(let n=0;n<this.handlers[e].length;n++)this.handlers[e][n](t)}onTouchStart(e){let t=!1;if(e.type!==`mousedown`){if(this.touch1||(this.touch1=e.changedTouches[0],t=!0),(t&&e.changedTouches.length>1||!t)&&!this.touch2){this.touch2=[...e.changedTouches].find(e=>e.identifier!==this.touch1?.identifier)||null,this.originalDistance=Math.sqrt(((this.touch2?.screenX??0)-(this.touchMove1?.screenX??this.touch1?.screenX??0))**2+((this.touch2?.screenY??0)-(this.touchMove1?.screenY??this.touch1?.screenY??0))**2),this.originalAngle=Math.atan2((this.touch2?.screenY??0)-(this.touchMove1?.screenY??this.touch1?.screenY??0),(this.touch2?.screenX??0)-(this.touchMove1?.screenX??this.touch1?.screenX??0))/(Math.PI/180);return}if(!t)return}(t||e.type===`mousedown`)&&(this.thresholdX=this.opts.threshold(`x`,this),this.thresholdY=this.opts.threshold(`y`,this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold(`x`,this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold(`y`,this),this.touchStartX=e.type===`mousedown`?e.screenX:this.touch1?.screenX||0,this.touchStartY=e.type===`mousedown`?e.screenY:this.touch1?.screenY||0,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.swipingDirection=null,this.longPressTimer=setTimeout(()=>this.fire(`longpress`,e),this.opts.longPressTime),this.scale=1,this.rotation=0,this.fire(`panstart`,e))}onTouchMove(e){if(e.type===`mousemove`&&(!this.touchStartX||this.touchEndX!==null))return;let t,n;if(e.type!==`mousemove`&&(t=[...e.changedTouches].find(e=>e.identifier===this.touch1?.identifier),this.touchMove1=t||this.touchMove1,n=[...e.changedTouches].find(e=>e.identifier===this.touch2?.identifier),this.touchMove2=n||this.touchMove2),e.type===`mousemove`||t){let n=(e.type===`mousemove`?e.screenX:t?.screenX??0)-(this.touchStartX??0);this.velocityX=n-(this.touchMoveX??0),this.touchMoveX=n;let r=(e.type===`mousemove`?e.screenY:t?.screenY??0)-(this.touchStartY??0);this.velocityY=r-(this.touchMoveY??0),this.touchMoveY=r;let i=Math.abs(this.touchMoveX),a=Math.abs(this.touchMoveY);this.swipingHorizontal=i>this.thresholdX,this.swipingVertical=a>this.thresholdY,this.swipingDirection=i>a?this.swipingHorizontal?`horizontal`:`pre-horizontal`:this.swipingVertical?`vertical`:`pre-vertical`,Math.max(i,a)>this.opts.pressThreshold&&clearTimeout(this.longPressTimer??void 0),this.fire(`panmove`,e)}e.type!==`mousemove`&&this.touchMove1!=null&&this.touchMove2!=null&&(this.newDistance=Math.sqrt((this.touchMove2.screenX-this.touchMove1.screenX)**2+(this.touchMove2.screenY-this.touchMove1.screenY)**2),this.scale=this.newDistance/(this.originalDistance??0),this.fire(`pinch`,e),this.newAngle=Math.atan2((this.touchMove2.screenY??0)-(this.touchMove1.screenY??0),(this.touchMove2.screenX??0)-(this.touchMove1.screenX??0))/(Math.PI/180),this.rotation=this.newAngle-(this.originalAngle??0),this.fire(`rotate`,e))}onTouchEnd(e){let t;if(e.type!==`mouseup`&&(t=[...e.changedTouches].find(e=>e.identifier===this.touch1?.identifier),[...e.touches].find(e=>e.identifier===this.touch1?.identifier)||(this.touch1=null,this.touchMove1=null),[...e.touches].find(e=>e.identifier===this.touch2?.identifier)||(this.touch2=null,this.touchMove2=null)),!(e.type===`mouseup`&&(!this.touchStartX||this.touchEndX!==null))){if(e.type===`mouseup`||t){this.touchEndX=e.type===`mouseup`?e.screenX:t?.screenX??0,this.touchEndY=e.type===`mouseup`?e.screenY:t?.screenY??0,this.fire(`panend`,e),clearTimeout(this.longPressTimer??void 0);let n=this.touchEndX-(this.touchStartX??0),r=Math.abs(n),i=this.touchEndY-(this.touchStartY??0),a=Math.abs(i),o=Math.sqrt(n**2+i**2),s=Math.abs(o),c=a/r;r>this.thresholdX||a>this.thresholdY||this.opts.diagonalSwipes&&(s>this.thresholdX||s>this.thresholdY)?(this.swipedHorizontal=r>this.thresholdX||this.opts.diagonalSwipes&&s>this.thresholdX,this.swipedVertical=a>this.thresholdY||this.opts.diagonalSwipes&&s>this.thresholdY,(!this.opts.diagonalSwipes||c<Math.tan((45-this.opts.diagonalLimit)*Math.PI/180)||c>Math.tan((45+this.opts.diagonalLimit)*Math.PI/180))&&(r>=a&&(this.swipedVertical=!1),a>r&&(this.swipedHorizontal=!1)),this.swipedHorizontal&&(n<0?((this.velocityX??0)<-this.opts.velocityThreshold||o<-this.disregardVelocityThresholdX)&&this.fire(`swipeleft`,e):((this.velocityX??0)>this.opts.velocityThreshold||o>this.disregardVelocityThresholdX)&&this.fire(`swiperight`,e)),this.swipedVertical&&(i<0?((this.velocityY??0)<-this.opts.velocityThreshold||o<-this.disregardVelocityThresholdY)&&this.fire(`swipeup`,e):((this.velocityY??0)>this.opts.velocityThreshold||o>this.disregardVelocityThresholdY)&&this.fire(`swipedown`,e))):r<this.opts.pressThreshold&&a<this.opts.pressThreshold&&(this.doubleTapWaiting?(this.doubleTapWaiting=!1,clearTimeout(this.doubleTapTimer??void 0),this.fire(`doubletap`,e)):(this.doubleTapWaiting=!0,this.doubleTapTimer=setTimeout(()=>this.doubleTapWaiting=!1,this.opts.doubleTapTime),this.fire(`tap`,e)))}!this.touch1&&!this.touch2&&(this.fire(`pinchend`,e),this.fire(`rotateend`,e),this.originalDistance=null,this.newDistance=null,this.scale=null,this.originalAngle=null,this.newAngle=null,this.rotation=null)}}};ht.defaults={threshold:(e,t)=>Math.max(25,Math.floor(.15*(e===`x`?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(e,t)=>Math.floor(.5*(e===`x`?t.element.clientWidth:t.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:15,longPressTime:500,doubleTapTime:300,mouseSupport:!0};var gt=ht,Q=!1;try{window.addEventListener(`test`,null,Object.defineProperty({},`passive`,{get:function(){Q={passive:!0}}}))}catch{}var $=function(e){return e[e.NO_PUSH=0]=`NO_PUSH`,e[e.ONE_PUSH=1]=`ONE_PUSH`,e[e.PUSH_REPEATING=2]=`PUSH_REPEATING`,e}($||{}),_t=class{#e=new d;#t;#n;#r=new Map([[0,``],[1,`middle`]]);constructor(r,i,o,s,d,f,h,g,y){if(this.cfg=r,this.hTag=i,this.appPixi=o,this.main=s,this.layMng=d,this.val=f,this.scrItr=g,this.sys=y,i.clear_event=e=>p.clear_event(e),i.event=e=>this.#_(e),i.set_cancel_skip=()=>!1,i.set_focus=e=>this.#y(e),this.#t=new v(o.view,y),h.setEvtMng(this),g.setOtherObj(this,d),_.setEvtMng(this,y,g),d.setEvtMng(this),m.setFcs(this.#t),y.setFire((e,t)=>m.fire(e,t)),c.isDbg){let e={pause:()=>{if(!m.isWait)return;let e={};g.recodeDesign(e),y.callHook(`_enterDesign`,e),y.send2Dbg(`_enterDesign`,e)}};e.attach=e.stopOnEntry=e.stopOnStep=e.stopOnStepIn=e.stopOnStepOut=e.stopOnBackstep=e.pause,y.addHook(t=>e[t]?.())}a(`
.sn_hint {
	background-color: #3c3225;
	color: white;
	padding: 4px 8px;
	border-radius: 4px;
	font-size: 1.2em;
	z-index: 10000;
	pointer-events: none;
	user-select: none;
}

.sn_hint_ar,
.sn_hint_ar::before {
	position: absolute;
	width: 8px;
	height: 8px;
	background: inherit;
}
.sn_hint_ar {
	visibility: hidden;
}
.sn_hint_ar::before {
	visibility: visible;
	content: '';
	transform: rotate(45deg);
}

.sn_hint[data-popper-placement^='top']		> .sn_hint_ar {bottom: -4px;}
.sn_hint[data-popper-placement^='bottom']	> .sn_hint_ar {top: -4px;}
.sn_hint[data-popper-placement^='left']		> .sn_hint_ar {right: -4px;}
.sn_hint[data-popper-placement^='right']	> .sn_hint_ar {left: -4px;}
`),s.cvs.parentElement?.insertAdjacentHTML(`beforeend`,`
<div class="sn_hint" role="tooltip">
	<span>Dummy</span>
	<div class="sn_hint_ar" data-popper-arrow></div>
</div>`),this.#f=document.querySelector(`.sn_hint`),this.#p=this.#f.querySelector(`span`),this.#m=mt(this.#d,this.#f),this.#f.hidden=!0,o.stage.interactive=!0,this.#e.add(document.body,n,e=>this.#a(e)),this.#e.add(document.body,`keyup`,()=>p.resetFired()),this.#e.add(s.cvs,`contextmenu`,e=>{let t=this.#o(e)+`rightclick`;m.fire(t,e,!0),e.preventDefault()});let{width:b,height:x}=r.oCfg.window,S=Math.floor(b>x?x/3:b/3);this.#n=new gt(s.cvs,{velocityThreshold:0,disregardVelocityThreshold:e=>Math.floor(S*(e===`x`?1:.5))});let C=!1;this.#n.on(`tap`,e=>{if(C)return;if(e instanceof TouchEvent){m.fire(`click`,e,!0),p.resetFired();return}if(e.button>1)return;let t=this.#o(e)+`${this.#r.get(e.button)??``}click`;m.fire(t,e,!0),p.resetFired()}),this.#e.add(window,`pointerout`,()=>p.resetFired()),this.#n.on(`longpress`,e=>{if(C=!0,e instanceof TouchEvent){m.fire(`longpress`,e,!0);return}let t=this.#o(e)+`${this.#r.get(e.button)??``}longpress`;m.fire(t,e,!0)}),this.#n.on(`panend`,()=>{C&&queueMicrotask(()=>{C=!1})}),[`swiperight`,`swipeleft`,`swipeup`,`swipedown`].forEach(e=>{this.#n.on(e,t=>{if(t instanceof TouchEvent){m.fire(e,t,!0);return}let n=this.#o(t)+e;m.fire(n,t,!0)})});let w=()=>f.setVal_Nochk(`tmp`,`const.sn.navigator.language`,navigator.language);this.#e.add(globalThis,`languagechange`,e=>{w(),m.fire(`sn:chgNavLang`,e),l()}),w();let T=e=>{c.isDarkMode=e.matches,f.setVal_Nochk(`tmp`,`const.sn.isDarkMode`,c.isDarkMode)},E=globalThis.matchMedia(`(prefers-color-scheme: dark)`);T(E),this.#e.add(E,`change`,e=>{T(e),m.fire(`sn:chgDarkMode`,e)});let D=(e,t)=>{};`WheelEvent`in globalThis&&(this.#e.add(s.cvs,`wheel`,e=>this.#s(e),{passive:!0}),this.#i=e=>this.#e.add(e,`wheel`,e=>this.#s(e),{passive:!0}),D=(e,t)=>e.add(s.cvs,`wheel`,e=>{e.deltaY<=0||(e.stopPropagation(),t())})),m.init(r,i,s,f,g,d,this,h,D),e(()=>import(`./gamepad.js`),__vite__mapDeps([0,1])).then(t(1)).then(({GamepadListener:e})=>{let t=new e({analog:!1,deadZone:.3});c.debugLog&&(t.on(`gamepad:connected`,({detail:e})=>console.log(`üë∫<'gamepad:connected' index:${String(e.index)} id:${e.gamepad.id}`)),t.on(`gamepad:disconnected`,({detail:e})=>console.log(`üë∫<'gamepad:disconnected' index:${String(e.index)} id:${e.gamepad.id}`)));let r=[``,`ArrowUp`,``,`ArrowLeft`,``,`ArrowRight`,``,`ArrowDown`,``],i=[0,0];t.on(`gamepad:axis`,({detail:e})=>{if(!document.hasFocus())return;i[e.axis]=e.value;let[t=0,a=0]=i,o=r[(a+1)*3+(t+1)];if(!o)return;let s=this.#t.getFocus();(!s||s instanceof u?globalThis:s).dispatchEvent(new KeyboardEvent(n,{key:o,bubbles:!0})),!(!s||s instanceof u)&&(m.cancelAutoSkip(),s.getAttribute(`type`)===`range`&&s.dispatchEvent(new InputEvent(`input`,{bubbles:!0})))}),t.on(`gamepad:button`,e=>{if(document.hasFocus())if(e.detail.button%2==0){m.cancelAutoSkip();let e=this.#t.getFocus();(!e||e instanceof u?document.body:e).dispatchEvent(new KeyboardEvent(n,{key:`Enter`,bubbles:!0}))}else m.fire(`middleclick`,e,!0)}),t.start()}),this.#e.add(document,`keyup`,e=>{e.isComposing||e.key in this.#b&&(this.#b[e.key]=$.NO_PUSH)}),f.defTmp(`const.sn.key.alternate`,()=>this.#b.Alt>$.NO_PUSH),f.defTmp(`const.sn.key.command`,()=>this.#b.Meta>$.NO_PUSH),f.defTmp(`const.sn.key.control`,()=>this.#b.Control>$.NO_PUSH),f.defTmp(`const.sn.key.end`,()=>this.#b.End>$.NO_PUSH),f.defTmp(`const.sn.key.escape`,()=>this.#b.Escape>$.NO_PUSH),f.defTmp(`const.sn.key.back`,()=>this.#b.GoBack>$.NO_PUSH)}resvFlameEvent(e){this.#e.add(e,n,e=>this.#a(e)),this.#e.add(e,`contextmenu`,e=>{m.fire(this.#o(e)+`rightclick`,e,!0),e.preventDefault()}),this.#i(e),this.#e.add(e,o,e=>{if(e instanceof TouchEvent){m.fire(`click`,e,!0);return}if(e.button>1)return;let t=this.#o(e)+`${this.#r.get(e.button)??``}click`;m.fire(t,e,!0)}),this.#e.add(e,`pointerup`,()=>p.resetFired()),this.#e.add(e,`pointerout`,()=>p.resetFired())}#i=e=>{};#a(e){e.isComposing||(e.key in this.#b&&(this.#b[e.key]=e.repeat?$.PUSH_REPEATING:$.ONE_PUSH),e.preventDefault(),m.fire(g.modKey(e)+e.key,e,!0))}#o(e){return(e.altKey?`alt+`:``)+(e.ctrlKey?`ctrl+`:``)+(e.metaKey?`meta+`:``)+(e.shiftKey?`shift+`:``)}#s(e){if(this.#c){this.#l=!0;return}this.#c=!0,this.#u();let t=this.#o(e)+(e.deltaY>0?`downwheel`:`upwheel`);m.fire(t,e,!0)}#c=!1;#l=!1;#u(){setTimeout(()=>{if(this.#l){this.#l=!1,this.#u();return}this.#c=!1},250)}destroy(){for(let e of Array.from(document.getElementsByClassName(`sn_hint`)))e.parentElement?.removeChild(e);this.#n.destroy(),m.destroy(),this.#t.destroy(),this.#e.clear()}unButton(e){this.#t.remove(e)}button(e,t,n,r,a){!e.fn&&!e.label&&!e.url&&this.main.errScript(`fn„Åæ„Åü„ÅØlabel„Åæ„Åü„ÅØurl„ÅØÂøÖÈ†à„Åß„Åô`),e.fn??=this.scrItr.scriptFn,t.interactive=!0,t.cursor=`pointer`;let o=e.key?.toLowerCase()??` `,l=s(e,`global`,!1);p.setEvt2Fnc(l,o,()=>this.main.resumeByJumpOrCall(e)),t.on(i,e=>{e.preventDefault?.(),m.fire(o,e,!0)});let u=e.hint?()=>this.#g(e,t):()=>{},d=()=>{n(),this.#f.hidden=!0},g=()=>(u(),r());if(t.on(`pointerover`,g),t.on(`pointerout`,()=>{this.#t.isFocus(t)?g():d()}),t.on(`pointerdown`,()=>{this.#f.hidden=!0;let e=this.#t.getFocus();a(),e instanceof h&&e.normal()}),t.on(`pointerup`,c.isMobile?d:()=>{this.#t.isFocus(t)?g():d()}),this.#t.add(t,g,d),e.clickse&&(e.clicksebuf??=`SYS`,this.cfg.searchPath(e.clickse,f.SOUND),t.on(`pointerdown`,()=>this.hTag.playse({fn:e.clickse,...e.clicksebuf?{buf:e.clicksebuf}:{},join:!1}))),e.enterse&&(e.entersebuf??=`SYS`,this.cfg.searchPath(e.enterse,f.SOUND),t.on(`pointerover`,()=>this.hTag.playse({fn:e.enterse,...e.entersebuf?{buf:e.entersebuf}:{},join:!1}))),e.leavese&&(e.leavesebuf??=`SYS`,this.cfg.searchPath(e.leavese,f.SOUND),t.on(`pointerout`,()=>this.hTag.playse({fn:e.leavese,...e.leavesebuf?{buf:e.leavesebuf}:{},join:!1}))),e.onenter){let n=o+e.onenter.toLowerCase(),r={fn:e.fn,label:e.onenter,call:!0,key:n};p.setEvt2Fnc(l,n,()=>this.main.resumeByJumpOrCall(r)),t.on(`pointerover`,e=>m.fire(n,e))}if(e.onleave){let n=o+e.onleave.toLowerCase(),r={fn:e.fn,label:e.onleave,call:!0,key:n};p.setEvt2Fnc(l,n,()=>this.main.resumeByJumpOrCall(r)),t.on(`pointerout`,e=>m.fire(n,e))}}#d={getBoundingClientRect:(e=0,t=0)=>DOMRect.fromRect({x:e,y:t,width:0,height:0})};#f;#p;#m;#h={placement:`bottom`,modifiers:[{name:`flip`,options:{fallbackPlacements:[`top`,`bottom`]}}]};#g(e,t){let n=t instanceof h?t.getBtnBounds():t.getBounds();if(e[`:„Çø„Ç∞Âêç`]!==`link`){let e=t.parent.parent;n.x+=e.x,n.y+=e.y}if(!e.hint){this.#f.hidden=!0;return}this.#f.style.cssText=`position:${this.#f.style.position}; transform:${this.#f.style.transform};`+(e.hint_style??``),this.#p.style.cssText=``,this.#p.textContent=e.hint??``,this.#d.getBoundingClientRect=()=>DOMRect.fromRect({x:this.sys.ofsLeft4elm+n.x*this.sys.cvsScale,y:this.sys.ofsTop4elm+n.y*this.sys.cvsScale,width:n.width,height:n.height}),this.#m.setOptions(e.hint_opt?{...this.#h,...JSON.parse(e.hint_opt)}:this.#h).then(async()=>{await this.#m.update(),this.#f.hidden=!1}).catch(t=>console.error(r(e,`hint_opt`,`dispHint ÂºïÊï∞ hint_opt „Ç®„É©„Éº ${t instanceof SyntaxError?t.message:``}`)))}hideHint(){this.#f.hidden=!0}cvsResize(){this.hideHint()}#_(e){let t=e.key;if(!t)throw`key„ÅØÂøÖÈ†à„Åß„Åô`;let r=t.toLowerCase(),i=s(e,`call`,!1),a=s(e,`global`,!1),{fn:o,label:c,url:l}=e;if(s(e,`del`,!1)){if(o||c||i||l)throw`fn/label/call„Å®del„ÅØÂêåÊôÇÊåáÂÆö„Åß„Åç„Åæ„Åõ„Çì`;return p.clear_eventer(t,a,r),!1}if(!o&&!c&&!l)throw`fn,label,url „ÅÑ„Åö„Çå„Åã„ÅØÂøÖÈ†à„Åß„Åô`;if(e.fn??=this.scrItr.scriptFn,t.startsWith(`dom=`)){let r=p.getHtmlElmList(t);if(r.el.length===0){if(s(e,`need_err`,!0))throw`HTMLÂÜÖ„Å´„Çª„É¨„ÇØ„ÇøÔºà${r.sel}Ôºâ„Å´ÂØæÂøú„Åô„ÇãË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÇíË®±ÂÆπ„Åô„Çã„Å™„Çâ„ÄÅneed_err=false „Å®ÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ`;return!1}let i=[`click`,n];switch(r.el[0].type??``){case`checkbox`:i=[`input`];break;case`range`:i=[`input`];break;case`text`:case`textarea`:i=[`input`,`change`];break}let a=i.length;for(let e=0;e<a;++e){let n=i[e];r.el.forEach(i=>{this.#e.add(i,n,e=>{if(!m.isWait||this.layMng.getFrmDisabled(r.id)||n===`keydown`&&e.key!==`Enter`)return;let a=i.dataset;for(let[e,t]of Object.entries(a))this.val.setVal_Nochk(`tmp`,`sn.event.domdata.${e}`,t);m.fire(t,e)}),e===0&&this.#t.add(i,()=>this.#v(i)?(i.focus(),!0):!1,()=>{})})}}return p.setEvt2Fnc(a,r,()=>this.main.resumeByJumpOrCall(e)),!1}#v(e){if(!e||e.offsetParent===null)return!1;let t=e;do{if(getComputedStyle(t).display===`none`||t.dataset.focus===`false`||t?.disabled)return!1;t=t.parentElement}while(t);return!0}#y(e){let{add:t,del:n,to:r}=e;if(t?.startsWith(`dom=`)){let n=p.getHtmlElmList(t);if(n.el.length===0&&s(e,`need_err`,!0))throw`HTMLÂÜÖ„Å´„Çª„É¨„ÇØ„ÇøÔºà${n.sel}Ôºâ„Å´ÂØæÂøú„Åô„ÇãË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÇíË®±ÂÆπ„Åô„Çã„Å™„Çâ„ÄÅneed_err=false „Å®ÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ`;return n.el.forEach(e=>this.#t.add(e,()=>this.#v(e)?(e.focus(),!0):!1,()=>{})),!1}if(n?.startsWith(`dom=`)){let t=p.getHtmlElmList(n);if(t.el.length===0&&s(e,`need_err`,!0))throw`HTMLÂÜÖ„Å´„Çª„É¨„ÇØ„ÇøÔºà${t.sel}Ôºâ„Å´ÂØæÂøú„Åô„ÇãË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÇíË®±ÂÆπ„Åô„Çã„Å™„Çâ„ÄÅneed_err=false „Å®ÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ`;return t.el.forEach(e=>this.#t.remove(e)),!1}if(!r)throw`[set_focus] add „Åã to „ÅØÂøÖÈ†à„Åß„Åô`;switch(r){case`null`:this.#t.blur();break;case`next`:this.#t.next();break;case`prev`:this.#t.prev();break}return!1}get isSkipping(){return m.isSkipping?!0:Object.keys(this.#b).some(e=>this.#b[e]===$.PUSH_REPEATING)}#b={Alt:$.NO_PUSH,Meta:$.NO_PUSH,Control:$.NO_PUSH,ArrowDown:$.NO_PUSH,End:$.NO_PUSH,Enter:$.NO_PUSH,Escape:$.NO_PUSH," ":$.NO_PUSH,GoBack:$.NO_PUSH}};export{_t as EventMng};